"use strict";(()=>{var e={};e.id=350,e.ids=[350],e.modules={6075:e=>{e.exports=require("@tensorflow/tfjs")},5600:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},7021:e=>{e.exports=require("sentiment")},4216:e=>{e.exports=import("@xenova/transformers")},1428:e=>{e.exports=import("axios")},6762:(e,t)=>{Object.defineProperty(t,"M",{enumerable:!0,get:function(){return function e(t,r){return r in t?t[r]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,r)):"function"==typeof t&&"default"===r?t:void 0}}})},4529:(e,t,r)=>{r.a(e,async(e,n)=>{try{r.r(t),r.d(t,{config:()=>u,default:()=>l,routeModule:()=>d});var a=r(9947),i=r(2706),s=r(6762),o=r(1244),c=e([o]);o=(c.then?(await c)():c)[0];let l=(0,s.M)(o,"default"),u=(0,s.M)(o,"config"),d=new a.PagesAPIRouteModule({definition:{kind:i.A.PAGES_API,page:"/api/feedback",pathname:"/api/feedback",bundlePath:"",filename:""},userland:o});n()}catch(e){n(e)}})},2706:(e,t)=>{Object.defineProperty(t,"A",{enumerable:!0,get:function(){return r}});var r=function(e){return e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE",e.IMAGE="IMAGE",e}({})},9947:(e,t,r)=>{e.exports=r(5600)},1244:(e,t,r)=>{r.a(e,async(e,n)=>{try{r.r(t),r.d(t,{default:()=>c});var a=r(7344),i=r(1428),s=r(4794),o=e([i,s]);[i,s]=o.then?(await o)():o;let l=process.env.RECAPTCHA_SECRET_KEY;async function c(e,t){if("POST"===e.method)try{let r=(await a.A).db("sentimentTracker").collection("feedback"),{feedback:n,recaptchaToken:o,politicalSpectrum:c,predictedSpectrum:u,timestamp:d,source:m}=e.body;if(!n||n.length<10||n.length>1e4)return t.status(400).json({success:!1,error:"Invalid feedback length"});if("uploaded"!==m&&!o)return t.status(400).json({success:!1,error:"ReCAPTCHA token is required"});if("uploaded"!==m&&!(await i.default.post("https://www.google.com/recaptcha/api/siteverify",null,{params:{secret:l,response:o}})).data.success)return t.status(400).json({success:!1,error:"Invalid ReCAPTCHA"});let f=await (0,s.Gu)(n),p=await (0,s.ES)(n),g={feedback:n.trim(),politicalSpectrum:c?.trim()||"N/A",predictedSpectrum:u||p.spectrum,sentiment:{score:f.score,magnitude:f.magnitude,confidence:f.confidence,topWords:f.topWords},timestamp:d||new Date,source:m||"feedback-form"},h=await r.insertOne(g);t.status(201).json({success:!0,insertedId:h.insertedId,feedback:g})}catch(e){console.error("Error inserting document:",e),t.status(500).json({success:!1,error:"Internal Server Error"})}else t.status(405).json({success:!1,error:"Method Not Allowed"})}n()}catch(e){n(e)}})},7344:(e,t,r)=>{r.d(t,{A:()=>i});let n=require("mongodb"),a=process.env.MONGO_URI;if(!process.env.MONGO_URI)throw Error("Please add your Mongo URI to .env.local");let i=new n.MongoClient(a,{}).connect()},4794:(e,t,r)=>{r.a(e,async(e,n)=>{try{r.d(t,{ES:()=>u,Gu:()=>l});var a=r(6075),i=r(4216),s=r(7021),o=e([i]);i=(o.then?(await o)():o)[0];let d=new s,m=null,f=null,p=!1;async function c(){if(!m&&!f&&!p){p=!0;try{await a.ready(),"cpu"!==a.getBackend()&&await a.setBackend("cpu"),m=await (0,i.pipeline)("text-classification","Xenova/distilbert-base-uncased-finetuned-sst-2-english"),f=await (0,i.pipeline)("sentiment-analysis","Xenova/distilbert-base-uncased-finetuned-sst-2-english"),console.log("NLP models initialized successfully")}catch(e){console.error("Error initializing NLP models:",e),m=null,f=null}finally{p=!1}}}async function l(e){if(!e?.trim())return{score:0,magnitude:0,topWords:[],confidence:0,sentimentLabel:"neutral"};try{m&&f||await c();let t=d.analyze(e),r=t.score/Math.max(t.tokens.length,1),n=t.words.slice(0,5);0===n.length&&(n=e.split(" ").slice(0,3));let a=0,i=0,s="neutral";if(f)try{let t=await f(e,{truncation:!0});a="POSITIVE"===t[0].label?t[0].score:-t[0].score,i=t[0].score,s=t[0].label.toLowerCase()}catch(e){console.warn("Transformer sentiment analysis failed:",e)}let o=.3*r+.7*a,l=Math.max(Math.min(o,1),-1);return .1>Math.abs(l)&&(s="neutral"),{score:l,magnitude:Math.abs(l),topWords:n,confidence:Math.max(i,.1),sentimentLabel:s}}catch(e){return console.error("Sentiment analysis failed:",e),{score:{},magnitude:{},topWords:[],confidence:{},sentimentLabel:"neutral"}}}async function u(e){let t=e.toLowerCase();if(m)try{let t=await m(e,{topk:1,truncation:!0}),r=t[0].label,n=t[0].score;return{spectrum:"POSITIVE"===r?"center-right":"center-left",confidence:n}}catch(e){console.warn("Transformer classification failed:",e)}let r=Object.entries({"far-left":{keywords:["revolution","socialism","communist","abolish","collective","undocumented immigrant","immigration","MAGA","nazi"],weight:1},left:{keywords:["progressive","welfare","regulation","equality","reform","undocumented immigrant","immigration"],weight:.6},"center-left":{keywords:["liberal","public","social","healthcare","education","undocumented immigrant","immigration"],weight:.3},center:{keywords:["moderate","compromise","balance","bipartisan","pragmatic"],weight:0},"center-right":{keywords:["conservative","tradition","market","fiscal","values","illegal alien","invasion","border war"],weight:-.3},right:{keywords:["freedom","liberty","deregulation","privatize","tax cuts","illegal alien","invasion","border war"],weight:-.6},"far-right":{keywords:["nationalist","sovereignty","patriot","traditional","strong","illegal alien","invasion","border war","the Libs","Dems","MAGA","fascist"],weight:-1}}).map(([e,r])=>{let n=r.keywords.reduce((e,n)=>{let a=t.split(n.toLowerCase()).length-1;return e+a*r.weight},0);return{category:e,score:n}});r.sort((e,t)=>t.score-e.score);let n=r[0],a=Math.min(Math.max(.5*Math.abs(n.score),.1),1);return{spectrum:0!==n.score?n.category:"center",confidence:a}}(async()=>{await c()})(),n()}catch(e){n(e)}})}};var t=require("../../webpack-api-runtime.js");t.C(e);var r=t(t.s=4529);module.exports=r})();