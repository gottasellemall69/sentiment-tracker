(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[724],{4746:(e,t,s)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/dashboard",function(){return s(5872)}])},5872:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>N});var a=s(4848),r=s(6540),l=s(6715),n=s(1468),i=s(4731),c=s(6118),d=s(4981);c.t1.register(c.PP,c.kc,c.E8,c.hE,c.m_,c.s$);let o=()=>{let e=(0,n.wA)(),t=(0,n.d4)(d.CJ);console.log("Feedback entries:",t),(0,r.useEffect)(()=>{0===t.length&&(async()=>{try{let t=await fetch("/api/getfeedback");if(!t.ok)throw Error("Error fetching feedback");let s=await t.json();e((0,d.iq)(s))}catch(e){console.error("Error loading feedback:",e)}})()},[e,t]);let s=t.reduce((e,t)=>{let{politicalSpectrum:s,predictedSpectrum:a,sentiment:r}=t,l=s||a||"unspecified";return e[l]||(e[l]={count:0,totalSentiment:0}),e[l].count++,e[l].totalSentiment+=r.score,e},{}),l={labels:Object.keys(s),datasets:[{label:"Number of Responses",data:Object.values(s).map(e=>e.count),backgroundColor:"rgba(54, 162, 235, 0.5)",borderColor:"rgba(54, 162, 235, 1)",borderWidth:1},{label:"Average Sentiment",data:Object.values(s).map(e=>e.count>0?e.totalSentiment/e.count:0),backgroundColor:"rgba(255, 99, 132, 0.5)",borderColor:"rgba(255, 99, 132, 1)",borderWidth:1}]};return(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow p-6",children:[(0,a.jsx)("h2",{className:"text-xl font-bold mb-4",children:"Sentiment Analysis"}),(0,a.jsx)(i.yP,{data:l,options:{responsive:!0,plugins:{legend:{position:"top"},title:{display:!0,text:"Feedback Analysis by Political Spectrum"}},scales:{y:{beginAtZero:!0}}}})]})};var m=s(3029),x=s(320),u=s(1068);let p=()=>{let e=(0,n.wA)(),t=(0,n.d4)(d.CJ);(0,r.useEffect)(()=>{0===t.length&&(async()=>{try{let t=await fetch("/api/getfeedback");if(!t.ok)throw Error("Error fetching feedback");let s=await t.json();e((0,d.iq)(s))}catch(e){console.error("Error loading feedback:",e)}})()},[e,t.length]);let s=t.reduce((e,t)=>{let{politicalSpectrum:s,predictedSpectrum:a,sentiment:r,source:l}=t,n=s&&"N/A"!==s?s:a||"unspecified";return e[n]||(e[n]={count:0,totalSentiment:0,sources:{}}),e[n].count++,e[n].totalSentiment+=r.score,e[n].sources[l]=(e[n].sources[l]||0)+1,e},{}),l=t.length,i=t.reduce((e,t)=>{let{sentiment:s}=t;return e+s.score},0),c=l?i/l:0,o=e=>e>.5?"strongly positive":e>.3?"moderately positive":e>.1?"slightly positive":e<-.5?"strongly negative":e<-.3?"moderately negative":e<-.1?"slightly negative":"neutral",p=e=>e>.1?(0,a.jsx)(m.A,{className:"w-5 h-5"}):e<-.1?(0,a.jsx)(x.A,{className:"w-5 h-5"}):(0,a.jsx)(u.A,{className:"w-5 h-5"}),h=e=>e>.1?"text-green-600":e<-.1?"text-red-600":"text-gray-600";return(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow p-6",children:[(0,a.jsx)("h2",{className:"text-xl font-bold mb-4",children:"Sentiment Summary by Group"}),(0,a.jsxs)("div",{className:"mb-6 p-4 bg-gray-50 border rounded-lg",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold",children:"Overall Sentiment:"}),(0,a.jsxs)("div",{className:"flex items-center ".concat(h(c)),children:[p(c),(0,a.jsxs)("span",{className:"ml-2 text-lg",children:[o(c)," (",c.toFixed(2),")"]})]}),(0,a.jsxs)("p",{className:"text-sm text-gray-600 mt-2",children:["Total responses: ",l]})]}),0===Object.keys(s).length?(0,a.jsx)("p",{className:"text-gray-500",children:"No data available."}):(0,a.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4",children:Object.entries(s).map(e=>{let[t,s]=e,r=s.totalSentiment/s.count,l=o(r);return(0,a.jsxs)("div",{className:"border rounded-lg p-4 w-fit",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-2",children:[(0,a.jsx)("h3",{className:"font-semibold text-lg capitalize",children:t.replace(/-/g," ")}),(0,a.jsxs)("div",{className:"flex items-center ".concat(h(r)),children:[p(r),(0,a.jsx)("span",{className:"ml-1",children:r.toFixed(2)})]})]}),(0,a.jsxs)("p",{className:"text-sm text-gray-700 mb-3",children:["This group is feeling ",(0,a.jsx)("span",{className:"font-medium",children:l})," overall."]}),(0,a.jsxs)("div",{className:"mt-2 text-sm text-gray-500",children:["Total responses: ",s.count]}),(0,a.jsxs)("div",{className:"mt-2 text-sm text-gray-500",children:[(0,a.jsx)("strong",{children:"Sources:"}),(0,a.jsx)("ul",{className:"list-disc pl-5",children:Object.entries(s.sources).map(e=>{let[t,s]=e;return(0,a.jsxs)("li",{children:[t,": ",s]},t)})})]})]},t)})})]})};var h=s(6051),f=s(3093);async function g(e){let t;switch(function(e){try{return JSON.parse(e),"json"}catch(t){if(e.includes(",")&&e.split("'\n'")[0].includes(","))return"csv";return"txt"}}(e)){case"json":t=function(e){let t=JSON.parse(e);if(Array.isArray(t))return t.map(e=>({timestamp:e.timestamp?new Date(e.timestamp).getTime():Date.now(),content:e.message||e.content||e.text||e.feedback||"",spectrum:e.spectrum||e.politicalSpectrum||"unspecified"}));throw Error("Invalid JSON format")}(e);break;case"csv":t=function(e){let t=e.split("\n"),s=t[0].toLowerCase().split(","),a=s.findIndex(e=>e.includes("time")||e.includes("date")||e.includes("timestamp")),r=s.findIndex(e=>e.includes("message")||e.includes("content")||e.includes("text")||e.includes("feedback")),l=s.findIndex(e=>e.includes("spectrum")||e.includes("political")||e.includes("party")||e.includes("affiliation"));if(-1===r)throw Error("No message content column found");return t.slice(1).filter(e=>e.trim()).map(e=>{var t;let s=e.split(",");return{timestamp:-1!==a?new Date(s[a]).getTime():Date.now(),content:s[r].trim(),spectrum:-1!==l?null===(t=s[l])||void 0===t?void 0:t.trim():"unspecified"}})}(e);break;case"txt":t=e.split("\n").filter(e=>e.trim()).map(e=>({timestamp:Date.now(),content:e.trim(),spectrum:"unspecified"}));break;default:throw Error("Unsupported file format")}return t.filter(e=>e.content.trim().length>0)}var j=s(1484);let b=()=>{let e=(0,n.wA)(),t=(0,n.d4)(e=>e.feedback.entries),s=(0,r.useCallback)(async s=>{var a;let r=null===(a=s.target.files)||void 0===a?void 0:a[0];if(r)try{let s=new FileReader;s.onload=async s=>{var a;let r=null===(a=s.target)||void 0===a?void 0:a.result,l=await g(r),n=[];for(let e of l){let{spectrum:t,confidence:s}=await (0,j.ES)(e.content),a=await (0,j.Gu)(e.content),r={feedback:e.content,politicalSpectrum:"N/A",predictedSpectrum:t,sentiment:{score:a.score,confidence:s},timestamp:e.timestamp,source:"uploaded"};await fetch("/api/feedback",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)}),n.push(r)}e((0,d.iq)([...t,...n])),f.oR.success("Successfully analyzed ".concat(l.length," messages"))},s.readAsText(r)}catch(e){console.error("Error processing chat log:",e),f.oR.error("Error processing chat log")}},[e,t]);return(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow p-6",children:[(0,a.jsx)("h2",{className:"text-xl font-bold mb-4",children:"Upload Chat Logs"}),(0,a.jsx)("div",{className:"flex items-center justify-center w-full",children:(0,a.jsxs)("label",{className:"flex flex-col items-center justify-center w-full h-32 border-2 border-gray-300 border-dashed rounded-lg cursor-pointer bg-gray-50 hover:bg-gray-100",children:[(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center pt-5 pb-6",children:[(0,a.jsx)(h.A,{className:"w-8 h-8 mb-3 text-gray-400"}),(0,a.jsxs)("p",{className:"mb-2 text-sm text-gray-500",children:[(0,a.jsx)("span",{className:"font-semibold",children:"Click to upload"})," or drag and drop"]}),(0,a.jsx)("p",{className:"text-xs text-gray-500",children:"TXT, JSON, or CSV files"})]}),(0,a.jsx)("input",{type:"file",className:"hidden",accept:".txt,.json,.csv",onChange:s})]})})]})},y=()=>{let e=(0,n.wA)(),t=(0,n.d4)(d.CJ),[s,l]=(0,r.useState)(!0),[i,c]=(0,r.useState)(null),[o,m]=(0,r.useState)(""),[x,u]=(0,r.useState)("date");(0,r.useEffect)(()=>{(async()=>{try{l(!0);let t=await fetch("/api/getfeedback");if(!t.ok)throw Error("Error fetching feedback: ".concat(t.statusText));let s=await t.json();e((0,d.iq)(s))}catch(e){c(e.message)}finally{l(!1)}})()},[e]);let p=(0,r.useMemo)(()=>null==t?void 0:t.filter(e=>e.feedback.toLowerCase().includes(o.toLowerCase())||(e.politicalSpectrum||"").toLowerCase().includes(o.toLowerCase())||(e.predictedSpectrum||"").toLowerCase().includes(o.toLowerCase())).sort((e,t)=>"date"===x?new Date(t.timestamp)-new Date(e.timestamp):t.sentiment.score-e.sentiment.score),[t,o,x]);return s?(0,a.jsx)("p",{className:"text-center text-gray-500",children:"Loading feedback data..."}):i?(0,a.jsxs)("p",{className:"text-center text-red-500",children:["Error: ",i]}):(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow p-6 h-[500px] overflow-y-auto",children:[(0,a.jsx)("h2",{className:"text-xl font-bold mb-4",children:"Admin Panel"}),(0,a.jsxs)("div",{className:"mb-4 flex justify-between",children:[(0,a.jsx)("input",{type:"text",placeholder:"Filter by text or spectrum...",className:"px-3 py-2 border rounded-md",value:o,onChange:e=>m(e.target.value)}),(0,a.jsxs)("select",{className:"px-3 py-2 border rounded-md",value:x,onChange:e=>u(e.target.value),children:[(0,a.jsx)("option",{value:"date",children:"Sort by Date"}),(0,a.jsx)("option",{value:"sentiment",children:"Sort by Sentiment"})]})]}),(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,a.jsx)("thead",{className:"bg-gray-50",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500",children:"Timestamp"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500",children:"Feedback"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500",children:"Political Spectrum"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500",children:"Sentiment Score"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500",children:"Confidence"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500",children:"Top Words"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500",children:"Source"})]})}),(0,a.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:null==p?void 0:p.map((e,t)=>{var s,r,l,n,i,c;return(0,a.jsxs)("tr",{children:[(0,a.jsx)("td",{className:"px-6 py-4 text-sm text-gray-500",children:new Date(e.timestamp).toLocaleString()}),(0,a.jsx)("td",{className:"px-6 py-4 text-sm text-gray-900",children:e.feedback}),(0,a.jsx)("td",{className:"px-6 py-4 text-sm text-gray-500",children:e.politicalSpectrum&&"N/A"!==e.politicalSpectrum?(0,a.jsxs)("span",{children:[(0,a.jsx)("strong",{children:"Submitted:"})," ",e.politicalSpectrum]}):(0,a.jsxs)("span",{children:[(0,a.jsx)("strong",{children:"Predicted:"})," ",e.predictedSpectrum||"N/A"]})}),(0,a.jsx)("td",{className:"px-6 py-4",children:(0,a.jsx)("span",{className:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full ".concat((null===(s=e.sentiment)||void 0===s?void 0:s.score)>0?"bg-green-100 text-green-800":"bg-red-100 text-red-800"),children:(null===(l=e.sentiment)||void 0===l?void 0:null===(r=l.score)||void 0===r?void 0:r.toFixed(2))||"N/A"})}),(0,a.jsx)("td",{className:"px-6 py-4 text-sm text-gray-500",children:(null===(n=e.sentiment)||void 0===n?void 0:n.confidence)!==void 0?Math.max((100*e.sentiment.confidence).toFixed(1),10)+"%":"N/A"}),(0,a.jsx)("td",{className:"px-6 py-4 text-sm text-gray-500",children:(null===(c=e.sentiment)||void 0===c?void 0:null===(i=c.topWords)||void 0===i?void 0:i.join(", "))||"N/A"}),(0,a.jsx)("td",{className:"px-6 py-4 text-sm text-gray-500",children:e.source})]},t)})})]})})]})};function N(){(0,l.useRouter)();let[e,t]=(0,r.useState)(null),s=(0,n.wA)(),[i,c]=(0,r.useState)([{}]),[d,m]=(0,r.useState)(!0),[x,u]=(0,r.useState)(null);return((0,r.useEffect)(()=>{(async()=>{try{m(!0);let e=await fetch("/api/getfeedback");if(!e.ok)throw Error("Error fetching feedback: ".concat(e.statusText));let t=await e.json();c(t)}catch(e){u(e.message)}finally{m(!1)}})()},[s]),d)?(0,a.jsx)("p",{className:"text-center text-gray-500",children:"Loading feedback data..."}):x?(0,a.jsxs)("p",{className:"text-center text-red-500",children:["Error: ",x]}):(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"mb-6 flex justify-between items-center",children:(0,a.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Sentiment Analysis Dashboard"})}),(0,a.jsx)("div",{className:"mb-6 w-full",children:(0,a.jsx)(b,{})}),(0,a.jsx)("div",{className:" mx-auto flex flex-wrap max-w-7xl",children:(0,a.jsxs)("div",{className:"grid grid-cols-1 gap-6 w-full",children:[(0,a.jsx)("div",{children:(0,a.jsx)(o,{})}),(0,a.jsx)("div",{className:"mt-6",children:(0,a.jsx)(p,{})})]})}),(0,a.jsx)("div",{className:"mt-8",children:(0,a.jsx)(y,{feedback:i})})]})}}},e=>{var t=t=>e(e.s=t);e.O(0,[201,156,636,593,792],()=>t(4746)),_N_E=e.O()}]);