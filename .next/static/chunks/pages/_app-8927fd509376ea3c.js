(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[636],{6743:(e,t,n)=>{"use strict";n.d(t,{Am:()=>B,FA:()=>D,Fy:()=>_,I9:()=>U,Im:()=>M,Ku:()=>H,T9:()=>b,Tj:()=>m,Uj:()=>u,XA:()=>v,ZQ:()=>x,bD:()=>L,c1:()=>k,cY:()=>w,eX:()=>O,g:()=>R,hp:()=>V,jZ:()=>T,lT:()=>C,lV:()=>E,nr:()=>A,sr:()=>S,tD:()=>j,u:()=>c,yU:()=>y,zW:()=>N});var r=n(7836);let i=function(e){let t=[],n=0;for(let r=0;r<e.length;r++){let i=e.charCodeAt(r);i<128?t[n++]=i:(i<2048?t[n++]=i>>6|192:((64512&i)==55296&&r+1<e.length&&(64512&e.charCodeAt(r+1))==56320?(i=65536+((1023&i)<<10)+(1023&e.charCodeAt(++r)),t[n++]=i>>18|240,t[n++]=i>>12&63|128):t[n++]=i>>12|224,t[n++]=i>>6&63|128),t[n++]=63&i|128)}return t},s=function(e){let t=[],n=0,r=0;for(;n<e.length;){let i=e[n++];if(i<128)t[r++]=String.fromCharCode(i);else if(i>191&&i<224){let s=e[n++];t[r++]=String.fromCharCode((31&i)<<6|63&s)}else if(i>239&&i<365){let s=((7&i)<<18|(63&e[n++])<<12|(63&e[n++])<<6|63&e[n++])-65536;t[r++]=String.fromCharCode(55296+(s>>10)),t[r++]=String.fromCharCode(56320+(1023&s))}else{let s=e[n++],a=e[n++];t[r++]=String.fromCharCode((15&i)<<12|(63&s)<<6|63&a)}}return t.join("")},a={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();let n=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let t=0;t<e.length;t+=3){let i=e[t],s=t+1<e.length,a=s?e[t+1]:0,o=t+2<e.length,l=o?e[t+2]:0,u=i>>2,c=(3&i)<<4|a>>4,h=(15&a)<<2|l>>6,d=63&l;o||(d=64,s||(h=64)),r.push(n[u],n[c],n[h],n[d])}return r.join("")},encodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(i(e),t)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):s(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(e,t){this.init_();let n=t?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let t=0;t<e.length;){let i=n[e.charAt(t++)],s=t<e.length?n[e.charAt(t)]:0,a=++t<e.length?n[e.charAt(t)]:64,l=++t<e.length?n[e.charAt(t)]:64;if(++t,null==i||null==s||null==a||null==l)throw new o;let u=i<<2|s>>4;if(r.push(u),64!==a){let e=s<<4&240|a>>2;if(r.push(e),64!==l){let e=a<<6&192|l;r.push(e)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}};class o extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}let l=function(e){let t=i(e);return a.encodeByteArray(t,!0)},u=function(e){return l(e).replace(/\./g,"")},c=function(e){try{return a.decodeString(e,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function h(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==n.g)return n.g;throw Error("Unable to locate global object.")}let d=()=>h().__FIREBASE_DEFAULTS__,p=()=>{if(void 0===r||void 0===r.env)return;let e=r.env.__FIREBASE_DEFAULTS__;if(e)return JSON.parse(e)},f=()=>{let e;if("undefined"==typeof document)return;try{e=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(e){return}let t=e&&c(e[1]);return t&&JSON.parse(t)},g=()=>{try{return d()||p()||f()}catch(e){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${e}`);return}},m=e=>{var t,n;return null===(n=null===(t=g())||void 0===t?void 0:t.emulatorHosts)||void 0===n?void 0:n[e]},y=e=>{let t=m(e);if(!t)return;let n=t.lastIndexOf(":");if(n<=0||n+1===t.length)throw Error(`Invalid host ${t} with no separate hostname and port!`);let r=parseInt(t.substring(n+1),10);return"["===t[0]?[t.substring(1,n-1),r]:[t.substring(0,n),r]},b=()=>{var e;return null===(e=g())||void 0===e?void 0:e.config},v=e=>{var t;return null===(t=g())||void 0===t?void 0:t[`_${e}`]};class w{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,n)=>{t?this.reject(t):this.resolve(n),"function"==typeof e&&(this.promise.catch(()=>{}),1===e.length?e(t):e(t,n))}}}function _(e,t){if(e.uid)throw Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');let n={alg:"none",type:"JWT"},r=t||"demo-project",i=e.iat||0,s=e.sub||e.user_id;if(!s)throw Error("mockUserToken must contain 'sub' or 'user_id' field!");let a=Object.assign({iss:`https://securetoken.google.com/${r}`,aud:r,iat:i,exp:i+3600,auth_time:i,sub:s,user_id:s,firebase:{sign_in_provider:"custom",identities:{}}},e),o="";return[u(JSON.stringify(n)),u(JSON.stringify(a)),o].join(".")}function x(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function T(){return"undefined"!=typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(x())}function I(){var e;let t=null===(e=g())||void 0===e?void 0:e.forceEnvironment;if("node"===t)return!0;if("browser"===t)return!1;try{return"[object process]"===Object.prototype.toString.call(n.g.process)}catch(e){return!1}}function k(){return"undefined"!=typeof navigator&&"Cloudflare-Workers"===navigator.userAgent}function S(){let e="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0;return"object"==typeof e&&void 0!==e.id}function E(){return"object"==typeof navigator&&"ReactNative"===navigator.product}function C(){let e=x();return e.indexOf("MSIE ")>=0||e.indexOf("Trident/")>=0}function A(){return!I()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function N(){try{return"object"==typeof indexedDB}catch(e){return!1}}function O(){return new Promise((e,t)=>{try{let n=!0,r="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(r);i.onsuccess=()=>{i.result.close(),n||self.indexedDB.deleteDatabase(r),e(!0)},i.onupgradeneeded=()=>{n=!1},i.onerror=()=>{var e;t((null===(e=i.error)||void 0===e?void 0:e.message)||"")}}catch(e){t(e)}})}let $="FirebaseError";class R extends Error{constructor(e,t,n){super(t),this.code=e,this.customData=n,this.name=$,Object.setPrototypeOf(this,R.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,D.prototype.create)}}class D{constructor(e,t,n){this.service=e,this.serviceName=t,this.errors=n}create(e,...t){let n=t[0]||{},r=`${this.service}/${e}`,i=this.errors[e],s=i?F(i,n):"Error",a=`${this.serviceName}: ${s} (${r}).`;return new R(r,a,n)}}function F(e,t){return e.replace(P,(e,n)=>{let r=t[n];return null!=r?String(r):`<${n}?>`})}let P=/\{\$([^}]+)}/g;function M(e){for(let t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}function L(e,t){if(e===t)return!0;let n=Object.keys(e),r=Object.keys(t);for(let i of n){if(!r.includes(i))return!1;let n=e[i],s=t[i];if(z(n)&&z(s)){if(!L(n,s))return!1}else if(n!==s)return!1}for(let e of r)if(!n.includes(e))return!1;return!0}function z(e){return null!==e&&"object"==typeof e}function B(e){let t=[];for(let[n,r]of Object.entries(e))Array.isArray(r)?r.forEach(e=>{t.push(encodeURIComponent(n)+"="+encodeURIComponent(e))}):t.push(encodeURIComponent(n)+"="+encodeURIComponent(r));return t.length?"&"+t.join("&"):""}function U(e){let t={};return e.replace(/^\?/,"").split("&").forEach(e=>{if(e){let[n,r]=e.split("=");t[decodeURIComponent(n)]=decodeURIComponent(r)}}),t}function V(e){let t=e.indexOf("?");if(!t)return"";let n=e.indexOf("#",t);return e.substring(t,n>0?n:void 0)}function j(e,t){let n=new G(e,t);return n.subscribe.bind(n)}class G{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(e=>{this.error(e)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,n){let r;if(void 0===e&&void 0===t&&void 0===n)throw Error("Missing Observer.");void 0===(r=W(e,["next","error","complete"])?e:{next:e,error:t,complete:n}).next&&(r.next=q),void 0===r.error&&(r.error=q),void 0===r.complete&&(r.complete=q);let i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?r.error(this.finalError):r.complete()}catch(e){}}),this.observers.push(r),i}unsubscribeOne(e){void 0!==this.observers&&void 0!==this.observers[e]&&(delete this.observers[e],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(void 0!==this.observers&&void 0!==this.observers[e])try{t(this.observers[e])}catch(e){"undefined"!=typeof console&&console.error&&console.error(e)}})}close(e){this.finalized||(this.finalized=!0,void 0!==e&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function W(e,t){if("object"!=typeof e||null===e)return!1;for(let n of t)if(n in e&&"function"==typeof e[n])return!0;return!1}function q(){}function H(e){return e&&e._delegate?e._delegate:e}},3251:(e,t,n)=>{"use strict";n.r(t),n.d(t,{InferenceSession:()=>y,Tensor:()=>g,env:()=>l,registerBackend:()=>s});let r={},i=[],s=(e,t,n)=>{if(t&&"function"==typeof t.init&&"function"==typeof t.createSessionHandler){let s=r[e];if(void 0===s)r[e]={backend:t,priority:n};else if(s.priority>n)return;else if(s.priority===n&&s.backend!==t)throw Error(`cannot register backend "${e}" using priority ${n}`);if(n>=0){let t=i.indexOf(e);-1!==t&&i.splice(t,1);for(let t=0;t<i.length;t++)if(r[i[t]].priority<=n){i.splice(t,0,e);return}i.push(e)}return}throw TypeError("not a valid backend")},a=async e=>{let t=0===e.length?i:e,n=[];for(let e of t){let t=r[e];if(t){if(t.initialized)return t.backend;if(t.aborted)continue;let r=!!t.initPromise;try{return r||(t.initPromise=t.backend.init()),await t.initPromise,t.initialized=!0,t.backend}catch(i){r||n.push({name:e,err:i}),t.aborted=!0}finally{delete t.initPromise}}}throw Error(`no available backend found. ERR: ${n.map(e=>`[${e.name}] ${e.err}`).join(", ")}`)};class o{constructor(){this.wasm={},this.webgl={},this.logLevelInternal="warning"}set logLevel(e){if(void 0!==e){if("string"!=typeof e||-1===["verbose","info","warning","error","fatal"].indexOf(e))throw Error(`Unsupported logging level: ${e}`);this.logLevelInternal=e}}get logLevel(){return this.logLevelInternal}}let l=new o,u="undefined"!=typeof BigInt64Array&&"function"==typeof BigInt64Array.from,c="undefined"!=typeof BigUint64Array&&"function"==typeof BigUint64Array.from,h=new Map([["float32",Float32Array],["uint8",Uint8Array],["int8",Int8Array],["uint16",Uint16Array],["int16",Int16Array],["int32",Int32Array],["bool",Uint8Array],["float64",Float64Array],["uint32",Uint32Array]]),d=new Map([[Float32Array,"float32"],[Uint8Array,"uint8"],[Int8Array,"int8"],[Uint16Array,"uint16"],[Int16Array,"int16"],[Int32Array,"int32"],[Float64Array,"float64"],[Uint32Array,"uint32"]]);u&&(h.set("int64",BigInt64Array),d.set(BigInt64Array,"int64")),c&&(h.set("uint64",BigUint64Array),d.set(BigUint64Array,"uint64"));let p=e=>{let t=1;for(let n=0;n<e.length;n++){let r=e[n];if("number"!=typeof r||!Number.isSafeInteger(r))throw TypeError(`dims[${n}] must be an integer, got: ${r}`);if(r<0)throw RangeError(`dims[${n}] must be a non-negative integer, got: ${r}`);t*=r}return t};class f{constructor(e,t,n){let r,i,s;if("string"==typeof e){if(r=e,s=n,"string"===e){if(!Array.isArray(t))throw TypeError("A string tensor's data must be a string array.");i=t}else{let n=h.get(e);if(void 0===n)throw TypeError(`Unsupported tensor type: ${e}.`);if(Array.isArray(t))i=n.from(t);else if(t instanceof n)i=t;else throw TypeError(`A ${r} tensor's data must be type of ${n}`)}}else if(s=t,Array.isArray(e)){if(0===e.length)throw TypeError("Tensor type cannot be inferred from an empty array.");let t=typeof e[0];if("string"===t)r="string",i=e;else if("boolean"===t)r="bool",i=Uint8Array.from(e);else throw TypeError(`Invalid element type of data array: ${t}.`)}else{let t=d.get(e.constructor);if(void 0===t)throw TypeError(`Unsupported type for tensor data: ${e.constructor}.`);r=t,i=e}if(void 0===s)s=[i.length];else if(!Array.isArray(s))throw TypeError("A tensor's dims must be a number array");let a=p(s);if(a!==i.length)throw Error(`Tensor's size(${a}) does not match data length(${i.length}).`);this.dims=s,this.type=r,this.data=i,this.size=a}static bufferToTensor(e,t){let n,r;if(void 0===e)throw Error("Image buffer must be defined");if(void 0===t.height||void 0===t.width)throw Error("Image height and width must be defined");let{height:i,width:s}=t,a=t.norm;n=void 0===a||void 0===a.mean?255:a.mean,r=void 0===a||void 0===a.bias?0:a.bias;let o=void 0!==t.bitmapFormat?t.bitmapFormat:"RGBA",l=void 0!==t.tensorFormat&&void 0!==t.tensorFormat?t.tensorFormat:"RGB",u=i*s,c=new Float32Array("RGBA"===l?4*u:3*u),h=4,d=0,p=1,g=2,m=3,y=0,b=u,v=2*u,w=-1;"RGB"===o&&(h=3,d=0,p=1,g=2,m=-1),"RGBA"===l?w=3*u:"RBG"===l?(y=0,v=u,b=2*u):"BGR"===l&&(v=0,b=u,y=2*u);for(let t=0;t<u;t++,d+=h,g+=h,p+=h,m+=h)c[y++]=(e[d]+r)/n,c[b++]=(e[p]+r)/n,c[v++]=(e[g]+r)/n,-1!==w&&-1!==m&&(c[w++]=(e[m]+r)/n);return"RGBA"===l?new f("float32",c,[1,4,i,s]):new f("float32",c,[1,3,i,s])}static async fromImage(e,t){let n;let r="undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement,i="undefined"!=typeof ImageData&&e instanceof ImageData,s="undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap,a="undefined"!=typeof String&&(e instanceof String||"string"==typeof e),o={};if(r){let r=document.createElement("canvas"),i=r.getContext("2d");if(null!=i){let s=e.naturalHeight,a=e.naturalWidth;if(void 0!==t&&void 0!==t.resizedHeight&&void 0!==t.resizedWidth&&(s=t.resizedHeight,a=t.resizedWidth),void 0!==t){if(o=t,void 0!==t.tensorFormat)throw Error("Image input config format must be RGBA for HTMLImageElement");if(o.tensorFormat="RGBA",void 0!==t.height&&t.height!==s)throw Error("Image input config height doesn't match HTMLImageElement height");if(o.height=s,void 0!==t.width&&t.width!==a)throw Error("Image input config width doesn't match HTMLImageElement width");o.width=a}else o.tensorFormat="RGBA",o.height=s,o.width=a;r.width=a,r.height=s,i.drawImage(e,0,0,a,s),n=i.getImageData(0,0,a,s).data}else throw Error("Can not access image data")}else if(i){let r,i;let s="RGBA";if(void 0!==t&&void 0!==t.resizedWidth&&void 0!==t.resizedHeight?(r=t.resizedHeight,i=t.resizedWidth):(r=e.height,i=e.width),void 0!==t){if(o=t,void 0!==t.bitmapFormat&&t.bitmapFormat!==s)throw Error("Image input config format must be RGBA for ImageData");o.bitmapFormat="RGBA"}else o.bitmapFormat="RGBA";if(o.height=r,o.width=i,void 0!==t){let t=document.createElement("canvas");t.width=i,t.height=r;let s=t.getContext("2d");if(null!=s)s.putImageData(e,0,0),n=s.getImageData(0,0,i,r).data;else throw Error("Can not access image data")}else n=e.data}else if(s){if(void 0===t)throw Error("Please provide image config with format for Imagebitmap");if(void 0!==t.bitmapFormat)throw Error("Image input config format must be defined for ImageBitmap");let r=document.createElement("canvas").getContext("2d");if(null!=r){let i=e.height,s=e.width;if(r.drawImage(e,0,0,s,i),n=r.getImageData(0,0,s,i).data,void 0!==t){if(void 0!==t.height&&t.height!==i)throw Error("Image input config height doesn't match ImageBitmap height");if(o.height=i,void 0!==t.width&&t.width!==s)throw Error("Image input config width doesn't match ImageBitmap width");o.width=s}else o.height=i,o.width=s;return f.bufferToTensor(n,o)}throw Error("Can not access image data")}else if(a)return new Promise((n,r)=>{let i=document.createElement("canvas"),s=i.getContext("2d");if(!e||!s)return r();let a=new Image;a.crossOrigin="Anonymous",a.src=e,a.onload=()=>{i.width=a.width,i.height=a.height,s.drawImage(a,0,0,i.width,i.height);let e=s.getImageData(0,0,i.width,i.height);if(void 0!==t){if(void 0!==t.height&&t.height!==i.height)throw Error("Image input config height doesn't match ImageBitmap height");if(o.height=i.height,void 0!==t.width&&t.width!==i.width)throw Error("Image input config width doesn't match ImageBitmap width");o.width=i.width}else o.height=i.height,o.width=i.width;n(f.bufferToTensor(e.data,o))}});else throw Error("Input data provided is not supported - aborted tensor creation");if(void 0!==n)return f.bufferToTensor(n,o);throw Error("Input data provided is not supported - aborted tensor creation")}toImageData(e){var t,n;let r;let i=document.createElement("canvas").getContext("2d");if(null!=i){let s=this.dims[3],a=this.dims[2],o=this.dims[1],l=void 0!==e&&void 0!==e.format?e.format:"RGB",u=void 0!==e&&(null===(t=e.norm)||void 0===t?void 0:t.mean)!==void 0?e.norm.mean:255,c=void 0!==e&&(null===(n=e.norm)||void 0===n?void 0:n.bias)!==void 0?e.norm.bias:0,h=a*s;if(void 0!==e){if(void 0!==e.height&&e.height!==a)throw Error("Image output config height doesn't match tensor height");if(void 0!==e.width&&e.width!==s)throw Error("Image output config width doesn't match tensor width");if(void 0!==e.format&&4===o&&"RGBA"!==e.format||3===o&&"RGB"!==e.format&&"BGR"!==e.format)throw Error("Tensor format doesn't match input tensor dims")}let d=4,p=0,f=1,g=2,m=3,y=0,b=h,v=2*h,w=-1;"RGBA"===l?(y=0,b=h,v=2*h,w=3*h):"RGB"===l?(y=0,b=h,v=2*h):"RBG"===l&&(y=0,v=h,b=2*h),r=i.createImageData(s,a);for(let e=0;e<a*s;p+=d,f+=d,g+=d,m+=d,e++)r.data[p]=(this.data[y++]-c)*u,r.data[f]=(this.data[b++]-c)*u,r.data[g]=(this.data[v++]-c)*u,r.data[m]=-1===w?255:(this.data[w++]-c)*u}else throw Error("Can not access image data");return r}reshape(e){return new f(this.type,this.data,e)}}let g=f;class m{constructor(e){this.handler=e}async run(e,t,n){let r={},i={};if("object"!=typeof e||null===e||e instanceof g||Array.isArray(e))throw TypeError("'feeds' must be an object that use input names as keys and OnnxValue as corresponding values.");let s=!0;if("object"==typeof t){if(null===t)throw TypeError("Unexpected argument[1]: cannot be null.");if(t instanceof g)throw TypeError("'fetches' cannot be a Tensor");if(Array.isArray(t)){if(0===t.length)throw TypeError("'fetches' cannot be an empty array.");for(let e of(s=!1,t)){if("string"!=typeof e)throw TypeError("'fetches' must be a string array or an object.");if(-1===this.outputNames.indexOf(e))throw RangeError(`'fetches' contains invalid output name: ${e}.`);r[e]=null}if("object"==typeof n&&null!==n)i=n;else if(void 0!==n)throw TypeError("'options' must be an object.")}else{let e=!1,a=Object.getOwnPropertyNames(t);for(let n of this.outputNames)if(-1!==a.indexOf(n)){let i=t[n];(null===i||i instanceof g)&&(e=!0,s=!1,r[n]=i)}if(e){if("object"==typeof n&&null!==n)i=n;else if(void 0!==n)throw TypeError("'options' must be an object.")}else i=t}}else if(void 0!==t)throw TypeError("Unexpected argument[1]: must be 'fetches' or 'options'.");for(let t of this.inputNames)if(void 0===e[t])throw Error(`input '${t}' is missing in 'feeds'.`);if(s)for(let e of this.outputNames)r[e]=null;let a=await this.handler.run(e,r,i),o={};for(let e in a)Object.hasOwnProperty.call(a,e)&&(o[e]=new g(a[e].type,a[e].data,a[e].dims));return o}static async create(e,t,n,r){let i;let s={};if("string"==typeof e){if(i=e,"object"==typeof t&&null!==t)s=t;else if(void 0!==t)throw TypeError("'options' must be an object.")}else if(e instanceof Uint8Array){if(i=e,"object"==typeof t&&null!==t)s=t;else if(void 0!==t)throw TypeError("'options' must be an object.")}else if(e instanceof ArrayBuffer||"undefined"!=typeof SharedArrayBuffer&&e instanceof SharedArrayBuffer){let a=e,o=0,l=e.byteLength;if("object"==typeof t&&null!==t)s=t;else if("number"==typeof t){if(!Number.isSafeInteger(o=t))throw RangeError("'byteOffset' must be an integer.");if(o<0||o>=a.byteLength)throw RangeError(`'byteOffset' is out of range [0, ${a.byteLength}).`);if(l=e.byteLength-o,"number"==typeof n){if(!Number.isSafeInteger(l=n))throw RangeError("'byteLength' must be an integer.");if(l<=0||o+l>a.byteLength)throw RangeError(`'byteLength' is out of range (0, ${a.byteLength-o}].`);if("object"==typeof r&&null!==r)s=r;else if(void 0!==r)throw TypeError("'options' must be an object.")}else if(void 0!==n)throw TypeError("'byteLength' must be a number.")}else if(void 0!==t)throw TypeError("'options' must be an object.");i=new Uint8Array(a,o,l)}else throw TypeError("Unexpected argument[0]: must be 'path' or 'buffer'.");let o=(s.executionProviders||[]).map(e=>"string"==typeof e?e:e.name),l=await a(o);return new m(await l.createSessionHandler(i,s))}startProfiling(){this.handler.startProfiling()}endProfiling(){this.handler.endProfiling()}get inputNames(){return this.handler.inputNames}get outputNames(){return this.handler.outputNames}}let y=m},250:(module,__unused_webpack_exports,__webpack_require__)=>{var process=__webpack_require__(7836);!function(e,t){module.exports=t(__webpack_require__(3251))}(self,__WEBPACK_EXTERNAL_MODULE__1670__=>(()=>{var __webpack_modules__={3474:(e,t,n)=>{var r,i=(r=(r="undefined"!=typeof document&&document.currentScript?document.currentScript.src:void 0)||"/index.js",function(e){function t(){return $.buffer!=D&&q($.buffer),F}function i(){return $.buffer!=D&&q($.buffer),P}function s(){return $.buffer!=D&&q($.buffer),M}function a(){return $.buffer!=D&&q($.buffer),L}function o(){return $.buffer!=D&&q($.buffer),z}e=e||{},l||(l=void 0!==e?e:{}),l.ready=new Promise(function(e,t){u=e,c=t});var l,u,c,h,d,p,f,g,m,y=Object.assign({},l),b="./this.program",v=(e,t)=>{throw t},w="object"==typeof window,_="function"==typeof importScripts,x="object"==typeof process&&"object"==typeof process.versions&&"string"==typeof process.versions.node,T=l.ENVIRONMENT_IS_PTHREAD||!1,I="";function k(e){return l.locateFile?l.locateFile(e,I):I+e}if(x){let e;I=_?n(908).dirname(I)+"/":"//",m=()=>{g||(f=n(1384),g=n(908))},h=function(e,t){return m(),e=g.normalize(e),f.readFileSync(e,t?void 0:"utf8")},p=e=>((e=h(e,!0)).buffer||(e=new Uint8Array(e)),e),d=(e,t,n)=>{m(),e=g.normalize(e),f.readFile(e,function(e,r){e?n(e):t(r.buffer)})},1<process.argv.length&&(b=process.argv[1].replace(/\\/g,"/")),process.argv.slice(2),process.on("uncaughtException",function(e){if(!(e instanceof eu))throw e}),process.on("unhandledRejection",function(e){throw e}),v=(e,t)=>{if(Z())throw process.exitCode=e,t;t instanceof eu||N("exiting due to exception: "+t),process.exit(e)},l.inspect=function(){return"[Emscripten Module object]"};try{e=n(9925)}catch(e){throw console.error('The "worker_threads" module is not supported in this node.js build - perhaps a newer version is needed?'),e}n.g.Worker=e.Worker}else(w||_)&&(_?I=self.location.href:"undefined"!=typeof document&&document.currentScript&&(I=document.currentScript.src),r&&(I=r),I=0!==I.indexOf("blob:")?I.substr(0,I.replace(/[?#].*/,"").lastIndexOf("/")+1):"",x||(h=e=>{var t=new XMLHttpRequest;return t.open("GET",e,!1),t.send(null),t.responseText},_&&(p=e=>{var t=new XMLHttpRequest;return t.open("GET",e,!1),t.responseType="arraybuffer",t.send(null),new Uint8Array(t.response)}),d=(e,t,n)=>{var r=new XMLHttpRequest;r.open("GET",e,!0),r.responseType="arraybuffer",r.onload=()=>{200==r.status||0==r.status&&r.response?t(r.response):n()},r.onerror=n,r.send(null)}));x&&"undefined"==typeof performance&&(n.g.performance=n(6953).performance);var S=console.log.bind(console),E=console.warn.bind(console);x&&(m(),S=e=>f.writeSync(1,e+"\n"),E=e=>f.writeSync(2,e+"\n"));var C,A=l.print||S,N=l.printErr||E;Object.assign(l,y),y=null,l.thisProgram&&(b=l.thisProgram),l.quit&&(v=l.quit),l.wasmBinary&&(C=l.wasmBinary);var O=l.noExitRuntime||!1;"object"!=typeof WebAssembly&&es("no native wasm support detected");var $,R,D,F,P,M,L,z,B=!1,U="undefined"!=typeof TextDecoder?new TextDecoder("utf8"):void 0;function V(e,t,n){var r=(t>>>=0)+n;for(n=t;e[n]&&!(n>=r);)++n;if(16<n-t&&e.buffer&&U)return U.decode(e.buffer instanceof SharedArrayBuffer?e.slice(t,n):e.subarray(t,n));for(r="";t<n;){var i=e[t++];if(128&i){var s=63&e[t++];if(192==(224&i))r+=String.fromCharCode((31&i)<<6|s);else{var a=63&e[t++];65536>(i=224==(240&i)?(15&i)<<12|s<<6|a:(7&i)<<18|s<<12|a<<6|63&e[t++])?r+=String.fromCharCode(i):(i-=65536,r+=String.fromCharCode(55296|i>>10,56320|1023&i))}}else r+=String.fromCharCode(i)}return r}function j(e,t){return(e>>>=0)?V(i(),e,t):""}function G(e,t,n,r){if(!(0<r))return 0;var i=n>>>=0;r=n+r-1;for(var s=0;s<e.length;++s){var a=e.charCodeAt(s);if(55296<=a&&57343>=a&&(a=65536+((1023&a)<<10)|1023&e.charCodeAt(++s)),127>=a){if(n>=r)break;t[n++>>>0]=a}else{if(2047>=a){if(n+1>=r)break;t[n++>>>0]=192|a>>6}else{if(65535>=a){if(n+2>=r)break;t[n++>>>0]=224|a>>12}else{if(n+3>=r)break;t[n++>>>0]=240|a>>18,t[n++>>>0]=128|a>>12&63}t[n++>>>0]=128|a>>6&63}t[n++>>>0]=128|63&a}}return t[n>>>0]=0,n-i}function W(e){for(var t=0,n=0;n<e.length;++n){var r=e.charCodeAt(n);127>=r?t++:2047>=r?t+=2:55296<=r&&57343>=r?(t+=4,++n):t+=3}return t}function q(e){D=e,l.HEAP8=F=new Int8Array(e),l.HEAP16=new Int16Array(e),l.HEAP32=M=new Int32Array(e),l.HEAPU8=P=new Uint8Array(e),l.HEAPU16=new Uint16Array(e),l.HEAPU32=L=new Uint32Array(e),l.HEAPF32=new Float32Array(e),l.HEAPF64=z=new Float64Array(e)}T&&(D=l.buffer);var H=l.INITIAL_MEMORY||0x1000000;if(T)$=l.wasmMemory,D=l.buffer;else if(l.wasmMemory)$=l.wasmMemory;else if(!(($=new WebAssembly.Memory({initial:H/65536,maximum:65536,shared:!0})).buffer instanceof SharedArrayBuffer))throw N("requested a shared WebAssembly.Memory but the returned buffer is not a SharedArrayBuffer, indicating that while the browser has SharedArrayBuffer it does not have WebAssembly threads support - you may need to set a flag"),x&&console.log("(on node you may need: --experimental-wasm-threads --experimental-wasm-bulk-memory and also use a recent version)"),Error("bad memory");$&&(D=$.buffer),H=D.byteLength,q(D);var K,X=[],Y=[],Q=[],J=[];function Z(){return O||!1}function ee(){var e=l.preRun.shift();X.unshift(e)}var et,en=0,er=null,ei=null;function es(e){throw T?postMessage({cmd:"onAbort",arg:e}):l.onAbort&&l.onAbort(e),N(e="Aborted("+e+")"),B=!0,e=new WebAssembly.RuntimeError(e+". Build with -sASSERTIONS for more info."),c(e),e}function ea(){return et.startsWith("data:application/octet-stream;base64,")}function eo(){var e=et;try{if(e==et&&C)return new Uint8Array(C);if(p)return p(e);throw"both async and sync fetching of the wasm failed"}catch(e){es(e)}}et="ort-wasm-threaded.wasm",ea()||(et=k(et));var el={};function eu(e){this.name="ExitStatus",this.message="Program terminated with exit("+e+")",this.status=e}function ec(e){(e=ef.Vb[e])||es(),ef.mc(e)}function eh(e){var t=ef.Cc();if(!t)return 6;ef.ac.push(t),ef.Vb[e.Ub]=t,t.Ub=e.Ub;var n={cmd:"run",start_routine:e.Ic,arg:e.zc,pthread_ptr:e.Ub};return t.$b=()=>{n.time=performance.now(),t.postMessage(n,e.Nc)},t.loaded&&(t.$b(),delete t.$b),0}function ed(e){if(T)return eK(1,1,e);Z()||(ef.oc(),l.onExit&&l.onExit(e),B=!0),v(e,new eu(e))}function ep(e,t){if(!t&&T)throw ey(e),"unwind";Z()||T||(tl(),eg(Q),to(0),e4[1].length&&e6(1,10),e4[2].length&&e6(2,10),ef.oc()),ed(e)}var ef={Yb:[],ac:[],qc:[],Vb:{},fc:function(){T&&ef.Ec()},Pc:function(){},Ec:function(){ef.receiveObjectTransfer=ef.Gc,ef.threadInitTLS=ef.pc,ef.setExitStatus=ef.nc,O=!1},nc:function(){},oc:function(){for(var e of Object.values(ef.Vb))ef.mc(e);for(e of ef.Yb)e.terminate();ef.Yb=[]},mc:function(e){var t=e.Ub;delete ef.Vb[t],ef.Yb.push(e),ef.ac.splice(ef.ac.indexOf(e),1),e.Ub=0,tp(t)},Gc:function(){},pc:function(){ef.qc.forEach(e=>e())},Fc:function(e,t){e.onmessage=n=>{var r=(n=n.data).cmd;if(e.Ub&&(ef.Bc=e.Ub),n.targetThread&&n.targetThread!=ti()){var i=ef.Vb[n.Qc];i?i.postMessage(n,n.transferList):N('Internal error! Worker sent a message "'+r+'" to target pthread '+n.targetThread+", but that thread no longer exists!")}else"processProxyingQueue"===r?eV(n.queue):"spawnThread"===r?eh(n):"cleanupThread"===r?ec(n.thread):"killThread"===r?(n=n.thread,r=ef.Vb[n],delete ef.Vb[n],r.terminate(),tp(n),ef.ac.splice(ef.ac.indexOf(r),1),r.Ub=0):"cancelThread"===r?ef.Vb[n.thread].postMessage({cmd:"cancel"}):"loaded"===r?(e.loaded=!0,t&&t(e),e.$b&&(e.$b(),delete e.$b)):"print"===r?A("Thread "+n.threadId+": "+n.text):"printErr"===r?N("Thread "+n.threadId+": "+n.text):"alert"===r?alert("Thread "+n.threadId+": "+n.text):"setimmediate"===n.target?e.postMessage(n):"onAbort"===r?l.onAbort&&l.onAbort(n.arg):r&&N("worker sent an unknown command "+r);ef.Bc=void 0},e.onerror=e=>{throw N("worker sent an error! "+e.filename+":"+e.lineno+": "+e.message),e},x&&(e.on("message",function(t){e.onmessage({data:t})}),e.on("error",function(t){e.onerror(t)}),e.on("detachedExit",function(){})),e.postMessage({cmd:"load",urlOrBlob:l.mainScriptUrlOrBlob||r,wasmMemory:$,wasmModule:R})},yc:function(){var e=k("ort-wasm-threaded.worker.js");ef.Yb.push(new Worker(e))},Cc:function(){return 0==ef.Yb.length&&(ef.yc(),ef.Fc(ef.Yb[0])),ef.Yb.pop()}};function eg(e){for(;0<e.length;)e.shift()(l)}function em(e){var t=ty();return e=e(),tb(t),e}function ey(e){if(T)return eK(2,0,e);try{ep(e)}catch(e){e instanceof eu||"unwind"==e||v(1,e)}}l.PThread=ef,l.establishStackSpace=function(){var e=ti(),t=s()[e+44>>2>>>0];e=s()[e+48>>2>>>0],tm(t,t-e),tb(t)};var eb=[];function ev(e){var t=eb[e];return t||(e>=eb.length&&(eb.length=e+1),eb[e]=t=K.get(e)),t}l.invokeEntryPoint=function(e,t){e=ev(e)(t),Z()?ef.nc(e):tf(e)};var ew,e_,ex=[],eT=0,eI=0;function ek(e){this.Zb=e,this.Sb=e-24,this.xc=function(e){a()[this.Sb+4>>2>>>0]=e},this.bc=function(){return a()[this.Sb+4>>2>>>0]},this.wc=function(e){a()[this.Sb+8>>2>>>0]=e},this.Dc=function(){return a()[this.Sb+8>>2>>>0]},this.rc=function(){s()[this.Sb>>2>>>0]=0},this.hc=function(e){e=e?1:0,t()[this.Sb+12>>0>>>0]=e},this.uc=function(){return 0!=t()[this.Sb+12>>0>>>0]},this.ic=function(e){e=e?1:0,t()[this.Sb+13>>0>>>0]=e},this.kc=function(){return 0!=t()[this.Sb+13>>0>>>0]},this.fc=function(e,t){this.cc(0),this.xc(e),this.wc(t),this.rc(),this.hc(!1),this.ic(!1)},this.sc=function(){Atomics.add(s(),this.Sb>>2,1)},this.Hc=function(){return 1===Atomics.sub(s(),this.Sb>>2,1)},this.cc=function(e){a()[this.Sb+16>>2>>>0]=e},this.tc=function(){return a()[this.Sb+16>>2>>>0]},this.vc=function(){if(t_(this.bc()))return a()[this.Zb>>2>>>0];var e=this.tc();return 0!==e?e:this.Zb}}function eS(e){return ta(new ek(e).Sb)}function eE(e,t,n,r){return T?eK(3,1,e,t,n,r):eC(e,t,n,r)}function eC(e,t,n,r){if("undefined"==typeof SharedArrayBuffer)return N("Current environment does not support SharedArrayBuffer, pthreads are not available!"),6;var i=[];return T&&0===i.length?eE(e,t,n,r):(e={Ic:n,Ub:e,zc:r,Nc:i},T?(e.Oc="spawnThread",postMessage(e,i),0):eh(e))}function eA(e,t,n){return T?eK(4,1,e,t,n):0}function eN(e,t){if(T)return eK(5,1,e,t)}function eO(e,t){if(T)return eK(6,1,e,t)}function e$(e,t,n){if(T)return eK(7,1,e,t,n)}function eR(e,t,n){return T?eK(8,1,e,t,n):0}function eD(e,t){if(T)return eK(9,1,e,t)}function eF(e,t,n){if(T)return eK(10,1,e,t,n)}function eP(e,t,n,r){if(T)return eK(11,1,e,t,n,r)}function eM(e,t,n,r){if(T)return eK(12,1,e,t,n,r)}function eL(e,t,n,r){if(T)return eK(13,1,e,t,n,r)}function ez(e){if(T)return eK(14,1,e)}function eB(e,t){if(T)return eK(15,1,e,t)}function eU(e,t,n){if(T)return eK(16,1,e,t,n)}function eV(e){Atomics.store(s(),e>>2,1),ti()&&td(e),Atomics.compareExchange(s(),e>>2,1,0)}function ej(e){return a()[e>>>2]+0x100000000*s()[e+4>>>2]}function eG(e,t,n,r,i,s){return T?eK(17,1,e,t,n,r,i,s):-52}function eW(e,t,n,r,i,s){if(T)return eK(18,1,e,t,n,r,i,s)}function eq(e){var n=W(e)+1,r=ts(n);return r&&G(e,t(),r,n),r}function eH(e,t,n){function r(e){return(e=e.toTimeString().match(/\(([A-Za-z ]+)\)$/))?e[1]:"GMT"}if(T)return eK(19,1,e,t,n);var i=(new Date).getFullYear(),o=new Date(i,0,1),l=new Date(i,6,1);i=o.getTimezoneOffset();var u=l.getTimezoneOffset(),c=Math.max(i,u);s()[e>>2>>>0]=60*c,s()[t>>2>>>0]=Number(i!=u),e=r(o),t=r(l),e=eq(e),t=eq(t),u<i?(a()[n>>2>>>0]=e,a()[n+4>>2>>>0]=t):(a()[n>>2>>>0]=t,a()[n+4>>2>>>0]=e)}function eK(e,t){var n=arguments.length-2,r=arguments;return em(()=>{for(var i=tv(8*n),s=i>>3,a=0;a<n;a++){var l=r[2+a];o()[s+a>>>0]=l}return th(e,n,i,t)})}l.executeNotifiedProxyingQueue=eV,e_=x?()=>{var e=process.hrtime();return 1e3*e[0]+e[1]/1e6}:T?()=>performance.now()-l.__performance_now_clock_drift:()=>performance.now();var eX,eY=[],eQ={};function eJ(){if(!eX){var e,t={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:("object"==typeof navigator&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",_:b||"./this.program"};for(e in eQ)void 0===eQ[e]?delete t[e]:t[e]=eQ[e];var n=[];for(e in t)n.push(e+"="+t[e]);eX=n}return eX}function eZ(e,n){if(T)return eK(20,1,e,n);var r=0;return eJ().forEach(function(i,s){var o=n+r;for(s=a()[e+4*s>>2>>>0]=o,o=0;o<i.length;++o)t()[s++>>0>>>0]=i.charCodeAt(o);t()[s>>0>>>0]=0,r+=i.length+1}),0}function e0(e,t){if(T)return eK(21,1,e,t);var n=eJ();a()[e>>2>>>0]=n.length;var r=0;return n.forEach(function(e){r+=e.length+1}),a()[t>>2>>>0]=r,0}function e1(e){return T?eK(22,1,e):52}function e2(e,t,n,r){return T?eK(23,1,e,t,n,r):52}function e3(e,t,n,r,i){return T?eK(24,1,e,t,n,r,i):70}var e4=[null,[],[]];function e6(e,t){var n=e4[e];0===t||10===t?((1===e?A:N)(V(n,0)),n.length=0):n.push(t)}function e5(e,t,n,r){if(T)return eK(25,1,e,t,n,r);for(var s=0,o=0;o<n;o++){var l=a()[t>>2>>>0],u=a()[t+4>>2>>>0];t+=8;for(var c=0;c<u;c++)e6(e,i()[l+c>>>0]);s+=u}return a()[r>>2>>>0]=s,0}var e8=0;function e7(e){return 0==e%4&&(0!=e%100||0==e%400)}var e9=[31,29,31,30,31,30,31,31,30,31,30,31],te=[31,28,31,30,31,30,31,31,30,31,30,31];function tt(e,n,r,i){function a(e,t,n){for(e="number"==typeof e?e.toString():e||"";e.length<t;)e=n[0]+e;return e}function o(e,t){return a(e,t,"0")}function l(e,t){var n;function r(e){return 0>e?-1:0<e?1:0}return 0===(n=r(e.getFullYear()-t.getFullYear()))&&0===(n=r(e.getMonth()-t.getMonth()))&&(n=r(e.getDate()-t.getDate())),n}function u(e){switch(e.getDay()){case 0:return new Date(e.getFullYear()-1,11,29);case 1:return e;case 2:return new Date(e.getFullYear(),0,3);case 3:return new Date(e.getFullYear(),0,2);case 4:return new Date(e.getFullYear(),0,1);case 5:return new Date(e.getFullYear()-1,11,31);case 6:return new Date(e.getFullYear()-1,11,30)}}function c(e){var t=e.Wb;for(e=new Date(new Date(e.Xb+1900,0,1).getTime());0<t;){var n=e.getMonth(),r=(e7(e.getFullYear())?e9:te)[n];if(!(t>r-e.getDate())){e.setDate(e.getDate()+t);break}t-=r-e.getDate()+1,e.setDate(1),11>n?e.setMonth(n+1):(e.setMonth(0),e.setFullYear(e.getFullYear()+1))}return n=new Date(e.getFullYear()+1,0,4),t=u(new Date(e.getFullYear(),0,4)),n=u(n),0>=l(t,e)?0>=l(n,e)?e.getFullYear()+1:e.getFullYear():e.getFullYear()-1}var h=s()[i+40>>2>>>0];for(var d in i={Lc:s()[i>>2>>>0],Kc:s()[i+4>>2>>>0],dc:s()[i+8>>2>>>0],jc:s()[i+12>>2>>>0],ec:s()[i+16>>2>>>0],Xb:s()[i+20>>2>>>0],Tb:s()[i+24>>2>>>0],Wb:s()[i+28>>2>>>0],Rc:s()[i+32>>2>>>0],Jc:s()[i+36>>2>>>0],Mc:h?j(h):""},r=j(r),h={"%c":"%a %b %d %H:%M:%S %Y","%D":"%m/%d/%y","%F":"%Y-%m-%d","%h":"%b","%r":"%I:%M:%S %p","%R":"%H:%M","%T":"%H:%M:%S","%x":"%m/%d/%y","%X":"%H:%M:%S","%Ec":"%c","%EC":"%C","%Ex":"%m/%d/%y","%EX":"%H:%M:%S","%Ey":"%y","%EY":"%Y","%Od":"%d","%Oe":"%e","%OH":"%H","%OI":"%I","%Om":"%m","%OM":"%M","%OS":"%S","%Ou":"%u","%OU":"%U","%OV":"%V","%Ow":"%w","%OW":"%W","%Oy":"%y"})r=r.replace(RegExp(d,"g"),h[d]);var p="Sunday Monday Tuesday Wednesday Thursday Friday Saturday".split(" "),f="January February March April May June July August September October November December".split(" ");for(d in h={"%a":function(e){return p[e.Tb].substring(0,3)},"%A":function(e){return p[e.Tb]},"%b":function(e){return f[e.ec].substring(0,3)},"%B":function(e){return f[e.ec]},"%C":function(e){return o((e.Xb+1900)/100|0,2)},"%d":function(e){return o(e.jc,2)},"%e":function(e){return a(e.jc,2," ")},"%g":function(e){return c(e).toString().substring(2)},"%G":function(e){return c(e)},"%H":function(e){return o(e.dc,2)},"%I":function(e){return 0==(e=e.dc)?e=12:12<e&&(e-=12),o(e,2)},"%j":function(e){for(var t=0,n=0;n<=e.ec-1;t+=(e7(e.Xb+1900)?e9:te)[n++]);return o(e.jc+t,3)},"%m":function(e){return o(e.ec+1,2)},"%M":function(e){return o(e.Kc,2)},"%n":function(){return"\n"},"%p":function(e){return 0<=e.dc&&12>e.dc?"AM":"PM"},"%S":function(e){return o(e.Lc,2)},"%t":function(){return"	"},"%u":function(e){return e.Tb||7},"%U":function(e){return o(Math.floor((e.Wb+7-e.Tb)/7),2)},"%V":function(e){var t=Math.floor((e.Wb+7-(e.Tb+6)%7)/7);if(2>=(e.Tb+371-e.Wb-2)%7&&t++,t)53==t&&(4==(n=(e.Tb+371-e.Wb)%7)||3==n&&e7(e.Xb)||(t=1));else{t=52;var n=(e.Tb+7-e.Wb-1)%7;(4==n||5==n&&e7(e.Xb%400-1))&&t++}return o(t,2)},"%w":function(e){return e.Tb},"%W":function(e){return o(Math.floor((e.Wb+7-(e.Tb+6)%7)/7),2)},"%y":function(e){return(e.Xb+1900).toString().substring(2)},"%Y":function(e){return e.Xb+1900},"%z":function(e){var t=0<=(e=e.Jc);return(t?"+":"-")+String("0000"+((e=Math.abs(e)/60)/60*100+e%60)).slice(-4)},"%Z":function(e){return e.Mc},"%%":function(){return"%"}},r=r.replace(/%%/g,"\0\0"),h)r.includes(d)&&(r=r.replace(RegExp(d,"g"),h[d](i)));return(d=function(e){var t=Array(W(e)+1);return G(e,t,0,t.length),t}(r=r.replace(/\0\0/g,"%"))).length>n?0:(function(e,n){t().set(e,n>>>0)}(d,e),d.length-1)}ef.fc();var tn=[null,ed,ey,eE,eA,eN,eO,e$,eR,eD,eF,eP,eM,eL,ez,eB,eU,eG,eW,eH,eZ,e0,e1,e2,e3,e5],tr={b:function(e){return ts(e+24)+24},n:function(e){return(e=new ek(e)).uc()||(e.hc(!0),eT--),e.ic(!1),ex.push(e),e.sc(),e.vc()},ma:function(e){throw N("Unexpected exception thrown, this is not properly supported - aborting"),B=!0,e},x:function(){tg(0);var e=ex.pop();if(e.Hc()&&!e.kc()){var t=e.Dc();t&&ev(t)(e.Zb),eS(e.Zb)}eI=0},e:function(){var e=eI;if(!e)return e8=0;var t=new ek(e);t.cc(e);var n=t.bc();if(!n)return e8=0,e;for(var r=Array.prototype.slice.call(arguments),i=0;i<r.length;i++){var s=r[i];if(0===s||s===n)break;if(tw(s,n,t.Sb+16))return e8=s,e}return e8=n,e},l:function(){var e=eI;if(!e)return e8=0;var t=new ek(e);t.cc(e);var n=t.bc();if(!n)return e8=0,e;for(var r=Array.prototype.slice.call(arguments),i=0;i<r.length;i++){var s=r[i];if(0===s||s===n)break;if(tw(s,n,t.Sb+16))return e8=s,e}return e8=n,e},h:function(){var e=eI;if(!e)return e8=0;var t=new ek(e);t.cc(e);var n=t.bc();if(!n)return e8=0,e;for(var r=Array.prototype.slice.call(arguments),i=0;i<r.length;i++){var s=r[i];if(0===s||s===n)break;if(tw(s,n,t.Sb+16))return e8=s,e}return e8=n,e},t:eS,M:function(){var e=ex.pop();e||es("no exception to throw");var t=e.Zb;throw e.kc()||(ex.push(e),e.ic(!0),e.hc(!1),eT++),eI=t,t},c:function(e,t,n){throw new ek(e).fc(t,n),eI=e,eT++,e},pa:function(){return eT},Fa:function(e){tu(e,!_,1,!w),ef.pc()},T:function(e){T?postMessage({cmd:"cleanupThread",thread:e}):ec(e)},xa:eC,j:function(e){throw eI||(eI=e),e},H:eA,Ma:eN,ua:eO,wa:e$,oa:eR,Ka:eD,Ca:eF,Ja:eP,V:eM,va:eL,sa:ez,La:eB,ta:eU,Ta:function(){},X:function(){es("To use dlopen, you need enable dynamic linking, see https://github.com/emscripten-core/emscripten/wiki/Linking")},Ua:function(){es("To use dlopen, you need enable dynamic linking, see https://github.com/emscripten-core/emscripten/wiki/Linking")},W:function(){return Date.now()},ya:function(){return 2097152},Oa:function(){return!0},za:function(e,t,n,r){if(e==t)setTimeout(()=>eV(r));else if(T)postMessage({targetThread:e,cmd:"processProxyingQueue",queue:r});else{if(!(e=ef.Vb[e]))return;e.postMessage({cmd:"processProxyingQueue",queue:r})}return 1},Ea:function(){return -1},Pa:function(e,t){e=new Date(1e3*ej(e)),s()[t>>2>>>0]=e.getUTCSeconds(),s()[t+4>>2>>>0]=e.getUTCMinutes(),s()[t+8>>2>>>0]=e.getUTCHours(),s()[t+12>>2>>>0]=e.getUTCDate(),s()[t+16>>2>>>0]=e.getUTCMonth(),s()[t+20>>2>>>0]=e.getUTCFullYear()-1900,s()[t+24>>2>>>0]=e.getUTCDay(),e=(e.getTime()-Date.UTC(e.getUTCFullYear(),0,1,0,0,0,0))/864e5|0,s()[t+28>>2>>>0]=e},Qa:function(e,t){e=new Date(1e3*ej(e)),s()[t>>2>>>0]=e.getSeconds(),s()[t+4>>2>>>0]=e.getMinutes(),s()[t+8>>2>>>0]=e.getHours(),s()[t+12>>2>>>0]=e.getDate(),s()[t+16>>2>>>0]=e.getMonth(),s()[t+20>>2>>>0]=e.getFullYear()-1900,s()[t+24>>2>>>0]=e.getDay();var n=new Date(e.getFullYear(),0,1),r=(e.getTime()-n.getTime())/864e5|0;s()[t+28>>2>>>0]=r,s()[t+36>>2>>>0]=-60*e.getTimezoneOffset(),e=0|((r=new Date(e.getFullYear(),6,1).getTimezoneOffset())!=(n=n.getTimezoneOffset())&&e.getTimezoneOffset()==Math.min(n,r)),s()[t+32>>2>>>0]=e},Ra:function(e){var t=new Date(s()[e+20>>2>>>0]+1900,s()[e+16>>2>>>0],s()[e+12>>2>>>0],s()[e+8>>2>>>0],s()[e+4>>2>>>0],s()[e>>2>>>0],0),n=s()[e+32>>2>>>0],r=t.getTimezoneOffset(),i=new Date(t.getFullYear(),0,1),a=new Date(t.getFullYear(),6,1).getTimezoneOffset(),o=i.getTimezoneOffset(),l=Math.min(o,a);return 0>n?s()[e+32>>2>>>0]=Number(a!=o&&l==r):0<n!=(l==r)&&(a=Math.max(o,a),t.setTime(t.getTime()+6e4*((0<n?l:a)-r))),s()[e+24>>2>>>0]=t.getDay(),n=(t.getTime()-i.getTime())/864e5|0,s()[e+28>>2>>>0]=n,s()[e>>2>>>0]=t.getSeconds(),s()[e+4>>2>>>0]=t.getMinutes(),s()[e+8>>2>>>0]=t.getHours(),s()[e+12>>2>>>0]=t.getDate(),s()[e+16>>2>>>0]=t.getMonth(),t.getTime()/1e3|0},Aa:eG,Ba:eW,Sa:function e(t,n,r){e.Ac||(e.Ac=!0,eH(t,n,r))},y:function(){es("")},U:function(){if(!x&&!_){var e="Blocking on the main thread is very dangerous, see https://emscripten.org/docs/porting/pthreads.html#blocking-on-the-main-browser-thread";ew||(ew={}),ew[e]||(ew[e]=1,x&&(e="warning: "+e),N(e))}},ra:function(){return 0xffff0000},B:e_,Ia:function(e,t,n){i().copyWithin(e>>>0,t>>>0,t+n>>>0)},F:function(){return x?n(3993).cpus().length:navigator.hardwareConcurrency},Da:function(e,t,n){eY.length=t,n>>=3;for(var r=0;r<t;r++)eY[r]=o()[n+r>>>0];return(0>e?el[-e-1]:tn[e]).apply(null,eY)},qa:function(e){var t=i().length;if((e>>>=0)<=t||0xffff0000<e)return!1;for(var n=1;4>=n;n*=2){var r=t*(1+.2/n);r=Math.min(r,e+0x6000000);var s=Math;r=Math.max(e,r),s=s.min.call(s,0xffff0000,r+(65536-r%65536)%65536);e:{try{$.grow(s-D.byteLength+65535>>>16),q($.buffer);var a=1;break e}catch(e){}a=void 0}if(a)return!0}return!1},Na:function(){throw"unwind"},Ga:eZ,Ha:e0,J:ep,I:e1,S:e2,ga:e3,R:e5,d:function(){return e8},na:function e(r,i){e.lc||(e.lc=function(){if("object"==typeof crypto&&"function"==typeof crypto.getRandomValues){var e=new Uint8Array(1);return()=>(crypto.getRandomValues(e),e[0])}if(x)try{var t=n(Object(function(){var e=Error("Cannot find module 'crypto'");throw e.code="MODULE_NOT_FOUND",e}()));return()=>t.randomBytes(1)[0]}catch(e){}return()=>es("randomDevice")}());for(var s=0;s<i;s++)t()[r+s>>0>>>0]=e.lc();return 0},ia:function(e,t,n){var r=ty();try{return ev(e)(t,n)}catch(e){if(tb(r),e!==e+0)throw e;tg(1,0)}},ja:function(e,t,n){var r=ty();try{return ev(e)(t,n)}catch(e){if(tb(r),e!==e+0)throw e;tg(1,0)}},K:function(e){var t=ty();try{return ev(e)()}catch(e){if(tb(t),e!==e+0)throw e;tg(1,0)}},f:function(e,t){var n=ty();try{return ev(e)(t)}catch(e){if(tb(n),e!==e+0)throw e;tg(1,0)}},P:function(e,t,n){var r=ty();try{return ev(e)(t,n)}catch(e){if(tb(r),e!==e+0)throw e;tg(1,0)}},Q:function(e,t,n){var r=ty();try{return ev(e)(t,n)}catch(e){if(tb(r),e!==e+0)throw e;tg(1,0)}},k:function(e,t,n){var r=ty();try{return ev(e)(t,n)}catch(e){if(tb(r),e!==e+0)throw e;tg(1,0)}},p:function(e,t,n,r){var i=ty();try{return ev(e)(t,n,r)}catch(e){if(tb(i),e!==e+0)throw e;tg(1,0)}},q:function(e,t,n,r,i){var s=ty();try{return ev(e)(t,n,r,i)}catch(e){if(tb(s),e!==e+0)throw e;tg(1,0)}},N:function(e,t,n,r,i,s){var a=ty();try{return ev(e)(t,n,r,i,s)}catch(e){if(tb(a),e!==e+0)throw e;tg(1,0)}},s:function(e,t,n,r,i,s){var a=ty();try{return ev(e)(t,n,r,i,s)}catch(e){if(tb(a),e!==e+0)throw e;tg(1,0)}},w:function(e,t,n,r,i,s,a){var o=ty();try{return ev(e)(t,n,r,i,s,a)}catch(e){if(tb(o),e!==e+0)throw e;tg(1,0)}},L:function(e,t,n,r,i,s,a,o){var l=ty();try{return ev(e)(t,n,r,i,s,a,o)}catch(e){if(tb(l),e!==e+0)throw e;tg(1,0)}},E:function(e,t,n,r,i,s,a,o,l,u,c,h){var d=ty();try{return ev(e)(t,n,r,i,s,a,o,l,u,c,h)}catch(e){if(tb(d),e!==e+0)throw e;tg(1,0)}},aa:function(e,t,n,r,i,s,a,o){var l=ty();try{return tN(e,t,n,r,i,s,a,o)}catch(e){if(tb(l),e!==e+0)throw e;tg(1,0)}},_:function(e,t,n,r,i,s,a){var o=ty();try{return tT(e,t,n,r,i,s,a)}catch(e){if(tb(o),e!==e+0)throw e;tg(1,0)}},Z:function(e,t,n,r,i){var s=ty();try{return tO(e,t,n,r,i)}catch(e){if(tb(s),e!==e+0)throw e;tg(1,0)}},ca:function(e,t,n,r){var i=ty();try{return tC(e,t,n,r)}catch(e){if(tb(i),e!==e+0)throw e;tg(1,0)}},$:function(e){var t=ty();try{return tx(e)}catch(e){if(tb(t),e!==e+0)throw e;tg(1,0)}},ba:function(e,t){var n=ty();try{return tA(e,t)}catch(e){if(tb(n),e!==e+0)throw e;tg(1,0)}},Y:function(e,t,n){var r=ty();try{return tI(e,t,n)}catch(e){if(tb(r),e!==e+0)throw e;tg(1,0)}},g:function(e){var t=ty();try{ev(e)()}catch(e){if(tb(t),e!==e+0)throw e;tg(1,0)}},r:function(e,t){var n=ty();try{ev(e)(t)}catch(e){if(tb(n),e!==e+0)throw e;tg(1,0)}},i:function(e,t,n){var r=ty();try{ev(e)(t,n)}catch(e){if(tb(r),e!==e+0)throw e;tg(1,0)}},ha:function(e,t,n,r){var i=ty();try{ev(e)(t,n,r)}catch(e){if(tb(i),e!==e+0)throw e;tg(1,0)}},m:function(e,t,n,r){var i=ty();try{ev(e)(t,n,r)}catch(e){if(tb(i),e!==e+0)throw e;tg(1,0)}},v:function(e,t,n,r,i){var s=ty();try{ev(e)(t,n,r,i)}catch(e){if(tb(s),e!==e+0)throw e;tg(1,0)}},u:function(e,t,n,r,i,s){var a=ty();try{ev(e)(t,n,r,i,s)}catch(e){if(tb(a),e!==e+0)throw e;tg(1,0)}},O:function(e,t,n,r,i,s,a){var o=ty();try{ev(e)(t,n,r,i,s,a)}catch(e){if(tb(o),e!==e+0)throw e;tg(1,0)}},A:function(e,t,n,r,i,s,a,o){var l=ty();try{ev(e)(t,n,r,i,s,a,o)}catch(e){if(tb(l),e!==e+0)throw e;tg(1,0)}},ka:function(e,t,n,r,i,s,a,o,l){var u=ty();try{ev(e)(t,n,r,i,s,a,o,l)}catch(e){if(tb(u),e!==e+0)throw e;tg(1,0)}},C:function(e,t,n,r,i,s,a,o,l,u,c){var h=ty();try{ev(e)(t,n,r,i,s,a,o,l,u,c)}catch(e){if(tb(h),e!==e+0)throw e;tg(1,0)}},D:function(e,t,n,r,i,s,a,o,l,u,c,h,d,p,f,g){var m=ty();try{ev(e)(t,n,r,i,s,a,o,l,u,c,h,d,p,f,g)}catch(e){if(tb(m),e!==e+0)throw e;tg(1,0)}},fa:function(e,t,n,r,i,s,a,o){var l=ty();try{tk(e,t,n,r,i,s,a,o)}catch(e){if(tb(l),e!==e+0)throw e;tg(1,0)}},da:function(e,t,n,r,i,s,a,o,l,u,c,h){var d=ty();try{tE(e,t,n,r,i,s,a,o,l,u,c,h)}catch(e){if(tb(d),e!==e+0)throw e;tg(1,0)}},ea:function(e,t,n,r,i,s){var a=ty();try{tS(e,t,n,r,i,s)}catch(e){if(tb(a),e!==e+0)throw e;tg(1,0)}},o:function(e){return e},a:$||l.wasmMemory,G:function(e){e8=e},la:tt,z:function(e,t,n,r){return tt(e,t,n,r)}};(function(){function e(e,t){l.asm=e.exports,ef.qc.push(l.asm.sb),K=l.asm.ub,Y.unshift(l.asm.Va),R=t,T||(en--,l.monitorRunDependencies&&l.monitorRunDependencies(en),0==en&&(null!==er&&(clearInterval(er),er=null),ei&&(e=ei,ei=null,e())))}function t(t){e(t.instance,t.module)}function n(e){return(function(){if(!C&&(w||_)){if("function"==typeof fetch&&!et.startsWith("file://"))return fetch(et,{credentials:"same-origin"}).then(function(e){if(!e.ok)throw"failed to load wasm binary file at '"+et+"'";return e.arrayBuffer()}).catch(function(){return eo()});if(d)return new Promise(function(e,t){d(et,function(t){e(new Uint8Array(t))},t)})}return Promise.resolve().then(function(){return eo()})})().then(function(e){return WebAssembly.instantiate(e,r)}).then(function(e){return e}).then(e,function(e){N("failed to asynchronously prepare wasm: "+e),es(e)})}var r={a:tr};if(T||(en++,l.monitorRunDependencies&&l.monitorRunDependencies(en)),l.instantiateWasm)try{return l.instantiateWasm(r,e)}catch(e){return N("Module.instantiateWasm callback failed with error: "+e),!1}(C||"function"!=typeof WebAssembly.instantiateStreaming||ea()||et.startsWith("file://")||x||"function"!=typeof fetch?n(t):fetch(et,{credentials:"same-origin"}).then(function(e){return WebAssembly.instantiateStreaming(e,r).then(t,function(e){return N("wasm streaming compile failed: "+e),N("falling back to ArrayBuffer instantiation"),n(t)})})).catch(c)})(),l.___wasm_call_ctors=function(){return(l.___wasm_call_ctors=l.asm.Va).apply(null,arguments)},l._OrtInit=function(){return(l._OrtInit=l.asm.Wa).apply(null,arguments)},l._OrtCreateSessionOptions=function(){return(l._OrtCreateSessionOptions=l.asm.Xa).apply(null,arguments)},l._OrtAppendExecutionProvider=function(){return(l._OrtAppendExecutionProvider=l.asm.Ya).apply(null,arguments)},l._OrtAddSessionConfigEntry=function(){return(l._OrtAddSessionConfigEntry=l.asm.Za).apply(null,arguments)},l._OrtReleaseSessionOptions=function(){return(l._OrtReleaseSessionOptions=l.asm._a).apply(null,arguments)},l._OrtCreateSession=function(){return(l._OrtCreateSession=l.asm.$a).apply(null,arguments)},l._OrtReleaseSession=function(){return(l._OrtReleaseSession=l.asm.ab).apply(null,arguments)},l._OrtGetInputCount=function(){return(l._OrtGetInputCount=l.asm.bb).apply(null,arguments)},l._OrtGetOutputCount=function(){return(l._OrtGetOutputCount=l.asm.cb).apply(null,arguments)},l._OrtGetInputName=function(){return(l._OrtGetInputName=l.asm.db).apply(null,arguments)},l._OrtGetOutputName=function(){return(l._OrtGetOutputName=l.asm.eb).apply(null,arguments)},l._OrtFree=function(){return(l._OrtFree=l.asm.fb).apply(null,arguments)},l._OrtCreateTensor=function(){return(l._OrtCreateTensor=l.asm.gb).apply(null,arguments)},l._OrtGetTensorData=function(){return(l._OrtGetTensorData=l.asm.hb).apply(null,arguments)},l._OrtReleaseTensor=function(){return(l._OrtReleaseTensor=l.asm.ib).apply(null,arguments)},l._OrtCreateRunOptions=function(){return(l._OrtCreateRunOptions=l.asm.jb).apply(null,arguments)},l._OrtAddRunConfigEntry=function(){return(l._OrtAddRunConfigEntry=l.asm.kb).apply(null,arguments)},l._OrtReleaseRunOptions=function(){return(l._OrtReleaseRunOptions=l.asm.lb).apply(null,arguments)},l._OrtRun=function(){return(l._OrtRun=l.asm.mb).apply(null,arguments)},l._OrtEndProfiling=function(){return(l._OrtEndProfiling=l.asm.nb).apply(null,arguments)};var ti=l._pthread_self=function(){return(ti=l._pthread_self=l.asm.ob).apply(null,arguments)},ts=l._malloc=function(){return(ts=l._malloc=l.asm.pb).apply(null,arguments)},ta=l._free=function(){return(ta=l._free=l.asm.qb).apply(null,arguments)},to=l._fflush=function(){return(to=l._fflush=l.asm.rb).apply(null,arguments)};l.__emscripten_tls_init=function(){return(l.__emscripten_tls_init=l.asm.sb).apply(null,arguments)};var tl=l.___funcs_on_exit=function(){return(tl=l.___funcs_on_exit=l.asm.tb).apply(null,arguments)},tu=l.__emscripten_thread_init=function(){return(tu=l.__emscripten_thread_init=l.asm.vb).apply(null,arguments)};l.__emscripten_thread_crashed=function(){return(l.__emscripten_thread_crashed=l.asm.wb).apply(null,arguments)};var tc,th=l._emscripten_run_in_main_runtime_thread_js=function(){return(th=l._emscripten_run_in_main_runtime_thread_js=l.asm.xb).apply(null,arguments)},td=l.__emscripten_proxy_execute_task_queue=function(){return(td=l.__emscripten_proxy_execute_task_queue=l.asm.yb).apply(null,arguments)},tp=l.__emscripten_thread_free_data=function(){return(tp=l.__emscripten_thread_free_data=l.asm.zb).apply(null,arguments)},tf=l.__emscripten_thread_exit=function(){return(tf=l.__emscripten_thread_exit=l.asm.Ab).apply(null,arguments)},tg=l._setThrew=function(){return(tg=l._setThrew=l.asm.Bb).apply(null,arguments)},tm=l._emscripten_stack_set_limits=function(){return(tm=l._emscripten_stack_set_limits=l.asm.Cb).apply(null,arguments)},ty=l.stackSave=function(){return(ty=l.stackSave=l.asm.Db).apply(null,arguments)},tb=l.stackRestore=function(){return(tb=l.stackRestore=l.asm.Eb).apply(null,arguments)},tv=l.stackAlloc=function(){return(tv=l.stackAlloc=l.asm.Fb).apply(null,arguments)},tw=l.___cxa_can_catch=function(){return(tw=l.___cxa_can_catch=l.asm.Gb).apply(null,arguments)},t_=l.___cxa_is_pointer_type=function(){return(t_=l.___cxa_is_pointer_type=l.asm.Hb).apply(null,arguments)},tx=l.dynCall_j=function(){return(tx=l.dynCall_j=l.asm.Ib).apply(null,arguments)},tT=l.dynCall_iiiiij=function(){return(tT=l.dynCall_iiiiij=l.asm.Jb).apply(null,arguments)},tI=l.dynCall_jii=function(){return(tI=l.dynCall_jii=l.asm.Kb).apply(null,arguments)},tk=l.dynCall_viiiiij=function(){return(tk=l.dynCall_viiiiij=l.asm.Lb).apply(null,arguments)},tS=l.dynCall_vjji=function(){return(tS=l.dynCall_vjji=l.asm.Mb).apply(null,arguments)},tE=l.dynCall_viiijjjii=function(){return(tE=l.dynCall_viiijjjii=l.asm.Nb).apply(null,arguments)},tC=l.dynCall_iij=function(){return(tC=l.dynCall_iij=l.asm.Ob).apply(null,arguments)},tA=l.dynCall_ji=function(){return(tA=l.dynCall_ji=l.asm.Pb).apply(null,arguments)},tN=l.dynCall_iiiiiij=function(){return(tN=l.dynCall_iiiiiij=l.asm.Qb).apply(null,arguments)},tO=l.dynCall_iiij=function(){return(tO=l.dynCall_iiij=l.asm.Rb).apply(null,arguments)};function t$(){function e(){if(!tc&&(tc=!0,l.calledRun=!0,!B)&&(T||eg(Y),u(l),l.onRuntimeInitialized&&l.onRuntimeInitialized(),!T)){if(l.postRun)for("function"==typeof l.postRun&&(l.postRun=[l.postRun]);l.postRun.length;){var e=l.postRun.shift();J.unshift(e)}eg(J)}}if(!(0<en)){if(T)u(l),T||eg(Y),postMessage({cmd:"loaded"});else{if(l.preRun)for("function"==typeof l.preRun&&(l.preRun=[l.preRun]);l.preRun.length;)ee();eg(X),0<en||(l.setStatus?(l.setStatus("Running..."),setTimeout(function(){setTimeout(function(){l.setStatus("")},1),e()},1)):e())}}}if(l.UTF8ToString=j,l.stringToUTF8=function(e,t,n){return G(e,i(),t,n)},l.lengthBytesUTF8=W,l.keepRuntimeAlive=Z,l.wasmMemory=$,l.stackSave=ty,l.stackRestore=tb,l.stackAlloc=tv,l.ExitStatus=eu,l.PThread=ef,ei=function e(){tc||t$(),tc||(ei=e)},l.preInit)for("function"==typeof l.preInit&&(l.preInit=[l.preInit]);0<l.preInit.length;)l.preInit.pop()();return t$(),e.ready});e.exports=i},932:(e,t,n)=>{var r,i=(r=(r="undefined"!=typeof document&&document.currentScript?document.currentScript.src:void 0)||"/index.js",function(e){e=e||{},t||(t=void 0!==e?e:{}),t.ready=new Promise(function(e,t){i=e,s=t});var t,i,s,a,o,l,u,c,h,d=Object.assign({},t),p="./this.program",f=(e,t)=>{throw t},g="object"==typeof window,m="function"==typeof importScripts,y="object"==typeof process&&"object"==typeof process.versions&&"string"==typeof process.versions.node,b="";y?(b=m?n(908).dirname(b)+"/":"//",h=()=>{c||(u=n(1384),c=n(908))},a=function(e,t){return h(),e=c.normalize(e),u.readFileSync(e,t?void 0:"utf8")},l=e=>((e=a(e,!0)).buffer||(e=new Uint8Array(e)),e),o=(e,t,n)=>{h(),e=c.normalize(e),u.readFile(e,function(e,r){e?n(e):t(r.buffer)})},1<process.argv.length&&(p=process.argv[1].replace(/\\/g,"/")),process.argv.slice(2),process.on("uncaughtException",function(e){if(!(e instanceof Q))throw e}),process.on("unhandledRejection",function(e){throw e}),f=(e,t)=>{if(x||0<U)throw process.exitCode=e,t;t instanceof Q||_("exiting due to exception: "+t),process.exit(e)},t.inspect=function(){return"[Emscripten Module object]"}):(g||m)&&(m?b=self.location.href:"undefined"!=typeof document&&document.currentScript&&(b=document.currentScript.src),r&&(b=r),b=0!==b.indexOf("blob:")?b.substr(0,b.replace(/[?#].*/,"").lastIndexOf("/")+1):"",a=e=>{var t=new XMLHttpRequest;return t.open("GET",e,!1),t.send(null),t.responseText},m&&(l=e=>{var t=new XMLHttpRequest;return t.open("GET",e,!1),t.responseType="arraybuffer",t.send(null),new Uint8Array(t.response)}),o=(e,t,n)=>{var r=new XMLHttpRequest;r.open("GET",e,!0),r.responseType="arraybuffer",r.onload=()=>{200==r.status||0==r.status&&r.response?t(r.response):n()},r.onerror=n,r.send(null)});var v,w=t.print||console.log.bind(console),_=t.printErr||console.warn.bind(console);Object.assign(t,d),d=null,t.thisProgram&&(p=t.thisProgram),t.quit&&(f=t.quit),t.wasmBinary&&(v=t.wasmBinary);var x=t.noExitRuntime||!1;"object"!=typeof WebAssembly&&H("no native wasm support detected");var T,I,k,S,E,C,A=!1,N="undefined"!=typeof TextDecoder?new TextDecoder("utf8"):void 0;function O(e,t,n){var r=(t>>>=0)+n;for(n=t;e[n]&&!(n>=r);)++n;if(16<n-t&&e.buffer&&N)return N.decode(e.subarray(t,n));for(r="";t<n;){var i=e[t++];if(128&i){var s=63&e[t++];if(192==(224&i))r+=String.fromCharCode((31&i)<<6|s);else{var a=63&e[t++];65536>(i=224==(240&i)?(15&i)<<12|s<<6|a:(7&i)<<18|s<<12|a<<6|63&e[t++])?r+=String.fromCharCode(i):(i-=65536,r+=String.fromCharCode(55296|i>>10,56320|1023&i))}}else r+=String.fromCharCode(i)}return r}function $(e,t){return(e>>>=0)?O(S,e,t):""}function R(e,t,n,r){if(!(0<r))return 0;var i=n>>>=0;r=n+r-1;for(var s=0;s<e.length;++s){var a=e.charCodeAt(s);if(55296<=a&&57343>=a&&(a=65536+((1023&a)<<10)|1023&e.charCodeAt(++s)),127>=a){if(n>=r)break;t[n++>>>0]=a}else{if(2047>=a){if(n+1>=r)break;t[n++>>>0]=192|a>>6}else{if(65535>=a){if(n+2>=r)break;t[n++>>>0]=224|a>>12}else{if(n+3>=r)break;t[n++>>>0]=240|a>>18,t[n++>>>0]=128|a>>12&63}t[n++>>>0]=128|a>>6&63}t[n++>>>0]=128|63&a}}return t[n>>>0]=0,n-i}function D(e){for(var t=0,n=0;n<e.length;++n){var r=e.charCodeAt(n);127>=r?t++:2047>=r?t+=2:55296<=r&&57343>=r?(t+=4,++n):t+=3}return t}function F(){var e=T.buffer;I=e,t.HEAP8=k=new Int8Array(e),t.HEAP16=new Int16Array(e),t.HEAP32=E=new Int32Array(e),t.HEAPU8=S=new Uint8Array(e),t.HEAPU16=new Uint16Array(e),t.HEAPU32=C=new Uint32Array(e),t.HEAPF32=new Float32Array(e),t.HEAPF64=new Float64Array(e)}var P,M=[],L=[],z=[],B=[],U=0;function V(){var e=t.preRun.shift();M.unshift(e)}var j,G=0,W=null,q=null;function H(e){throw t.onAbort&&t.onAbort(e),_(e="Aborted("+e+")"),A=!0,e=new WebAssembly.RuntimeError(e+". Build with -sASSERTIONS for more info."),s(e),e}function K(){return j.startsWith("data:application/octet-stream;base64,")}if(j="ort-wasm.wasm",!K()){var X=j;j=t.locateFile?t.locateFile(X,b):b+X}function Y(){var e=j;try{if(e==j&&v)return new Uint8Array(v);if(l)return l(e);throw"both async and sync fetching of the wasm failed"}catch(e){H(e)}}function Q(e){this.name="ExitStatus",this.message="Program terminated with exit("+e+")",this.status=e}function J(e){for(;0<e.length;)e.shift()(t)}var Z=[],ee=0,et=0;function en(e){this.Db=e,this.zb=e-24,this.Ub=function(e){C[this.zb+4>>2>>>0]=e},this.Eb=function(){return C[this.zb+4>>2>>>0]},this.Sb=function(e){C[this.zb+8>>2>>>0]=e},this.Wb=function(){return C[this.zb+8>>2>>>0]},this.Tb=function(){E[this.zb>>2>>>0]=0},this.Ib=function(e){k[this.zb+12>>0>>>0]=e?1:0},this.Pb=function(){return 0!=k[this.zb+12>>0>>>0]},this.Jb=function(e){k[this.zb+13>>0>>>0]=e?1:0},this.Lb=function(){return 0!=k[this.zb+13>>0>>>0]},this.Rb=function(e,t){this.Fb(0),this.Ub(e),this.Sb(t),this.Tb(),this.Ib(!1),this.Jb(!1)},this.Nb=function(){E[this.zb>>2>>>0]+=1},this.Xb=function(){var e=E[this.zb>>2>>>0];return E[this.zb>>2>>>0]=e-1,1===e},this.Fb=function(e){C[this.zb+16>>2>>>0]=e},this.Ob=function(){return C[this.zb+16>>2>>>0]},this.Qb=function(){if(eC(this.Eb()))return C[this.Db>>2>>>0];var e=this.Ob();return 0!==e?e:this.Db}}function er(e){return ew(new en(e).zb)}var ei=[];function es(e){var t=ei[e];return t||(e>=ei.length&&(ei.length=e+1),ei[e]=t=P.get(e)),t}function ea(e){var t=D(e)+1,n=ev(t);return n&&R(e,k,n,t),n}var eo={};function el(){if(!eu){var e,t={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:("object"==typeof navigator&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",_:p||"./this.program"};for(e in eo)void 0===eo[e]?delete t[e]:t[e]=eo[e];var n=[];for(e in t)n.push(e+"="+t[e]);eu=n}return eu}var eu,ec=[null,[],[]];function eh(e,t){var n=ec[e];0===t||10===t?((1===e?w:_)(O(n,0)),n.length=0):n.push(t)}var ed=0;function ep(e){return 0==e%4&&(0!=e%100||0==e%400)}var ef=[31,29,31,30,31,30,31,31,30,31,30,31],eg=[31,28,31,30,31,30,31,31,30,31,30,31];function em(e,t,n,r){function i(e,t,n){for(e="number"==typeof e?e.toString():e||"";e.length<t;)e=n[0]+e;return e}function s(e,t){return i(e,t,"0")}function a(e,t){var n;function r(e){return 0>e?-1:0<e?1:0}return 0===(n=r(e.getFullYear()-t.getFullYear()))&&0===(n=r(e.getMonth()-t.getMonth()))&&(n=r(e.getDate()-t.getDate())),n}function o(e){switch(e.getDay()){case 0:return new Date(e.getFullYear()-1,11,29);case 1:return e;case 2:return new Date(e.getFullYear(),0,3);case 3:return new Date(e.getFullYear(),0,2);case 4:return new Date(e.getFullYear(),0,1);case 5:return new Date(e.getFullYear()-1,11,31);case 6:return new Date(e.getFullYear()-1,11,30)}}function l(e){var t=e.Bb;for(e=new Date(new Date(e.Cb+1900,0,1).getTime());0<t;){var n=e.getMonth(),r=(ep(e.getFullYear())?ef:eg)[n];if(!(t>r-e.getDate())){e.setDate(e.getDate()+t);break}t-=r-e.getDate()+1,e.setDate(1),11>n?e.setMonth(n+1):(e.setMonth(0),e.setFullYear(e.getFullYear()+1))}return n=new Date(e.getFullYear()+1,0,4),t=o(new Date(e.getFullYear(),0,4)),n=o(n),0>=a(t,e)?0>=a(n,e)?e.getFullYear()+1:e.getFullYear():e.getFullYear()-1}var u=E[r+40>>2>>>0];for(var c in r={$b:E[r>>2>>>0],Zb:E[r+4>>2>>>0],Gb:E[r+8>>2>>>0],Kb:E[r+12>>2>>>0],Hb:E[r+16>>2>>>0],Cb:E[r+20>>2>>>0],Ab:E[r+24>>2>>>0],Bb:E[r+28>>2>>>0],bc:E[r+32>>2>>>0],Yb:E[r+36>>2>>>0],ac:u?$(u):""},n=$(n),u={"%c":"%a %b %d %H:%M:%S %Y","%D":"%m/%d/%y","%F":"%Y-%m-%d","%h":"%b","%r":"%I:%M:%S %p","%R":"%H:%M","%T":"%H:%M:%S","%x":"%m/%d/%y","%X":"%H:%M:%S","%Ec":"%c","%EC":"%C","%Ex":"%m/%d/%y","%EX":"%H:%M:%S","%Ey":"%y","%EY":"%Y","%Od":"%d","%Oe":"%e","%OH":"%H","%OI":"%I","%Om":"%m","%OM":"%M","%OS":"%S","%Ou":"%u","%OU":"%U","%OV":"%V","%Ow":"%w","%OW":"%W","%Oy":"%y"})n=n.replace(RegExp(c,"g"),u[c]);var h="Sunday Monday Tuesday Wednesday Thursday Friday Saturday".split(" "),d="January February March April May June July August September October November December".split(" ");for(c in u={"%a":function(e){return h[e.Ab].substring(0,3)},"%A":function(e){return h[e.Ab]},"%b":function(e){return d[e.Hb].substring(0,3)},"%B":function(e){return d[e.Hb]},"%C":function(e){return s((e.Cb+1900)/100|0,2)},"%d":function(e){return s(e.Kb,2)},"%e":function(e){return i(e.Kb,2," ")},"%g":function(e){return l(e).toString().substring(2)},"%G":function(e){return l(e)},"%H":function(e){return s(e.Gb,2)},"%I":function(e){return 0==(e=e.Gb)?e=12:12<e&&(e-=12),s(e,2)},"%j":function(e){for(var t=0,n=0;n<=e.Hb-1;t+=(ep(e.Cb+1900)?ef:eg)[n++]);return s(e.Kb+t,3)},"%m":function(e){return s(e.Hb+1,2)},"%M":function(e){return s(e.Zb,2)},"%n":function(){return"\n"},"%p":function(e){return 0<=e.Gb&&12>e.Gb?"AM":"PM"},"%S":function(e){return s(e.$b,2)},"%t":function(){return"	"},"%u":function(e){return e.Ab||7},"%U":function(e){return s(Math.floor((e.Bb+7-e.Ab)/7),2)},"%V":function(e){var t=Math.floor((e.Bb+7-(e.Ab+6)%7)/7);if(2>=(e.Ab+371-e.Bb-2)%7&&t++,t)53==t&&(4==(n=(e.Ab+371-e.Bb)%7)||3==n&&ep(e.Cb)||(t=1));else{t=52;var n=(e.Ab+7-e.Bb-1)%7;(4==n||5==n&&ep(e.Cb%400-1))&&t++}return s(t,2)},"%w":function(e){return e.Ab},"%W":function(e){return s(Math.floor((e.Bb+7-(e.Ab+6)%7)/7),2)},"%y":function(e){return(e.Cb+1900).toString().substring(2)},"%Y":function(e){return e.Cb+1900},"%z":function(e){var t=0<=(e=e.Yb);return(t?"+":"-")+String("0000"+((e=Math.abs(e)/60)/60*100+e%60)).slice(-4)},"%Z":function(e){return e.ac},"%%":function(){return"%"}},n=n.replace(/%%/g,"\0\0"),u)n.includes(c)&&(n=n.replace(RegExp(c,"g"),u[c](r)));return(c=function(e){var t=Array(D(e)+1);return R(e,t,0,t.length),t}(n=n.replace(/\0\0/g,"%"))).length>t?0:(k.set(c,e>>>0),c.length-1)}var ey={a:function(e){return ev(e+24)+24},m:function(e){return(e=new en(e)).Pb()||(e.Ib(!0),ee--),e.Jb(!1),Z.push(e),e.Nb(),e.Qb()},ia:function(e){throw _("Unexpected exception thrown, this is not properly supported - aborting"),A=!0,e},w:function(){eT(0);var e=Z.pop();if(e.Xb()&&!e.Lb()){var t=e.Wb();t&&es(t)(e.Db),er(e.Db)}et=0},d:function(){var e=et;if(!e)return ed=0;var t=new en(e);t.Fb(e);var n=t.Eb();if(!n)return ed=0,e;for(var r=Array.prototype.slice.call(arguments),i=0;i<r.length;i++){var s=r[i];if(0===s||s===n)break;if(eE(s,n,t.zb+16))return ed=s,e}return ed=n,e},k:function(){var e=et;if(!e)return ed=0;var t=new en(e);t.Fb(e);var n=t.Eb();if(!n)return ed=0,e;for(var r=Array.prototype.slice.call(arguments),i=0;i<r.length;i++){var s=r[i];if(0===s||s===n)break;if(eE(s,n,t.zb+16))return ed=s,e}return ed=n,e},g:function(){var e=et;if(!e)return ed=0;var t=new en(e);t.Fb(e);var n=t.Eb();if(!n)return ed=0,e;for(var r=Array.prototype.slice.call(arguments),i=0;i<r.length;i++){var s=r[i];if(0===s||s===n)break;if(eE(s,n,t.zb+16))return ed=s,e}return ed=n,e},s:er,L:function(){var e=Z.pop();e||H("no exception to throw");var t=e.Db;throw e.Lb()||(Z.push(e),e.Jb(!0),e.Ib(!1),ee++),et=t,t},b:function(e,t,n){throw new en(e).Rb(t,n),et=e,ee++,e},la:function(){return ee},i:function(e){throw et||(et=e),e},H:function(){return 0},Ba:function(){},pa:function(){},ra:function(){},ka:function(){return 0},za:function(){},ua:function(){},ya:function(){},R:function(){},qa:function(){},na:function(){},Aa:function(){},oa:function(){},Ha:function(){},Ja:function(){H("To use dlopen, you need enable dynamic linking, see https://github.com/emscripten-core/emscripten/wiki/Linking")},Ia:function(){H("To use dlopen, you need enable dynamic linking, see https://github.com/emscripten-core/emscripten/wiki/Linking")},S:function(){return Date.now()},Ca:function(){return!0},Da:function(e,t){e=new Date(1e3*(C[e>>>2]+0x100000000*E[e+4>>>2])),E[t>>2>>>0]=e.getUTCSeconds(),E[t+4>>2>>>0]=e.getUTCMinutes(),E[t+8>>2>>>0]=e.getUTCHours(),E[t+12>>2>>>0]=e.getUTCDate(),E[t+16>>2>>>0]=e.getUTCMonth(),E[t+20>>2>>>0]=e.getUTCFullYear()-1900,E[t+24>>2>>>0]=e.getUTCDay(),E[t+28>>2>>>0]=(e.getTime()-Date.UTC(e.getUTCFullYear(),0,1,0,0,0,0))/864e5|0},Ea:function(e,t){e=new Date(1e3*(C[e>>>2]+0x100000000*E[e+4>>>2])),E[t>>2>>>0]=e.getSeconds(),E[t+4>>2>>>0]=e.getMinutes(),E[t+8>>2>>>0]=e.getHours(),E[t+12>>2>>>0]=e.getDate(),E[t+16>>2>>>0]=e.getMonth(),E[t+20>>2>>>0]=e.getFullYear()-1900,E[t+24>>2>>>0]=e.getDay();var n=new Date(e.getFullYear(),0,1);E[t+28>>2>>>0]=(e.getTime()-n.getTime())/864e5|0,E[t+36>>2>>>0]=-60*e.getTimezoneOffset();var r=new Date(e.getFullYear(),6,1).getTimezoneOffset();n=n.getTimezoneOffset(),E[t+32>>2>>>0]=0|(r!=n&&e.getTimezoneOffset()==Math.min(n,r))},Fa:function(e){var t=new Date(E[e+20>>2>>>0]+1900,E[e+16>>2>>>0],E[e+12>>2>>>0],E[e+8>>2>>>0],E[e+4>>2>>>0],E[e>>2>>>0],0),n=E[e+32>>2>>>0],r=t.getTimezoneOffset(),i=new Date(t.getFullYear(),0,1),s=new Date(t.getFullYear(),6,1).getTimezoneOffset(),a=i.getTimezoneOffset(),o=Math.min(a,s);return 0>n?E[e+32>>2>>>0]=Number(s!=a&&o==r):0<n!=(o==r)&&(s=Math.max(a,s),t.setTime(t.getTime()+6e4*((0<n?o:s)-r))),E[e+24>>2>>>0]=t.getDay(),E[e+28>>2>>>0]=(t.getTime()-i.getTime())/864e5|0,E[e>>2>>>0]=t.getSeconds(),E[e+4>>2>>>0]=t.getMinutes(),E[e+8>>2>>>0]=t.getHours(),E[e+12>>2>>>0]=t.getDate(),E[e+16>>2>>>0]=t.getMonth(),t.getTime()/1e3|0},sa:function(){return -52},ta:function(){},Ga:function e(t,n,r){e.Vb||(e.Vb=!0,function(e,t,n){function r(e){return(e=e.toTimeString().match(/\(([A-Za-z ]+)\)$/))?e[1]:"GMT"}var i=(new Date).getFullYear(),s=new Date(i,0,1),a=new Date(i,6,1);i=s.getTimezoneOffset();var o=a.getTimezoneOffset();E[e>>2>>>0]=60*Math.max(i,o),E[t>>2>>>0]=Number(i!=o),e=r(s),t=r(a),e=ea(e),t=ea(t),o<i?(C[n>>2>>>0]=e,C[n+4>>2>>>0]=t):(C[n>>2>>>0]=t,C[n+4>>2>>>0]=e)}(t,n,r))},B:function(){H("")},ma:function(){return 0xffff0000},I:y?()=>{var e=process.hrtime();return 1e3*e[0]+e[1]/1e6}:()=>performance.now(),xa:function(e,t,n){S.copyWithin(e>>>0,t>>>0,t+n>>>0)},G:function(e){var t=S.length;if(0xffff0000<(e>>>=0))return!1;for(var n=1;4>=n;n*=2){var r=t*(1+.2/n);r=Math.min(r,e+0x6000000);var i=Math;r=Math.max(e,r),i=i.min.call(i,0xffff0000,r+(65536-r%65536)%65536);e:{try{T.grow(i-I.byteLength+65535>>>16),F();var s=1;break e}catch(e){}s=void 0}if(s)return!0}return!1},va:function(e,t){var n=0;return el().forEach(function(r,i){var s=t+n;for(i=C[e+4*i>>2>>>0]=s,s=0;s<r.length;++s)k[i++>>0>>>0]=r.charCodeAt(s);k[i>>0>>>0]=0,n+=r.length+1}),0},wa:function(e,t){var n=el();C[e>>2>>>0]=n.length;var r=0;return n.forEach(function(e){r+=e.length+1}),C[t>>2>>>0]=r,0},ba:function(e){x||0<U||(ex(),J(z),e_(0),ec[1].length&&eh(1,10),ec[2].length&&eh(2,10)),x||0<U||(t.onExit&&t.onExit(e),A=!0),f(e,new Q(e))},E:function(){return 52},Q:function(){return 52},ca:function(){return 70},P:function(e,t,n,r){for(var i=0,s=0;s<n;s++){var a=C[t>>2>>>0],o=C[t+4>>2>>>0];t+=8;for(var l=0;l<o;l++)eh(e,S[a+l>>>0]);i+=o}return C[r>>2>>>0]=i,0},c:function(){return ed},ja:function e(t,r){e.Mb||(e.Mb=function(){if("object"==typeof crypto&&"function"==typeof crypto.getRandomValues){var e=new Uint8Array(1);return()=>(crypto.getRandomValues(e),e[0])}if(y)try{var t=n(Object(function(){var e=Error("Cannot find module 'crypto'");throw e.code="MODULE_NOT_FOUND",e}()));return()=>t.randomBytes(1)[0]}catch(e){}return()=>H("randomDevice")}());for(var i=0;i<r;i++)k[t+i>>0>>>0]=e.Mb();return 0},ea:function(e,t,n){var r=eI();try{return es(e)(t,n)}catch(e){if(ek(r),e!==e+0)throw e;eT(1,0)}},fa:function(e,t,n){var r=eI();try{return es(e)(t,n)}catch(e){if(ek(r),e!==e+0)throw e;eT(1,0)}},J:function(e){var t=eI();try{return es(e)()}catch(e){if(ek(t),e!==e+0)throw e;eT(1,0)}},e:function(e,t){var n=eI();try{return es(e)(t)}catch(e){if(ek(n),e!==e+0)throw e;eT(1,0)}},N:function(e,t,n){var r=eI();try{return es(e)(t,n)}catch(e){if(ek(r),e!==e+0)throw e;eT(1,0)}},O:function(e,t,n){var r=eI();try{return es(e)(t,n)}catch(e){if(ek(r),e!==e+0)throw e;eT(1,0)}},j:function(e,t,n){var r=eI();try{return es(e)(t,n)}catch(e){if(ek(r),e!==e+0)throw e;eT(1,0)}},o:function(e,t,n,r){var i=eI();try{return es(e)(t,n,r)}catch(e){if(ek(i),e!==e+0)throw e;eT(1,0)}},p:function(e,t,n,r,i){var s=eI();try{return es(e)(t,n,r,i)}catch(e){if(ek(s),e!==e+0)throw e;eT(1,0)}},M:function(e,t,n,r,i,s){var a=eI();try{return es(e)(t,n,r,i,s)}catch(e){if(ek(a),e!==e+0)throw e;eT(1,0)}},r:function(e,t,n,r,i,s){var a=eI();try{return es(e)(t,n,r,i,s)}catch(e){if(ek(a),e!==e+0)throw e;eT(1,0)}},v:function(e,t,n,r,i,s,a){var o=eI();try{return es(e)(t,n,r,i,s,a)}catch(e){if(ek(o),e!==e+0)throw e;eT(1,0)}},K:function(e,t,n,r,i,s,a,o){var l=eI();try{return es(e)(t,n,r,i,s,a,o)}catch(e){if(ek(l),e!==e+0)throw e;eT(1,0)}},D:function(e,t,n,r,i,s,a,o,l,u,c,h){var d=eI();try{return es(e)(t,n,r,i,s,a,o,l,u,c,h)}catch(e){if(ek(d),e!==e+0)throw e;eT(1,0)}},X:function(e,t,n,r,i,s,a,o){var l=eI();try{return eM(e,t,n,r,i,s,a,o)}catch(e){if(ek(l),e!==e+0)throw e;eT(1,0)}},V:function(e,t,n,r,i,s,a){var o=eI();try{return eN(e,t,n,r,i,s,a)}catch(e){if(ek(o),e!==e+0)throw e;eT(1,0)}},U:function(e,t,n,r,i){var s=eI();try{return eL(e,t,n,r,i)}catch(e){if(ek(s),e!==e+0)throw e;eT(1,0)}},Z:function(e,t,n,r){var i=eI();try{return eF(e,t,n,r)}catch(e){if(ek(i),e!==e+0)throw e;eT(1,0)}},W:function(e){var t=eI();try{return eA(e)}catch(e){if(ek(t),e!==e+0)throw e;eT(1,0)}},Y:function(e,t){var n=eI();try{return eP(e,t)}catch(e){if(ek(n),e!==e+0)throw e;eT(1,0)}},T:function(e,t,n){var r=eI();try{return eO(e,t,n)}catch(e){if(ek(r),e!==e+0)throw e;eT(1,0)}},f:function(e){var t=eI();try{es(e)()}catch(e){if(ek(t),e!==e+0)throw e;eT(1,0)}},q:function(e,t){var n=eI();try{es(e)(t)}catch(e){if(ek(n),e!==e+0)throw e;eT(1,0)}},h:function(e,t,n){var r=eI();try{es(e)(t,n)}catch(e){if(ek(r),e!==e+0)throw e;eT(1,0)}},da:function(e,t,n,r){var i=eI();try{es(e)(t,n,r)}catch(e){if(ek(i),e!==e+0)throw e;eT(1,0)}},l:function(e,t,n,r){var i=eI();try{es(e)(t,n,r)}catch(e){if(ek(i),e!==e+0)throw e;eT(1,0)}},t:function(e,t,n,r,i){var s=eI();try{es(e)(t,n,r,i)}catch(e){if(ek(s),e!==e+0)throw e;eT(1,0)}},u:function(e,t,n,r,i,s){var a=eI();try{es(e)(t,n,r,i,s)}catch(e){if(ek(a),e!==e+0)throw e;eT(1,0)}},x:function(e,t,n,r,i,s,a){var o=eI();try{es(e)(t,n,r,i,s,a)}catch(e){if(ek(o),e!==e+0)throw e;eT(1,0)}},z:function(e,t,n,r,i,s,a,o){var l=eI();try{es(e)(t,n,r,i,s,a,o)}catch(e){if(ek(l),e!==e+0)throw e;eT(1,0)}},ga:function(e,t,n,r,i,s,a,o,l){var u=eI();try{es(e)(t,n,r,i,s,a,o,l)}catch(e){if(ek(u),e!==e+0)throw e;eT(1,0)}},A:function(e,t,n,r,i,s,a,o,l,u,c){var h=eI();try{es(e)(t,n,r,i,s,a,o,l,u,c)}catch(e){if(ek(h),e!==e+0)throw e;eT(1,0)}},C:function(e,t,n,r,i,s,a,o,l,u,c,h,d,p,f,g){var m=eI();try{es(e)(t,n,r,i,s,a,o,l,u,c,h,d,p,f,g)}catch(e){if(ek(m),e!==e+0)throw e;eT(1,0)}},aa:function(e,t,n,r,i,s,a,o){var l=eI();try{e$(e,t,n,r,i,s,a,o)}catch(e){if(ek(l),e!==e+0)throw e;eT(1,0)}},_:function(e,t,n,r,i,s,a,o,l,u,c,h){var d=eI();try{eD(e,t,n,r,i,s,a,o,l,u,c,h)}catch(e){if(ek(d),e!==e+0)throw e;eT(1,0)}},$:function(e,t,n,r,i,s){var a=eI();try{eR(e,t,n,r,i,s)}catch(e){if(ek(a),e!==e+0)throw e;eT(1,0)}},n:function(e){return e},F:function(e){ed=e},ha:em,y:function(e,t,n,r){return em(e,t,n,r)}};(function(){function e(e){t.asm=e.exports,T=t.asm.Ka,F(),P=t.asm.ib,L.unshift(t.asm.La),G--,t.monitorRunDependencies&&t.monitorRunDependencies(G),0==G&&(null!==W&&(clearInterval(W),W=null),q&&(e=q,q=null,e()))}function n(t){e(t.instance)}function r(e){return(function(){if(!v&&(g||m)){if("function"==typeof fetch&&!j.startsWith("file://"))return fetch(j,{credentials:"same-origin"}).then(function(e){if(!e.ok)throw"failed to load wasm binary file at '"+j+"'";return e.arrayBuffer()}).catch(function(){return Y()});if(o)return new Promise(function(e,t){o(j,function(t){e(new Uint8Array(t))},t)})}return Promise.resolve().then(function(){return Y()})})().then(function(e){return WebAssembly.instantiate(e,i)}).then(function(e){return e}).then(e,function(e){_("failed to asynchronously prepare wasm: "+e),H(e)})}var i={a:ey};if(G++,t.monitorRunDependencies&&t.monitorRunDependencies(G),t.instantiateWasm)try{return t.instantiateWasm(i,e)}catch(e){return _("Module.instantiateWasm callback failed with error: "+e),!1}(v||"function"!=typeof WebAssembly.instantiateStreaming||K()||j.startsWith("file://")||y||"function"!=typeof fetch?r(n):fetch(j,{credentials:"same-origin"}).then(function(e){return WebAssembly.instantiateStreaming(e,i).then(n,function(e){return _("wasm streaming compile failed: "+e),_("falling back to ArrayBuffer instantiation"),r(n)})})).catch(s)})(),t.___wasm_call_ctors=function(){return(t.___wasm_call_ctors=t.asm.La).apply(null,arguments)},t._OrtInit=function(){return(t._OrtInit=t.asm.Ma).apply(null,arguments)},t._OrtCreateSessionOptions=function(){return(t._OrtCreateSessionOptions=t.asm.Na).apply(null,arguments)},t._OrtAppendExecutionProvider=function(){return(t._OrtAppendExecutionProvider=t.asm.Oa).apply(null,arguments)},t._OrtAddSessionConfigEntry=function(){return(t._OrtAddSessionConfigEntry=t.asm.Pa).apply(null,arguments)},t._OrtReleaseSessionOptions=function(){return(t._OrtReleaseSessionOptions=t.asm.Qa).apply(null,arguments)},t._OrtCreateSession=function(){return(t._OrtCreateSession=t.asm.Ra).apply(null,arguments)},t._OrtReleaseSession=function(){return(t._OrtReleaseSession=t.asm.Sa).apply(null,arguments)},t._OrtGetInputCount=function(){return(t._OrtGetInputCount=t.asm.Ta).apply(null,arguments)},t._OrtGetOutputCount=function(){return(t._OrtGetOutputCount=t.asm.Ua).apply(null,arguments)},t._OrtGetInputName=function(){return(t._OrtGetInputName=t.asm.Va).apply(null,arguments)},t._OrtGetOutputName=function(){return(t._OrtGetOutputName=t.asm.Wa).apply(null,arguments)},t._OrtFree=function(){return(t._OrtFree=t.asm.Xa).apply(null,arguments)},t._OrtCreateTensor=function(){return(t._OrtCreateTensor=t.asm.Ya).apply(null,arguments)},t._OrtGetTensorData=function(){return(t._OrtGetTensorData=t.asm.Za).apply(null,arguments)},t._OrtReleaseTensor=function(){return(t._OrtReleaseTensor=t.asm._a).apply(null,arguments)},t._OrtCreateRunOptions=function(){return(t._OrtCreateRunOptions=t.asm.$a).apply(null,arguments)},t._OrtAddRunConfigEntry=function(){return(t._OrtAddRunConfigEntry=t.asm.ab).apply(null,arguments)},t._OrtReleaseRunOptions=function(){return(t._OrtReleaseRunOptions=t.asm.bb).apply(null,arguments)},t._OrtRun=function(){return(t._OrtRun=t.asm.cb).apply(null,arguments)},t._OrtEndProfiling=function(){return(t._OrtEndProfiling=t.asm.db).apply(null,arguments)};var eb,ev=t._malloc=function(){return(ev=t._malloc=t.asm.eb).apply(null,arguments)},ew=t._free=function(){return(ew=t._free=t.asm.fb).apply(null,arguments)},e_=t._fflush=function(){return(e_=t._fflush=t.asm.gb).apply(null,arguments)},ex=t.___funcs_on_exit=function(){return(ex=t.___funcs_on_exit=t.asm.hb).apply(null,arguments)},eT=t._setThrew=function(){return(eT=t._setThrew=t.asm.jb).apply(null,arguments)},eI=t.stackSave=function(){return(eI=t.stackSave=t.asm.kb).apply(null,arguments)},ek=t.stackRestore=function(){return(ek=t.stackRestore=t.asm.lb).apply(null,arguments)},eS=t.stackAlloc=function(){return(eS=t.stackAlloc=t.asm.mb).apply(null,arguments)},eE=t.___cxa_can_catch=function(){return(eE=t.___cxa_can_catch=t.asm.nb).apply(null,arguments)},eC=t.___cxa_is_pointer_type=function(){return(eC=t.___cxa_is_pointer_type=t.asm.ob).apply(null,arguments)},eA=t.dynCall_j=function(){return(eA=t.dynCall_j=t.asm.pb).apply(null,arguments)},eN=t.dynCall_iiiiij=function(){return(eN=t.dynCall_iiiiij=t.asm.qb).apply(null,arguments)},eO=t.dynCall_jii=function(){return(eO=t.dynCall_jii=t.asm.rb).apply(null,arguments)},e$=t.dynCall_viiiiij=function(){return(e$=t.dynCall_viiiiij=t.asm.sb).apply(null,arguments)},eR=t.dynCall_vjji=function(){return(eR=t.dynCall_vjji=t.asm.tb).apply(null,arguments)},eD=t.dynCall_viiijjjii=function(){return(eD=t.dynCall_viiijjjii=t.asm.ub).apply(null,arguments)},eF=t.dynCall_iij=function(){return(eF=t.dynCall_iij=t.asm.vb).apply(null,arguments)},eP=t.dynCall_ji=function(){return(eP=t.dynCall_ji=t.asm.wb).apply(null,arguments)},eM=t.dynCall_iiiiiij=function(){return(eM=t.dynCall_iiiiiij=t.asm.xb).apply(null,arguments)},eL=t.dynCall_iiij=function(){return(eL=t.dynCall_iiij=t.asm.yb).apply(null,arguments)};function ez(){function e(){if(!eb&&(eb=!0,t.calledRun=!0,!A)){if(J(L),i(t),t.onRuntimeInitialized&&t.onRuntimeInitialized(),t.postRun)for("function"==typeof t.postRun&&(t.postRun=[t.postRun]);t.postRun.length;){var e=t.postRun.shift();B.unshift(e)}J(B)}}if(!(0<G)){if(t.preRun)for("function"==typeof t.preRun&&(t.preRun=[t.preRun]);t.preRun.length;)V();J(M),0<G||(t.setStatus?(t.setStatus("Running..."),setTimeout(function(){setTimeout(function(){t.setStatus("")},1),e()},1)):e())}}if(t.UTF8ToString=$,t.stringToUTF8=function(e,t,n){return R(e,S,t,n)},t.lengthBytesUTF8=D,t.stackSave=eI,t.stackRestore=ek,t.stackAlloc=eS,q=function e(){eb||ez(),eb||(q=e)},t.preInit)for("function"==typeof t.preInit&&(t.preInit=[t.preInit]);0<t.preInit.length;)t.preInit.pop()();return ez(),e.ready});e.exports=i},4537:e=>{"use strict";e.exports=function(e,t){for(var n=Array(arguments.length-1),r=0,i=2,s=!0;i<arguments.length;)n[r++]=arguments[i++];return new Promise(function(i,a){n[r]=function(e){if(s){if(s=!1,e)a(e);else{for(var t=Array(arguments.length-1),n=0;n<t.length;)t[n++]=arguments[n];i.apply(null,t)}}};try{e.apply(t||null,n)}catch(e){s&&(s=!1,a(e))}})}},7419:(e,t)=>{"use strict";var n=t;n.length=function(e){var t=e.length;if(!t)return 0;for(var n=0;--t%4>1&&"="===e.charAt(t);)++n;return Math.ceil(3*e.length)/4-n};for(var r=Array(64),i=Array(123),s=0;s<64;)i[r[s]=s<26?s+65:s<52?s+71:s<62?s-4:s-59|43]=s++;n.encode=function(e,t,n){for(var i,s=null,a=[],o=0,l=0;t<n;){var u=e[t++];switch(l){case 0:a[o++]=r[u>>2],i=(3&u)<<4,l=1;break;case 1:a[o++]=r[i|u>>4],i=(15&u)<<2,l=2;break;case 2:a[o++]=r[i|u>>6],a[o++]=r[63&u],l=0}o>8191&&((s||(s=[])).push(String.fromCharCode.apply(String,a)),o=0)}return l&&(a[o++]=r[i],a[o++]=61,1===l&&(a[o++]=61)),s?(o&&s.push(String.fromCharCode.apply(String,a.slice(0,o))),s.join("")):String.fromCharCode.apply(String,a.slice(0,o))};var a="invalid encoding";n.decode=function(e,t,n){for(var r,s=n,o=0,l=0;l<e.length;){var u=e.charCodeAt(l++);if(61===u&&o>1)break;if(void 0===(u=i[u]))throw Error(a);switch(o){case 0:r=u,o=1;break;case 1:t[n++]=r<<2|(48&u)>>4,r=u,o=2;break;case 2:t[n++]=(15&r)<<4|(60&u)>>2,r=u,o=3;break;case 3:t[n++]=(3&r)<<6|u,o=0}}if(1===o)throw Error(a);return n-s},n.test=function(e){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(e)}},9211:e=>{"use strict";function t(){this._listeners={}}e.exports=t,t.prototype.on=function(e,t,n){return(this._listeners[e]||(this._listeners[e]=[])).push({fn:t,ctx:n||this}),this},t.prototype.off=function(e,t){if(void 0===e)this._listeners={};else if(void 0===t)this._listeners[e]=[];else for(var n=this._listeners[e],r=0;r<n.length;)n[r].fn===t?n.splice(r,1):++r;return this},t.prototype.emit=function(e){var t=this._listeners[e];if(t){for(var n=[],r=1;r<arguments.length;)n.push(arguments[r++]);for(r=0;r<t.length;)t[r].fn.apply(t[r++].ctx,n)}return this}},945:e=>{"use strict";function t(e){return"undefined"!=typeof Float32Array?function(){var t=new Float32Array([-0]),n=new Uint8Array(t.buffer),r=128===n[3];function i(e,r,i){t[0]=e,r[i]=n[0],r[i+1]=n[1],r[i+2]=n[2],r[i+3]=n[3]}function s(e,r,i){t[0]=e,r[i]=n[3],r[i+1]=n[2],r[i+2]=n[1],r[i+3]=n[0]}function a(e,r){return n[0]=e[r],n[1]=e[r+1],n[2]=e[r+2],n[3]=e[r+3],t[0]}function o(e,r){return n[3]=e[r],n[2]=e[r+1],n[1]=e[r+2],n[0]=e[r+3],t[0]}e.writeFloatLE=r?i:s,e.writeFloatBE=r?s:i,e.readFloatLE=r?a:o,e.readFloatBE=r?o:a}():function(){function t(e,t,n,r){var i=t<0?1:0;if(i&&(t=-t),0===t)e(1/t>0?0:0x80000000,n,r);else if(isNaN(t))e(0x7fc00000,n,r);else if(t>34028234663852886e22)e((i<<31|0x7f800000)>>>0,n,r);else if(t<11754943508222875e-54)e((i<<31|Math.round(t/1401298464324817e-60))>>>0,n,r);else{var s=Math.floor(Math.log(t)/Math.LN2);e((i<<31|s+127<<23|8388607&Math.round(t*Math.pow(2,-s)*8388608))>>>0,n,r)}}function a(e,t,n){var r=e(t,n),i=2*(r>>31)+1,s=r>>>23&255,a=8388607&r;return 255===s?a?NaN:1/0*i:0===s?1401298464324817e-60*i*a:i*Math.pow(2,s-150)*(a+8388608)}e.writeFloatLE=t.bind(null,n),e.writeFloatBE=t.bind(null,r),e.readFloatLE=a.bind(null,i),e.readFloatBE=a.bind(null,s)}(),"undefined"!=typeof Float64Array?function(){var t=new Float64Array([-0]),n=new Uint8Array(t.buffer),r=128===n[7];function i(e,r,i){t[0]=e,r[i]=n[0],r[i+1]=n[1],r[i+2]=n[2],r[i+3]=n[3],r[i+4]=n[4],r[i+5]=n[5],r[i+6]=n[6],r[i+7]=n[7]}function s(e,r,i){t[0]=e,r[i]=n[7],r[i+1]=n[6],r[i+2]=n[5],r[i+3]=n[4],r[i+4]=n[3],r[i+5]=n[2],r[i+6]=n[1],r[i+7]=n[0]}function a(e,r){return n[0]=e[r],n[1]=e[r+1],n[2]=e[r+2],n[3]=e[r+3],n[4]=e[r+4],n[5]=e[r+5],n[6]=e[r+6],n[7]=e[r+7],t[0]}function o(e,r){return n[7]=e[r],n[6]=e[r+1],n[5]=e[r+2],n[4]=e[r+3],n[3]=e[r+4],n[2]=e[r+5],n[1]=e[r+6],n[0]=e[r+7],t[0]}e.writeDoubleLE=r?i:s,e.writeDoubleBE=r?s:i,e.readDoubleLE=r?a:o,e.readDoubleBE=r?o:a}():function(){function t(e,t,n,r,i,s){var a,o=r<0?1:0;if(o&&(r=-r),0===r)e(0,i,s+t),e(1/r>0?0:0x80000000,i,s+n);else if(isNaN(r))e(0,i,s+t),e(0x7ff80000,i,s+n);else if(r>17976931348623157e292)e(0,i,s+t),e((o<<31|0x7ff00000)>>>0,i,s+n);else if(r<22250738585072014e-324)e((a=r/5e-324)>>>0,i,s+t),e((o<<31|a/0x100000000)>>>0,i,s+n);else{var l=Math.floor(Math.log(r)/Math.LN2);1024===l&&(l=1023),e(0x10000000000000*(a=r*Math.pow(2,-l))>>>0,i,s+t),e((o<<31|l+1023<<20|1048576*a&1048575)>>>0,i,s+n)}}function a(e,t,n,r,i){var s=e(r,i+t),a=e(r,i+n),o=2*(a>>31)+1,l=a>>>20&2047,u=0x100000000*(1048575&a)+s;return 2047===l?u?NaN:1/0*o:0===l?5e-324*o*u:o*Math.pow(2,l-1075)*(u+0x10000000000000)}e.writeDoubleLE=t.bind(null,n,0,4),e.writeDoubleBE=t.bind(null,r,4,0),e.readDoubleLE=a.bind(null,i,0,4),e.readDoubleBE=a.bind(null,s,4,0)}(),e}function n(e,t,n){t[n]=255&e,t[n+1]=e>>>8&255,t[n+2]=e>>>16&255,t[n+3]=e>>>24}function r(e,t,n){t[n]=e>>>24,t[n+1]=e>>>16&255,t[n+2]=e>>>8&255,t[n+3]=255&e}function i(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24)>>>0}function s(e,t){return(e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3])>>>0}e.exports=t(t)},7199:module=>{"use strict";function inquire(moduleName){try{var mod=eval("quire".replace(/^/,"re"))(moduleName);if(mod&&(mod.length||Object.keys(mod).length))return mod}catch(t){}return null}module.exports=inquire},6662:e=>{"use strict";e.exports=function(e,t,n){var r=n||8192,i=r>>>1,s=null,a=r;return function(n){if(n<1||n>i)return e(n);a+n>r&&(s=e(r),a=0);var o=t.call(s,a,a+=n);return 7&a&&(a=1+(7|a)),o}}},4997:(e,t)=>{"use strict";var n=t;n.length=function(e){for(var t=0,n=0,r=0;r<e.length;++r)(n=e.charCodeAt(r))<128?t+=1:n<2048?t+=2:55296==(64512&n)&&56320==(64512&e.charCodeAt(r+1))?(++r,t+=4):t+=3;return t},n.read=function(e,t,n){if(n-t<1)return"";for(var r,i=null,s=[],a=0;t<n;)(r=e[t++])<128?s[a++]=r:r>191&&r<224?s[a++]=(31&r)<<6|63&e[t++]:r>239&&r<365?(r=((7&r)<<18|(63&e[t++])<<12|(63&e[t++])<<6|63&e[t++])-65536,s[a++]=55296+(r>>10),s[a++]=56320+(1023&r)):s[a++]=(15&r)<<12|(63&e[t++])<<6|63&e[t++],a>8191&&((i||(i=[])).push(String.fromCharCode.apply(String,s)),a=0);return i?(a&&i.push(String.fromCharCode.apply(String,s.slice(0,a))),i.join("")):String.fromCharCode.apply(String,s.slice(0,a))},n.write=function(e,t,n){for(var r,i,s=n,a=0;a<e.length;++a)(r=e.charCodeAt(a))<128?t[n++]=r:(r<2048?t[n++]=r>>6|192:(55296==(64512&r)&&56320==(64512&(i=e.charCodeAt(a+1)))?(r=65536+((1023&r)<<10)+(1023&i),++a,t[n++]=r>>18|240,t[n++]=r>>12&63|128):t[n++]=r>>12|224,t[n++]=r>>6&63|128),t[n++]=63&r|128);return n-s}},3442:(e,t)=>{"use strict";t.__esModule=!0;var n=function(){function e(t){if(!t)throw TypeError("Invalid argument; `value` has no value.");this.value=e.EMPTY,t&&e.isGuid(t)&&(this.value=t)}return e.isGuid=function(t){var n=t.toString();return t&&(t instanceof e||e.validator.test(n))},e.create=function(){return new e([e.gen(2),e.gen(1),e.gen(1),e.gen(1),e.gen(3)].join("-"))},e.createEmpty=function(){return new e("emptyguid")},e.parse=function(t){return new e(t)},e.raw=function(){return[e.gen(2),e.gen(1),e.gen(1),e.gen(1),e.gen(3)].join("-")},e.gen=function(e){for(var t="",n=0;n<e;n++)t+=(65536*(1+Math.random())|0).toString(16).substring(1);return t},e.prototype.equals=function(t){return e.isGuid(t)&&this.value===t.toString()},e.prototype.isEmpty=function(){return this.value===e.EMPTY},e.prototype.toString=function(){return this.value},e.prototype.toJSON=function(){return{value:this.value}},e.validator=RegExp("^[a-z0-9]{8}-[a-z0-9]{4}-[a-z0-9]{4}-[a-z0-9]{4}-[a-z0-9]{12}$","i"),e.EMPTY="00000000-0000-0000-0000-000000000000",e}();t.Guid=n},3720:e=>{e.exports=n;var t=null;try{t=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch(e){}function n(e,t,n){this.low=0|e,this.high=0|t,this.unsigned=!!n}function r(e){return!0===(e&&e.__isLong__)}n.prototype.__isLong__,Object.defineProperty(n.prototype,"__isLong__",{value:!0}),n.isLong=r;var i={},s={};function a(e,t){var n,r,a;return t?(a=0<=(e>>>=0)&&e<256)&&(r=s[e])?r:(n=l(e,(0|e)<0?-1:0,!0),a&&(s[e]=n),n):(a=-128<=(e|=0)&&e<128)&&(r=i[e])?r:(n=l(e,e<0?-1:0,!1),a&&(i[e]=n),n)}function o(e,t){if(isNaN(e))return t?y:m;if(t){if(e<0)return y;if(e>=p)return x}else{if(e<=-f)return T;if(e+1>=f)return _}return e<0?o(-e,t).neg():l(e%d|0,e/d|0,t)}function l(e,t,r){return new n(e,t,r)}n.fromInt=a,n.fromNumber=o,n.fromBits=l;var u=Math.pow;function c(e,t,n){if(0===e.length)throw Error("empty string");if("NaN"===e||"Infinity"===e||"+Infinity"===e||"-Infinity"===e)return m;if("number"==typeof t?(n=t,t=!1):t=!!t,(n=n||10)<2||36<n)throw RangeError("radix");if((r=e.indexOf("-"))>0)throw Error("interior hyphen");if(0===r)return c(e.substring(1),t,n).neg();for(var r,i=o(u(n,8)),s=m,a=0;a<e.length;a+=8){var l=Math.min(8,e.length-a),h=parseInt(e.substring(a,a+l),n);if(l<8){var d=o(u(n,l));s=s.mul(d).add(o(h))}else s=(s=s.mul(i)).add(o(h))}return s.unsigned=t,s}function h(e,t){return"number"==typeof e?o(e,t):"string"==typeof e?c(e,t):l(e.low,e.high,"boolean"==typeof t?t:e.unsigned)}n.fromString=c,n.fromValue=h;var d=0x100000000,p=0xffffffffffffffff,f=0xffffffffffffffff/2,g=a(0x1000000),m=a(0);n.ZERO=m;var y=a(0,!0);n.UZERO=y;var b=a(1);n.ONE=b;var v=a(1,!0);n.UONE=v;var w=a(-1);n.NEG_ONE=w;var _=l(-1,0x7fffffff,!1);n.MAX_VALUE=_;var x=l(-1,-1,!0);n.MAX_UNSIGNED_VALUE=x;var T=l(0,-0x80000000,!1);n.MIN_VALUE=T;var I=n.prototype;I.toInt=function(){return this.unsigned?this.low>>>0:this.low},I.toNumber=function(){return this.unsigned?(this.high>>>0)*d+(this.low>>>0):this.high*d+(this.low>>>0)},I.toString=function(e){if((e=e||10)<2||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative()){if(this.eq(T)){var t=o(e),n=this.div(t),r=n.mul(t).sub(this);return n.toString(e)+r.toInt().toString(e)}return"-"+this.neg().toString(e)}for(var i=o(u(e,6),this.unsigned),s=this,a="";;){var l=s.div(i),c=(s.sub(l.mul(i)).toInt()>>>0).toString(e);if((s=l).isZero())return c+a;for(;c.length<6;)c="0"+c;a=""+c+a}},I.getHighBits=function(){return this.high},I.getHighBitsUnsigned=function(){return this.high>>>0},I.getLowBits=function(){return this.low},I.getLowBitsUnsigned=function(){return this.low>>>0},I.getNumBitsAbs=function(){if(this.isNegative())return this.eq(T)?64:this.neg().getNumBitsAbs();for(var e=0!=this.high?this.high:this.low,t=31;t>0&&0==(e&1<<t);t--);return 0!=this.high?t+33:t+1},I.isZero=function(){return 0===this.high&&0===this.low},I.eqz=I.isZero,I.isNegative=function(){return!this.unsigned&&this.high<0},I.isPositive=function(){return this.unsigned||this.high>=0},I.isOdd=function(){return 1==(1&this.low)},I.isEven=function(){return 0==(1&this.low)},I.equals=function(e){return r(e)||(e=h(e)),(this.unsigned===e.unsigned||this.high>>>31!=1||e.high>>>31!=1)&&this.high===e.high&&this.low===e.low},I.eq=I.equals,I.notEquals=function(e){return!this.eq(e)},I.neq=I.notEquals,I.ne=I.notEquals,I.lessThan=function(e){return 0>this.comp(e)},I.lt=I.lessThan,I.lessThanOrEqual=function(e){return 0>=this.comp(e)},I.lte=I.lessThanOrEqual,I.le=I.lessThanOrEqual,I.greaterThan=function(e){return this.comp(e)>0},I.gt=I.greaterThan,I.greaterThanOrEqual=function(e){return this.comp(e)>=0},I.gte=I.greaterThanOrEqual,I.ge=I.greaterThanOrEqual,I.compare=function(e){if(r(e)||(e=h(e)),this.eq(e))return 0;var t=this.isNegative(),n=e.isNegative();return t&&!n?-1:!t&&n?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1},I.comp=I.compare,I.negate=function(){return!this.unsigned&&this.eq(T)?T:this.not().add(b)},I.neg=I.negate,I.add=function(e){r(e)||(e=h(e));var t,n,i,s,a=this.high>>>16,o=65535&this.high,u=this.low>>>16,c=65535&this.low,d=e.high>>>16,p=65535&e.high,f=e.low>>>16;return s=0+((i=0+((t=0+((n=0+(c+(65535&e.low)))>>>16)+(u+f))>>>16)+(o+p))>>>16),s+=a+d,l((t&=65535)<<16|(n&=65535),(s&=65535)<<16|(i&=65535),this.unsigned)},I.subtract=function(e){return r(e)||(e=h(e)),this.add(e.neg())},I.sub=I.subtract,I.multiply=function(e){if(this.isZero())return m;if(r(e)||(e=h(e)),t)return l(t.mul(this.low,this.high,e.low,e.high),t.get_high(),this.unsigned);if(e.isZero())return m;if(this.eq(T))return e.isOdd()?T:m;if(e.eq(T))return this.isOdd()?T:m;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(g)&&e.lt(g))return o(this.toNumber()*e.toNumber(),this.unsigned);var n,i,s,a=this.high>>>16,u=65535&this.high,c=this.low>>>16,d=65535&this.low,p=e.high>>>16,f=65535&e.high,y=e.low>>>16,b=65535&e.low,v=0;return s=0+((n=0+((i=0+d*b)>>>16)+c*b)>>>16),n&=65535,s+=(n+=d*y)>>>16,v+=(s+=u*b)>>>16,s&=65535,v+=(s+=c*y)>>>16,s&=65535,v+=((s+=d*f)>>>16)+(a*b+u*y+c*f+d*p),l((n&=65535)<<16|(i&=65535),(v&=65535)<<16|(s&=65535),this.unsigned)},I.mul=I.multiply,I.divide=function(e){if(r(e)||(e=h(e)),e.isZero())throw Error("division by zero");if(t)return this.unsigned||-0x80000000!==this.high||-1!==e.low||-1!==e.high?l((this.unsigned?t.div_u:t.div_s)(this.low,this.high,e.low,e.high),t.get_high(),this.unsigned):this;if(this.isZero())return this.unsigned?y:m;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return y;if(e.gt(this.shru(1)))return v;s=y}else{if(this.eq(T))return e.eq(b)||e.eq(w)?T:e.eq(T)?b:(n=this.shr(1).div(e).shl(1)).eq(m)?e.isNegative()?b:w:(i=this.sub(e.mul(n)),s=n.add(i.div(e)));if(e.eq(T))return this.unsigned?y:m;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();s=m}for(i=this;i.gte(e);){n=Math.max(1,Math.floor(i.toNumber()/e.toNumber()));for(var n,i,s,a=Math.ceil(Math.log(n)/Math.LN2),c=a<=48?1:u(2,a-48),d=o(n),p=d.mul(e);p.isNegative()||p.gt(i);)p=(d=o(n-=c,this.unsigned)).mul(e);d.isZero()&&(d=b),s=s.add(d),i=i.sub(p)}return s},I.div=I.divide,I.modulo=function(e){return r(e)||(e=h(e)),t?l((this.unsigned?t.rem_u:t.rem_s)(this.low,this.high,e.low,e.high),t.get_high(),this.unsigned):this.sub(this.div(e).mul(e))},I.mod=I.modulo,I.rem=I.modulo,I.not=function(){return l(~this.low,~this.high,this.unsigned)},I.and=function(e){return r(e)||(e=h(e)),l(this.low&e.low,this.high&e.high,this.unsigned)},I.or=function(e){return r(e)||(e=h(e)),l(this.low|e.low,this.high|e.high,this.unsigned)},I.xor=function(e){return r(e)||(e=h(e)),l(this.low^e.low,this.high^e.high,this.unsigned)},I.shiftLeft=function(e){return r(e)&&(e=e.toInt()),0==(e&=63)?this:e<32?l(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):l(0,this.low<<e-32,this.unsigned)},I.shl=I.shiftLeft,I.shiftRight=function(e){return r(e)&&(e=e.toInt()),0==(e&=63)?this:e<32?l(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):l(this.high>>e-32,this.high>=0?0:-1,this.unsigned)},I.shr=I.shiftRight,I.shiftRightUnsigned=function(e){if(r(e)&&(e=e.toInt()),0==(e&=63))return this;var t=this.high;return e<32?l(this.low>>>e|t<<32-e,t>>>e,this.unsigned):l(32===e?t:t>>>e-32,0,this.unsigned)},I.shru=I.shiftRightUnsigned,I.shr_u=I.shiftRightUnsigned,I.toSigned=function(){return this.unsigned?l(this.low,this.high,!1):this},I.toUnsigned=function(){return this.unsigned?this:l(this.low,this.high,!0)},I.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()},I.toBytesLE=function(){var e=this.high,t=this.low;return[255&t,t>>>8&255,t>>>16&255,t>>>24,255&e,e>>>8&255,e>>>16&255,e>>>24]},I.toBytesBE=function(){var e=this.high,t=this.low;return[e>>>24,e>>>16&255,e>>>8&255,255&e,t>>>24,t>>>16&255,t>>>8&255,255&t]},n.fromBytes=function(e,t,r){return r?n.fromBytesLE(e,t):n.fromBytesBE(e,t)},n.fromBytesLE=function(e,t){return new n(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,t)},n.fromBytesBE=function(e,t){return new n(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],t)}},1446:(e,t,n)=>{"use strict";var r,i,s,a=n(2100),o=a.Reader,l=a.Writer,u=a.util,c=a.roots.default||(a.roots.default={});c.onnx=((s={}).Version=((i=Object.create(r={}))[r[0]="_START_VERSION"]=0,i[r[1]="IR_VERSION_2017_10_10"]=1,i[r[2]="IR_VERSION_2017_10_30"]=2,i[r[3]="IR_VERSION_2017_11_3"]=3,i[r[4]="IR_VERSION_2019_1_22"]=4,i[r[5]="IR_VERSION"]=5,i),s.AttributeProto=function(){function e(e){if(this.floats=[],this.ints=[],this.strings=[],this.tensors=[],this.graphs=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.name="",e.prototype.refAttrName="",e.prototype.docString="",e.prototype.type=0,e.prototype.f=0,e.prototype.i=u.Long?u.Long.fromBits(0,0,!1):0,e.prototype.s=u.newBuffer([]),e.prototype.t=null,e.prototype.g=null,e.prototype.floats=u.emptyArray,e.prototype.ints=u.emptyArray,e.prototype.strings=u.emptyArray,e.prototype.tensors=u.emptyArray,e.prototype.graphs=u.emptyArray,e.create=function(t){return new e(t)},e.encode=function(e,t){if(t||(t=l.create()),null!=e.name&&e.hasOwnProperty("name")&&t.uint32(10).string(e.name),null!=e.f&&e.hasOwnProperty("f")&&t.uint32(21).float(e.f),null!=e.i&&e.hasOwnProperty("i")&&t.uint32(24).int64(e.i),null!=e.s&&e.hasOwnProperty("s")&&t.uint32(34).bytes(e.s),null!=e.t&&e.hasOwnProperty("t")&&c.onnx.TensorProto.encode(e.t,t.uint32(42).fork()).ldelim(),null!=e.g&&e.hasOwnProperty("g")&&c.onnx.GraphProto.encode(e.g,t.uint32(50).fork()).ldelim(),null!=e.floats&&e.floats.length){t.uint32(58).fork();for(var n=0;n<e.floats.length;++n)t.float(e.floats[n]);t.ldelim()}if(null!=e.ints&&e.ints.length){for(t.uint32(66).fork(),n=0;n<e.ints.length;++n)t.int64(e.ints[n]);t.ldelim()}if(null!=e.strings&&e.strings.length)for(n=0;n<e.strings.length;++n)t.uint32(74).bytes(e.strings[n]);if(null!=e.tensors&&e.tensors.length)for(n=0;n<e.tensors.length;++n)c.onnx.TensorProto.encode(e.tensors[n],t.uint32(82).fork()).ldelim();if(null!=e.graphs&&e.graphs.length)for(n=0;n<e.graphs.length;++n)c.onnx.GraphProto.encode(e.graphs[n],t.uint32(90).fork()).ldelim();return null!=e.docString&&e.hasOwnProperty("docString")&&t.uint32(106).string(e.docString),null!=e.type&&e.hasOwnProperty("type")&&t.uint32(160).int32(e.type),null!=e.refAttrName&&e.hasOwnProperty("refAttrName")&&t.uint32(170).string(e.refAttrName),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof o||(e=o.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new c.onnx.AttributeProto;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.name=e.string();break;case 21:r.refAttrName=e.string();break;case 13:r.docString=e.string();break;case 20:r.type=e.int32();break;case 2:r.f=e.float();break;case 3:r.i=e.int64();break;case 4:r.s=e.bytes();break;case 5:r.t=c.onnx.TensorProto.decode(e,e.uint32());break;case 6:r.g=c.onnx.GraphProto.decode(e,e.uint32());break;case 7:if(r.floats&&r.floats.length||(r.floats=[]),2==(7&i))for(var s=e.uint32()+e.pos;e.pos<s;)r.floats.push(e.float());else r.floats.push(e.float());break;case 8:if(r.ints&&r.ints.length||(r.ints=[]),2==(7&i))for(s=e.uint32()+e.pos;e.pos<s;)r.ints.push(e.int64());else r.ints.push(e.int64());break;case 9:r.strings&&r.strings.length||(r.strings=[]),r.strings.push(e.bytes());break;case 10:r.tensors&&r.tensors.length||(r.tensors=[]),r.tensors.push(c.onnx.TensorProto.decode(e,e.uint32()));break;case 11:r.graphs&&r.graphs.length||(r.graphs=[]),r.graphs.push(c.onnx.GraphProto.decode(e,e.uint32()));break;default:e.skipType(7&i)}}return r},e.decodeDelimited=function(e){return e instanceof o||(e=new o(e)),this.decode(e,e.uint32())},e.verify=function(e){if("object"!=typeof e||null===e)return"object expected";if(null!=e.name&&e.hasOwnProperty("name")&&!u.isString(e.name))return"name: string expected";if(null!=e.refAttrName&&e.hasOwnProperty("refAttrName")&&!u.isString(e.refAttrName))return"refAttrName: string expected";if(null!=e.docString&&e.hasOwnProperty("docString")&&!u.isString(e.docString))return"docString: string expected";if(null!=e.type&&e.hasOwnProperty("type"))switch(e.type){default:return"type: enum value expected";case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:case 10:}if(null!=e.f&&e.hasOwnProperty("f")&&"number"!=typeof e.f)return"f: number expected";if(null!=e.i&&e.hasOwnProperty("i")&&!(u.isInteger(e.i)||e.i&&u.isInteger(e.i.low)&&u.isInteger(e.i.high)))return"i: integer|Long expected";if(null!=e.s&&e.hasOwnProperty("s")&&!(e.s&&"number"==typeof e.s.length||u.isString(e.s)))return"s: buffer expected";if(null!=e.t&&e.hasOwnProperty("t")&&(t=c.onnx.TensorProto.verify(e.t)))return"t."+t;if(null!=e.g&&e.hasOwnProperty("g")&&(t=c.onnx.GraphProto.verify(e.g)))return"g."+t;if(null!=e.floats&&e.hasOwnProperty("floats")){if(!Array.isArray(e.floats))return"floats: array expected";for(var t,n=0;n<e.floats.length;++n)if("number"!=typeof e.floats[n])return"floats: number[] expected"}if(null!=e.ints&&e.hasOwnProperty("ints")){if(!Array.isArray(e.ints))return"ints: array expected";for(n=0;n<e.ints.length;++n)if(!(u.isInteger(e.ints[n])||e.ints[n]&&u.isInteger(e.ints[n].low)&&u.isInteger(e.ints[n].high)))return"ints: integer|Long[] expected"}if(null!=e.strings&&e.hasOwnProperty("strings")){if(!Array.isArray(e.strings))return"strings: array expected";for(n=0;n<e.strings.length;++n)if(!(e.strings[n]&&"number"==typeof e.strings[n].length||u.isString(e.strings[n])))return"strings: buffer[] expected"}if(null!=e.tensors&&e.hasOwnProperty("tensors")){if(!Array.isArray(e.tensors))return"tensors: array expected";for(n=0;n<e.tensors.length;++n)if(t=c.onnx.TensorProto.verify(e.tensors[n]))return"tensors."+t}if(null!=e.graphs&&e.hasOwnProperty("graphs")){if(!Array.isArray(e.graphs))return"graphs: array expected";for(n=0;n<e.graphs.length;++n)if(t=c.onnx.GraphProto.verify(e.graphs[n]))return"graphs."+t}return null},e.fromObject=function(e){if(e instanceof c.onnx.AttributeProto)return e;var t=new c.onnx.AttributeProto;switch(null!=e.name&&(t.name=String(e.name)),null!=e.refAttrName&&(t.refAttrName=String(e.refAttrName)),null!=e.docString&&(t.docString=String(e.docString)),e.type){case"UNDEFINED":case 0:t.type=0;break;case"FLOAT":case 1:t.type=1;break;case"INT":case 2:t.type=2;break;case"STRING":case 3:t.type=3;break;case"TENSOR":case 4:t.type=4;break;case"GRAPH":case 5:t.type=5;break;case"FLOATS":case 6:t.type=6;break;case"INTS":case 7:t.type=7;break;case"STRINGS":case 8:t.type=8;break;case"TENSORS":case 9:t.type=9;break;case"GRAPHS":case 10:t.type=10}if(null!=e.f&&(t.f=Number(e.f)),null!=e.i&&(u.Long?(t.i=u.Long.fromValue(e.i)).unsigned=!1:"string"==typeof e.i?t.i=parseInt(e.i,10):"number"==typeof e.i?t.i=e.i:"object"==typeof e.i&&(t.i=new u.LongBits(e.i.low>>>0,e.i.high>>>0).toNumber())),null!=e.s&&("string"==typeof e.s?u.base64.decode(e.s,t.s=u.newBuffer(u.base64.length(e.s)),0):e.s.length&&(t.s=e.s)),null!=e.t){if("object"!=typeof e.t)throw TypeError(".onnx.AttributeProto.t: object expected");t.t=c.onnx.TensorProto.fromObject(e.t)}if(null!=e.g){if("object"!=typeof e.g)throw TypeError(".onnx.AttributeProto.g: object expected");t.g=c.onnx.GraphProto.fromObject(e.g)}if(e.floats){if(!Array.isArray(e.floats))throw TypeError(".onnx.AttributeProto.floats: array expected");t.floats=[];for(var n=0;n<e.floats.length;++n)t.floats[n]=Number(e.floats[n])}if(e.ints){if(!Array.isArray(e.ints))throw TypeError(".onnx.AttributeProto.ints: array expected");for(t.ints=[],n=0;n<e.ints.length;++n)u.Long?(t.ints[n]=u.Long.fromValue(e.ints[n])).unsigned=!1:"string"==typeof e.ints[n]?t.ints[n]=parseInt(e.ints[n],10):"number"==typeof e.ints[n]?t.ints[n]=e.ints[n]:"object"==typeof e.ints[n]&&(t.ints[n]=new u.LongBits(e.ints[n].low>>>0,e.ints[n].high>>>0).toNumber())}if(e.strings){if(!Array.isArray(e.strings))throw TypeError(".onnx.AttributeProto.strings: array expected");for(t.strings=[],n=0;n<e.strings.length;++n)"string"==typeof e.strings[n]?u.base64.decode(e.strings[n],t.strings[n]=u.newBuffer(u.base64.length(e.strings[n])),0):e.strings[n].length&&(t.strings[n]=e.strings[n])}if(e.tensors){if(!Array.isArray(e.tensors))throw TypeError(".onnx.AttributeProto.tensors: array expected");for(t.tensors=[],n=0;n<e.tensors.length;++n){if("object"!=typeof e.tensors[n])throw TypeError(".onnx.AttributeProto.tensors: object expected");t.tensors[n]=c.onnx.TensorProto.fromObject(e.tensors[n])}}if(e.graphs){if(!Array.isArray(e.graphs))throw TypeError(".onnx.AttributeProto.graphs: array expected");for(t.graphs=[],n=0;n<e.graphs.length;++n){if("object"!=typeof e.graphs[n])throw TypeError(".onnx.AttributeProto.graphs: object expected");t.graphs[n]=c.onnx.GraphProto.fromObject(e.graphs[n])}}return t},e.toObject=function(e,t){t||(t={});var n={};if((t.arrays||t.defaults)&&(n.floats=[],n.ints=[],n.strings=[],n.tensors=[],n.graphs=[]),t.defaults){if(n.name="",n.f=0,u.Long){var r=new u.Long(0,0,!1);n.i=t.longs===String?r.toString():t.longs===Number?r.toNumber():r}else n.i=t.longs===String?"0":0;t.bytes===String?n.s="":(n.s=[],t.bytes!==Array&&(n.s=u.newBuffer(n.s))),n.t=null,n.g=null,n.docString="",n.type=t.enums===String?"UNDEFINED":0,n.refAttrName=""}if(null!=e.name&&e.hasOwnProperty("name")&&(n.name=e.name),null!=e.f&&e.hasOwnProperty("f")&&(n.f=t.json&&!isFinite(e.f)?String(e.f):e.f),null!=e.i&&e.hasOwnProperty("i")&&("number"==typeof e.i?n.i=t.longs===String?String(e.i):e.i:n.i=t.longs===String?u.Long.prototype.toString.call(e.i):t.longs===Number?new u.LongBits(e.i.low>>>0,e.i.high>>>0).toNumber():e.i),null!=e.s&&e.hasOwnProperty("s")&&(n.s=t.bytes===String?u.base64.encode(e.s,0,e.s.length):t.bytes===Array?Array.prototype.slice.call(e.s):e.s),null!=e.t&&e.hasOwnProperty("t")&&(n.t=c.onnx.TensorProto.toObject(e.t,t)),null!=e.g&&e.hasOwnProperty("g")&&(n.g=c.onnx.GraphProto.toObject(e.g,t)),e.floats&&e.floats.length){n.floats=[];for(var i=0;i<e.floats.length;++i)n.floats[i]=t.json&&!isFinite(e.floats[i])?String(e.floats[i]):e.floats[i]}if(e.ints&&e.ints.length)for(n.ints=[],i=0;i<e.ints.length;++i)"number"==typeof e.ints[i]?n.ints[i]=t.longs===String?String(e.ints[i]):e.ints[i]:n.ints[i]=t.longs===String?u.Long.prototype.toString.call(e.ints[i]):t.longs===Number?new u.LongBits(e.ints[i].low>>>0,e.ints[i].high>>>0).toNumber():e.ints[i];if(e.strings&&e.strings.length)for(n.strings=[],i=0;i<e.strings.length;++i)n.strings[i]=t.bytes===String?u.base64.encode(e.strings[i],0,e.strings[i].length):t.bytes===Array?Array.prototype.slice.call(e.strings[i]):e.strings[i];if(e.tensors&&e.tensors.length)for(n.tensors=[],i=0;i<e.tensors.length;++i)n.tensors[i]=c.onnx.TensorProto.toObject(e.tensors[i],t);if(e.graphs&&e.graphs.length)for(n.graphs=[],i=0;i<e.graphs.length;++i)n.graphs[i]=c.onnx.GraphProto.toObject(e.graphs[i],t);return null!=e.docString&&e.hasOwnProperty("docString")&&(n.docString=e.docString),null!=e.type&&e.hasOwnProperty("type")&&(n.type=t.enums===String?c.onnx.AttributeProto.AttributeType[e.type]:e.type),null!=e.refAttrName&&e.hasOwnProperty("refAttrName")&&(n.refAttrName=e.refAttrName),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,a.util.toJSONOptions)},e.AttributeType=function(){var e={},t=Object.create(e);return t[e[0]="UNDEFINED"]=0,t[e[1]="FLOAT"]=1,t[e[2]="INT"]=2,t[e[3]="STRING"]=3,t[e[4]="TENSOR"]=4,t[e[5]="GRAPH"]=5,t[e[6]="FLOATS"]=6,t[e[7]="INTS"]=7,t[e[8]="STRINGS"]=8,t[e[9]="TENSORS"]=9,t[e[10]="GRAPHS"]=10,t}(),e}(),s.ValueInfoProto=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.name="",e.prototype.type=null,e.prototype.docString="",e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=l.create()),null!=e.name&&e.hasOwnProperty("name")&&t.uint32(10).string(e.name),null!=e.type&&e.hasOwnProperty("type")&&c.onnx.TypeProto.encode(e.type,t.uint32(18).fork()).ldelim(),null!=e.docString&&e.hasOwnProperty("docString")&&t.uint32(26).string(e.docString),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof o||(e=o.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new c.onnx.ValueInfoProto;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.name=e.string();break;case 2:r.type=c.onnx.TypeProto.decode(e,e.uint32());break;case 3:r.docString=e.string();break;default:e.skipType(7&i)}}return r},e.decodeDelimited=function(e){return e instanceof o||(e=new o(e)),this.decode(e,e.uint32())},e.verify=function(e){if("object"!=typeof e||null===e)return"object expected";if(null!=e.name&&e.hasOwnProperty("name")&&!u.isString(e.name))return"name: string expected";if(null!=e.type&&e.hasOwnProperty("type")){var t=c.onnx.TypeProto.verify(e.type);if(t)return"type."+t}return null!=e.docString&&e.hasOwnProperty("docString")&&!u.isString(e.docString)?"docString: string expected":null},e.fromObject=function(e){if(e instanceof c.onnx.ValueInfoProto)return e;var t=new c.onnx.ValueInfoProto;if(null!=e.name&&(t.name=String(e.name)),null!=e.type){if("object"!=typeof e.type)throw TypeError(".onnx.ValueInfoProto.type: object expected");t.type=c.onnx.TypeProto.fromObject(e.type)}return null!=e.docString&&(t.docString=String(e.docString)),t},e.toObject=function(e,t){t||(t={});var n={};return t.defaults&&(n.name="",n.type=null,n.docString=""),null!=e.name&&e.hasOwnProperty("name")&&(n.name=e.name),null!=e.type&&e.hasOwnProperty("type")&&(n.type=c.onnx.TypeProto.toObject(e.type,t)),null!=e.docString&&e.hasOwnProperty("docString")&&(n.docString=e.docString),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,a.util.toJSONOptions)},e}(),s.NodeProto=function(){function e(e){if(this.input=[],this.output=[],this.attribute=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.input=u.emptyArray,e.prototype.output=u.emptyArray,e.prototype.name="",e.prototype.opType="",e.prototype.domain="",e.prototype.attribute=u.emptyArray,e.prototype.docString="",e.create=function(t){return new e(t)},e.encode=function(e,t){if(t||(t=l.create()),null!=e.input&&e.input.length)for(var n=0;n<e.input.length;++n)t.uint32(10).string(e.input[n]);if(null!=e.output&&e.output.length)for(n=0;n<e.output.length;++n)t.uint32(18).string(e.output[n]);if(null!=e.name&&e.hasOwnProperty("name")&&t.uint32(26).string(e.name),null!=e.opType&&e.hasOwnProperty("opType")&&t.uint32(34).string(e.opType),null!=e.attribute&&e.attribute.length)for(n=0;n<e.attribute.length;++n)c.onnx.AttributeProto.encode(e.attribute[n],t.uint32(42).fork()).ldelim();return null!=e.docString&&e.hasOwnProperty("docString")&&t.uint32(50).string(e.docString),null!=e.domain&&e.hasOwnProperty("domain")&&t.uint32(58).string(e.domain),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof o||(e=o.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new c.onnx.NodeProto;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.input&&r.input.length||(r.input=[]),r.input.push(e.string());break;case 2:r.output&&r.output.length||(r.output=[]),r.output.push(e.string());break;case 3:r.name=e.string();break;case 4:r.opType=e.string();break;case 7:r.domain=e.string();break;case 5:r.attribute&&r.attribute.length||(r.attribute=[]),r.attribute.push(c.onnx.AttributeProto.decode(e,e.uint32()));break;case 6:r.docString=e.string();break;default:e.skipType(7&i)}}return r},e.decodeDelimited=function(e){return e instanceof o||(e=new o(e)),this.decode(e,e.uint32())},e.verify=function(e){if("object"!=typeof e||null===e)return"object expected";if(null!=e.input&&e.hasOwnProperty("input")){if(!Array.isArray(e.input))return"input: array expected";for(var t=0;t<e.input.length;++t)if(!u.isString(e.input[t]))return"input: string[] expected"}if(null!=e.output&&e.hasOwnProperty("output")){if(!Array.isArray(e.output))return"output: array expected";for(t=0;t<e.output.length;++t)if(!u.isString(e.output[t]))return"output: string[] expected"}if(null!=e.name&&e.hasOwnProperty("name")&&!u.isString(e.name))return"name: string expected";if(null!=e.opType&&e.hasOwnProperty("opType")&&!u.isString(e.opType))return"opType: string expected";if(null!=e.domain&&e.hasOwnProperty("domain")&&!u.isString(e.domain))return"domain: string expected";if(null!=e.attribute&&e.hasOwnProperty("attribute")){if(!Array.isArray(e.attribute))return"attribute: array expected";for(t=0;t<e.attribute.length;++t){var n=c.onnx.AttributeProto.verify(e.attribute[t]);if(n)return"attribute."+n}}return null!=e.docString&&e.hasOwnProperty("docString")&&!u.isString(e.docString)?"docString: string expected":null},e.fromObject=function(e){if(e instanceof c.onnx.NodeProto)return e;var t=new c.onnx.NodeProto;if(e.input){if(!Array.isArray(e.input))throw TypeError(".onnx.NodeProto.input: array expected");t.input=[];for(var n=0;n<e.input.length;++n)t.input[n]=String(e.input[n])}if(e.output){if(!Array.isArray(e.output))throw TypeError(".onnx.NodeProto.output: array expected");for(t.output=[],n=0;n<e.output.length;++n)t.output[n]=String(e.output[n])}if(null!=e.name&&(t.name=String(e.name)),null!=e.opType&&(t.opType=String(e.opType)),null!=e.domain&&(t.domain=String(e.domain)),e.attribute){if(!Array.isArray(e.attribute))throw TypeError(".onnx.NodeProto.attribute: array expected");for(t.attribute=[],n=0;n<e.attribute.length;++n){if("object"!=typeof e.attribute[n])throw TypeError(".onnx.NodeProto.attribute: object expected");t.attribute[n]=c.onnx.AttributeProto.fromObject(e.attribute[n])}}return null!=e.docString&&(t.docString=String(e.docString)),t},e.toObject=function(e,t){t||(t={});var n={};if((t.arrays||t.defaults)&&(n.input=[],n.output=[],n.attribute=[]),t.defaults&&(n.name="",n.opType="",n.docString="",n.domain=""),e.input&&e.input.length){n.input=[];for(var r=0;r<e.input.length;++r)n.input[r]=e.input[r]}if(e.output&&e.output.length)for(n.output=[],r=0;r<e.output.length;++r)n.output[r]=e.output[r];if(null!=e.name&&e.hasOwnProperty("name")&&(n.name=e.name),null!=e.opType&&e.hasOwnProperty("opType")&&(n.opType=e.opType),e.attribute&&e.attribute.length)for(n.attribute=[],r=0;r<e.attribute.length;++r)n.attribute[r]=c.onnx.AttributeProto.toObject(e.attribute[r],t);return null!=e.docString&&e.hasOwnProperty("docString")&&(n.docString=e.docString),null!=e.domain&&e.hasOwnProperty("domain")&&(n.domain=e.domain),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,a.util.toJSONOptions)},e}(),s.ModelProto=function(){function e(e){if(this.opsetImport=[],this.metadataProps=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.irVersion=u.Long?u.Long.fromBits(0,0,!1):0,e.prototype.opsetImport=u.emptyArray,e.prototype.producerName="",e.prototype.producerVersion="",e.prototype.domain="",e.prototype.modelVersion=u.Long?u.Long.fromBits(0,0,!1):0,e.prototype.docString="",e.prototype.graph=null,e.prototype.metadataProps=u.emptyArray,e.create=function(t){return new e(t)},e.encode=function(e,t){if(t||(t=l.create()),null!=e.irVersion&&e.hasOwnProperty("irVersion")&&t.uint32(8).int64(e.irVersion),null!=e.producerName&&e.hasOwnProperty("producerName")&&t.uint32(18).string(e.producerName),null!=e.producerVersion&&e.hasOwnProperty("producerVersion")&&t.uint32(26).string(e.producerVersion),null!=e.domain&&e.hasOwnProperty("domain")&&t.uint32(34).string(e.domain),null!=e.modelVersion&&e.hasOwnProperty("modelVersion")&&t.uint32(40).int64(e.modelVersion),null!=e.docString&&e.hasOwnProperty("docString")&&t.uint32(50).string(e.docString),null!=e.graph&&e.hasOwnProperty("graph")&&c.onnx.GraphProto.encode(e.graph,t.uint32(58).fork()).ldelim(),null!=e.opsetImport&&e.opsetImport.length)for(var n=0;n<e.opsetImport.length;++n)c.onnx.OperatorSetIdProto.encode(e.opsetImport[n],t.uint32(66).fork()).ldelim();if(null!=e.metadataProps&&e.metadataProps.length)for(n=0;n<e.metadataProps.length;++n)c.onnx.StringStringEntryProto.encode(e.metadataProps[n],t.uint32(114).fork()).ldelim();return t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof o||(e=o.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new c.onnx.ModelProto;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.irVersion=e.int64();break;case 8:r.opsetImport&&r.opsetImport.length||(r.opsetImport=[]),r.opsetImport.push(c.onnx.OperatorSetIdProto.decode(e,e.uint32()));break;case 2:r.producerName=e.string();break;case 3:r.producerVersion=e.string();break;case 4:r.domain=e.string();break;case 5:r.modelVersion=e.int64();break;case 6:r.docString=e.string();break;case 7:r.graph=c.onnx.GraphProto.decode(e,e.uint32());break;case 14:r.metadataProps&&r.metadataProps.length||(r.metadataProps=[]),r.metadataProps.push(c.onnx.StringStringEntryProto.decode(e,e.uint32()));break;default:e.skipType(7&i)}}return r},e.decodeDelimited=function(e){return e instanceof o||(e=new o(e)),this.decode(e,e.uint32())},e.verify=function(e){if("object"!=typeof e||null===e)return"object expected";if(null!=e.irVersion&&e.hasOwnProperty("irVersion")&&!(u.isInteger(e.irVersion)||e.irVersion&&u.isInteger(e.irVersion.low)&&u.isInteger(e.irVersion.high)))return"irVersion: integer|Long expected";if(null!=e.opsetImport&&e.hasOwnProperty("opsetImport")){if(!Array.isArray(e.opsetImport))return"opsetImport: array expected";for(var t,n=0;n<e.opsetImport.length;++n)if(t=c.onnx.OperatorSetIdProto.verify(e.opsetImport[n]))return"opsetImport."+t}if(null!=e.producerName&&e.hasOwnProperty("producerName")&&!u.isString(e.producerName))return"producerName: string expected";if(null!=e.producerVersion&&e.hasOwnProperty("producerVersion")&&!u.isString(e.producerVersion))return"producerVersion: string expected";if(null!=e.domain&&e.hasOwnProperty("domain")&&!u.isString(e.domain))return"domain: string expected";if(null!=e.modelVersion&&e.hasOwnProperty("modelVersion")&&!(u.isInteger(e.modelVersion)||e.modelVersion&&u.isInteger(e.modelVersion.low)&&u.isInteger(e.modelVersion.high)))return"modelVersion: integer|Long expected";if(null!=e.docString&&e.hasOwnProperty("docString")&&!u.isString(e.docString))return"docString: string expected";if(null!=e.graph&&e.hasOwnProperty("graph")&&(t=c.onnx.GraphProto.verify(e.graph)))return"graph."+t;if(null!=e.metadataProps&&e.hasOwnProperty("metadataProps")){if(!Array.isArray(e.metadataProps))return"metadataProps: array expected";for(n=0;n<e.metadataProps.length;++n)if(t=c.onnx.StringStringEntryProto.verify(e.metadataProps[n]))return"metadataProps."+t}return null},e.fromObject=function(e){if(e instanceof c.onnx.ModelProto)return e;var t=new c.onnx.ModelProto;if(null!=e.irVersion&&(u.Long?(t.irVersion=u.Long.fromValue(e.irVersion)).unsigned=!1:"string"==typeof e.irVersion?t.irVersion=parseInt(e.irVersion,10):"number"==typeof e.irVersion?t.irVersion=e.irVersion:"object"==typeof e.irVersion&&(t.irVersion=new u.LongBits(e.irVersion.low>>>0,e.irVersion.high>>>0).toNumber())),e.opsetImport){if(!Array.isArray(e.opsetImport))throw TypeError(".onnx.ModelProto.opsetImport: array expected");t.opsetImport=[];for(var n=0;n<e.opsetImport.length;++n){if("object"!=typeof e.opsetImport[n])throw TypeError(".onnx.ModelProto.opsetImport: object expected");t.opsetImport[n]=c.onnx.OperatorSetIdProto.fromObject(e.opsetImport[n])}}if(null!=e.producerName&&(t.producerName=String(e.producerName)),null!=e.producerVersion&&(t.producerVersion=String(e.producerVersion)),null!=e.domain&&(t.domain=String(e.domain)),null!=e.modelVersion&&(u.Long?(t.modelVersion=u.Long.fromValue(e.modelVersion)).unsigned=!1:"string"==typeof e.modelVersion?t.modelVersion=parseInt(e.modelVersion,10):"number"==typeof e.modelVersion?t.modelVersion=e.modelVersion:"object"==typeof e.modelVersion&&(t.modelVersion=new u.LongBits(e.modelVersion.low>>>0,e.modelVersion.high>>>0).toNumber())),null!=e.docString&&(t.docString=String(e.docString)),null!=e.graph){if("object"!=typeof e.graph)throw TypeError(".onnx.ModelProto.graph: object expected");t.graph=c.onnx.GraphProto.fromObject(e.graph)}if(e.metadataProps){if(!Array.isArray(e.metadataProps))throw TypeError(".onnx.ModelProto.metadataProps: array expected");for(t.metadataProps=[],n=0;n<e.metadataProps.length;++n){if("object"!=typeof e.metadataProps[n])throw TypeError(".onnx.ModelProto.metadataProps: object expected");t.metadataProps[n]=c.onnx.StringStringEntryProto.fromObject(e.metadataProps[n])}}return t},e.toObject=function(e,t){t||(t={});var n={};if((t.arrays||t.defaults)&&(n.opsetImport=[],n.metadataProps=[]),t.defaults){if(u.Long){var r=new u.Long(0,0,!1);n.irVersion=t.longs===String?r.toString():t.longs===Number?r.toNumber():r}else n.irVersion=t.longs===String?"0":0;n.producerName="",n.producerVersion="",n.domain="",u.Long?(r=new u.Long(0,0,!1),n.modelVersion=t.longs===String?r.toString():t.longs===Number?r.toNumber():r):n.modelVersion=t.longs===String?"0":0,n.docString="",n.graph=null}if(null!=e.irVersion&&e.hasOwnProperty("irVersion")&&("number"==typeof e.irVersion?n.irVersion=t.longs===String?String(e.irVersion):e.irVersion:n.irVersion=t.longs===String?u.Long.prototype.toString.call(e.irVersion):t.longs===Number?new u.LongBits(e.irVersion.low>>>0,e.irVersion.high>>>0).toNumber():e.irVersion),null!=e.producerName&&e.hasOwnProperty("producerName")&&(n.producerName=e.producerName),null!=e.producerVersion&&e.hasOwnProperty("producerVersion")&&(n.producerVersion=e.producerVersion),null!=e.domain&&e.hasOwnProperty("domain")&&(n.domain=e.domain),null!=e.modelVersion&&e.hasOwnProperty("modelVersion")&&("number"==typeof e.modelVersion?n.modelVersion=t.longs===String?String(e.modelVersion):e.modelVersion:n.modelVersion=t.longs===String?u.Long.prototype.toString.call(e.modelVersion):t.longs===Number?new u.LongBits(e.modelVersion.low>>>0,e.modelVersion.high>>>0).toNumber():e.modelVersion),null!=e.docString&&e.hasOwnProperty("docString")&&(n.docString=e.docString),null!=e.graph&&e.hasOwnProperty("graph")&&(n.graph=c.onnx.GraphProto.toObject(e.graph,t)),e.opsetImport&&e.opsetImport.length){n.opsetImport=[];for(var i=0;i<e.opsetImport.length;++i)n.opsetImport[i]=c.onnx.OperatorSetIdProto.toObject(e.opsetImport[i],t)}if(e.metadataProps&&e.metadataProps.length)for(n.metadataProps=[],i=0;i<e.metadataProps.length;++i)n.metadataProps[i]=c.onnx.StringStringEntryProto.toObject(e.metadataProps[i],t);return n},e.prototype.toJSON=function(){return this.constructor.toObject(this,a.util.toJSONOptions)},e}(),s.StringStringEntryProto=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.key="",e.prototype.value="",e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=l.create()),null!=e.key&&e.hasOwnProperty("key")&&t.uint32(10).string(e.key),null!=e.value&&e.hasOwnProperty("value")&&t.uint32(18).string(e.value),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof o||(e=o.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new c.onnx.StringStringEntryProto;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.key=e.string();break;case 2:r.value=e.string();break;default:e.skipType(7&i)}}return r},e.decodeDelimited=function(e){return e instanceof o||(e=new o(e)),this.decode(e,e.uint32())},e.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.key&&e.hasOwnProperty("key")&&!u.isString(e.key)?"key: string expected":null!=e.value&&e.hasOwnProperty("value")&&!u.isString(e.value)?"value: string expected":null},e.fromObject=function(e){if(e instanceof c.onnx.StringStringEntryProto)return e;var t=new c.onnx.StringStringEntryProto;return null!=e.key&&(t.key=String(e.key)),null!=e.value&&(t.value=String(e.value)),t},e.toObject=function(e,t){t||(t={});var n={};return t.defaults&&(n.key="",n.value=""),null!=e.key&&e.hasOwnProperty("key")&&(n.key=e.key),null!=e.value&&e.hasOwnProperty("value")&&(n.value=e.value),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,a.util.toJSONOptions)},e}(),s.TensorAnnotation=function(){function e(e){if(this.quantParameterTensorNames=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.tensorName="",e.prototype.quantParameterTensorNames=u.emptyArray,e.create=function(t){return new e(t)},e.encode=function(e,t){if(t||(t=l.create()),null!=e.tensorName&&e.hasOwnProperty("tensorName")&&t.uint32(10).string(e.tensorName),null!=e.quantParameterTensorNames&&e.quantParameterTensorNames.length)for(var n=0;n<e.quantParameterTensorNames.length;++n)c.onnx.StringStringEntryProto.encode(e.quantParameterTensorNames[n],t.uint32(18).fork()).ldelim();return t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof o||(e=o.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new c.onnx.TensorAnnotation;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.tensorName=e.string();break;case 2:r.quantParameterTensorNames&&r.quantParameterTensorNames.length||(r.quantParameterTensorNames=[]),r.quantParameterTensorNames.push(c.onnx.StringStringEntryProto.decode(e,e.uint32()));break;default:e.skipType(7&i)}}return r},e.decodeDelimited=function(e){return e instanceof o||(e=new o(e)),this.decode(e,e.uint32())},e.verify=function(e){if("object"!=typeof e||null===e)return"object expected";if(null!=e.tensorName&&e.hasOwnProperty("tensorName")&&!u.isString(e.tensorName))return"tensorName: string expected";if(null!=e.quantParameterTensorNames&&e.hasOwnProperty("quantParameterTensorNames")){if(!Array.isArray(e.quantParameterTensorNames))return"quantParameterTensorNames: array expected";for(var t=0;t<e.quantParameterTensorNames.length;++t){var n=c.onnx.StringStringEntryProto.verify(e.quantParameterTensorNames[t]);if(n)return"quantParameterTensorNames."+n}}return null},e.fromObject=function(e){if(e instanceof c.onnx.TensorAnnotation)return e;var t=new c.onnx.TensorAnnotation;if(null!=e.tensorName&&(t.tensorName=String(e.tensorName)),e.quantParameterTensorNames){if(!Array.isArray(e.quantParameterTensorNames))throw TypeError(".onnx.TensorAnnotation.quantParameterTensorNames: array expected");t.quantParameterTensorNames=[];for(var n=0;n<e.quantParameterTensorNames.length;++n){if("object"!=typeof e.quantParameterTensorNames[n])throw TypeError(".onnx.TensorAnnotation.quantParameterTensorNames: object expected");t.quantParameterTensorNames[n]=c.onnx.StringStringEntryProto.fromObject(e.quantParameterTensorNames[n])}}return t},e.toObject=function(e,t){t||(t={});var n={};if((t.arrays||t.defaults)&&(n.quantParameterTensorNames=[]),t.defaults&&(n.tensorName=""),null!=e.tensorName&&e.hasOwnProperty("tensorName")&&(n.tensorName=e.tensorName),e.quantParameterTensorNames&&e.quantParameterTensorNames.length){n.quantParameterTensorNames=[];for(var r=0;r<e.quantParameterTensorNames.length;++r)n.quantParameterTensorNames[r]=c.onnx.StringStringEntryProto.toObject(e.quantParameterTensorNames[r],t)}return n},e.prototype.toJSON=function(){return this.constructor.toObject(this,a.util.toJSONOptions)},e}(),s.GraphProto=function(){function e(e){if(this.node=[],this.initializer=[],this.input=[],this.output=[],this.valueInfo=[],this.quantizationAnnotation=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.node=u.emptyArray,e.prototype.name="",e.prototype.initializer=u.emptyArray,e.prototype.docString="",e.prototype.input=u.emptyArray,e.prototype.output=u.emptyArray,e.prototype.valueInfo=u.emptyArray,e.prototype.quantizationAnnotation=u.emptyArray,e.create=function(t){return new e(t)},e.encode=function(e,t){if(t||(t=l.create()),null!=e.node&&e.node.length)for(var n=0;n<e.node.length;++n)c.onnx.NodeProto.encode(e.node[n],t.uint32(10).fork()).ldelim();if(null!=e.name&&e.hasOwnProperty("name")&&t.uint32(18).string(e.name),null!=e.initializer&&e.initializer.length)for(n=0;n<e.initializer.length;++n)c.onnx.TensorProto.encode(e.initializer[n],t.uint32(42).fork()).ldelim();if(null!=e.docString&&e.hasOwnProperty("docString")&&t.uint32(82).string(e.docString),null!=e.input&&e.input.length)for(n=0;n<e.input.length;++n)c.onnx.ValueInfoProto.encode(e.input[n],t.uint32(90).fork()).ldelim();if(null!=e.output&&e.output.length)for(n=0;n<e.output.length;++n)c.onnx.ValueInfoProto.encode(e.output[n],t.uint32(98).fork()).ldelim();if(null!=e.valueInfo&&e.valueInfo.length)for(n=0;n<e.valueInfo.length;++n)c.onnx.ValueInfoProto.encode(e.valueInfo[n],t.uint32(106).fork()).ldelim();if(null!=e.quantizationAnnotation&&e.quantizationAnnotation.length)for(n=0;n<e.quantizationAnnotation.length;++n)c.onnx.TensorAnnotation.encode(e.quantizationAnnotation[n],t.uint32(114).fork()).ldelim();return t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof o||(e=o.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new c.onnx.GraphProto;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.node&&r.node.length||(r.node=[]),r.node.push(c.onnx.NodeProto.decode(e,e.uint32()));break;case 2:r.name=e.string();break;case 5:r.initializer&&r.initializer.length||(r.initializer=[]),r.initializer.push(c.onnx.TensorProto.decode(e,e.uint32()));break;case 10:r.docString=e.string();break;case 11:r.input&&r.input.length||(r.input=[]),r.input.push(c.onnx.ValueInfoProto.decode(e,e.uint32()));break;case 12:r.output&&r.output.length||(r.output=[]),r.output.push(c.onnx.ValueInfoProto.decode(e,e.uint32()));break;case 13:r.valueInfo&&r.valueInfo.length||(r.valueInfo=[]),r.valueInfo.push(c.onnx.ValueInfoProto.decode(e,e.uint32()));break;case 14:r.quantizationAnnotation&&r.quantizationAnnotation.length||(r.quantizationAnnotation=[]),r.quantizationAnnotation.push(c.onnx.TensorAnnotation.decode(e,e.uint32()));break;default:e.skipType(7&i)}}return r},e.decodeDelimited=function(e){return e instanceof o||(e=new o(e)),this.decode(e,e.uint32())},e.verify=function(e){if("object"!=typeof e||null===e)return"object expected";if(null!=e.node&&e.hasOwnProperty("node")){if(!Array.isArray(e.node))return"node: array expected";for(var t,n=0;n<e.node.length;++n)if(t=c.onnx.NodeProto.verify(e.node[n]))return"node."+t}if(null!=e.name&&e.hasOwnProperty("name")&&!u.isString(e.name))return"name: string expected";if(null!=e.initializer&&e.hasOwnProperty("initializer")){if(!Array.isArray(e.initializer))return"initializer: array expected";for(n=0;n<e.initializer.length;++n)if(t=c.onnx.TensorProto.verify(e.initializer[n]))return"initializer."+t}if(null!=e.docString&&e.hasOwnProperty("docString")&&!u.isString(e.docString))return"docString: string expected";if(null!=e.input&&e.hasOwnProperty("input")){if(!Array.isArray(e.input))return"input: array expected";for(n=0;n<e.input.length;++n)if(t=c.onnx.ValueInfoProto.verify(e.input[n]))return"input."+t}if(null!=e.output&&e.hasOwnProperty("output")){if(!Array.isArray(e.output))return"output: array expected";for(n=0;n<e.output.length;++n)if(t=c.onnx.ValueInfoProto.verify(e.output[n]))return"output."+t}if(null!=e.valueInfo&&e.hasOwnProperty("valueInfo")){if(!Array.isArray(e.valueInfo))return"valueInfo: array expected";for(n=0;n<e.valueInfo.length;++n)if(t=c.onnx.ValueInfoProto.verify(e.valueInfo[n]))return"valueInfo."+t}if(null!=e.quantizationAnnotation&&e.hasOwnProperty("quantizationAnnotation")){if(!Array.isArray(e.quantizationAnnotation))return"quantizationAnnotation: array expected";for(n=0;n<e.quantizationAnnotation.length;++n)if(t=c.onnx.TensorAnnotation.verify(e.quantizationAnnotation[n]))return"quantizationAnnotation."+t}return null},e.fromObject=function(e){if(e instanceof c.onnx.GraphProto)return e;var t=new c.onnx.GraphProto;if(e.node){if(!Array.isArray(e.node))throw TypeError(".onnx.GraphProto.node: array expected");t.node=[];for(var n=0;n<e.node.length;++n){if("object"!=typeof e.node[n])throw TypeError(".onnx.GraphProto.node: object expected");t.node[n]=c.onnx.NodeProto.fromObject(e.node[n])}}if(null!=e.name&&(t.name=String(e.name)),e.initializer){if(!Array.isArray(e.initializer))throw TypeError(".onnx.GraphProto.initializer: array expected");for(t.initializer=[],n=0;n<e.initializer.length;++n){if("object"!=typeof e.initializer[n])throw TypeError(".onnx.GraphProto.initializer: object expected");t.initializer[n]=c.onnx.TensorProto.fromObject(e.initializer[n])}}if(null!=e.docString&&(t.docString=String(e.docString)),e.input){if(!Array.isArray(e.input))throw TypeError(".onnx.GraphProto.input: array expected");for(t.input=[],n=0;n<e.input.length;++n){if("object"!=typeof e.input[n])throw TypeError(".onnx.GraphProto.input: object expected");t.input[n]=c.onnx.ValueInfoProto.fromObject(e.input[n])}}if(e.output){if(!Array.isArray(e.output))throw TypeError(".onnx.GraphProto.output: array expected");for(t.output=[],n=0;n<e.output.length;++n){if("object"!=typeof e.output[n])throw TypeError(".onnx.GraphProto.output: object expected");t.output[n]=c.onnx.ValueInfoProto.fromObject(e.output[n])}}if(e.valueInfo){if(!Array.isArray(e.valueInfo))throw TypeError(".onnx.GraphProto.valueInfo: array expected");for(t.valueInfo=[],n=0;n<e.valueInfo.length;++n){if("object"!=typeof e.valueInfo[n])throw TypeError(".onnx.GraphProto.valueInfo: object expected");t.valueInfo[n]=c.onnx.ValueInfoProto.fromObject(e.valueInfo[n])}}if(e.quantizationAnnotation){if(!Array.isArray(e.quantizationAnnotation))throw TypeError(".onnx.GraphProto.quantizationAnnotation: array expected");for(t.quantizationAnnotation=[],n=0;n<e.quantizationAnnotation.length;++n){if("object"!=typeof e.quantizationAnnotation[n])throw TypeError(".onnx.GraphProto.quantizationAnnotation: object expected");t.quantizationAnnotation[n]=c.onnx.TensorAnnotation.fromObject(e.quantizationAnnotation[n])}}return t},e.toObject=function(e,t){t||(t={});var n={};if((t.arrays||t.defaults)&&(n.node=[],n.initializer=[],n.input=[],n.output=[],n.valueInfo=[],n.quantizationAnnotation=[]),t.defaults&&(n.name="",n.docString=""),e.node&&e.node.length){n.node=[];for(var r=0;r<e.node.length;++r)n.node[r]=c.onnx.NodeProto.toObject(e.node[r],t)}if(null!=e.name&&e.hasOwnProperty("name")&&(n.name=e.name),e.initializer&&e.initializer.length)for(n.initializer=[],r=0;r<e.initializer.length;++r)n.initializer[r]=c.onnx.TensorProto.toObject(e.initializer[r],t);if(null!=e.docString&&e.hasOwnProperty("docString")&&(n.docString=e.docString),e.input&&e.input.length)for(n.input=[],r=0;r<e.input.length;++r)n.input[r]=c.onnx.ValueInfoProto.toObject(e.input[r],t);if(e.output&&e.output.length)for(n.output=[],r=0;r<e.output.length;++r)n.output[r]=c.onnx.ValueInfoProto.toObject(e.output[r],t);if(e.valueInfo&&e.valueInfo.length)for(n.valueInfo=[],r=0;r<e.valueInfo.length;++r)n.valueInfo[r]=c.onnx.ValueInfoProto.toObject(e.valueInfo[r],t);if(e.quantizationAnnotation&&e.quantizationAnnotation.length)for(n.quantizationAnnotation=[],r=0;r<e.quantizationAnnotation.length;++r)n.quantizationAnnotation[r]=c.onnx.TensorAnnotation.toObject(e.quantizationAnnotation[r],t);return n},e.prototype.toJSON=function(){return this.constructor.toObject(this,a.util.toJSONOptions)},e}(),s.TensorProto=function(){function e(e){if(this.dims=[],this.floatData=[],this.int32Data=[],this.stringData=[],this.int64Data=[],this.externalData=[],this.doubleData=[],this.uint64Data=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.dims=u.emptyArray,e.prototype.dataType=0,e.prototype.segment=null,e.prototype.floatData=u.emptyArray,e.prototype.int32Data=u.emptyArray,e.prototype.stringData=u.emptyArray,e.prototype.int64Data=u.emptyArray,e.prototype.name="",e.prototype.docString="",e.prototype.rawData=u.newBuffer([]),e.prototype.externalData=u.emptyArray,e.prototype.dataLocation=0,e.prototype.doubleData=u.emptyArray,e.prototype.uint64Data=u.emptyArray,e.create=function(t){return new e(t)},e.encode=function(e,t){if(t||(t=l.create()),null!=e.dims&&e.dims.length){t.uint32(10).fork();for(var n=0;n<e.dims.length;++n)t.int64(e.dims[n]);t.ldelim()}if(null!=e.dataType&&e.hasOwnProperty("dataType")&&t.uint32(16).int32(e.dataType),null!=e.segment&&e.hasOwnProperty("segment")&&c.onnx.TensorProto.Segment.encode(e.segment,t.uint32(26).fork()).ldelim(),null!=e.floatData&&e.floatData.length){for(t.uint32(34).fork(),n=0;n<e.floatData.length;++n)t.float(e.floatData[n]);t.ldelim()}if(null!=e.int32Data&&e.int32Data.length){for(t.uint32(42).fork(),n=0;n<e.int32Data.length;++n)t.int32(e.int32Data[n]);t.ldelim()}if(null!=e.stringData&&e.stringData.length)for(n=0;n<e.stringData.length;++n)t.uint32(50).bytes(e.stringData[n]);if(null!=e.int64Data&&e.int64Data.length){for(t.uint32(58).fork(),n=0;n<e.int64Data.length;++n)t.int64(e.int64Data[n]);t.ldelim()}if(null!=e.name&&e.hasOwnProperty("name")&&t.uint32(66).string(e.name),null!=e.rawData&&e.hasOwnProperty("rawData")&&t.uint32(74).bytes(e.rawData),null!=e.doubleData&&e.doubleData.length){for(t.uint32(82).fork(),n=0;n<e.doubleData.length;++n)t.double(e.doubleData[n]);t.ldelim()}if(null!=e.uint64Data&&e.uint64Data.length){for(t.uint32(90).fork(),n=0;n<e.uint64Data.length;++n)t.uint64(e.uint64Data[n]);t.ldelim()}if(null!=e.docString&&e.hasOwnProperty("docString")&&t.uint32(98).string(e.docString),null!=e.externalData&&e.externalData.length)for(n=0;n<e.externalData.length;++n)c.onnx.StringStringEntryProto.encode(e.externalData[n],t.uint32(106).fork()).ldelim();return null!=e.dataLocation&&e.hasOwnProperty("dataLocation")&&t.uint32(112).int32(e.dataLocation),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof o||(e=o.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new c.onnx.TensorProto;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:if(r.dims&&r.dims.length||(r.dims=[]),2==(7&i))for(var s=e.uint32()+e.pos;e.pos<s;)r.dims.push(e.int64());else r.dims.push(e.int64());break;case 2:r.dataType=e.int32();break;case 3:r.segment=c.onnx.TensorProto.Segment.decode(e,e.uint32());break;case 4:if(r.floatData&&r.floatData.length||(r.floatData=[]),2==(7&i))for(s=e.uint32()+e.pos;e.pos<s;)r.floatData.push(e.float());else r.floatData.push(e.float());break;case 5:if(r.int32Data&&r.int32Data.length||(r.int32Data=[]),2==(7&i))for(s=e.uint32()+e.pos;e.pos<s;)r.int32Data.push(e.int32());else r.int32Data.push(e.int32());break;case 6:r.stringData&&r.stringData.length||(r.stringData=[]),r.stringData.push(e.bytes());break;case 7:if(r.int64Data&&r.int64Data.length||(r.int64Data=[]),2==(7&i))for(s=e.uint32()+e.pos;e.pos<s;)r.int64Data.push(e.int64());else r.int64Data.push(e.int64());break;case 8:r.name=e.string();break;case 12:r.docString=e.string();break;case 9:r.rawData=e.bytes();break;case 13:r.externalData&&r.externalData.length||(r.externalData=[]),r.externalData.push(c.onnx.StringStringEntryProto.decode(e,e.uint32()));break;case 14:r.dataLocation=e.int32();break;case 10:if(r.doubleData&&r.doubleData.length||(r.doubleData=[]),2==(7&i))for(s=e.uint32()+e.pos;e.pos<s;)r.doubleData.push(e.double());else r.doubleData.push(e.double());break;case 11:if(r.uint64Data&&r.uint64Data.length||(r.uint64Data=[]),2==(7&i))for(s=e.uint32()+e.pos;e.pos<s;)r.uint64Data.push(e.uint64());else r.uint64Data.push(e.uint64());break;default:e.skipType(7&i)}}return r},e.decodeDelimited=function(e){return e instanceof o||(e=new o(e)),this.decode(e,e.uint32())},e.verify=function(e){if("object"!=typeof e||null===e)return"object expected";if(null!=e.dims&&e.hasOwnProperty("dims")){if(!Array.isArray(e.dims))return"dims: array expected";for(var t,n=0;n<e.dims.length;++n)if(!(u.isInteger(e.dims[n])||e.dims[n]&&u.isInteger(e.dims[n].low)&&u.isInteger(e.dims[n].high)))return"dims: integer|Long[] expected"}if(null!=e.dataType&&e.hasOwnProperty("dataType")&&!u.isInteger(e.dataType))return"dataType: integer expected";if(null!=e.segment&&e.hasOwnProperty("segment")&&(t=c.onnx.TensorProto.Segment.verify(e.segment)))return"segment."+t;if(null!=e.floatData&&e.hasOwnProperty("floatData")){if(!Array.isArray(e.floatData))return"floatData: array expected";for(n=0;n<e.floatData.length;++n)if("number"!=typeof e.floatData[n])return"floatData: number[] expected"}if(null!=e.int32Data&&e.hasOwnProperty("int32Data")){if(!Array.isArray(e.int32Data))return"int32Data: array expected";for(n=0;n<e.int32Data.length;++n)if(!u.isInteger(e.int32Data[n]))return"int32Data: integer[] expected"}if(null!=e.stringData&&e.hasOwnProperty("stringData")){if(!Array.isArray(e.stringData))return"stringData: array expected";for(n=0;n<e.stringData.length;++n)if(!(e.stringData[n]&&"number"==typeof e.stringData[n].length||u.isString(e.stringData[n])))return"stringData: buffer[] expected"}if(null!=e.int64Data&&e.hasOwnProperty("int64Data")){if(!Array.isArray(e.int64Data))return"int64Data: array expected";for(n=0;n<e.int64Data.length;++n)if(!(u.isInteger(e.int64Data[n])||e.int64Data[n]&&u.isInteger(e.int64Data[n].low)&&u.isInteger(e.int64Data[n].high)))return"int64Data: integer|Long[] expected"}if(null!=e.name&&e.hasOwnProperty("name")&&!u.isString(e.name))return"name: string expected";if(null!=e.docString&&e.hasOwnProperty("docString")&&!u.isString(e.docString))return"docString: string expected";if(null!=e.rawData&&e.hasOwnProperty("rawData")&&!(e.rawData&&"number"==typeof e.rawData.length||u.isString(e.rawData)))return"rawData: buffer expected";if(null!=e.externalData&&e.hasOwnProperty("externalData")){if(!Array.isArray(e.externalData))return"externalData: array expected";for(n=0;n<e.externalData.length;++n)if(t=c.onnx.StringStringEntryProto.verify(e.externalData[n]))return"externalData."+t}if(null!=e.dataLocation&&e.hasOwnProperty("dataLocation"))switch(e.dataLocation){default:return"dataLocation: enum value expected";case 0:case 1:}if(null!=e.doubleData&&e.hasOwnProperty("doubleData")){if(!Array.isArray(e.doubleData))return"doubleData: array expected";for(n=0;n<e.doubleData.length;++n)if("number"!=typeof e.doubleData[n])return"doubleData: number[] expected"}if(null!=e.uint64Data&&e.hasOwnProperty("uint64Data")){if(!Array.isArray(e.uint64Data))return"uint64Data: array expected";for(n=0;n<e.uint64Data.length;++n)if(!(u.isInteger(e.uint64Data[n])||e.uint64Data[n]&&u.isInteger(e.uint64Data[n].low)&&u.isInteger(e.uint64Data[n].high)))return"uint64Data: integer|Long[] expected"}return null},e.fromObject=function(e){if(e instanceof c.onnx.TensorProto)return e;var t=new c.onnx.TensorProto;if(e.dims){if(!Array.isArray(e.dims))throw TypeError(".onnx.TensorProto.dims: array expected");t.dims=[];for(var n=0;n<e.dims.length;++n)u.Long?(t.dims[n]=u.Long.fromValue(e.dims[n])).unsigned=!1:"string"==typeof e.dims[n]?t.dims[n]=parseInt(e.dims[n],10):"number"==typeof e.dims[n]?t.dims[n]=e.dims[n]:"object"==typeof e.dims[n]&&(t.dims[n]=new u.LongBits(e.dims[n].low>>>0,e.dims[n].high>>>0).toNumber())}if(null!=e.dataType&&(t.dataType=0|e.dataType),null!=e.segment){if("object"!=typeof e.segment)throw TypeError(".onnx.TensorProto.segment: object expected");t.segment=c.onnx.TensorProto.Segment.fromObject(e.segment)}if(e.floatData){if(!Array.isArray(e.floatData))throw TypeError(".onnx.TensorProto.floatData: array expected");for(t.floatData=[],n=0;n<e.floatData.length;++n)t.floatData[n]=Number(e.floatData[n])}if(e.int32Data){if(!Array.isArray(e.int32Data))throw TypeError(".onnx.TensorProto.int32Data: array expected");for(t.int32Data=[],n=0;n<e.int32Data.length;++n)t.int32Data[n]=0|e.int32Data[n]}if(e.stringData){if(!Array.isArray(e.stringData))throw TypeError(".onnx.TensorProto.stringData: array expected");for(t.stringData=[],n=0;n<e.stringData.length;++n)"string"==typeof e.stringData[n]?u.base64.decode(e.stringData[n],t.stringData[n]=u.newBuffer(u.base64.length(e.stringData[n])),0):e.stringData[n].length&&(t.stringData[n]=e.stringData[n])}if(e.int64Data){if(!Array.isArray(e.int64Data))throw TypeError(".onnx.TensorProto.int64Data: array expected");for(t.int64Data=[],n=0;n<e.int64Data.length;++n)u.Long?(t.int64Data[n]=u.Long.fromValue(e.int64Data[n])).unsigned=!1:"string"==typeof e.int64Data[n]?t.int64Data[n]=parseInt(e.int64Data[n],10):"number"==typeof e.int64Data[n]?t.int64Data[n]=e.int64Data[n]:"object"==typeof e.int64Data[n]&&(t.int64Data[n]=new u.LongBits(e.int64Data[n].low>>>0,e.int64Data[n].high>>>0).toNumber())}if(null!=e.name&&(t.name=String(e.name)),null!=e.docString&&(t.docString=String(e.docString)),null!=e.rawData&&("string"==typeof e.rawData?u.base64.decode(e.rawData,t.rawData=u.newBuffer(u.base64.length(e.rawData)),0):e.rawData.length&&(t.rawData=e.rawData)),e.externalData){if(!Array.isArray(e.externalData))throw TypeError(".onnx.TensorProto.externalData: array expected");for(t.externalData=[],n=0;n<e.externalData.length;++n){if("object"!=typeof e.externalData[n])throw TypeError(".onnx.TensorProto.externalData: object expected");t.externalData[n]=c.onnx.StringStringEntryProto.fromObject(e.externalData[n])}}switch(e.dataLocation){case"DEFAULT":case 0:t.dataLocation=0;break;case"EXTERNAL":case 1:t.dataLocation=1}if(e.doubleData){if(!Array.isArray(e.doubleData))throw TypeError(".onnx.TensorProto.doubleData: array expected");for(t.doubleData=[],n=0;n<e.doubleData.length;++n)t.doubleData[n]=Number(e.doubleData[n])}if(e.uint64Data){if(!Array.isArray(e.uint64Data))throw TypeError(".onnx.TensorProto.uint64Data: array expected");for(t.uint64Data=[],n=0;n<e.uint64Data.length;++n)u.Long?(t.uint64Data[n]=u.Long.fromValue(e.uint64Data[n])).unsigned=!0:"string"==typeof e.uint64Data[n]?t.uint64Data[n]=parseInt(e.uint64Data[n],10):"number"==typeof e.uint64Data[n]?t.uint64Data[n]=e.uint64Data[n]:"object"==typeof e.uint64Data[n]&&(t.uint64Data[n]=new u.LongBits(e.uint64Data[n].low>>>0,e.uint64Data[n].high>>>0).toNumber(!0))}return t},e.toObject=function(e,t){t||(t={});var n={};if((t.arrays||t.defaults)&&(n.dims=[],n.floatData=[],n.int32Data=[],n.stringData=[],n.int64Data=[],n.doubleData=[],n.uint64Data=[],n.externalData=[]),t.defaults&&(n.dataType=0,n.segment=null,n.name="",t.bytes===String?n.rawData="":(n.rawData=[],t.bytes!==Array&&(n.rawData=u.newBuffer(n.rawData))),n.docString="",n.dataLocation=t.enums===String?"DEFAULT":0),e.dims&&e.dims.length){n.dims=[];for(var r=0;r<e.dims.length;++r)"number"==typeof e.dims[r]?n.dims[r]=t.longs===String?String(e.dims[r]):e.dims[r]:n.dims[r]=t.longs===String?u.Long.prototype.toString.call(e.dims[r]):t.longs===Number?new u.LongBits(e.dims[r].low>>>0,e.dims[r].high>>>0).toNumber():e.dims[r]}if(null!=e.dataType&&e.hasOwnProperty("dataType")&&(n.dataType=e.dataType),null!=e.segment&&e.hasOwnProperty("segment")&&(n.segment=c.onnx.TensorProto.Segment.toObject(e.segment,t)),e.floatData&&e.floatData.length)for(n.floatData=[],r=0;r<e.floatData.length;++r)n.floatData[r]=t.json&&!isFinite(e.floatData[r])?String(e.floatData[r]):e.floatData[r];if(e.int32Data&&e.int32Data.length)for(n.int32Data=[],r=0;r<e.int32Data.length;++r)n.int32Data[r]=e.int32Data[r];if(e.stringData&&e.stringData.length)for(n.stringData=[],r=0;r<e.stringData.length;++r)n.stringData[r]=t.bytes===String?u.base64.encode(e.stringData[r],0,e.stringData[r].length):t.bytes===Array?Array.prototype.slice.call(e.stringData[r]):e.stringData[r];if(e.int64Data&&e.int64Data.length)for(n.int64Data=[],r=0;r<e.int64Data.length;++r)"number"==typeof e.int64Data[r]?n.int64Data[r]=t.longs===String?String(e.int64Data[r]):e.int64Data[r]:n.int64Data[r]=t.longs===String?u.Long.prototype.toString.call(e.int64Data[r]):t.longs===Number?new u.LongBits(e.int64Data[r].low>>>0,e.int64Data[r].high>>>0).toNumber():e.int64Data[r];if(null!=e.name&&e.hasOwnProperty("name")&&(n.name=e.name),null!=e.rawData&&e.hasOwnProperty("rawData")&&(n.rawData=t.bytes===String?u.base64.encode(e.rawData,0,e.rawData.length):t.bytes===Array?Array.prototype.slice.call(e.rawData):e.rawData),e.doubleData&&e.doubleData.length)for(n.doubleData=[],r=0;r<e.doubleData.length;++r)n.doubleData[r]=t.json&&!isFinite(e.doubleData[r])?String(e.doubleData[r]):e.doubleData[r];if(e.uint64Data&&e.uint64Data.length)for(n.uint64Data=[],r=0;r<e.uint64Data.length;++r)"number"==typeof e.uint64Data[r]?n.uint64Data[r]=t.longs===String?String(e.uint64Data[r]):e.uint64Data[r]:n.uint64Data[r]=t.longs===String?u.Long.prototype.toString.call(e.uint64Data[r]):t.longs===Number?new u.LongBits(e.uint64Data[r].low>>>0,e.uint64Data[r].high>>>0).toNumber(!0):e.uint64Data[r];if(null!=e.docString&&e.hasOwnProperty("docString")&&(n.docString=e.docString),e.externalData&&e.externalData.length)for(n.externalData=[],r=0;r<e.externalData.length;++r)n.externalData[r]=c.onnx.StringStringEntryProto.toObject(e.externalData[r],t);return null!=e.dataLocation&&e.hasOwnProperty("dataLocation")&&(n.dataLocation=t.enums===String?c.onnx.TensorProto.DataLocation[e.dataLocation]:e.dataLocation),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,a.util.toJSONOptions)},e.DataType=function(){var e={},t=Object.create(e);return t[e[0]="UNDEFINED"]=0,t[e[1]="FLOAT"]=1,t[e[2]="UINT8"]=2,t[e[3]="INT8"]=3,t[e[4]="UINT16"]=4,t[e[5]="INT16"]=5,t[e[6]="INT32"]=6,t[e[7]="INT64"]=7,t[e[8]="STRING"]=8,t[e[9]="BOOL"]=9,t[e[10]="FLOAT16"]=10,t[e[11]="DOUBLE"]=11,t[e[12]="UINT32"]=12,t[e[13]="UINT64"]=13,t[e[14]="COMPLEX64"]=14,t[e[15]="COMPLEX128"]=15,t[e[16]="BFLOAT16"]=16,t}(),e.Segment=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.begin=u.Long?u.Long.fromBits(0,0,!1):0,e.prototype.end=u.Long?u.Long.fromBits(0,0,!1):0,e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=l.create()),null!=e.begin&&e.hasOwnProperty("begin")&&t.uint32(8).int64(e.begin),null!=e.end&&e.hasOwnProperty("end")&&t.uint32(16).int64(e.end),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof o||(e=o.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new c.onnx.TensorProto.Segment;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.begin=e.int64();break;case 2:r.end=e.int64();break;default:e.skipType(7&i)}}return r},e.decodeDelimited=function(e){return e instanceof o||(e=new o(e)),this.decode(e,e.uint32())},e.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.begin&&e.hasOwnProperty("begin")&&!(u.isInteger(e.begin)||e.begin&&u.isInteger(e.begin.low)&&u.isInteger(e.begin.high))?"begin: integer|Long expected":null!=e.end&&e.hasOwnProperty("end")&&!(u.isInteger(e.end)||e.end&&u.isInteger(e.end.low)&&u.isInteger(e.end.high))?"end: integer|Long expected":null},e.fromObject=function(e){if(e instanceof c.onnx.TensorProto.Segment)return e;var t=new c.onnx.TensorProto.Segment;return null!=e.begin&&(u.Long?(t.begin=u.Long.fromValue(e.begin)).unsigned=!1:"string"==typeof e.begin?t.begin=parseInt(e.begin,10):"number"==typeof e.begin?t.begin=e.begin:"object"==typeof e.begin&&(t.begin=new u.LongBits(e.begin.low>>>0,e.begin.high>>>0).toNumber())),null!=e.end&&(u.Long?(t.end=u.Long.fromValue(e.end)).unsigned=!1:"string"==typeof e.end?t.end=parseInt(e.end,10):"number"==typeof e.end?t.end=e.end:"object"==typeof e.end&&(t.end=new u.LongBits(e.end.low>>>0,e.end.high>>>0).toNumber())),t},e.toObject=function(e,t){t||(t={});var n={};if(t.defaults){if(u.Long){var r=new u.Long(0,0,!1);n.begin=t.longs===String?r.toString():t.longs===Number?r.toNumber():r}else n.begin=t.longs===String?"0":0;u.Long?(r=new u.Long(0,0,!1),n.end=t.longs===String?r.toString():t.longs===Number?r.toNumber():r):n.end=t.longs===String?"0":0}return null!=e.begin&&e.hasOwnProperty("begin")&&("number"==typeof e.begin?n.begin=t.longs===String?String(e.begin):e.begin:n.begin=t.longs===String?u.Long.prototype.toString.call(e.begin):t.longs===Number?new u.LongBits(e.begin.low>>>0,e.begin.high>>>0).toNumber():e.begin),null!=e.end&&e.hasOwnProperty("end")&&("number"==typeof e.end?n.end=t.longs===String?String(e.end):e.end:n.end=t.longs===String?u.Long.prototype.toString.call(e.end):t.longs===Number?new u.LongBits(e.end.low>>>0,e.end.high>>>0).toNumber():e.end),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,a.util.toJSONOptions)},e}(),e.DataLocation=function(){var e={},t=Object.create(e);return t[e[0]="DEFAULT"]=0,t[e[1]="EXTERNAL"]=1,t}(),e}(),s.TensorShapeProto=function(){function e(e){if(this.dim=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.dim=u.emptyArray,e.create=function(t){return new e(t)},e.encode=function(e,t){if(t||(t=l.create()),null!=e.dim&&e.dim.length)for(var n=0;n<e.dim.length;++n)c.onnx.TensorShapeProto.Dimension.encode(e.dim[n],t.uint32(10).fork()).ldelim();return t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof o||(e=o.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new c.onnx.TensorShapeProto;e.pos<n;){var i=e.uint32();i>>>3==1?(r.dim&&r.dim.length||(r.dim=[]),r.dim.push(c.onnx.TensorShapeProto.Dimension.decode(e,e.uint32()))):e.skipType(7&i)}return r},e.decodeDelimited=function(e){return e instanceof o||(e=new o(e)),this.decode(e,e.uint32())},e.verify=function(e){if("object"!=typeof e||null===e)return"object expected";if(null!=e.dim&&e.hasOwnProperty("dim")){if(!Array.isArray(e.dim))return"dim: array expected";for(var t=0;t<e.dim.length;++t){var n=c.onnx.TensorShapeProto.Dimension.verify(e.dim[t]);if(n)return"dim."+n}}return null},e.fromObject=function(e){if(e instanceof c.onnx.TensorShapeProto)return e;var t=new c.onnx.TensorShapeProto;if(e.dim){if(!Array.isArray(e.dim))throw TypeError(".onnx.TensorShapeProto.dim: array expected");t.dim=[];for(var n=0;n<e.dim.length;++n){if("object"!=typeof e.dim[n])throw TypeError(".onnx.TensorShapeProto.dim: object expected");t.dim[n]=c.onnx.TensorShapeProto.Dimension.fromObject(e.dim[n])}}return t},e.toObject=function(e,t){t||(t={});var n={};if((t.arrays||t.defaults)&&(n.dim=[]),e.dim&&e.dim.length){n.dim=[];for(var r=0;r<e.dim.length;++r)n.dim[r]=c.onnx.TensorShapeProto.Dimension.toObject(e.dim[r],t)}return n},e.prototype.toJSON=function(){return this.constructor.toObject(this,a.util.toJSONOptions)},e.Dimension=function(){var e;function t(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return t.prototype.dimValue=u.Long?u.Long.fromBits(0,0,!1):0,t.prototype.dimParam="",t.prototype.denotation="",Object.defineProperty(t.prototype,"value",{get:u.oneOfGetter(e=["dimValue","dimParam"]),set:u.oneOfSetter(e)}),t.create=function(e){return new t(e)},t.encode=function(e,t){return t||(t=l.create()),null!=e.dimValue&&e.hasOwnProperty("dimValue")&&t.uint32(8).int64(e.dimValue),null!=e.dimParam&&e.hasOwnProperty("dimParam")&&t.uint32(18).string(e.dimParam),null!=e.denotation&&e.hasOwnProperty("denotation")&&t.uint32(26).string(e.denotation),t},t.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},t.decode=function(e,t){e instanceof o||(e=o.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new c.onnx.TensorShapeProto.Dimension;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.dimValue=e.int64();break;case 2:r.dimParam=e.string();break;case 3:r.denotation=e.string();break;default:e.skipType(7&i)}}return r},t.decodeDelimited=function(e){return e instanceof o||(e=new o(e)),this.decode(e,e.uint32())},t.verify=function(e){if("object"!=typeof e||null===e)return"object expected";var t={};if(null!=e.dimValue&&e.hasOwnProperty("dimValue")&&(t.value=1,!(u.isInteger(e.dimValue)||e.dimValue&&u.isInteger(e.dimValue.low)&&u.isInteger(e.dimValue.high))))return"dimValue: integer|Long expected";if(null!=e.dimParam&&e.hasOwnProperty("dimParam")){if(1===t.value)return"value: multiple values";if(t.value=1,!u.isString(e.dimParam))return"dimParam: string expected"}return null!=e.denotation&&e.hasOwnProperty("denotation")&&!u.isString(e.denotation)?"denotation: string expected":null},t.fromObject=function(e){if(e instanceof c.onnx.TensorShapeProto.Dimension)return e;var t=new c.onnx.TensorShapeProto.Dimension;return null!=e.dimValue&&(u.Long?(t.dimValue=u.Long.fromValue(e.dimValue)).unsigned=!1:"string"==typeof e.dimValue?t.dimValue=parseInt(e.dimValue,10):"number"==typeof e.dimValue?t.dimValue=e.dimValue:"object"==typeof e.dimValue&&(t.dimValue=new u.LongBits(e.dimValue.low>>>0,e.dimValue.high>>>0).toNumber())),null!=e.dimParam&&(t.dimParam=String(e.dimParam)),null!=e.denotation&&(t.denotation=String(e.denotation)),t},t.toObject=function(e,t){t||(t={});var n={};return t.defaults&&(n.denotation=""),null!=e.dimValue&&e.hasOwnProperty("dimValue")&&("number"==typeof e.dimValue?n.dimValue=t.longs===String?String(e.dimValue):e.dimValue:n.dimValue=t.longs===String?u.Long.prototype.toString.call(e.dimValue):t.longs===Number?new u.LongBits(e.dimValue.low>>>0,e.dimValue.high>>>0).toNumber():e.dimValue,t.oneofs&&(n.value="dimValue")),null!=e.dimParam&&e.hasOwnProperty("dimParam")&&(n.dimParam=e.dimParam,t.oneofs&&(n.value="dimParam")),null!=e.denotation&&e.hasOwnProperty("denotation")&&(n.denotation=e.denotation),n},t.prototype.toJSON=function(){return this.constructor.toObject(this,a.util.toJSONOptions)},t}(),e}(),s.TypeProto=function(){var e;function t(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return t.prototype.tensorType=null,t.prototype.denotation="",Object.defineProperty(t.prototype,"value",{get:u.oneOfGetter(e=["tensorType"]),set:u.oneOfSetter(e)}),t.create=function(e){return new t(e)},t.encode=function(e,t){return t||(t=l.create()),null!=e.tensorType&&e.hasOwnProperty("tensorType")&&c.onnx.TypeProto.Tensor.encode(e.tensorType,t.uint32(10).fork()).ldelim(),null!=e.denotation&&e.hasOwnProperty("denotation")&&t.uint32(50).string(e.denotation),t},t.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},t.decode=function(e,t){e instanceof o||(e=o.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new c.onnx.TypeProto;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.tensorType=c.onnx.TypeProto.Tensor.decode(e,e.uint32());break;case 6:r.denotation=e.string();break;default:e.skipType(7&i)}}return r},t.decodeDelimited=function(e){return e instanceof o||(e=new o(e)),this.decode(e,e.uint32())},t.verify=function(e){if("object"!=typeof e||null===e)return"object expected";if(null!=e.tensorType&&e.hasOwnProperty("tensorType")){var t=c.onnx.TypeProto.Tensor.verify(e.tensorType);if(t)return"tensorType."+t}return null!=e.denotation&&e.hasOwnProperty("denotation")&&!u.isString(e.denotation)?"denotation: string expected":null},t.fromObject=function(e){if(e instanceof c.onnx.TypeProto)return e;var t=new c.onnx.TypeProto;if(null!=e.tensorType){if("object"!=typeof e.tensorType)throw TypeError(".onnx.TypeProto.tensorType: object expected");t.tensorType=c.onnx.TypeProto.Tensor.fromObject(e.tensorType)}return null!=e.denotation&&(t.denotation=String(e.denotation)),t},t.toObject=function(e,t){t||(t={});var n={};return t.defaults&&(n.denotation=""),null!=e.tensorType&&e.hasOwnProperty("tensorType")&&(n.tensorType=c.onnx.TypeProto.Tensor.toObject(e.tensorType,t),t.oneofs&&(n.value="tensorType")),null!=e.denotation&&e.hasOwnProperty("denotation")&&(n.denotation=e.denotation),n},t.prototype.toJSON=function(){return this.constructor.toObject(this,a.util.toJSONOptions)},t.Tensor=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.elemType=0,e.prototype.shape=null,e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=l.create()),null!=e.elemType&&e.hasOwnProperty("elemType")&&t.uint32(8).int32(e.elemType),null!=e.shape&&e.hasOwnProperty("shape")&&c.onnx.TensorShapeProto.encode(e.shape,t.uint32(18).fork()).ldelim(),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof o||(e=o.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new c.onnx.TypeProto.Tensor;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.elemType=e.int32();break;case 2:r.shape=c.onnx.TensorShapeProto.decode(e,e.uint32());break;default:e.skipType(7&i)}}return r},e.decodeDelimited=function(e){return e instanceof o||(e=new o(e)),this.decode(e,e.uint32())},e.verify=function(e){if("object"!=typeof e||null===e)return"object expected";if(null!=e.elemType&&e.hasOwnProperty("elemType")&&!u.isInteger(e.elemType))return"elemType: integer expected";if(null!=e.shape&&e.hasOwnProperty("shape")){var t=c.onnx.TensorShapeProto.verify(e.shape);if(t)return"shape."+t}return null},e.fromObject=function(e){if(e instanceof c.onnx.TypeProto.Tensor)return e;var t=new c.onnx.TypeProto.Tensor;if(null!=e.elemType&&(t.elemType=0|e.elemType),null!=e.shape){if("object"!=typeof e.shape)throw TypeError(".onnx.TypeProto.Tensor.shape: object expected");t.shape=c.onnx.TensorShapeProto.fromObject(e.shape)}return t},e.toObject=function(e,t){t||(t={});var n={};return t.defaults&&(n.elemType=0,n.shape=null),null!=e.elemType&&e.hasOwnProperty("elemType")&&(n.elemType=e.elemType),null!=e.shape&&e.hasOwnProperty("shape")&&(n.shape=c.onnx.TensorShapeProto.toObject(e.shape,t)),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,a.util.toJSONOptions)},e}(),t}(),s.OperatorSetIdProto=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.domain="",e.prototype.version=u.Long?u.Long.fromBits(0,0,!1):0,e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=l.create()),null!=e.domain&&e.hasOwnProperty("domain")&&t.uint32(10).string(e.domain),null!=e.version&&e.hasOwnProperty("version")&&t.uint32(16).int64(e.version),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof o||(e=o.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new c.onnx.OperatorSetIdProto;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.domain=e.string();break;case 2:r.version=e.int64();break;default:e.skipType(7&i)}}return r},e.decodeDelimited=function(e){return e instanceof o||(e=new o(e)),this.decode(e,e.uint32())},e.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.domain&&e.hasOwnProperty("domain")&&!u.isString(e.domain)?"domain: string expected":null!=e.version&&e.hasOwnProperty("version")&&!(u.isInteger(e.version)||e.version&&u.isInteger(e.version.low)&&u.isInteger(e.version.high))?"version: integer|Long expected":null},e.fromObject=function(e){if(e instanceof c.onnx.OperatorSetIdProto)return e;var t=new c.onnx.OperatorSetIdProto;return null!=e.domain&&(t.domain=String(e.domain)),null!=e.version&&(u.Long?(t.version=u.Long.fromValue(e.version)).unsigned=!1:"string"==typeof e.version?t.version=parseInt(e.version,10):"number"==typeof e.version?t.version=e.version:"object"==typeof e.version&&(t.version=new u.LongBits(e.version.low>>>0,e.version.high>>>0).toNumber())),t},e.toObject=function(e,t){t||(t={});var n={};if(t.defaults){if(n.domain="",u.Long){var r=new u.Long(0,0,!1);n.version=t.longs===String?r.toString():t.longs===Number?r.toNumber():r}else n.version=t.longs===String?"0":0}return null!=e.domain&&e.hasOwnProperty("domain")&&(n.domain=e.domain),null!=e.version&&e.hasOwnProperty("version")&&("number"==typeof e.version?n.version=t.longs===String?String(e.version):e.version:n.version=t.longs===String?u.Long.prototype.toString.call(e.version):t.longs===Number?new u.LongBits(e.version.low>>>0,e.version.high>>>0).toNumber():e.version),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,a.util.toJSONOptions)},e}(),s),e.exports=c},2100:(e,t,n)=>{"use strict";e.exports=n(9482)},9482:(e,t,n)=>{"use strict";var r=t;function i(){r.util._configure(),r.Writer._configure(r.BufferWriter),r.Reader._configure(r.BufferReader)}r.build="minimal",r.Writer=n(1173),r.BufferWriter=n(3155),r.Reader=n(1408),r.BufferReader=n(593),r.util=n(9693),r.rpc=n(5994),r.roots=n(5054),r.configure=i,i()},1408:(e,t,n)=>{"use strict";e.exports=l;var r,i=n(9693),s=i.LongBits,a=i.utf8;function o(e,t){return RangeError("index out of range: "+e.pos+" + "+(t||1)+" > "+e.len)}function l(e){this.buf=e,this.pos=0,this.len=e.length}var u,c="undefined"!=typeof Uint8Array?function(e){if(e instanceof Uint8Array||Array.isArray(e))return new l(e);throw Error("illegal buffer")}:function(e){if(Array.isArray(e))return new l(e);throw Error("illegal buffer")},h=function(){return i.Buffer?function(e){return(l.create=function(e){return i.Buffer.isBuffer(e)?new r(e):c(e)})(e)}:c};function d(){var e=new s(0,0),t=0;if(!(this.len-this.pos>4)){for(;t<3;++t){if(this.pos>=this.len)throw o(this);if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*t)>>>0,this.buf[this.pos++]<128)return e}return e.lo=(e.lo|(127&this.buf[this.pos++])<<7*t)>>>0,e}for(;t<4;++t)if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*t)>>>0,this.buf[this.pos++]<128)return e;if(e.lo=(e.lo|(127&this.buf[this.pos])<<28)>>>0,e.hi=(e.hi|(127&this.buf[this.pos])>>4)>>>0,this.buf[this.pos++]<128)return e;if(t=0,this.len-this.pos>4){for(;t<5;++t)if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*t+3)>>>0,this.buf[this.pos++]<128)return e}else for(;t<5;++t){if(this.pos>=this.len)throw o(this);if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*t+3)>>>0,this.buf[this.pos++]<128)return e}throw Error("invalid varint encoding")}function p(e,t){return(e[t-4]|e[t-3]<<8|e[t-2]<<16|e[t-1]<<24)>>>0}function f(){if(this.pos+8>this.len)throw o(this,8);return new s(p(this.buf,this.pos+=4),p(this.buf,this.pos+=4))}l.create=h(),l.prototype._slice=i.Array.prototype.subarray||i.Array.prototype.slice,l.prototype.uint32=(u=0xffffffff,function(){if(u=(127&this.buf[this.pos])>>>0,this.buf[this.pos++]<128||(u=(u|(127&this.buf[this.pos])<<7)>>>0,this.buf[this.pos++]<128)||(u=(u|(127&this.buf[this.pos])<<14)>>>0,this.buf[this.pos++]<128)||(u=(u|(127&this.buf[this.pos])<<21)>>>0,this.buf[this.pos++]<128)||(u=(u|(15&this.buf[this.pos])<<28)>>>0,this.buf[this.pos++]<128))return u;if((this.pos+=5)>this.len)throw this.pos=this.len,o(this,10);return u}),l.prototype.int32=function(){return 0|this.uint32()},l.prototype.sint32=function(){var e=this.uint32();return e>>>1^-(1&e)|0},l.prototype.bool=function(){return 0!==this.uint32()},l.prototype.fixed32=function(){if(this.pos+4>this.len)throw o(this,4);return p(this.buf,this.pos+=4)},l.prototype.sfixed32=function(){if(this.pos+4>this.len)throw o(this,4);return 0|p(this.buf,this.pos+=4)},l.prototype.float=function(){if(this.pos+4>this.len)throw o(this,4);var e=i.float.readFloatLE(this.buf,this.pos);return this.pos+=4,e},l.prototype.double=function(){if(this.pos+8>this.len)throw o(this,4);var e=i.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,e},l.prototype.bytes=function(){var e=this.uint32(),t=this.pos,n=this.pos+e;if(n>this.len)throw o(this,e);return this.pos+=e,Array.isArray(this.buf)?this.buf.slice(t,n):t===n?new this.buf.constructor(0):this._slice.call(this.buf,t,n)},l.prototype.string=function(){var e=this.bytes();return a.read(e,0,e.length)},l.prototype.skip=function(e){if("number"==typeof e){if(this.pos+e>this.len)throw o(this,e);this.pos+=e}else do if(this.pos>=this.len)throw o(this);while(128&this.buf[this.pos++]);return this},l.prototype.skipType=function(e){switch(e){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;4!=(e=7&this.uint32());)this.skipType(e);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+e+" at offset "+this.pos)}return this},l._configure=function(e){r=e,l.create=h(),r._configure();var t=i.Long?"toLong":"toNumber";i.merge(l.prototype,{int64:function(){return d.call(this)[t](!1)},uint64:function(){return d.call(this)[t](!0)},sint64:function(){return d.call(this).zzDecode()[t](!1)},fixed64:function(){return f.call(this)[t](!0)},sfixed64:function(){return f.call(this)[t](!1)}})}},593:(e,t,n)=>{"use strict";e.exports=s;var r=n(1408);(s.prototype=Object.create(r.prototype)).constructor=s;var i=n(9693);function s(e){r.call(this,e)}s._configure=function(){i.Buffer&&(s.prototype._slice=i.Buffer.prototype.slice)},s.prototype.string=function(){var e=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+e,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+e,this.len))},s._configure()},5054:e=>{"use strict";e.exports={}},5994:(e,t,n)=>{"use strict";t.Service=n(7948)},7948:(e,t,n)=>{"use strict";e.exports=i;var r=n(9693);function i(e,t,n){if("function"!=typeof e)throw TypeError("rpcImpl must be a function");r.EventEmitter.call(this),this.rpcImpl=e,this.requestDelimited=!!t,this.responseDelimited=!!n}(i.prototype=Object.create(r.EventEmitter.prototype)).constructor=i,i.prototype.rpcCall=function e(t,n,i,s,a){if(!s)throw TypeError("request must be specified");var o=this;if(!a)return r.asPromise(e,o,t,n,i,s);if(o.rpcImpl)try{return o.rpcImpl(t,n[o.requestDelimited?"encodeDelimited":"encode"](s).finish(),function(e,n){if(e)return o.emit("error",e,t),a(e);if(null!==n){if(!(n instanceof i))try{n=i[o.responseDelimited?"decodeDelimited":"decode"](n)}catch(e){return o.emit("error",e,t),a(e)}return o.emit("data",n,t),a(null,n)}o.end(!0)})}catch(e){return o.emit("error",e,t),void setTimeout(function(){a(e)},0)}else setTimeout(function(){a(Error("already ended"))},0)},i.prototype.end=function(e){return this.rpcImpl&&(e||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this}},1945:(e,t,n)=>{"use strict";e.exports=i;var r=n(9693);function i(e,t){this.lo=e>>>0,this.hi=t>>>0}var s=i.zero=new i(0,0);s.toNumber=function(){return 0},s.zzEncode=s.zzDecode=function(){return this},s.length=function(){return 1};var a=i.zeroHash="\0\0\0\0\0\0\0\0";i.fromNumber=function(e){if(0===e)return s;var t=e<0;t&&(e=-e);var n=e>>>0,r=(e-n)/0x100000000>>>0;return t&&(r=~r>>>0,n=~n>>>0,++n>0xffffffff&&(n=0,++r>0xffffffff&&(r=0))),new i(n,r)},i.from=function(e){if("number"==typeof e)return i.fromNumber(e);if(r.isString(e)){if(!r.Long)return i.fromNumber(parseInt(e,10));e=r.Long.fromString(e)}return e.low||e.high?new i(e.low>>>0,e.high>>>0):s},i.prototype.toNumber=function(e){if(!e&&this.hi>>>31){var t=1+~this.lo>>>0,n=~this.hi>>>0;return t||(n=n+1>>>0),-(t+0x100000000*n)}return this.lo+0x100000000*this.hi},i.prototype.toLong=function(e){return r.Long?new r.Long(0|this.lo,0|this.hi,!!e):{low:0|this.lo,high:0|this.hi,unsigned:!!e}};var o=String.prototype.charCodeAt;i.fromHash=function(e){return e===a?s:new i((o.call(e,0)|o.call(e,1)<<8|o.call(e,2)<<16|o.call(e,3)<<24)>>>0,(o.call(e,4)|o.call(e,5)<<8|o.call(e,6)<<16|o.call(e,7)<<24)>>>0)},i.prototype.toHash=function(){return String.fromCharCode(255&this.lo,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,255&this.hi,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)},i.prototype.zzEncode=function(){var e=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^e)>>>0,this.lo=(this.lo<<1^e)>>>0,this},i.prototype.zzDecode=function(){var e=-(1&this.lo);return this.lo=((this.lo>>>1|this.hi<<31)^e)>>>0,this.hi=(this.hi>>>1^e)>>>0,this},i.prototype.length=function(){var e=this.lo,t=(this.lo>>>28|this.hi<<4)>>>0,n=this.hi>>>24;return 0===n?0===t?e<16384?e<128?1:2:e<2097152?3:4:t<16384?t<128?5:6:t<2097152?7:8:n<128?9:10}},9693:function(e,t,n){"use strict";var r=t;function i(e,t,n){for(var r=Object.keys(t),i=0;i<r.length;++i)void 0!==e[r[i]]&&n||(e[r[i]]=t[r[i]]);return e}function s(e){function t(e,n){if(!(this instanceof t))return new t(e,n);Object.defineProperty(this,"message",{get:function(){return e}}),Error.captureStackTrace?Error.captureStackTrace(this,t):Object.defineProperty(this,"stack",{value:Error().stack||""}),n&&i(this,n)}return(t.prototype=Object.create(Error.prototype)).constructor=t,Object.defineProperty(t.prototype,"name",{get:function(){return e}}),t.prototype.toString=function(){return this.name+": "+this.message},t}r.asPromise=n(4537),r.base64=n(7419),r.EventEmitter=n(9211),r.float=n(945),r.inquire=n(7199),r.utf8=n(4997),r.pool=n(6662),r.LongBits=n(1945),r.isNode=!!(void 0!==n.g&&n.g&&n.g.process&&n.g.process.versions&&n.g.process.versions.node),r.global=r.isNode&&n.g||"undefined"!=typeof window&&window||"undefined"!=typeof self&&self||this,r.emptyArray=Object.freeze?Object.freeze([]):[],r.emptyObject=Object.freeze?Object.freeze({}):{},r.isInteger=Number.isInteger||function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e},r.isString=function(e){return"string"==typeof e||e instanceof String},r.isObject=function(e){return e&&"object"==typeof e},r.isset=r.isSet=function(e,t){var n=e[t];return!(null==n||!e.hasOwnProperty(t))&&("object"!=typeof n||(Array.isArray(n)?n.length:Object.keys(n).length)>0)},r.Buffer=function(){try{var e=r.inquire("buffer").Buffer;return e.prototype.utf8Write?e:null}catch(e){return null}}(),r._Buffer_from=null,r._Buffer_allocUnsafe=null,r.newBuffer=function(e){return"number"==typeof e?r.Buffer?r._Buffer_allocUnsafe(e):new r.Array(e):r.Buffer?r._Buffer_from(e):"undefined"==typeof Uint8Array?e:new Uint8Array(e)},r.Array="undefined"!=typeof Uint8Array?Uint8Array:Array,r.Long=r.global.dcodeIO&&r.global.dcodeIO.Long||r.global.Long||r.inquire("long"),r.key2Re=/^true|false|0|1$/,r.key32Re=/^-?(?:0|[1-9][0-9]*)$/,r.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/,r.longToHash=function(e){return e?r.LongBits.from(e).toHash():r.LongBits.zeroHash},r.longFromHash=function(e,t){var n=r.LongBits.fromHash(e);return r.Long?r.Long.fromBits(n.lo,n.hi,t):n.toNumber(!!t)},r.merge=i,r.lcFirst=function(e){return e.charAt(0).toLowerCase()+e.substring(1)},r.newError=s,r.ProtocolError=s("ProtocolError"),r.oneOfGetter=function(e){for(var t={},n=0;n<e.length;++n)t[e[n]]=1;return function(){for(var e=Object.keys(this),n=e.length-1;n>-1;--n)if(1===t[e[n]]&&void 0!==this[e[n]]&&null!==this[e[n]])return e[n]}},r.oneOfSetter=function(e){return function(t){for(var n=0;n<e.length;++n)e[n]!==t&&delete this[e[n]]}},r.toJSONOptions={longs:String,enums:String,bytes:String,json:!0},r._configure=function(){var e=r.Buffer;e?(r._Buffer_from=e.from!==Uint8Array.from&&e.from||function(t,n){return new e(t,n)},r._Buffer_allocUnsafe=e.allocUnsafe||function(t){return new e(t)}):r._Buffer_from=r._Buffer_allocUnsafe=null}},1173:(e,t,n)=>{"use strict";e.exports=h;var r,i=n(9693),s=i.LongBits,a=i.base64,o=i.utf8;function l(e,t,n){this.fn=e,this.len=t,this.next=void 0,this.val=n}function u(){}function c(e){this.head=e.head,this.tail=e.tail,this.len=e.len,this.next=e.states}function h(){this.len=0,this.head=new l(u,0,0),this.tail=this.head,this.states=null}var d=function(){return i.Buffer?function(){return(h.create=function(){return new r})()}:function(){return new h}};function p(e,t,n){t[n]=255&e}function f(e,t){this.len=e,this.next=void 0,this.val=t}function g(e,t,n){for(;e.hi;)t[n++]=127&e.lo|128,e.lo=(e.lo>>>7|e.hi<<25)>>>0,e.hi>>>=7;for(;e.lo>127;)t[n++]=127&e.lo|128,e.lo=e.lo>>>7;t[n++]=e.lo}function m(e,t,n){t[n]=255&e,t[n+1]=e>>>8&255,t[n+2]=e>>>16&255,t[n+3]=e>>>24}h.create=d(),h.alloc=function(e){return new i.Array(e)},i.Array!==Array&&(h.alloc=i.pool(h.alloc,i.Array.prototype.subarray)),h.prototype._push=function(e,t,n){return this.tail=this.tail.next=new l(e,t,n),this.len+=t,this},f.prototype=Object.create(l.prototype),f.prototype.fn=function(e,t,n){for(;e>127;)t[n++]=127&e|128,e>>>=7;t[n]=e},h.prototype.uint32=function(e){return this.len+=(this.tail=this.tail.next=new f((e>>>=0)<128?1:e<16384?2:e<2097152?3:e<0x10000000?4:5,e)).len,this},h.prototype.int32=function(e){return e<0?this._push(g,10,s.fromNumber(e)):this.uint32(e)},h.prototype.sint32=function(e){return this.uint32((e<<1^e>>31)>>>0)},h.prototype.uint64=function(e){var t=s.from(e);return this._push(g,t.length(),t)},h.prototype.int64=h.prototype.uint64,h.prototype.sint64=function(e){var t=s.from(e).zzEncode();return this._push(g,t.length(),t)},h.prototype.bool=function(e){return this._push(p,1,e?1:0)},h.prototype.fixed32=function(e){return this._push(m,4,e>>>0)},h.prototype.sfixed32=h.prototype.fixed32,h.prototype.fixed64=function(e){var t=s.from(e);return this._push(m,4,t.lo)._push(m,4,t.hi)},h.prototype.sfixed64=h.prototype.fixed64,h.prototype.float=function(e){return this._push(i.float.writeFloatLE,4,e)},h.prototype.double=function(e){return this._push(i.float.writeDoubleLE,8,e)};var y=i.Array.prototype.set?function(e,t,n){t.set(e,n)}:function(e,t,n){for(var r=0;r<e.length;++r)t[n+r]=e[r]};h.prototype.bytes=function(e){var t=e.length>>>0;if(!t)return this._push(p,1,0);if(i.isString(e)){var n=h.alloc(t=a.length(e));a.decode(e,n,0),e=n}return this.uint32(t)._push(y,t,e)},h.prototype.string=function(e){var t=o.length(e);return t?this.uint32(t)._push(o.write,t,e):this._push(p,1,0)},h.prototype.fork=function(){return this.states=new c(this),this.head=this.tail=new l(u,0,0),this.len=0,this},h.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new l(u,0,0),this.len=0),this},h.prototype.ldelim=function(){var e=this.head,t=this.tail,n=this.len;return this.reset().uint32(n),n&&(this.tail.next=e.next,this.tail=t,this.len+=n),this},h.prototype.finish=function(){for(var e=this.head.next,t=this.constructor.alloc(this.len),n=0;e;)e.fn(e.val,t,n),n+=e.len,e=e.next;return t},h._configure=function(e){r=e,h.create=d(),r._configure()}},3155:(e,t,n)=>{"use strict";e.exports=s;var r=n(1173);(s.prototype=Object.create(r.prototype)).constructor=s;var i=n(9693);function s(){r.call(this)}function a(e,t,n){e.length<40?i.utf8.write(e,t,n):t.utf8Write?t.utf8Write(e,n):t.write(e,n)}s._configure=function(){s.alloc=i._Buffer_allocUnsafe,s.writeBytesBuffer=i.Buffer&&i.Buffer.prototype instanceof Uint8Array&&"set"===i.Buffer.prototype.set.name?function(e,t,n){t.set(e,n)}:function(e,t,n){if(e.copy)e.copy(t,n,0,e.length);else for(var r=0;r<e.length;)t[n++]=e[r++]}},s.prototype.bytes=function(e){i.isString(e)&&(e=i._Buffer_from(e,"base64"));var t=e.length>>>0;return this.uint32(t),t&&this._push(s.writeBytesBuffer,t,e),this},s.prototype.string=function(e){var t=i.Buffer.byteLength(e);return this.uint32(t),t&&this._push(a,t,e),this},s._configure()},7714:(e,t,n)=>{"use strict";t.R=void 0;let r=n(6919),i=n(7448);t.R=new class{async init(){}async createSessionHandler(e,t){let n=new r.Session(t);return await n.loadModel(e),new i.OnnxjsSessionHandler(n)}}},4200:(e,t,n)=>{"use strict";t.c8=t.rX=void 0;let r=n(1670),i=n(5381),s=n(2157),a=n(2306);t.rX=()=>{if(("number"!=typeof r.env.wasm.initTimeout||r.env.wasm.initTimeout<0)&&(r.env.wasm.initTimeout=0),"boolean"!=typeof r.env.wasm.simd&&(r.env.wasm.simd=!0),"boolean"!=typeof r.env.wasm.proxy&&(r.env.wasm.proxy=!1),"number"!=typeof r.env.wasm.numThreads||!Number.isInteger(r.env.wasm.numThreads)||r.env.wasm.numThreads<=0){let e="undefined"==typeof navigator?(0,i.cpus)().length:navigator.hardwareConcurrency;r.env.wasm.numThreads=Math.min(4,Math.ceil((e||1)/2))}},t.c8=new class{async init(){(0,t.rX)(),await (0,s.initWasm)()}async createSessionHandler(e,t){let n=new a.OnnxruntimeWebAssemblySessionHandler;return await n.loadModel(e,t),Promise.resolve(n)}}},6018:function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var i=Object.getOwnPropertyDescriptor(t,n);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,i)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),i=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||r(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),i(n(1670),t);let s=n(1670);{let e=n(7714).R;(0,s.registerBackend)("webgl",e,-10)}{let e=n(4200).c8;(0,s.registerBackend)("cpu",e,10),(0,s.registerBackend)("wasm",e,10),(0,s.registerBackend)("xnnpack",e,9)}},246:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createAttributeWithCacheKey=void 0;class n{constructor(e){Object.assign(this,e)}get cacheKey(){return this._cacheKey||(this._cacheKey=Object.getOwnPropertyNames(this).sort().map(e=>`${this[e]}`).join(";")),this._cacheKey}}t.createAttributeWithCacheKey=e=>new n(e)},7778:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Attribute=void 0;let r=n(1446),i=n(9395),s=n(9162),a=n(2517);var o=i.onnxruntime.experimental.fbs;class l{constructor(e){if(this._attributes=new Map,null!=e){for(let t of e)t instanceof r.onnx.AttributeProto?this._attributes.set(t.name,[l.getValue(t),l.getType(t)]):t instanceof o.Attribute&&this._attributes.set(t.name(),[l.getValue(t),l.getType(t)]);if(this._attributes.size<e.length)throw Error("duplicated attribute names")}}set(e,t,n){this._attributes.set(e,[n,t])}delete(e){this._attributes.delete(e)}getFloat(e,t){return this.get(e,"float",t)}getInt(e,t){return this.get(e,"int",t)}getString(e,t){return this.get(e,"string",t)}getTensor(e,t){return this.get(e,"tensor",t)}getFloats(e,t){return this.get(e,"floats",t)}getInts(e,t){return this.get(e,"ints",t)}getStrings(e,t){return this.get(e,"strings",t)}getTensors(e,t){return this.get(e,"tensors",t)}get(e,t,n){let r=this._attributes.get(e);if(void 0===r){if(void 0!==n)return n;throw Error(`required attribute not found: ${e}`)}if(r[1]!==t)throw Error(`type mismatch: expected ${t} but got ${r[1]}`);return r[0]}static getType(e){let t=e instanceof r.onnx.AttributeProto?e.type:e.type();switch(t){case r.onnx.AttributeProto.AttributeType.FLOAT:return"float";case r.onnx.AttributeProto.AttributeType.INT:return"int";case r.onnx.AttributeProto.AttributeType.STRING:return"string";case r.onnx.AttributeProto.AttributeType.TENSOR:return"tensor";case r.onnx.AttributeProto.AttributeType.FLOATS:return"floats";case r.onnx.AttributeProto.AttributeType.INTS:return"ints";case r.onnx.AttributeProto.AttributeType.STRINGS:return"strings";case r.onnx.AttributeProto.AttributeType.TENSORS:return"tensors";default:throw Error(`attribute type is not supported yet: ${r.onnx.AttributeProto.AttributeType[t]}`)}}static getValue(e){let t=e instanceof r.onnx.AttributeProto?e.type:e.type();if(t===r.onnx.AttributeProto.AttributeType.GRAPH||t===r.onnx.AttributeProto.AttributeType.GRAPHS)throw Error("graph attribute is not supported yet");let n=this.getValueNoCheck(e);if(t===r.onnx.AttributeProto.AttributeType.INT&&a.LongUtil.isLong(n))return a.LongUtil.longToNumber(n);if(t===r.onnx.AttributeProto.AttributeType.INTS){let e=n,t=Array(e.length);for(let n=0;n<e.length;n++){let r=e[n];t[n]=a.LongUtil.longToNumber(r)}return t}if(t===r.onnx.AttributeProto.AttributeType.TENSOR)return e instanceof r.onnx.AttributeProto?s.Tensor.fromProto(n):s.Tensor.fromOrtTensor(n);if(t===r.onnx.AttributeProto.AttributeType.TENSORS){if(e instanceof r.onnx.AttributeProto)return n.map(e=>s.Tensor.fromProto(e));if(e instanceof o.Attribute)return n.map(e=>s.Tensor.fromOrtTensor(e))}if(t===r.onnx.AttributeProto.AttributeType.STRING&&e instanceof r.onnx.AttributeProto){let e=n;return(0,a.decodeUtf8String)(e)}return t===r.onnx.AttributeProto.AttributeType.STRINGS&&e instanceof r.onnx.AttributeProto?n.map(a.decodeUtf8String):n}static getValueNoCheck(e){return e instanceof r.onnx.AttributeProto?this.getValueNoCheckFromOnnxFormat(e):this.getValueNoCheckFromOrtFormat(e)}static getValueNoCheckFromOnnxFormat(e){switch(e.type){case r.onnx.AttributeProto.AttributeType.FLOAT:return e.f;case r.onnx.AttributeProto.AttributeType.INT:return e.i;case r.onnx.AttributeProto.AttributeType.STRING:return e.s;case r.onnx.AttributeProto.AttributeType.TENSOR:return e.t;case r.onnx.AttributeProto.AttributeType.GRAPH:return e.g;case r.onnx.AttributeProto.AttributeType.FLOATS:return e.floats;case r.onnx.AttributeProto.AttributeType.INTS:return e.ints;case r.onnx.AttributeProto.AttributeType.STRINGS:return e.strings;case r.onnx.AttributeProto.AttributeType.TENSORS:return e.tensors;case r.onnx.AttributeProto.AttributeType.GRAPHS:return e.graphs;default:throw Error(`unsupported attribute type: ${r.onnx.AttributeProto.AttributeType[e.type]}`)}}static getValueNoCheckFromOrtFormat(e){switch(e.type()){case o.AttributeType.FLOAT:return e.f();case o.AttributeType.INT:return e.i();case o.AttributeType.STRING:return e.s();case o.AttributeType.TENSOR:return e.t();case o.AttributeType.GRAPH:return e.g();case o.AttributeType.FLOATS:return e.floatsArray();case o.AttributeType.INTS:{let t=[];for(let n=0;n<e.intsLength();n++)t.push(e.ints(n));return t}case o.AttributeType.STRINGS:{let t=[];for(let n=0;n<e.stringsLength();n++)t.push(e.strings(n));return t}case o.AttributeType.TENSORS:{let t=[];for(let n=0;n<e.tensorsLength();n++)t.push(e.tensors(n));return t}default:throw Error(`unsupported attribute type: ${o.AttributeType[e.type()]}`)}}}t.Attribute=l},7091:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.resolveBackend=t.backend=void 0;let r=n(5038),i=new Map;async function s(e){let n=t.backend;if(void 0!==n[e]&&function(e){let t=e;return"initialize"in t&&"function"==typeof t.initialize&&"createSessionHandler"in t&&"function"==typeof t.createSessionHandler&&"dispose"in t&&"function"==typeof t.dispose}(n[e])){let t=n[e],r=t.initialize();if("object"==typeof r&&"then"in r&&(r=await r),r)return i.set(e,t),t}}t.backend={webgl:new r.WebGLBackend},t.resolveBackend=async function e(t){if(!t)return e(["webgl"]);for(let e of"string"==typeof t?[t]:t){let t=i.get(e);if(t)return t;let n=await s(e);if(n)return n}throw Error("no available backend to use")}},5038:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WebGLBackend=void 0;let r=n(1670),i=n(6231),s=n(6416),a=n(7305);t.WebGLBackend=class{get contextId(){return r.env.webgl.contextId}set contextId(e){r.env.webgl.contextId=e}get matmulMaxBatchSize(){return r.env.webgl.matmulMaxBatchSize}set matmulMaxBatchSize(e){r.env.webgl.matmulMaxBatchSize=e}get textureCacheMode(){return r.env.webgl.textureCacheMode}set textureCacheMode(e){r.env.webgl.textureCacheMode=e}get pack(){return r.env.webgl.pack}set pack(e){r.env.webgl.pack=e}get async(){return r.env.webgl.async}set async(e){r.env.webgl.async=e}initialize(){try{return this.glContext=(0,a.createWebGLContext)(this.contextId),"number"!=typeof this.matmulMaxBatchSize&&(this.matmulMaxBatchSize=16),"string"!=typeof this.textureCacheMode&&(this.textureCacheMode="full"),"boolean"!=typeof this.pack&&(this.pack=!1),"boolean"!=typeof this.async&&(this.async=!1),i.Logger.setWithEnv(r.env),i.Logger.verbose("WebGLBackend",`Created WebGLContext: ${typeof this.glContext} with matmulMaxBatchSize: ${this.matmulMaxBatchSize}; textureCacheMode: ${this.textureCacheMode}; pack: ${this.pack}; async: ${this.async}.`),!0}catch(e){return i.Logger.warning("WebGLBackend",`Unable to initialize WebGLBackend. ${e}`),!1}}createSessionHandler(e){return new s.WebGLSessionHandler(this,e)}dispose(){this.glContext.dispose()}}},5107:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CoordsGlslLib=void 0;let r=n(2517),i=n(8520),s=n(5060),a=n(7859),o=n(9390);class l extends i.GlslLib{constructor(e){super(e)}getFunctions(){return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},this.offsetToCoords()),this.coordsToOffset()),this.toVec()),this.valueFrom()),this.getCommonUtilFuncs()),this.getInputsSamplingSnippets()),this.getOutputSamplingSnippet())}getCustomTypes(){return{}}offsetToCoords(){return{offsetToCoords:new i.GlslLibRoutine("\n      vec2 offsetToCoords(int offset, int width, int height) {\n        int t = offset / width;\n        int s = offset - t*width;\n        vec2 coords = (vec2(s,t) + vec2(0.5,0.5)) / vec2(width, height);\n        return coords;\n      }\n      ")}}coordsToOffset(){return{coordsToOffset:new i.GlslLibRoutine("\n      int coordsToOffset(vec2 coords, int width, int height) {\n        float s = coords.s * float(width);\n        float t = coords.t * float(height);\n        int offset = int(t) * width + int(s);\n        return offset;\n      }\n      ")}}getOutputSamplingSnippet(){let e=this.context.outputTextureLayout;return e.isPacked?this.getPackedOutputSamplingSnippet(e):this.getUnpackedOutputSamplingSnippet(e)}getPackedOutputSamplingSnippet(e){let t=e.unpackedShape,n=[e.width,e.height],r={},a="getOutputCoords";switch(t.length){case 0:r[a]=this.getOutputScalarCoords();break;case 1:r[a]=this.getOutputPacked1DCoords(t,n);break;case 2:r[a]=this.getOutputPacked2DCoords(t,n);break;case 3:r[a]=this.getOutputPacked3DCoords(t,n);break;default:r[a]=this.getOutputPackedNDCoords(t,n)}let o=`
      void setOutput(vec4 val) {
        ${(0,s.getGlsl)(this.context.glContext.version).output} = val;
      }
    `;return r.floatTextureSetRGBA=new i.GlslLibRoutine(o),r}getUnpackedOutputSamplingSnippet(e){let t=e.unpackedShape,n=[e.width,e.height],r={},a="getOutputCoords";switch(t.length){case 0:r[a]=this.getOutputScalarCoords();break;case 1:r[a]=this.getOutputUnpacked1DCoords(t,n);break;case 2:r[a]=this.getOutputUnpacked2DCoords(t,n);break;case 3:r[a]=this.getOutputUnpacked3DCoords(t,n);break;case 4:r[a]=this.getOutputUnpacked4DCoords(t,n);break;case 5:r[a]=this.getOutputUnpacked5DCoords(t,n);break;case 6:r[a]=this.getOutputUnpacked6DCoords(t,n);break;default:throw Error(`Unsupported output dimensionality: ${t.length}`)}let o=`
        void setOutput(float val) {
          ${(0,s.getGlsl)(this.context.glContext.version).output} = vec4(val, 0, 0, 0);
        }
    `;return r.floatTextureSetR=new i.GlslLibRoutine(o),r}getOutputScalarCoords(){return new i.GlslLibRoutine("\n      int getOutputCoords() {\n        return 0;\n      }\n    ")}getOutputPacked1DCoords(e,t){let n=t,r="";return r=1===n[0]?`
          int getOutputCoords() {
            return 2 * int(TexCoords.y * ${n[1]}.0);
          }
        `:1===n[1]?`
          int getOutputCoords() {
            return 2 * int(TexCoords.x * ${n[0]}.0);
          }
        `:`
        int getOutputCoords() {
          ivec2 resTexRC = ivec2(TexCoords.xy *
                                 vec2(${n[0]}, ${n[1]}));
          return 2 * (resTexRC.y * ${n[0]} + resTexRC.x);
        }
      `,new i.GlslLibRoutine(r)}getOutputPacked2DCoords(e,t){let n="";if(r.ArrayUtil.arraysEqual(e,t))return n=`
        ivec2 getOutputCoords() {
          return 2 * ivec2(TexCoords.xy * vec2(${t[0]}, ${t[1]}));
        }
      `,new i.GlslLibRoutine(n);let s=t,a=Math.ceil(e[1]/2);return n=`
        ivec2 getOutputCoords() {
          ivec2 resTexRC = ivec2(TexCoords.xy *
                                vec2(${s[0]}, ${s[1]}));

          int index = resTexRC.y * ${s[0]} + resTexRC.x;

          // reverse r and c order for packed texture
          int r = imod(index, ${a}) * 2;
          int c = 2 * (index / ${a});

          return ivec2(r, c);
        }
      `,new i.GlslLibRoutine(n)}getOutputPacked3DCoords(e,t){let n=[t[0],t[1]],r=Math.ceil(e[2]/2),s=r*Math.ceil(e[1]/2),a=`
        ivec3 getOutputCoords() {
          ivec2 resTexRC = ivec2(TexCoords.xy *
                                vec2(${n[0]}, ${n[1]}));
          int index = resTexRC.y * ${n[0]} + resTexRC.x;

          int b = index / ${s};
          index -= b * ${s};

          // reverse r and c order for packed texture
          int r = imod(index, ${r}) * 2;
          int c = 2 * (index / ${r});

          return ivec3(b, r, c);
        }
      `;return new i.GlslLibRoutine(a)}getOutputPackedNDCoords(e,t){let n=[t[0],t[1]],r=Math.ceil(e[e.length-1]/2),s=r*Math.ceil(e[e.length-2]/2),a=s,o="",l="b, r, c";for(let t=2;t<e.length-1;t++)a*=e[e.length-t-1],o=`
      int b${t} = index / ${a};
      index -= b${t} * ${a};
    `+o,l=`b${t}, `+l;let u=`
      ivec${e.length} getOutputCoords() {
        ivec2 resTexRC = ivec2(TexCoords.xy *
                              vec2(${n[0]}, ${n[1]}));
        int index = resTexRC.y * ${n[0]} + resTexRC.x;

        ${o}

        int b = index / ${s};
        index -= b * ${s};

        // reverse r and c order for packed texture
        int r = imod(index, ${r}) * 2;
        int c = 2 * (index / ${r});

        return ivec${e.length}(${l});
      }
    `;return new i.GlslLibRoutine(u)}getOutputUnpacked1DCoords(e,t){let n=`
        int getOutputCoords() {
          ivec2 resTexRC = ivec2(TexCoords.xy *
                                vec2(${t[0]}, ${t[1]}));
          return resTexRC.y * ${t[0]} + resTexRC.x;
        }
      `;return new i.GlslLibRoutine(n)}getOutputUnpacked2DCoords(e,t){let n=`
        ivec2 getOutputCoords() {
          ivec2 resTexRC = ivec2(TexCoords.xy *
                                vec2(${t[0]}, ${t[1]}));
          int index = resTexRC.y * ${t[0]} + resTexRC.x;
          int r = index / ${e[1]};
          int c = index - r * ${e[1]};
          return ivec2(r, c);
        }
      `;return new i.GlslLibRoutine(n)}getOutputUnpacked3DCoords(e,t){let n="",r=e.length,s=null;r<2&&(s=[]),(s=Array(r-1))[r-2]=e[r-1];for(let t=r-3;t>=0;--t)s[t]=s[t+1]*e[t+1];let a=["r","c","d"],o=s.map((e,t)=>`int ${a[t]} = index / ${e}; ${t===s.length-1?`int ${a[t+1]} = index - ${a[t]} * ${e}`:`index -= ${a[t]} * ${e}`};`).join("");return n=`
        ivec3 getOutputCoords() {
          ivec2 resTexRC = ivec2(TexCoords.xy *
                                vec2(${t[0]}, ${t[1]}));
          int index = resTexRC.y * ${t[0]} + resTexRC.x;
          ${o}
          return ivec3(r, c, d);
        }
      `,new i.GlslLibRoutine(n)}getOutputUnpacked4DCoords(e,t){let n="",r=e.length,s=null;r<2&&(s=[]),(s=Array(r-1))[r-2]=e[r-1];for(let t=r-3;t>=0;--t)s[t]=s[t+1]*e[t+1];let a=["r","c","d","d2"],o=s.map((e,t)=>`int ${a[t]} = index / ${e}; ${t===s.length-1?`int ${a[t+1]} = index - ${a[t]} * ${e}`:`index -= ${a[t]} * ${e}`};`).join("");return n=`
      ivec4 getOutputCoords() {
          ivec2 resTexRC = ivec2(TexCoords.xy *
                                vec2(${t[0]}, ${t[1]}));
          int index = resTexRC.y * ${t[0]} + resTexRC.x;
          ${o}
          return ivec4(r, c, d, d2);
        }
      `,new i.GlslLibRoutine(n)}getOutputUnpacked5DCoords(e,t){let n="",r=e.length,s=null;r<2&&(s=[]),(s=Array(r-1))[r-2]=e[r-1];for(let t=r-3;t>=0;--t)s[t]=s[t+1]*e[t+1];let a=["r","c","d","d2","d3"],o=s.map((e,t)=>`int ${a[t]} = index / ${e}; ${t===s.length-1?`int ${a[t+1]} = index - ${a[t]} * ${e}`:`index -= ${a[t]} * ${e}`};`).join("");return n=`
      ivec5 getOutputCoords() {
          ivec2 resTexRC = ivec2(TexCoords.xy *
                                vec2(${t[0]}, ${t[1]}));
          int index = resTexRC.y * ${t[0]} + resTexRC.x;
          ${o}
          return ivec5(r, c, d, d2, d3);
        }
      `,new i.GlslLibRoutine(n)}getOutputUnpacked6DCoords(e,t){let n="",r=e.length,s=null;r<2&&(s=[]),(s=Array(r-1))[r-2]=e[r-1];for(let t=r-3;t>=0;--t)s[t]=s[t+1]*e[t+1];let a=["r","c","d","d2","d3","d4"],o=s.map((e,t)=>`int ${a[t]} = index / ${e}; ${t===s.length-1?`int ${a[t+1]} = index - ${a[t]} * ${e}`:`index -= ${a[t]} * ${e}`};`).join("");return n=`
     ivec6 getOutputCoords() {
         ivec2 resTexRC = ivec2(TexCoords.xy *
                               vec2(${t[0]}, ${t[1]}));
         int index = resTexRC.y * ${t[0]} + resTexRC.x;
         ${o}
         return ivec6(r, c, d, d2, d3, d4);
       }
     `,new i.GlslLibRoutine(n)}getCommonUtilFuncs(){let e={},t="uvFromFlat";e[t]=new i.GlslLibRoutine("\n    vec2 uvFromFlat(int texNumR, int texNumC, int index) {\n      int texC = index / texNumR;\n      int texR = index - texC * texNumR;\n      // TODO: swap texR, texC order in following function so row is corresponding to u and column is corresponding to\n      //       v.\n      return (vec2(texR, texC) + halfCR) / vec2(texNumR, texNumC);\n    }\n    "),e[t="packedUVfrom1D"]=new i.GlslLibRoutine("\n      vec2 packedUVfrom1D(int texNumR, int texNumC, int index) {\n        int texelIndex = index / 2;\n        int texR = texelIndex / texNumC;\n        int texC = texelIndex - texR * texNumC;\n        return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n      }\n      "),e[t="packedUVfrom2D"]=new i.GlslLibRoutine("\n      vec2 packedUVfrom2D(int texNumR, int texNumC, int texelsInLogicalRow, int row, int col) {\n        int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);\n        int texR = texelIndex / texNumC;\n        int texC = texelIndex - texR * texNumC;\n        return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n      }\n      "),e[t="packedUVfrom3D"]=new i.GlslLibRoutine("\n      vec2 packedUVfrom3D(int texNumR, int texNumC,\n          int texelsInBatch, int texelsInLogicalRow, int b,\n          int row, int col) {\n        int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);\n        int texR = index / texNumC;\n        int texC = index - texR * texNumC;\n        return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n      }\n      "),t="sampleTexture";let n=(0,s.getGlsl)(this.context.glContext.version);return e[t]=new i.GlslLibRoutine(`
        float sampleTexture(sampler2D textureSampler, vec2 uv) {
            return ${n.texture2D}(textureSampler, uv).r;
        }`),e}getInputsSamplingSnippets(){let e={},t=this.context.outputTextureLayout;return this.context.programInfo.inputNames.forEach((n,r)=>{let i=this.context.inputTextureLayouts[r],s=(0,o.generateShaderFuncNameFromInputSamplerName)(n);i.isPacked?e[s]=this.getPackedSamplerFromInput(s,n,i):e[s]=this.getUnpackedSamplerFromInput(s,n,i);let a=(0,o.generateShaderFuncNameFromInputSamplerNameAtOutCoords)(n);i.unpackedShape.length<=t.unpackedShape.length&&(i.isPacked?e[a]=this.getPackedSamplerAtOutputCoords(a,i,t,n):e[a]=this.getUnpackedSamplerAtOutputCoords(a,i,t,n))}),e}getPackedSamplerAtOutputCoords(e,t,n,s){let a;let l=t.unpackedShape,u=n.unpackedShape,c=s,h=(0,o.generateShaderFuncNameFromInputSamplerName)(c),d=l.length,p=u.length,f=r.BroadcastUtil.getBroadcastDims(l,u),g=(0,o.getCoordsDataType)(p),m=p-d,y=(0,o.getGlChannels)();a=0===d?"":p<2&&f.length>=1?"coords = 0;":f.map(e=>`coords.${y[e+m]} = 0;`).join("\n");let b="";b=p<2&&d>0?"coords":l.map((e,t)=>`coords.${y[t+m]}`).join(", ");let v="return outputValue;",w=1===r.ShapeUtil.size(l),_=1===r.ShapeUtil.size(u);if(1!==d||w||_){if(w&&!_)v=1===p?"\n          return vec4(outputValue.x, outputValue.x, 0., 0.);\n        ":"\n          return vec4(outputValue.x);\n        ";else if(f.length){let e=d-2,t=d-1;f.indexOf(e)>-1&&f.indexOf(t)>-1?v="return vec4(outputValue.x);":f.indexOf(e)>-1?v="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":f.indexOf(t)>-1&&(v="return vec4(outputValue.xx, outputValue.zz);")}}else v="\n        return vec4(outputValue.xy, outputValue.xy);\n      ";let x=`
      vec4 ${e}() {
        ${g} coords = getOutputCoords();
        
        int lastDim = coords.${y[p-1]};
        coords.${y[p-1]} = coords.${y[p-2]};
        coords.${y[p-2]} = lastDim;
      
        ${a}
        vec4 outputValue = ${h}(${b});
        ${v}
      }
    `;return new i.GlslLibRoutine(x,["coordinates.getOutputCoords"])}getUnpackedSamplerAtOutputCoords(e,t,n,s){let a;let l=[n.width,n.height],u=[t.width,t.height],c=t.unpackedShape.length,h=n.unpackedShape.length,d=t.unpackedShape,p=n.unpackedShape,f=(0,o.generateShaderFuncNameFromInputSamplerName)(s);if(c===h&&r.ArrayUtil.arraysEqual(u,l)){let t=`
          float ${e}() {
            return sampleTexture(${s}, TexCoords);
          }
        `;return new i.GlslLibRoutine(t,["coordinates.sampleTexture"])}let g=(0,o.getCoordsDataType)(h),m=r.BroadcastUtil.getBroadcastDims(d,p),y=h-c,b=(0,o.getGlChannels)();a=0===c?"":h<2&&m.length>=1?"coords = 0;":m.map(e=>`coords.${b[e+y]} = 0;`).join("\n");let v="";v=h<2&&c>0?"coords":t.unpackedShape.map((e,t)=>`coords.${b[t+y]}`).join(", ");let w=`
        float ${e}() {
          ${g} coords = getOutputCoords();
          ${a}
          return ${f}(${v});
        }
      `;return new i.GlslLibRoutine(w,["coordinates.getOutputCoords"])}getPackedSamplerFromInput(e,t,n){switch(n.unpackedShape.length){case 0:return this.getPackedSamplerScalar(e,t);case 1:return this.getPackedSampler1D(e,t,n);case 2:return this.getPackedSampler2D(e,t,n);case 3:return this.getPackedSampler3D(e,t,n);default:return this.getPackedSamplerND(e,t,n)}}getUnpackedSamplerFromInput(e,t,n){let r=n.unpackedShape;switch(r.length){case 0:return this.getUnpackedSamplerScalar(e,t,n);case 1:return this.getUnpackedSampler1D(e,t,n);case 2:return this.getUnpackedSampler2D(e,t,n);case 3:return this.getUnpackedSampler3D(e,t,n);case 4:return this.getUnpackedSampler4D(e,t,n);case 5:return this.getUnpackedSampler5D(e,t,n);case 6:return this.getUnpackedSampler6D(e,t,n);default:throw Error(`Unsupported dimension ${r.length}-D`)}}getPackedSamplerScalar(e,t){let n=`
          vec4 ${e}() {
            return ${(0,s.getGlsl)(this.context.glContext.version).texture2D}(${t}, halfCR);
          }
        `;return new i.GlslLibRoutine(n)}getPackedSampler1D(e,t,n){let r=[n.width,n.height],a=[r[1],r[0]],o=(0,s.getGlsl)(this.context.glContext.version),l=`vec4 ${e}(int index) {
      vec2 uv = packedUVfrom1D(
      ${a[0]}, ${a[1]}, index);
      return ${o.texture2D}(${t}, uv);
    }`;return new i.GlslLibRoutine(l,["coordinates.packedUVfrom1D"])}getPackedSampler2D(e,t,n){let a=n.unpackedShape,o=[n.width,n.height],l=(0,s.getGlsl)(this.context.glContext.version),u=o[0],c=o[1];if(null!=o&&r.ArrayUtil.arraysEqual(a,o)){let n=`vec4 ${e}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${c}.0, ${u}.0);
        return ${l.texture2D}(${t}, uv);
      }`;return new i.GlslLibRoutine(n)}let h=o,d=Math.ceil(a[1]/2),p=`vec4 ${e}(int row, int col) {
      vec2 uv = packedUVfrom2D(${h[1]}, ${h[0]}, ${d}, row, col);
      return ${l.texture2D}(${t}, uv);
    }`;return new i.GlslLibRoutine(p,["coordinates.packedUVfrom2D"])}getPackedSampler3D(e,t,n){let r=n.unpackedShape,a=[n.width,n.height],l=[a[0],a[1]],u=(0,s.getGlsl)(this.context.glContext.version);if(1===r[0]){let s=r.slice(1),a=[1,2],l=(0,o.squeezeInputShape)(r,s),u=["b","row","col"],c=JSON.parse(JSON.stringify(n));c.unpackedShape=l;let h=this.getPackedSamplerFromInput(e,t,c),d=`${h.routineBody}
      vec4 ${e}(int b, int row, int col) {
        return ${e}(${(0,o.getSqueezedParams)(u,a)});
      } `;return new i.GlslLibRoutine(d,h.dependencies)}let c=l[0],h=l[1],d=Math.ceil(r[2]/2),p=`vec4 ${e}(int b, int row, int col) {
      vec2 uv = packedUVfrom3D(
        ${h}, ${c}, ${d*Math.ceil(r[1]/2)}, ${d}, b, row, col);
      return ${u.texture2D}(${t}, uv);}`;return new i.GlslLibRoutine(p,["coordinates.packedUVfrom3D"])}getPackedSamplerND(e,t,n){let r=n.unpackedShape,a=r.length,o=[n.width,n.height],l=(0,s.getGlsl)(this.context.glContext.version),u=[o[0],o[1]],c=u[1],h=u[0],d=Math.ceil(r[a-1]/2),p=d*Math.ceil(r[a-2]/2),f="int b, int row, int col",g=`b * ${p} + (row / 2) * ${d} + (col / 2)`;for(let e=2;e<a-1;e++)f=`int b${e}, `+f,p*=r[a-e-1],g=`b${e} * ${p} + `+g;let m=`vec4 ${e}(${f}) {
      int index = ${g};
      int texR = index / ${h};
      int texC = index - texR * ${h};
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${h}, ${c});
      return ${l.texture2D}(${t}, uv);
    }`;return new i.GlslLibRoutine(m)}getUnpackedSamplerScalar(e,t,n){let[r,s]=[n.width,n.height];if(1===r&&1===s){let n=`
          float ${e}() {
            return sampleTexture(${t}, halfCR);
          }
        `;return new i.GlslLibRoutine(n,["coordinates.sampleTexture"])}let a=`
        float ${e}() {
          int offset_${t} = coordsToOffset(TexCoords, ${r}, ${s});
          vec2 uv = uvFromFlat(${r}, ${s}, offset_${t});
          return sampleTexture(${t}, uv);
        }
      `;return new i.GlslLibRoutine(a,["coordinates.uvFromFlat","coordinates.sampleTexture","coordinates.coordsToOffset"])}getUnpackedSampler1D(e,t,n){let r=n.width,s=n.height;if(1===s&&1===r){let n=`
        float ${e}(int index) {
          return sampleTexture(${t}, halfCR);
        }
      `;return new i.GlslLibRoutine(n,["coordinates.sampleTexture"])}if(1===s){let n=`
          float ${e}(int index) {
            vec2 uv = vec2((float(index) + 0.5) / ${r}.0, 0.5);
            return sampleTexture(${t}, uv);
          }
        `;return new i.GlslLibRoutine(n,["coordinates.sampleTexture"])}if(1===r){let n=`
          float ${e}(int index) {
            vec2 uv = vec2(0.5, (float(index) + 0.5) / ${s}.0);
            return sampleTexture(${t}, uv);
          }
        `;return new i.GlslLibRoutine(n,["coordinates.sampleTexture"])}let a=`
        float ${e}(int index) {
          vec2 uv = uvFromFlat(${r}, ${s}, index);
          return sampleTexture(${t}, uv);
        }
      `;return new i.GlslLibRoutine(a,["coordinates.uvFromFlat","coordinates.sampleTexture"])}getUnpackedSampler2D(e,t,n){let s=n.unpackedShape,l=[n.height,n.width];if(null!=l&&r.ArrayUtil.arraysEqual(s,l)){let n=`
          float ${e}(int row, int col) {
            vec2 uv = (vec2(row, col) + halfCR) / vec2(${l[1]}.0, ${l[0]}.0);
            return sampleTexture(${t}, uv);
          }
        `;return new i.GlslLibRoutine(n,["coordinates.sampleTexture"])}let{newShape:u,keptDims:c}=(0,a.squeezeShape)(s),h=u;if(h.length<s.length){let r=(0,o.squeezeInputShape)(s,h),a=JSON.parse(JSON.stringify(n));a.unpackedShape=r;let l=["col","row"],u=`
          ${this.getUnpackedSamplerFromInput(e,t,a).routineBody}
          float ${e}(int row, int col) {
            return ${e}(${(0,o.getSqueezedParams)(l,c)});
          }
        `;return new i.GlslLibRoutine(u,["coordinates.sampleTexture"])}let d=l[1],p=l[0];if(1===p){let n=`
          float ${e}(int row, int col) {
            int offset_${t} = coordsToOffset(TexCoords, ${d}, ${p});
            float index = dot(vec3(row, col, offset_${t}), vec3(${s[1]}, 1, 1));
            vec2 uv = vec2(0.5, (index + 0.5) / ${d}.0);
            return sampleTexture(${t}, uv);
          }
        `;return new i.GlslLibRoutine(n,["coordinates.sampleTexture","coordinates.coordsToOffset"])}if(1===d){let n=`
          float ${e}(int row, int col) {
            int offset_${t} = coordsToOffset(TexCoords, ${d}, ${p});
            float index = dot(vec3(row, col, offset_${t}), vec3(${s[1]}, 1, 1));
            vec2 uv = vec2((index + 0.5) / ${p}.0, 0.5);
            return sampleTexture(${t}, uv);
          }
        `;return new i.GlslLibRoutine(n,["coordinates.sampleTexture","coordinates.coordsToOffset"])}let f=`
        float ${e}(int row, int col) {
          int index = col * ${s[1]} + row;
          vec2 uv = uvFromFlat(${d}, ${p}, index);
          return sampleTexture(${t}, uv);
        }
      `;return new i.GlslLibRoutine(f,["coordinates.uvFromFlat","coordinates.sampleTexture","coordinates.coordsToOffset"])}getUnpackedSampler3D(e,t,n){let r=n.unpackedShape,s=r[1]*r[2],l=r[2],{newShape:u,keptDims:c}=(0,a.squeezeShape)(r),h=u;if(h.length<r.length){let s=(0,o.squeezeInputShape)(r,h),a=["batch","col","row"],l=JSON.parse(JSON.stringify(n));l.unpackedShape=s;let u=this.getUnpackedSamplerFromInput(e,t,l),d=c.reverse(),p=`
          ${u.routineBody}
          float ${e}(int batch, int row, int col) {
            return ${e}(${(0,o.getSqueezedParams)(a,d)});
          }
        `;return new i.GlslLibRoutine(p,u.dependencies)}let d=`
          float ${e}(int depth, int row, int col) {
            // Explicitly use integer operations as dot() only works on floats.
            int index = depth * ${s} + col * ${l} + row;
            vec2 uv = uvFromFlat(${n.width}, ${n.height}, index);
            return sampleTexture(${t}, uv);
          }
      `;return new i.GlslLibRoutine(d,["coordinates.uvFromFlat","coordinates.sampleTexture","coordinates.coordsToOffset"])}getUnpackedSampler4D(e,t,n){let r=n.unpackedShape,s=r[3],a=r[2]*s,o=`
        float ${e}(int row, int col, int depth, int depth2) {
          int index = row * ${r[1]*a} + col * ${a} +
              depth2 * ${s} + depth;
          vec2 uv = uvFromFlat(${n.width}, ${n.height}, index);
          return sampleTexture(${t}, uv);
        }
      `;return new i.GlslLibRoutine(o,["coordinates.uvFromFlat","coordinates.sampleTexture"])}getUnpackedSampler5D(e,t,n){let r=n.unpackedShape,s=r[4],l=r[3]*s,u=r[2]*l,c=r[1]*u,{newShape:h,keptDims:d}=(0,a.squeezeShape)(r);if(h.length<r.length){let s=(0,o.squeezeInputShape)(r,h),a=["row","col","depth","depth2","depth3"],l=JSON.parse(JSON.stringify(n));l.unpackedShape=s;let u=`
          ${this.getUnpackedSamplerFromInput(e,t,l).routineBody}
          float ${e}(int row, int col, int depth, int depth2, int depth3) {
            return ${e}(${(0,o.getSqueezedParams)(a,d)});
          }
        `;return new i.GlslLibRoutine(u,["coordinates.sampleTexture","coordinates.uvFromFlat"])}let p=`
        float ${e}(int row, int col, int depth, int depth2, int depth3) {
          int index = row * ${c} + col * ${u} + depth * ${l} +
          depth3 * ${s} + depth2;
          vec2 uv = uvFromFlat(${n.width}, ${n.height}, index);
          return sampleTexture(${t}, uv);
        }
      `;return new i.GlslLibRoutine(p,["coordinates.sampleTexture","coordinates.uvFromFlat"])}getUnpackedSampler6D(e,t,n){let r=n.unpackedShape,s=r[5],l=r[4]*s,u=r[3]*l,c=r[2]*u,h=r[1]*c,{newShape:d,keptDims:p}=(0,a.squeezeShape)(r);if(d.length<r.length){let s=(0,o.squeezeInputShape)(r,d),a=["row","col","depth","depth2","depth3","depth4"],l=JSON.parse(JSON.stringify(n));l.unpackedShape=s;let u=`
            ${this.getUnpackedSamplerFromInput(e,t,l).routineBody}
            float ${e}(int row, int col, int depth,
              int depth2, int depth3, int depth4) {
              return ${e}(${(0,o.getSqueezedParams)(a,p)});
            }
          `;return new i.GlslLibRoutine(u,["coordinates.sampleTexture","coordinates.uvFromFlat"])}let f=`
          float ${e}(int row, int col, int depth,
            int depth2, int depth3, int depth4) {
            int index = row * ${h} + col * ${c} + depth * ${u} +
            depth2 * ${l} + depth3 * ${s} + depth4;
            vec2 uv = uvFromFlat(${n.width}, ${n.height}, index);
            return sampleTexture(${t}, uv);
          }
        `;return new i.GlslLibRoutine(f,["coordinates.uvFromFlat","coordinates.sampleTexture","coordinates.coordsToOffset"])}toVec(){let e=this.context.outputTextureLayout,t=e.shape.length,n=e.strides,r=e.width,s=e.height,a=[];for(let e=0;e<t-1;++e)a.push(`
        c[${e}] = offset / ${n[e]};`),a.push(`
        offset -= c[${e}] * ${n[e]};`);a.push(`
        c[${t-1}] = offset;`);let o=`
      void toVec(vec2 texCoords, out int c[${t}]) {
        int offset = coordsToOffset(texCoords, ${r}, ${s});
        ${a.join("")}
      }
      void toVec(int offset, out int c[${t}]) {
        ${a.join("")}
      }
    `;return{toVec:new i.GlslLibRoutine(o,["coordinates.coordsToOffset"])}}valueFrom(){let e={};return this.context.programInfo.inputNames.forEach((t,n)=>{let r=this.context.inputTextureLayouts[n],s=(r.unpackedShape.length>0?r.unpackedShape:r.shape).length,a=`_${t}`;e[a]=new i.GlslLibRoutine(this.getValueFromSingle(t,s,r.width,r.height,!1),[`shapeUtils.indicesToOffset${a}`,"coordinates.offsetToCoords","fragcolor.getColorAsFloat"]),e[a+="_T"]=new i.GlslLibRoutine(this.getValueFromSingle(t,s,r.width,r.height,!0),[`shapeUtils.indicesToOffset${a}`,"coordinates.offsetToCoords","fragcolor.getColorAsFloat"])}),e}getValueFromSingle(e,t,n,r,i){let a=`_${e}`;return i&&(a+="_T"),`
        float ${a}(int m[${t}]) {
          int offset = indicesToOffset${a}(m);
          vec2 coords = offsetToCoords(offset, ${n}, ${r});
          float value = getColorAsFloat(${(0,s.getGlsl)(this.context.glContext.version).texture2D}(${e}, coords));
          return value;
        }
        `}getPackedValueFrom(e,t,n,r,i){let a=`_${e}_Pack`;return i&&(a+="_T"),`
        vec4 ${a}(int m[${t}]) {
          int offset = indicesToOffset_${e}(m);
          vec2 coords = offsetToCoords(offset, ${n}, ${r});
          return ${(0,s.getGlsl)(this.context.glContext.version).texture2D}(${e}, coords);
        }
        `}}t.CoordsGlslLib=l},8520:(e,t)=>{"use strict";var n;Object.defineProperty(t,"__esModule",{value:!0}),t.TopologicalSortGlslRoutines=t.GlslLibRoutineNode=t.GlslLibRoutine=t.GlslLib=t.GlslContext=t.FunctionType=void 0,(n=t.FunctionType||(t.FunctionType={}))[n.ValueBased=0]="ValueBased",n[n.Positional=1]="Positional",t.GlslContext=class{constructor(e,t,n,r){this.glContext=e,this.programInfo=t,this.inputTextureLayouts=n,this.outputTextureLayout=r}},t.GlslLib=class{constructor(e){this.context=e}},t.GlslLibRoutine=class{constructor(e,t){this.routineBody=e,this.dependencies=t}},t.GlslLibRoutineNode=class{constructor(e,t,n){this.name=e,this.dependencies=n||[],t&&(this.routineBody=t)}addDependency(e){e&&this.dependencies.push(e)}},t.TopologicalSortGlslRoutines=class{static returnOrderedNodes(e){if(!e||0===e.length)return[];if(1===e.length)return e;let t=new Set,n=new Set,r=[];return this.createOrderedNodes(e,t,n,r),r}static createOrderedNodes(e,t,n,r){for(let i=0;i<e.length;++i)this.dfsTraverse(e[i],t,n,r)}static dfsTraverse(e,t,n,r){if(!e||n.has(e.name))return;if(t.has(e.name))throw Error("Cyclic dependency detected. Can't topologically sort routines needed for shader.");t.add(e.name);let i=e.dependencies;if(i&&i.length>0)for(let e=0;e<i.length;++e)this.dfsTraverse(i[e],t,n,r);r.push(e),n.add(e.name),t.delete(e.name)}}},7341:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EncodingGlslLib=void 0;let r=n(8520);class i extends r.GlslLib{constructor(e){super(e)}getFunctions(){return Object.assign(Object.assign({},this.encodeFloat32()),this.decodeFloat32())}getCustomTypes(){return{}}encodeFloat32(){return{encode:new r.GlslLibRoutine("highp vec4 encode(highp float f) {\n        return vec4(f, 0.0, 0.0, 0.0);\n      }\n        ")}}decodeFloat32(){return{decode:new r.GlslLibRoutine("highp float decode(highp vec4 rgba) {\n        return rgba.r;\n      }\n        ")}}encodeUint8(){let e=i.isLittleEndian()?"rgba.rgba=rgba.abgr;":"";return{encode:new r.GlslLibRoutine(`
      highp vec4 encode(highp float f) {
        highp float F = abs(f);
        highp float Sign = step(0.0,-f);
        highp float Exponent = floor(log2(F));
        highp float Mantissa = (exp2(- Exponent) * F);
        Exponent = floor(log2(F) + 127.0) + floor(log2(Mantissa));
        highp vec4 rgba;
        rgba[0] = 128.0 * Sign  + floor(Exponent*exp2(-1.0));
        rgba[1] = 128.0 * mod(Exponent,2.0) + mod(floor(Mantissa*128.0),128.0);
        rgba[2] = floor(mod(floor(Mantissa*exp2(23.0 -8.0)),exp2(8.0)));
        rgba[3] = floor(exp2(23.0)*mod(Mantissa,exp2(-15.0)));
        ${e}
        rgba = rgba / 255.0; // values need to be normalized to [0,1]
        return rgba;
    }
        `)}}decodeUint8(){let e=i.isLittleEndian()?"rgba.rgba=rgba.abgr;":"";return{decode:new r.GlslLibRoutine(`
        highp float decode(highp vec4 rgba) {
          rgba = rgba * 255.0; // values need to be de-normalized from [0,1] to [0,255]
          ${e}
          highp float Sign = 1.0 - step(128.0,rgba[0])*2.0;
          highp float Exponent = 2.0 * mod(rgba[0],128.0) + step(128.0,rgba[1]) - 127.0;
          highp float Mantissa = mod(rgba[1],128.0)*65536.0 + rgba[2]*256.0 +rgba[3] + float(0x800000);
          highp float Result =  Sign * exp2(Exponent) * (Mantissa * exp2(-23.0 ));
          return Result;
      }
        `)}}static isLittleEndian(){let e=new ArrayBuffer(4),t=new Uint32Array(e),n=new Uint8Array(e);if(t[0]=0xdeadbeef,239===n[0])return!0;if(222===n[0])return!1;throw Error("unknown endianness")}}t.EncodingGlslLib=i},9894:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FragColorGlslLib=void 0;let r=n(8520),i=n(5060);class s extends r.GlslLib{constructor(e){super(e)}getFunctions(){return Object.assign(Object.assign({},this.setFragColor()),this.getColorAsFloat())}getCustomTypes(){return{}}setFragColor(){let e=(0,i.getGlsl)(this.context.glContext.version);return{setFragColor:new r.GlslLibRoutine(`
        void setFragColor(float value) {
            ${e.output} = encode(value);
        }
        `,["encoding.encode"])}}getColorAsFloat(){return{getColorAsFloat:new r.GlslLibRoutine("\n        float getColorAsFloat(vec4 color) {\n            return decode(color);\n        }\n        ",["encoding.decode"])}}}t.FragColorGlslLib=s},2848:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.replaceInlines=void 0;let n=/@inline[\s\n\r]+(\w+)[\s\n\r]+([0-9a-zA-Z_]+)\s*\(([^)]*)\)\s*{(([^}]|[\n\r])*)}/gm;t.replaceInlines=function(e){let t;let r={};for(;null!==(t=n.exec(e));){let e=t[3].split(",").map(e=>{let t=e.trim().split(" ");return t&&2===t.length?{type:t[0],name:t[1]}:null}).filter(e=>null!==e);r[t[2]]={params:e,body:t[4]}}for(let n in r){let i=RegExp("(\\w+)?\\s+([_0-9a-zA-Z]+)\\s+=\\s+__FUNC__\\((.*)\\)\\s*;".replace("__FUNC__",n),"gm");for(;null!==(t=i.exec(e));){let i=t[1],s=t[2],a=t[3].split(","),o=i?`${i} ${s};`:"",l=r[n].body,u="";r[n].params.forEach((e,t)=>{e&&(u+=`${e.type} ${e.name} = ${a[t]};
`)}),l=(l=`${u}
 ${l}`).replace("return",`${s} = `);let c=`
      ${o}
      {
        ${l}
      }
      `;e=e.replace(t[0],c)}}return e.replace(n,"")}},8879:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GlslPreprocessor=void 0;let r=n(8520),i=n(2848),s=n(5483),a=n(5060);t.GlslPreprocessor=class{constructor(e,t,n,i){this.libs={},this.glslLibRoutineDependencyGraph={},this.context=new r.GlslContext(e,t,n,i),Object.keys(s.glslRegistry).forEach(e=>{let t=new s.glslRegistry[e](this.context);this.libs[e]=t});let a=this.glslLibRoutineDependencyGraph;for(let e in this.libs){let t=this.libs[e].getFunctions();for(let n in t){let i;let s=e+"."+n;a[s]?(i=a[s]).routineBody=t[n].routineBody:(i=new r.GlslLibRoutineNode(s,t[n].routineBody),a[s]=i);let o=t[n].dependencies;if(o)for(let e=0;e<o.length;++e)if(a[o[e]])i.addDependency(a[o[e]]);else{let t=new r.GlslLibRoutineNode(o[e]);a[o[e]]=t,i.addDependency(t)}}}}preprocess(){let e=this.context.programInfo,t=e.shaderSource;return this.context.programInfo.hasMain||(t=`${t}
      ${(0,a.getDefaultFragShaderMain)(this.context.glContext.version,this.context.outputTextureLayout.shape.length)}`),t=(0,i.replaceInlines)(t),`${(0,a.getFragShaderPreamble)(this.context.glContext.version)}
    ${this.getUniforms(e.inputNames,e.variables)}
    ${this.getImports(t)}
    ${t}`}getImports(e){let t=this.selectGlslLibRoutinesToBeIncluded(e);if(0===t.length)return"";let n="";for(let e=0;e<t.length;++e){if(!t[e].routineBody)throw Error(`Missing body for the Glsl Library routine: ${t[e].name}`);n+=t[e].routineBody+"\n"}return n}selectGlslLibRoutinesToBeIncluded(e){let t=[];return Object.keys(this.glslLibRoutineDependencyGraph).forEach(n=>{let r=n.split(".")[1];-1!==e.indexOf(r)&&t.push(this.glslLibRoutineDependencyGraph[n])}),r.TopologicalSortGlslRoutines.returnOrderedNodes(t)}getUniforms(e,t){let n=[];if(e)for(let t of e)n.push(`uniform sampler2D ${t};`);if(t)for(let e of t)n.push(`uniform ${e.type} ${e.name}${e.arrayLength?`[${e.arrayLength}]`:""};`);return n.join("\n")}}},5483:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.glslRegistry=void 0;let r=n(5107),i=n(7341),s=n(9894),a=n(2655),o=n(3891);t.glslRegistry={encoding:i.EncodingGlslLib,fragcolor:s.FragColorGlslLib,vec:o.VecGlslLib,shapeUtils:a.ShapeUtilsGlslLib,coordinates:r.CoordsGlslLib}},2655:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ShapeUtilsGlslLib=void 0;let r=n(8520);class i extends r.GlslLib{constructor(e){super(e)}getFunctions(){return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},this.bcastIndex()),this.bcastMatmulIndex()),this.offsetToIndices()),this.indicesToOffset()),this.incrementIndices())}getCustomTypes(){return{}}bcastIndex(){let e=this.context.outputTextureLayout.shape.length,t={};return this.context.programInfo.inputNames.forEach((n,i)=>{let s=this.context.inputTextureLayouts[i].unpackedShape;if(s.length<=e){let i=s.length,a=e-i,o=`bcastIndices_${n}`,l="";for(let e=0;e<i;++e)l+=`
          realIndices[${e}] = int( mod(float(bcastedIndices[${a+e}]), ${s[e]}.0) );
          `;let u=`
        void ${o} (int bcastedIndices[${e}], out int realIndices[${i}]) {
          ${l}
        }
        `;t[o]=new r.GlslLibRoutine(u)}}),t}bcastMatmulIndex(){let e=this.context.outputTextureLayout.shape.length,t={};return this.context.programInfo.inputNames.forEach((n,i)=>{let s=this.context.inputTextureLayouts[i].shape;if(!(s.length<2||s.length>e)){let i=s.length,a=e-i,o=`bcastMatmulIndices_${n}`,l="";for(let e=0;e<i-2;++e)l+=`
          realIndices[${e}] = int( mod(float(bcastedIndices[${a+e}]), ${s[e]}.0) );
          `;let u=`
        void ${o}(int bcastedIndices[${e}], out int realIndices[${i}]) {
          ${l}
          realIndices[${i-1}] = bcastedIndices[${e-1}];
          realIndices[${i-2}] = bcastedIndices[${e-2}];
        }
        `;t[o]=new r.GlslLibRoutine(u)}}),t}indicesToOffset(){let e={};return this.context.programInfo.inputNames.forEach((t,n)=>{let s=this.context.inputTextureLayouts[n].shape,a=this.context.inputTextureLayouts[n].strides,o=s.length,l=`indicesToOffset_${t}`;e[l]=new r.GlslLibRoutine(i.indexToOffsetSingle(l,o,a)),e[l=`indicesToOffset_${t}_T`]=new r.GlslLibRoutine(i.indexToOffsetSingle(l,o,a.slice().reverse()))}),e}static indexToOffsetSingle(e,t,n){let r="";for(let e=t-1;e>=0;--e)r+=`
        offset += indices[${e}] * ${n[e]};
        `;return`
      int ${e}(int indices[${t}]) {
        int offset = 0;
        ${r}
        return offset;
      }
      `}offsetToIndices(){let e={};return this.context.programInfo.inputNames.forEach((t,n)=>{let s=this.context.inputTextureLayouts[n].shape,a=this.context.inputTextureLayouts[n].strides,o=s.length,l=`offsetToIndices_${t}`;e[l]=new r.GlslLibRoutine(i.offsetToIndicesSingle(l,o,a)),e[l=`offsetToIndices_${t}_T`]=new r.GlslLibRoutine(i.offsetToIndicesSingle(l,o,a.slice().reverse()))}),e}static offsetToIndicesSingle(e,t,n){let r=[];for(let e=0;e<t-1;++e)r.push(`
      indices[${e}] = offset / ${n[e]};`),r.push(`
        offset -= indices[${e}] * ${n[e]};`);return r.push(`
      indices[${t-1}] = offset;`),`
      void ${e}(int offset, out int indices[${t}]) {
        ${r.join("")}
      }
      `}incrementIndices(){let e={};return this.context.programInfo.inputNames.forEach((t,n)=>{let i=this.context.inputTextureLayouts[n].shape,s=i.length,a=`incrementIndices_${t}`,o="";for(let e=0;e<s;++e)o+=`
        shape[${e}] = ${i[e]};`;let l=`
        void ${a}(int axis, out int indices[${s}]) {
          int shape[${s}];
          ${o};
          for(int i = ${s} -1 ; i >= 0; --i) {
            if(i > axis) continue;
            indices[i] += 1;
            if(indices[i] < shape[i]) {
              break;
            }
            indices[i] = 0;
          }
        }
        `;e[a]=new r.GlslLibRoutine(l)}),e}}t.ShapeUtilsGlslLib=i},5060:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getDefaultFragShaderMain=t.getFragShaderPreamble=t.getVertexShaderSource=t.getGlsl=void 0;let n={version:"",attribute:"attribute",varyingVertex:"varying",varyingFrag:"varying",texture2D:"texture2D",output:"gl_FragColor",outputDeclaration:""},r={version:"#version 300 es",attribute:"in",varyingVertex:"out",varyingFrag:"in",texture2D:"texture",output:"outputColor",outputDeclaration:"out vec4 outputColor;"};function i(e){return 1===e?n:r}t.getGlsl=i,t.getVertexShaderSource=function(e){let t=i(e);return`${t.version}
      precision highp float;
      ${t.attribute} vec3 position;
      ${t.attribute} vec2 textureCoord;

      ${t.varyingVertex} vec2 TexCoords;

      void main()
      {
          gl_Position = vec4(position, 1.0);
          TexCoords = textureCoord;
      }`},t.getFragShaderPreamble=function(e){let t=i(e);return`${t.version}
    precision highp float;
    precision highp int;
    precision highp sampler2D;
    ${t.varyingFrag} vec2 TexCoords;
    ${t.outputDeclaration}
    const vec2 halfCR = vec2(0.5, 0.5);

    // Custom vector types to handle higher dimenalities.
    struct ivec5
    {
      int x;
      int y;
      int z;
      int w;
      int u;
    };

    struct ivec6
    {
      int x;
      int y;
      int z;
      int w;
      int u;
      int v;
    };

    int imod(int x, int y) {
      return x - y * (x / y);
    }

    `},t.getDefaultFragShaderMain=function(e,t){return`
  void main() {
    int indices[${t}];
    toVec(TexCoords, indices);
    vec4 result = vec4(process(indices));
    ${i(e).output} = result;
  }
  `}},3891:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.VecGlslLib=void 0;let r=n(8520);class i extends r.GlslLib{constructor(e){super(e)}getCustomTypes(){return{}}getFunctions(){return Object.assign(Object.assign(Object.assign(Object.assign({},this.binaryVecFunctions()),this.copyVec()),this.setVecItem()),this.getVecItem())}binaryVecFunctions(){let e=this.context.outputTextureLayout.shape.length,t={add:"+=",sub:"-=",mul:"*=",div:"/="},n={};for(let i in t){let s=`${i}Vec`,a="";for(let n=0;n<e;++n)a+=`
          dest[${n}] ${t[i]} src[${n}];
          `;let o=`
        void ${s}(int src[${e}], out int dest[${e}]) {
          ${a}
        }
        `;n[s]=new r.GlslLibRoutine(o)}return n}copyVec(){let e=this.context.outputTextureLayout.shape.length,t="";for(let n=0;n<e;++n)t+=`
        dest[${n}] = src[${n}];
        `;let n=`
      void copyVec(int src[${e}], out int dest[${e}]) {
        ${t}
      }
      `;return{copyVec:new r.GlslLibRoutine(n)}}setVecItem(){let e=this.context.outputTextureLayout.shape.length,t=`
        if(index < 0)
            index =${e} + index;
        if (index == 0)
            m[0] = value;
        `;for(let n=1;n<e-1;++n)t+=`
        else if (index == ${n})
            m[${n}] = value;
            `;t+=`
        else
            m[${e-1}] = value;
        `;let n=`
      void setVecItem(out int m[${e}], int index, int value) {
        ${t}
      }
        `;return{setVecItem:new r.GlslLibRoutine(n)}}getVecItem(){let e=this.context.outputTextureLayout.shape.length,t=`
        if(index < 0)
            index = ${e} + index;
        if (index == 0)
            return m[0];
      `;for(let n=1;n<e-1;++n)t+=`
        else if (index == ${n})
            return m[${n}];
      `;t+=`
        else
            return m[${e-1}];
        `;let n=`
      int getVecItem(int m[${e}], int index) {
        ${t}
      }
    `;return{getVecItem:new r.GlslLibRoutine(n)}}}t.VecGlslLib=i},8316:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WebGLInferenceHandler=void 0;let r=n(6231),i=n(9162),s=n(2517),a=n(2403),o=n(7019),l=n(8710),u=n(5611),c=n(4057),h=n(2039);t.WebGLInferenceHandler=class{constructor(e){this.session=e,this.packedTextureDataCache=new Map,this.unpackedTextureDataCache=new Map}calculateTextureWidthAndHeight(e,t){return(0,c.calculateTextureWidthAndHeight)(this.session.layoutStrategy,e,t)}executeProgram(e,t){if(t.length<e.inputNames.length)throw Error(`Input size mustn't be less than ${e.inputNames.length}.`);if(e.inputNames.length!==e.inputTypes.length)throw Error("input names size does not match input types");let n=[];for(let r=0;r<e.inputNames.length;++r)n[r]=this.getOrCreateTextureData(t[r],e.inputTypes[r]);let r=((e,t)=>{let n=t.map(e=>`${e.unpackedShape.join(",")};${e.width}x${e.height}`).join("_"),r=e.name;return e.cacheHint&&(r+="["+e.cacheHint+"]"),r+=":"+n})(e,n),i=this.session.programManager.getArtifact(r),s=i?i.programInfo:"function"==typeof e.get?e.get():e,a=(0,c.createTextureLayoutFromTextureType)(this.session.layoutStrategy,s.output.dims,s.output.textureType),o=this.createTextureData(a,s.output.type);return i||(i=this.session.programManager.build(s,n,o),this.session.programManager.setArtifact(r,i)),this.runProgram(i,n,o),o}run(e,t){return this.executeProgram(e,t).tensor}runProgram(e,t,n){for(let n=0;n<t.length;++n)if(!!t[n].isPacked!=(e.programInfo.inputTypes[n]===h.TextureType.packed))throw Error(`input[${n}] property packed inconsistent`);if(!!n.isPacked!=(e.programInfo.output.textureType===h.TextureType.packed))throw Error("output property packed inconsistent");this.session.programManager.run(e,t,n)}getOrCreateTextureData(e,t){let n=this.getTextureData(e.dataId,t===h.TextureType.packed);if(!n&&(n=this.getTextureData(e.dataId,t!==h.TextureType.packed)))return t===h.TextureType.packed?this.pack(n):this.unpack(n);if(!n){let r=(0,c.createTextureLayoutFromTextureType)(this.session.layoutStrategy,e.dims,t);if(t===h.TextureType.packedLastDimension){let n=1,r=4,i=e.dims;if(4===i.length){let s=[i[0],Math.ceil(i[1]*i[2]*i[3]/r)],a=(0,c.createTextureLayoutFromTextureType)(this.session.layoutStrategy,s,t),o=e.numberData;if(i[1]*i[2]*i[3]%r!=0){let t=i[0],s=i[1]*i[2]*i[3],a=Math.ceil(s*n/r)*r;o=new Float32Array(t*a);for(let r=0;r<t;++r){let t=r*s,i=r*a+r%n*s;o.set(e.numberData.subarray(t,t+s),i)}}return this.createTextureData(a,e.type,o,e,1)}}if(t===h.TextureType.packed){let t=(0,c.createTextureLayoutFromShape)(this.session.layoutStrategy,e.dims,1,[],{reverseWH:!0}),r=this.createTextureData(t,e.type,e.numberData,e,1);n=this.pack(r)}else n=this.createTextureData(r,e.type,e.numberData,e,1)}return n}createTextureDataFromLayoutBindTensor(e,t,n,r){return this.createTextureData(e,t,n,r,1)}createTextureData(e,t,n,i,s){r.Logger.verbose("InferenceHandler",`Creating TextureData: layout:[${JSON.stringify(e)}]`);let a=this.session.textureManager.createTextureFromLayout(t,e,n,s);return this.createTextureDataFromTexture(e,t,a,i)}reshapeUnpacked(e,t){let n=this.getOrCreateTextureData(e,h.TextureType.unpacked),r={channels:n.channels,height:n.height,width:n.width,shape:0!==t.length?t:[1],strides:s.ShapeUtil.computeStrides(t),unpackedShape:t};return this.createTextureDataFromTexture(r,e.type,n.texture).tensor}reshapePacked(e,t){let n=this.getOrCreateTextureData(e,h.TextureType.packed);if((0,o.isReshapeCheap)(e.dims,t)){let r={channels:n.channels,height:n.height,width:n.width,shape:0!==t.length?t:[1],strides:s.ShapeUtil.computeStrides(t),unpackedShape:t,isPacked:!0};return this.createTextureDataFromTexture(r,e.type,n.texture).tensor}let r=(0,o.processDims3D)(e.dims),i=(0,o.processDims3D)(t),a=this.reshapePacked(e,r),l=this.run((0,o.createPackedReshape3DProgramInfoLoader)(this,a,i),[a]);return this.reshapePacked(l,t)}cast(e,t){let n=this.getOrCreateTextureData(e,h.TextureType.unpacked);return this.createTextureDataFromTexture(n,t,n.texture).tensor}createTextureDataFromTexture(e,t,n,r,s){let a=Object.assign(Object.assign({},e),{tensor:r||new i.Tensor(e.unpackedShape,t,e=>this.readTexture(a),async e=>this.readTextureAsync(a),void 0,s),texture:n});return this.setTextureData(a.tensor.dataId,a,e.isPacked),a}getTextureData(e,t=!1){return this.session.isInitializer(e)?this.session.getTextureData(e,t):t?this.packedTextureDataCache.get(e):this.unpackedTextureDataCache.get(e)}setTextureData(e,t,n=!1){this.session.isInitializer(e)?this.session.setTextureData(e,t,n):(n?this.packedTextureDataCache:this.unpackedTextureDataCache).set(e,t)}isTextureLayoutCached(e,t=!1){return!!this.getTextureData(e.dataId,t)}dispose(){this.session.textureManager.clearActiveTextures(),this.packedTextureDataCache.forEach(e=>this.session.textureManager.releaseTexture(e)),this.packedTextureDataCache=new Map,this.unpackedTextureDataCache.forEach(e=>this.session.textureManager.releaseTexture(e)),this.unpackedTextureDataCache=new Map}readTexture(e){return e.isPacked?this.readTexture(this.unpack(e)):this.session.backend.glContext.isFloat32DownloadSupported?this.session.textureManager.readTexture(e,e.tensor.type,e.channels):this.session.textureManager.readUint8TextureAsFloat((0,l.encodeAsUint8)(this,e))}async readTextureAsync(e){return e.isPacked?this.readTextureAsync(this.unpack(e)):this.session.backend.glContext.isFloat32DownloadSupported?this.session.textureManager.readTextureAsync(e,e.tensor.type,e.channels):this.session.textureManager.readUint8TextureAsFloat((0,l.encodeAsUint8)(this,e))}pack(e){return this.executeProgram((0,a.createPackProgramInfoLoader)(this,e.tensor),[e.tensor])}unpack(e){return this.executeProgram((0,u.createUnpackProgramInfoLoader)(this,e.tensor),[e.tensor])}}},1640:function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var i=Object.getOwnPropertyDescriptor(t,n);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,i)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&r(t,e,n);return i(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.WEBGL_OP_RESOLVE_RULES=void 0;let a=n(2898),o=s(n(7839)),l=n(4196),u=n(2069),c=n(8138),h=n(9663),d=n(5193),p=n(7992),f=n(1253),g=n(4776),m=n(6572),y=n(3346),b=n(5623),v=n(2870),w=n(2143),_=n(4939),x=n(718),T=n(2268),I=n(8117),k=n(2278),S=n(5524),E=n(5975),C=n(3933),A=n(6558),N=n(5723),O=n(3738),$=s(n(4909)),R=n(8428),D=n(9793);t.WEBGL_OP_RESOLVE_RULES=[["Abs","","6+",$.abs],["Acos","","7+",$.acos],["Add","","7+",o.add],["And","","7+",o.and],["Asin","","7+",$.asin],["Atan","","7+",$.atan],["AveragePool","","7+",w.averagePool,w.parseAveragePoolAttributes],["BatchNormalization","","7+",a.batchNormalization,a.parseBatchNormalizationAttributes],["Cast","","6+",l.cast,l.parseCastAttributes],["Ceil","","6+",$.ceil],["Clip","","6-10",$.clip,$.parseClipAttributes],["Clip","","11+",$.clipV11],["Concat","","4+",u.concat,u.parseConcatAttributes],["Conv","","1+",c.conv,c.parseConvAttributes],["ConvTranspose","","1+",h.convTranspose,h.parseConvTransposeAttributes],["Cos","","7+",$.cos],["Div","","7+",o.div],["Dropout","","7+",$.identity],["DepthToSpace","","1+",d.depthToSpace,d.parseDepthToSpaceAttributes],["Equal","","7+",o.equal],["Elu","","6+",$.elu,$.parseEluAttributes],["Exp","","6+",$.exp],["Flatten","","1+",p.flatten,p.parseFlattenAttributes],["Floor","","6+",$.floor],["FusedConv","com.microsoft","1+",c.conv,c.parseConvAttributes],["Gather","","1+",f.gather,f.parseGatherAttributes],["Gemm","","7-10",g.gemm,g.parseGemmAttributesV7],["Gemm","","11+",g.gemm,g.parseGemmAttributesV11],["GlobalAveragePool","","1+",w.globalAveragePool,w.parseGlobalAveragePoolAttributes],["GlobalMaxPool","","1+",w.globalMaxPool],["Greater","","7+",o.greater],["Identity","","1+",$.identity],["ImageScaler","","1+",m.imageScaler,m.parseImageScalerAttributes],["InstanceNormalization","","6+",y.instanceNormalization,y.parseInstanceNormalizationAttributes],["LeakyRelu","","6+",$.leakyRelu,$.parseLeakyReluAttributes],["Less","","7+",o.less],["Log","","6+",$.log],["MatMul","","1+",b.matMul,b.parseMatMulAttributes],["MaxPool","","1+",w.maxPool,w.parseMaxPoolAttributes],["Mul","","7+",o.mul],["Neg","","6+",$.neg],["Not","","1+",$.not],["Or","","7+",o.or],["Pad","","2-10",v.padV2,v.parsePadAttributesV2],["Pad","","11+",v.padV11,v.parsePadAttributesV11],["Pow","","7+",o.pow],["PRelu","","7+",o.pRelu],["ReduceLogSum","","1+",_.reduceLogSum,_.parseReduceAttributes],["ReduceMax","","1+",_.reduceMax,_.parseReduceAttributes],["ReduceMean","","1+",_.reduceMean,_.parseReduceAttributes],["ReduceMin","","1+",_.reduceMin,_.parseReduceAttributes],["ReduceProd","","1+",_.reduceProd,_.parseReduceAttributes],["ReduceSum","","1-12",_.reduceSum,_.parseReduceAttributes],["ReduceSumSquare","","1+",_.reduceLogSumSquare,_.parseReduceAttributes],["Relu","","6+",$.relu],["Reshape","","5+",x.reshape],["Resize","","10",T.resize,T.parseResizeAttributesV10],["Resize","","11+",T.resize,T.parseResizeAttributesV11],["Shape","","1+",I.shape],["Sigmoid","","6+",$.sigmoid],["Sin","","7+",$.sin],["Slice","","10+",k.sliceV10],["Slice","","1-9",k.slice,k.parseSliceAttributes],["Softmax","","1-12",S.softmax,S.parseSoftmaxAttributes],["Softmax","","13+",S.softmaxV13,S.parseSoftmaxAttributesV13],["Split","","2-12",E.split,E.parseSplitAttributes],["Sqrt","","6+",$.sqrt],["Squeeze","","1-12",C.squeeze,C.parseSqueezeAttributes],["Squeeze","","13+",C.squeezeV13],["Sub","","7+",o.sub],["Sum","","6+",A.sum],["Tan","","7+",$.tan],["Tanh","","6+",$.tanh],["Tile","","6+",N.tile],["Transpose","","1+",O.transpose,O.parseTransposeAttributes],["Upsample","","7-8",D.upsample,D.parseUpsampleAttributesV7],["Upsample","","9",D.upsample,D.parseUpsampleAttributesV9],["Unsqueeze","","1-12",R.unsqueeze,R.parseUnsqueezeAttributes],["Unsqueeze","","13+",R.unsqueezeV13],["Xor","","7+",o.xor]]},2898:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseBatchNormalizationAttributes=t.batchNormalization=void 0;let r=n(246),i=n(5060),s=n(2039),a={name:"BatchNormalization",inputNames:["A","Scale","B","Mean","Variance"],inputTypes:[s.TextureType.unpacked,s.TextureType.unpacked,s.TextureType.unpacked,s.TextureType.unpacked,s.TextureType.unpacked]};t.batchNormalization=(e,t,n)=>(l(t),[e.run(Object.assign(Object.assign({},a),{cacheHint:n.cacheKey,get:()=>o(e,t,n)}),t)]),t.parseBatchNormalizationAttributes=e=>{let t=e.attributes.getFloat("epsilon",1e-5),n=e.attributes.getFloat("momentum",.9),i=e.attributes.getInt("spatial",1);return(0,r.createAttributeWithCacheKey)({epsilon:t,momentum:n,spatial:i})};let o=(e,t,n)=>{let r=(0,i.getGlsl)(e.session.backend.glContext.version),o=t[0].dims.length,[l,u]=e.calculateTextureWidthAndHeight(t[1].dims,s.TextureType.unpacked),c=`
  float process(int[${o}] indices) {
    vec2 position = offsetToCoords(indices[1], ${l}, ${u});
    float scale = getColorAsFloat(${r.texture2D}(Scale, position));
    float mean = getColorAsFloat(${r.texture2D}(Mean, position));
    float variance = getColorAsFloat(${r.texture2D}(Variance, position));
    float b = getColorAsFloat(${r.texture2D}(B, position));

    return scale * ( (_A(indices) - mean) / sqrt(variance + float(${n.epsilon})) ) + b;
  }`;return Object.assign(Object.assign({},a),{output:{dims:t[0].dims,type:t[0].type,textureType:s.TextureType.unpacked},shaderSource:c})},l=e=>{if(!e||5!==e.length)throw Error("BatchNormalization requires 5 inputs.");let t=e[0],n=e[1],r=e[2],i=e[3],s=e[4];if(t.dims.length<3||1!==n.dims.length||1!==r.dims.length||1!==i.dims.length||1!==s.dims.length||n.dims[0]!==t.dims[1]||r.dims[0]!==t.dims[1]||i.dims[0]!==t.dims[1]||s.dims[0]!==t.dims[1])throw Error("invalid input shape.");if("float32"!==t.type&&"float64"!==t.type||"float32"!==n.type&&"float64"!==n.type||"float32"!==r.type&&"float64"!==r.type||"float32"!==i.type&&"float64"!==i.type||"float32"!==s.type&&"float64"!==s.type)throw Error("invalid input tensor types.")}},7839:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.xor=t.sub=t.pRelu=t.pow=t.or=t.mul=t.less=t.greater=t.equal=t.div=t.and=t.add=t.glslPRelu=t.glslPow=t.glslXor=t.glslOr=t.glslAnd=t.glslLess=t.glslGreater=t.glslEqual=t.glslSub=t.glslMul=t.glslDiv=t.glslAdd=void 0;let r=n(2517),i=n(8520),s=n(5060),a=n(2039);function o(){let e="add_";return{body:`
  float ${e}(float a, float b) {
    return a + b;
  }
  vec4 ${e}(vec4 v1, vec4 v2) {
    return v1 + v2;
  }
  `,name:e,type:i.FunctionType.ValueBased}}function l(){let e="div_";return{body:`
  float ${e}(float a, float b) {
    return a / b;
  }
  vec4 ${e}(vec4 v1, vec4 v2) {
    return v1 / v2;
  }
  `,name:e,type:i.FunctionType.ValueBased}}function u(){let e="mul_";return{body:`
  float ${e}(float a, float b) {
    return a * b;
  }
  vec4 ${e}(vec4 v1, vec4 v2) {
    return v1 * v2;
  }
  `,name:e,type:i.FunctionType.ValueBased}}function c(){let e="sub_";return{body:`
  float ${e}(float a, float b) {
    return a - b;
  }
  vec4 ${e}(vec4 v1, vec4 v2) {
    return v1 - v2;
  }
  `,name:e,type:i.FunctionType.ValueBased}}function h(){let e="equal_";return{body:`
  float ${e}(float a, float b) {
    return float(a == b);
  }
  vec4 ${e}(vec4 v1, vec4 v2) {
    return vec4(equal(v1, v2));
  }
  `,name:e,type:i.FunctionType.ValueBased}}function d(){let e="greater_";return{body:`
  float ${e}(float a, float b) {
    return float(a > b);
  }
  vec4 ${e}(vec4 v1, vec4 v2) {
    return vec4( v1.r > v2.r ,
      v1.g > v2.g,
      v1.b > v2.b,
      v1.a > v2.a );
  }
  `,name:e,type:i.FunctionType.ValueBased}}function p(){let e="less_";return{body:`
  float ${e}(float a, float b) {
    return float(a < b);
  }
  vec4 ${e}(vec4 v1, vec4 v2) {
    return vec4( v1.r < v2.r ,
                v1.g < v2.g,
                v1.b < v2.b,
                v1.a < v2.a );
  }
  `,name:e,type:i.FunctionType.ValueBased}}function f(){let e="and_";return{body:`
  float ${e}(float a, float b) {
    return float( bool(a) && bool(b) );
  }
  vec4 ${e}(vec4 v1, vec4 v2) {
    bvec4 b1 = bvec4(v1);
    bvec4 b2 = bvec4(v2);
    return vec4( b1.r && b2.r ,
                b1.g && b2.g,
                b1.b && b2.b,
                b1.a && b2.a );
  }
  `,name:e,type:i.FunctionType.ValueBased}}function g(){let e="or_";return{body:`
  float ${e}(float a, float b) {
    return float( bool(a) || bool(b) );
  }
  vec4 ${e}(vec4 v1, vec4 v2) {
    bvec4 b1 = bvec4(v1);
    bvec4 b2 = bvec4(v2);
    return vec4( b1.r || b2.r ,
                b1.g || b2.g,
                b1.b || b2.b,
                b1.a || b2.a );
  }
  `,name:e,type:i.FunctionType.ValueBased}}function m(){let e="xor_";return{body:`
  float ${e}(float a, float b) {
    return float( bool(a) ^^ bool(b) );
  }
  vec4 ${e}(vec4 v1, vec4 v2) {
    bvec4 b1 = bvec4(v1);
    bvec4 b2 = bvec4(v2);
    return vec4( b1.r ^^ b2.r ,
                b1.g ^^ b2.g,
                b1.b ^^ b2.b,
                b1.a ^^ b2.a );
  }
  `,name:e,type:i.FunctionType.ValueBased}}function y(){return function(e){let t="pow_";return{body:`
  float ${t}(float a, float b) {
    return pow(a, b);
  }
  vec4 ${t}(vec4 v1, vec4 v2) {
    return pow(v1, v2);
  }
  `,name:t,type:i.FunctionType.ValueBased}}("pow")}function b(){let e="prelu_";return{body:`
  float ${e}(float a, float b) {
    return a < 0.0 ? a * b: a;
  }
  vec4 ${e}(vec4 v1, vec4 v2) {
    return vec4(
      v1.r < 0.0 ? v1.r * v2.r: v1.r,
      v1.g < 0.0 ? v1.g * v2.g: v1.g,
      v1.b < 0.0 ? v1.b * v2.b: v1.b,
      v1.a < 0.0 ? v1.a * v2.a: v1.a
      );
  }
  `,name:e,type:i.FunctionType.ValueBased}}t.glslAdd=o,t.glslDiv=l,t.glslMul=u,t.glslSub=c,t.glslEqual=h,t.glslGreater=d,t.glslLess=p,t.glslAnd=f,t.glslOr=g,t.glslXor=m,t.glslPow=y,t.glslPRelu=b;let v=(e,t,n,r=t[0].type,i)=>{let s=e.session.pack?a.TextureType.packed:a.TextureType.unpacked;return{name:n.name,inputNames:["A","B"],inputTypes:[s,s],cacheHint:i,get:()=>w(e,t,n,r)}},w=(e,t,n,i=t[0].type)=>{let o=e.session.pack?a.TextureType.packed:a.TextureType.unpacked,l=!r.ShapeUtil.areEqual(t[0].dims,t[1].dims),u=t[0].dims,c=e.session.pack;if(l){let a=r.BroadcastUtil.calcShape(t[0].dims,t[1].dims,!1);if(!a)throw Error("Can't perform binary op on the given tensors");let l=(u=a).length,h=0!==t[0].dims.length?t[0].dims.length:1,d=0!==t[1].dims.length?t[1].dims.length:1,p=0!==t[0].dims.length?"bcastIndices_A(indices, aindices);":"aindices[0] = 0;",f=0!==t[1].dims.length?"bcastIndices_B(indices, bindices);":"bindices[0] = 0;",g=(0,s.getGlsl)(e.session.backend.glContext.version),m=c?`
      ${n.body}
      void main() {
        vec4 a = getAAtOutCoords();
        vec4 b = getBAtOutCoords();
        vec4 result = ${n.name}(a, b);
        ${g.output} = result;
      }`:`
      ${n.body}
      float process(int indices[${l}]) {
        int aindices[${h}];
        int bindices[${d}];
        ${p}
        ${f}
        return ${n.name}(_A(aindices), _B(bindices));
      }`;return{name:n.name,inputNames:["A","B"],inputTypes:[o,o],output:{dims:u,type:i,textureType:o},shaderSource:m,hasMain:c}}let h=(0,s.getGlsl)(e.session.backend.glContext.version),d=`
    ${n.body}
    void main() {
      vec4 v1 = ${h.texture2D}(A, TexCoords);
      vec4 v2 = ${h.texture2D}(B, TexCoords);
      vec4 result = ${n.name}(v1, v2);
      ${h.output} = result;
    }
    `;return{name:n.name,inputNames:["A","B"],inputTypes:[o,o],output:{dims:t[0].dims,type:i,textureType:o},shaderSource:d,hasMain:!0}};t.add=(e,t)=>[e.run(v(e,t,o()),t)],t.and=(e,t)=>[e.run(v(e,t,f(),"bool"),t)],t.div=(e,t)=>[e.run(v(e,t,l()),t)],t.equal=(e,t)=>[e.run(v(e,t,h(),"bool"),t)],t.greater=(e,t)=>[e.run(v(e,t,d(),"bool"),t)],t.less=(e,t)=>[e.run(v(e,t,p(),"bool"),t)],t.mul=(e,t)=>[e.run(v(e,t,u()),t)],t.or=(e,t)=>[e.run(v(e,t,g(),"bool"),t)],t.pow=(e,t)=>[e.run(v(e,t,y()),t)],t.pRelu=(e,t)=>[e.run(v(e,t,b()),t)],t.sub=(e,t)=>[e.run(v(e,t,c()),t)],t.xor=(e,t)=>[e.run(v(e,t,m(),"bool"),t)]},4196:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseCastAttributes=t.cast=void 0;let r=n(2517);t.cast=(e,t,n)=>(i(t),[e.cast(t[0],n)]),t.parseCastAttributes=e=>r.ProtoUtil.tensorDataTypeFromProto(e.attributes.getInt("to"));let i=e=>{if(!e||1!==e.length)throw Error("Cast requires 1 input.");if("string"===e[0].type)throw Error("Invalid input type.")}},1163:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createPackedConcatProgramInfoLoader=void 0;let r=n(5060),i=n(2039),s=n(9390),a=n(2827);t.createPackedConcatProgramInfoLoader=(e,t,n)=>{var l,u;let c=(l=t.length,u=n.cacheKey,{name:"Concat (packed)",inputNames:Array.from({length:l},(e,t)=>`X${t}`),inputTypes:Array(l).fill(i.TextureType.packed),cacheHint:u});return Object.assign(Object.assign({},c),{get:()=>((e,t,n,l)=>{let u=n[0].dims.slice();if(l>=u.length||l<-1*u.length)throw Error("axis specified for concat doesn't match input dimensionality");l<0&&(l=u.length+l);let c=u.slice(0);for(let e=1;e<n.length;e++){let t=n[e].dims.slice();for(let e=0;e<u.length;e++)if(e===l)c[l]+=t[e];else if(u[e]!==t[e])throw Error("non concat dimensions must match")}let h=c.length,d=(0,a.getChannels)("coords",h),p=(0,s.getCoordsDataType)(h),f=(0,a.unpackFromChannel)(),g=n.map(e=>e.dims),m=(0,s.getGlChannels)(h),y=Array(g.length-1);y[0]=g[0][l];for(let e=1;e<y.length;e++)y[e]=y[e-1]+g[e][l];let b=m[l],v=m.slice(-2),w=m.join(),_=`if (${b} < ${y[0]}) {
        return getChannel(
            getX0(${w}), vec2(${v.join()}));
        }`;for(let e=1;e<y.length;e++){let t=y[e-1];_+=`
            if (${b} < ${y[e]}  && ${b} >= ${y[e-1]}) {
              return getChannel(
                getX${e}(${o(m,b,t)}),
                vec2(${o(v,b,t)}));
            }`}let x=y.length,T=y[y.length-1];_+=`
            return getChannel(
              getX${x}(${o(m,b,T)}),
              vec2(${o(v,b,T)}));`;let I=(0,r.getGlsl)(e.session.backend.glContext.version),k=`
          ${f}
          float getValue(${m.map(e=>"int "+e)}) {
            ${_}
          }

          void main() {
            ${p} coords = getOutputCoords();
            int lastDim = coords.${m[h-1]};
            coords.${m[h-1]} = coords.${m[h-2]};
            coords.${m[h-2]} = lastDim;

            vec4 result = vec4(getValue(${d}), 0., 0., 0.);

            ${d[h-1]} = ${d[h-1]} + 1;
            if (${d[h-1]} < ${c[h-1]}) {
              result.g = getValue(${d});
            }

            ${d[h-2]} = ${d[h-2]} + 1;
            if (${d[h-2]} < ${c[h-2]}) {
              result.a = getValue(${d});
            }

            ${d[h-1]} = ${d[h-1]} - 1;
            if (${d[h-2]} < ${c[h-2]} &&
                ${d[h-1]} < ${c[h-1]}) {
              result.b = getValue(${d});
            }
            ${I.output} = result;
          }
        `;return Object.assign(Object.assign({},t),{output:{dims:c,type:n[0].type,textureType:i.TextureType.packed},shaderSource:k,hasMain:!0})})(e,c,t,n.axis)})};let o=(e,t,n)=>{let r=e.indexOf(t);return e.map((e,t)=>t===r?`${e} - ${n}`:e).join()}},2069:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseConcatAttributes=t.concat=void 0;let r=n(246),i=n(2039),s=n(1163);t.concat=(e,t,n)=>(h(t),e.session.pack&&t[0].dims.length>1?[e.run((0,s.createPackedConcatProgramInfoLoader)(e,t,n),t)]:[e.run(a(e,t,n),t)]);let a=(e,t,n)=>{var r,s;let a=(r=t.length,s=n.cacheKey,{name:"Concat",inputNames:Array.from({length:r},(e,t)=>`X${t}`),inputTypes:Array(r).fill(i.TextureType.unpacked),cacheHint:s});return Object.assign(Object.assign({},a),{get:()=>((e,t,n,r)=>{let s=n[0].dims.slice();if(r>=s.length||r<-1*s.length)throw Error("axis specified for concat doesn't match input dimensionality");r<0&&(r=s.length+r);let a=s.slice(0);for(let e=1;e<n.length;e++){let t=n[e].dims.slice();for(let e=0;e<s.length;e++)if(e===r)a[r]+=t[e];else if(s[e]!==t[e])throw Error("non concat dimensions must match")}let h=a.length,d=Array(n.length),p=0;for(let e=0;e<d.length;++e)p+=n[e].dims[r],d[e]=p;let f="";f=n.length<5?o(d):l(d);let g=`
        ${u(n.length,h)}
        ${c(d)}
        ${f}
        float process(int indices[${h}]) {
          int textureIndex = getTextureWhereDataResides (indices[${r}]);

          if(textureIndex != 0) {
            indices[${r}] = indices[${r}] - int(getSizeInConcatAxisValueFromIndex(textureIndex-int(1)));
          }

          return fetchDataFromCorrectTexture(textureIndex, indices);
        }`;return Object.assign(Object.assign({},t),{output:{dims:a,type:n[0].type,textureType:i.TextureType.unpacked},shaderSource:g})})(0,a,t,n.axis)})},o=e=>`int getTextureWhereDataResides(int index) {
      ${e.map((e,t)=>`if(index<${e}) {return ${t};}
`).join("")}
    }`,l=e=>o(e),u=(e,t)=>{let n=[`float fetchDataFromCorrectTexture(int textureIndex, int indices[${t}]) {`];for(let t=0;t<e;++t)0===t?n.push(`	if (textureIndex == ${t}) { return _X${t}(indices); }`):t===e-1?n.push(`	else { return _X${t}(indices); }`):n.push(`	else if (textureIndex == ${t}) { return _X${t}(indices); }`);return n.push("	}"),n.join("\n")},c=e=>{let t=["int getSizeInConcatAxisValueFromIndex(int index) {"];for(let n=0;n<e.length;++n)0===n?t.push(`	if (index == ${n}) { return ${e[n]}; }`):n===e.length-1?t.push(`	else { return ${e[n]}; }`):t.push(`	else if (index == ${n}) { return ${e[n]}; }`);return t.push("	}"),t.join("\n")};t.parseConcatAttributes=e=>(0,r.createAttributeWithCacheKey)({axis:e.attributes.getInt("axis")});let h=e=>{if(!e||e.length<1)throw Error("too few inputs");let t=e[0].type,n=e[0].dims.length;if("string"===t)throw Error("string tensor is not supported yet");for(let r of e){if(r.type!==t)throw Error("input tensors should be one type");if(r.dims.length!==n)throw Error("input tensors should have the same shape")}}},4770:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createUnpackedGroupedConvProgramInfoLoader=void 0;let r=n(6231),i=n(5060),s=n(2039),a=n(8138),o=n(2823);t.createUnpackedGroupedConvProgramInfoLoader=(e,t,n)=>{var l,u;let c=(l=t.length>2,u=n.cacheKey,{name:"GroupedConv",inputNames:l?["X","W","Bias"]:["X","W"],inputTypes:l?[s.TextureType.unpacked,s.TextureType.unpacked,s.TextureType.unpacked]:[s.TextureType.unpacked,s.TextureType.unpacked],cacheHint:u});return Object.assign(Object.assign({},c),{get:()=>((e,t,n,l)=>{let u=t.length>2?"value += getBias(output_channel);":"",c=t[0].dims.slice(),h=t[1].dims.slice(),d=h[0]/l.group;r.Logger.verbose("GroupedConv",`autpPad:${l.autoPad}, dilations:${l.dilations}, group:${l.group}, kernelShape:${l.kernelShape}, pads:${l.pads}, strides:${l.strides}`);let p=(0,a.calculateOutputShape)(c,h,l.dilations,l.pads,l.strides),f=(0,i.getGlsl)(e.session.backend.glContext.version),{activationFunction:g,applyActivation:m}=(0,o.getActivationSnippet)(l),y=`
  const ivec2 strides = ivec2(${l.strides[0]}, ${l.strides[1]});
  const ivec2 pads = ivec2(${l.pads[0]}, ${l.pads[1]});
  ${g}
  void main() {
    ivec4 coords = getOutputCoords();
    int batch = coords.x;
    int output_channel = coords.y;
    ivec2 xRCCorner = coords.zw * strides - pads;
    int group_id = output_channel / ${d};

    float value = 0.0;
    for (int wInChannel = 0; wInChannel < ${h[1]}; wInChannel++) {
      int input_channel = group_id * ${h[1]} + wInChannel;
      for (int wHeight = 0; wHeight < ${h[2]}; wHeight++) {
        int xHeight = xRCCorner.x + wHeight * ${l.dilations[0]};

        if (xHeight < 0 || xHeight >= ${c[2]}) {
          continue;
        }

        for (int wWidth = 0; wWidth < ${h[3]}; wWidth++) {
          int xWidth = xRCCorner.y + wWidth * ${l.dilations[1]};
          if (xWidth < 0 || xWidth >= ${c[3]}) {
            continue;
          }

          float xVal = getX(batch, input_channel, xWidth, xHeight);
          float wVal = getW(output_channel, wInChannel, wWidth, wHeight);
          value += xVal*wVal;
        }
      }
    }
    ${u}
    ${m}
    ${f.output} = vec4(value, .0, .0, .0);
  }
`;return Object.assign(Object.assign({},n),{output:{dims:p,type:t[0].type,textureType:s.TextureType.unpacked},shaderSource:y,hasMain:!0})})(e,t,c,n)})}},1386:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.conv2DPacked=t.conv2DPackedPointwise=void 0;let r=n(8138),i=n(8555),s=n(708);t.conv2DPackedPointwise=(e,t,n)=>{let i=t[0].dims,a=t[1].dims,o=(0,r.calculateOutputShape)(i,a,n.dilations,n.pads,n.strides),l=e.reshapePacked(t[0],[i[1],i[2]*i[3]]),u=e.reshapePacked(t[1],[a[0],a[1]]),c=t.length>2?[u,l,t[2]]:[u,l],h=e.run((0,s.createPackedMatmulProgramInfoLoader)(e,c,n),c);return e.reshapePacked(h,o)},t.conv2DPacked=(e,t,n)=>{let a=t[0].dims,o=t[1].dims,l=(0,r.calculateOutputShape)(a,o,n.dilations,n.pads,n.strides),u=e.run((0,i.createPackedIm2ColProgramInfoLoader)(e,t[0],t[1],l,n),[t[0]]),c=e.reshapePacked(t[1],[o[0],o[1]*o[2]*o[3]]),h=3===t.length?[c,u,t[2]]:[c,u],d=e.run((0,s.createPackedMatmulProgramInfoLoader)(e,h,n),h);return e.reshapePacked(d,l)}},9663:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseConvTransposeAttributes=t.convTranspose=void 0;let r=n(246),i=n(5060),s=n(2039),a=n(2823),o=(e,t,n,r,i,s)=>(e-1)*t+n+(r-1)*i+1-s,l=(e,t,n,r,i)=>{let s=Math.floor(e/2);"SAME_UPPER"===t?(n[r]=s,n[i]=e-s):"SAME_LOWER"===t&&(n[r]=e-s,n[i]=s)};t.convTranspose=(e,t,n)=>(d(t,n),u(e,t,n));let u=(e,t,n)=>{let r=h(n,t);return[c(e,t,r)]},c=(e,t,n)=>e.run(((e,t,n)=>{var r,o;let l=(r=t.length>2,o=n.cacheKey,{name:"ConvTranspose",inputNames:r?["X","W","B"]:["X","W"],inputTypes:r?[s.TextureType.unpacked,s.TextureType.unpacked,s.TextureType.unpacked]:[s.TextureType.unpacked,s.TextureType.unpacked],cacheHint:o});return Object.assign(Object.assign({},l),{get:()=>((e,t,n,r)=>{let o=t.length>2?"getB(output_channel)":"0.0",l=t[0].dims,u=t[1].dims,c=u[1],h=u[0]/r.group,d=[t[0].dims[0],t[1].dims[1]*r.group,...r.outputShape],p=(0,i.getGlsl)(e.session.backend.glContext.version),{activationFunction:f,applyActivation:g}=(0,a.getActivationSnippet)(r),m=`
  const ivec2 strides = ivec2(${r.strides[0]}, ${r.strides[1]});
  const ivec2 pads = ivec2(${r.pads[0]}, ${r.pads[1]});
  ${f}
  void main() {
    ivec4 coords = getOutputCoords();
    int batch = coords.x;
    int output_channel = coords.y;

    ivec2 loc = coords.zw + pads;

    int group_id = output_channel / ${c};
    int wOutChannel = output_channel - group_id * ${c};

    float value = ${o};
    for (int inChannelOffset = 0; inChannelOffset < ${h}; inChannelOffset++) {
      int input_channel = group_id * ${h} + inChannelOffset;
      for (int wWOff = 0; wWOff < ${u[2]}; wWOff++) {
        for (int wHOff = 0; wHOff < ${u[3]}; wHOff++) {
          ivec2 wOff = ivec2(wWOff * ${r.dilations[0]}, wHOff * ${r.dilations[1]});
          ivec2 wLoc = loc - wOff;
          ivec2 wLocIn = wLoc / strides;
          if (
            wLocIn * strides == wLoc &&
            wLocIn.x >= 0 && wLocIn.x < ${l[2]} &&
            wLocIn.y >= 0 && wLocIn.y < ${l[3]}
          ) {
            float xVal = getX(batch, input_channel, wLocIn.y, wLocIn.x);
            float wVal = getW(input_channel, wOutChannel, wHOff, wWOff);
            value += xVal * wVal;
          }
        }
      }
    }
    ${g}
    ${p.output} = vec4(value, .0, .0, .0);
  }
`;return Object.assign(Object.assign({},n),{output:{dims:d,type:t[0].type,textureType:s.TextureType.unpacked},shaderSource:m,hasMain:!0})})(e,t,l,n)})})(e,t,n),t),h=(e,t)=>{let n=e.kernelShape.slice();if(0===e.kernelShape.length)for(let e=2;e<t[1].dims.length;++e)n.push(t[1].dims[e]);let r=e.pads.slice(),i=e.outputShape.slice();((e,t,n,r,i,s,a,u)=>{let c=e.length-2,h=0===u.length;for(let d=0;d<c;++d){let p=h?e[d+2]*s[d]:u[d];l(o(e[d+2],s[d],i[d],t[d],n[d],p),r,i,d,d+c),h&&u.push(s[d]*(e[d+2]-1)+a[d]+(t[d]-1)*n[d]+1-i[d]-i[d+c])}})(t[0].dims,n,e.dilations,e.autoPad,r,e.strides,e.outputPadding,i);let s=Object.assign({},e);return Object.assign(s,{kernelShape:n,pads:r,outputShape:i,cacheKey:e.cacheKey}),s};t.parseConvTransposeAttributes=e=>{let t=e.attributes,n=(0,a.parseInternalActivationAttributes)(t),i=t.getString("auto_pad","NOTSET"),s=t.getInts("dilations",[1,1]),o=t.getInt("group",1),l=t.getInts("kernel_shape",[]),u=t.getInts("output_padding",[0,0]),c=t.getInts("output_shape",[]),h=t.getInts("pads",[0,0,0,0]),d=t.getInts("strides",[1,1]);return(0,r.createAttributeWithCacheKey)(Object.assign({autoPad:i,dilations:s,group:o,kernelShape:l,outputPadding:u,outputShape:c,pads:h,strides:d},n))};let d=(e,t)=>{if(!e||2!==e.length&&3!==e.length)throw Error("Conv requires 2 or 3 inputs");if(4!==e[0].dims.length||4!==e[1].dims.length)throw Error("currently only support 2-dimensional conv");if(e[0].dims[1]!==e[1].dims[0])throw Error("FILTER_IN_CHANNEL should be equal to DATA_CHANNEL");let n=e[1].dims[1]*t.group;if(3===e.length&&(1!==e[2].dims.length||e[2].dims[0]!==n))throw Error("invalid bias");let r=e[0].dims.length-2;if(t.dilations.length!==r)throw Error(`dilations should be ${r}D`);if(t.strides.length!==r)throw Error(`strides should be ${r}D`);if(t.pads.length!==2*r)throw Error(`pads should be ${2*r}D`);if(t.outputPadding.length!==r)throw Error(`output_padding should be ${r}D`);if(0!==t.kernelShape.length&&t.kernelShape.length!==e[1].dims.length-2)throw Error("invalid kernel shape");if(0!==t.outputShape.length&&t.outputShape.length!==e[0].dims.length-2)throw Error("invalid output shape");if("float32"!==e[0].type||"float32"!==e[1].type)throw Error("ConvTranspose input(X,W) should be float tensor");if(3===e.length&&"float32"!==e[2].type)throw Error("ConvTranspose input(bias) should be float tensor")}},8138:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseConvAttributes=t.conv=t.calculateOutputShape=void 0;let r=n(246),i=n(2517),s=n(4770),a=n(1386),o=n(9828),l=n(2823),u=n(3248),c=n(5623);t.calculateOutputShape=(e,t,n,r,i)=>{let s=e[0],a=e.slice(2),o=a.length,l=t[0],u=t.slice(2).map((e,t)=>e+(e-1)*(n[t]-1));return[s,l].concat(...a.map((e,t)=>e+r[t]+r[t+o]).map((e,t)=>Math.floor((e-u[t]+i[t])/i[t])))},t.conv=(e,t,n)=>(g(t,n),h(e,t,n));let h=(e,t,n)=>{let r=f(n,t),i=e.session.pack,o=1===r.kernelShape[0]&&1===r.kernelShape[1];return r.group>1?[e.run((0,s.createUnpackedGroupedConvProgramInfoLoader)(e,t,r),t)]:o&&i?[d(e,t,r)]:i&&4===t[0].dims.length&&1===t[0].dims[0]&&!o?[(0,a.conv2DPacked)(e,t,r)]:[p(e,t,r)]},d=(e,n,r)=>{let i=n[0].dims,s=n[1].dims,a=(0,t.calculateOutputShape)(i,s,r.dilations,r.pads,r.strides),o=e.reshapeUnpacked(n[0],[i[1],i[2]*i[3]]),l=e.reshapeUnpacked(n[1],[s[0],s[1]]),u=n.length>2?[l,o,n[2]]:[l,o],h=e.run((0,c.createMatmulProgramInfoLoader)(u,r),u);return e.reshapeUnpacked(h,a)},p=(e,n,r)=>{let i=n[0].dims,s=n[1].dims,a=(0,t.calculateOutputShape)(i,s,r.dilations,r.pads,r.strides),l=e.run((0,u.createIm2ColProgramInfoLoader)(e,n[0],n[1],a,r),[n[0]]),c=3===n.length?[l,n[1],n[2]]:[l,n[1]];return e.run((0,o.createDotProductProgramInfoLoader)(e,n,a,r),c)},f=(e,t)=>{let n=e.kernelShape.slice();if(0===e.kernelShape.length)for(let e=2;e<t[1].dims.length;++e)n.push(t[1].dims[e]);let r=e.pads.slice();i.PoolConvUtil.adjustPadsBasedOnAutoPad(t[0].dims,e.strides,e.dilations,n,r,e.autoPad);let s=Object.assign({},e);return Object.assign(s,{kernelShape:n,pads:r,cacheKey:e.cacheKey}),s};t.parseConvAttributes=e=>{let t=e.attributes,n=(0,l.parseInternalActivationAttributes)(t),i=t.getString("auto_pad","NOTSET"),s=t.getInts("dilations",[1,1]),a=t.getInt("group",1),o=t.getInts("kernel_shape",[]),u=t.getInts("pads",[0,0,0,0]),c=t.getInts("strides",[1,1]);return(0,r.createAttributeWithCacheKey)(Object.assign({autoPad:i,dilations:s,group:a,kernelShape:o,pads:u,strides:c},n))};let g=(e,t)=>{if(!e||2!==e.length&&3!==e.length)throw Error("Conv requires 2 or 3 inputs");if(4!==e[0].dims.length||4!==e[1].dims.length)throw Error("currently only support 2-dimensional conv");if(e[0].dims[1]!==e[1].dims[1]*t.group)throw Error("FILTER_IN_CHANNEL should be equal to DATA_CHANNEL");if(3===e.length&&(1!==e[2].dims.length||e[1].dims[0]!==e[2].dims[0]))throw Error("invalid bias");let n=e[0].dims.length-2;if(t.dilations.length!==n)throw Error(`dilations should be ${n}D`);if(t.strides.length!==n)throw Error(`strides should be ${n}D`);if(t.pads.length!==2*n)throw Error(`pads should be ${2*n}D`);if(0!==t.kernelShape.length&&t.kernelShape.length!==e[1].dims.length-2)throw Error("invalid kernel shape");if("float32"!==e[0].type||"float32"!==e[1].type)throw Error("Conv input(X,W) should be float tensor");if(3===e.length&&"float32"!==e[2].type)throw Error("Conv input(bias) should be float tensor")}},5193:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseDepthToSpaceAttributes=t.depthToSpace=void 0;let r=n(3738);t.depthToSpace=(e,t,n)=>{i(t);let s=n.blocksize,a=s*s,o="DCR"===n.mode?[0,3,4,1,5,2]:[0,1,4,2,5,3],l="DCR"===n.mode?[t[0].dims[0],s,s,t[0].dims[1]/a,t[0].dims[2],t[0].dims[3]]:[t[0].dims[0],t[0].dims[1]/a,s,s,t[0].dims[2],t[0].dims[3]],u=e.reshapeUnpacked(t[0],l),c={perm:o,cacheKey:`${o}`},[h]=(0,r.transpose)(e,[u],c),d=[t[0].dims[0],t[0].dims[1]/a,t[0].dims[2]*s,t[0].dims[3]*s];return[e.reshapeUnpacked(h,d)]},t.parseDepthToSpaceAttributes=e=>{let t=e.attributes.getInt("blocksize");if(t<1)throw Error(`blocksize must be >= 1, but got : ${t} for DepthToSpace`);let n=e.attributes.getString("mode","DCR");if("DCR"!==n&&"CRD"!==n)throw Error(`unrecognized mode: ${n} for DepthToSpace`);return{mode:n,blocksize:t}};let i=e=>{if(1!==e.length)throw Error(`DepthToSpace expect 1 inputs, but got ${e.length}`);if("string"===e[0].type||4!==e[0].dims.length)throw TypeError("DepthToSpace input should be a 4-D numeric tensor")}},9828:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createDotProductProgramInfoLoader=void 0;let r=n(2517),i=n(5060),s=n(2039),a=n(2823),o=n(3248);t.createDotProductProgramInfoLoader=(e,t,n,l)=>{let u=((e,t)=>({name:"ConvDotProduct",inputNames:e?["Im2Col","K","B"]:["Im2Col","K"],inputTypes:e?[s.TextureType.unpacked,s.TextureType.packedLastDimension,s.TextureType.unpacked]:[s.TextureType.unpacked,s.TextureType.packedLastDimension],cacheKey:t.activationCacheKey}))(t.length>2,l);return Object.assign(Object.assign({},u),{get:()=>((e,t,n,l,u)=>{let c=n[0].dims,h=n[1].dims,d=[h[0],Math.ceil(c[1]*h[2]*h[3]/4)],p=(0,o.calculateIm2ColDims)(c,h,l),[f,g]=e.calculateTextureWidthAndHeight(d,s.TextureType.packedLastDimension),m=r.ShapeUtil.computeStrides(p),[y,b]=e.calculateTextureWidthAndHeight(p,s.TextureType.packedLastDimension),v=l.length,w=n.length<3?"0.0":"_B(b)",_=Math.ceil(c[1]*h[2]*h[3]/4),{activationFunction:x,applyActivation:T}=(0,a.getActivationSnippet)(u),I=(0,i.getGlsl)(e.session.backend.glContext.version),k=`
${x}
float process(int indices[${v}]) {
  int b[1];
  b[0] = indices[1];
  int im2col[4];
  im2col[0] = indices[0];
  im2col[1] = indices[2];
  im2col[2] = indices[3];
  int im2colOffset = im2col[0] * ${m[0]} + im2col[1] * ${m[1]} + im2col[2] * ${m[2]};
  int kernelOffset = indices[1] * ${d[1]};
  float value = ${w};
  for (int i = 0; i < ${_}; ++i) {
    vec2 im2colCoords = offsetToCoords(im2colOffset, ${y}, ${b});
    vec2 kernelCoords = offsetToCoords(kernelOffset, ${f}, ${g});
    value += dot(${I.texture2D}(Im2Col, im2colCoords), ${I.texture2D}(K, kernelCoords));
    ++im2colOffset;
    ++kernelOffset;
  }
  ${T}
  return value;
}`;return Object.assign(Object.assign({},t),{output:{dims:l,type:n[0].type,textureType:s.TextureType.unpacked},shaderSource:k})})(e,u,t,n,l)})}},7992:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseFlattenAttributes=t.flatten=void 0;let r=n(2517);t.flatten=(e,t,n)=>{i(t,n);let s=r.ShapeUtil.flattenShape(t[0].dims,n);return[e.reshapeUnpacked(t[0],s)]},t.parseFlattenAttributes=e=>e.attributes.getInt("axis",1);let i=(e,t)=>{if(!e||1!==e.length)throw Error("Flatten requires 1 input.");let n=e[0].dims.length;if(0===n)throw Error("scalar tensor is not supported.");if(t<-n||t>n)throw Error("Invalid axis");if("string"===e[0].type)throw Error("string tensor is not supported.")}},2823:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseInternalActivationAttributes=t.getActivationSnippet=void 0;let r=n(2517),i=n(4909);t.getActivationSnippet=function(e){let t;switch(e.activation){case"Relu":t=(0,i.glslRelu)();break;case"Sigmoid":t=(0,i.glslSigmoid)();break;case"Clip":t=(0,i.glslClip)(e.clipMin,e.clipMax);break;default:return{activationFunction:"",applyActivation:""}}let n=t.name;return{activationFunction:t.body,applyActivation:`value = ${n}_(value);`}},t.parseInternalActivationAttributes=e=>{let t=e.getString("activation","");if("Clip"===t){let[n,i]=e.getFloats("activation_params",[r.MIN_CLIP,r.MAX_CLIP]);return{activation:t,clipMax:i,clipMin:n,activationCacheKey:`${t}:${n},${i}`}}return{activation:t,activationCacheKey:t}}},1253:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseGatherAttributes=t.gather=void 0;let r=n(246),i=n(782),s=n(2517),a=n(2039);t.gather=(e,t,n)=>(u(t,n.axis),[e.run(l(e,t,n),t)]),t.parseGatherAttributes=e=>(0,r.createAttributeWithCacheKey)({axis:e.attributes.getInt("axis",0)});let o={name:"Gather",inputNames:["A","B"],inputTypes:[a.TextureType.unpacked,a.TextureType.unpacked]},l=(e,t,n)=>{let r=Object.assign(Object.assign({},o),{cacheHint:n.cacheKey});return Object.assign(Object.assign({},r),{get:()=>((e,t,n,r)=>{let i=n[0].dims.slice(),o=n[1].dims.slice(),l=Array(i.length+o.length-1);r=s.ShapeUtil.normalizeAxis(r,i.length);let u=[];for(let e=0;e<l.length;e++)e<r?(l[e]=i[e],u.push(`inputIdx[${e}] = outputIdx[${e}];`)):e<r+o.length?(l[e]=o[e-r],u.push(`indexDataIdx[${e-r}] = outputIdx[${e}];`)):(l[e]=i[e-o.length+1],u.push(`inputIdx[${e-o.length+1}] = outputIdx[${e}];`));let c=`
      float process(int outputIdx[${l.length||1}]) {
        int inputIdx[${i.length}];
        int indexDataIdx[${o.length||1}];
        indexDataIdx[0] = 0;
        ${u.join("\n        ")}
        int idx = int(_B(indexDataIdx));
        inputIdx[${r}] = idx < 0 ? idx + ${i[r]} : idx;
        return _A(inputIdx);
      }`;return Object.assign(Object.assign({},t),{output:{dims:l,type:n[0].type,textureType:a.TextureType.unpacked},shaderSource:c})})(0,r,t,n.axis)})},u=(e,t)=>{if(!e||2!==e.length)throw Error("Gather requires 2 inputs.");let n=e[0].dims.length;if(n<1)throw Error("Invalid input shape.");if(t<-n||t>n-1)throw Error("Invalid axis.");if(-1===i.NUMBER_TYPES.indexOf(e[0].type)||"int32"!==e[1].type&&"int16"!==e[1].type)throw Error("Invaid input type.")}},4776:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseGemmAttributesV11=t.parseGemmAttributesV7=t.gemm=void 0;let r=n(246),i=n(2517),s=n(2039);t.gemm=(e,t,n)=>(u(t,n),[e.run(o(t,n),t)]);let a=(e,t)=>{let n=0!==e.attributes.getInt("transA",0),i=0!==e.attributes.getInt("transB",0),s=e.attributes.getFloat("alpha",1),a=e.attributes.getFloat("beta",1);return(0,r.createAttributeWithCacheKey)({transA:n,transB:i,alpha:s,beta:a,isOptionalC:t})};t.parseGemmAttributesV7=e=>a(e,!1),t.parseGemmAttributesV11=e=>a(e,!0);let o=(e,t)=>{let n={name:"Gemm",inputNames:3===e.length?["A","B","C"]:["A","B"],inputTypes:3===e.length?[s.TextureType.unpacked,s.TextureType.unpacked,s.TextureType.unpacked]:[s.TextureType.unpacked,s.TextureType.unpacked],key:t.cacheKey};return Object.assign(Object.assign({},n),{get:()=>l(n,e,t)})},l=(e,t,n)=>{let r=t[0].dims.slice(),a=t[1].dims.slice(),[o,l]=i.GemmUtil.getShapeOfGemmResult(r,n.transA,a,n.transB,3===t.length?t[2].dims:void 0),u=[o,l];if(!u)throw Error("Can't use gemm on the given tensors");let c=r[r.length-1],h="";n.transA&&(c=r[0]),n.transA&&n.transB?h="value += _A_T(a) * _B_T(b);":n.transA&&!n.transB?h="value += _A_T(a) * _B(b);":!n.transA&&n.transB?h="value += _A(a) * _B_T(b);":n.transA||n.transB||(h="value += _A(a) * _B(b);");let d=u.length,p=`
      float process(int indices[${d}]) {
          int a[${d}];
          int b[${d}];
          ${3===t.length?`int c[${t[2].dims.length}];`:""}

          copyVec(indices, a);
          copyVec(indices, b);
          ${3===t.length?"bcastIndices_C(indices, c);":""}

          float value = 0.0;
          for (int k=0; k<${c}; ++k) {
              a[${d-1}] = k;
              b[${d-2}] = k;
              ${h}
          }

          value = value * alpha;
          ${3===t.length?"value += beta * _C(c);":""}
          return value;
      }`;return Object.assign(Object.assign({},e),{output:{dims:u,type:t[0].type,textureType:s.TextureType.unpacked},variables:[{name:"alpha",type:"float",data:n.alpha},{name:"beta",type:"float",data:n.beta}],shaderSource:p})},u=(e,t)=>{if(!e)throw Error("Input is missing");if(t.isOptionalC&&(e.length<2||e.length>3))throw Error("Invaid input shape.");if(!t.isOptionalC&&3!==e.length)throw Error("Gemm requires 3 inputs");if(3===e.length&&1!==e[2].dims.length&&2!==e[2].dims.length)throw Error("Invalid input shape of C");if("float32"!==e[0].type&&"float64"!==e[0].type||"float32"!==e[1].type&&"float64"!==e[1].type||3===e.length&&"float32"!==e[2].type&&"float64"!==e[2].type)throw Error("Invalid input type.");if(e[0].type!==e[1].type||3===e.length&&e[0].type!==e[2].type)throw Error("Input types are mismatched")}},8555:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createPackedIm2ColProgramInfoLoader=void 0;let r=n(5060),i=n(2039),s=n(2827);t.createPackedIm2ColProgramInfoLoader=(e,t,n,a,o)=>{var l;let u=(l=o.cacheKey,{name:"Im2Col (packed)",inputNames:["A"],inputTypes:[i.TextureType.packed],cacheHint:l});return Object.assign(Object.assign({},u),{get:()=>((e,t,n,a,o,l)=>{let u=n.dims,c=a.dims,h=o.length,d=[c[1]*c[2]*c[3],o[2]*o[3]],p=c[2]*c[3],f=(0,s.unpackFromChannel)(),g=(0,r.getGlsl)(e.session.backend.glContext.version),m="";for(let e=0;e<=1;e++)for(let t=0;t<=1;t++)m+=`
            blockIndex = rc.x + ${t};
            pos = rc.y + ${e};

            if(blockIndex < ${d[1]} && pos < ${d[0]}) {
              offsetY = int(blockIndex / (${o[h-1]})) * ${l.strides[0]} -
                ${l.pads[0]};
              d0 = offsetY + ${l.dilations[0]} * (imod(pos, ${p}) / ${c[2]});

              if(d0 < ${u[2]} && d0 >= 0) {
                offsetX = imod(blockIndex, ${o[h-1]}) * ${l.strides[1]} -
                  ${l.pads[1]};
                d1 = offsetX + ${l.dilations[1]} * imod(imod(pos, ${p}), ${c[2]});

                if(d1 < ${u[3]} && d1 >= 0) {

                  ch = int(float(pos)/ ${p}.);
                    innerDims = vec2(d0, d1);
                    result[${2*e+t}] = getChannel(
                      getA(0, ch, int(innerDims.x),
                      int(innerDims.y)), innerDims);
                }
              }
            }

          `;let y=`
      ${f}

      void main() {
        ivec2 rc = getOutputCoords();
          vec4 result = vec4(0.0);
          int blockIndex, pos, offsetY, d0, offsetX, d1, ch;
          vec2 innerDims;
          ${m}
          ${g.output} = result;
      }
            `;return Object.assign(Object.assign({},t),{output:{dims:d,type:n.type,textureType:i.TextureType.packed},shaderSource:y,hasMain:!0})})(e,u,t,n,a,o)})}},3248:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.calculateIm2ColDims=t.createIm2ColProgramInfoLoader=void 0;let r=n(2039);t.createIm2ColProgramInfoLoader=(e,n,i,s,a)=>{var o;let l=(o=a.cacheKey,{name:"Im2Col",inputNames:["X"],inputTypes:[r.TextureType.unpacked],cacheHint:o});return Object.assign(Object.assign({},l),{get:()=>((e,n,i,s,a,o)=>{let l=i.dims,u=s.dims,c=a.length,h=(0,t.calculateIm2ColDims)(l,u,a,4),d=`
        const int XC = ${l[1]};
        const int XH = ${l[2]};
        const int XW = ${l[3]};
        const int KH = ${o.kernelShape[0]};
        const int KW = ${o.kernelShape[1]};
        const int dilationH = ${o.dilations[0]};
        const int dilationW = ${o.dilations[1]};
        const int strideH = ${o.strides[0]};
        const int strideW = ${o.strides[1]};
        const int padH = ${o.pads[0]};
        const int padW = ${o.pads[1]};
        const int KHKW = KH*KW;
        const int XCKHKW = XC * KHKW;
        const int outputChannels = 4;
        vec4 process(int indices[${c}]) {
          int b  = indices[0]; // batch size
          int oh = indices[1] * strideH - padH; //output height
          int ow = indices[2] * strideW - padW; //output width
          int p = indices[3] * outputChannels; //patch
          vec4 value = vec4(0.0);
          for(int i=0; i < outputChannels; ++i) {
            if(p < XCKHKW) {
              int patchC = p / KHKW;
              int patchH = (p - patchC*KHKW) / KW;
              int patchW = (p - patchC*KHKW) - patchH * KW;
              int xh2 = oh + patchH * dilationH;
              int xw2 = ow + patchW * dilationW;
              int x[${l.length}];
              x[0] = b;
              x[1] = patchC;
              x[2] = xh2;
              x[3] = xw2;
              if(xh2 >= 0 &&
                  xh2 < XH &&
                  xw2 >= 0 &&
                  xw2 < XW) {
                value[i] = _X(x);
              }
            }
            ++p;
          }
          return value;
        }
        `;return Object.assign(Object.assign({},n),{output:{dims:h,type:i.type,textureType:r.TextureType.packedLastDimension},shaderSource:d})})(0,l,n,i,s,a)})},t.calculateIm2ColDims=(e,t,n,r=4)=>[n[0],n[2],n[3],Math.ceil(e[1]*t[2]*t[3]/r)]},6572:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseImageScalerAttributes=t.imageScaler=void 0;let r=n(246),i=n(2039);t.imageScaler=(e,t,n)=>(l(t),[e.run(a(e,t,n),t)]),t.parseImageScalerAttributes=e=>{let t=e.attributes.getFloat("scale"),n=e.attributes.getFloats("bias");return(0,r.createAttributeWithCacheKey)({scale:t,bias:n})};let s={name:"ImageScaler",inputNames:["X"],inputTypes:[i.TextureType.unpacked]},a=(e,t,n)=>{let r=Object.assign(Object.assign({},s),{cacheHint:n.cacheKey});return Object.assign(Object.assign({},r),{get:()=>((e,t,n,r)=>{let s=n[0].dims.slice(),a=s.length,l=`
      ${o(r.bias.length)}
      float process(int indices[${a}]) {
        return _X(indices) * scale + getBias(bias, indices[1]);
      }`;return Object.assign(Object.assign({},t),{output:{dims:s,type:n[0].type,textureType:i.TextureType.unpacked},variables:[{name:"bias",type:"float",arrayLength:r.bias.length,data:r.bias},{name:"scale",type:"float",data:r.scale}],shaderSource:l})})(0,r,t,n)})},o=e=>{let t=[`float getBias(float bias[${e}], int channel) {`];for(let n=0;n<e;++n)0===n?t.push(`	if (channel == ${n}) { return bias[${n}]; }`):n===e-1?t.push(`	else { return bias[${n}]; }`):t.push(`	else if (channel == ${n}) { return bias[${n}]; }`);return t.push("	}"),t.join("\n")},l=e=>{if(!e||1!==e.length)throw Error("ImageScaler requires 1 input.");if(4!==e[0].dims.length)throw Error("Invalid input shape.");if("float32"!==e[0].type&&"float64"!==e[0].type)throw Error("Invalid input type.")}},3346:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseInstanceNormalizationAttributes=t.instanceNormalization=void 0;let r=n(5060),i=n(2039);t.instanceNormalization=(e,t,n)=>{u(t);let r=e.run(a(t[0]),t);return[e.run(l(e,t[0],n,r.dims),[t[0],r,t[1],t[2]])]},t.parseInstanceNormalizationAttributes=e=>e.attributes.getFloat("epsilon",1e-5);let s={name:"InstanceNormalization_MeanAndVariance",inputNames:["X"],inputTypes:[i.TextureType.unpacked]},a=e=>Object.assign(Object.assign({},s),{get:()=>((e,t)=>{let n=t.dims.slice(),r=n[1],s=n[2]*n[3],a=[n[0],r],o=`
      vec4 process(int[2] indices) {
        vec4 v = vec4(0.0);
        int a[4];
        a[0] = indices[0];
        a[1] = indices[1];
        float temp = 0.0;
        for(int a2=0; a2<${n[2]}; a2++) {
          a[2] = a2;
          for(int a3=0; a3<${n[3]}; a3++) {
            a[3] = a3;
            float x = _X(a);
            temp += x;
          }
        }
        float mean = temp / float(${s});
        temp = 0.0;
        for(int a2=0; a2<${n[2]}; a2++) {
          a[2] = a2;
          for(int a3=0; a3<${n[3]}; a3++) {
            a[3] = a3;
            float x = _X(a);
            temp += (x - mean) * (x - mean);
          }
        }
        v.r = mean;
        v.g = temp / float(${s});

        return v;
      }`;return Object.assign(Object.assign({},e),{output:{dims:a,type:t.type,textureType:i.TextureType.packedLastDimension},shaderSource:o})})(s,e)}),o={name:"InstanceNormalization_ComputeOutput",inputNames:["X","MeanAndVariance","Scale","B"],inputTypes:[i.TextureType.unpacked,i.TextureType.packedLastDimension,i.TextureType.unpacked,i.TextureType.unpacked]},l=(e,t,n,s)=>{let a=Object.assign(Object.assign({},o),{cacheHint:`${n}`});return Object.assign(Object.assign({},a),{get:()=>((e,t,n,s,a)=>{let o=(0,r.getGlsl)(e.session.backend.glContext.version),[l,u]=e.calculateTextureWidthAndHeight(a,i.TextureType.packedLastDimension),[c,h]=[l/4,u],d=`
      vec4 get_MeanAndVariance(int[2] mv) {
        int offset = indicesToOffset_MeanAndVariance(mv);
        vec2 coords = offsetToCoords(offset, ${c}, ${h});
        return ${o.texture2D}(MeanAndVariance, coords);
      }

      float process(int[4] indices) {
        int mv[2];
        mv[0] = indices[0];
        mv[1] = indices[1];
        vec4 mean_and_variance = get_MeanAndVariance(mv);
        float mean = mean_and_variance.r;
        float variance = mean_and_variance.g;

        int sb[1];
        sb[0] = indices[1];
        float scale = _Scale(sb);
        float b = _B(sb);

        return scale * (_X(indices) - mean) / sqrt(variance + epsilon) + b;
      }`;return Object.assign(Object.assign({},t),{output:{dims:n.dims,type:n.type,textureType:i.TextureType.unpacked},variables:[{name:"epsilon",type:"float",data:s}],shaderSource:d})})(e,a,t,n,s)})},u=e=>{if(!e||3!==e.length)throw Error("InstanceNormalization requires 3 inputs.");let t=e[0],n=e[1],r=e[2];if(t.dims.length<3||1!==n.dims.length||1!==r.dims.length)throw Error("Invalid input shape.");if(n.dims[0]!==t.dims[1]||r.dims[0]!==t.dims[1])throw Error("Input shapes are mismatched.");if("float32"!==t.type&&"float64"!==t.type||"float32"!==n.type&&"float64"!==n.type||"float32"!==r.type&&"float64"!==r.type)throw Error("Invalid input type.");if(4!==e[0].dims.length)throw Error("Only support 4-D input shape.")}},708:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createPackedMatmulProgramInfoLoader=void 0;let r=n(2517),i=n(5060),s=n(2039),a=n(9390),o=n(2823),l=n(5623);t.createPackedMatmulProgramInfoLoader=(e,t,n)=>{var u,c;let h=(u=t.length>2,c=n.activationCacheKey,{name:"MatMul (packed)",inputNames:u?["A","B","Bias"]:["A","B"],inputTypes:u?[s.TextureType.packed,s.TextureType.packed,s.TextureType.packed]:[s.TextureType.packed,s.TextureType.packed],cacheHint:c});return Object.assign(Object.assign({},h),{get:()=>((e,t,n,u)=>{let c=n.length>2,h=c?"value += getBiasForMatmul();":"",d=n[0].dims,p=n[1].dims,f=r.BroadcastUtil.calcShape(d,p,!0),g=!r.ShapeUtil.areEqual(n[0].dims,n[1].dims);if(!f)throw Error("Can't use matmul on the given tensors");let m=Math.ceil(d[d.length-1]/2),y=d.length,b=p.length,v=(0,i.getGlsl)(e.session.backend.glContext.version),w=(0,a.getCoordsDataType)(f.length),_=f.length,x=(0,a.getGlChannels)(),{activationFunction:T,applyActivation:I}=(0,o.getActivationSnippet)(u),k=c?`${(0,l.getBiasForMatmul)(w,x,n[2].dims,f,!0)}`:"",S=g?`${function(e,t,n,i){let s=[],a=[],o=n[0].dims,l=n[1].dims,u=o.length,c=l.length,h=i.length,d=h-u,p=h-c;(s=o.map((e,n)=>`coords.${t[n+d]}`))[u-1]="i*2",s.join(", "),(a=l.map((e,n)=>`coords.${t[n+p]}`))[c-2]="i*2",a.join(", ");let f=r.BroadcastUtil.getBroadcastDims(o,i),g=r.BroadcastUtil.getBroadcastDims(l,i),m=f.map(e=>`coords.${t[e+d]} = 0;`).join("\n"),y=g.map(e=>`coords.${t[e+p]} = 0;`).join("\n"),b=`int lastDim = coords.${t[h-1]};
  coords.${t[h-1]} = coords.${t[h-2]};
  coords.${t[h-2]} = lastDim;`;return`
vec4 getAAtOutCoordsMatmul(int i) {
  ${e} coords = getOutputCoords();
  ${b}
  ${m}
  vec4 outputValue = getA(${s});
  return outputValue;
}

vec4 getBAtOutCoordsMatmul(int i) {
  ${e} coords = getOutputCoords();
  ${b}
  ${y}
  vec4 outputValue = getB(${a});
  return outputValue;
}`}(w,x,n,f)}`:"",E=g?"getAAtOutCoordsMatmul(i)":`getA(${function(e,t){let n="";for(let r=0;r<t-2;r++)n+=`rc.${e[r]}, `;return n+`rc.${e[t-2]}, i*2`}(x,y)})`,C=g?"getBAtOutCoordsMatmul(i)":`getB(${function(e,t){let n="";for(let r=0;r<t-2;r++)n+=`rc.${e[r]}, `;return n+`i*2, rc.${e[t-1]}`}(x,b)})`,A=`
            ${S}
            ${k}
            ${T}
            void main() {
              ${g?"":`${w} rc =
          getOutputCoords(); int lastDim = rc.${x[_-1]}; rc.${x[_-1]} =
          rc.${x[_-2]}; rc.${x[_-2]} = lastDim;
      `}

              vec4 value = vec4(0);
              for (int i = 0; i < ${m}; i++) {
                vec4 a = ${E};
                vec4 b = ${C};

                value += (a.rrbb * b.rgrg);
                value += (a.ggaa * b.baba);
              }
              ${h}
              ${I}
              ${v.output} = value;
            }`;return Object.assign(Object.assign({},t),{output:{dims:f,type:n[0].type,textureType:s.TextureType.packed},shaderSource:A,hasMain:!0})})(e,h,t,n)})}},5623:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getBiasForMatmul=t.createMatmulProgramInfoLoader=t.parseMatMulAttributes=t.matMul=void 0;let r=n(2517),i=n(2039),s=n(9390),a=n(2823),o=n(708);function l(e,t){var n,o;let l=(n=e.length>2,o=t.activationCacheKey,{name:"MatMul",inputNames:n?["A","B","Bias"]:["A","B"],inputTypes:n?[i.TextureType.unpacked,i.TextureType.unpacked,i.TextureType.unpacked]:[i.TextureType.unpacked,i.TextureType.unpacked],cacheHint:o});return Object.assign(Object.assign({},l),{get:()=>(function(e,t,n){let o=t[0].dims,l=t[1].dims,u=r.BroadcastUtil.calcShape(o,l,!0);if(!u)throw Error("Can't use matmul on the given tensors");let h=(0,s.getCoordsDataType)(u.length),d=(0,s.getGlChannels)(),{activationFunction:p,applyActivation:f}=(0,a.getActivationSnippet)(n),g=t.length>2,m=g?"value += getBiasForMatmul();":"",y=g?`${c(h,d,t[2].dims,u,!1)}`:"",b=u.length,v=o.length,w=l.length,_=`
    ${p}
    ${y}
    float process(int indices[${b}]) {
        int a[${v}];
        int b[${w}];
        bcastMatmulIndices_A(indices, a);
        bcastMatmulIndices_B(indices, b);

        float value;
        for (int k=0; k<${o[o.length-1]}; ++k) {
            a[${v-1}] = k;
            b[${w-2}] = k;
            value += _A(a) * _B(b);
        }
        ${m}
        ${f}
        return value;
    }`;return Object.assign(Object.assign({},e),{output:{dims:u,type:t[0].type,textureType:i.TextureType.unpacked},shaderSource:_})})(l,e,t)})}t.matMul=(e,t,n)=>(u(t),e.session.pack?[e.run((0,o.createPackedMatmulProgramInfoLoader)(e,t,n),t)]:[e.run(l(t,n),t)]),t.parseMatMulAttributes=e=>(0,a.parseInternalActivationAttributes)(e.attributes),t.createMatmulProgramInfoLoader=l;let u=e=>{if(!e||2!==e.length)throw Error("MatMul requires 2 inputs.");if(e[0].dims[e[0].dims.length-1]!==e[1].dims[e[1].dims.length-2])throw Error("shared dimension does not match.");if("float32"!==e[0].type&&"float64"!==e[0].type||"float32"!==e[1].type&&"float64"!==e[1].type)throw Error("inputs should be float type");if(e[0].type!==e[1].type)throw Error("inputs types should match")};function c(e,t,n,i,s){let a="",o=n.length,l=i.length,u=l-o;a=l<2&&o>0?"coords":n.map((e,n)=>`coords.${t[n+u]}`).join(", ");let c=r.BroadcastUtil.getBroadcastDims(n,i).map(e=>`coords.${t[e+u]} = 0;`).join("\n"),h="vec4(outputValue.xx, outputValue.yy)";return 1===r.ShapeUtil.size(n)&&(h="vec4(outputValue.x)"),s?`
vec4 getBiasForMatmul() {
  ${e} coords = getOutputCoords();
  ${c}
  vec4 outputValue = getBias(${a});
  return ${h};
}`:`
float getBiasForMatmul() {
  ${e} coords = getOutputCoords();
  ${c}
  return getBias(coords.x);
}`}t.getBiasForMatmul=c},2403:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createPackProgramInfoLoader=void 0;let r=n(5060),i=n(2039),s=n(9390),a=n(2827),o={name:"pack",inputNames:["A"],inputTypes:[i.TextureType.unpackedReversed]};t.createPackProgramInfoLoader=(e,t)=>Object.assign(Object.assign({},o),{get:()=>((e,t)=>{var n,l,u,c;let h;let d=(0,r.getGlsl)(e.session.backend.glContext.version),p=t.dims,f=p.length,g=t.dims.length,m=(0,s.getCoordsDataType)(g),y=(0,a.getChannels)("rc",g),b=(n=g,l=y,u=p[p.length-2],c=p[p.length-1],0===n||1===n?"":`
    int r = ${l[n-2]};
    int c = ${l[n-1]};
    int rp1 = ${l[n-2]} + 1;
    int cp1 = ${l[n-1]} + 1;
    bool rEdge = rp1 >= ${c};
    bool cEdge = cp1 >= ${u};
    `);h=0===f?[1,1]:1===f?[p[0],1]:[p[g-1],p[g-2]];let v=function(e,t,n){if(0===e)return"false";if(1===e)return`rc > ${t[0]}`;let r="";for(let i=e-2;i<e;i++)r+=`${n[i]} >= ${t[i-e+2]}`,i<e-1&&(r+="||");return r}(g,h,y),w=function(e,t){let n=e.length;if(0===n)return"getA(), 0, 0, 0";if(1===n)return`getA(rc),
            rc + 1 >= ${e[0]} ? 0. : getA(rc + 1),
            0, 0`;let r="";if(n>2)for(let e=0;e<n-2;++e)r+=`${t[e]},`;return`getA(${r}r, c),
          rEdge ? 0. : getA(${r}rp1, c),
          cEdge ? 0. : getA(${r}r, cp1),
          rEdge || cEdge ? 0. : getA(${r}rp1, cp1)`}(p,y),_=`
        void main() {
          ${m} rc = getOutputCoords();

          if(${v}) {
            ${d.output} = vec4(0);
          } else {
            ${b}

            ${d.output} = vec4(${w});
          }
        }
      `;return Object.assign(Object.assign({},o),{hasMain:!0,output:{dims:t.dims,type:t.type,textureType:i.TextureType.packed},shaderSource:_})})(e,t)})},2827:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.unpackFromChannel=t.getChannels=t.getVecChannels=void 0;let r=n(9390);function i(e,t){return(0,r.getGlChannels)(t).map(t=>`${e}.${t}`)}t.getVecChannels=i,t.getChannels=function(e,t){return 1===t?[e]:i(e,t)},t.unpackFromChannel=function(){return"\n    float getChannel(vec4 frag, int dim) {\n      int modCoord = imod(dim, 2);\n      return modCoord == 0 ? frag.r : frag.g;\n    }\n\n    float getChannel(vec4 frag, vec2 innerDims) {\n      vec2 modCoord = mod(innerDims, 2.);\n      return modCoord.x == 0. ?\n        (modCoord.y == 0. ? frag.r : frag.g) :\n        (modCoord.y == 0. ? frag.b : frag.a);\n    }\n  "}},2870:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parsePadAttributesV11=t.padV11=t.parsePadAttributesV2=t.padV2=void 0;let r=n(246),i=n(2517),s=n(5060),a=n(2039),o={name:"Pad",inputNames:["A"],inputTypes:[a.TextureType.unpacked]};t.padV2=(e,t,n)=>(c(t),[e.run(Object.assign(Object.assign({},o),{cacheHint:n.cacheKey,get:()=>u(e,t[0],n)}),t)]),t.parsePadAttributesV2=e=>{let t=e.attributes.getString("mode","constant"),n=e.attributes.getFloat("value",0),i=e.attributes.getInts("pads");return(0,r.createAttributeWithCacheKey)({mode:t,value:n,pads:i})},t.padV11=(e,n,r)=>{h(n);let i=l(e,n,r);return(0,t.padV2)(e,[n[0]],i)},t.parsePadAttributesV11=e=>e.attributes.getString("mode","constant");let l=(e,t,n)=>{if(!e.session.isInitializer(t[1].dataId)||t.length>=3&&!e.session.isInitializer(t[2].dataId))throw Error("dynamic pad attributes are not allowed");let i=Array.from(t[1].integerData),s=t.length>=3?t[2].floatData[0]:0;return(0,r.createAttributeWithCacheKey)({mode:n,pads:i,value:s})},u=(e,t,n)=>{let r=i.ShapeUtil.padShape(t.dims.slice(),n.pads),s=r.length,o=`
      ${d(e,t,n)}
      float process(int[${s}] indices) {
          return padA(indices);
      }`;return{name:"Pad",inputNames:["A"],inputTypes:[a.TextureType.unpacked],output:{dims:r,type:t.type,textureType:a.TextureType.unpacked},shaderSource:o}},c=e=>{if(!e||1!==e.length)throw Error("Pad requires 1 input");if("float32"!==e[0].type&&"float64"!==e[0].type)throw Error("Invalid input type.")},h=e=>{if(!e||2!==e.length&&3!==e.length)throw Error("Pad requires 2 or 3 inputs");if("int32"!==e[1].type||e.length>=3&&"string"===e[2].type)throw Error("Invalid input type.")},d=(e,t,n)=>{let r=(0,s.getGlsl)(e.session.backend.glContext.version),[o,l]=e.calculateTextureWidthAndHeight(t.dims,a.TextureType.unpacked),u=i.ShapeUtil.computeStrides(t.dims);switch(n.mode){case"constant":return p(r,t.dims,u,o,l,n.pads,n.value);case"reflect":return f(r,t.dims,u,o,l,n.pads);case"edge":return g(r,t.dims,u,o,l,n.pads);default:throw Error("Invalid mode")}},p=(e,t,n,r,i,s,a)=>{let o=t.length,l="";for(let e=o-1;e>=0;--e)l+=`
        k = m[${e}] - ${s[e]};
        if (k < 0)  return constant;
        if (k >= ${t[e]}) return constant;
        offset += k * ${n[e]};
        `;return`
      float padA(int m[${o}]) {
        const float constant = float(${a});
        int offset = 0;
        int k = 0;
        ${l}
        vec2 coords = offsetToCoords(offset, ${r}, ${i});
        float value = getColorAsFloat(${e.texture2D}(A, coords));
        return value;
      }
      `},f=(e,t,n,r,i,s)=>{let a=t.length,o="";for(let e=a-1;e>=0;--e)o+=`
        k = m[${e}] - ${s[e]};
        if (k < 0) { k = -k; }
        {
          const int _2n_1 = ${2*(t[e]-1)};
          k = int( mod( float(k), float(_2n_1) ) ) ;
          if(k >= ${t[e]}) { k = _2n_1 - k; }
        }
        offset += k * ${n[e]};
        `;return`
      float padA(int m[${a}]) {
        int offset = 0;
        int k = 0;
        ${o}
        vec2 coords = offsetToCoords(offset, ${r}, ${i});
        float value = getColorAsFloat(${e.texture2D}(A, coords));
        return value;
      }
      `},g=(e,t,n,r,i,s)=>{let a=t.length,o="";for(let e=a-1;e>=0;--e)o+=`
        k = m[${e}] - ${s[e]};
        if (k < 0)  k = 0;
        if (k >= ${t[e]}) k = ${t[e]-1};
        offset += k * ${n[e]};
      `;return`
      float padA(int m[${a}]) {
        int offset = 0;
        int k = 0;
        ${o}
        vec2 coords = offsetToCoords(offset, ${r}, ${i});
        float value = getColorAsFloat(${e.texture2D}(A, coords));
        return value;
      }
      `}},2143:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.globalMaxPool=t.parseMaxPoolAttributes=t.maxPool=t.parseGlobalAveragePoolAttributes=t.globalAveragePool=t.parseAveragePoolAttributes=t.averagePool=void 0;let r=n(246),i=n(2517),s=n(2039);t.averagePool=(e,t,n)=>{h(t);let r={name:"AveragePool",inputNames:["X"],inputTypes:[s.TextureType.unpacked],cacheHint:n.cacheKey};return[e.run(Object.assign(Object.assign({},r),{get:()=>a(t,r,!1,n)}),t)]},t.parseAveragePoolAttributes=e=>{let t=e.attributes.getString("auto_pad","NOTSET"),n=e.attributes.getInt("ceil_mode",0),i=0!==e.attributes.getInt("count_include_pad",0),s=e.attributes.getInts("kernel_shape"),a=e.attributes.getInts("strides",[]),o=e.attributes.getInts("pads",[]);if(0!==n)throw Error("using ceil() in shape computation is not yet supported for AveragePool");return(0,r.createAttributeWithCacheKey)({autoPad:t,ceilMode:n,countIncludePad:i,kernelShape:s,strides:a,pads:o})};let a=(e,t,n,r)=>{let[a,o]=l(e,r,n),u=i.ShapeUtil.size(a.kernelShape),c="";a.countIncludePad?c+=`value /= float(${u});`:c+=`value /= float(${u} - pad);`;let h=`
        ${d(e[0].dims,a,"value += _X(x);",c,"0.0")}
      `;return Object.assign(Object.assign({},t),{output:{dims:o,type:e[0].type,textureType:s.TextureType.unpacked},shaderSource:h})};t.globalAveragePool=(e,t,n)=>{h(t);let r={name:"GlobalAveragePool",inputNames:["X"],inputTypes:[s.TextureType.unpacked],cacheHint:`${n.countIncludePad}`};return[e.run(Object.assign(Object.assign({},r),{get:()=>a(t,r,!0,n)}),t)]},t.parseGlobalAveragePoolAttributes=e=>{let t=0!==e.attributes.getInt("count_include_pad",0);return(0,r.createAttributeWithCacheKey)({autoPad:"",ceilMode:0,countIncludePad:t,kernelShape:[],strides:[],pads:[]})},t.maxPool=(e,t,n)=>{h(t);let r={name:"MaxPool",inputNames:["X"],inputTypes:[s.TextureType.unpacked],cacheHint:n.cacheKey};return[e.run(Object.assign(Object.assign({},r),{get:()=>o(t,r,!1,n)}),t)]},t.parseMaxPoolAttributes=e=>{let t=e.attributes.getString("auto_pad","NOTSET"),n=e.attributes.getInt("ceil_mode",0),i=e.attributes.getInts("kernel_shape"),s=e.attributes.getInts("strides",[]),a=e.attributes.getInts("pads",[]),o=e.attributes.getInt("storage_order",0),l=e.attributes.getInts("dilations",[]);if(0!==o)throw Error("column major storage order is not yet supported for MaxPool");if(0!==n)throw Error("using ceil() in shape computation is not yet supported for MaxPool");return(0,r.createAttributeWithCacheKey)({autoPad:t,ceilMode:n,countIncludePad:!1,kernelShape:i,strides:s,pads:a,storageOrder:o,dilations:l})};let o=(e,t,n,r)=>{let[i,a]=l(e,r,n),o=`
      ${d(e[0].dims,i,"\n      value = max(_X(x), value);\n    ","","-1e5")}
    `;return Object.assign(Object.assign({},t),{output:{dims:a,type:e[0].type,textureType:s.TextureType.unpacked},shaderSource:o})},l=(e,t,n)=>{let r=e[0].dims.slice(),s=Object.hasOwnProperty.call(t,"dilations"),a=t.kernelShape.slice(),o=t.strides.slice(),l=s?t.dilations.slice():[],u=t.pads.slice();i.PoolConvUtil.adjustPoolAttributes(n,r,a,o,l,u);let c=i.PoolConvUtil.computePoolOutputShape(n,r,o,l,a,u,t.autoPad),h=Object.assign({},t);return s?Object.assign(h,{kernelShape:a,strides:o,pads:u,dilations:l,cacheKey:t.cacheKey}):Object.assign(h,{kernelShape:a,strides:o,pads:u,cacheKey:t.cacheKey}),[h,c]},u={autoPad:"",ceilMode:0,countIncludePad:!1,kernelShape:[],strides:[],pads:[],storageOrder:0,dilations:[],cacheKey:""},c={name:"GlobalMaxPool",inputNames:["X"],inputTypes:[s.TextureType.unpacked]};t.globalMaxPool=(e,t)=>(h(t),[e.run(Object.assign(Object.assign({},c),{get:()=>o(t,c,!0,u)}),t)]);let h=e=>{if(!e||1!==e.length)throw Error("Pool ops requires 1 input.");if("float32"!==e[0].type&&"float64"!==e[0].type)throw Error("Invalid input type.")},d=(e,t,n,r,s)=>{let a=e.length;if(t.kernelShape.length<=2){let i=t.kernelShape[t.kernelShape.length-1],o=t.strides[t.strides.length-1],l=t.pads[t.pads.length/2-1],u=t.pads[t.pads.length-1],c=e[a-1],h="",d="",p="";if(h=l+u!==0?`
          for (int i = 0; i < ${i}; i++) {
            x[${a} - 1] = indices[${a} - 1] * ${o} - ${l} + i;
            if (x[${a} - 1] < 0 || x[${a} - 1] >= ${c}) {
              pad++;
              continue;
            }
            ${n}
          }`:`
          for (int i = 0; i < ${i}; i++) {
            x[${a} - 1] = indices[${a} - 1] * ${o} - ${l} + i;
            ${n}
          }`,2===t.kernelShape.length){let n=t.kernelShape[t.kernelShape.length-2],r=t.strides[t.strides.length-2],s=t.pads[t.pads.length/2-2],o=t.pads[t.pads.length-2],l=e[a-2];d=s+o!==0?`
            for (int j = 0; j < ${n}; j++) {
              x[${a} - 2] = indices[${a} - 2] * ${r} - ${s} + j;
              if (x[${a} - 2] < 0 || x[${a} - 2] >= ${l}) {
                pad+= ${i};
                continue;
              }
          `:`
            for (int j = 0; j < ${n}; j++) {
              x[${a} - 2] = indices[${a} - 2] * ${r} - ${s} + j;
            `,p="\n          }\n        "}return`
        float process(int indices[${a}]) {
          int x[${a}];
          copyVec(indices, x);

          float value = ${s};
          int pad = 0;
          ${d}
          ${h}
          ${p}
          ${r}
          return value;
        }
      `}{let o=i.ShapeUtil.size(t.kernelShape),l=i.ShapeUtil.computeStrides(t.kernelShape),u=l.length,c=t.pads.length,h=f(u),d=p(e,"inputDims"),g=p(t.pads,"pads"),m=p(l,"kernelStrides"),y=p(t.strides,"strides"),b="";return b=t.pads.reduce((e,t)=>e+t)?`
            if (x[j] >= inputDims[j] || x[j] < 0) {
              pad++;
              isPad = true;
              break;
            }
          }
          if (!isPad) {
            ${n}
          }`:`
          }
          ${n}
        `,`
        ${h}
        float process(int indices[${a}]) {
          int x[${a}];
          copyVec(indices, x);
          int offset[${u}];
          int pads[${c}];
          int inputDims[${a}];
          int kernelStrides[${u}];
          int strides[${u}];
          ${g}
          ${d}
          ${y}
          ${m}

          float value = ${s};
          int pad = 0;
          bool isPad = false;
          for (int i = 0; i < ${o}; i++) {
            offsetToIndices(i, kernelStrides, offset);
            isPad = false;
            for (int j = ${a} - ${u}; j < ${a}; j++) {
              x[j] = indices[j] * strides[j - ${a} + ${u}]
                + offset[j - ${a} + ${u}] - pads[j - 2];
              ${b}
          }
          ${r}

          return value;
        }
      `}},p=(e,t)=>{let n="";for(let r=0;r<e.length;r++)n+=`
      ${t}[${r}] = ${e[r]};
    `;return n},f=e=>`
  void offsetToIndices(int offset, int[${e}] strides, out int[${e}] indices) {
    if (${e} == 0) {
      return;
    }
    for (int i = 0; i < ${e} - 1; ++i) {
      indices[i] = offset / strides[i];
      offset -= indices[i] * strides[i];
    }
    indices[${e} - 1] = offset;
  }`},4939:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.reduceLogSumSquare=t.reduceLogSum=t.reduceProd=t.reduceMin=t.reduceMax=t.reduceMean=t.reduceSum=t.parseReduceAttributes=void 0;let r=n(246),i=n(782),s=n(2517),a=n(2039),o=(e,t,n,r,i)=>{u(t);let s={name:r,inputNames:["A"],inputTypes:[a.TextureType.unpacked]};return[e.run(Object.assign(Object.assign({},s),{cacheHint:n.cacheKey,get:()=>l(e,t,n,r,i,s)}),t)]};t.parseReduceAttributes=e=>{let t=e.attributes.getInts("axes",[]),n=1===e.attributes.getInt("keepdims",1);return(0,r.createAttributeWithCacheKey)({axes:t,keepDims:n})};let l=(e,t,n,r,i,o)=>{let l=[],u=t[0].dims.length||1,c=[],h=s.ShapeUtil.normalizeAxes(n.axes,t[0].dims.length),d=i(t,h),p=d[1];for(let e=0;e<t[0].dims.length;e++)h.indexOf(e)>=0||0===h.length?(n.keepDims&&l.push(1),p=`
          for(int j${e} = 0; j${e} < ${t[0].dims[e]}; j${e}++) {
            inputIdx[${e}] = j${e};
            ${p}
          }`):(c.push(`inputIdx[${e}] = outputIdx[${l.length}];`),l.push(t[0].dims[e]));let f=`
      float process(int outputIdx[${l.length||1}]) {
        float value;                 // final result
        int inputIdx[${u}];      // addressing input data
        ${c.join("\n")}
        ${d[0]}       // init ops for reduce max/min
        ${p}
        ${d[2]}       // final computation for reduce mean
        return value;
      }`;return Object.assign(Object.assign({},o),{output:{dims:l,type:t[0].type,textureType:a.TextureType.unpacked},shaderSource:f})},u=e=>{if(!e||1!==e.length)throw Error("Reduce op requires 1 input.");if(-1===i.NUMBER_TYPES.indexOf(e[0].type))throw Error("Invalid input type.")};t.reduceSum=(e,t,n)=>o(e,t,n,"ReduceSum",()=>["value = 0.0;","value += _A(inputIdx);",""]),t.reduceMean=(e,t,n)=>o(e,t,n,"ReduceMean",(e,t)=>{let n=1;for(let r=0;r<e[0].dims.length;r++)(t.indexOf(r)>=0||0===t.length)&&(n*=e[0].dims[r]);return["value = 0.0;","value += _A(inputIdx);",`value /= ${n}.;`]}),t.reduceMax=(e,t,n)=>o(e,t,n,"ReduceMax",(e,t)=>{let n=[];for(let r=0;r<e[0].dims.length;r++)(t.indexOf(r)>=0||0===t.length)&&n.push(`inputIdx[${r}] = 0;`);return[`${n.join("\n")}
value = _A(inputIdx);`,"value = max(value, _A(inputIdx));",""]}),t.reduceMin=(e,t,n)=>o(e,t,n,"ReduceMin",(e,t)=>{let n=[];for(let r=0;r<e[0].dims.length;r++)(t.indexOf(r)>=0||0===t.length)&&n.push(`inputIdx[${r}] = 0;`);return[`${n.join("\n")}
value = _A(inputIdx);`,"value = min(value, _A(inputIdx));",""]}),t.reduceProd=(e,t,n)=>o(e,t,n,"ReduceProd",()=>["value = 1.0;","value *= _A(inputIdx);",""]),t.reduceLogSum=(e,t,n)=>o(e,t,n,"ReduceLogSum",()=>["value = 0.0;","value += _A(inputIdx);","value = log(value);"]),t.reduceLogSumSquare=(e,t,n)=>o(e,t,n,"ReduceLogSumSquare",()=>["float t; value = 0.0;","t = _A(inputIdx); value += t * t;",""])},7019:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isReshapeCheap=t.processDims3D=t.createPackedReshape3DProgramInfoLoader=void 0;let r=n(2517),i=n(5060),s=n(2039),a=n(2827);t.createPackedReshape3DProgramInfoLoader=(e,t,n)=>{let o;let l=(o=n,{name:"Reshape (packed)",inputTypes:[s.TextureType.packed],inputNames:["A"],cacheHint:`${o}`});return Object.assign(Object.assign({},l),{get:()=>((e,t,n,o)=>{let l=t.dims,u=o,c="";for(let e=0;e<4;e++){let t="";switch(e){case 0:t="outputCoords = rc;";break;case 1:t="outputCoords = ivec3(rc.x, rc.y+1, rc.z);";break;case 2:t="outputCoords = ivec3(rc.x, rc.y, rc.z+1);";break;case 3:t="outputCoords = ivec3(rc.x, rc.y+1, rc.z+1);";break;default:throw Error()}c+=`
        ${t}
        ${e>0?"if(outputCoords.y < rows && outputCoords.z < cols){":""}
          int flattenedIndex = getFlattenedIndex(outputCoords);

          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flattenedIndex);
          vec2 innerDims = vec2(float(inputRC.y),float(inputRC.z));

          result[${e}] = getChannel(getA(inputRC.x, inputRC.y, inputRC.z), innerDims);

        ${e>0?"}":""}
      `}let h=(0,i.getGlsl)(e.session.backend.glContext.version),d=`
      ${function(e){let t=r.ShapeUtil.computeStrides(e),n=["b","r","c"],i="index";return`
    ivec3 inputCoordsFromReshapedOutCoords(int index) {
      ${t.map((e,r)=>`int ${n[r]} = ${i} / ${e}; ${r===t.length-1?`int ${n[r+1]} = ${i} - ${n[r]} * ${e}`:`index -= ${n[r]} * ${e}`};`).join("")}
      return ivec3(b, r, c);
    }
  `}(l)}
      ${function(e){let t=r.ShapeUtil.computeStrides(e);return`
  int getFlattenedIndex(ivec3 coords) {
    // reverse y, z order
    return coords.x * ${t[0]} + coords.z * ${t[1]} + coords.y;
  }
`}(u)}
      ${(0,a.unpackFromChannel)()}

      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0.0);

        ivec3 outputCoords;
        int rows = ${u[2]};
        int cols = ${u[1]};

        ${c}
        ${h.output} = result;
      }
    `;return Object.assign(Object.assign({},n),{output:{dims:u,type:t.type,textureType:s.TextureType.packed},shaderSource:d,hasMain:!0})})(e,t,l,n)})},t.processDims3D=function(e){if(0===e.length)return[1,1,1];let t=1;for(let n=0;n<e.length-2;++n)t*=e[n];return[t,e.length>1?e[e.length-2]:1,e[e.length-1]]},t.isReshapeCheap=function(e,t){return 0===e.length||0===t.length||(e.length<2||t.length<2?e[e.length-1]===t[t.length-1]:e[e.length-1]===t[t.length-1]&&e[e.length-2]===t[t.length-2])}},718:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.reshape=void 0;let r=n(2517);t.reshape=(e,t)=>{let n=r.ShapeUtil.calculateReshapedDims(t[0].dims,t[1].integerData);return e.session.pack?[e.reshapePacked(t[0],n)]:[e.reshapeUnpacked(t[0],n)]}},2268:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseResizeAttributesV11=t.parseResizeAttributesV10=t.resize=void 0;let r=n(5060),i=n(2039),s=n(9390),a=n(2827),o=n(9793),l={name:"Resize",inputNames:["A"],inputTypes:[i.TextureType.packed]};t.resize=(e,t,n)=>((0,o.validateInputs)(t,n),[e.run(Object.assign(Object.assign({},l),{cacheHint:n.cacheKey,get:()=>u(e,t,n)}),t)]),t.parseResizeAttributesV10=e=>(0,o.parseUpsampleAttributes)(e,10),t.parseResizeAttributesV11=e=>(0,o.parseUpsampleAttributes)(e,11);let u=(e,t,n)=>{let o=(0,r.getGlsl)(e.session.backend.glContext.version),[u,h]=c(t,n);if(u.every(e=>1===e)&&"tf_crop_and_resize"!==n.coordinateTransformMode)return Object.assign(Object.assign({},l),{output:{dims:h,type:t[0].type,textureType:i.TextureType.packed},hasMain:!0,shaderSource:`void main() {
                    vec4 v = ${o.texture2D}(X, TexCoords);
                    ${o.output} = v;
                }`});let d=h.length;if(d<2)throw Error(`output dimension should be at least 2, but got ${d}`);let p=h[d-2],f=h[d-1],g=t[0].dims;if(d!==g.length)throw Error(`output dimension should match input ${g.length}, but got ${d}`);let m=g[d-2],y=g[d-1],b=u[d-2],v=u[d-1],w="";if("linear"!==n.mode)throw Error(`resize (packed) does not support mode: '${n.mode}'`);switch(n.coordinateTransformMode){case"asymmetric":w="\n                    vec4 getSourceFracIndex(ivec4 coords) {\n                        return vec4(coords) / scaleWHWH;\n                    }\n                ";break;case"half_pixel":w="\n                    vec4 getSourceFracIndex(ivec4 coords) {\n                        return (vec4(coords) + 0.5) / scaleWHWH - 0.5;\n                    }\n                ";break;case"pytorch_half_pixel":w=`
                    vec4 getSourceFracIndex(ivec4 coords) {
                        vec4 fcoords = vec4(coords);
                        return vec4(
                            ${f}.0 > 1.0 ? (fcoords.x + 0.5) / scaleWHWH.x - 0.5 : 0.0,
                            ${p}.0 > 1.0 ? (fcoords.y + 0.5) / scaleWHWH.y - 0.5 : 0.0,
                            ${f}.0 > 1.0 ? (fcoords.z + 0.5) / scaleWHWH.z - 0.5 : 0.0,
                            ${p}.0 > 1.0 ? (fcoords.w + 0.5) / scaleWHWH.w - 0.5 : 0.0
                          );
                    }
                `;break;case"align_corners":w=`
                    vec4 getSourceFracIndex(ivec4 coords) {
                        vec4 resized = vec4(${f}.0 - 1.0, ${p}.0 - 1.0, ${f}.0 - 1.0,
                            ${p}.0 - 1.0);
                        vec4 original = vec4(${y}.0 - 1.0, ${m}.0 - 1.0, ${y}.0 - 1.0,
                            ${m}.0 - 1.0);
                        vec4 new_scale = original / resized;
                        return vec4(coords) * new_scale;
                    }
                `;break;default:throw Error(`resize (packed) does not support coordinateTransformMode:                                 '${n.coordinateTransformMode}'`)}let _=(0,s.getCoordsDataType)(d),x=`
            const vec2 inputWH = vec2(${m}.0, ${y}.0);
            const vec4 scaleWHWH = vec4(float(${b}), float(${v}), float(${b}), float(${v}));
            ${(0,a.unpackFromChannel)()}
            ${w}
            float getAValue(int x10, int r, int c, int d) {
                return getChannel(getA(x10, r, c, d), vec2(c, d));
            }
            void main() {
                ${_} rc = getOutputCoords();

                int batch = rc[0];
                int depth = rc[1];

                // retrieve the 4 coordinates that is used in the 4 packed output values.
                ivec4 coords = ivec4(rc.wz, rc.w + 1, rc.z + 1);

                // calculate the source index in fraction
                vec4 sourceFrac = getSourceFracIndex(coords);

                // get the lower and upper bound of the 4 values that will be packed into one texel.
                ivec4 x00 = ivec4(max(sourceFrac.xy, vec2(0.0)), min(inputWH - 1.0, ceil(sourceFrac.xy)));
                ivec4 x01 = ivec4(max(sourceFrac.xw, vec2(0.0)), min(inputWH - 1.0, ceil(sourceFrac.xw)));
                ivec4 x10 = ivec4(max(sourceFrac.zy, vec2(0.0)), min(inputWH - 1.0, ceil(sourceFrac.zy)));
                ivec4 x11 = ivec4(max(sourceFrac.zw, vec2(0.0)), min(inputWH - 1.0, ceil(sourceFrac.zw)));

                bool hasNextRow = rc.w < ${p-1};
                bool hasNextCol = rc.z < ${f-1};

                // pack x00, x01, x10, x11's top-left corner into one vec4 structure
                vec4 topLeft = vec4(
                    getAValue(batch, depth, x00.x, x00.y),
                    hasNextCol ? getAValue(batch, depth, x01.x, x01.y) : 0.0,
                    hasNextRow ? getAValue(batch, depth, x10.x, x10.y) : 0.0,
                    (hasNextRow && hasNextCol) ? getAValue(batch, depth, x11.x, x11.y) : 0.0);

                // pack x00, x01, x10, x11's top-right corner into one vec4 structure
                vec4 topRight = vec4(
                    getAValue(batch, depth, x00.x, x00.w),
                    hasNextCol ? getAValue(batch, depth, x01.x, x01.w) : 0.0,
                    hasNextRow ? getAValue(batch, depth, x10.x, x10.w) : 0.0,
                    (hasNextRow && hasNextCol) ? getAValue(batch, depth, x11.x, x11.w) : 0.0);

                // pack x00, x01, x10, x11's bottom-left corner into one vec4 structure
                vec4 bottomLeft = vec4(
                    getAValue(batch, depth, x00.z, x00.y),
                    hasNextCol ? getAValue(batch, depth, x01.z, x01.y) : 0.0,
                    hasNextRow ? getAValue(batch, depth, x10.z, x10.y) : 0.0,
                    (hasNextRow && hasNextCol) ? getAValue(batch, depth, x11.z, x11.y) : 0.0);

                // pack x00, x01, x10, x11's bottom-right corner into one vec4 structure
                vec4 bottomRight = vec4(
                    getAValue(batch, depth, x00.z, x00.w),
                    hasNextCol ? getAValue(batch, depth, x01.z, x01.w) : 0.0,
                    hasNextRow ? getAValue(batch, depth, x10.z, x10.w) : 0.0,
                    (hasNextRow && hasNextCol) ? getAValue(batch, depth, x11.z, x11.w) : 0.0);

                // calculate the interpolation fraction on u and v direction
                vec4 frac = vec4(sourceFrac) - floor(sourceFrac);
                vec4 clampFrac = clamp(frac, vec4(0.0), vec4(1.0));

                vec4 top = mix(topLeft, topRight, clampFrac.ywyw);
                vec4 bottom = mix(bottomLeft, bottomRight, clampFrac.ywyw);
                vec4 newValue = mix(top, bottom, clampFrac.xxzz);

                ${o.output} = vec4(newValue);
            }
        `;return Object.assign(Object.assign({},l),{output:{dims:h,type:t[0].type,textureType:i.TextureType.packed},hasMain:!0,shaderSource:x})},c=(e,t)=>{let n=e[0].dims,r,i=t.scales;if(0===i.length){let s=e[t.scalesInputIdx];if(s&&0!==s.size){if(e[t.sizesInputIdx])throw Error("Only one of scales or sizes must be provided as input.");i=h(s,t.mode,t.isResize)}else{let s=e[t.sizesInputIdx];if(!s||0===s.size)throw Error("Either scales or sizes MUST be provided as input.");i=d(r=Array.from(s.integerData),n,t.mode,t.isResize)}}else if(e[t.sizesInputIdx])throw Error("Only one of scales or sizes must be provided as input.");let s=r||n.map((e,t)=>Math.floor(e*i[t]));return[i,s]},h=(e,t,n)=>{let r=Array.from(e.floatData);return(0,o.scalesValidation)(r,t,n),r},d=(e,t,n,r)=>{let i=t.length,s=Array(i);for(let n=0,r=i;n<r;n++)if(0===t[n]){if(0!==e[n])throw Error("Input dim is zero but required output dim is non-zero.");s[n]=1}else s[n]=e[n]/t[n];return(0,o.scalesValidation)(s,n,r),s}},8117:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.shape=void 0;let r=n(9162);t.shape=(e,t)=>(i(t),[new r.Tensor([t[0].dims.length],"int32",void 0,void 0,new Int32Array(t[0].dims))]);let i=e=>{if(!e||1!==e.length)throw Error("Shape requires 1 input.")}},2278:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.sliceV10=t.parseSliceAttributes=t.slice=void 0;let r=n(246),i=n(782),s=n(2517),a=n(2039),o={name:"Slice",inputNames:["A"],inputTypes:[a.TextureType.unpacked]};t.slice=(e,t,n)=>(u(t),[e.run(Object.assign(Object.assign({},o),{cacheHint:n.cacheKey,get:()=>l(e,t[0],n)}),t)]),t.parseSliceAttributes=e=>{let t=e.attributes.getInts("starts"),n=e.attributes.getInts("ends"),i=e.attributes.getInts("axes",[]);return(0,r.createAttributeWithCacheKey)({starts:t,ends:n,axes:i})};let l=(e,t,n)=>{let r=0===n.axes.length?t.dims.slice(0).map((e,t)=>t):n.axes,i=s.ShapeUtil.normalizeAxes(r,t.dims.length),l=n.starts.map((e,n)=>e>t.dims[i[n]]-1?t.dims[i[n]]:s.ShapeUtil.normalizeAxis(e,t.dims[i[n]])),u=n.ends.map((e,n)=>e>t.dims[i[n]]-1?t.dims[i[n]]:s.ShapeUtil.normalizeAxis(e,t.dims[i[n]])),c=t.dims.slice(),h=[];for(let e=0;e<i.length;e++)c[i[e]]=u[e]-l[e],l[e]>0&&h.push(`outputIdx[${i[e]}] += ${l[e]};`);let d=`
      float process(int outputIdx[${c.length}]) {
        ${h.join("\n      ")}
        return _A(outputIdx);
      }`;return Object.assign(Object.assign({},o),{output:{dims:c,type:t.type,textureType:a.TextureType.unpacked},shaderSource:d})},u=e=>{if(!e||1!==e.length)throw Error("Slice requires 1 input.");if(-1===i.NUMBER_TYPES.indexOf(e[0].type))throw Error("Invalid input type.")};t.sliceV10=(e,t)=>{h(t);let n=c(e,t);return[e.run(Object.assign(Object.assign({},o),{cacheHint:n.cacheKey,get:()=>l(e,t[0],n)}),[t[0]])]};let c=(e,t)=>{if(!e.session.isInitializer(t[1].dataId)||!e.session.isInitializer(t[2].dataId)||t.length>=4&&!e.session.isInitializer(t[3].dataId)||t.length>=5&&!e.session.isInitializer(t[4].dataId))throw Error("dynamic slice attributes are not allowed");if(t.length>=5&&t[4].integerData.some(e=>1!==e))throw Error("currently non-1 steps is not supported for Slice");let n=Array.from(t[1].integerData),r=Array.from(t[2].integerData),i=t.length>=4?Array.from(t[3].integerData):[];return{starts:n,ends:r,axes:i,cacheKey:`${i};${n};${r}`}},h=e=>{if(!e||e.length<3||e.length>5)throw Error("Invalid input number.");if("int32"!==e[1].type||1!==e[1].dims.length||"int32"!==e[2].type||1!==e[2].dims.length||e.length>=4&&("int32"!==e[3].type||1!==e[3].dims.length)||e.length>=5&&("int32"!==e[4].type||1!==e[4].dims.length))throw Error("Invalid input type.")}},5524:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.softmaxV13=t.parseSoftmaxAttributesV13=t.parseSoftmaxAttributes=t.softmax=void 0;let r=n(246),i=n(2517),s=n(5060),a=n(2039),o=n(3738),l={name:"SoftmaxComputeMax",inputNames:["A"],inputTypes:[a.TextureType.unpacked]},u={name:"SoftmaxComputeScale",inputNames:["A","Max"],inputTypes:[a.TextureType.unpacked,a.TextureType.unpacked]},c={name:"SoftMax",inputNames:["A","Max","Norm"],inputTypes:[a.TextureType.unpacked,a.TextureType.unpacked,a.TextureType.unpacked]};t.softmax=(e,t,n)=>{g(t);let r=t[0].dims.slice(),s=i.ShapeUtil.normalizeAxis(n.axis,r.length);return h(e,t,n,i.ShapeUtil.sizeToDimension(r,s),i.ShapeUtil.sizeFromDimension(r,s))},t.parseSoftmaxAttributes=e=>(0,r.createAttributeWithCacheKey)({axis:e.attributes.getInt("axis",1)}),t.parseSoftmaxAttributesV13=e=>(0,r.createAttributeWithCacheKey)({axis:e.attributes.getInt("axis",-1)}),t.softmaxV13=(e,t,n)=>{g(t);let s=t[0].dims.slice(),a=i.ShapeUtil.normalizeAxis(n.axis,s.length),l=s.length,u=a!==l-1,c=[],d,p=[],f=[];u&&((p=Array.from({length:l}).map((e,t)=>t))[a]=l-1,p[l-1]=a,p.map(e=>c.push(s[e])),d=(0,r.createAttributeWithCacheKey)({perm:p}),f=(0,o.transpose)(e,t,d));let m=u?i.ShapeUtil.sizeToDimension(c,l-1):i.ShapeUtil.sizeToDimension(s,l-1),y=u?i.ShapeUtil.sizeFromDimension(c,l-1):i.ShapeUtil.sizeFromDimension(s,l-1),b=h(e,u?f:t,n,m,y);return u?(0,o.transpose)(e,b,d):b};let h=(e,t,n,r,i)=>{let s=d(e,t[0],r,i,[r]),a=e.run(Object.assign(Object.assign({},l),{cacheHint:n.cacheKey,get:()=>s}),t),o=p(e,t[0],r,i,s.output.dims,[r]),h=e.run(Object.assign(Object.assign({},u),{cacheHint:n.cacheKey,get:()=>o}),[t[0],a]),g=f(e,t[0],r,i,s.output.dims,o.output.dims);return[e.run(Object.assign(Object.assign({},c),{cacheHint:n.cacheKey,get:()=>g}),[t[0],a,h])]},d=(e,t,n,r,i)=>{let[o,u]=e.calculateTextureWidthAndHeight(t.dims,a.TextureType.unpacked),c=i.length;if(n<1||r<1)throw Error("Logical row count N and feature count D must be greater than or equal to 1");if(1!==i.length)throw Error("Dimensionality of the output should be 1");if(i[0]!==n)throw Error("Shape of the output should be equal to logical row count");let h=(0,s.getGlsl)(e.session.backend.glContext.version),d=`
      float process(int[${c}] indices) {
        int logical_row_start_offset = indices[0] * ${r};

        float max = getColorAsFloat(${h.texture2D}(A, offsetToCoords(logical_row_start_offset, ${o},
        ${u} )));
        for(int i=1; i<${r}; ++i)
        {
          float current = getColorAsFloat(${h.texture2D}(A, offsetToCoords(logical_row_start_offset + i,
            ${o}, ${u})));
          if(current > max)
          max = current;
        }

        return max;
      }`;return Object.assign(Object.assign({},l),{output:{dims:i,type:t.type,textureType:a.TextureType.unpacked},shaderSource:d})},p=(e,t,n,r,i,o)=>{let[l,c]=e.calculateTextureWidthAndHeight(t.dims,a.TextureType.unpacked),h=o.length;if(n<1||r<1)throw Error("Logical row count N and feature count D must be greater than or equal to 1");if(1!==o.length)throw Error("Dimensionality of the output should be 1");if(o[0]!==n)throw Error("Shape of the output should be equal to logical row count");if(1!==i.length)throw Error("Dimensionality of the intermediate results should be 1");if(i[0]!==n)throw Error("Shape of the intermediate results should be equal to logical row count");let d=`
      float process(int[${h}] indices) {
        int logical_row_start_offset = indices[0] * ${r};

        float norm_factor = 0.0;
        float max = _Max(indices);
        for(int i=0; i<${r}; ++i)
        {
          norm_factor += exp(getColorAsFloat(${(0,s.getGlsl)(e.session.backend.glContext.version).texture2D}(A, offsetToCoords(logical_row_start_offset + i,
            ${l}, ${c}))) - max);
        }

        return norm_factor;
      }`;return Object.assign(Object.assign({},u),{output:{dims:o,type:t.type,textureType:a.TextureType.unpacked},shaderSource:d})},f=(e,t,n,r,i,s)=>{let[o,l]=e.calculateTextureWidthAndHeight(t.dims,a.TextureType.unpacked),u=t.dims.length;if(n<1||r<1)throw Error("Logical row count N and feature count D must be greater than or equal to 1");if(1!==i.length||1!==s.length)throw Error("Dimensionality of the intermediate results should be 1");if(i[0]!==n||s[0]!==n)throw Error("Shape of the intermediate results should be equal to logical row count");let h=`
      float process(int[${u}] indices) {

      // get offset of current logical tensor index from the 2-D texture coordinates (TexCoords)
      int offset = coordsToOffset(TexCoords, ${o}, ${l});

      //determine the logical row for this index
      int logical_row_index[1];
      logical_row_index[0] = offset / ${r};

      float norm_factor = _Norm(logical_row_index);

      // avoid possible division by 0
      // if norm_facor is 0, all elements are zero
      // if so, return 0
      if(norm_factor == 0.0)
        return 0.0;

      return exp(_A(indices) - _Max(logical_row_index)) / norm_factor;
    }`;return Object.assign(Object.assign({},c),{output:{dims:t.dims,type:t.type,textureType:a.TextureType.unpacked},shaderSource:h})},g=e=>{if(!e||1!==e.length)throw Error("Softmax requires 1 input.");if("float32"!==e[0].type&&"float64"!==e[0].type)throw Error("Invalid input type")}},5975:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseSplitAttributes=t.split=void 0;let r=n(246),i=n(2517),s=n(2039),a={name:"Split",inputNames:["A"],inputTypes:[s.TextureType.unpacked]};t.split=(e,t,n)=>{u(t);let r=i.ShapeUtil.normalizeAxis(n.axis,t[0].dims.length),s=o(e,t,r,n),c=[];for(let i=0;i<s;++i)c.push(e.run(Object.assign(Object.assign({},a),{cacheHint:`${n.cacheKey};${i}`,get:()=>l(e,t[0],n,r,i)}),t));return c},t.parseSplitAttributes=e=>{let t=e.attributes.getInt("axis",0),n=e.attributes.getInts("split",[]),i=e.outputs.length;return(0,r.createAttributeWithCacheKey)({axis:t,split:n,numOutputs:i})};let o=(e,t,n,r)=>{let[,s]=i.SplitUtil.splitShape(t[0].dims,n,r.split,r.numOutputs);return s.length},l=(e,t,n,r,o)=>{let[l,u]=i.SplitUtil.splitShape(t.dims,r,n.split,n.numOutputs),c=u[o],h=l[o],d=`
      float process(int indices[${h.length}]) {
        indices[${r}] += ${c};
        return _A(indices);
      }
    `;return Object.assign(Object.assign({},a),{cacheHint:`${n.cacheKey}:${o}`,output:{dims:h,type:t.type,textureType:s.TextureType.unpacked},shaderSource:d})},u=e=>{if(!e||1!==e.length)throw Error("Split requires one input.");if("int8"!==e[0].type&&"uint8"!==e[0].type&&"int16"!==e[0].type&&"uint16"!==e[0].type&&"int32"!==e[0].type&&"uint32"!==e[0].type&&"float32"!==e[0].type&&"float64"!==e[0].type&&"bool"!==e[0].type)throw Error("Invalid input type.")}},3933:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseSqueezeAttributes=t.squeezeV13=t.squeeze=void 0;let r=n(2517);t.squeeze=(e,t,n)=>{i(t);let s=r.ShapeUtil.squeezeShape(t[0].dims,n);return[e.reshapeUnpacked(t[0],s)]},t.squeezeV13=(e,n)=>(s(n),(0,t.squeeze)(e,[n[0]],Array.from(n[1].integerData))),t.parseSqueezeAttributes=e=>e.attributes.getInts("axes");let i=e=>{if(!e||1!==e.length)throw Error("Squeeze requires 1 input.");if("string"===e[0].type)throw Error("invalid input tensor types.")},s=e=>{if(!e||2!==e.length)throw Error("Squeeze requires 2 inputs.");if("int32"!==e[1].type)throw Error("Invalid input type.")}},6558:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.sum=void 0;let r=n(5060),i=n(2039);t.sum=(e,t)=>{a(t);let n={name:"Sum",inputNames:t.map((e,t)=>`X${t}`),inputTypes:Array(t.length).fill(i.TextureType.unpacked)};return[e.run(Object.assign(Object.assign({},n),{get:()=>s(e,t,n)}),t)]};let s=(e,t,n)=>{let s=(0,r.getGlsl)(e.session.backend.glContext.version),a=t[0].dims.slice(),o=`
      void main() {
        vec4 result = ${t.map((e,t)=>`${s.texture2D}(X${t},TexCoords)`).join(" + ")};
        ${s.output} = result;
      }
    `;return Object.assign(Object.assign({},n),{output:{dims:a,type:t[0].type,textureType:i.TextureType.unpacked},hasMain:!0,shaderSource:o})},a=e=>{if(!e||0===e.length)throw Error("Sum requires inputs.");let t=e[0].dims.length;for(let n=1;n<e.length;n++){if(t!==e[n].dims.length)throw Error("Input shapes are mismatched.");for(let r=0;r<t;r++)if(e[0].dims[r]!==e[n].dims[r])throw Error("Input shapes are not matched.")}if("float32"!==e[0].type&&"float64"!==e[0].type)throw Error("Invalid input type.");for(let t=1;t<e.length;t++)if(e[0].type!==e[t].type)throw Error("Input types are not matched.")}},5723:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.tile=void 0;let r=n(782),i=n(2039);t.tile=(e,t)=>{a(t);let n={name:"Tile",inputNames:["A"],inputTypes:[i.TextureType.unpacked]};return[e.run(Object.assign(Object.assign({},n),{get:()=>s(e,t,n)}),t)]};let s=(e,t,n)=>{let r=t[0].dims.slice(),s=Array(r.length),a=[];for(let e=0;e<r.length;e++)s[e]=r[e]*t[1].numberData[e],a.push(`inputIdx[${e}] = int(mod(float(outputIdx[${e}]), ${r[e]}.));`);let o=s.length,l=`
      float process(int outputIdx[${o}]) {
        int inputIdx[${o}];
        ${a.join("\n")}
        return _A(inputIdx);
      }
    `;return Object.assign(Object.assign({},n),{output:{dims:s,type:t[0].type,textureType:i.TextureType.unpacked},shaderSource:l})},a=e=>{if(!e||2!==e.length)throw Error("Tile requires 2 input.");if(1!==e[1].dims.length)throw Error("The second input shape must 1 dimension.");if(e[1].dims[0]!==e[0].dims.length)throw Error("Invalid input shape.");if(-1===r.NUMBER_TYPES.indexOf(e[0].type))throw Error("Invalid input type.");if("int32"!==e[1].type&&"int16"!==e[1].type)throw Error("Invalid repeat type.")}},3738:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseTransposeAttributes=t.transpose=void 0;let r=n(246),i=n(2517),s=n(2039),a={name:"Transpose",inputNames:["A"],inputTypes:[s.TextureType.unpacked]};t.transpose=(e,t,n)=>(h(t),[e.run(Object.assign(Object.assign({},a),{cacheHint:n.cacheKey,get:()=>o(e,t[0],n.perm)}),t)]),t.parseTransposeAttributes=e=>(0,r.createAttributeWithCacheKey)({perm:e.attributes.getInts("perm",[])});let o=(e,t,n)=>{let r=t.dims;n=l(r,n);let i=u(r,n),o=r.length,h=`
      ${c("perm",n,o)}
      float process(int indices[${o}]) {
        int a[${o}];
        perm(a, indices);
        return _A(a);
      }`;return Object.assign(Object.assign({},a),{output:{dims:i,type:t.type,textureType:s.TextureType.unpacked},shaderSource:h})},l=(e,t)=>(t&&t.length!==e.length&&(t=[...e.keys()].reverse()),t),u=(e,t)=>(t=l(e,t),i.ShapeUtil.sortBasedOnPerm(e,t)),c=(e,t,n)=>{let r=[];r.push(`void ${e}(out int a[${n}], int src[${n}]) {`);for(let e=0;e<n;++e)r.push(`	a[${t[e]}]=src[${e}];`);return r.push("	}"),r.join("\n")},h=e=>{if(!e||1!==e.length)throw Error("Transpose requires 1 input.");if("float32"!==e[0].type&&"float64"!==e[0].type)throw Error("input should be float tensor")}},8710:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.encodeAsUint8=void 0;let r=n(5060),i=n(2039);t.encodeAsUint8=(e,t)=>{let n=t.shape,s=(0,r.getGlsl)(e.session.backend.glContext.version),a=`
    const float FLOAT_MAX = 1.70141184e38;
    const float FLOAT_MIN = 1.17549435e-38;

    bool isNaN(float val) {
      return (val < 1.0 || 0.0 < val || val == 0.0) ? false : true;
    }

    highp vec4 encodeAsUint8(highp float v) {
      if (isNaN(v)) {
        return vec4(255, 255, 255, 255);
      }

      highp float av = abs(v);

      if(av < FLOAT_MIN) {
        return vec4(0.0, 0.0, 0.0, 0.0);
      } else if(v > FLOAT_MAX) {
        return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;
      } else if(v < -FLOAT_MAX) {
        return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;
      }

      highp vec4 c = vec4(0,0,0,0);

      highp float e = floor(log2(av));
      highp float m = exp2(fract(log2(av))) - 1.0;

      c[2] = floor(128.0 * m);
      m -= c[2] / 128.0;
      c[1] = floor(32768.0 * m);
      m -= c[1] / 32768.0;
      c[0] = floor(8388608.0 * m);

      highp float ebias = e + 127.0;
      c[3] = floor(ebias / 2.0);
      ebias -= c[3] * 2.0;
      c[2] += floor(ebias) * 128.0;

      c[3] += 128.0 * step(0.0, -v);

      return c / 255.0;
    }

    void main() {
      float value = ${s.texture2D}(X,TexCoords).r;
      ${s.output} = encodeAsUint8(value);
    }`,o={name:"Uint8Encode",inputTypes:[i.TextureType.unpacked],inputNames:["X"],output:{dims:n,type:t.tensor.type,textureType:i.TextureType.downloadUint8AsFloat},shaderSource:a,hasMain:!0};return e.executeProgram(o,[t.tensor])}},4909:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.tanh=t.tan=t.sqrt=t.sin=t.sigmoid=t.relu=t.not=t.neg=t.log=t.parseLeakyReluAttributes=t.leakyRelu=t.identity=t.floor=t.exp=t.parseEluAttributes=t.elu=t.cos=t.ceil=t.clipV11=t.parseClipAttributes=t.clip=t.atan=t.asin=t.acos=t.abs=t.glslTanh=t.glslTan=t.glslSqrt=t.glslSigmoid=t.glslRelu=t.glslSin=t.glslNot=t.glslNeg=t.glslLog=t.glslLeakyRelu=t.glslIdentity=t.glslClip=t.glslFloor=t.glslExp=t.glslElu=t.glslCos=t.glslCeil=t.glslAtan=t.glslAsin=t.glslAcos=t.glslAbs=void 0;let r=n(246),i=n(2517),s=n(8520),a=n(5060),o=n(2039);function l(){return A("abs")}function u(){return A("acos")}function c(){return A("asin")}function h(){return A("atan")}function d(){return A("ceil")}function p(){return A("cos")}function f(e){let t="elu";return{body:`
  const float alpha = float(${e});

  float ${t}_(float a) {
    return a >= 0.0 ? a: (exp(a) - 1.0) * alpha;
  }
  vec4 ${t}_(vec4 v) {
    return vec4(${t}_(v.x), ${t}_(v.y), ${t}_(v.z), ${t}_(v.w));
  }
  `,name:t,type:s.FunctionType.ValueBased}}function g(){return A("exp")}function m(){return A("floor")}function y(e,t){let n="clip";return{body:`
  const float min = float(${e});
  const float max = float(${t});

  float ${n}_(float a) {
    return clamp(a, min, max);
  }
  vec4 ${n}_(vec4 v) {
    return clamp(v, min, max);
  }
  `,name:n,type:s.FunctionType.ValueBased}}function b(){let e="indentity";return{body:`
  float ${e}_(float a) {
    return a;
  }
  vec4 ${e}_(vec4 v) {
    return v;
  }
  `,name:e,type:s.FunctionType.ValueBased}}function v(e){let t="leakyRelu";return{body:`
  const float alpha = float(${e});

  float ${t}_(float a) {
    return a < 0.0 ? a * alpha : a;
  }
  vec4 ${t}_(vec4 v) {
    return vec4(${t}_(v.x), ${t}_(v.y), ${t}_(v.z), ${t}_(v.w));
  }
  `,name:t,type:s.FunctionType.ValueBased}}function w(){return A("log")}function _(){let e="neg";return{body:`
  float ${e}_(float a) {
    return -a;
  }
  vec4 ${e}_(vec4 v) {
    return -v;
  }
  `,name:e,type:s.FunctionType.ValueBased}}function x(){let e="not";return{body:`
  float ${e}_(float a) {
    return float( ! bool(a) );
  }
  bool ${e}_(bool a) {
    return !a;
  }
  vec4 ${e}_(vec4 v) {
    return vec4(!bool(v.x), !bool(v.y), !bool(v.z), !bool(v.w));
  }
  bvec4 ${e}_(bvec4 v) {
    return bvec4(!v.x, !v.y, !v.z, !v.w);
  }
  `,name:e,type:s.FunctionType.ValueBased}}function T(){return A("sin")}function I(){let e="relu";return{body:`
  float ${e}_(float a) {
    return max( a, 0.0 );
  }
  vec4 ${e}_(vec4 v) {
    return max( v, 0.0 );
  }
  `,name:e,type:s.FunctionType.ValueBased}}function k(){let e="sigmoid";return{body:`
  float ${e}_(float a) {
    return 1.0 / (1.0 + exp(-a));
  }
  vec4 ${e}_(vec4 v) {
    return 1.0 / (1.0 + exp(-v));
  }
  `,name:e,type:s.FunctionType.ValueBased}}function S(){return A("sqrt")}function E(){return A("tan")}function C(){let e="tanh";return{body:`
  float ${e}_(float a) {
    a = clamp(a, -10., 10.);
    a = exp(2.*a);
    return (a - 1.) / (a + 1.);
  }
  vec4 ${e}_(vec4 v) {
    v = clamp(v, -10., 10.);
    v = exp(2.*v);
    return (v - 1.) / (v + 1.);
  }
  `,name:e,type:s.FunctionType.ValueBased}}function A(e){return{body:`
  float ${e}_(float a) {
    return ${e}(a);
  }
  vec4 ${e}_(vec4 v) {
    return ${e}(v);
  }
  `,name:e,type:s.FunctionType.ValueBased}}t.glslAbs=l,t.glslAcos=u,t.glslAsin=c,t.glslAtan=h,t.glslCeil=d,t.glslCos=p,t.glslElu=f,t.glslExp=g,t.glslFloor=m,t.glslClip=y,t.glslIdentity=b,t.glslLeakyRelu=v,t.glslLog=w,t.glslNeg=_,t.glslNot=x,t.glslSin=T,t.glslRelu=I,t.glslSigmoid=k,t.glslSqrt=S,t.glslTan=E,t.glslTanh=C;let N=(e,t,n,r)=>{let i=e.session.pack?o.TextureType.packed:o.TextureType.unpacked,s={name:n.name,inputTypes:[i],inputNames:["A"],cacheHint:r};return Object.assign(Object.assign({},s),{get:()=>((e,t,n,r)=>{let i=e.session.pack?o.TextureType.packed:o.TextureType.unpacked,s=(0,a.getGlsl)(e.session.backend.glContext.version);return Object.assign(Object.assign({},t),{output:{dims:n.dims,type:n.type,textureType:i},shaderSource:`
     ${r.body}
     void main() {
       vec4 v = ${s.texture2D}(A, TexCoords);
       v = ${r.name}_(v);
       ${s.output} = v;
     }
     `,hasMain:!0})})(e,s,t,n)})};t.abs=(e,t)=>[e.run(N(e,t[0],l()),t)],t.acos=(e,t)=>[e.run(N(e,t[0],u()),t)],t.asin=(e,t)=>[e.run(N(e,t[0],c()),t)],t.atan=(e,t)=>[e.run(N(e,t[0],h()),t)],t.clip=(e,t,n)=>[e.run(N(e,t[0],y(n.min,n.max),n.cacheKey),t)],t.parseClipAttributes=e=>(0,r.createAttributeWithCacheKey)({min:e.attributes.getFloat("min",i.MIN_CLIP),max:e.attributes.getFloat("max",i.MAX_CLIP)}),t.clipV11=(e,n)=>{let r=O(e,n);return(0,t.clip)(e,[n[0]],r)};let O=(e,t)=>{if(t.length>=3&&(!e.session.isInitializer(t[1].dataId)||!e.session.isInitializer(t[2].dataId)))throw Error("dynamic clip attributes are not allowed");let n=t.length>=3?t[1].numberData[0]:i.MIN_CLIP,s=t.length>=3?t[2].numberData[0]:i.MAX_CLIP;return(0,r.createAttributeWithCacheKey)({min:n,max:s})};t.ceil=(e,t)=>[e.run(N(e,t[0],d()),t)],t.cos=(e,t)=>[e.run(N(e,t[0],p()),t)],t.elu=(e,t,n)=>[e.run(N(e,t[0],f(n.alpha),n.cacheKey),t)],t.parseEluAttributes=e=>(0,r.createAttributeWithCacheKey)({alpha:e.attributes.getFloat("alpha",1)}),t.exp=(e,t)=>[e.run(N(e,t[0],g()),t)],t.floor=(e,t)=>[e.run(N(e,t[0],m()),t)],t.identity=(e,t)=>[e.run(N(e,t[0],b()),t)],t.leakyRelu=(e,t,n)=>[e.run(N(e,t[0],v(n.alpha),n.cacheKey),t)],t.parseLeakyReluAttributes=e=>(0,r.createAttributeWithCacheKey)({alpha:e.attributes.getFloat("alpha",.01)}),t.log=(e,t)=>[e.run(N(e,t[0],w()),t)],t.neg=(e,t)=>[e.run(N(e,t[0],_()),t)],t.not=(e,t)=>[e.run(N(e,t[0],x()),t)],t.relu=(e,t)=>[e.run(N(e,t[0],I()),t)],t.sigmoid=(e,t)=>[e.run(N(e,t[0],k()),t)],t.sin=(e,t)=>[e.run(N(e,t[0],T()),t)],t.sqrt=(e,t)=>[e.run(N(e,t[0],S()),t)],t.tan=(e,t)=>[e.run(N(e,t[0],E()),t)],t.tanh=(e,t)=>[e.run(N(e,t[0],C()),t)]},5611:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createUnpackProgramInfoLoader=t.createUnpackProgramInfo=void 0;let r=n(5060),i=n(2039),s=n(9390),a=n(2827),o={name:"unpack",inputNames:["A"],inputTypes:[i.TextureType.packed]};t.createUnpackProgramInfo=(e,t)=>{let n=t.dims.length,l=(0,a.getChannels)("rc",n),u=l.slice(-2),c=(0,s.getCoordsDataType)(n),h=(0,a.unpackFromChannel)(),d=0===t.dims.length?"":function(e,t){if(1===e)return"rc";let n="";for(let r=0;r<e;r++)n+=t[r],r<e-1&&(n+=",");return n}(n,l),p=n<=1?"rc":`vec2(${u.join(",")})`,f=`
    ${h}
    void main() {
      ${c} rc = getOutputCoords();

       // Sample the texture with the coords to get the rgba channel value.
       vec4 packedInput = getA(${d});

       ${(0,r.getGlsl)(e.session.backend.glContext.version).output} = vec4(getChannel(packedInput, ${p}), 0, 0, 0);
     }
   `;return Object.assign(Object.assign({},o),{hasMain:!0,output:{dims:t.dims,type:t.type,textureType:i.TextureType.unpacked},shaderSource:f})},t.createUnpackProgramInfoLoader=(e,n)=>Object.assign(Object.assign({},o),{get:()=>(0,t.createUnpackProgramInfo)(e,n)})},8428:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseUnsqueezeAttributes=t.unsqueezeV13=t.unsqueeze=void 0;let r=n(2517);t.unsqueeze=(e,t,n)=>{i(t);let s=r.ShapeUtil.unsqueezeShape(t[0].dims,n);return[e.reshapeUnpacked(t[0],s)]},t.unsqueezeV13=(e,n)=>(s(n),(0,t.unsqueeze)(e,[n[0]],Array.from(n[1].integerData))),t.parseUnsqueezeAttributes=e=>e.attributes.getInts("axes");let i=e=>{if(!e||1!==e.length)throw Error("Unsqueeze requires 1 input.");if("string"===e[0].type)throw Error("invalid input tensor types.")},s=e=>{if(!e||2!==e.length)throw Error("Unsqueeze requires 2 inputs.");if("int32"!==e[1].type)throw Error("Invalid input type.")}},9793:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.scalesValidation=t.validateInputs=t.parseUpsampleAttributes=t.parseUpsampleAttributesV9=t.parseUpsampleAttributesV7=t.upsample=void 0;let r=n(246),i=n(5060),s=n(2039),a={name:"Upsample",inputNames:["X"],inputTypes:[s.TextureType.unpacked]};t.upsample=(e,n,r)=>((0,t.validateInputs)(n,r),[e.run(Object.assign(Object.assign({},a),{cacheHint:r.cacheKey,get:()=>o(e,n,r)}),n)]),t.parseUpsampleAttributesV7=e=>(0,t.parseUpsampleAttributes)(e,7),t.parseUpsampleAttributesV9=e=>(0,t.parseUpsampleAttributes)(e,9),t.parseUpsampleAttributes=(e,n)=>{let i=n>=10,s=e.attributes.getString("mode","nearest");if("nearest"!==s&&"linear"!==s&&(n<11||"cubic"!==s))throw Error(`unrecognized mode: ${s}`);let a=[];n<9&&(a=e.attributes.getFloats("scales"),(0,t.scalesValidation)(a,s,i));let o=e.attributes.getFloat("extrapolation_value",0),l=n>10?e.attributes.getString("coordinate_transformation_mode","half_pixel"):"asymmetric";if(-1===["asymmetric","pytorch_half_pixel","tf_half_pixel_for_nn","align_corners","tf_crop_and_resize","half_pixel"].indexOf(l))throw Error(`coordinate_transform_mode '${l}' is not supported`);let u="tf_crop_and_resize"===l,c=u,h="nearest"===s&&n>=11?e.attributes.getString("nearest_mode","round_prefer_floor"):"";if(-1===["round_prefer_floor","round_prefer_ceil","floor","ceil",""].indexOf(h))throw Error(`nearest_mode '${h}' is not supported`);let d=e.attributes.getFloat("cubic_coeff_a",-.75),p=0!==e.attributes.getInt("exclude_outside",0);if(p&&"cubic"!==s)throw Error("exclude_outside can be set to 1 only when mode is CUBIC.");let f=n<11||"nearest"===s&&"asymmetric"===l&&"floor"===h,g=0,m=0,y=0;return n>10?e.inputs.length>2?(g=1,m=2,y=3):(m=1,y=2):9===n&&(m=1),(0,r.createAttributeWithCacheKey)({opset:n,isResize:i,mode:s,scales:a,extrapolationValue:o,coordinateTransformMode:l,useExtrapolation:c,needRoiInput:u,nearestMode:h,cubicCoefficientA:d,excludeOutside:p,useNearest2xOptimization:f,roiInputIdx:g,scalesInputIdx:m,sizesInputIdx:y})};let o=(e,t,n)=>{let r=(0,i.getGlsl)(e.session.backend.glContext.version),[o,l]=e.calculateTextureWidthAndHeight(t[0].dims,s.TextureType.unpacked),u=t[0].dims.map((e,t)=>Math.floor(e*n.scales[t])),[c,h]=e.calculateTextureWidthAndHeight(u,s.TextureType.unpacked),d=u.length,p=Array(d),f=Array(d),g=`
      int output_pitches[${d}];
      int input_pitches[${d}];
      `;for(let e=d-1;e>=0;e--)p[e]=e===d-1?1:p[e+1]*u[e+1],f[e]=e===d-1?1:f[e+1]*t[0].dims[e+1],g+=`
        output_pitches[${e}] = ${p[e]};
        input_pitches[${e}] = ${f[e]};
        `;let m=`
      float getInputFloat(int index) {
        vec2 coords = offsetToCoords(index, ${o}, ${l});
        float value = getColorAsFloat(${r.texture2D}(X, coords));
        return value;
      }
      `,y="nearest"===n.mode?`
    ${m}
    float process(int indices[${d}]) {
      int input_index = 0;
      int output_index = coordsToOffset(TexCoords, ${c}, ${h});

      ${g}

      int d, m;
      for (int dim = 0; dim < ${d}; ++dim) {
        d = output_index / output_pitches[dim];
        m = output_index - d * output_pitches[dim];
        output_index = m;

        if (scales[dim] != 1 && d > 0) {
          int d2 = d / scales[dim];
          m = d - d2 * scales[dim];
          d = d2;
        }
        input_index += input_pitches[dim] * d;
      }

      return getInputFloat(input_index);
    }`:4===d?`
    ${m}
    float process(int indices[4]) {
      int input_index = 0;
      int output_index = coordsToOffset(TexCoords, ${c}, ${h});

      ${g}

      int m;
      int index_of_dim0, index_of_dim1, index_of_dim2, index_of_dim3;
      index_of_dim0 = output_index / output_pitches[0];
      m = output_index - index_of_dim0 * output_pitches[0];
      index_of_dim1 = m / output_pitches[1];
      m = m - index_of_dim1 * output_pitches[1];
      index_of_dim2 = m / output_pitches[2];
      m = m - index_of_dim2 * output_pitches[2];
      index_of_dim3 = m;

      int index_of_input_dim2, index_of_input_dim3, x_offset, y_offset;
      index_of_input_dim2 = index_of_dim2 / scales[2];
      y_offset = index_of_dim2 - index_of_input_dim2 * scales[2];
      index_of_input_dim3 = index_of_dim3 / scales[3];
      x_offset = index_of_dim3 - index_of_input_dim3 * scales[3];

      input_index = index_of_dim0 * input_pitches[0] +
            index_of_dim1 * input_pitches[1] +
            index_of_input_dim2 * input_pitches[2] +
            index_of_input_dim3;

      float x00 = getInputFloat(input_index);
      float x10, x01, x11;

      bool end_of_dim2 = false;
      if (index_of_input_dim2 == (${t[0].dims[2]} - 1)) {
        // It's the end in dimension 2
        x01 = x00;
        end_of_dim2 = true;
      } else {
        x01 = getInputFloat(input_index + input_pitches[2]);
      }

      if (index_of_input_dim3 == (input_pitches[2] - 1)) {
        // It's the end in dimension 3
        x10 = x00;
        x11 = x01;
      }
      else {
        x10 = getInputFloat(input_index + 1);
        x11 = end_of_dim2 ? x10 : getInputFloat(input_index + input_pitches[2] + 1);
      }

      float y0 = x00 + float(y_offset) * (x01 - x00) / float(scales[2]);
      float y1 = x10 + float(y_offset) * (x11 - x10) / float(scales[2]);
      return y0 + float(x_offset) * (y1 - y0) / float(scales[3]);
    }`:`
    ${m}
    float process(int indices[2]) {
      int input_index = 0;
      int output_index = coordsToOffset(TexCoords, ${c}, ${h});

      ${g}

      int m;
      int index_of_dim0, index_of_dim1;
      index_of_dim0 = output_index / output_pitches[0];
      m = output_index - index_of_dim0 * output_pitches[0];
      index_of_dim1 = m;

      int index_of_input_dim0, index_of_input_dim1, x_offset, y_offset;
      index_of_input_dim0 = index_of_dim0 / scales[0];
      y_offset = index_of_dim0 - index_of_input_dim0 * scales[0];
      index_of_input_dim1 = index_of_dim1 / scales[1];
      x_offset = index_of_dim1 - index_of_input_dim1 * scales[1];

      input_index = index_of_input_dim0 * input_pitches[0] + index_of_input_dim1;

      float x00 = getInputFloat(input_index);
      float x10, x01, x11;

      bool end_of_dim0 = false;
      if (index_of_input_dim0 == (${t[0].dims[0]} - 1)) {
        // It's the end in dimension 0
        x01 = x00;
        end_of_dim0 = true;
      } else {
        x01 = getInputFloat(input_index + input_pitches[0]);
      }

      if (index_of_input_dim1 == (input_pitches[0] - 1)) {
        // It's the end in dimension 1
        x10 = x00;
        x11 = x01;
      }
      else {
        x10 = getInputFloat(input_index + 1);
        x11 = end_of_dim0 ? x10 : getInputFloat(input_index + input_pitches[0] + 1);
      }

      float y0 = x00 + float(y_offset) * (x01 - x00) / float(scales[0]);
      float y1 = x10 + float(y_offset) * (x11 - x10) / float(scales[0]);
      return y0 + float(x_offset) * (y1 - y0) / float(scales[1]);
    }`;return Object.assign(Object.assign({},a),{output:{dims:u,type:t[0].type,textureType:s.TextureType.unpacked},shaderSource:y,variables:[{name:"scales",type:"int",arrayLength:n.scales.length,data:n.scales.map(e=>Math.ceil(e))}]})};t.validateInputs=(e,t)=>{if(!e||t.opset<9&&1!==e.length||t.opset>=9&&t.opset<11&&2!==e.length||t.opset>=11&&e.length<2)throw Error("invalid inputs.");if(t.scales.length>0&&e[0].dims.length!==t.scales.length)throw Error("Invalid input shape.");if("string"===e[0].type)throw Error("Invalid input tensor types.")},t.scalesValidation=(e,t,n)=>{if(n){for(let t of e)if(t<=0)throw Error("Scale value should be greater than 0.")}else for(let t of e)if(t<1)throw Error("Scale value should be greater than or equal to 1.");if(!("linear"!==t&&"cubic"!==t||2===e.length||4===e.length&&1===e[0]&&1===e[1]))throw Error(`'Linear' mode and 'Cubic' mode only support 2-D inputs ('Bilinear', 'Bicubic')         or 4-D inputs with the corresponding outermost 2 scale values being 1         in the ${n?"Resize":"Upsample"} opeartor.`)}},1958:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ProgramManager=void 0;let r=n(1670),i=n(6231),s=n(8879),a=n(5060);t.ProgramManager=class{constructor(e,t,n){this.profiler=e,this.glContext=t,this.textureLayoutStrategy=n,this.repo=new Map,this.attributesBound=!1}getArtifact(e){return this.repo.get(e)}setArtifact(e,t){this.repo.set(e,t)}run(e,t,n){var r;this.profiler.event("op",`ProgramManager.run ${null!==(r=e.programInfo.name)&&void 0!==r?r:"unknown kernel"}`,()=>{var r;let s=this.glContext.gl,a=e.program;s.useProgram(a);try{this.bindOutput(n),this.attributesBound||this.bindAttributes(e.attribLocations),this.bindUniforms(e.uniformLocations,null!==(r=e.programInfo.variables)&&void 0!==r?r:[],t)}catch(t){throw i.Logger.error("ProgramManager",e.programInfo.shaderSource),t}this.profiler.event("backend","GlContext.draw()",()=>{this.glContext.draw()})},this.glContext)}dispose(){this.vertexShader&&this.glContext.deleteShader(this.vertexShader),this.repo.forEach(e=>this.glContext.deleteProgram(e.program))}build(e,t,n){return this.profiler.event("backend","ProgramManager.build",()=>{let r=new s.GlslPreprocessor(this.glContext,e,t,n),i=r.preprocess(),a=this.compile(i);return{programInfo:e,program:a,uniformLocations:this.getUniformLocations(a,r.context.programInfo.inputNames,r.context.programInfo.variables),attribLocations:this.getAttribLocations(a)}})}compile(e){if(!this.vertexShader){i.Logger.verbose("ProrgramManager","Compiling and caching Vertex shader for the first time");let e=(0,a.getVertexShaderSource)(this.glContext.version);this.vertexShader=this.glContext.compileShader(e,this.glContext.gl.VERTEX_SHADER)}r.env.debug&&i.Logger.verbose("ProrgramManager",`FragShader:
${e}
`);let t=this.glContext.compileShader(e,this.glContext.gl.FRAGMENT_SHADER),n=this.glContext.createProgram(this.vertexShader,t);return this.glContext.deleteShader(t),n}bindOutput(e){let t=e.width,n=e.height;i.Logger.verbose("ProrgramManager",`Binding output texture to Framebuffer: w/h=${t}/${n}, shape=${e.shape}, type=${e.tensor.type}`),this.glContext.attachFramebuffer(e.texture,t,n)}bindAttributes(e){let t=e.position,n=e.textureCoord;this.glContext.setVertexAttributes(t,n),this.attributesBound=!0}bindUniforms(e,t,n){var r;let i=this.glContext.gl,s=0;for(let{name:a,type:o,location:l,arrayLength:u}of e){let e=null===(r=t.find(e=>e.name===a))||void 0===r?void 0:r.data;if("sampler2D"!==o&&!e)throw Error(`variable '${a}' does not have data defined in program info`);switch(o){case"sampler2D":this.bindTexture(n[s],l,s),s++;break;case"float":u?i.uniform1fv(l,e):i.uniform1f(l,e);break;case"int":u?i.uniform1iv(l,e):i.uniform1i(l,e);break;default:throw Error(`Uniform not implemented: ${o}`)}}}bindTexture(e,t,n){this.glContext.bindTextureToUniform(e.texture,n,t)}getAttribLocations(e){return{position:this.getAttribLocation(e,"position"),textureCoord:this.getAttribLocation(e,"textureCoord")}}getUniformLocations(e,t,n){let r=[];if(t)for(let n of t)r.push({name:n,type:"sampler2D",location:this.getUniformLocation(e,n)});if(n)for(let t of n)r.push(Object.assign(Object.assign({},t),{location:this.getUniformLocation(e,t.name)}));return r}getUniformLocation(e,t){let n=this.glContext.gl.getUniformLocation(e,t);if(null===n)throw Error(`Uniform ${t} not found.`);return n}getAttribLocation(e,t){return this.glContext.gl.getAttribLocation(e,t)}}},6416:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WebGLSessionHandler=void 0;let r=n(6231),i=n(1047),s=n(8316),a=n(1640),o=n(1958),l=n(7859),u=n(5702);t.WebGLSessionHandler=class{constructor(e,t){this.backend=e,this.context=t,this.layoutStrategy=new l.PreferLogicalStrategy(e.glContext.maxTextureSize),this.programManager=new o.ProgramManager(this.context.profiler,e.glContext,this.layoutStrategy),this.textureManager=new u.TextureManager(e.glContext,this.layoutStrategy,this.context.profiler,{reuseTextures:"full"===e.textureCacheMode}),this.packedTextureDataCache=new Map,this.unpackedTextureDataCache=new Map,this.pack=e.pack,this.pack2unpackMap=new Map,this.unpack2packMap=new Map}createInferenceHandler(){return new s.WebGLInferenceHandler(this)}onGraphInitialized(e){let t=e.getValues().filter(e=>-1===e.from&&e.tensor).map(e=>e.tensor.dataId);this.initializers=new Set(t)}isInitializer(e){return!!this.initializers&&this.initializers.has(e)}addInitializer(e){this.initializers.add(e)}getTextureData(e,t){return t?this.packedTextureDataCache.get(e):this.unpackedTextureDataCache.get(e)}setTextureData(e,t,n=!1){r.Logger.verbose("WebGLSessionHandler","Storing Texture data in cache"),n?this.packedTextureDataCache.set(e,t):this.unpackedTextureDataCache.set(e,t)}dispose(){this.programManager.dispose(),this.textureManager.clearActiveTextures(),this.packedTextureDataCache.forEach(e=>this.textureManager.releaseTexture(e,!0)),this.packedTextureDataCache=new Map,this.unpackedTextureDataCache.forEach(e=>this.textureManager.releaseTexture(e,!0)),this.unpackedTextureDataCache=new Map}resolve(e,t,n){let r=(0,i.resolveOperator)(e,t,a.WEBGL_OP_RESOLVE_RULES);return{impl:r.opImpl,context:r.opInit?r.opInit(e,n):e}}}},7769:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Uint8DataEncoder=t.RGBAFloatDataEncoder=t.RedFloat32DataEncoder=void 0;let r=n(6231);t.RedFloat32DataEncoder=class{constructor(e,t=1){if(1===t)this.internalFormat=e.R32F,this.format=e.RED,this.textureType=e.FLOAT,this.channelSize=t;else{if(4!==t)throw Error(`Invalid number of channels: ${t}`);this.internalFormat=e.RGBA32F,this.format=e.RGBA,this.textureType=e.FLOAT,this.channelSize=t}}encode(e,t){let n,i;return e.constructor!==Float32Array&&(r.Logger.warning("Encoder","data was not of type Float32; creating new Float32Array"),i=new Float32Array(e)),t*this.channelSize>e.length?(r.Logger.warning("Encoder","Source data too small. Allocating larger array"),i=e,n=this.allocate(t*this.channelSize),i.forEach((e,t)=>n[t]=e)):n=i=e,n}allocate(e){return new Float32Array(4*e)}decode(e,t){return 1===this.channelSize?e.filter((e,t)=>t%4==0).subarray(0,t):e.subarray(0,t)}},t.RGBAFloatDataEncoder=class{constructor(e,t=1,n){if(1!==t&&4!==t)throw Error(`Invalid number of channels: ${t}`);this.internalFormat=e.RGBA,this.format=e.RGBA,this.channelSize=t,this.textureType=n||e.FLOAT}encode(e,t){let n=e;return 1===this.channelSize&&(r.Logger.verbose("Encoder","Exploding into a larger array"),n=this.allocate(t),e.forEach((e,t)=>n[4*t]=e)),n}allocate(e){return new Float32Array(4*e)}decode(e,t){return 1===this.channelSize?e.filter((e,t)=>t%4==0).subarray(0,t):e.subarray(0,t)}},t.Uint8DataEncoder=class{constructor(e,t=1){if(this.channelSize=4,1===t)this.internalFormat=e.ALPHA,this.format=e.ALPHA,this.textureType=e.UNSIGNED_BYTE,this.channelSize=t;else{if(4!==t)throw Error(`Invalid number of channels: ${t}`);this.internalFormat=e.RGBA,this.format=e.RGBA,this.textureType=e.UNSIGNED_BYTE,this.channelSize=t}}encode(e,t){return new Uint8Array(e.buffer,e.byteOffset,e.byteLength)}allocate(e){return new Uint8Array(e*this.channelSize)}decode(e,t){if(e instanceof Uint8Array)return e.subarray(0,t);throw Error(`Invalid array type: ${e.constructor}`)}}},7859:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getBatchDim=t.sizeToSquarishShape=t.getRowsCols=t.sizeFromShape=t.isInt=t.parseAxisParam=t.squeezeShape=t.PreferLogicalStrategy=t.AlwaysKeepOriginalSizeStrategy=void 0;let r=n(6231),i=n(2517);function s(e,t){let n=[],r=[],i=null!=t&&Array.isArray(t)&&0===t.length,s=null==t||i?null:a(t,e).sort(),o=0;for(let t=0;t<e.length;++t){if(null!=s){if(s[o]===t&&1!==e[t])throw Error(`Can't squeeze axis ${t} since its dim '${e[t]}' is not 1`);(null==s[o]||s[o]>t)&&1===e[t]&&(n.push(e[t]),r.push(t)),s[o]<=t&&o++}1!==e[t]&&(n.push(e[t]),r.push(t))}return{newShape:n,keptDims:r}}function a(e,t){let n=t.length;return e=null==e?t.map((e,t)=>t):[].concat(e),(0,i.assert)(e.every(e=>e>=-n&&e<n),()=>`All values in axis param must be in range [-${n}, ${n}) but got axis ${e}`),(0,i.assert)(e.every(o),()=>`All values in axis param must be integers but got axis ${e}`),e.map(e=>e<0?n+e:e)}function o(e){return e%1==0}function l(e){if(0===e.length)return 1;let t=e[0];for(let n=1;n<e.length;n++)t*=e[n];return t}function u(e){let t=Math.ceil(Math.sqrt(e));return[t,Math.ceil(e/t)]}t.AlwaysKeepOriginalSizeStrategy=class{constructor(e){this.maxTextureSize=e}computeTextureWH(e,t){if(0===e.length)return[1,1];let n=this.maxTextureSize;if(t&&void 0!==t.breakAxis){let i=t.breakAxis>=e.length?1:e.slice(t.breakAxis).reduce((e,t)=>e*t),s=t.breakAxis<=0?1:e.slice(0,t.breakAxis).reduce((e,t)=>e*t);if(!(i>n||s>n))return[i,s];r.Logger.verbose("TextureLayout",`Given width/height preferences were unattainable: shape:${e}, breakAxis:${t.breakAxis}`)}let i=e.reduce((e,t)=>e*t),s=Math.floor(Math.sqrt(i));for(;s<n&&s<i&&i%s!=0;s++);if(s>=n||i%s!=0)throw Error(`The given dimensions are outside this GPU's boundaries: ${e}`);return[s,i/s]}},t.PreferLogicalStrategy=class{constructor(e){this.maxTextureSize=e}computeTextureWH(e,t){let n=this.computeTexture(e,t);return t&&t.isPacked&&(n[0]/=2,n[1]/=2),t&&t.reverseWH?[n[1],n[0]]:n}computeTexture(e,t){let n=t&&t.isPacked;if(0===e.length)return n?[2,2]:[1,1];let i=this.maxTextureSize;if(t&&void 0!==t.breakAxis){let n=t.breakAxis>=e.length?1:e.slice(t.breakAxis).reduce((e,t)=>e*t),s=t.breakAxis<=0?1:e.slice(0,t.breakAxis).reduce((e,t)=>e*t);if(!(n>i||s>i))return[n,s];r.Logger.verbose("TextureLayout",`Given width/height preferences were unattainable: shape:${e}, breakAxis:${t.breakAxis}`)}let a=e.slice(0);n&&(i*=2,1===(a=a.map((e,t)=>t>=a.length-2?a[t]%2==0?a[t]:a[t]+1:a[t])).length&&(a=[2,a[0]])),2!==a.length&&(a=s(a).newShape);let o=l(a);return a.length<=1&&o<=i?[1,o]:2===a.length&&a[0]<=i&&a[1]<=i?a:3===a.length&&a[0]*a[1]<=i&&a[2]<=i?[a[0]*a[1],a[2]]:3===a.length&&a[0]<=i&&a[1]*a[2]<=i?[a[0],a[1]*a[2]]:4===a.length&&a[0]*a[1]*a[2]<=i&&a[3]<=i?[a[0]*a[1]*a[2],a[3]]:4===a.length&&a[0]<=i&&a[1]*a[2]*a[3]<=i?[a[0],a[1]*a[2]*a[3]]:n?u(o/4).map(e=>2*e):u(o)}},t.squeezeShape=s,t.parseAxisParam=a,t.isInt=o,t.sizeFromShape=l,t.getRowsCols=function(e){if(0===e.length)throw Error("Cannot get rows and columns of an empty shape array.");return[e.length>1?e[e.length-2]:1,e[e.length-1]]},t.sizeToSquarishShape=u,t.getBatchDim=function(e,t=2){return l(e.slice(0,e.length-t))}},4057:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createTextureLayoutFromShape=t.calculateTextureWidthAndHeight=t.createTextureLayoutFromTextureType=void 0;let r=n(2517),i=n(2039);t.createTextureLayoutFromTextureType=(e,n,r)=>{let s=r===i.TextureType.unpacked||r===i.TextureType.unpackedReversed?1:4,a=r===i.TextureType.packed,o=r===i.TextureType.unpackedReversed||r===i.TextureType.packed,l=r===i.TextureType.packedLastDimension?n.length-1:void 0,u=r===i.TextureType.packedLastDimension?n.map((e,t)=>t===n.length-1?4*e:e):void 0;return(0,t.createTextureLayoutFromShape)(e,n,s,u,{isPacked:a,reverseWH:o,breakAxis:l})},t.calculateTextureWidthAndHeight=(e,n,r)=>{let i=(0,t.createTextureLayoutFromTextureType)(e,n,r);return[i.width,i.height]},t.createTextureLayoutFromShape=(e,t,n=1,i,s)=>{let a=!(!s||!s.isPacked),[o,l]=e.computeTextureWH(a&&i||t,s),u=t.length,c=t.slice(0);if(0===u&&(c=[1]),1===n)i=t;else if(a){if(4!==n)throw Error("a packed texture must be 4-channel");i=t,u>0&&(c[u-1]=Math.ceil(c[u-1]/2)),u>1&&(c[u-2]=Math.ceil(c[u-2]/2))}else if(!i)throw Error("Unpacked shape is needed when using channels > 1");return{width:o,height:l,channels:n,isPacked:a,shape:c,strides:r.ShapeUtil.computeStrides(c),unpackedShape:i,reversedWH:s&&s.reverseWH}}},5702:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TextureManager=void 0;let r=n(6231);t.TextureManager=class{constructor(e,t,n,r){this.glContext=e,this.layoutStrategy=t,this.profiler=n,this.config=r,this.pendingRead=new Map,r.reuseTextures&&(this.inUseTextures=new Map,this.idleTextures=new Map,this.textureLookup=new Map)}createTextureFromLayout(e,t,n,i){let s,a;let o=this.toEncoderType(e),l=this.glContext.getEncoder(o,t.channels||1,i);if(t.isPacked&&1===i)throw Error("not implemented");let u=t.width,c=t.height;if(this.config.reuseTextures){s=`${u}x${c}_${l.format}_${l.internalFormat}_${l.textureType}`,(a=this.inUseTextures.get(s))||(a=[],this.inUseTextures.set(s,a));let t=this.idleTextures.get(s);if(t&&t.length>0){let r=t.pop();return a.push(r),1===i&&this.glContext.updateTexture(r,u,c,l,this.toTextureData(e,n)),r}}r.Logger.verbose("TextureManager",`Creating new texture of size ${t.width}x${t.height}`);let h=this.glContext.allocateTexture(u,c,l,this.toTextureData(e,n));return this.config.reuseTextures&&(a.push(h),this.textureLookup.set(h,s)),h}readTexture(e,t,n){return n||(n=1),this.profiler.event("backend","TextureManager.readTexture",()=>{let r=e.shape.reduce((e,t)=>e*t)*n,i=this.glContext.readTexture(e.texture,e.width,e.height,r,this.toEncoderType(t),n);return this.toTensorData(t,i)})}async readTextureAsync(e,t,n){let r=e.tensor.dataId;if(n||(n=1),this.pendingRead.has(r)){let e=this.pendingRead.get(r);return new Promise(t=>null==e?void 0:e.push(t))}return this.profiler.event("backend","TextureManager.readTextureAsync",async()=>{this.pendingRead.set(r,[]);let i=e.shape.reduce((e,t)=>e*t)*n;await this.glContext.createAndWaitForFence();let s=this.glContext.readTexture(e.texture,e.width,e.height,i,this.toEncoderType(t),n),a=this.toTensorData(t,s),o=this.pendingRead.get(r);return this.pendingRead.delete(r),null==o||o.forEach(e=>e(a)),a})}readUint8TextureAsFloat(e){return this.profiler.event("backend","TextureManager.readUint8TextureAsFloat",()=>{let t=e.shape.reduce((e,t)=>e*t),n=this.glContext.readTexture(e.texture,e.width,e.height,4*t,"byte",4);return new Float32Array(n.buffer,n.byteOffset,t)})}releaseTexture(e,t){let n;if(this.config.reuseTextures&&(n=this.textureLookup.get(e.texture))){t&&this.textureLookup.delete(n);let r=this.inUseTextures.get(n);if(r){let t=r.indexOf(e.texture);if(-1!==t){r.splice(t,1);let i=this.idleTextures.get(n);i||(i=[],this.idleTextures.set(n,i)),i.push(e.texture)}}}n&&!t||(r.Logger.verbose("TextureManager",`Deleting texture of size ${e.width}x${e.height}`),this.glContext.deleteTexture(e.texture))}toTensorData(e,t){switch(e){case"int16":return t instanceof Int16Array?t:Int16Array.from(t);case"int32":return t instanceof Int32Array?t:Int32Array.from(t);case"int8":return t instanceof Int8Array?t:Int8Array.from(t);case"uint16":return t instanceof Uint16Array?t:Uint16Array.from(t);case"uint32":return t instanceof Uint32Array?t:Uint32Array.from(t);case"uint8":case"bool":return t instanceof Uint8Array?t:Uint8Array.from(t);case"float32":return t instanceof Float32Array?t:Float32Array.from(t);case"float64":return t instanceof Float64Array?t:Float64Array.from(t);default:throw Error(`TensorData type ${e} is not supported`)}}toTextureData(e,t){if(t)return t instanceof Float32Array?t:new Float32Array(t)}toEncoderType(e){return"float"}clearActiveTextures(){this.glContext.clearActiveTextures()}}},2039:(e,t)=>{"use strict";var n;Object.defineProperty(t,"__esModule",{value:!0}),t.TextureType=void 0,(n=t.TextureType||(t.TextureType={}))[n.unpacked=0]="unpacked",n[n.unpackedReversed=1]="unpackedReversed",n[n.packed=2]="packed",n[n.downloadUint8AsFloat=3]="downloadUint8AsFloat",n[n.packedLastDimension=4]="packedLastDimension"},9390:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getGlChannels=t.getCoordsDataType=t.getSqueezedParams=t.squeezeInputShape=t.generateShaderFuncNameFromInputSamplerNameAtOutCoords=t.generateShaderFuncNameFromInputSamplerName=t.repeatedTry=t.getPackedShape=void 0;let r=n(2517);t.getPackedShape=function(e){let t=e.length;return e.slice(0,t-1).concat(e[t-1]/4)},t.repeatedTry=async function(e,t=e=>0,n){return new Promise((r,i)=>{let s=0,a=()=>{if(e())return void r();let o=t(++s);null!=n&&s>=n?i():setTimeout(a,o)};a()})},t.generateShaderFuncNameFromInputSamplerName=function(e){return(0,r.assert)(void 0!==e&&0!==e.length,()=>"empty string found for sampler name"),"get"+e.charAt(0).toUpperCase()+e.slice(1)},t.generateShaderFuncNameFromInputSamplerNameAtOutCoords=function(e){return(0,r.assert)(void 0!==e&&0!==e.length,()=>"empty string found for sampler name"),"get"+e.charAt(0).toUpperCase()+e.slice(1)+"AtOutCoords"},t.squeezeInputShape=function(e,t){return JSON.parse(JSON.stringify(e)),t},t.getSqueezedParams=function(e,t){return t.map(t=>e[t]).join(", ")},t.getCoordsDataType=function(e){if(e<=1)return"int";if(2===e)return"ivec2";if(3===e)return"ivec3";if(4===e)return"ivec4";if(5===e)return"ivec5";if(6===e)return"ivec6";throw Error(`GPU for rank ${e} is not yet supported`)},t.getGlChannels=function(e=6){return["x","y","z","w","u","v"].slice(0,e)}},7305:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createNewWebGLContext=t.createWebGLContext=void 0;let r=n(6231),i=n(1713),s={};function a(e){let t;let n=function(){if("undefined"==typeof document){if("undefined"==typeof OffscreenCanvas)throw TypeError("failed to create canvas: OffscreenCanvas is not supported");return new OffscreenCanvas(1,1)}let e=document.createElement("canvas");return e.width=1,e.height=1,e}(),s={alpha:!1,depth:!1,antialias:!1,stencil:!1,preserveDrawingBuffer:!1,premultipliedAlpha:!1,failIfMajorPerformanceCaveat:!1};if((!e||"webgl2"===e)&&(t=n.getContext("webgl2",s)))try{return new i.WebGLContext(t,2)}catch(e){r.Logger.warning("GlContextFactory",`failed to create WebGLContext using contextId 'webgl2'. Error: ${e}`)}if((!e||"webgl"===e)&&(t=n.getContext("webgl",s)||n.getContext("experimental-webgl",s)))try{return new i.WebGLContext(t,1)}catch(e){r.Logger.warning("GlContextFactory",`failed to create WebGLContext using contextId 'webgl' or 'experimental-webgl'. Error: ${e}`)}throw Error("WebGL is not supported")}t.createWebGLContext=function e(t){let n;(!t||"webgl2"===t)&&"webgl2"in s?n=s.webgl2:(!t||"webgl"===t)&&"webgl"in s&&(n=s.webgl),n=n||a(t),t=t||1===n.version?"webgl":"webgl2";let r=n.gl;return s[t]=n,r.isContextLost()?(delete s[t],e(t)):(r.disable(r.DEPTH_TEST),r.disable(r.STENCIL_TEST),r.disable(r.BLEND),r.disable(r.DITHER),r.disable(r.POLYGON_OFFSET_FILL),r.disable(r.SAMPLE_COVERAGE),r.enable(r.SCISSOR_TEST),r.enable(r.CULL_FACE),r.cullFace(r.BACK),n)},t.createNewWebGLContext=a},1713:function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var i=Object.getOwnPropertyDescriptor(t,n);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,i)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&r(t,e,n);return i(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.WebGLContext=t.linearSearchLastTrue=void 0;let a=n(1670),o=s(n(7769)),l=n(9390);function u(e){let t=0;for(;t<e.length&&e[t]();++t);return t-1}t.linearSearchLastTrue=u,t.WebGLContext=class{constructor(e,t){this.frameBufferBound=!1,this.itemsToPoll=[],this.gl=e,this.version=t,this.getExtensions(),this.vertexbuffer=this.createVertexbuffer(),this.framebuffer=this.createFramebuffer(),this.queryVitalParameters()}allocateTexture(e,t,n,r){let i=this.gl,s=i.createTexture();i.bindTexture(i.TEXTURE_2D,s),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.NEAREST),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.NEAREST),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE);let a=r?n.encode(r,e*t):null;return i.texImage2D(i.TEXTURE_2D,0,n.internalFormat,e,t,0,n.format,n.textureType,a),this.checkError(),s}updateTexture(e,t,n,r,i){let s=this.gl;s.bindTexture(s.TEXTURE_2D,e);let a=r.encode(i,t*n);s.texSubImage2D(s.TEXTURE_2D,0,0,0,t,n,r.format,r.textureType,a),this.checkError()}attachFramebuffer(e,t,n){let r=this.gl;r.bindTexture(r.TEXTURE_2D,e),r.bindFramebuffer(r.FRAMEBUFFER,this.framebuffer),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,e,0),this.checkError(),r.viewport(0,0,t,n),r.scissor(0,0,t,n)}readTexture(e,t,n,r,i,s){let a=this.gl;s||(s=1),this.frameBufferBound||this.attachFramebuffer(e,t,n);let o=this.getEncoder(i,s),l=o.allocate(t*n);return a.bindTexture(a.TEXTURE_2D,e),a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,e,0),a.readPixels(0,0,t,n,a.RGBA,o.textureType,l),this.checkError(),o.decode(l,r)}isFramebufferReady(){return!0}getActiveTexture(){let e=this.gl;return"TEXTURE"+(e.getParameter(this.gl.ACTIVE_TEXTURE)-e.TEXTURE0)}getTextureBinding(){return this.gl.getParameter(this.gl.TEXTURE_BINDING_2D)}getFramebufferBinding(){return this.gl.getParameter(this.gl.FRAMEBUFFER_BINDING)}setVertexAttributes(e,t){let n=this.gl;n.vertexAttribPointer(e,3,n.FLOAT,!1,20,0),n.enableVertexAttribArray(e),-1!==t&&(n.vertexAttribPointer(t,2,n.FLOAT,!1,20,12),n.enableVertexAttribArray(t)),this.checkError()}createProgram(e,t){let n=this.gl,r=n.createProgram();return n.attachShader(r,e),n.attachShader(r,t),n.linkProgram(r),r}compileShader(e,t){let n=this.gl,r=n.createShader(t);if(!r)throw Error(`createShader() returned null with type ${t}`);if(n.shaderSource(r,e),n.compileShader(r),!1===n.getShaderParameter(r,n.COMPILE_STATUS))throw Error(`Failed to compile shader: ${n.getShaderInfoLog(r)}
Shader source:
${e}`);return r}deleteShader(e){this.gl.deleteShader(e)}bindTextureToUniform(e,t,n){let r=this.gl;r.activeTexture(r.TEXTURE0+t),this.checkError(),r.bindTexture(r.TEXTURE_2D,e),this.checkError(),r.uniform1i(n,t),this.checkError()}draw(){this.gl.drawArrays(this.gl.TRIANGLE_STRIP,0,4),this.checkError()}checkError(){if(a.env.debug){let e=this.gl,t=e.getError(),n="";switch(t){case e.NO_ERROR:return;case e.INVALID_ENUM:n="INVALID_ENUM";break;case e.INVALID_VALUE:n="INVALID_VALUE";break;case e.INVALID_OPERATION:n="INVALID_OPERATION";break;case e.INVALID_FRAMEBUFFER_OPERATION:n="INVALID_FRAMEBUFFER_OPERATION";break;case e.OUT_OF_MEMORY:n="OUT_OF_MEMORY";break;case e.CONTEXT_LOST_WEBGL:n="CONTEXT_LOST_WEBGL";break;default:n=`Unknown WebGL Error: ${t.toString(16)}`}throw Error(n)}}deleteTexture(e){this.gl.deleteTexture(e)}deleteProgram(e){this.gl.deleteProgram(e)}getEncoder(e,t,n=0){if(2===this.version)return new o.RedFloat32DataEncoder(this.gl,t);switch(e){case"float":return 1===n||this.isRenderFloat32Supported?new o.RGBAFloatDataEncoder(this.gl,t):new o.RGBAFloatDataEncoder(this.gl,t,this.textureHalfFloatExtension.HALF_FLOAT_OES);case"int":throw Error("not implemented");case"byte":return new o.Uint8DataEncoder(this.gl,t);default:throw Error(`Invalid dataType: ${e}`)}}clearActiveTextures(){let e=this.gl;for(let t=0;t<this.maxTextureImageUnits;++t)e.activeTexture(e.TEXTURE0+t),e.bindTexture(e.TEXTURE_2D,null)}dispose(){if(this.disposed)return;let e=this.gl;e.bindFramebuffer(e.FRAMEBUFFER,null),e.deleteFramebuffer(this.framebuffer),e.bindBuffer(e.ARRAY_BUFFER,null),e.deleteBuffer(this.vertexbuffer),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null),e.finish(),this.disposed=!0}createDefaultGeometry(){return new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0])}createVertexbuffer(){let e=this.gl,t=e.createBuffer();if(!t)throw Error("createBuffer() returned null");let n=this.createDefaultGeometry();return e.bindBuffer(e.ARRAY_BUFFER,t),e.bufferData(e.ARRAY_BUFFER,n,e.STATIC_DRAW),this.checkError(),t}createFramebuffer(){let e=this.gl.createFramebuffer();if(!e)throw Error("createFramebuffer returned null");return e}queryVitalParameters(){let e=this.gl;if(this.isFloatTextureAttachableToFrameBuffer=this.checkFloatTextureAttachableToFrameBuffer(),this.isRenderFloat32Supported=this.checkRenderFloat32(),this.isFloat32DownloadSupported=this.checkFloat32Download(),1===this.version&&!this.textureHalfFloatExtension&&!this.isRenderFloat32Supported)throw Error("both float32 and float16 TextureType are not supported");this.isBlendSupported=!this.isRenderFloat32Supported||this.checkFloat32Blend(),this.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE),this.maxTextureImageUnits=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),this.version}getExtensions(){2===this.version?(this.colorBufferFloatExtension=this.gl.getExtension("EXT_color_buffer_float"),this.disjointTimerQueryWebgl2Extension=this.gl.getExtension("EXT_disjoint_timer_query_webgl2")):(this.textureFloatExtension=this.gl.getExtension("OES_texture_float"),this.textureHalfFloatExtension=this.gl.getExtension("OES_texture_half_float"))}checkFloatTextureAttachableToFrameBuffer(){let e=this.gl,t=e.createTexture();e.bindTexture(e.TEXTURE_2D,t);let n=2===this.version?e.RGBA32F:e.RGBA;e.texImage2D(e.TEXTURE_2D,0,n,1,1,0,e.RGBA,e.FLOAT,null);let r=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,r),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t,0);let i=e.checkFramebufferStatus(e.FRAMEBUFFER)===e.FRAMEBUFFER_COMPLETE;return e.bindTexture(e.TEXTURE_2D,null),e.bindFramebuffer(e.FRAMEBUFFER,null),e.deleteTexture(t),e.deleteFramebuffer(r),i}checkRenderFloat32(){if(2===this.version){if(!this.colorBufferFloatExtension)return!1}else if(!this.textureFloatExtension)return!1;return this.isFloatTextureAttachableToFrameBuffer}checkFloat32Download(){if(2===this.version){if(!this.colorBufferFloatExtension)return!1}else if(!this.textureFloatExtension||!this.gl.getExtension("WEBGL_color_buffer_float"))return!1;return this.isFloatTextureAttachableToFrameBuffer}checkFloat32Blend(){let e,t,n,r,i;let s=this.gl;try{e=s.createTexture(),t=s.createFramebuffer(),s.bindTexture(s.TEXTURE_2D,e);let a=2===this.version?s.RGBA32F:s.RGBA;return s.texImage2D(s.TEXTURE_2D,0,a,1,1,0,s.RGBA,s.FLOAT,null),s.bindFramebuffer(s.FRAMEBUFFER,t),s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_2D,e,0),s.enable(s.BLEND),!!(n=s.createShader(s.VERTEX_SHADER))&&(s.shaderSource(n,"void main(){}"),s.compileShader(n),!!(r=s.createShader(s.FRAGMENT_SHADER))&&(s.shaderSource(r,"precision highp float;void main(){gl_FragColor=vec4(0.5);}"),s.compileShader(r),!!(i=s.createProgram())&&(s.attachShader(i,n),s.attachShader(i,r),s.linkProgram(i),s.useProgram(i),s.drawArrays(s.POINTS,0,1),s.getError()===s.NO_ERROR)))}finally{s.disable(s.BLEND),i&&s.deleteProgram(i),n&&s.deleteShader(n),r&&s.deleteShader(r),t&&(s.bindFramebuffer(s.FRAMEBUFFER,null),s.deleteFramebuffer(t)),e&&(s.bindTexture(s.TEXTURE_2D,null),s.deleteTexture(e))}}beginTimer(){if(2===this.version&&this.disjointTimerQueryWebgl2Extension){let e=this.gl,t=this.disjointTimerQueryWebgl2Extension,n=e.createQuery();return e.beginQuery(t.TIME_ELAPSED_EXT,n),n}throw Error("WebGL1 profiling currently not supported.")}endTimer(){if(2!==this.version||!this.disjointTimerQueryWebgl2Extension)throw Error("WebGL1 profiling currently not supported");{let e=this.gl,t=this.disjointTimerQueryWebgl2Extension;e.endQuery(t.TIME_ELAPSED_EXT)}}isTimerResultAvailable(e){let t=!1,n=!1;if(2!==this.version||!this.disjointTimerQueryWebgl2Extension)throw Error("WebGL1 profiling currently not supported");{let r=this.gl,i=this.disjointTimerQueryWebgl2Extension;t=r.getQueryParameter(e,r.QUERY_RESULT_AVAILABLE),n=r.getParameter(i.GPU_DISJOINT_EXT)}return t&&!n}getTimerResult(e){let t=0;if(2!==this.version)throw Error("WebGL1 profiling currently not supported");{let n=this.gl;t=n.getQueryParameter(e,n.QUERY_RESULT),n.deleteQuery(e)}return t/1e6}async waitForQueryAndGetTime(e){return await (0,l.repeatedTry)(()=>this.isTimerResultAvailable(e)),this.getTimerResult(e)}async createAndWaitForFence(){let e=this.createFence(this.gl);return this.pollFence(e)}createFence(e){let t;let n=e,r=n.fenceSync(n.SYNC_GPU_COMMANDS_COMPLETE,0);return e.flush(),t=null===r?()=>!0:()=>{let e=n.clientWaitSync(r,0,0);return e===n.ALREADY_SIGNALED||e===n.CONDITION_SATISFIED},{query:r,isFencePassed:t}}async pollFence(e){return new Promise(t=>{this.addItemToPoll(()=>e.isFencePassed(),()=>t())})}pollItems(){let e=u(this.itemsToPoll.map(e=>e.isDoneFn));for(let t=0;t<=e;++t){let{resolveFn:e}=this.itemsToPoll[t];e()}this.itemsToPoll=this.itemsToPoll.slice(e+1)}async addItemToPoll(e,t){this.itemsToPoll.push({isDoneFn:e,resolveFn:t}),this.itemsToPoll.length>1||await (0,l.repeatedTry)(()=>(this.pollItems(),0===this.itemsToPoll.length))}}},1036:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ExecutionPlan=void 0;let r=n(6231);class i{constructor(e,t){this.op=e,this.node=t}}t.ExecutionPlan=class{constructor(e,t,n){this.graph=e,this.profiler=n,this.initialize(t)}initialize(e){this.profiler.event("session","ExecutionPlan.initialize",()=>{let t=this.graph.getNodes();if(t.length!==e.length)throw Error("The size of nodes and OPs do not match.");this._ops=e.map((e,n)=>new i(e,t[n])),this.reset(),this._starter=[],this._ops.forEach((e,t)=>{let n=!0;for(let t of e.node.inputs)if(!this._values[t]&&-1===this.graph.getInputIndices().indexOf(t)){n=!1;break}n&&this._starter.push(t)})})}reset(){this._values=this.graph.getValues().map(e=>e.tensor)}async execute(e,t){return this.profiler.event("session","ExecutionPlan.execute",async()=>{this.reset();let n=e.createInferenceHandler(),i=this.graph.getInputIndices();if(t.length!==i.length)throw Error(`number of input tensors don't match the number of inputs to the model: actual: ${t.length} expected: ${i.length}`);t.forEach((e,t)=>{let n=i[t];this._values[n]=e});let s=this._starter.slice(0),a=this.graph.getValues(),o=this.graph.getNodes(),l=0;for(;l<s.length;){let e=s[l++],t=this._ops[e],i=t.node.inputs.map(e=>this._values[e]);if(-1!==i.indexOf(void 0))throw Error(`unresolved input detected: op: ${t.node}`);let u=i;r.Logger.verbose("ExecPlan",`Runing op:${t.node.name} (${u.map((e,n)=>`'${t.node.inputs[n]}': ${e.type}[${e.dims.join(",")}]`).join(", ")})`);let c=await this.profiler.event("node",t.node.name,async()=>t.op.impl(n,u,t.op.context));if(c.length!==t.node.outputs.length)throw Error("the size of output does not match model definition.");c.forEach((e,n)=>{let r=t.node.outputs[n];if(this._values[r])throw Error(`output [${r}] already has value: op:${t.node.name}`);this._values[r]=e});let h=new Set;c.forEach((e,n)=>{for(let e of a[t.node.outputs[n]].to){let t=o[e],n=!0;for(let e of t.inputs)if(!this._values[e]){n=!1;break}n&&h.add(e)}}),s.push(...h)}let u=[];for(let e=0;e<this.graph.getOutputIndices().length;e++){let t=this.graph.getOutputIndices()[e],n=this._values[t];if(void 0===n)throw Error(`required output [${t}] does not have value`);0===t?await n.getData():n.data,u.push(n)}return r.Logger.verbose("ExecPlan","disposing of inferenceHandler"),n.dispose(),u})}}},7070:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Graph=void 0;let r=n(1446),i=n(7778),s=n(9395),a=n(9162),o=n(2517);var l=s.onnxruntime.experimental.fbs;t.Graph={from:(e,t)=>new h(e,t)};class u{constructor(e){this._from=void 0,this._to=[],this.tensor=void 0,this.type=void 0,e&&(this.type=o.ProtoUtil.tensorValueTypeFromProto(e.type.tensorType))}get from(){return this._from}get to(){return this._to}}class c{constructor(e,t){e instanceof r.onnx.NodeProto?(this.name=e.name,this.opType=e.opType,this.attributes=new i.Attribute(e.attribute)):e instanceof l.Node&&(this.name=null!=t?t:e.name(),this.opType=e.opType(),this.attributes=new i.Attribute(o.ProtoUtil.tensorAttributesFromORTFormat(e))),this.inputs=[],this.outputs=[],this.executeNode=!0}}class h{constructor(e,t){if(!e)throw TypeError("graph is empty");this.buildGraph(e),this.transformGraph(t),this.checkIsAcyclic()}getInputIndices(){return this._allInputIndices}getInputNames(){return this._allInputNames}getOutputIndices(){return this._allOutputIndices}getOutputNames(){return this._allOutputNames}getValues(){return this._allData}getNodes(){return this._nodes}buildGraph(e){if(e instanceof r.onnx.GraphProto)this.buildGraphFromOnnxFormat(e);else{if(!(e instanceof l.Graph))throw TypeError("Graph type is not supported.");this.buildGraphFromOrtFormat(e)}}buildGraphFromOnnxFormat(e){let t=new Map;this._allData=[],this._allInputIndices=[],this._allInputNames=[],this._allOutputIndices=[],this._allOutputNames=[],this._nodes=[];let n=new Map;if(!e.input)throw Error("missing information in graph: input");let r=[];for(let n of e.input){if(t.has(n.name))throw Error(`duplicated input name: ${n.name}`);let e=this._allData.push(new u(n))-1;t.set(n.name,e),r.push(n.name)}if(!e.initializer)throw Error("missing information in graph: initializer");for(let n of e.initializer){let e=t.get(n.name);if(void 0===e){let r=new u;r.type={shape:{dims:o.ProtoUtil.tensorDimsFromProto(n.dims)},tensorType:o.ProtoUtil.tensorDataTypeFromProto(n.dataType)},e=this._allData.push(r)-1,t.set(n.name,e)}this._allData[e]._from=-1,this._allData[e].tensor=a.Tensor.fromProto(n)}for(let e=0;e<this._allData.length;e++)this._allData[e].tensor||(this._allInputIndices.push(e),this._allInputNames.push(r[e]));if(!e.output)throw Error("missing information in graph: output");for(let n of e.output){if(t.has(n.name))throw Error(`duplicated output name: ${n.name}`);let e=this._allData.push(new u(n))-1;t.set(n.name,e),this._allOutputIndices.push(e),this._allOutputNames.push(n.name)}if(!e.node)throw Error("missing information in graph: node");for(let t of e.node){if(!t.name)for(let e=0;;e++){let r=`unnamed_${t.opType}_${e}`;if(!n.has(r)){t.name=r;break}}if(n.has(t.name))throw Error(`duplicated node name: ${t.name}`);let e=this._nodes.push(new c(t))-1;n.set(t.name,e)}for(let n=0;n<this._nodes.length;n++){let r=this._nodes[n],i=e.node[n];if(!i.output)throw Error(`missing output for node: ${i.name}`);for(let e of i.output){let s=t.get(e);if(void 0===s&&(s=this._allData.push(new u)-1,t.set(e,s)),r.outputs.push(s),void 0!==this._allData[s]._from)throw Error(`multiple nodes output to one data value: ${s}`);if(this._allData[s]._from=n,"Constant"===i.opType){if(!i.attribute||1!==i.attribute.length||!i.attribute[0].t)throw Error("missing attributes or missing tensor value in attributes for this Constant operator");if(!i.output||1!==i.output.length)throw Error("missing output or incorrect number of outputs for this Constant operator");r.outputs.pop(),r.executeNode=!1,this._allData[s]._from=-1,this._allData[s].tensor=a.Tensor.fromProto(i.attribute[0].t)}}}for(let n=0;n<this._nodes.length;n++){let r=this._nodes[n],i=e.node[n];if(!i.input)throw Error(`missing input for node: ${i.name}`);for(let e of i.input){let s=t.get(e);if(void 0===s){if(""===e&&3===i.input.length&&"Resize"===i.opType)continue;throw Error(`unrecognized input '${e}' for node: ${i.name}`)}r.inputs.push(s),this._allData[s]._to.push(n)}}return!0}buildGraphFromOrtFormat(e){var t,n,r;let i=new Map;this._allData=[],this._allInputIndices=[],this._allInputNames=[],this._allOutputIndices=[],this._allOutputNames=[],this._nodes=[];let s=new Map,h=[];for(let s=0;s<e.inputsLength();s++){let a=e.inputs(s);if(i.has(a))throw Error(`duplicated input name: ${a}`);for(let s=0;s<e.nodeArgsLength();s++)if((null===(t=e.nodeArgs(s))||void 0===t?void 0:t.name())===a){let t=new u;if((null===(r=null===(n=e.nodeArgs(s))||void 0===n?void 0:n.type())||void 0===r?void 0:r.valueType())!==l.TypeInfoValue.tensor_type)throw Error("Unexpected value type for the nodeArg.");let c=e.nodeArgs(s).type().value(new l.TensorTypeAndShape),d=o.ProtoUtil.tensorDataTypeFromProto(c.elemType()),p=c.shape(),f=[];for(let e=0;e<p.dimLength();e++)f.push(o.LongUtil.longToNumber(p.dim(e).value().dimValue()));t.type={shape:{dims:f},tensorType:d};let g=this._allData.push(t)-1;i.set(a,g),h.push(a)}}for(let t=0;t<e.initializersLength();t++){let n=e.initializers(t),r=i.get(n.name());if(void 0===r){let e=new u,t=o.ProtoUtil.tensorDimsFromORTFormat(n),s=o.ProtoUtil.tensorDataTypeFromProto(n.dataType());e.type={shape:{dims:t},tensorType:s},r=this._allData.push(e)-1,i.set(n.name(),r)}this._allData[r]._from=-1,this._allData[r].tensor=a.Tensor.fromOrtTensor(n)}for(let e=0;e<this._allData.length;e++)this._allData[e].tensor||(this._allInputIndices.push(e),this._allInputNames.push(h[e]));for(let t=0;t<e.outputsLength();t++){let n=e.outputs(t);if(i.has(n))throw Error(`duplicated output name: ${n}`);let r=this._allData.push(new u)-1;i.set(n,r),this._allOutputIndices.push(r),this._allOutputNames.push(n)}if(!e.nodes)throw Error("missing information in graph: node");for(let t=0;t<e.nodesLength();t++){let n=e.nodes(t),r=n.name();if(!r)for(let e=0;r=`unnamed_${n.opType()}_${e}`,s.has(r);e++);if(s.has(r))throw Error(`duplicated node name: ${r}`);let i=this._nodes.push(new c(n,r))-1;s.set(r,i)}for(let t=0;t<this._nodes.length;t++){let n=this._nodes[t],r=e.nodes(t);if(null==r)throw Error(`No node exists at index ${t}`);if(0===(null==r?void 0:r.outputsLength()))throw Error(`missing output for node: ${r.name}`);for(let e=0;e<(null==r?void 0:r.outputsLength());e++){let s=null==r?void 0:r.outputs(e),o=i.get(s);if(void 0===o&&(o=this._allData.push(new u)-1,i.set(s,o)),n.outputs.push(o),void 0!==this._allData[o]._from)throw Error(`multiple nodes output to one data value: ${o}`);if(this._allData[o]._from=t,"Constant"===r.opType()){if(1!==r.attributesLength()||!r.attributes(0).t())throw Error("missing attributes or missing tensor value in attributes for this Constant operator");if(1!==r.outputsLength())throw Error("missing output or incorrect number of outputs for this Constant operator");n.outputs.pop(),n.executeNode=!1,this._allData[o]._from=-1,this._allData[o].tensor=a.Tensor.fromOrtTensor(r.attributes(0).t())}}}for(let t=0;t<this._nodes.length;t++){let n=this._nodes[t],r=e.nodes(t);if(0===r.inputsLength())throw Error(`missing input for node: ${r.name}`);for(let e=0;e<r.inputsLength();e++){let s=r.inputs(e),a=i.get(s);if(void 0===a)throw Error(`unrecognized input '${s}' for node: ${r.name()}`);n.inputs.push(a),this._allData[a]._to.push(t)}}}checkIsAcyclic(){let e=new Set;this._allInputIndices.forEach(t=>{this._allData[t]._to.forEach(t=>{e.add(t)})});let t=Array.from(e),n=Array(this._nodes.length).fill("white");for(;t.length>0;){let e=t.pop();"gray"===n[e]?n[e]="black":(t.push(e),n[e]="gray",this._nodes[e].outputs.forEach(r=>{let i=this._allData[r];if(void 0!==i.tensor)throw Error("node outputs should not be initialized");if(i._from!==e)throw Error("from property of the Value object doesn't match index of Node being processed");i._to.forEach(e=>{if("gray"===n[e])throw Error("model graph is cyclic");"white"===n[e]&&t.push(e)})}))}}transformGraph(e){this.removeAllIdentityNodes(),this.removeAllDropoutNodes(),this.fuseConvActivationNodes(),e&&e.transformGraph(this),this.finalizeGraph()}finalizeGraph(){let e=0;for(let t=0;t<this._nodes.length;t++)this._nodes[t].executeNode?e>0&&(this._nodes[t].inputs.forEach(n=>{let r=this._allData[n]._to.indexOf(t+e);-1!==r&&(this._allData[n]._to[r]=t)}),this._nodes[t].outputs.forEach(n=>{this._allData[n]._from&&this._allData[n]._from===t+e&&(this._allData[n]._from=t)})):(e++,this._nodes[t].outputs.forEach(e=>{this._allData[e]._from=-2}),this._nodes.splice(t,1),t--);e=0;for(let t=0;t<this._allData.length;t++)if(-2!==this._allData[t].from||-1!==this._allOutputIndices.indexOf(t+e)){if(e>0){let n=-1;void 0!==this._allData[t].from&&-1!==this._allData[t].from?-1!==(n=this._nodes[this._allData[t].from].outputs.indexOf(t+e))&&(this._nodes[this._allData[t].from].outputs[n]=t):-1!==(n=this._allInputIndices.indexOf(t+e))&&(this._allInputIndices[n]=t),this._allData[t].to.forEach(r=>{-1!==(n=this._nodes[r].inputs.indexOf(t+e))&&(this._nodes[r].inputs[n]=t)}),0===this._allData[t].to.length&&-1!==(n=this._allOutputIndices.indexOf(t+e))&&(this._allOutputIndices[n]=t)}}else e++,this._allData.splice(t,1),t--}deleteNode(e){let t=this._nodes[e];if(t.outputs.length>1){for(let e=1;e<t.outputs.length;e++)if(this._allData[t.outputs[e]].to.length>0)throw Error("Node deletion with more than one output connected to other nodes is not supported. ")}t.executeNode=!1;let n=t.inputs[0],r=t.outputs[0],i=this._allData[r].to,s=this._allData[n].to.indexOf(e);if(-1===s)throw Error("The Value object doesn't have the current Node in it's 'to' property ");this._allData[n].to.splice(s,1),this._allData[r]._to=[];let a=this._allOutputIndices.indexOf(r);if(-1!==a&&(this._allOutputIndices[a]=n),i&&i.length>0)for(let e of i){let t=this._nodes[e].inputs.indexOf(r);if(-1===t)throw Error("The Node object doesn't have the output Value in it's 'inputs' property ");this._nodes[e].inputs[t]=n,this._allData[n].to.push(e)}}removeAllDropoutNodes(){let e=0;for(let t of this._nodes){if("Dropout"===t.opType){if(1!==t.inputs.length)throw Error("Dropout nodes should only contain one input. ");if(1!==t.outputs.length&&2!==t.outputs.length)throw Error("Dropout nodes should contain either 1 or 2 output(s)");if(2===t.outputs.length&&0!==this._allData[t.outputs[1]]._to.length)throw Error("Dropout nodes's second output should not be referenced by other nodes");this.deleteNode(e)}e++}}removeAllIdentityNodes(){let e=0;for(let t of this._nodes)"Identity"===t.opType&&this.deleteNode(e),e++}isActivation(e){switch(e.opType){case"Relu":case"Sigmoid":case"Clip":return!0;default:return!1}}fuseConvActivationNodes(){for(let e of this._nodes)if("Conv"===e.opType){let t=this._allData[e.outputs[0]]._to;if(1===t.length&&this.isActivation(this._nodes[t[0]])){let n=this._nodes[t[0]];if("Clip"===n.opType){if(1===n.inputs.length)try{e.attributes.set("activation_params","floats",[n.attributes.getFloat("min"),n.attributes.getFloat("max")])}catch(t){e.attributes.set("activation_params","floats",[o.MIN_CLIP,o.MAX_CLIP])}else{if(!(n.inputs.length>=3&&void 0!==this._allData[n.inputs[1]].tensor&&void 0!==this._allData[n.inputs[2]].tensor))continue;e.attributes.set("activation_params","floats",[this._allData[n.inputs[1]].tensor.floatData[0],this._allData[n.inputs[2]].tensor.floatData[0]])}}e.attributes.set("activation","string",n.opType),this.deleteNode(t[0])}}}}},6231:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.now=t.Profiler=t.Logger=void 0;let n={verbose:1e3,info:2e3,warning:4e3,error:5e3,fatal:6e3},r={none:new class{log(e,t,n){}},console:new class{log(e,t,n){console.log(`${this.color(e)} ${n?"\x1b[35m"+n+"\x1b[0m ":""}${t}`)}color(e){switch(e){case"verbose":return"\x1b[34;40mv\x1b[0m";case"info":return"\x1b[32mi\x1b[0m";case"warning":return"\x1b[30;43mw\x1b[0m";case"error":return"\x1b[31;40me\x1b[0m";case"fatal":return"\x1b[101mf\x1b[0m";default:throw Error(`unsupported severity: ${e}`)}}}},i={provider:"console",minimalSeverity:"warning",logDateTime:!0,logSourceLocation:!1},s={"":i};function a(e,t,n,r){var i;if(void 0===t)return i=e,{verbose:a.verbose.bind(null,i),info:a.info.bind(null,i),warning:a.warning.bind(null,i),error:a.error.bind(null,i),fatal:a.fatal.bind(null,i)};if(void 0===n)o(e,t);else if("number"==typeof n&&void 0===r)o(e,t);else if("string"==typeof n&&void 0===r)o(e,n,0,t);else{if("string"!=typeof n||"number"!=typeof r)throw TypeError("input is valid");o(e,n,0,t)}}function o(e,t,i,a){let o=s[a||""]||s[""];n[e]<n[o.minimalSeverity]||(o.logDateTime&&(t=`${(new Date).toISOString()}|${t}`),o.logSourceLocation,r[o.provider].log(e,t,a))}!function(e){function t(e){s={},n("",e||{})}function n(e,n){if("*"===e)t(n);else{let t=s[e]||i;s[e]={provider:n.provider||t.provider,minimalSeverity:n.minimalSeverity||t.minimalSeverity,logDateTime:void 0===n.logDateTime?t.logDateTime:n.logDateTime,logSourceLocation:void 0===n.logSourceLocation?t.logSourceLocation:n.logSourceLocation}}}e.verbose=function(t,n){e("verbose",t,n)},e.info=function(t,n){e("info",t,n)},e.warning=function(t,n){e("warning",t,n)},e.error=function(t,n){e("error",t,n)},e.fatal=function(t,n){e("fatal",t,n)},e.reset=t,e.set=n,e.setWithEnv=function(e){let t={};e.logLevel&&(t.minimalSeverity=e.logLevel),n("",t)}}(a||(a={})),t.Logger=a;class l{constructor(e,t,n,r,i,s){this.category=e,this.name=t,this.startTime=n,this.endCallback=r,this.timer=i,this.ctx=s}end(){return this.endCallback(this)}async checkTimer(){if(void 0===this.ctx||void 0===this.timer)throw Error("No webgl timer found");return this.ctx.endTimer(),this.ctx.waitForQueryAndGetTime(this.timer)}}class u{constructor(e,t,n,r){this.category=e,this.name=t,this.startTime=n,this.endTime=r}}t.Profiler=class{static create(e){return void 0===e?new this:new this(e.maxNumberEvents,e.flushBatchSize,e.flushIntervalInMilliseconds)}constructor(e,t,n){this._started=!1,this._flushPointer=0,this._started=!1,this._maxNumberEvents=void 0===e?1e4:e,this._flushBatchSize=void 0===t?10:t,this._flushIntervalInMilliseconds=void 0===n?5e3:n}start(){this._started=!0,this._timingEvents=[],this._flushTime=(0,t.now)(),this._flushPointer=0}stop(){for(this._started=!1;this._flushPointer<this._timingEvents.length;this._flushPointer++)this.logOneEvent(this._timingEvents[this._flushPointer])}event(e,t,n,r){let i=this._started?this.begin(e,t,r):void 0,s=!1,a=n();if(a&&"function"==typeof a.then)return s=!0,new Promise((e,t)=>{a.then(async t=>{i&&await i.end(),e(t)},async e=>{i&&await i.end(),t(e)})});if(!s&&i){let e=i.end();if(e&&"function"==typeof e.then)return new Promise((t,n)=>{e.then(()=>{t(a)},e=>{n(e)})})}return a}begin(e,n,r){if(!this._started)throw Error("profiler is not started yet");if(void 0===r){let r=(0,t.now)();return this.flush(r),new l(e,n,r,e=>this.endSync(e))}return new l(e,n,0,async e=>this.end(e),r.beginTimer(),r)}async end(e){let t=await e.checkTimer();this._timingEvents.length<this._maxNumberEvents&&(this._timingEvents.push(new u(e.category,e.name,e.startTime,t)),this.flush(t))}endSync(e){let n=(0,t.now)();this._timingEvents.length<this._maxNumberEvents&&(this._timingEvents.push(new u(e.category,e.name,e.startTime,n)),this.flush(n))}logOneEvent(e){t.Logger.verbose(`Profiler.${e.category}`,`${(e.endTime-e.startTime).toFixed(2)}ms on event '${e.name}' at ${e.endTime.toFixed(2)}`)}flush(e){if(this._timingEvents.length-this._flushPointer>=this._flushBatchSize||e-this._flushTime>=this._flushIntervalInMilliseconds){for(let e=this._flushPointer;this._flushPointer<e+this._flushBatchSize&&this._flushPointer<this._timingEvents.length;this._flushPointer++)this.logOneEvent(this._timingEvents[this._flushPointer]);this._flushTime=(0,t.now)()}}get started(){return this._started}},t.now="undefined"!=typeof performance&&performance.now?()=>performance.now():Date.now},2644:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Model=void 0;let r=n(5686),i=n(1446),s=n(7070),a=n(9395),o=n(2517);var l=a.onnxruntime.experimental.fbs;t.Model=class{constructor(){}load(e,t,n){if(!n)try{return void this.loadFromOnnxFormat(e,t)}catch(e){if(void 0!==n)throw e}this.loadFromOrtFormat(e,t)}loadFromOnnxFormat(e,t){let n=i.onnx.ModelProto.decode(e);if(3>o.LongUtil.longToNumber(n.irVersion))throw Error("only support ONNX model with IR_VERSION>=3");this._opsets=n.opsetImport.map(e=>({domain:e.domain,version:o.LongUtil.longToNumber(e.version)})),this._graph=s.Graph.from(n.graph,t)}loadFromOrtFormat(e,t){let n=new r.flatbuffers.ByteBuffer(e),i=l.InferenceSession.getRootAsInferenceSession(n).model();if(3>o.LongUtil.longToNumber(i.irVersion()))throw Error("only support ONNX model with IR_VERSION>=3");this._opsets=[];for(let e=0;e<i.opsetImportLength();e++){let t=i.opsetImport(e);this._opsets.push({domain:null==t?void 0:t.domain(),version:o.LongUtil.longToNumber(t.version())})}this._graph=s.Graph.from(i.graph(),t)}get graph(){return this._graph}get opsets(){return this._opsets}}},782:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FLOAT_TYPES=t.INT_TYPES=t.NUMBER_TYPES=void 0,t.NUMBER_TYPES=["float32","float64","int32","int16","int8","uint16","uint32","uint8"],t.INT_TYPES=["int32","int16","int8","uint16","uint32","uint8"],t.FLOAT_TYPES=["float32","float64"]},1047:(e,t)=>{"use strict";function n(e,t){if(t.endsWith("+")){let n=Number.parseInt(t.substring(0,t.length-1),10);return!isNaN(n)&&n<=e}if(2===t.split("-").length){let n=t.split("-"),r=Number.parseInt(n[0],10),i=Number.parseInt(n[1],10);return!isNaN(r)&&!isNaN(i)&&r<=e&&e<=i}return Number.parseInt(t,10)===e}Object.defineProperty(t,"__esModule",{value:!0}),t.resolveOperator=void 0,t.resolveOperator=function(e,t,r){for(let i of r){let r=i[0],s=i[1],a=i[2],o=i[3],l=i[4];if(e.opType===r){for(let e of t)if((e.domain===s||"ai.onnx"===e.domain&&""===s)&&n(e.version,a))return{opImpl:o,opInit:l}}}throw TypeError(`cannot resolve operator '${e.opType}' with opsets: ${t.map(e=>`${e.domain||"ai.onnx"} v${e.version}`).join(", ")}`)}},9395:(e,t,n)=>{"use strict";var r,i;Object.defineProperty(t,"__esModule",{value:!0}),t.onnxruntime=void 0;let s=n(5686);(function(e){let t;!function(e){e[e.UNDEFINED=0]="UNDEFINED",e[e.FLOAT=1]="FLOAT",e[e.INT=2]="INT",e[e.STRING=3]="STRING",e[e.TENSOR=4]="TENSOR",e[e.GRAPH=5]="GRAPH",e[e.FLOATS=6]="FLOATS",e[e.INTS=7]="INTS",e[e.STRINGS=8]="STRINGS",e[e.TENSORS=9]="TENSORS",e[e.GRAPHS=10]="GRAPHS",e[e.SPARSE_TENSOR=11]="SPARSE_TENSOR",e[e.SPARSE_TENSORS=12]="SPARSE_TENSORS"}(t=e.AttributeType||(e.AttributeType={}))})((i=(r=t.onnxruntime||(t.onnxruntime={})).experimental||(r.experimental={})).fbs||(i.fbs={})),function(e){!function(e){!function(e){let t;!function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.VALUE=1]="VALUE",e[e.PARAM=2]="PARAM"}(t=e.DimensionValueType||(e.DimensionValueType={}))}(e.fbs||(e.fbs={}))}(e.experimental||(e.experimental={}))}(t.onnxruntime||(t.onnxruntime={})),function(e){!function(e){!function(e){let t;!function(e){e[e.UNDEFINED=0]="UNDEFINED",e[e.FLOAT=1]="FLOAT",e[e.UINT8=2]="UINT8",e[e.INT8=3]="INT8",e[e.UINT16=4]="UINT16",e[e.INT16=5]="INT16",e[e.INT32=6]="INT32",e[e.INT64=7]="INT64",e[e.STRING=8]="STRING",e[e.BOOL=9]="BOOL",e[e.FLOAT16=10]="FLOAT16",e[e.DOUBLE=11]="DOUBLE",e[e.UINT32=12]="UINT32",e[e.UINT64=13]="UINT64",e[e.COMPLEX64=14]="COMPLEX64",e[e.COMPLEX128=15]="COMPLEX128",e[e.BFLOAT16=16]="BFLOAT16"}(t=e.TensorDataType||(e.TensorDataType={}))}(e.fbs||(e.fbs={}))}(e.experimental||(e.experimental={}))}(t.onnxruntime||(t.onnxruntime={})),function(e){!function(e){!function(e){let t;!function(e){e[e.Primitive=0]="Primitive",e[e.Fused=1]="Fused"}(t=e.NodeType||(e.NodeType={}))}(e.fbs||(e.fbs={}))}(e.experimental||(e.experimental={}))}(t.onnxruntime||(t.onnxruntime={})),function(e){!function(e){!function(e){let t;!function(e){e[e.NONE=0]="NONE",e[e.tensor_type=1]="tensor_type",e[e.sequence_type=2]="sequence_type",e[e.map_type=3]="map_type"}(t=e.TypeInfoValue||(e.TypeInfoValue={}))}(e.fbs||(e.fbs={}))}(e.experimental||(e.experimental={}))}(t.onnxruntime||(t.onnxruntime={})),function(e){!function(t){!function(t){class n{constructor(){this.bb=null,this.bb_pos=0}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsShape(e,t){return(t||new n).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsShape(e,t){return e.setPosition(e.position()+s.flatbuffers.SIZE_PREFIX_LENGTH),(t||new n).__init(e.readInt32(e.position())+e.position(),e)}dim(t,n){let r=this.bb.__offset(this.bb_pos,4);return r?(n||new e.experimental.fbs.Dimension).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+r)+4*t),this.bb):null}dimLength(){let e=this.bb.__offset(this.bb_pos,4);return e?this.bb.__vector_len(this.bb_pos+e):0}static startShape(e){e.startObject(1)}static addDim(e,t){e.addFieldOffset(0,t,0)}static createDimVector(e,t){e.startVector(4,t.length,4);for(let n=t.length-1;n>=0;n--)e.addOffset(t[n]);return e.endVector()}static startDimVector(e,t){e.startVector(4,t,4)}static endShape(e){return e.endObject()}static createShape(e,t){return n.startShape(e),n.addDim(e,t),n.endShape(e)}}t.Shape=n}(t.fbs||(t.fbs={}))}(e.experimental||(e.experimental={}))}(t.onnxruntime||(t.onnxruntime={})),function(e){!function(t){!function(t){class n{constructor(){this.bb=null,this.bb_pos=0}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsDimension(e,t){return(t||new n).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsDimension(e,t){return e.setPosition(e.position()+s.flatbuffers.SIZE_PREFIX_LENGTH),(t||new n).__init(e.readInt32(e.position())+e.position(),e)}value(t){let n=this.bb.__offset(this.bb_pos,4);return n?(t||new e.experimental.fbs.DimensionValue).__init(this.bb.__indirect(this.bb_pos+n),this.bb):null}denotation(e){let t=this.bb.__offset(this.bb_pos,6);return t?this.bb.__string(this.bb_pos+t,e):null}static startDimension(e){e.startObject(2)}static addValue(e,t){e.addFieldOffset(0,t,0)}static addDenotation(e,t){e.addFieldOffset(1,t,0)}static endDimension(e){return e.endObject()}static createDimension(e,t,r){return n.startDimension(e),n.addValue(e,t),n.addDenotation(e,r),n.endDimension(e)}}t.Dimension=n}(t.fbs||(t.fbs={}))}(e.experimental||(e.experimental={}))}(t.onnxruntime||(t.onnxruntime={})),function(e){!function(t){!function(t){class n{constructor(){this.bb=null,this.bb_pos=0}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsDimensionValue(e,t){return(t||new n).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsDimensionValue(e,t){return e.setPosition(e.position()+s.flatbuffers.SIZE_PREFIX_LENGTH),(t||new n).__init(e.readInt32(e.position())+e.position(),e)}dimType(){let t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt8(this.bb_pos+t):e.experimental.fbs.DimensionValueType.UNKNOWN}dimValue(){let e=this.bb.__offset(this.bb_pos,6);return e?this.bb.readInt64(this.bb_pos+e):this.bb.createLong(0,0)}dimParam(e){let t=this.bb.__offset(this.bb_pos,8);return t?this.bb.__string(this.bb_pos+t,e):null}static startDimensionValue(e){e.startObject(3)}static addDimType(t,n){t.addFieldInt8(0,n,e.experimental.fbs.DimensionValueType.UNKNOWN)}static addDimValue(e,t){e.addFieldInt64(1,t,e.createLong(0,0))}static addDimParam(e,t){e.addFieldOffset(2,t,0)}static endDimensionValue(e){return e.endObject()}static createDimensionValue(e,t,r,i){return n.startDimensionValue(e),n.addDimType(e,t),n.addDimValue(e,r),n.addDimParam(e,i),n.endDimensionValue(e)}}t.DimensionValue=n}(t.fbs||(t.fbs={}))}(e.experimental||(e.experimental={}))}(t.onnxruntime||(t.onnxruntime={})),function(e){!function(t){!function(t){class n{constructor(){this.bb=null,this.bb_pos=0}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsTensorTypeAndShape(e,t){return(t||new n).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsTensorTypeAndShape(e,t){return e.setPosition(e.position()+s.flatbuffers.SIZE_PREFIX_LENGTH),(t||new n).__init(e.readInt32(e.position())+e.position(),e)}elemType(){let t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt32(this.bb_pos+t):e.experimental.fbs.TensorDataType.UNDEFINED}shape(t){let n=this.bb.__offset(this.bb_pos,6);return n?(t||new e.experimental.fbs.Shape).__init(this.bb.__indirect(this.bb_pos+n),this.bb):null}static startTensorTypeAndShape(e){e.startObject(2)}static addElemType(t,n){t.addFieldInt32(0,n,e.experimental.fbs.TensorDataType.UNDEFINED)}static addShape(e,t){e.addFieldOffset(1,t,0)}static endTensorTypeAndShape(e){return e.endObject()}static createTensorTypeAndShape(e,t,r){return n.startTensorTypeAndShape(e),n.addElemType(e,t),n.addShape(e,r),n.endTensorTypeAndShape(e)}}t.TensorTypeAndShape=n}(t.fbs||(t.fbs={}))}(e.experimental||(e.experimental={}))}(t.onnxruntime||(t.onnxruntime={})),function(e){!function(t){!function(t){class n{constructor(){this.bb=null,this.bb_pos=0}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsMapType(e,t){return(t||new n).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsMapType(e,t){return e.setPosition(e.position()+s.flatbuffers.SIZE_PREFIX_LENGTH),(t||new n).__init(e.readInt32(e.position())+e.position(),e)}keyType(){let t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt32(this.bb_pos+t):e.experimental.fbs.TensorDataType.UNDEFINED}valueType(t){let n=this.bb.__offset(this.bb_pos,6);return n?(t||new e.experimental.fbs.TypeInfo).__init(this.bb.__indirect(this.bb_pos+n),this.bb):null}static startMapType(e){e.startObject(2)}static addKeyType(t,n){t.addFieldInt32(0,n,e.experimental.fbs.TensorDataType.UNDEFINED)}static addValueType(e,t){e.addFieldOffset(1,t,0)}static endMapType(e){return e.endObject()}static createMapType(e,t,r){return n.startMapType(e),n.addKeyType(e,t),n.addValueType(e,r),n.endMapType(e)}}t.MapType=n}(t.fbs||(t.fbs={}))}(e.experimental||(e.experimental={}))}(t.onnxruntime||(t.onnxruntime={})),function(e){!function(t){!function(t){class n{constructor(){this.bb=null,this.bb_pos=0}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsSequenceType(e,t){return(t||new n).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsSequenceType(e,t){return e.setPosition(e.position()+s.flatbuffers.SIZE_PREFIX_LENGTH),(t||new n).__init(e.readInt32(e.position())+e.position(),e)}elemType(t){let n=this.bb.__offset(this.bb_pos,4);return n?(t||new e.experimental.fbs.TypeInfo).__init(this.bb.__indirect(this.bb_pos+n),this.bb):null}static startSequenceType(e){e.startObject(1)}static addElemType(e,t){e.addFieldOffset(0,t,0)}static endSequenceType(e){return e.endObject()}static createSequenceType(e,t){return n.startSequenceType(e),n.addElemType(e,t),n.endSequenceType(e)}}t.SequenceType=n}(t.fbs||(t.fbs={}))}(e.experimental||(e.experimental={}))}(t.onnxruntime||(t.onnxruntime={})),function(e){!function(e){(e.fbs||(e.fbs={})).EdgeEnd=class{constructor(){this.bb=null,this.bb_pos=0}__init(e,t){return this.bb_pos=e,this.bb=t,this}nodeIndex(){return this.bb.readUint32(this.bb_pos)}srcArgIndex(){return this.bb.readInt32(this.bb_pos+4)}dstArgIndex(){return this.bb.readInt32(this.bb_pos+8)}static createEdgeEnd(e,t,n,r){return e.prep(4,12),e.writeInt32(r),e.writeInt32(n),e.writeInt32(t),e.offset()}}}(e.experimental||(e.experimental={}))}(t.onnxruntime||(t.onnxruntime={})),function(e){!function(t){!function(t){class n{constructor(){this.bb=null,this.bb_pos=0}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsNodeEdge(e,t){return(t||new n).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsNodeEdge(e,t){return e.setPosition(e.position()+s.flatbuffers.SIZE_PREFIX_LENGTH),(t||new n).__init(e.readInt32(e.position())+e.position(),e)}nodeIndex(){let e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readUint32(this.bb_pos+e):0}inputEdges(t,n){let r=this.bb.__offset(this.bb_pos,6);return r?(n||new e.experimental.fbs.EdgeEnd).__init(this.bb.__vector(this.bb_pos+r)+12*t,this.bb):null}inputEdgesLength(){let e=this.bb.__offset(this.bb_pos,6);return e?this.bb.__vector_len(this.bb_pos+e):0}outputEdges(t,n){let r=this.bb.__offset(this.bb_pos,8);return r?(n||new e.experimental.fbs.EdgeEnd).__init(this.bb.__vector(this.bb_pos+r)+12*t,this.bb):null}outputEdgesLength(){let e=this.bb.__offset(this.bb_pos,8);return e?this.bb.__vector_len(this.bb_pos+e):0}static startNodeEdge(e){e.startObject(3)}static addNodeIndex(e,t){e.addFieldInt32(0,t,0)}static addInputEdges(e,t){e.addFieldOffset(1,t,0)}static startInputEdgesVector(e,t){e.startVector(12,t,4)}static addOutputEdges(e,t){e.addFieldOffset(2,t,0)}static startOutputEdgesVector(e,t){e.startVector(12,t,4)}static endNodeEdge(e){return e.endObject()}static createNodeEdge(e,t,r,i){return n.startNodeEdge(e),n.addNodeIndex(e,t),n.addInputEdges(e,r),n.addOutputEdges(e,i),n.endNodeEdge(e)}}t.NodeEdge=n}(t.fbs||(t.fbs={}))}(e.experimental||(e.experimental={}))}(t.onnxruntime||(t.onnxruntime={})),function(e){!function(t){!function(t){class n{constructor(){this.bb=null,this.bb_pos=0}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsNode(e,t){return(t||new n).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsNode(e,t){return e.setPosition(e.position()+s.flatbuffers.SIZE_PREFIX_LENGTH),(t||new n).__init(e.readInt32(e.position())+e.position(),e)}name(e){let t=this.bb.__offset(this.bb_pos,4);return t?this.bb.__string(this.bb_pos+t,e):null}docString(e){let t=this.bb.__offset(this.bb_pos,6);return t?this.bb.__string(this.bb_pos+t,e):null}domain(e){let t=this.bb.__offset(this.bb_pos,8);return t?this.bb.__string(this.bb_pos+t,e):null}sinceVersion(){let e=this.bb.__offset(this.bb_pos,10);return e?this.bb.readInt32(this.bb_pos+e):0}index(){let e=this.bb.__offset(this.bb_pos,12);return e?this.bb.readUint32(this.bb_pos+e):0}opType(e){let t=this.bb.__offset(this.bb_pos,14);return t?this.bb.__string(this.bb_pos+t,e):null}type(){let t=this.bb.__offset(this.bb_pos,16);return t?this.bb.readInt32(this.bb_pos+t):e.experimental.fbs.NodeType.Primitive}executionProviderType(e){let t=this.bb.__offset(this.bb_pos,18);return t?this.bb.__string(this.bb_pos+t,e):null}inputs(e,t){let n=this.bb.__offset(this.bb_pos,20);return n?this.bb.__string(this.bb.__vector(this.bb_pos+n)+4*e,t):null}inputsLength(){let e=this.bb.__offset(this.bb_pos,20);return e?this.bb.__vector_len(this.bb_pos+e):0}outputs(e,t){let n=this.bb.__offset(this.bb_pos,22);return n?this.bb.__string(this.bb.__vector(this.bb_pos+n)+4*e,t):null}outputsLength(){let e=this.bb.__offset(this.bb_pos,22);return e?this.bb.__vector_len(this.bb_pos+e):0}attributes(t,n){let r=this.bb.__offset(this.bb_pos,24);return r?(n||new e.experimental.fbs.Attribute).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+r)+4*t),this.bb):null}attributesLength(){let e=this.bb.__offset(this.bb_pos,24);return e?this.bb.__vector_len(this.bb_pos+e):0}inputArgCounts(e){let t=this.bb.__offset(this.bb_pos,26);return t?this.bb.readInt32(this.bb.__vector(this.bb_pos+t)+4*e):0}inputArgCountsLength(){let e=this.bb.__offset(this.bb_pos,26);return e?this.bb.__vector_len(this.bb_pos+e):0}inputArgCountsArray(){let e=this.bb.__offset(this.bb_pos,26);return e?new Int32Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+e),this.bb.__vector_len(this.bb_pos+e)):null}implicitInputs(e,t){let n=this.bb.__offset(this.bb_pos,28);return n?this.bb.__string(this.bb.__vector(this.bb_pos+n)+4*e,t):null}implicitInputsLength(){let e=this.bb.__offset(this.bb_pos,28);return e?this.bb.__vector_len(this.bb_pos+e):0}static startNode(e){e.startObject(13)}static addName(e,t){e.addFieldOffset(0,t,0)}static addDocString(e,t){e.addFieldOffset(1,t,0)}static addDomain(e,t){e.addFieldOffset(2,t,0)}static addSinceVersion(e,t){e.addFieldInt32(3,t,0)}static addIndex(e,t){e.addFieldInt32(4,t,0)}static addOpType(e,t){e.addFieldOffset(5,t,0)}static addType(t,n){t.addFieldInt32(6,n,e.experimental.fbs.NodeType.Primitive)}static addExecutionProviderType(e,t){e.addFieldOffset(7,t,0)}static addInputs(e,t){e.addFieldOffset(8,t,0)}static createInputsVector(e,t){e.startVector(4,t.length,4);for(let n=t.length-1;n>=0;n--)e.addOffset(t[n]);return e.endVector()}static startInputsVector(e,t){e.startVector(4,t,4)}static addOutputs(e,t){e.addFieldOffset(9,t,0)}static createOutputsVector(e,t){e.startVector(4,t.length,4);for(let n=t.length-1;n>=0;n--)e.addOffset(t[n]);return e.endVector()}static startOutputsVector(e,t){e.startVector(4,t,4)}static addAttributes(e,t){e.addFieldOffset(10,t,0)}static createAttributesVector(e,t){e.startVector(4,t.length,4);for(let n=t.length-1;n>=0;n--)e.addOffset(t[n]);return e.endVector()}static startAttributesVector(e,t){e.startVector(4,t,4)}static addInputArgCounts(e,t){e.addFieldOffset(11,t,0)}static createInputArgCountsVector(e,t){e.startVector(4,t.length,4);for(let n=t.length-1;n>=0;n--)e.addInt32(t[n]);return e.endVector()}static startInputArgCountsVector(e,t){e.startVector(4,t,4)}static addImplicitInputs(e,t){e.addFieldOffset(12,t,0)}static createImplicitInputsVector(e,t){e.startVector(4,t.length,4);for(let n=t.length-1;n>=0;n--)e.addOffset(t[n]);return e.endVector()}static startImplicitInputsVector(e,t){e.startVector(4,t,4)}static endNode(e){return e.endObject()}static createNode(e,t,r,i,s,a,o,l,u,c,h,d,p,f){return n.startNode(e),n.addName(e,t),n.addDocString(e,r),n.addDomain(e,i),n.addSinceVersion(e,s),n.addIndex(e,a),n.addOpType(e,o),n.addType(e,l),n.addExecutionProviderType(e,u),n.addInputs(e,c),n.addOutputs(e,h),n.addAttributes(e,d),n.addInputArgCounts(e,p),n.addImplicitInputs(e,f),n.endNode(e)}}t.Node=n}(t.fbs||(t.fbs={}))}(e.experimental||(e.experimental={}))}(t.onnxruntime||(t.onnxruntime={})),function(e){!function(t){!function(t){class n{constructor(){this.bb=null,this.bb_pos=0}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsValueInfo(e,t){return(t||new n).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsValueInfo(e,t){return e.setPosition(e.position()+s.flatbuffers.SIZE_PREFIX_LENGTH),(t||new n).__init(e.readInt32(e.position())+e.position(),e)}name(e){let t=this.bb.__offset(this.bb_pos,4);return t?this.bb.__string(this.bb_pos+t,e):null}docString(e){let t=this.bb.__offset(this.bb_pos,6);return t?this.bb.__string(this.bb_pos+t,e):null}type(t){let n=this.bb.__offset(this.bb_pos,8);return n?(t||new e.experimental.fbs.TypeInfo).__init(this.bb.__indirect(this.bb_pos+n),this.bb):null}static startValueInfo(e){e.startObject(3)}static addName(e,t){e.addFieldOffset(0,t,0)}static addDocString(e,t){e.addFieldOffset(1,t,0)}static addType(e,t){e.addFieldOffset(2,t,0)}static endValueInfo(e){return e.endObject()}static createValueInfo(e,t,r,i){return n.startValueInfo(e),n.addName(e,t),n.addDocString(e,r),n.addType(e,i),n.endValueInfo(e)}}t.ValueInfo=n}(t.fbs||(t.fbs={}))}(e.experimental||(e.experimental={}))}(t.onnxruntime||(t.onnxruntime={})),function(e){!function(t){!function(t){class n{constructor(){this.bb=null,this.bb_pos=0}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsTypeInfo(e,t){return(t||new n).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsTypeInfo(e,t){return e.setPosition(e.position()+s.flatbuffers.SIZE_PREFIX_LENGTH),(t||new n).__init(e.readInt32(e.position())+e.position(),e)}denotation(e){let t=this.bb.__offset(this.bb_pos,4);return t?this.bb.__string(this.bb_pos+t,e):null}valueType(){let t=this.bb.__offset(this.bb_pos,6);return t?this.bb.readUint8(this.bb_pos+t):e.experimental.fbs.TypeInfoValue.NONE}value(e){let t=this.bb.__offset(this.bb_pos,8);return t?this.bb.__union(e,this.bb_pos+t):null}static startTypeInfo(e){e.startObject(3)}static addDenotation(e,t){e.addFieldOffset(0,t,0)}static addValueType(t,n){t.addFieldInt8(1,n,e.experimental.fbs.TypeInfoValue.NONE)}static addValue(e,t){e.addFieldOffset(2,t,0)}static endTypeInfo(e){return e.endObject()}static createTypeInfo(e,t,r,i){return n.startTypeInfo(e),n.addDenotation(e,t),n.addValueType(e,r),n.addValue(e,i),n.endTypeInfo(e)}}t.TypeInfo=n}(t.fbs||(t.fbs={}))}(e.experimental||(e.experimental={}))}(t.onnxruntime||(t.onnxruntime={})),function(e){!function(e){!function(e){class t{constructor(){this.bb=null,this.bb_pos=0}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsOperatorSetId(e,n){return(n||new t).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsOperatorSetId(e,n){return e.setPosition(e.position()+s.flatbuffers.SIZE_PREFIX_LENGTH),(n||new t).__init(e.readInt32(e.position())+e.position(),e)}domain(e){let t=this.bb.__offset(this.bb_pos,4);return t?this.bb.__string(this.bb_pos+t,e):null}version(){let e=this.bb.__offset(this.bb_pos,6);return e?this.bb.readInt64(this.bb_pos+e):this.bb.createLong(0,0)}static startOperatorSetId(e){e.startObject(2)}static addDomain(e,t){e.addFieldOffset(0,t,0)}static addVersion(e,t){e.addFieldInt64(1,t,e.createLong(0,0))}static endOperatorSetId(e){return e.endObject()}static createOperatorSetId(e,n,r){return t.startOperatorSetId(e),t.addDomain(e,n),t.addVersion(e,r),t.endOperatorSetId(e)}}e.OperatorSetId=t}(e.fbs||(e.fbs={}))}(e.experimental||(e.experimental={}))}(t.onnxruntime||(t.onnxruntime={})),function(e){!function(t){!function(t){class n{constructor(){this.bb=null,this.bb_pos=0}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsTensor(e,t){return(t||new n).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsTensor(e,t){return e.setPosition(e.position()+s.flatbuffers.SIZE_PREFIX_LENGTH),(t||new n).__init(e.readInt32(e.position())+e.position(),e)}name(e){let t=this.bb.__offset(this.bb_pos,4);return t?this.bb.__string(this.bb_pos+t,e):null}docString(e){let t=this.bb.__offset(this.bb_pos,6);return t?this.bb.__string(this.bb_pos+t,e):null}dims(e){let t=this.bb.__offset(this.bb_pos,8);return t?this.bb.readInt64(this.bb.__vector(this.bb_pos+t)+8*e):this.bb.createLong(0,0)}dimsLength(){let e=this.bb.__offset(this.bb_pos,8);return e?this.bb.__vector_len(this.bb_pos+e):0}dataType(){let t=this.bb.__offset(this.bb_pos,10);return t?this.bb.readInt32(this.bb_pos+t):e.experimental.fbs.TensorDataType.UNDEFINED}rawData(e){let t=this.bb.__offset(this.bb_pos,12);return t?this.bb.readUint8(this.bb.__vector(this.bb_pos+t)+e):0}rawDataLength(){let e=this.bb.__offset(this.bb_pos,12);return e?this.bb.__vector_len(this.bb_pos+e):0}rawDataArray(){let e=this.bb.__offset(this.bb_pos,12);return e?new Uint8Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+e),this.bb.__vector_len(this.bb_pos+e)):null}stringData(e,t){let n=this.bb.__offset(this.bb_pos,14);return n?this.bb.__string(this.bb.__vector(this.bb_pos+n)+4*e,t):null}stringDataLength(){let e=this.bb.__offset(this.bb_pos,14);return e?this.bb.__vector_len(this.bb_pos+e):0}static startTensor(e){e.startObject(6)}static addName(e,t){e.addFieldOffset(0,t,0)}static addDocString(e,t){e.addFieldOffset(1,t,0)}static addDims(e,t){e.addFieldOffset(2,t,0)}static createDimsVector(e,t){e.startVector(8,t.length,8);for(let n=t.length-1;n>=0;n--)e.addInt64(t[n]);return e.endVector()}static startDimsVector(e,t){e.startVector(8,t,8)}static addDataType(t,n){t.addFieldInt32(3,n,e.experimental.fbs.TensorDataType.UNDEFINED)}static addRawData(e,t){e.addFieldOffset(4,t,0)}static createRawDataVector(e,t){e.startVector(1,t.length,1);for(let n=t.length-1;n>=0;n--)e.addInt8(t[n]);return e.endVector()}static startRawDataVector(e,t){e.startVector(1,t,1)}static addStringData(e,t){e.addFieldOffset(5,t,0)}static createStringDataVector(e,t){e.startVector(4,t.length,4);for(let n=t.length-1;n>=0;n--)e.addOffset(t[n]);return e.endVector()}static startStringDataVector(e,t){e.startVector(4,t,4)}static endTensor(e){return e.endObject()}static createTensor(e,t,r,i,s,a,o){return n.startTensor(e),n.addName(e,t),n.addDocString(e,r),n.addDims(e,i),n.addDataType(e,s),n.addRawData(e,a),n.addStringData(e,o),n.endTensor(e)}}t.Tensor=n}(t.fbs||(t.fbs={}))}(e.experimental||(e.experimental={}))}(t.onnxruntime||(t.onnxruntime={})),function(e){!function(t){!function(t){class n{constructor(){this.bb=null,this.bb_pos=0}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsSparseTensor(e,t){return(t||new n).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsSparseTensor(e,t){return e.setPosition(e.position()+s.flatbuffers.SIZE_PREFIX_LENGTH),(t||new n).__init(e.readInt32(e.position())+e.position(),e)}values(t){let n=this.bb.__offset(this.bb_pos,4);return n?(t||new e.experimental.fbs.Tensor).__init(this.bb.__indirect(this.bb_pos+n),this.bb):null}indices(t){let n=this.bb.__offset(this.bb_pos,6);return n?(t||new e.experimental.fbs.Tensor).__init(this.bb.__indirect(this.bb_pos+n),this.bb):null}dims(e){let t=this.bb.__offset(this.bb_pos,8);return t?this.bb.readInt64(this.bb.__vector(this.bb_pos+t)+8*e):this.bb.createLong(0,0)}dimsLength(){let e=this.bb.__offset(this.bb_pos,8);return e?this.bb.__vector_len(this.bb_pos+e):0}static startSparseTensor(e){e.startObject(3)}static addValues(e,t){e.addFieldOffset(0,t,0)}static addIndices(e,t){e.addFieldOffset(1,t,0)}static addDims(e,t){e.addFieldOffset(2,t,0)}static createDimsVector(e,t){e.startVector(8,t.length,8);for(let n=t.length-1;n>=0;n--)e.addInt64(t[n]);return e.endVector()}static startDimsVector(e,t){e.startVector(8,t,8)}static endSparseTensor(e){return e.endObject()}static createSparseTensor(e,t,r,i){return n.startSparseTensor(e),n.addValues(e,t),n.addIndices(e,r),n.addDims(e,i),n.endSparseTensor(e)}}t.SparseTensor=n}(t.fbs||(t.fbs={}))}(e.experimental||(e.experimental={}))}(t.onnxruntime||(t.onnxruntime={})),function(e){!function(t){!function(t){class n{constructor(){this.bb=null,this.bb_pos=0}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsAttribute(e,t){return(t||new n).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsAttribute(e,t){return e.setPosition(e.position()+s.flatbuffers.SIZE_PREFIX_LENGTH),(t||new n).__init(e.readInt32(e.position())+e.position(),e)}name(e){let t=this.bb.__offset(this.bb_pos,4);return t?this.bb.__string(this.bb_pos+t,e):null}docString(e){let t=this.bb.__offset(this.bb_pos,6);return t?this.bb.__string(this.bb_pos+t,e):null}type(){let t=this.bb.__offset(this.bb_pos,8);return t?this.bb.readInt32(this.bb_pos+t):e.experimental.fbs.AttributeType.UNDEFINED}f(){let e=this.bb.__offset(this.bb_pos,10);return e?this.bb.readFloat32(this.bb_pos+e):0}i(){let e=this.bb.__offset(this.bb_pos,12);return e?this.bb.readInt64(this.bb_pos+e):this.bb.createLong(0,0)}s(e){let t=this.bb.__offset(this.bb_pos,14);return t?this.bb.__string(this.bb_pos+t,e):null}t(t){let n=this.bb.__offset(this.bb_pos,16);return n?(t||new e.experimental.fbs.Tensor).__init(this.bb.__indirect(this.bb_pos+n),this.bb):null}g(t){let n=this.bb.__offset(this.bb_pos,18);return n?(t||new e.experimental.fbs.Graph).__init(this.bb.__indirect(this.bb_pos+n),this.bb):null}floats(e){let t=this.bb.__offset(this.bb_pos,20);return t?this.bb.readFloat32(this.bb.__vector(this.bb_pos+t)+4*e):0}floatsLength(){let e=this.bb.__offset(this.bb_pos,20);return e?this.bb.__vector_len(this.bb_pos+e):0}floatsArray(){let e=this.bb.__offset(this.bb_pos,20);return e?new Float32Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+e),this.bb.__vector_len(this.bb_pos+e)):null}ints(e){let t=this.bb.__offset(this.bb_pos,22);return t?this.bb.readInt64(this.bb.__vector(this.bb_pos+t)+8*e):this.bb.createLong(0,0)}intsLength(){let e=this.bb.__offset(this.bb_pos,22);return e?this.bb.__vector_len(this.bb_pos+e):0}strings(e,t){let n=this.bb.__offset(this.bb_pos,24);return n?this.bb.__string(this.bb.__vector(this.bb_pos+n)+4*e,t):null}stringsLength(){let e=this.bb.__offset(this.bb_pos,24);return e?this.bb.__vector_len(this.bb_pos+e):0}tensors(t,n){let r=this.bb.__offset(this.bb_pos,26);return r?(n||new e.experimental.fbs.Tensor).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+r)+4*t),this.bb):null}tensorsLength(){let e=this.bb.__offset(this.bb_pos,26);return e?this.bb.__vector_len(this.bb_pos+e):0}graphs(t,n){let r=this.bb.__offset(this.bb_pos,28);return r?(n||new e.experimental.fbs.Graph).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+r)+4*t),this.bb):null}graphsLength(){let e=this.bb.__offset(this.bb_pos,28);return e?this.bb.__vector_len(this.bb_pos+e):0}static startAttribute(e){e.startObject(13)}static addName(e,t){e.addFieldOffset(0,t,0)}static addDocString(e,t){e.addFieldOffset(1,t,0)}static addType(t,n){t.addFieldInt32(2,n,e.experimental.fbs.AttributeType.UNDEFINED)}static addF(e,t){e.addFieldFloat32(3,t,0)}static addI(e,t){e.addFieldInt64(4,t,e.createLong(0,0))}static addS(e,t){e.addFieldOffset(5,t,0)}static addT(e,t){e.addFieldOffset(6,t,0)}static addG(e,t){e.addFieldOffset(7,t,0)}static addFloats(e,t){e.addFieldOffset(8,t,0)}static createFloatsVector(e,t){e.startVector(4,t.length,4);for(let n=t.length-1;n>=0;n--)e.addFloat32(t[n]);return e.endVector()}static startFloatsVector(e,t){e.startVector(4,t,4)}static addInts(e,t){e.addFieldOffset(9,t,0)}static createIntsVector(e,t){e.startVector(8,t.length,8);for(let n=t.length-1;n>=0;n--)e.addInt64(t[n]);return e.endVector()}static startIntsVector(e,t){e.startVector(8,t,8)}static addStrings(e,t){e.addFieldOffset(10,t,0)}static createStringsVector(e,t){e.startVector(4,t.length,4);for(let n=t.length-1;n>=0;n--)e.addOffset(t[n]);return e.endVector()}static startStringsVector(e,t){e.startVector(4,t,4)}static addTensors(e,t){e.addFieldOffset(11,t,0)}static createTensorsVector(e,t){e.startVector(4,t.length,4);for(let n=t.length-1;n>=0;n--)e.addOffset(t[n]);return e.endVector()}static startTensorsVector(e,t){e.startVector(4,t,4)}static addGraphs(e,t){e.addFieldOffset(12,t,0)}static createGraphsVector(e,t){e.startVector(4,t.length,4);for(let n=t.length-1;n>=0;n--)e.addOffset(t[n]);return e.endVector()}static startGraphsVector(e,t){e.startVector(4,t,4)}static endAttribute(e){return e.endObject()}static createAttribute(e,t,r,i,s,a,o,l,u,c,h,d,p,f){return n.startAttribute(e),n.addName(e,t),n.addDocString(e,r),n.addType(e,i),n.addF(e,s),n.addI(e,a),n.addS(e,o),n.addT(e,l),n.addG(e,u),n.addFloats(e,c),n.addInts(e,h),n.addStrings(e,d),n.addTensors(e,p),n.addGraphs(e,f),n.endAttribute(e)}}t.Attribute=n}(t.fbs||(t.fbs={}))}(e.experimental||(e.experimental={}))}(t.onnxruntime||(t.onnxruntime={})),function(e){!function(t){!function(t){class n{constructor(){this.bb=null,this.bb_pos=0}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsGraph(e,t){return(t||new n).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsGraph(e,t){return e.setPosition(e.position()+s.flatbuffers.SIZE_PREFIX_LENGTH),(t||new n).__init(e.readInt32(e.position())+e.position(),e)}initializers(t,n){let r=this.bb.__offset(this.bb_pos,4);return r?(n||new e.experimental.fbs.Tensor).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+r)+4*t),this.bb):null}initializersLength(){let e=this.bb.__offset(this.bb_pos,4);return e?this.bb.__vector_len(this.bb_pos+e):0}nodeArgs(t,n){let r=this.bb.__offset(this.bb_pos,6);return r?(n||new e.experimental.fbs.ValueInfo).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+r)+4*t),this.bb):null}nodeArgsLength(){let e=this.bb.__offset(this.bb_pos,6);return e?this.bb.__vector_len(this.bb_pos+e):0}nodes(t,n){let r=this.bb.__offset(this.bb_pos,8);return r?(n||new e.experimental.fbs.Node).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+r)+4*t),this.bb):null}nodesLength(){let e=this.bb.__offset(this.bb_pos,8);return e?this.bb.__vector_len(this.bb_pos+e):0}maxNodeIndex(){let e=this.bb.__offset(this.bb_pos,10);return e?this.bb.readUint32(this.bb_pos+e):0}nodeEdges(t,n){let r=this.bb.__offset(this.bb_pos,12);return r?(n||new e.experimental.fbs.NodeEdge).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+r)+4*t),this.bb):null}nodeEdgesLength(){let e=this.bb.__offset(this.bb_pos,12);return e?this.bb.__vector_len(this.bb_pos+e):0}inputs(e,t){let n=this.bb.__offset(this.bb_pos,14);return n?this.bb.__string(this.bb.__vector(this.bb_pos+n)+4*e,t):null}inputsLength(){let e=this.bb.__offset(this.bb_pos,14);return e?this.bb.__vector_len(this.bb_pos+e):0}outputs(e,t){let n=this.bb.__offset(this.bb_pos,16);return n?this.bb.__string(this.bb.__vector(this.bb_pos+n)+4*e,t):null}outputsLength(){let e=this.bb.__offset(this.bb_pos,16);return e?this.bb.__vector_len(this.bb_pos+e):0}sparseInitializers(t,n){let r=this.bb.__offset(this.bb_pos,18);return r?(n||new e.experimental.fbs.SparseTensor).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+r)+4*t),this.bb):null}sparseInitializersLength(){let e=this.bb.__offset(this.bb_pos,18);return e?this.bb.__vector_len(this.bb_pos+e):0}static startGraph(e){e.startObject(8)}static addInitializers(e,t){e.addFieldOffset(0,t,0)}static createInitializersVector(e,t){e.startVector(4,t.length,4);for(let n=t.length-1;n>=0;n--)e.addOffset(t[n]);return e.endVector()}static startInitializersVector(e,t){e.startVector(4,t,4)}static addNodeArgs(e,t){e.addFieldOffset(1,t,0)}static createNodeArgsVector(e,t){e.startVector(4,t.length,4);for(let n=t.length-1;n>=0;n--)e.addOffset(t[n]);return e.endVector()}static startNodeArgsVector(e,t){e.startVector(4,t,4)}static addNodes(e,t){e.addFieldOffset(2,t,0)}static createNodesVector(e,t){e.startVector(4,t.length,4);for(let n=t.length-1;n>=0;n--)e.addOffset(t[n]);return e.endVector()}static startNodesVector(e,t){e.startVector(4,t,4)}static addMaxNodeIndex(e,t){e.addFieldInt32(3,t,0)}static addNodeEdges(e,t){e.addFieldOffset(4,t,0)}static createNodeEdgesVector(e,t){e.startVector(4,t.length,4);for(let n=t.length-1;n>=0;n--)e.addOffset(t[n]);return e.endVector()}static startNodeEdgesVector(e,t){e.startVector(4,t,4)}static addInputs(e,t){e.addFieldOffset(5,t,0)}static createInputsVector(e,t){e.startVector(4,t.length,4);for(let n=t.length-1;n>=0;n--)e.addOffset(t[n]);return e.endVector()}static startInputsVector(e,t){e.startVector(4,t,4)}static addOutputs(e,t){e.addFieldOffset(6,t,0)}static createOutputsVector(e,t){e.startVector(4,t.length,4);for(let n=t.length-1;n>=0;n--)e.addOffset(t[n]);return e.endVector()}static startOutputsVector(e,t){e.startVector(4,t,4)}static addSparseInitializers(e,t){e.addFieldOffset(7,t,0)}static createSparseInitializersVector(e,t){e.startVector(4,t.length,4);for(let n=t.length-1;n>=0;n--)e.addOffset(t[n]);return e.endVector()}static startSparseInitializersVector(e,t){e.startVector(4,t,4)}static endGraph(e){return e.endObject()}static createGraph(e,t,r,i,s,a,o,l,u){return n.startGraph(e),n.addInitializers(e,t),n.addNodeArgs(e,r),n.addNodes(e,i),n.addMaxNodeIndex(e,s),n.addNodeEdges(e,a),n.addInputs(e,o),n.addOutputs(e,l),n.addSparseInitializers(e,u),n.endGraph(e)}}t.Graph=n}(t.fbs||(t.fbs={}))}(e.experimental||(e.experimental={}))}(t.onnxruntime||(t.onnxruntime={})),function(e){!function(t){!function(t){class n{constructor(){this.bb=null,this.bb_pos=0}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsModel(e,t){return(t||new n).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsModel(e,t){return e.setPosition(e.position()+s.flatbuffers.SIZE_PREFIX_LENGTH),(t||new n).__init(e.readInt32(e.position())+e.position(),e)}irVersion(){let e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readInt64(this.bb_pos+e):this.bb.createLong(0,0)}opsetImport(t,n){let r=this.bb.__offset(this.bb_pos,6);return r?(n||new e.experimental.fbs.OperatorSetId).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+r)+4*t),this.bb):null}opsetImportLength(){let e=this.bb.__offset(this.bb_pos,6);return e?this.bb.__vector_len(this.bb_pos+e):0}producerName(e){let t=this.bb.__offset(this.bb_pos,8);return t?this.bb.__string(this.bb_pos+t,e):null}producerVersion(e){let t=this.bb.__offset(this.bb_pos,10);return t?this.bb.__string(this.bb_pos+t,e):null}domain(e){let t=this.bb.__offset(this.bb_pos,12);return t?this.bb.__string(this.bb_pos+t,e):null}modelVersion(){let e=this.bb.__offset(this.bb_pos,14);return e?this.bb.readInt64(this.bb_pos+e):this.bb.createLong(0,0)}docString(e){let t=this.bb.__offset(this.bb_pos,16);return t?this.bb.__string(this.bb_pos+t,e):null}graph(t){let n=this.bb.__offset(this.bb_pos,18);return n?(t||new e.experimental.fbs.Graph).__init(this.bb.__indirect(this.bb_pos+n),this.bb):null}graphDocString(e){let t=this.bb.__offset(this.bb_pos,20);return t?this.bb.__string(this.bb_pos+t,e):null}static startModel(e){e.startObject(9)}static addIrVersion(e,t){e.addFieldInt64(0,t,e.createLong(0,0))}static addOpsetImport(e,t){e.addFieldOffset(1,t,0)}static createOpsetImportVector(e,t){e.startVector(4,t.length,4);for(let n=t.length-1;n>=0;n--)e.addOffset(t[n]);return e.endVector()}static startOpsetImportVector(e,t){e.startVector(4,t,4)}static addProducerName(e,t){e.addFieldOffset(2,t,0)}static addProducerVersion(e,t){e.addFieldOffset(3,t,0)}static addDomain(e,t){e.addFieldOffset(4,t,0)}static addModelVersion(e,t){e.addFieldInt64(5,t,e.createLong(0,0))}static addDocString(e,t){e.addFieldOffset(6,t,0)}static addGraph(e,t){e.addFieldOffset(7,t,0)}static addGraphDocString(e,t){e.addFieldOffset(8,t,0)}static endModel(e){return e.endObject()}static createModel(e,t,r,i,s,a,o,l,u,c){return n.startModel(e),n.addIrVersion(e,t),n.addOpsetImport(e,r),n.addProducerName(e,i),n.addProducerVersion(e,s),n.addDomain(e,a),n.addModelVersion(e,o),n.addDocString(e,l),n.addGraph(e,u),n.addGraphDocString(e,c),n.endModel(e)}}t.Model=n}(t.fbs||(t.fbs={}))}(e.experimental||(e.experimental={}))}(t.onnxruntime||(t.onnxruntime={})),function(e){!function(e){!function(e){class t{constructor(){this.bb=null,this.bb_pos=0}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsKernelCreateInfos(e,n){return(n||new t).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsKernelCreateInfos(e,n){return e.setPosition(e.position()+s.flatbuffers.SIZE_PREFIX_LENGTH),(n||new t).__init(e.readInt32(e.position())+e.position(),e)}nodeIndices(e){let t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readUint32(this.bb.__vector(this.bb_pos+t)+4*e):0}nodeIndicesLength(){let e=this.bb.__offset(this.bb_pos,4);return e?this.bb.__vector_len(this.bb_pos+e):0}nodeIndicesArray(){let e=this.bb.__offset(this.bb_pos,4);return e?new Uint32Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+e),this.bb.__vector_len(this.bb_pos+e)):null}kernelDefHashes(e){let t=this.bb.__offset(this.bb_pos,6);return t?this.bb.readUint64(this.bb.__vector(this.bb_pos+t)+8*e):this.bb.createLong(0,0)}kernelDefHashesLength(){let e=this.bb.__offset(this.bb_pos,6);return e?this.bb.__vector_len(this.bb_pos+e):0}static startKernelCreateInfos(e){e.startObject(2)}static addNodeIndices(e,t){e.addFieldOffset(0,t,0)}static createNodeIndicesVector(e,t){e.startVector(4,t.length,4);for(let n=t.length-1;n>=0;n--)e.addInt32(t[n]);return e.endVector()}static startNodeIndicesVector(e,t){e.startVector(4,t,4)}static addKernelDefHashes(e,t){e.addFieldOffset(1,t,0)}static createKernelDefHashesVector(e,t){e.startVector(8,t.length,8);for(let n=t.length-1;n>=0;n--)e.addInt64(t[n]);return e.endVector()}static startKernelDefHashesVector(e,t){e.startVector(8,t,8)}static endKernelCreateInfos(e){return e.endObject()}static createKernelCreateInfos(e,n,r){return t.startKernelCreateInfos(e),t.addNodeIndices(e,n),t.addKernelDefHashes(e,r),t.endKernelCreateInfos(e)}}e.KernelCreateInfos=t}(e.fbs||(e.fbs={}))}(e.experimental||(e.experimental={}))}(t.onnxruntime||(t.onnxruntime={})),function(e){!function(t){!function(t){class n{constructor(){this.bb=null,this.bb_pos=0}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsSubGraphSessionState(e,t){return(t||new n).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsSubGraphSessionState(e,t){return e.setPosition(e.position()+s.flatbuffers.SIZE_PREFIX_LENGTH),(t||new n).__init(e.readInt32(e.position())+e.position(),e)}graphId(e){let t=this.bb.__offset(this.bb_pos,4);return t?this.bb.__string(this.bb_pos+t,e):null}sessionState(t){let n=this.bb.__offset(this.bb_pos,6);return n?(t||new e.experimental.fbs.SessionState).__init(this.bb.__indirect(this.bb_pos+n),this.bb):null}static startSubGraphSessionState(e){e.startObject(2)}static addGraphId(e,t){e.addFieldOffset(0,t,0)}static addSessionState(e,t){e.addFieldOffset(1,t,0)}static endSubGraphSessionState(e){let t=e.endObject();return e.requiredField(t,4),t}static createSubGraphSessionState(e,t,r){return n.startSubGraphSessionState(e),n.addGraphId(e,t),n.addSessionState(e,r),n.endSubGraphSessionState(e)}}t.SubGraphSessionState=n}(t.fbs||(t.fbs={}))}(e.experimental||(e.experimental={}))}(t.onnxruntime||(t.onnxruntime={})),function(e){!function(t){!function(t){class n{constructor(){this.bb=null,this.bb_pos=0}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsSessionState(e,t){return(t||new n).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsSessionState(e,t){return e.setPosition(e.position()+s.flatbuffers.SIZE_PREFIX_LENGTH),(t||new n).__init(e.readInt32(e.position())+e.position(),e)}kernels(t){let n=this.bb.__offset(this.bb_pos,4);return n?(t||new e.experimental.fbs.KernelCreateInfos).__init(this.bb.__indirect(this.bb_pos+n),this.bb):null}subGraphSessionStates(t,n){let r=this.bb.__offset(this.bb_pos,6);return r?(n||new e.experimental.fbs.SubGraphSessionState).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+r)+4*t),this.bb):null}subGraphSessionStatesLength(){let e=this.bb.__offset(this.bb_pos,6);return e?this.bb.__vector_len(this.bb_pos+e):0}static startSessionState(e){e.startObject(2)}static addKernels(e,t){e.addFieldOffset(0,t,0)}static addSubGraphSessionStates(e,t){e.addFieldOffset(1,t,0)}static createSubGraphSessionStatesVector(e,t){e.startVector(4,t.length,4);for(let n=t.length-1;n>=0;n--)e.addOffset(t[n]);return e.endVector()}static startSubGraphSessionStatesVector(e,t){e.startVector(4,t,4)}static endSessionState(e){return e.endObject()}static createSessionState(e,t,r){return n.startSessionState(e),n.addKernels(e,t),n.addSubGraphSessionStates(e,r),n.endSessionState(e)}}t.SessionState=n}(t.fbs||(t.fbs={}))}(e.experimental||(e.experimental={}))}(t.onnxruntime||(t.onnxruntime={})),function(e){!function(t){!function(t){class n{constructor(){this.bb=null,this.bb_pos=0}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsInferenceSession(e,t){return(t||new n).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsInferenceSession(e,t){return e.setPosition(e.position()+s.flatbuffers.SIZE_PREFIX_LENGTH),(t||new n).__init(e.readInt32(e.position())+e.position(),e)}static bufferHasIdentifier(e){return e.__has_identifier("ORTM")}ortVersion(e){let t=this.bb.__offset(this.bb_pos,4);return t?this.bb.__string(this.bb_pos+t,e):null}model(t){let n=this.bb.__offset(this.bb_pos,6);return n?(t||new e.experimental.fbs.Model).__init(this.bb.__indirect(this.bb_pos+n),this.bb):null}sessionState(t){let n=this.bb.__offset(this.bb_pos,8);return n?(t||new e.experimental.fbs.SessionState).__init(this.bb.__indirect(this.bb_pos+n),this.bb):null}static startInferenceSession(e){e.startObject(3)}static addOrtVersion(e,t){e.addFieldOffset(0,t,0)}static addModel(e,t){e.addFieldOffset(1,t,0)}static addSessionState(e,t){e.addFieldOffset(2,t,0)}static endInferenceSession(e){return e.endObject()}static finishInferenceSessionBuffer(e,t){e.finish(t,"ORTM")}static finishSizePrefixedInferenceSessionBuffer(e,t){e.finish(t,"ORTM",!0)}static createInferenceSession(e,t,r,i){return n.startInferenceSession(e),n.addOrtVersion(e,t),n.addModel(e,r),n.addSessionState(e,i),n.endInferenceSession(e)}}t.InferenceSession=n}(t.fbs||(t.fbs={}))}(e.experimental||(e.experimental={}))}(t.onnxruntime||(t.onnxruntime={}))},7448:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.OnnxjsSessionHandler=void 0;let r=n(1670),i=n(9162);t.OnnxjsSessionHandler=class{constructor(e){this.session=e,this.inputNames=this.session.inputNames,this.outputNames=this.session.outputNames}async dispose(){}async run(e,t,n){let s=new Map;for(let t in e)if(Object.hasOwnProperty.call(e,t)){let n=e[t];s.set(t,new i.Tensor(n.dims,n.type,void 0,void 0,n.data))}let a=await this.session.run(s),o={};return a.forEach((e,t)=>{o[t]=new r.Tensor(e.type,e.data,e.dims)}),o}startProfiling(){this.session.startProfiling()}endProfiling(){this.session.endProfiling()}}},6919:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Session=void 0;let r=n(7067),i=n(1296),s=n(7091),a=n(1036),o=n(6231),l=n(2644);t.Session=class{constructor(e={}){this._initialized=!1,this.backendHint=e.backendHint,this.profiler=o.Profiler.create(e.profiler),this.context={profiler:this.profiler,graphInputTypes:[],graphInputDims:[]}}get inputNames(){return this._model.graph.getInputNames()}get outputNames(){return this._model.graph.getOutputNames()}startProfiling(){this.profiler.start()}endProfiling(){this.profiler.stop()}async loadModel(e,t,n){await this.profiler.event("session","Session.loadModel",async()=>{let a=await (0,s.resolveBackend)(this.backendHint);if(this.sessionHandler=a.createSessionHandler(this.context),this._model=new l.Model,"string"==typeof e){let t=e.endsWith(".ort");if("undefined"==typeof fetch){let n=await (0,i.promisify)(r.readFile)(e);this.initialize(n,t)}else{let n=await fetch(e),r=await n.arrayBuffer();this.initialize(new Uint8Array(r),t)}}else if(ArrayBuffer.isView(e))this.initialize(e);else{let r=new Uint8Array(e,t||0,n||e.byteLength);this.initialize(r)}})}initialize(e,t){if(this._initialized)throw Error("already initialized");this.profiler.event("session","Session.initialize",()=>{let n=this.sessionHandler.transformGraph?this.sessionHandler:void 0;this._model.load(e,n,t),this.sessionHandler.onGraphInitialized&&this.sessionHandler.onGraphInitialized(this._model.graph),this.initializeOps(this._model.graph),this._executionPlan=new a.ExecutionPlan(this._model.graph,this._ops,this.profiler)}),this._initialized=!0}async run(e){if(!this._initialized)throw Error("session not initialized yet");return this.profiler.event("session","Session.run",async()=>{let t=this.normalizeAndValidateInputs(e),n=await this._executionPlan.execute(this.sessionHandler,t);return this.createOutput(n)})}normalizeAndValidateInputs(e){let t=this._model.graph.getInputNames();if(Array.isArray(e)){if(e.length!==t.length)throw Error(`incorrect input array length: expected ${t.length} but got ${e.length}`)}else{if(e.size!==t.length)throw Error(`incorrect input map size: expected ${t.length} but got ${e.size}`);let n=Array(e.size),r=0;for(let i=0;i<t.length;++i){let s=e.get(t[i]);if(!s)throw Error(`missing input tensor for: '${name}'`);n[r++]=s}e=n}if(this.context.graphInputTypes&&0!==this.context.graphInputTypes.length&&this.context.graphInputDims&&0!==this.context.graphInputDims.length)this.validateInputTensorDims(this.context.graphInputDims,e,!1);else{let t=this._model.graph.getInputIndices(),n=this._model.graph.getValues(),r=Array(t.length);for(let i=0;i<t.length;++i){let s=n[t[i]];r[i]=s.type.shape.dims,this.context.graphInputTypes.push(s.type.tensorType),this.context.graphInputDims.push(e[i].dims)}this.validateInputTensorDims(r,e,!0)}return this.validateInputTensorTypes(this.context.graphInputTypes,e),e}validateInputTensorTypes(e,t){for(let n=0;n<t.length;n++){let r=e[n],i=t[n].type;if(r!==i)throw Error(`input tensor[${n}] check failed: expected type '${r}' but got ${i}`)}}validateInputTensorDims(e,t,n){for(let r=0;r<t.length;r++){let i=e[r],s=t[r].dims;if(!this.compareTensorDims(i,s,n))throw Error(`input tensor[${r}] check failed: expected shape '[${i.join(",")}]' but got [${s.join(",")}]`)}}compareTensorDims(e,t,n){if(e.length!==t.length)return!1;for(let r=0;r<e.length;++r)if(e[r]!==t[r]&&(!n||0!==e[r]))return!1;return!0}createOutput(e){let t=this._model.graph.getOutputNames();if(e.length!==t.length)throw Error("expected number of outputs do not match number of generated outputs");let n=new Map;for(let r=0;r<t.length;++r)n.set(t[r],e[r]);return n}initializeOps(e){let t=e.getNodes();this._ops=Array(t.length);for(let n=0;n<t.length;n++)this._ops[n]=this.sessionHandler.resolve(t[n],this._model.opsets,e)}}},9162:function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Tensor=void 0;let i=n(3442),s=r(n(3720)),a=n(1446),o=n(9395),l=n(2517);var u=o.onnxruntime.experimental.fbs;class c{get data(){if(void 0===this.cache){let e=this.dataProvider(this.dataId);if(e.length!==this.size)throw Error("Length of data provided by the Data Provider is inconsistent with the dims of this Tensor.");this.cache=e}return this.cache}get stringData(){if("string"!==this.type)throw TypeError("data type is not string");return this.data}get integerData(){switch(this.type){case"uint8":case"int8":case"uint16":case"int16":case"int32":case"uint32":case"bool":return this.data;default:throw TypeError("data type is not integer (uint8, int8, uint16, int16, int32, uint32, bool)")}}get floatData(){switch(this.type){case"float32":case"float64":return this.data;default:throw TypeError("data type is not float (float32, float64)")}}get numberData(){if("string"!==this.type)return this.data;throw TypeError("type cannot be non-number (string)")}get(e){return this.data[l.ShapeUtil.indicesToOffset(e,this.strides)]}set(e,t){this.data[l.ShapeUtil.indicesToOffset(e,this.strides)]=t}async getData(){return void 0===this.cache&&(this.cache=await this.asyncDataProvider(this.dataId)),this.cache}get strides(){return this._strides||(this._strides=l.ShapeUtil.computeStrides(this.dims)),this._strides}constructor(e,t,n,r,s,a=i.Guid.create()){this.dims=e,this.type=t,this.dataProvider=n,this.asyncDataProvider=r,this.cache=s,this.dataId=a,this.size=l.ShapeUtil.validateDimsAndCalcSize(e);let o=this.size,u=void 0===n&&void 0===r&&void 0===s;if(void 0!==s&&s.length!==o)throw RangeError("Input dims doesn't match data length.");if("string"===t){if(!(void 0===s||Array.isArray(s)&&s.every(e=>"string"==typeof e)))throw TypeError("cache should be a string array");u&&(this.cache=Array(o))}else{if(void 0!==s){let e=d(t);if(!(s instanceof e))throw TypeError(`cache should be type ${e.name}`)}if(u){let e=new ArrayBuffer(o*function(e){switch(e){case"bool":case"int8":case"uint8":return 1;case"int16":case"uint16":return 2;case"int32":case"uint32":case"float32":return 4;case"float64":return 8;default:throw Error(`cannot calculate sizeof() on type ${e}`)}}(t));this.cache=function(e,t){return new(d(t))(e)}(e,t)}}}static fromProto(e){if(!e)throw Error("cannot construct Value from an empty tensor");let t=l.ProtoUtil.tensorDataTypeFromProto(e.dataType),n=new c(l.ProtoUtil.tensorDimsFromProto(e.dims),t);if("string"===t)e.stringData.forEach((e,t)=>{n.data[t]=(0,l.decodeUtf8String)(e)});else if(e.rawData&&"number"==typeof e.rawData.byteLength&&e.rawData.byteLength>0){let t=n.data,r=new DataView(e.rawData.buffer,e.rawData.byteOffset,e.rawData.byteLength),i=h(e.dataType),s=e.rawData.byteLength/i;if(e.rawData.byteLength%i!=0)throw Error("invalid buffer length");if(t.length!==s)throw Error("buffer length mismatch");for(let n=0;n<s;n++){let s=f(r,e.dataType,n*i);t[n]=s}}else{let t;switch(e.dataType){case a.onnx.TensorProto.DataType.FLOAT:t=e.floatData;break;case a.onnx.TensorProto.DataType.INT32:case a.onnx.TensorProto.DataType.INT16:case a.onnx.TensorProto.DataType.UINT16:case a.onnx.TensorProto.DataType.INT8:case a.onnx.TensorProto.DataType.UINT8:case a.onnx.TensorProto.DataType.BOOL:t=e.int32Data;break;case a.onnx.TensorProto.DataType.INT64:t=e.int64Data;break;case a.onnx.TensorProto.DataType.DOUBLE:t=e.doubleData;break;case a.onnx.TensorProto.DataType.UINT32:case a.onnx.TensorProto.DataType.UINT64:t=e.uint64Data;break;default:throw Error("unspecific error")}if(null==t)throw Error("failed to populate data from a tensorproto value");let r=n.data;if(r.length!==t.length)throw Error("array length mismatch");for(let n=0;n<t.length;n++){let i=t[n];s.default.isLong(i)?r[n]=p(i,e.dataType):r[n]=i}}return n}static fromData(e,t,n){return new c(t,n,void 0,void 0,e)}static fromOrtTensor(e){if(!e)throw Error("cannot construct Value from an empty tensor");let t=l.ProtoUtil.tensorDimsFromORTFormat(e),n=l.ProtoUtil.tensorDataTypeFromProto(e.dataType()),r=new c(t,n);if("string"===n)for(let t=0;t<e.stringDataLength();t++)r.data[t]=e.stringData(t);else if(e.rawDataArray()&&"number"==typeof e.rawDataLength()&&e.rawDataLength()>0){let t=r.data,n=new DataView(e.rawDataArray().buffer,e.rawDataArray().byteOffset,e.rawDataLength()),i=h(e.dataType()),s=e.rawDataLength()/i;if(e.rawDataLength()%i!=0)throw Error("invalid buffer length");if(t.length!==s)throw Error("buffer length mismatch");for(let r=0;r<s;r++){let s=f(n,e.dataType(),r*i);t[r]=s}}return r}}function h(e){switch(e){case a.onnx.TensorProto.DataType.UINT8:case a.onnx.TensorProto.DataType.INT8:case a.onnx.TensorProto.DataType.BOOL:return 1;case a.onnx.TensorProto.DataType.UINT16:case a.onnx.TensorProto.DataType.INT16:return 2;case a.onnx.TensorProto.DataType.FLOAT:case a.onnx.TensorProto.DataType.INT32:case a.onnx.TensorProto.DataType.UINT32:return 4;case a.onnx.TensorProto.DataType.INT64:case a.onnx.TensorProto.DataType.DOUBLE:case a.onnx.TensorProto.DataType.UINT64:return 8;default:throw Error(`cannot calculate sizeof() on type ${a.onnx.TensorProto.DataType[e]}`)}}function d(e){switch(e){case"bool":case"uint8":return Uint8Array;case"int8":return Int8Array;case"int16":return Int16Array;case"uint16":return Uint16Array;case"int32":return Int32Array;case"uint32":return Uint32Array;case"float32":return Float32Array;case"float64":return Float64Array;default:throw Error("unspecified error")}}function p(e,t){if(t===a.onnx.TensorProto.DataType.INT64||t===u.TensorDataType.INT64){if(e.greaterThanOrEqual(0x80000000)||e.lessThan(-0x80000000))throw TypeError("int64 is not supported")}else{if(t!==a.onnx.TensorProto.DataType.UINT32&&t!==u.TensorDataType.UINT32&&t!==a.onnx.TensorProto.DataType.UINT64&&t!==u.TensorDataType.UINT64)throw TypeError(`not a LONG type: ${a.onnx.TensorProto.DataType[t]}`);if(e.greaterThanOrEqual(0x100000000)||e.lessThan(0))throw TypeError("uint64 is not supported")}return e.toNumber()}function f(e,t,n){switch(t){case a.onnx.TensorProto.DataType.BOOL:case a.onnx.TensorProto.DataType.UINT8:return e.getUint8(n);case a.onnx.TensorProto.DataType.INT8:return e.getInt8(n);case a.onnx.TensorProto.DataType.UINT16:return e.getUint16(n,!0);case a.onnx.TensorProto.DataType.INT16:return e.getInt16(n,!0);case a.onnx.TensorProto.DataType.FLOAT:return e.getFloat32(n,!0);case a.onnx.TensorProto.DataType.INT32:return e.getInt32(n,!0);case a.onnx.TensorProto.DataType.UINT32:return e.getUint32(n,!0);case a.onnx.TensorProto.DataType.INT64:return p(s.default.fromBits(e.getUint32(n,!0),e.getUint32(n+4,!0),!1),t);case a.onnx.TensorProto.DataType.DOUBLE:return e.getFloat64(n,!0);case a.onnx.TensorProto.DataType.UINT64:return p(s.default.fromBits(e.getUint32(n,!0),e.getUint32(n+4,!0),!0),t);default:throw Error(`cannot read from DataView for type ${a.onnx.TensorProto.DataType[t]}`)}}t.Tensor=c},2517:function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.decodeUtf8String=t.MAX_CLIP=t.MIN_CLIP=t.PoolConvUtil=t.ReduceUtil=t.SplitUtil=t.MathUtil=t.ShapeUtil=t.LongUtil=t.ProtoUtil=t.GemmUtil=t.arrayCopyHelper=t.BroadcastUtil=t.MatMulUtil=t.ArrayUtil=t.assert=t.checkInputsShape=void 0;let i=n(5686),s=r(n(3720)),a=n(1446),o=n(9162);t.checkInputsShape=function(e,...t){if(!e||e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(!e[n].dims||e[n].dims.length!==t[n])return!1;return!0},t.assert=function(e,t){if(!e)throw Error("string"==typeof t?t:t())},t.ArrayUtil=class{static arraysEqual(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}};class l{static preprocessInputShapes(e,t){return[1===e.length?[1,e[0]]:e,1===t.length?[t[0],1]:t]}static postprocessOutputShape(e,t,n){1===t&&e.splice(e.length-2,1),1===n&&e.pop()}static calcMatMulShape(e,t){return e[1]!==t[0]?void 0:[e[0],t[1]]}}t.MatMulUtil=l;class u{static calcShape(e,t,n=!1){let r=e.length,i=t.length;if(0===r)return t;if(0===i)return e;let s=Math.max(e.length,t.length),a=Array(s);if(n){if(r<2||i<2)return;let n=l.calcMatMulShape([e[r-2],e[r-1]],[t[i-2],t[i-1]]);if(void 0===n)return;[a[s-2],a[s-1]]=n}for(let o=n?3:1;o<=s;o++){let n=r-o<0?1:e[r-o],l=i-o<0?1:t[i-o];if(n!==l&&n>1&&l>1)return;a[s-o]=Math.max(n,l)}return a}static index(e,t){let n=Array(t.length);return u.fillIndex(e,t,n),n}static fillIndex(e,t,n){let r=e.length-t.length;for(let i=0;i<t.length;i++)n[i]=e[r+i]%t[i]}static calc(e,t,n,r,i){let s=u.calcShape(e.dims,t.dims);if(s){if(r&&!d.areEqual(s,e.dims))return;let a=d.size(s),l=r?e:new o.Tensor(s,i||e.type);if(0===s.length)l.set([],n(e.get([]),t.get([])));else{let r=Array(s.length),i=Array(e.dims.length),o=Array(t.dims.length),c,h=0,d=0,p=!1,f=!1;0===e.dims.length&&(h=e.get([]),p=!0),0===t.dims.length&&(d=t.get([]),f=!0);for(let g=0;g<a;g++){c=g;for(let e=s.length-1;e>=0;e--)r[e]=c%s[e],c=Math.floor(c/s[e]);p||(u.fillIndex(r,e.dims,i),h=e.get(i)),f||(u.fillIndex(r,t.dims,o),d=t.get(o)),l.set(r,n(h,d))}}return l}}static isValidBroadcast(e,t){let n=e.length,r=t.length;if(n>r)return!1;for(let i=1;i<=n;i++)if(1!==e[n-i]&&e[n-i]!==t[r-i])return!1;return!0}static getBroadcastDims(e,t){let n=e.length,r=[];for(let i=0;i<n;i++){let s=n-1-i,a=e[s]||1;(t[t.length-1-i]||1)>1&&1===a&&r.unshift(s)}return r}}t.BroadcastUtil=u,t.arrayCopyHelper=function(e,t,n,r,i){if(r<0||r>=t.length)throw Error("sourceIndex out of bounds");if(n<0||n>=e.length)throw Error("targetIndex out of bounds");if(r+i>t.length)throw Error("source indices to be copied are outside bounds");if(n+i>e.length)throw Error("target array is too small to hold result");for(let s=0;s<i;s++)e[n+s]=t[r+s]},t.GemmUtil=class{static getShapeOfGemmResult(e,t,n,r,i){let s,a,o;if(2!==e.length||2!==n.length)throw Error("shape need to be of size 2");t?(s=e[1],a=e[0]):(s=e[0],a=e[1]);let l=-1;if(r?(o=n[0],l=1):(o=n[1],l=0),n[l]!==a)throw Error("dimension mismatch");if(s<=0||o<=0||a<=0)throw Error("invalid shape specified");if(i&&!u.isValidBroadcast(i,[s,o]))throw Error("gemm: invalid bias shape for broadcast");return[s,o,a]}};class c{static tensorDataTypeFromProto(e){switch(e){case a.onnx.TensorProto.DataType.INT8:return"int8";case a.onnx.TensorProto.DataType.UINT8:return"uint8";case a.onnx.TensorProto.DataType.BOOL:return"bool";case a.onnx.TensorProto.DataType.INT16:return"int16";case a.onnx.TensorProto.DataType.UINT16:return"uint16";case a.onnx.TensorProto.DataType.INT32:return"int32";case a.onnx.TensorProto.DataType.UINT32:return"uint32";case a.onnx.TensorProto.DataType.FLOAT:return"float32";case a.onnx.TensorProto.DataType.DOUBLE:return"float64";case a.onnx.TensorProto.DataType.STRING:return"string";case a.onnx.TensorProto.DataType.INT64:return"int32";case a.onnx.TensorProto.DataType.UINT64:return"uint32";default:throw Error(`unsupported data type: ${a.onnx.TensorProto.DataType[e]}`)}}static tensorDataTypeStringToEnum(e){switch(e){case"int8":return a.onnx.TensorProto.DataType.INT8;case"uint8":return a.onnx.TensorProto.DataType.UINT8;case"bool":return a.onnx.TensorProto.DataType.BOOL;case"int16":return a.onnx.TensorProto.DataType.INT16;case"uint16":return a.onnx.TensorProto.DataType.UINT16;case"int32":return a.onnx.TensorProto.DataType.INT32;case"uint32":return a.onnx.TensorProto.DataType.UINT32;case"float32":return a.onnx.TensorProto.DataType.FLOAT;case"float64":return a.onnx.TensorProto.DataType.DOUBLE;case"string":return a.onnx.TensorProto.DataType.STRING;case"int64":return a.onnx.TensorProto.DataType.INT64;case"uint64":return a.onnx.TensorProto.DataType.UINT64;default:throw Error(`unsupported data type: ${e}`)}}static tensorDimsFromProto(e){return e.map(e=>s.default.isLong(e)?e.toNumber():e)}static tensorValueTypeFromProto(e){return{tensorType:c.tensorDataTypeFromProto(e.elemType),shape:{dims:c.tensorDimsFromProto(e.shape.dim.map(e=>e.dimValue))}}}static tensorDimsFromORTFormat(e){let t=[];for(let n=0;n<e.dimsLength();n++)t.push(h.longToNumber(e.dims(n)));return t}static tensorAttributesFromORTFormat(e){let t=[];for(let n=0;n<e.attributesLength();n++)t.push(e.attributes(n));return t}}t.ProtoUtil=c;class h{static longToNumber(e,t){return s.default.isLong(e)?e.toNumber():e instanceof i.flatbuffers.Long?s.default.fromValue({low:e.low,high:e.high,unsigned:null!=t&&t}).toNumber():e}static isLong(e){return s.default.isLong(e)||e instanceof i.flatbuffers.Long}}t.LongUtil=h;class d{static size(e){return d.getSizeFromDimensionRange(e,0,e.length)}static sizeFromDimension(e,t){if(t<0||t>e.length)throw Error(`invalid dimension of ${t} for sizeFromDimension as Tensor has ${e.length} dimensions.`);return d.getSizeFromDimensionRange(e,t,e.length)}static sizeToDimension(e,t){if(t<0||t>e.length)throw Error(`invalid dimension of ${t} for sizeToDimension as Tensor has ${e.length} dimensions.`);return d.getSizeFromDimensionRange(e,0,t)}static getSizeFromDimensionRange(e,t,n){let r=1;for(let i=t;i<n;i++){if(e[i]<=0)throw Error("cannot get valid size from specified dimension range. Most likely the range contains 0 or negative values in them.");r*=e[i]}return r}static computeStrides(e){let t=e.length;if(0===t)return[];if(1===t)return[1];let n=Array(t);n[t-1]=1,n[t-2]=e[t-1];for(let r=t-3;r>=0;--r)n[r]=n[r+1]*e[r+1];return n}static transpose(e){return e.slice().reverse()}static indicesToOffset(e,t,n){void 0===n&&(n=e.length);let r=0;for(let i=0;i<n;++i)r+=t[i]*e[i];return r}static offsetToIndices(e,t){let n=t.length;if(0===n)return[];if(1===n)return[e*t[0]];let r=Array(t.length);for(let n=0;n<r.length-1;++n)r[n]=Math.floor(e/t[n]),e-=r[n]*t[n];return r[r.length-1]=e,r}static normalizeAxis(e,t){if(e<-t&&e>=t)throw Error("unsupported axis for this operation.");return e<0?e+t:e}static normalizeAxes(e,t){return e.map(e=>this.normalizeAxis(e,t))}static incrementIndex(e,t,n){if(0===t.length||0===e.length)throw Error("Index incrementing unsupported for scalar Tensor");if(void 0===n)n=t.length;else if(n<=0||n>t.length)throw Error("Incorrect axis to increment on");for(let r=n-1;r>=0&&(e[r]++,!(e[r]<t[r]));--r)e[r]=0}static calculateReshapedDims(e,t){if(0===t.length){if(0===e.length||1===d.size(e))return[];throw Error("cannot reshape to a scalar Tensor")}let n=t.length,r=Array(n),i=-1,s=1;for(let a=0;a<n;a++){if(t[a]<-1)throw Error("a dimension in shape hints cannot be less than -1");if(-1===t[a]){if(-1!==i)throw Error("at most one dimension in shape hints can be -1");i=a}else{if(0===t[a]){if(a>=e.length)throw Error("the dimension with value zero exceeds the dimension size of the input tensor");r[a]=e[a]}else r[a]=t[a];s*=r[a]}}let a=d.size(e);if(-1!==i){if(a%s!=0)throw Error(`the input tensor cannot be reshaped to the requested shape. Input shape: [${e}] Output shape: [${t}]`);r[i]=a/s}else if(s!==a)throw Error("reshapedDims and originalDims don't have matching sizes");return r}static sortBasedOnPerm(e,t){return t?t.map(t=>e[t]):e.slice().reverse()}static padShape(e,t){let n=e.length;return e.map((e,r)=>e+t[r]+t[r+n])}static areEqual(e,t){return e.length===t.length&&e.every((e,n)=>e===t[n])}static validateDimsAndCalcSize(e){if(e.length>6)throw TypeError("Only rank 0 to 6 is supported for tensor shape.");let t=1;for(let n of e){if(!Number.isInteger(n))throw TypeError(`Invalid shape: ${n} is not an integer`);if(n<0||n>0x7fffffff)throw TypeError(`Invalid shape: length ${n} is not allowed`);t*=n}return t}static flattenShape(e,t){t<0&&(t+=e.length);let n=e.reduce((e,t)=>e*t,1),r=e.slice(t).reduce((e,t)=>e*t,1);return[n/r,r]}static squeezeShape(e,t){let n=[];t=d.normalizeAxes(t,e.length);for(let r=0;r<e.length;r++){let i=t.indexOf(r)>=0;if(i&&1!==e[r])throw Error("squeeze an axis of size different than 1");(0===t.length&&e[r]>1||t.length>0&&!i)&&n.push(e[r])}return n}static unsqueezeShape(e,t){let n=Array(e.length+t.length);n.fill(0);for(let e=0;e<t.length;e++){let r=d.normalizeAxis(t[e],n.length);if(r>=n.length)throw Error("'axes' has an out of range axis");if(0!==n[r])throw Error("'axes' has a duplicate axis");n[r]=1}let r=0;for(let t=0;t<n.length;t++)0===n[t]&&(n[t]=e[r++]);if(r!==e.length)throw Error("the unsqueezed dimension could not be established");return n}}t.ShapeUtil=d,t.MathUtil=class{static sqr(e,t,n,r,i){if(r<0||r>=t.length)throw Error("sourceIndex out of bounds");if(n<0||n>=e.length)throw Error("targetIndex out of bounds");if(r+i>t.length)throw Error("source indices to be copied are outside bounds");if(n+i>e.length)throw Error("target array is too small to hold result");for(let s=0;s<i;s++)e[n+s]+=Math.pow(t[r+s],2)}static axpy(e,t,n,r,i,s){if(r<0||r>=t.length)throw Error("sourceIndex out of bounds");if(n<0||n>=e.length)throw Error("targetIndex out of bounds");if(r+i>t.length)throw Error("source indices to be copied are outside bounds");if(n+i>e.length)throw Error("target array is too small to hold result");for(let a=0;a<i;a++)e[n+a]+=s*t[r+a]}static powx(e,t,n,r,i,s){if(r<0||r>=t.length)throw Error("sourceIndex out of bounds");if(n<0||n>=e.length)throw Error("targetIndex out of bounds");if(r+i>t.length)throw Error("source indices to be copied are outside bounds");if(n+i>e.length)throw Error("target array is too small to hold result");for(let a=0;a<i;a++)e[n+a]=Math.pow(t[r+a],s)}static mul(e,t,n,r,i){if(r<0||r>=t.length)throw Error("sourceIndex out of bounds");if(n<0||n>=e.length)throw Error("targetIndex out of bounds");if(r+i>t.length)throw Error("source indices to be copied are outside bounds");if(n+i>e.length)throw Error("target array is too small to hold result");for(let s=0;s<i;s++)e[n+s]=t[r+s]*e[n+s]}};class p{static splitShape(e,t,n,r){if(0===n.length){if(!r)throw Error("need to know number of outputs when the 'split' attribute is not specified");p.determineSplit(e[t],r,n)}let i=[],s=[0];for(let r=0;r<n.length;++r){0!==r&&s.push(s[r-1]+n[r-1]);let a=e.slice();a[t]=n[r],i.push(a)}return[i,s]}static determineSplit(e,t,n){if(e%t!=0)throw Error("cannot split tensor to equal sized parts");for(let r=0;r<t;++r)n.push(e/t)}}t.SplitUtil=p;class f{static calcReduce(e,t,n,r,i){let s=e.dims.slice(0);0===t.length&&s.forEach((e,n)=>t.push(n));let a=f.calcReduceShape(s,t,!0),l=d.size(a),c=new o.Tensor(a,e.type),h=d.computeStrides(a),p=d.computeStrides(s),g=Array(s.length);for(let n=0;n<l;n++){let a=d.offsetToIndices(n,h);u.fillIndex(a,s,g),c.set(a,f.calcReduceByAxis(e.numberData,t,s,0,d.indicesToOffset(g,p),r,i))}return n?c:new o.Tensor(f.calcReduceShape(s,t,n),c.type,void 0,void 0,c.data,c.dataId)}static calcReduceByAxis(e,t,n,r,i,s,a){let o=0;if(r>=t.length)return s(e[i]);let l=t[r],u=l>=n.length?1:d.size(n.slice(l+1));for(let c=0;c<n[l];c++)o=0===c?f.calcReduceByAxis(e,t,n,r+1,i,s,a):a(o,f.calcReduceByAxis(e,t,n,r+1,i,s,a)),i+=u;return o}static calcReduceShape(e,t,n){let r=e.slice();for(let e=0;e<t.length;e++)r[t[e]]=n?1:0;return r.filter(e=>0!==e)}}t.ReduceUtil=f;class g{static adjustPoolAttributes(e,t,n,r,i,s){if(!e&&n.length!==t.length-2)throw Error("length of specified kernel shapes should be 2 less than length of input dimensions");if(e)for(let e=0;e<t.length-2;e++)e>=n.length?n.push(t[e+2]):n[e]=t[e+2];for(let e=0;e<n.length;e++)if(e<r.length){if(r[e]<0)throw Error("strides should be greater than or equal to 1")}else r.push(1);for(let e=0;e<n.length;e++)if(e<i.length){if(i[e]<0)throw Error("dilations should be greater than or equal to 1")}else i.push(1);for(let e=0;e<2*n.length;e++)if(e<s.length){if(s[e]<0)throw Error("pad should be greater than or equal to 1")}else s.push(0);for(let e=0;e<n.length;e++){if(n[e]<=0)throw Error("kernel shapes need to be greater than 0");if(s[e]>=n[e]||s[e+n.length]>=n[e])throw Error("pads should be smaller than kernel")}}static adjustPadsBasedOnAutoPad(e,t,n,r,i,s){if(s){if(i.length!==2*(e.length-2))throw Error("length of pads should be twice the length of data dimensions");if(t.length!==e.length-2)throw Error("length of strides should be the length of data dimensions");if(r.length!==e.length-2)throw Error("length of kernel shapes should be the length of data dimensions");for(let a=0;a<e.length-2;a++)g.adjustPadAndReturnShape(e[a+2],t[a],n[a],r[a],i,a,a+e.length-2,s)}}static computePoolOutputShape(e,t,n,r,i,s,a){if(t.length<=0)throw Error("input shape must be of size greater than 0");let o=[t[0],t[1]];return g.computeShapeHelper(e,t,o,n,r,i,s,a),o}static computeConvOutputShape(e,t,n,r,i,s,a){if(e.length<=0||t.length<=0)throw Error("invalid input tensor dims or invalid filter tensor dims");let o=[e[0],t[0]];return g.computeShapeHelper(!1,e,o,n,r,i,s,a),o}static computeShapeHelper(e,t,n,r,i,s,a,o){if(e)for(let e=0;e<t.length-2;e++)n.push(1);else for(let e=0;e<t.length-2;e++)n.push(g.adjustPadAndReturnShape(t[e+2],r[e],i[e],s[e],a,e,e+t.length-2,o))}static adjustPadAndReturnShape(e,t,n,r,i,s,a,o){let l=n*(r-1)+1;if(!o||"NOTSET"===o)return Math.floor((e+i[s]+i[a]-l)/t+1);switch(o){case"VALID":return i[s]=0,i[a]=0,Math.floor((e-l)/t+1);case"SAME_LOWER":case"SAME_UPPER":if(1!==n)throw Error("Dilation not supported for SAME_UPPER or SAME_LOWER");{let n=((e+t-1)/t-1)*t+r-e;return i[s]="SAME_LOWER"===o?Math.floor((n+1)/2):Math.floor(n/2),i[a]=n-i[s],Math.floor((e+n-r)/t+1)}default:throw Error("Unsupported AutoPad type")}}}t.PoolConvUtil=g,t.MIN_CLIP=-34028234663852886e22,t.MAX_CLIP=34028234663852886e22,t.decodeUtf8String=function(e){return(new TextDecoder).decode(e)}},7967:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.iterateExtraOptions=void 0,t.iterateExtraOptions=(e,n,r,i)=>{if("object"==typeof e&&null!==e){if(r.has(e))throw Error("Circular reference in options");r.add(e)}Object.entries(e).forEach(([e,s])=>{let a=n?n+e:e;if("object"==typeof s)(0,t.iterateExtraOptions)(s,a+".",r,i);else if("string"==typeof s||"number"==typeof s)i(a,s.toString());else{if("boolean"!=typeof s)throw Error("Can't handle extra config type: "+typeof s);i(a,s?"1":"0")}})}},2157:function(e,t,n){"use strict";var r,i=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var i=Object.getOwnPropertyDescriptor(t,n);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,i)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&i(t,e,n);return s(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.endProfiling=t.run=t.releaseSession=t.createSession=t.createSessionFinalize=t.createSessionAllocate=t.initOrt=t.initWasm=void 0;let o=n(1670),l=a(n(349)),u=n(6361),c=()=>!!o.env.wasm.proxy&&"undefined"!=typeof document,h,d,p,f=!1,g=!1,m=!1,y=[],b=[],v=[],w=[],_=[],x=[],T=()=>{if(f||!g||m||!h)throw Error("worker not ready")},I=e=>{switch(e.data.type){case"init-wasm":f=!1,e.data.err?(m=!0,d[1](e.data.err)):(g=!0,d[0]());break;case"init-ort":e.data.err?p[1](e.data.err):p[0]();break;case"create_allocate":e.data.err?y.shift()[1](e.data.err):y.shift()[0](e.data.out);break;case"create_finalize":e.data.err?b.shift()[1](e.data.err):b.shift()[0](e.data.out);break;case"create":e.data.err?v.shift()[1](e.data.err):v.shift()[0](e.data.out);break;case"release":e.data.err?w.shift()[1](e.data.err):w.shift()[0]();break;case"run":e.data.err?_.shift()[1](e.data.err):_.shift()[0](e.data.out);break;case"end-profiling":e.data.err?x.shift()[1](e.data.err):x.shift()[0]()}},k="undefined"!=typeof document?null===(r=null==document?void 0:document.currentScript)||void 0===r?void 0:r.src:void 0;t.initWasm=async()=>{if(c()){if(g)return;if(f)throw Error("multiple calls to 'initWasm()' detected.");if(m)throw Error("previous call to 'initWasm()' failed.");return f=!0,void 0===o.env.wasm.wasmPaths&&k&&0!==k.indexOf("blob:")&&(o.env.wasm.wasmPaths=k.substr(0,+k.lastIndexOf("/")+1)),new Promise((e,t)=>{null==h||h.terminate(),(h=n(9710).Z()).onmessage=I,d=[e,t];let r={type:"init-wasm",in:o.env.wasm};h.postMessage(r)})}return(0,u.initializeWebAssembly)(o.env.wasm)},t.initOrt=async(e,t)=>{if(c())return T(),new Promise((n,r)=>{p=[n,r];let i={type:"init-ort",in:{numThreads:e,loggingLevel:t}};h.postMessage(i)});l.initOrt(e,t)},t.createSessionAllocate=async e=>c()?(T(),new Promise((t,n)=>{y.push([t,n]);let r={type:"create_allocate",in:{model:e}};h.postMessage(r,[e.buffer])})):l.createSessionAllocate(e),t.createSessionFinalize=async(e,t)=>c()?(T(),new Promise((n,r)=>{b.push([n,r]);let i={type:"create_finalize",in:{modeldata:e,options:t}};h.postMessage(i)})):l.createSessionFinalize(e,t),t.createSession=async(e,t)=>c()?(T(),new Promise((n,r)=>{v.push([n,r]);let i={type:"create",in:{model:e,options:t}};h.postMessage(i,[e.buffer])})):l.createSession(e,t),t.releaseSession=async e=>{if(c())return T(),new Promise((t,n)=>{w.push([t,n]);let r={type:"release",in:e};h.postMessage(r)});l.releaseSession(e)},t.run=async(e,t,n,r,i)=>c()?(T(),new Promise((s,a)=>{_.push([s,a]);let o={type:"run",in:{sessionId:e,inputIndices:t,inputs:n,outputIndices:r,options:i}};h.postMessage(o,l.extractTransferableBuffers(n))})):l.run(e,t,n,r,i),t.endProfiling=async e=>{if(c())return T(),new Promise((t,n)=>{x.push([t,n]);let r={type:"end-profiling",in:e};h.postMessage(r)});l.endProfiling(e)}},586:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.setRunOptions=void 0;let r=n(7967),i=n(4983),s=n(6361);t.setRunOptions=e=>{let t=(0,s.getInstance)(),n=0,a=[],o=e||{};try{if(void 0===(null==e?void 0:e.logSeverityLevel))o.logSeverityLevel=2;else if("number"!=typeof e.logSeverityLevel||!Number.isInteger(e.logSeverityLevel)||e.logSeverityLevel<0||e.logSeverityLevel>4)throw Error(`log serverity level is not valid: ${e.logSeverityLevel}`);if(void 0===(null==e?void 0:e.logVerbosityLevel))o.logVerbosityLevel=0;else if("number"!=typeof e.logVerbosityLevel||!Number.isInteger(e.logVerbosityLevel))throw Error(`log verbosity level is not valid: ${e.logVerbosityLevel}`);void 0===(null==e?void 0:e.terminate)&&(o.terminate=!1);let s=0;if(void 0!==(null==e?void 0:e.tag)&&(s=(0,i.allocWasmString)(e.tag,a)),n=t._OrtCreateRunOptions(o.logSeverityLevel,o.logVerbosityLevel,!!o.terminate,s),0===n)throw Error("Can't create run options");return void 0!==(null==e?void 0:e.extra)&&(0,r.iterateExtraOptions)(e.extra,"",new WeakSet,(e,r)=>{let s=(0,i.allocWasmString)(e,a),o=(0,i.allocWasmString)(r,a);if(0!==t._OrtAddRunConfigEntry(n,s,o))throw Error(`Can't set a run config entry: ${e} - ${r}`)}),[n,a]}catch(e){throw 0!==n&&t._OrtReleaseRunOptions(n),a.forEach(t._free),e}}},2306:(e,t,n)=>{"use strict";let r;Object.defineProperty(t,"__esModule",{value:!0}),t.OnnxruntimeWebAssemblySessionHandler=void 0;let i=n(2806),s=n(1670),a=n(2850),o=n(2157);t.OnnxruntimeWebAssemblySessionHandler=class{async createSessionAllocate(e){let t=await fetch(e),n=await t.arrayBuffer();return(0,o.createSessionAllocate)(new Uint8Array(n))}async loadModel(e,t){if(r||(await (0,o.initOrt)(s.env.wasm.numThreads,(e=>{switch(e){case"verbose":return 0;case"info":return 1;case"warning":return 2;case"error":return 3;case"fatal":return 4;default:throw Error(`unsupported logging level: ${e}`)}})(s.env.logLevel)),r=!0),"string"==typeof e){if("undefined"==typeof fetch){let n=await (0,a.promisify)(i.readFile)(e);[this.sessionId,this.inputNames,this.outputNames]=await (0,o.createSession)(n,t)}else{let n=await this.createSessionAllocate(e);[this.sessionId,this.inputNames,this.outputNames]=await (0,o.createSessionFinalize)(n,t)}}else[this.sessionId,this.inputNames,this.outputNames]=await (0,o.createSession)(e,t)}async dispose(){return(0,o.releaseSession)(this.sessionId)}async run(e,t,n){let r=[],i=[];Object.entries(e).forEach(e=>{let t=e[0],n=e[1],s=this.inputNames.indexOf(t);if(-1===s)throw Error(`invalid input '${t}'`);r.push(n),i.push(s)});let a=[];Object.entries(t).forEach(e=>{let t=e[0],n=this.outputNames.indexOf(t);if(-1===n)throw Error(`invalid output '${t}'`);a.push(n)});let l=await (0,o.run)(this.sessionId,i,r.map(e=>[e.type,e.dims,e.data]),a,n),u={};for(let e=0;e<l.length;e++)u[this.outputNames[a[e]]]=new s.Tensor(l[e][0],l[e][2],l[e][1]);return u}startProfiling(){}endProfiling(){(0,o.endProfiling)(this.sessionId)}}},4919:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.setSessionOptions=void 0;let r=n(7967),i=n(4983),s=n(6361);t.setSessionOptions=e=>{let t=(0,s.getInstance)(),n=0,a=[],o=e||{};(e=>{e.extra||(e.extra={}),e.extra.session||(e.extra.session={});let t=e.extra.session;t.use_ort_model_bytes_directly||(t.use_ort_model_bytes_directly="1")})(o);try{void 0===(null==e?void 0:e.graphOptimizationLevel)&&(o.graphOptimizationLevel="all");let l=(e=>{switch(e){case"disabled":return 0;case"basic":return 1;case"extended":return 2;case"all":return 99;default:throw Error(`unsupported graph optimization level: ${e}`)}})(o.graphOptimizationLevel);void 0===(null==e?void 0:e.enableCpuMemArena)&&(o.enableCpuMemArena=!0),void 0===(null==e?void 0:e.enableMemPattern)&&(o.enableMemPattern=!0),void 0===(null==e?void 0:e.executionMode)&&(o.executionMode="sequential");let u=(e=>{switch(e){case"sequential":return 0;case"parallel":return 1;default:throw Error(`unsupported execution mode: ${e}`)}})(o.executionMode),c=0;if(void 0!==(null==e?void 0:e.logId)&&(c=(0,i.allocWasmString)(e.logId,a)),void 0===(null==e?void 0:e.logSeverityLevel))o.logSeverityLevel=2;else if("number"!=typeof e.logSeverityLevel||!Number.isInteger(e.logSeverityLevel)||e.logSeverityLevel<0||e.logSeverityLevel>4)throw Error(`log serverity level is not valid: ${e.logSeverityLevel}`);if(void 0===(null==e?void 0:e.logVerbosityLevel))o.logVerbosityLevel=0;else if("number"!=typeof e.logVerbosityLevel||!Number.isInteger(e.logVerbosityLevel))throw Error(`log verbosity level is not valid: ${e.logVerbosityLevel}`);if(void 0===(null==e?void 0:e.enableProfiling)&&(o.enableProfiling=!1),n=t._OrtCreateSessionOptions(l,!!o.enableCpuMemArena,!!o.enableMemPattern,u,!!o.enableProfiling,0,c,o.logSeverityLevel,o.logVerbosityLevel),0===n)throw Error("Can't create session options");return(null==e?void 0:e.executionProviders)&&((e,t,n)=>{for(let r of t){let t="string"==typeof r?r:r.name;switch(t){case"xnnpack":t="XNNPACK";break;case"wasm":case"cpu":continue;default:throw Error(`not supported EP: ${t}`)}let a=(0,i.allocWasmString)(t,n);if(0!==(0,s.getInstance)()._OrtAppendExecutionProvider(e,a))throw Error(`Can't append execution provider: ${t}`)}})(n,e.executionProviders,a),void 0!==(null==e?void 0:e.extra)&&(0,r.iterateExtraOptions)(e.extra,"",new WeakSet,(e,r)=>{let s=(0,i.allocWasmString)(e,a),o=(0,i.allocWasmString)(r,a);if(0!==t._OrtAddSessionConfigEntry(n,s,o))throw Error(`Can't set a session config entry: ${e} - ${r}`)}),[n,a]}catch(e){throw 0!==n&&t._OrtReleaseSessionOptions(n),a.forEach(t._free),e}}},4983:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.allocWasmString=void 0;let r=n(6361);t.allocWasmString=(e,t)=>{let n=(0,r.getInstance)(),i=n.lengthBytesUTF8(e)+1,s=n._malloc(i);return n.stringToUTF8(e,s,i),t.push(s),s}},349:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.extractTransferableBuffers=t.endProfiling=t.run=t.releaseSession=t.createSession=t.createSessionFinalize=t.createSessionAllocate=t.initOrt=void 0;let r=n(586),i=n(4919),s=n(4983),a=n(6361);t.initOrt=(e,t)=>{let n=(0,a.getInstance)()._OrtInit(e,t);if(0!==n)throw Error(`Can't initialize onnxruntime. error code = ${n}`)};let o=new Map;t.createSessionAllocate=e=>{let t=(0,a.getInstance)(),n=t._malloc(e.byteLength);return t.HEAPU8.set(e,n),[n,e.byteLength]},t.createSessionFinalize=(e,t)=>{let n=(0,a.getInstance)(),r=0,s=0,l=[];try{if([s,l]=(0,i.setSessionOptions)(t),r=n._OrtCreateSession(e[0],e[1],s),0===r)throw Error("Can't create a session")}finally{n._free(e[0]),n._OrtReleaseSessionOptions(s),l.forEach(n._free)}let u=n._OrtGetInputCount(r),c=n._OrtGetOutputCount(r),h=[],d=[],p=[],f=[];for(let e=0;e<u;e++){let t=n._OrtGetInputName(r,e);if(0===t)throw Error("Can't get an input name");d.push(t),h.push(n.UTF8ToString(t))}for(let e=0;e<c;e++){let t=n._OrtGetOutputName(r,e);if(0===t)throw Error("Can't get an output name");f.push(t),p.push(n.UTF8ToString(t))}return o.set(r,[r,d,f]),[r,h,p]},t.createSession=(e,n)=>{let r=(0,t.createSessionAllocate)(e);return(0,t.createSessionFinalize)(r,n)},t.releaseSession=e=>{let t=(0,a.getInstance)(),n=o.get(e);if(!n)throw Error("invalid session id");let r=n[0],i=n[1],s=n[2];i.forEach(t._OrtFree),s.forEach(t._OrtFree),t._OrtReleaseSession(r),o.delete(e)};let l=e=>{switch(e){case"int8":return 3;case"uint8":return 2;case"bool":return 9;case"int16":return 5;case"uint16":return 4;case"int32":return 6;case"uint32":return 12;case"float32":return 1;case"float64":return 11;case"string":return 8;case"int64":return 7;case"uint64":return 13;default:throw Error(`unsupported data type: ${e}`)}},u=e=>{switch(e){case 3:return"int8";case 2:return"uint8";case 9:return"bool";case 5:return"int16";case 4:return"uint16";case 6:return"int32";case 12:return"uint32";case 1:return"float32";case 11:return"float64";case 8:return"string";case 7:return"int64";case 13:return"uint64";default:throw Error(`unsupported data type: ${e}`)}},c=e=>{switch(e){case"float32":return Float32Array;case"uint8":case"bool":return Uint8Array;case"int8":return Int8Array;case"uint16":return Uint16Array;case"int16":return Int16Array;case"int32":return Int32Array;case"float64":return Float64Array;case"uint32":return Uint32Array;case"int64":return BigInt64Array;case"uint64":return BigUint64Array;default:throw Error(`unsupported type: ${e}`)}};t.run=(e,t,n,i,h)=>{let d=(0,a.getInstance)(),p=o.get(e);if(!p)throw Error("invalid session id");let f=p[0],g=p[1],m=p[2],y=t.length,b=i.length,v=0,w=[],_=[],x=[];try{[v,w]=(0,r.setRunOptions)(h);for(let e=0;e<y;e++){let t,r;let i=n[e][0],a=n[e][1],o=n[e][2];if(Array.isArray(o)){r=4*o.length,t=d._malloc(r),x.push(t);let e=t/4;for(let t=0;t<o.length;t++){if("string"!=typeof o[t])throw TypeError(`tensor data at index ${t} is not a string`);d.HEAPU32[e++]=(0,s.allocWasmString)(o[t],x)}}else r=o.byteLength,t=d._malloc(r),x.push(t),d.HEAPU8.set(new Uint8Array(o.buffer,o.byteOffset,r),t);let u=d.stackSave(),c=d.stackAlloc(4*a.length);try{let e=c/4;a.forEach(t=>d.HEAP32[e++]=t);let n=d._OrtCreateTensor(l(i),t,r,c,a.length);if(0===n)throw Error("Can't create a tensor");_.push(n)}finally{d.stackRestore(u)}}let e=d.stackSave(),a=d.stackAlloc(4*y),o=d.stackAlloc(4*y),p=d.stackAlloc(4*b),T=d.stackAlloc(4*b);try{let e=a/4,n=o/4,r=p/4,s=T/4;for(let r=0;r<y;r++)d.HEAPU32[e++]=_[r],d.HEAPU32[n++]=g[t[r]];for(let e=0;e<b;e++)d.HEAPU32[r++]=0,d.HEAPU32[s++]=m[i[e]];let l=d._OrtRun(f,o,a,y,T,b,p,v),h=[];if(0===l)for(let e=0;e<b;e++){let t=d.HEAPU32[p/4+e],n=d.stackSave(),r=d.stackAlloc(16),i,s=0;try{if(l=d._OrtGetTensorData(t,r,r+4,r+8,r+12),0!==l)throw Error(`Can't access output tensor data. error code = ${l}`);let e=r/4,n=d.HEAPU32[e++];s=d.HEAPU32[e++];let a=d.HEAPU32[e++],o=d.HEAPU32[e++],p=[];for(let e=0;e<o;e++)p.push(d.HEAPU32[a/4+e]);d._OrtFree(a);let f=0===p.length?1:p.reduce((e,t)=>e*t);if(i=u(n),"string"===i){let e=[],t=s/4;for(let n=0;n<f;n++){let r=d.HEAPU32[t++],i=n===f-1?void 0:d.HEAPU32[t]-r;e.push(d.UTF8ToString(r,i))}h.push([i,p,e])}else{let e=new(c(i))(f);new Uint8Array(e.buffer,e.byteOffset,e.byteLength).set(d.HEAPU8.subarray(s,s+e.byteLength)),h.push([i,p,e])}}finally{d.stackRestore(n),"string"===i&&s&&d._free(s),d._OrtReleaseTensor(t)}}if(0===l)return h;throw Error(`failed to call OrtRun(). error code = ${l}.`)}finally{d.stackRestore(e)}}finally{_.forEach(d._OrtReleaseTensor),x.forEach(d._free),d._OrtReleaseRunOptions(v),w.forEach(d._free)}},t.endProfiling=e=>{let t=(0,a.getInstance)(),n=o.get(e);if(!n)throw Error("invalid session id");let r=n[0],i=t._OrtEndProfiling(r);if(0===i)throw Error("Can't get an profile file name");t._OrtFree(i)},t.extractTransferableBuffers=e=>{let t=[];for(let n of e){let e=n[2];!Array.isArray(e)&&e.buffer&&t.push(e.buffer)}return t}},6361:function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var i=Object.getOwnPropertyDescriptor(t,n);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,i)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&r(t,e,n);return i(t,e),t},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.dispose=t.getInstance=t.initializeWebAssembly=void 0;let o=s(n(6449)),l=a(n(932)),u=n(3474),c,h=!1,d=!1,p=!1,f=(e,t)=>t?e?"ort-wasm-simd-threaded.wasm":"ort-wasm-threaded.wasm":e?"ort-wasm-simd.wasm":"ort-wasm.wasm";t.initializeWebAssembly=async e=>{if(h)return Promise.resolve();if(d)throw Error("multiple calls to 'initializeWebAssembly()' detected.");if(p)throw Error("previous call to 'initializeWebAssembly()' failed.");d=!0;let t=e.initTimeout,r=e.numThreads,i=e.simd,s=r>1&&(()=>{try{return"undefined"!=typeof SharedArrayBuffer&&("undefined"!=typeof MessageChannel&&(new MessageChannel).port1.postMessage(new SharedArrayBuffer(1)),WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,5,4,1,3,1,1,10,11,1,9,0,65,0,254,16,2,0,26,11])))}catch(e){return!1}})(),a=i&&(()=>{try{return WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,10,30,1,28,0,65,0,253,15,253,12,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,253,186,1,26,11]))}catch(e){return!1}})(),g="string"==typeof e.wasmPaths?e.wasmPaths:void 0,m=f(!1,s),y=f(a,s),b="object"==typeof e.wasmPaths?e.wasmPaths[y]:void 0,v=!1,w=[];if(t>0&&w.push(new Promise(e=>{setTimeout(()=>{v=!0,e()},t)})),w.push(new Promise((e,t)=>{let r=s?u:l.default,i={locateFile:(e,t)=>s&&e.endsWith(".worker.js")&&"undefined"!=typeof Blob?URL.createObjectURL(new Blob([n(4154)],{type:"text/javascript"})):e===m?null!=b?b:(null!=g?g:t)+y:t+e};if(s){if("undefined"==typeof Blob)i.mainScriptUrlOrBlob=o.join("/","ort-wasm-threaded.js");else{let e=`var ortWasmThreaded=(function(){var _scriptDir;return ${r.toString()}})();`;i.mainScriptUrlOrBlob=new Blob([e],{type:"text/javascript"})}}r(i).then(t=>{d=!1,h=!0,c=t,e()},e=>{d=!1,p=!0,t(e)})})),await Promise.race(w),v)throw Error(`WebAssembly backend initializing failed due to timeout: ${t}ms`)},t.getInstance=()=>{if(h&&c)return c;throw Error("WebAssembly is not initialized yet.")},t.dispose=()=>{var e;!h||d||p||(d=!0,null===(e=c.PThread)||void 0===e||e.terminateAllThreads(),c=void 0,d=!1,h=!1,p=!0)}},9710:(e,t,n)=>{"use strict";n.d(t,{Z:()=>s});var r=n(477),i=n.n(r);function s(){return i()('/*!\n* ONNX Runtime Web v1.14.0\n* Copyright (c) Microsoft Corporation. All rights reserved.\n* Licensed under the MIT License.\n*/\n(()=>{var t={474:(t,e,n)=>{var _scriptDir,r=(_scriptDir=(_scriptDir="undefined"!=typeof document&&document.currentScript?document.currentScript.src:void 0)||"/index.js",function(t){function e(){return j.buffer!=D&&N(j.buffer),P}function r(){return j.buffer!=D&&N(j.buffer),U}function a(){return j.buffer!=D&&N(j.buffer),F}function i(){return j.buffer!=D&&N(j.buffer),I}function o(){return j.buffer!=D&&N(j.buffer),W}var u,c,s;t=t||{},u||(u=void 0!==t?t:{}),u.ready=new Promise((function(t,e){c=t,s=e}));var l,f,p,h,d,y,b=Object.assign({},u),m="./this.program",g=(t,e)=>{throw e},v="object"==typeof window,w="function"==typeof importScripts,_="object"==typeof process&&"object"==typeof process.versions&&"string"==typeof process.versions.node,O=u.ENVIRONMENT_IS_PTHREAD||!1,A="";function S(t){return u.locateFile?u.locateFile(t,A):A+t}if(_){let e;A=w?n(908).dirname(A)+"/":"//",y=()=>{d||(h=n(384),d=n(908))},l=function(t,e){return y(),t=d.normalize(t),h.readFileSync(t,e?void 0:"utf8")},p=t=>((t=l(t,!0)).buffer||(t=new Uint8Array(t)),t),f=(t,e,n)=>{y(),t=d.normalize(t),h.readFile(t,(function(t,r){t?n(t):e(r.buffer)}))},1<process.argv.length&&(m=process.argv[1].replace(/\\\\/g,"/")),process.argv.slice(2),process.on("uncaughtException",(function(t){if(!(t instanceof ct))throw t})),process.on("unhandledRejection",(function(t){throw t})),g=(t,e)=>{if(Q())throw process.exitCode=t,e;e instanceof ct||x("exiting due to exception: "+e),process.exit(t)},u.inspect=function(){return"[Emscripten Module object]"};try{e=n(925)}catch(t){throw console.error(\'The "worker_threads" module is not supported in this node.js build - perhaps a newer version is needed?\'),t}n.g.Worker=e.Worker}else(v||w)&&(w?A=self.location.href:"undefined"!=typeof document&&document.currentScript&&(A=document.currentScript.src),_scriptDir&&(A=_scriptDir),A=0!==A.indexOf("blob:")?A.substr(0,A.replace(/[?#].*/,"").lastIndexOf("/")+1):"",_||(l=t=>{var e=new XMLHttpRequest;return e.open("GET",t,!1),e.send(null),e.responseText},w&&(p=t=>{var e=new XMLHttpRequest;return e.open("GET",t,!1),e.responseType="arraybuffer",e.send(null),new Uint8Array(e.response)}),f=(t,e,n)=>{var r=new XMLHttpRequest;r.open("GET",t,!0),r.responseType="arraybuffer",r.onload=()=>{200==r.status||0==r.status&&r.response?e(r.response):n()},r.onerror=n,r.send(null)}));_&&"undefined"==typeof performance&&(n.g.performance=n(953).performance);var T=console.log.bind(console),E=console.warn.bind(console);_&&(y(),T=t=>h.writeSync(1,t+"\\n"),E=t=>h.writeSync(2,t+"\\n"));var M,C=u.print||T,x=u.printErr||E;Object.assign(u,b),b=null,u.thisProgram&&(m=u.thisProgram),u.quit&&(g=u.quit),u.wasmBinary&&(M=u.wasmBinary);var R=u.noExitRuntime||!1;"object"!=typeof WebAssembly&&at("no native wasm support detected");var j,k,D,P,U,F,I,W,H=!1,L="undefined"!=typeof TextDecoder?new TextDecoder("utf8"):void 0;function z(t,e,n){var r=(e>>>=0)+n;for(n=e;t[n]&&!(n>=r);)++n;if(16<n-e&&t.buffer&&L)return L.decode(t.buffer instanceof SharedArrayBuffer?t.slice(e,n):t.subarray(e,n));for(r="";e<n;){var a=t[e++];if(128&a){var i=63&t[e++];if(192==(224&a))r+=String.fromCharCode((31&a)<<6|i);else{var o=63&t[e++];65536>(a=224==(240&a)?(15&a)<<12|i<<6|o:(7&a)<<18|i<<12|o<<6|63&t[e++])?r+=String.fromCharCode(a):(a-=65536,r+=String.fromCharCode(55296|a>>10,56320|1023&a))}}else r+=String.fromCharCode(a)}return r}function Y(t,e){return(t>>>=0)?z(r(),t,e):""}function B(t,e,n,r){if(!(0<r))return 0;var a=n>>>=0;r=n+r-1;for(var i=0;i<t.length;++i){var o=t.charCodeAt(i);if(55296<=o&&57343>=o&&(o=65536+((1023&o)<<10)|1023&t.charCodeAt(++i)),127>=o){if(n>=r)break;e[n++>>>0]=o}else{if(2047>=o){if(n+1>=r)break;e[n++>>>0]=192|o>>6}else{if(65535>=o){if(n+2>=r)break;e[n++>>>0]=224|o>>12}else{if(n+3>=r)break;e[n++>>>0]=240|o>>18,e[n++>>>0]=128|o>>12&63}e[n++>>>0]=128|o>>6&63}e[n++>>>0]=128|63&o}}return e[n>>>0]=0,n-a}function G(t){for(var e=0,n=0;n<t.length;++n){var r=t.charCodeAt(n);127>=r?e++:2047>=r?e+=2:55296<=r&&57343>=r?(e+=4,++n):e+=3}return e}function N(t){D=t,u.HEAP8=P=new Int8Array(t),u.HEAP16=new Int16Array(t),u.HEAP32=F=new Int32Array(t),u.HEAPU8=U=new Uint8Array(t),u.HEAPU16=new Uint16Array(t),u.HEAPU32=I=new Uint32Array(t),u.HEAPF32=new Float32Array(t),u.HEAPF64=W=new Float64Array(t)}O&&(D=u.buffer);var V=u.INITIAL_MEMORY||16777216;if(O)j=u.wasmMemory,D=u.buffer;else if(u.wasmMemory)j=u.wasmMemory;else if(!((j=new WebAssembly.Memory({initial:V/65536,maximum:65536,shared:!0})).buffer instanceof SharedArrayBuffer))throw x("requested a shared WebAssembly.Memory but the returned buffer is not a SharedArrayBuffer, indicating that while the browser has SharedArrayBuffer it does not have WebAssembly threads support - you may need to set a flag"),_&&console.log("(on node you may need: --experimental-wasm-threads --experimental-wasm-bulk-memory and also use a recent version)"),Error("bad memory");j&&(D=j.buffer),V=D.byteLength,N(D);var $,q=[],X=[],J=[],Z=[];function Q(){return R||!1}function K(){var t=u.preRun.shift();q.unshift(t)}var tt,et=0,nt=null,rt=null;function at(t){throw O?postMessage({cmd:"onAbort",arg:t}):u.onAbort&&u.onAbort(t),x(t="Aborted("+t+")"),H=!0,t=new WebAssembly.RuntimeError(t+". Build with -sASSERTIONS for more info."),s(t),t}function it(){return tt.startsWith("data:application/octet-stream;base64,")}function ot(){var t=tt;try{if(t==tt&&M)return new Uint8Array(M);if(p)return p(t);throw"both async and sync fetching of the wasm failed"}catch(t){at(t)}}tt="ort-wasm-threaded.wasm",it()||(tt=S(tt));var ut={};function ct(t){this.name="ExitStatus",this.message="Program terminated with exit("+t+")",this.status=t}function st(t){(t=ht.Vb[t])||at(),ht.mc(t)}function lt(t){var e=ht.Cc();if(!e)return 6;ht.ac.push(e),ht.Vb[t.Ub]=e,e.Ub=t.Ub;var n={cmd:"run",start_routine:t.Ic,arg:t.zc,pthread_ptr:t.Ub};return e.$b=()=>{n.time=performance.now(),e.postMessage(n,t.Nc)},e.loaded&&(e.$b(),delete e.$b),0}function ft(t){if(O)return $t(1,1,t);Q()||(ht.oc(),u.onExit&&u.onExit(t),H=!0),g(t,new ct(t))}function pt(t,e){if(!e&&O)throw bt(t),"unwind";Q()||O||(me(),dt(J),be(0),re[1].length&&ae(1,10),re[2].length&&ae(2,10),ht.oc()),ft(t)}var ht={Yb:[],ac:[],qc:[],Vb:{},fc:function(){O&&ht.Ec()},Pc:function(){},Ec:function(){ht.receiveObjectTransfer=ht.Gc,ht.threadInitTLS=ht.pc,ht.setExitStatus=ht.nc,R=!1},nc:function(){},oc:function(){for(var t of Object.values(ht.Vb))ht.mc(t);for(t of ht.Yb)t.terminate();ht.Yb=[]},mc:function(t){var e=t.Ub;delete ht.Vb[e],ht.Yb.push(t),ht.ac.splice(ht.ac.indexOf(t),1),t.Ub=0,Oe(e)},Gc:function(){},pc:function(){ht.qc.forEach((t=>t()))},Fc:function(t,e){t.onmessage=n=>{var r=(n=n.data).cmd;if(t.Ub&&(ht.Bc=t.Ub),n.targetThread&&n.targetThread!=he()){var a=ht.Vb[n.Qc];a?a.postMessage(n,n.transferList):x(\'Internal error! Worker sent a message "\'+r+\'" to target pthread \'+n.targetThread+", but that thread no longer exists!")}else"processProxyingQueue"===r?zt(n.queue):"spawnThread"===r?lt(n):"cleanupThread"===r?st(n.thread):"killThread"===r?(n=n.thread,r=ht.Vb[n],delete ht.Vb[n],r.terminate(),Oe(n),ht.ac.splice(ht.ac.indexOf(r),1),r.Ub=0):"cancelThread"===r?ht.Vb[n.thread].postMessage({cmd:"cancel"}):"loaded"===r?(t.loaded=!0,e&&e(t),t.$b&&(t.$b(),delete t.$b)):"print"===r?C("Thread "+n.threadId+": "+n.text):"printErr"===r?x("Thread "+n.threadId+": "+n.text):"alert"===r?alert("Thread "+n.threadId+": "+n.text):"setimmediate"===n.target?t.postMessage(n):"onAbort"===r?u.onAbort&&u.onAbort(n.arg):r&&x("worker sent an unknown command "+r);ht.Bc=void 0},t.onerror=t=>{throw x("worker sent an error! "+t.filename+":"+t.lineno+": "+t.message),t},_&&(t.on("message",(function(e){t.onmessage({data:e})})),t.on("error",(function(e){t.onerror(e)})),t.on("detachedExit",(function(){}))),t.postMessage({cmd:"load",urlOrBlob:u.mainScriptUrlOrBlob||_scriptDir,wasmMemory:j,wasmModule:k})},yc:function(){var t=S("ort-wasm-threaded.worker.js");ht.Yb.push(new Worker(t))},Cc:function(){return 0==ht.Yb.length&&(ht.yc(),ht.Fc(ht.Yb[0])),ht.Yb.pop()}};function dt(t){for(;0<t.length;)t.shift()(u)}function yt(t){var e=Ee();return t=t(),Me(e),t}function bt(t){if(O)return $t(2,0,t);try{pt(t)}catch(t){t instanceof ct||"unwind"==t||g(1,t)}}u.PThread=ht,u.establishStackSpace=function(){var t=he(),e=a()[t+44>>2>>>0];t=a()[t+48>>2>>>0],Te(e,e-t),Me(e)};var mt=[];function gt(t){var e=mt[t];return e||(t>=mt.length&&(mt.length=t+1),mt[t]=e=$.get(t)),e}u.invokeEntryPoint=function(t,e){t=gt(t)(e),Q()?ht.nc(t):Ae(t)};var vt,wt,_t=[],Ot=0,At=0;function St(t){this.Zb=t,this.Sb=t-24,this.xc=function(t){i()[this.Sb+4>>2>>>0]=t},this.bc=function(){return i()[this.Sb+4>>2>>>0]},this.wc=function(t){i()[this.Sb+8>>2>>>0]=t},this.Dc=function(){return i()[this.Sb+8>>2>>>0]},this.rc=function(){a()[this.Sb>>2>>>0]=0},this.hc=function(t){t=t?1:0,e()[this.Sb+12>>0>>>0]=t},this.uc=function(){return 0!=e()[this.Sb+12>>0>>>0]},this.ic=function(t){t=t?1:0,e()[this.Sb+13>>0>>>0]=t},this.kc=function(){return 0!=e()[this.Sb+13>>0>>>0]},this.fc=function(t,e){this.cc(0),this.xc(t),this.wc(e),this.rc(),this.hc(!1),this.ic(!1)},this.sc=function(){Atomics.add(a(),this.Sb>>2,1)},this.Hc=function(){return 1===Atomics.sub(a(),this.Sb>>2,1)},this.cc=function(t){i()[this.Sb+16>>2>>>0]=t},this.tc=function(){return i()[this.Sb+16>>2>>>0]},this.vc=function(){if(Re(this.bc()))return i()[this.Zb>>2>>>0];var t=this.tc();return 0!==t?t:this.Zb}}function Tt(t){return ye(new St(t).Sb)}function Et(t,e,n,r){return O?$t(3,1,t,e,n,r):Mt(t,e,n,r)}function Mt(t,e,n,r){if("undefined"==typeof SharedArrayBuffer)return x("Current environment does not support SharedArrayBuffer, pthreads are not available!"),6;var a=[];return O&&0===a.length?Et(t,e,n,r):(t={Ic:n,Ub:t,zc:r,Nc:a},O?(t.Oc="spawnThread",postMessage(t,a),0):lt(t))}function Ct(t,e,n){return O?$t(4,1,t,e,n):0}function xt(t,e){if(O)return $t(5,1,t,e)}function Rt(t,e){if(O)return $t(6,1,t,e)}function jt(t,e,n){if(O)return $t(7,1,t,e,n)}function kt(t,e,n){return O?$t(8,1,t,e,n):0}function Dt(t,e){if(O)return $t(9,1,t,e)}function Pt(t,e,n){if(O)return $t(10,1,t,e,n)}function Ut(t,e,n,r){if(O)return $t(11,1,t,e,n,r)}function Ft(t,e,n,r){if(O)return $t(12,1,t,e,n,r)}function It(t,e,n,r){if(O)return $t(13,1,t,e,n,r)}function Wt(t){if(O)return $t(14,1,t)}function Ht(t,e){if(O)return $t(15,1,t,e)}function Lt(t,e,n){if(O)return $t(16,1,t,e,n)}function zt(t){Atomics.store(a(),t>>2,1),he()&&_e(t),Atomics.compareExchange(a(),t>>2,1,0)}function Yt(t){return i()[t>>>2]+4294967296*a()[t+4>>>2]}function Bt(t,e,n,r,a,i){return O?$t(17,1,t,e,n,r,a,i):-52}function Gt(t,e,n,r,a,i){if(O)return $t(18,1,t,e,n,r,a,i)}function Nt(t){var n=G(t)+1,r=de(n);return r&&B(t,e(),r,n),r}function Vt(t,e,n){function r(t){return(t=t.toTimeString().match(/\\(([A-Za-z ]+)\\)$/))?t[1]:"GMT"}if(O)return $t(19,1,t,e,n);var o=(new Date).getFullYear(),u=new Date(o,0,1),c=new Date(o,6,1);o=u.getTimezoneOffset();var s=c.getTimezoneOffset(),l=Math.max(o,s);a()[t>>2>>>0]=60*l,a()[e>>2>>>0]=Number(o!=s),t=r(u),e=r(c),t=Nt(t),e=Nt(e),s<o?(i()[n>>2>>>0]=t,i()[n+4>>2>>>0]=e):(i()[n>>2>>>0]=e,i()[n+4>>2>>>0]=t)}function $t(t,e){var n=arguments.length-2,r=arguments;return yt((()=>{for(var a=Ce(8*n),i=a>>3,u=0;u<n;u++){var c=r[2+u];o()[i+u>>>0]=c}return we(t,n,a,e)}))}u.executeNotifiedProxyingQueue=zt,wt=_?()=>{var t=process.hrtime();return 1e3*t[0]+t[1]/1e6}:O?()=>performance.now()-u.__performance_now_clock_drift:()=>performance.now();var qt,Xt=[],Jt={};function Zt(){if(!qt){var t,e={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:("object"==typeof navigator&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",_:m||"./this.program"};for(t in Jt)void 0===Jt[t]?delete e[t]:e[t]=Jt[t];var n=[];for(t in e)n.push(t+"="+e[t]);qt=n}return qt}function Qt(t,n){if(O)return $t(20,1,t,n);var r=0;return Zt().forEach((function(a,o){var u=n+r;for(o=i()[t+4*o>>2>>>0]=u,u=0;u<a.length;++u)e()[o++>>0>>>0]=a.charCodeAt(u);e()[o>>0>>>0]=0,r+=a.length+1})),0}function Kt(t,e){if(O)return $t(21,1,t,e);var n=Zt();i()[t>>2>>>0]=n.length;var r=0;return n.forEach((function(t){r+=t.length+1})),i()[e>>2>>>0]=r,0}function te(t){return O?$t(22,1,t):52}function ee(t,e,n,r){return O?$t(23,1,t,e,n,r):52}function ne(t,e,n,r,a){return O?$t(24,1,t,e,n,r,a):70}var re=[null,[],[]];function ae(t,e){var n=re[t];0===e||10===e?((1===t?C:x)(z(n,0)),n.length=0):n.push(e)}function ie(t,e,n,a){if(O)return $t(25,1,t,e,n,a);for(var o=0,u=0;u<n;u++){var c=i()[e>>2>>>0],s=i()[e+4>>2>>>0];e+=8;for(var l=0;l<s;l++)ae(t,r()[c+l>>>0]);o+=s}return i()[a>>2>>>0]=o,0}var oe=0;function ue(t){return 0==t%4&&(0!=t%100||0==t%400)}var ce=[31,29,31,30,31,30,31,31,30,31,30,31],se=[31,28,31,30,31,30,31,31,30,31,30,31];function le(t,n,r,i){function o(t,e,n){for(t="number"==typeof t?t.toString():t||"";t.length<e;)t=n[0]+t;return t}function u(t,e){return o(t,e,"0")}function c(t,e){function n(t){return 0>t?-1:0<t?1:0}var r;return 0===(r=n(t.getFullYear()-e.getFullYear()))&&0===(r=n(t.getMonth()-e.getMonth()))&&(r=n(t.getDate()-e.getDate())),r}function s(t){switch(t.getDay()){case 0:return new Date(t.getFullYear()-1,11,29);case 1:return t;case 2:return new Date(t.getFullYear(),0,3);case 3:return new Date(t.getFullYear(),0,2);case 4:return new Date(t.getFullYear(),0,1);case 5:return new Date(t.getFullYear()-1,11,31);case 6:return new Date(t.getFullYear()-1,11,30)}}function l(t){var e=t.Wb;for(t=new Date(new Date(t.Xb+1900,0,1).getTime());0<e;){var n=t.getMonth(),r=(ue(t.getFullYear())?ce:se)[n];if(!(e>r-t.getDate())){t.setDate(t.getDate()+e);break}e-=r-t.getDate()+1,t.setDate(1),11>n?t.setMonth(n+1):(t.setMonth(0),t.setFullYear(t.getFullYear()+1))}return n=new Date(t.getFullYear()+1,0,4),e=s(new Date(t.getFullYear(),0,4)),n=s(n),0>=c(e,t)?0>=c(n,t)?t.getFullYear()+1:t.getFullYear():t.getFullYear()-1}var f=a()[i+40>>2>>>0];for(var p in i={Lc:a()[i>>2>>>0],Kc:a()[i+4>>2>>>0],dc:a()[i+8>>2>>>0],jc:a()[i+12>>2>>>0],ec:a()[i+16>>2>>>0],Xb:a()[i+20>>2>>>0],Tb:a()[i+24>>2>>>0],Wb:a()[i+28>>2>>>0],Rc:a()[i+32>>2>>>0],Jc:a()[i+36>>2>>>0],Mc:f?Y(f):""},r=Y(r),f={"%c":"%a %b %d %H:%M:%S %Y","%D":"%m/%d/%y","%F":"%Y-%m-%d","%h":"%b","%r":"%I:%M:%S %p","%R":"%H:%M","%T":"%H:%M:%S","%x":"%m/%d/%y","%X":"%H:%M:%S","%Ec":"%c","%EC":"%C","%Ex":"%m/%d/%y","%EX":"%H:%M:%S","%Ey":"%y","%EY":"%Y","%Od":"%d","%Oe":"%e","%OH":"%H","%OI":"%I","%Om":"%m","%OM":"%M","%OS":"%S","%Ou":"%u","%OU":"%U","%OV":"%V","%Ow":"%w","%OW":"%W","%Oy":"%y"})r=r.replace(new RegExp(p,"g"),f[p]);var h="Sunday Monday Tuesday Wednesday Thursday Friday Saturday".split(" "),d="January February March April May June July August September October November December".split(" ");for(p in f={"%a":function(t){return h[t.Tb].substring(0,3)},"%A":function(t){return h[t.Tb]},"%b":function(t){return d[t.ec].substring(0,3)},"%B":function(t){return d[t.ec]},"%C":function(t){return u((t.Xb+1900)/100|0,2)},"%d":function(t){return u(t.jc,2)},"%e":function(t){return o(t.jc,2," ")},"%g":function(t){return l(t).toString().substring(2)},"%G":function(t){return l(t)},"%H":function(t){return u(t.dc,2)},"%I":function(t){return 0==(t=t.dc)?t=12:12<t&&(t-=12),u(t,2)},"%j":function(t){for(var e=0,n=0;n<=t.ec-1;e+=(ue(t.Xb+1900)?ce:se)[n++]);return u(t.jc+e,3)},"%m":function(t){return u(t.ec+1,2)},"%M":function(t){return u(t.Kc,2)},"%n":function(){return"\\n"},"%p":function(t){return 0<=t.dc&&12>t.dc?"AM":"PM"},"%S":function(t){return u(t.Lc,2)},"%t":function(){return"\\t"},"%u":function(t){return t.Tb||7},"%U":function(t){return u(Math.floor((t.Wb+7-t.Tb)/7),2)},"%V":function(t){var e=Math.floor((t.Wb+7-(t.Tb+6)%7)/7);if(2>=(t.Tb+371-t.Wb-2)%7&&e++,e)53==e&&(4==(n=(t.Tb+371-t.Wb)%7)||3==n&&ue(t.Xb)||(e=1));else{e=52;var n=(t.Tb+7-t.Wb-1)%7;(4==n||5==n&&ue(t.Xb%400-1))&&e++}return u(e,2)},"%w":function(t){return t.Tb},"%W":function(t){return u(Math.floor((t.Wb+7-(t.Tb+6)%7)/7),2)},"%y":function(t){return(t.Xb+1900).toString().substring(2)},"%Y":function(t){return t.Xb+1900},"%z":function(t){var e=0<=(t=t.Jc);return t=Math.abs(t)/60,(e?"+":"-")+String("0000"+(t/60*100+t%60)).slice(-4)},"%Z":function(t){return t.Mc},"%%":function(){return"%"}},r=r.replace(/%%/g,"\\0\\0"),f)r.includes(p)&&(r=r.replace(new RegExp(p,"g"),f[p](i)));return p=function(t){var e=Array(G(t)+1);return B(t,e,0,e.length),e}(r=r.replace(/\\0\\0/g,"%")),p.length>n?0:(function(t,n){e().set(t,n>>>0)}(p,t),p.length-1)}ht.fc();var fe=[null,ft,bt,Et,Ct,xt,Rt,jt,kt,Dt,Pt,Ut,Ft,It,Wt,Ht,Lt,Bt,Gt,Vt,Qt,Kt,te,ee,ne,ie],pe={b:function(t){return de(t+24)+24},n:function(t){return(t=new St(t)).uc()||(t.hc(!0),Ot--),t.ic(!1),_t.push(t),t.sc(),t.vc()},ma:function(t){throw x("Unexpected exception thrown, this is not properly supported - aborting"),H=!0,t},x:function(){Se(0);var t=_t.pop();if(t.Hc()&&!t.kc()){var e=t.Dc();e&&gt(e)(t.Zb),Tt(t.Zb)}At=0},e:function(){var t=At;if(!t)return oe=0;var e=new St(t);e.cc(t);var n=e.bc();if(!n)return oe=0,t;for(var r=Array.prototype.slice.call(arguments),a=0;a<r.length;a++){var i=r[a];if(0===i||i===n)break;if(xe(i,n,e.Sb+16))return oe=i,t}return oe=n,t},l:function(){var t=At;if(!t)return oe=0;var e=new St(t);e.cc(t);var n=e.bc();if(!n)return oe=0,t;for(var r=Array.prototype.slice.call(arguments),a=0;a<r.length;a++){var i=r[a];if(0===i||i===n)break;if(xe(i,n,e.Sb+16))return oe=i,t}return oe=n,t},h:function(){var t=At;if(!t)return oe=0;var e=new St(t);e.cc(t);var n=e.bc();if(!n)return oe=0,t;for(var r=Array.prototype.slice.call(arguments),a=0;a<r.length;a++){var i=r[a];if(0===i||i===n)break;if(xe(i,n,e.Sb+16))return oe=i,t}return oe=n,t},t:Tt,M:function(){var t=_t.pop();t||at("no exception to throw");var e=t.Zb;throw t.kc()||(_t.push(t),t.ic(!0),t.hc(!1),Ot++),At=e,e},c:function(t,e,n){throw new St(t).fc(e,n),At=t,Ot++,t},pa:function(){return Ot},Fa:function(t){ge(t,!w,1,!v),ht.pc()},T:function(t){O?postMessage({cmd:"cleanupThread",thread:t}):st(t)},xa:Mt,j:function(t){throw At||(At=t),t},H:Ct,Ma:xt,ua:Rt,wa:jt,oa:kt,Ka:Dt,Ca:Pt,Ja:Ut,V:Ft,va:It,sa:Wt,La:Ht,ta:Lt,Ta:function(){},X:function(){at("To use dlopen, you need enable dynamic linking, see https://github.com/emscripten-core/emscripten/wiki/Linking")},Ua:function(){at("To use dlopen, you need enable dynamic linking, see https://github.com/emscripten-core/emscripten/wiki/Linking")},W:function(){return Date.now()},ya:function(){return 2097152},Oa:function(){return!0},za:function(t,e,n,r){if(t==e)setTimeout((()=>zt(r)));else if(O)postMessage({targetThread:t,cmd:"processProxyingQueue",queue:r});else{if(!(t=ht.Vb[t]))return;t.postMessage({cmd:"processProxyingQueue",queue:r})}return 1},Ea:function(){return-1},Pa:function(t,e){t=new Date(1e3*Yt(t)),a()[e>>2>>>0]=t.getUTCSeconds(),a()[e+4>>2>>>0]=t.getUTCMinutes(),a()[e+8>>2>>>0]=t.getUTCHours(),a()[e+12>>2>>>0]=t.getUTCDate(),a()[e+16>>2>>>0]=t.getUTCMonth(),a()[e+20>>2>>>0]=t.getUTCFullYear()-1900,a()[e+24>>2>>>0]=t.getUTCDay(),t=(t.getTime()-Date.UTC(t.getUTCFullYear(),0,1,0,0,0,0))/864e5|0,a()[e+28>>2>>>0]=t},Qa:function(t,e){t=new Date(1e3*Yt(t)),a()[e>>2>>>0]=t.getSeconds(),a()[e+4>>2>>>0]=t.getMinutes(),a()[e+8>>2>>>0]=t.getHours(),a()[e+12>>2>>>0]=t.getDate(),a()[e+16>>2>>>0]=t.getMonth(),a()[e+20>>2>>>0]=t.getFullYear()-1900,a()[e+24>>2>>>0]=t.getDay();var n=new Date(t.getFullYear(),0,1),r=(t.getTime()-n.getTime())/864e5|0;a()[e+28>>2>>>0]=r,a()[e+36>>2>>>0]=-60*t.getTimezoneOffset(),r=new Date(t.getFullYear(),6,1).getTimezoneOffset(),t=0|(r!=(n=n.getTimezoneOffset())&&t.getTimezoneOffset()==Math.min(n,r)),a()[e+32>>2>>>0]=t},Ra:function(t){var e=new Date(a()[t+20>>2>>>0]+1900,a()[t+16>>2>>>0],a()[t+12>>2>>>0],a()[t+8>>2>>>0],a()[t+4>>2>>>0],a()[t>>2>>>0],0),n=a()[t+32>>2>>>0],r=e.getTimezoneOffset(),i=new Date(e.getFullYear(),0,1),o=new Date(e.getFullYear(),6,1).getTimezoneOffset(),u=i.getTimezoneOffset(),c=Math.min(u,o);return 0>n?a()[t+32>>2>>>0]=Number(o!=u&&c==r):0<n!=(c==r)&&(o=Math.max(u,o),e.setTime(e.getTime()+6e4*((0<n?c:o)-r))),a()[t+24>>2>>>0]=e.getDay(),n=(e.getTime()-i.getTime())/864e5|0,a()[t+28>>2>>>0]=n,a()[t>>2>>>0]=e.getSeconds(),a()[t+4>>2>>>0]=e.getMinutes(),a()[t+8>>2>>>0]=e.getHours(),a()[t+12>>2>>>0]=e.getDate(),a()[t+16>>2>>>0]=e.getMonth(),e.getTime()/1e3|0},Aa:Bt,Ba:Gt,Sa:function t(e,n,r){t.Ac||(t.Ac=!0,Vt(e,n,r))},y:function(){at("")},U:function(){if(!_&&!w){var t="Blocking on the main thread is very dangerous, see https://emscripten.org/docs/porting/pthreads.html#blocking-on-the-main-browser-thread";vt||(vt={}),vt[t]||(vt[t]=1,_&&(t="warning: "+t),x(t))}},ra:function(){return 4294901760},B:wt,Ia:function(t,e,n){r().copyWithin(t>>>0,e>>>0,e+n>>>0)},F:function(){return _?n(993).cpus().length:navigator.hardwareConcurrency},Da:function(t,e,n){Xt.length=e,n>>=3;for(var r=0;r<e;r++)Xt[r]=o()[n+r>>>0];return(0>t?ut[-t-1]:fe[t]).apply(null,Xt)},qa:function(t){var e=r().length;if((t>>>=0)<=e||4294901760<t)return!1;for(var n=1;4>=n;n*=2){var a=e*(1+.2/n);a=Math.min(a,t+100663296);var i=Math;a=Math.max(t,a),i=i.min.call(i,4294901760,a+(65536-a%65536)%65536);t:{try{j.grow(i-D.byteLength+65535>>>16),N(j.buffer);var o=1;break t}catch(t){}o=void 0}if(o)return!0}return!1},Na:function(){throw"unwind"},Ga:Qt,Ha:Kt,J:pt,I:te,S:ee,ga:ne,R:ie,d:function(){return oe},na:function t(r,a){t.lc||(t.lc=function(){if("object"==typeof crypto&&"function"==typeof crypto.getRandomValues){var t=new Uint8Array(1);return()=>(crypto.getRandomValues(t),t[0])}if(_)try{var e=n(Object(function(){var t=new Error("Cannot find module \'crypto\'");throw t.code="MODULE_NOT_FOUND",t}()));return()=>e.randomBytes(1)[0]}catch(t){}return()=>at("randomDevice")}());for(var i=0;i<a;i++)e()[r+i>>0>>>0]=t.lc();return 0},ia:function(t,e,n){var r=Ee();try{return gt(t)(e,n)}catch(t){if(Me(r),t!==t+0)throw t;Se(1,0)}},ja:function(t,e,n){var r=Ee();try{return gt(t)(e,n)}catch(t){if(Me(r),t!==t+0)throw t;Se(1,0)}},K:function(t){var e=Ee();try{return gt(t)()}catch(t){if(Me(e),t!==t+0)throw t;Se(1,0)}},f:function(t,e){var n=Ee();try{return gt(t)(e)}catch(t){if(Me(n),t!==t+0)throw t;Se(1,0)}},P:function(t,e,n){var r=Ee();try{return gt(t)(e,n)}catch(t){if(Me(r),t!==t+0)throw t;Se(1,0)}},Q:function(t,e,n){var r=Ee();try{return gt(t)(e,n)}catch(t){if(Me(r),t!==t+0)throw t;Se(1,0)}},k:function(t,e,n){var r=Ee();try{return gt(t)(e,n)}catch(t){if(Me(r),t!==t+0)throw t;Se(1,0)}},p:function(t,e,n,r){var a=Ee();try{return gt(t)(e,n,r)}catch(t){if(Me(a),t!==t+0)throw t;Se(1,0)}},q:function(t,e,n,r,a){var i=Ee();try{return gt(t)(e,n,r,a)}catch(t){if(Me(i),t!==t+0)throw t;Se(1,0)}},N:function(t,e,n,r,a,i){var o=Ee();try{return gt(t)(e,n,r,a,i)}catch(t){if(Me(o),t!==t+0)throw t;Se(1,0)}},s:function(t,e,n,r,a,i){var o=Ee();try{return gt(t)(e,n,r,a,i)}catch(t){if(Me(o),t!==t+0)throw t;Se(1,0)}},w:function(t,e,n,r,a,i,o){var u=Ee();try{return gt(t)(e,n,r,a,i,o)}catch(t){if(Me(u),t!==t+0)throw t;Se(1,0)}},L:function(t,e,n,r,a,i,o,u){var c=Ee();try{return gt(t)(e,n,r,a,i,o,u)}catch(t){if(Me(c),t!==t+0)throw t;Se(1,0)}},E:function(t,e,n,r,a,i,o,u,c,s,l,f){var p=Ee();try{return gt(t)(e,n,r,a,i,o,u,c,s,l,f)}catch(t){if(Me(p),t!==t+0)throw t;Se(1,0)}},aa:function(t,e,n,r,a,i,o,u){var c=Ee();try{return He(t,e,n,r,a,i,o,u)}catch(t){if(Me(c),t!==t+0)throw t;Se(1,0)}},_:function(t,e,n,r,a,i,o){var u=Ee();try{return ke(t,e,n,r,a,i,o)}catch(t){if(Me(u),t!==t+0)throw t;Se(1,0)}},Z:function(t,e,n,r,a){var i=Ee();try{return Le(t,e,n,r,a)}catch(t){if(Me(i),t!==t+0)throw t;Se(1,0)}},ca:function(t,e,n,r){var a=Ee();try{return Ie(t,e,n,r)}catch(t){if(Me(a),t!==t+0)throw t;Se(1,0)}},$:function(t){var e=Ee();try{return je(t)}catch(t){if(Me(e),t!==t+0)throw t;Se(1,0)}},ba:function(t,e){var n=Ee();try{return We(t,e)}catch(t){if(Me(n),t!==t+0)throw t;Se(1,0)}},Y:function(t,e,n){var r=Ee();try{return De(t,e,n)}catch(t){if(Me(r),t!==t+0)throw t;Se(1,0)}},g:function(t){var e=Ee();try{gt(t)()}catch(t){if(Me(e),t!==t+0)throw t;Se(1,0)}},r:function(t,e){var n=Ee();try{gt(t)(e)}catch(t){if(Me(n),t!==t+0)throw t;Se(1,0)}},i:function(t,e,n){var r=Ee();try{gt(t)(e,n)}catch(t){if(Me(r),t!==t+0)throw t;Se(1,0)}},ha:function(t,e,n,r){var a=Ee();try{gt(t)(e,n,r)}catch(t){if(Me(a),t!==t+0)throw t;Se(1,0)}},m:function(t,e,n,r){var a=Ee();try{gt(t)(e,n,r)}catch(t){if(Me(a),t!==t+0)throw t;Se(1,0)}},v:function(t,e,n,r,a){var i=Ee();try{gt(t)(e,n,r,a)}catch(t){if(Me(i),t!==t+0)throw t;Se(1,0)}},u:function(t,e,n,r,a,i){var o=Ee();try{gt(t)(e,n,r,a,i)}catch(t){if(Me(o),t!==t+0)throw t;Se(1,0)}},O:function(t,e,n,r,a,i,o){var u=Ee();try{gt(t)(e,n,r,a,i,o)}catch(t){if(Me(u),t!==t+0)throw t;Se(1,0)}},A:function(t,e,n,r,a,i,o,u){var c=Ee();try{gt(t)(e,n,r,a,i,o,u)}catch(t){if(Me(c),t!==t+0)throw t;Se(1,0)}},ka:function(t,e,n,r,a,i,o,u,c){var s=Ee();try{gt(t)(e,n,r,a,i,o,u,c)}catch(t){if(Me(s),t!==t+0)throw t;Se(1,0)}},C:function(t,e,n,r,a,i,o,u,c,s,l){var f=Ee();try{gt(t)(e,n,r,a,i,o,u,c,s,l)}catch(t){if(Me(f),t!==t+0)throw t;Se(1,0)}},D:function(t,e,n,r,a,i,o,u,c,s,l,f,p,h,d,y){var b=Ee();try{gt(t)(e,n,r,a,i,o,u,c,s,l,f,p,h,d,y)}catch(t){if(Me(b),t!==t+0)throw t;Se(1,0)}},fa:function(t,e,n,r,a,i,o,u){var c=Ee();try{Pe(t,e,n,r,a,i,o,u)}catch(t){if(Me(c),t!==t+0)throw t;Se(1,0)}},da:function(t,e,n,r,a,i,o,u,c,s,l,f){var p=Ee();try{Fe(t,e,n,r,a,i,o,u,c,s,l,f)}catch(t){if(Me(p),t!==t+0)throw t;Se(1,0)}},ea:function(t,e,n,r,a,i){var o=Ee();try{Ue(t,e,n,r,a,i)}catch(t){if(Me(o),t!==t+0)throw t;Se(1,0)}},o:function(t){return t},a:j||u.wasmMemory,G:function(t){oe=t},la:le,z:function(t,e,n,r){return le(t,e,n,r)}};!function(){function t(t,e){u.asm=t.exports,ht.qc.push(u.asm.sb),$=u.asm.ub,X.unshift(u.asm.Va),k=e,O||(et--,u.monitorRunDependencies&&u.monitorRunDependencies(et),0==et&&(null!==nt&&(clearInterval(nt),nt=null),rt&&(t=rt,rt=null,t())))}function e(e){t(e.instance,e.module)}function n(t){return function(){if(!M&&(v||w)){if("function"==typeof fetch&&!tt.startsWith("file://"))return fetch(tt,{credentials:"same-origin"}).then((function(t){if(!t.ok)throw"failed to load wasm binary file at \'"+tt+"\'";return t.arrayBuffer()})).catch((function(){return ot()}));if(f)return new Promise((function(t,e){f(tt,(function(e){t(new Uint8Array(e))}),e)}))}return Promise.resolve().then((function(){return ot()}))}().then((function(t){return WebAssembly.instantiate(t,r)})).then((function(t){return t})).then(t,(function(t){x("failed to asynchronously prepare wasm: "+t),at(t)}))}var r={a:pe};if(O||(et++,u.monitorRunDependencies&&u.monitorRunDependencies(et)),u.instantiateWasm)try{return u.instantiateWasm(r,t)}catch(t){return x("Module.instantiateWasm callback failed with error: "+t),!1}(M||"function"!=typeof WebAssembly.instantiateStreaming||it()||tt.startsWith("file://")||_||"function"!=typeof fetch?n(e):fetch(tt,{credentials:"same-origin"}).then((function(t){return WebAssembly.instantiateStreaming(t,r).then(e,(function(t){return x("wasm streaming compile failed: "+t),x("falling back to ArrayBuffer instantiation"),n(e)}))}))).catch(s)}(),u.___wasm_call_ctors=function(){return(u.___wasm_call_ctors=u.asm.Va).apply(null,arguments)},u._OrtInit=function(){return(u._OrtInit=u.asm.Wa).apply(null,arguments)},u._OrtCreateSessionOptions=function(){return(u._OrtCreateSessionOptions=u.asm.Xa).apply(null,arguments)},u._OrtAppendExecutionProvider=function(){return(u._OrtAppendExecutionProvider=u.asm.Ya).apply(null,arguments)},u._OrtAddSessionConfigEntry=function(){return(u._OrtAddSessionConfigEntry=u.asm.Za).apply(null,arguments)},u._OrtReleaseSessionOptions=function(){return(u._OrtReleaseSessionOptions=u.asm._a).apply(null,arguments)},u._OrtCreateSession=function(){return(u._OrtCreateSession=u.asm.$a).apply(null,arguments)},u._OrtReleaseSession=function(){return(u._OrtReleaseSession=u.asm.ab).apply(null,arguments)},u._OrtGetInputCount=function(){return(u._OrtGetInputCount=u.asm.bb).apply(null,arguments)},u._OrtGetOutputCount=function(){return(u._OrtGetOutputCount=u.asm.cb).apply(null,arguments)},u._OrtGetInputName=function(){return(u._OrtGetInputName=u.asm.db).apply(null,arguments)},u._OrtGetOutputName=function(){return(u._OrtGetOutputName=u.asm.eb).apply(null,arguments)},u._OrtFree=function(){return(u._OrtFree=u.asm.fb).apply(null,arguments)},u._OrtCreateTensor=function(){return(u._OrtCreateTensor=u.asm.gb).apply(null,arguments)},u._OrtGetTensorData=function(){return(u._OrtGetTensorData=u.asm.hb).apply(null,arguments)},u._OrtReleaseTensor=function(){return(u._OrtReleaseTensor=u.asm.ib).apply(null,arguments)},u._OrtCreateRunOptions=function(){return(u._OrtCreateRunOptions=u.asm.jb).apply(null,arguments)},u._OrtAddRunConfigEntry=function(){return(u._OrtAddRunConfigEntry=u.asm.kb).apply(null,arguments)},u._OrtReleaseRunOptions=function(){return(u._OrtReleaseRunOptions=u.asm.lb).apply(null,arguments)},u._OrtRun=function(){return(u._OrtRun=u.asm.mb).apply(null,arguments)},u._OrtEndProfiling=function(){return(u._OrtEndProfiling=u.asm.nb).apply(null,arguments)};var he=u._pthread_self=function(){return(he=u._pthread_self=u.asm.ob).apply(null,arguments)},de=u._malloc=function(){return(de=u._malloc=u.asm.pb).apply(null,arguments)},ye=u._free=function(){return(ye=u._free=u.asm.qb).apply(null,arguments)},be=u._fflush=function(){return(be=u._fflush=u.asm.rb).apply(null,arguments)};u.__emscripten_tls_init=function(){return(u.__emscripten_tls_init=u.asm.sb).apply(null,arguments)};var me=u.___funcs_on_exit=function(){return(me=u.___funcs_on_exit=u.asm.tb).apply(null,arguments)},ge=u.__emscripten_thread_init=function(){return(ge=u.__emscripten_thread_init=u.asm.vb).apply(null,arguments)};u.__emscripten_thread_crashed=function(){return(u.__emscripten_thread_crashed=u.asm.wb).apply(null,arguments)};var ve,we=u._emscripten_run_in_main_runtime_thread_js=function(){return(we=u._emscripten_run_in_main_runtime_thread_js=u.asm.xb).apply(null,arguments)},_e=u.__emscripten_proxy_execute_task_queue=function(){return(_e=u.__emscripten_proxy_execute_task_queue=u.asm.yb).apply(null,arguments)},Oe=u.__emscripten_thread_free_data=function(){return(Oe=u.__emscripten_thread_free_data=u.asm.zb).apply(null,arguments)},Ae=u.__emscripten_thread_exit=function(){return(Ae=u.__emscripten_thread_exit=u.asm.Ab).apply(null,arguments)},Se=u._setThrew=function(){return(Se=u._setThrew=u.asm.Bb).apply(null,arguments)},Te=u._emscripten_stack_set_limits=function(){return(Te=u._emscripten_stack_set_limits=u.asm.Cb).apply(null,arguments)},Ee=u.stackSave=function(){return(Ee=u.stackSave=u.asm.Db).apply(null,arguments)},Me=u.stackRestore=function(){return(Me=u.stackRestore=u.asm.Eb).apply(null,arguments)},Ce=u.stackAlloc=function(){return(Ce=u.stackAlloc=u.asm.Fb).apply(null,arguments)},xe=u.___cxa_can_catch=function(){return(xe=u.___cxa_can_catch=u.asm.Gb).apply(null,arguments)},Re=u.___cxa_is_pointer_type=function(){return(Re=u.___cxa_is_pointer_type=u.asm.Hb).apply(null,arguments)},je=u.dynCall_j=function(){return(je=u.dynCall_j=u.asm.Ib).apply(null,arguments)},ke=u.dynCall_iiiiij=function(){return(ke=u.dynCall_iiiiij=u.asm.Jb).apply(null,arguments)},De=u.dynCall_jii=function(){return(De=u.dynCall_jii=u.asm.Kb).apply(null,arguments)},Pe=u.dynCall_viiiiij=function(){return(Pe=u.dynCall_viiiiij=u.asm.Lb).apply(null,arguments)},Ue=u.dynCall_vjji=function(){return(Ue=u.dynCall_vjji=u.asm.Mb).apply(null,arguments)},Fe=u.dynCall_viiijjjii=function(){return(Fe=u.dynCall_viiijjjii=u.asm.Nb).apply(null,arguments)},Ie=u.dynCall_iij=function(){return(Ie=u.dynCall_iij=u.asm.Ob).apply(null,arguments)},We=u.dynCall_ji=function(){return(We=u.dynCall_ji=u.asm.Pb).apply(null,arguments)},He=u.dynCall_iiiiiij=function(){return(He=u.dynCall_iiiiiij=u.asm.Qb).apply(null,arguments)},Le=u.dynCall_iiij=function(){return(Le=u.dynCall_iiij=u.asm.Rb).apply(null,arguments)};function ze(){function t(){if(!ve&&(ve=!0,u.calledRun=!0,!H)&&(O||dt(X),c(u),u.onRuntimeInitialized&&u.onRuntimeInitialized(),!O)){if(u.postRun)for("function"==typeof u.postRun&&(u.postRun=[u.postRun]);u.postRun.length;){var t=u.postRun.shift();Z.unshift(t)}dt(Z)}}if(!(0<et))if(O)c(u),O||dt(X),postMessage({cmd:"loaded"});else{if(u.preRun)for("function"==typeof u.preRun&&(u.preRun=[u.preRun]);u.preRun.length;)K();dt(q),0<et||(u.setStatus?(u.setStatus("Running..."),setTimeout((function(){setTimeout((function(){u.setStatus("")}),1),t()}),1)):t())}}if(u.UTF8ToString=Y,u.stringToUTF8=function(t,e,n){return B(t,r(),e,n)},u.lengthBytesUTF8=G,u.keepRuntimeAlive=Q,u.wasmMemory=j,u.stackSave=Ee,u.stackRestore=Me,u.stackAlloc=Ce,u.ExitStatus=ct,u.PThread=ht,rt=function t(){ve||ze(),ve||(rt=t)},u.preInit)for("function"==typeof u.preInit&&(u.preInit=[u.preInit]);0<u.preInit.length;)u.preInit.pop()();return ze(),t.ready});t.exports=r},932:(t,e,n)=>{var _scriptDir,r=(_scriptDir=(_scriptDir="undefined"!=typeof document&&document.currentScript?document.currentScript.src:void 0)||"/index.js",function(t){var e,r,a;t=t||{},e||(e=void 0!==t?t:{}),e.ready=new Promise((function(t,e){r=t,a=e}));var i,o,u,c,s,l,f=Object.assign({},e),p="./this.program",h=(t,e)=>{throw e},d="object"==typeof window,y="function"==typeof importScripts,b="object"==typeof process&&"object"==typeof process.versions&&"string"==typeof process.versions.node,m="";b?(m=y?n(908).dirname(m)+"/":"//",l=()=>{s||(c=n(384),s=n(908))},i=function(t,e){return l(),t=s.normalize(t),c.readFileSync(t,e?void 0:"utf8")},u=t=>((t=i(t,!0)).buffer||(t=new Uint8Array(t)),t),o=(t,e,n)=>{l(),t=s.normalize(t),c.readFile(t,(function(t,r){t?n(t):e(r.buffer)}))},1<process.argv.length&&(p=process.argv[1].replace(/\\\\/g,"/")),process.argv.slice(2),process.on("uncaughtException",(function(t){if(!(t instanceof J))throw t})),process.on("unhandledRejection",(function(t){throw t})),h=(t,e)=>{if(_||0<L)throw process.exitCode=t,e;e instanceof J||w("exiting due to exception: "+e),process.exit(t)},e.inspect=function(){return"[Emscripten Module object]"}):(d||y)&&(y?m=self.location.href:"undefined"!=typeof document&&document.currentScript&&(m=document.currentScript.src),_scriptDir&&(m=_scriptDir),m=0!==m.indexOf("blob:")?m.substr(0,m.replace(/[?#].*/,"").lastIndexOf("/")+1):"",i=t=>{var e=new XMLHttpRequest;return e.open("GET",t,!1),e.send(null),e.responseText},y&&(u=t=>{var e=new XMLHttpRequest;return e.open("GET",t,!1),e.responseType="arraybuffer",e.send(null),new Uint8Array(e.response)}),o=(t,e,n)=>{var r=new XMLHttpRequest;r.open("GET",t,!0),r.responseType="arraybuffer",r.onload=()=>{200==r.status||0==r.status&&r.response?e(r.response):n()},r.onerror=n,r.send(null)});var g,v=e.print||console.log.bind(console),w=e.printErr||console.warn.bind(console);Object.assign(e,f),f=null,e.thisProgram&&(p=e.thisProgram),e.quit&&(h=e.quit),e.wasmBinary&&(g=e.wasmBinary);var _=e.noExitRuntime||!1;"object"!=typeof WebAssembly&&V("no native wasm support detected");var O,A,S,T,E,M,C=!1,x="undefined"!=typeof TextDecoder?new TextDecoder("utf8"):void 0;function R(t,e,n){var r=(e>>>=0)+n;for(n=e;t[n]&&!(n>=r);)++n;if(16<n-e&&t.buffer&&x)return x.decode(t.subarray(e,n));for(r="";e<n;){var a=t[e++];if(128&a){var i=63&t[e++];if(192==(224&a))r+=String.fromCharCode((31&a)<<6|i);else{var o=63&t[e++];65536>(a=224==(240&a)?(15&a)<<12|i<<6|o:(7&a)<<18|i<<12|o<<6|63&t[e++])?r+=String.fromCharCode(a):(a-=65536,r+=String.fromCharCode(55296|a>>10,56320|1023&a))}}else r+=String.fromCharCode(a)}return r}function j(t,e){return(t>>>=0)?R(T,t,e):""}function k(t,e,n,r){if(!(0<r))return 0;var a=n>>>=0;r=n+r-1;for(var i=0;i<t.length;++i){var o=t.charCodeAt(i);if(55296<=o&&57343>=o&&(o=65536+((1023&o)<<10)|1023&t.charCodeAt(++i)),127>=o){if(n>=r)break;e[n++>>>0]=o}else{if(2047>=o){if(n+1>=r)break;e[n++>>>0]=192|o>>6}else{if(65535>=o){if(n+2>=r)break;e[n++>>>0]=224|o>>12}else{if(n+3>=r)break;e[n++>>>0]=240|o>>18,e[n++>>>0]=128|o>>12&63}e[n++>>>0]=128|o>>6&63}e[n++>>>0]=128|63&o}}return e[n>>>0]=0,n-a}function D(t){for(var e=0,n=0;n<t.length;++n){var r=t.charCodeAt(n);127>=r?e++:2047>=r?e+=2:55296<=r&&57343>=r?(e+=4,++n):e+=3}return e}function P(){var t=O.buffer;A=t,e.HEAP8=S=new Int8Array(t),e.HEAP16=new Int16Array(t),e.HEAP32=E=new Int32Array(t),e.HEAPU8=T=new Uint8Array(t),e.HEAPU16=new Uint16Array(t),e.HEAPU32=M=new Uint32Array(t),e.HEAPF32=new Float32Array(t),e.HEAPF64=new Float64Array(t)}var U,F=[],I=[],W=[],H=[],L=0;function z(){var t=e.preRun.shift();F.unshift(t)}var Y,B=0,G=null,N=null;function V(t){throw e.onAbort&&e.onAbort(t),w(t="Aborted("+t+")"),C=!0,t=new WebAssembly.RuntimeError(t+". Build with -sASSERTIONS for more info."),a(t),t}function $(){return Y.startsWith("data:application/octet-stream;base64,")}if(Y="ort-wasm.wasm",!$()){var q=Y;Y=e.locateFile?e.locateFile(q,m):m+q}function X(){var t=Y;try{if(t==Y&&g)return new Uint8Array(g);if(u)return u(t);throw"both async and sync fetching of the wasm failed"}catch(t){V(t)}}function J(t){this.name="ExitStatus",this.message="Program terminated with exit("+t+")",this.status=t}function Z(t){for(;0<t.length;)t.shift()(e)}var Q=[],K=0,tt=0;function et(t){this.Db=t,this.zb=t-24,this.Ub=function(t){M[this.zb+4>>2>>>0]=t},this.Eb=function(){return M[this.zb+4>>2>>>0]},this.Sb=function(t){M[this.zb+8>>2>>>0]=t},this.Wb=function(){return M[this.zb+8>>2>>>0]},this.Tb=function(){E[this.zb>>2>>>0]=0},this.Ib=function(t){S[this.zb+12>>0>>>0]=t?1:0},this.Pb=function(){return 0!=S[this.zb+12>>0>>>0]},this.Jb=function(t){S[this.zb+13>>0>>>0]=t?1:0},this.Lb=function(){return 0!=S[this.zb+13>>0>>>0]},this.Rb=function(t,e){this.Fb(0),this.Ub(t),this.Sb(e),this.Tb(),this.Ib(!1),this.Jb(!1)},this.Nb=function(){E[this.zb>>2>>>0]+=1},this.Xb=function(){var t=E[this.zb>>2>>>0];return E[this.zb>>2>>>0]=t-1,1===t},this.Fb=function(t){M[this.zb+16>>2>>>0]=t},this.Ob=function(){return M[this.zb+16>>2>>>0]},this.Qb=function(){if(Mt(this.Eb()))return M[this.Db>>2>>>0];var t=this.Ob();return 0!==t?t:this.Db}}function nt(t){return vt(new et(t).zb)}var rt=[];function at(t){var e=rt[t];return e||(t>=rt.length&&(rt.length=t+1),rt[t]=e=U.get(t)),e}function it(t){var e=D(t)+1,n=gt(e);return n&&k(t,S,n,e),n}var ot={};function ut(){if(!ct){var t,e={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:("object"==typeof navigator&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",_:p||"./this.program"};for(t in ot)void 0===ot[t]?delete e[t]:e[t]=ot[t];var n=[];for(t in e)n.push(t+"="+e[t]);ct=n}return ct}var ct,st=[null,[],[]];function lt(t,e){var n=st[t];0===e||10===e?((1===t?v:w)(R(n,0)),n.length=0):n.push(e)}var ft=0;function pt(t){return 0==t%4&&(0!=t%100||0==t%400)}var ht=[31,29,31,30,31,30,31,31,30,31,30,31],dt=[31,28,31,30,31,30,31,31,30,31,30,31];function yt(t,e,n,r){function a(t,e,n){for(t="number"==typeof t?t.toString():t||"";t.length<e;)t=n[0]+t;return t}function i(t,e){return a(t,e,"0")}function o(t,e){function n(t){return 0>t?-1:0<t?1:0}var r;return 0===(r=n(t.getFullYear()-e.getFullYear()))&&0===(r=n(t.getMonth()-e.getMonth()))&&(r=n(t.getDate()-e.getDate())),r}function u(t){switch(t.getDay()){case 0:return new Date(t.getFullYear()-1,11,29);case 1:return t;case 2:return new Date(t.getFullYear(),0,3);case 3:return new Date(t.getFullYear(),0,2);case 4:return new Date(t.getFullYear(),0,1);case 5:return new Date(t.getFullYear()-1,11,31);case 6:return new Date(t.getFullYear()-1,11,30)}}function c(t){var e=t.Bb;for(t=new Date(new Date(t.Cb+1900,0,1).getTime());0<e;){var n=t.getMonth(),r=(pt(t.getFullYear())?ht:dt)[n];if(!(e>r-t.getDate())){t.setDate(t.getDate()+e);break}e-=r-t.getDate()+1,t.setDate(1),11>n?t.setMonth(n+1):(t.setMonth(0),t.setFullYear(t.getFullYear()+1))}return n=new Date(t.getFullYear()+1,0,4),e=u(new Date(t.getFullYear(),0,4)),n=u(n),0>=o(e,t)?0>=o(n,t)?t.getFullYear()+1:t.getFullYear():t.getFullYear()-1}var s=E[r+40>>2>>>0];for(var l in r={$b:E[r>>2>>>0],Zb:E[r+4>>2>>>0],Gb:E[r+8>>2>>>0],Kb:E[r+12>>2>>>0],Hb:E[r+16>>2>>>0],Cb:E[r+20>>2>>>0],Ab:E[r+24>>2>>>0],Bb:E[r+28>>2>>>0],bc:E[r+32>>2>>>0],Yb:E[r+36>>2>>>0],ac:s?j(s):""},n=j(n),s={"%c":"%a %b %d %H:%M:%S %Y","%D":"%m/%d/%y","%F":"%Y-%m-%d","%h":"%b","%r":"%I:%M:%S %p","%R":"%H:%M","%T":"%H:%M:%S","%x":"%m/%d/%y","%X":"%H:%M:%S","%Ec":"%c","%EC":"%C","%Ex":"%m/%d/%y","%EX":"%H:%M:%S","%Ey":"%y","%EY":"%Y","%Od":"%d","%Oe":"%e","%OH":"%H","%OI":"%I","%Om":"%m","%OM":"%M","%OS":"%S","%Ou":"%u","%OU":"%U","%OV":"%V","%Ow":"%w","%OW":"%W","%Oy":"%y"})n=n.replace(new RegExp(l,"g"),s[l]);var f="Sunday Monday Tuesday Wednesday Thursday Friday Saturday".split(" "),p="January February March April May June July August September October November December".split(" ");for(l in s={"%a":function(t){return f[t.Ab].substring(0,3)},"%A":function(t){return f[t.Ab]},"%b":function(t){return p[t.Hb].substring(0,3)},"%B":function(t){return p[t.Hb]},"%C":function(t){return i((t.Cb+1900)/100|0,2)},"%d":function(t){return i(t.Kb,2)},"%e":function(t){return a(t.Kb,2," ")},"%g":function(t){return c(t).toString().substring(2)},"%G":function(t){return c(t)},"%H":function(t){return i(t.Gb,2)},"%I":function(t){return 0==(t=t.Gb)?t=12:12<t&&(t-=12),i(t,2)},"%j":function(t){for(var e=0,n=0;n<=t.Hb-1;e+=(pt(t.Cb+1900)?ht:dt)[n++]);return i(t.Kb+e,3)},"%m":function(t){return i(t.Hb+1,2)},"%M":function(t){return i(t.Zb,2)},"%n":function(){return"\\n"},"%p":function(t){return 0<=t.Gb&&12>t.Gb?"AM":"PM"},"%S":function(t){return i(t.$b,2)},"%t":function(){return"\\t"},"%u":function(t){return t.Ab||7},"%U":function(t){return i(Math.floor((t.Bb+7-t.Ab)/7),2)},"%V":function(t){var e=Math.floor((t.Bb+7-(t.Ab+6)%7)/7);if(2>=(t.Ab+371-t.Bb-2)%7&&e++,e)53==e&&(4==(n=(t.Ab+371-t.Bb)%7)||3==n&&pt(t.Cb)||(e=1));else{e=52;var n=(t.Ab+7-t.Bb-1)%7;(4==n||5==n&&pt(t.Cb%400-1))&&e++}return i(e,2)},"%w":function(t){return t.Ab},"%W":function(t){return i(Math.floor((t.Bb+7-(t.Ab+6)%7)/7),2)},"%y":function(t){return(t.Cb+1900).toString().substring(2)},"%Y":function(t){return t.Cb+1900},"%z":function(t){var e=0<=(t=t.Yb);return t=Math.abs(t)/60,(e?"+":"-")+String("0000"+(t/60*100+t%60)).slice(-4)},"%Z":function(t){return t.ac},"%%":function(){return"%"}},n=n.replace(/%%/g,"\\0\\0"),s)n.includes(l)&&(n=n.replace(new RegExp(l,"g"),s[l](r)));return l=function(t){var e=Array(D(t)+1);return k(t,e,0,e.length),e}(n=n.replace(/\\0\\0/g,"%")),l.length>e?0:(S.set(l,t>>>0),l.length-1)}var bt={a:function(t){return gt(t+24)+24},m:function(t){return(t=new et(t)).Pb()||(t.Ib(!0),K--),t.Jb(!1),Q.push(t),t.Nb(),t.Qb()},ia:function(t){throw w("Unexpected exception thrown, this is not properly supported - aborting"),C=!0,t},w:function(){Ot(0);var t=Q.pop();if(t.Xb()&&!t.Lb()){var e=t.Wb();e&&at(e)(t.Db),nt(t.Db)}tt=0},d:function(){var t=tt;if(!t)return ft=0;var e=new et(t);e.Fb(t);var n=e.Eb();if(!n)return ft=0,t;for(var r=Array.prototype.slice.call(arguments),a=0;a<r.length;a++){var i=r[a];if(0===i||i===n)break;if(Et(i,n,e.zb+16))return ft=i,t}return ft=n,t},k:function(){var t=tt;if(!t)return ft=0;var e=new et(t);e.Fb(t);var n=e.Eb();if(!n)return ft=0,t;for(var r=Array.prototype.slice.call(arguments),a=0;a<r.length;a++){var i=r[a];if(0===i||i===n)break;if(Et(i,n,e.zb+16))return ft=i,t}return ft=n,t},g:function(){var t=tt;if(!t)return ft=0;var e=new et(t);e.Fb(t);var n=e.Eb();if(!n)return ft=0,t;for(var r=Array.prototype.slice.call(arguments),a=0;a<r.length;a++){var i=r[a];if(0===i||i===n)break;if(Et(i,n,e.zb+16))return ft=i,t}return ft=n,t},s:nt,L:function(){var t=Q.pop();t||V("no exception to throw");var e=t.Db;throw t.Lb()||(Q.push(t),t.Jb(!0),t.Ib(!1),K++),tt=e,e},b:function(t,e,n){throw new et(t).Rb(e,n),tt=t,K++,t},la:function(){return K},i:function(t){throw tt||(tt=t),t},H:function(){return 0},Ba:function(){},pa:function(){},ra:function(){},ka:function(){return 0},za:function(){},ua:function(){},ya:function(){},R:function(){},qa:function(){},na:function(){},Aa:function(){},oa:function(){},Ha:function(){},Ja:function(){V("To use dlopen, you need enable dynamic linking, see https://github.com/emscripten-core/emscripten/wiki/Linking")},Ia:function(){V("To use dlopen, you need enable dynamic linking, see https://github.com/emscripten-core/emscripten/wiki/Linking")},S:function(){return Date.now()},Ca:function(){return!0},Da:function(t,e){t=new Date(1e3*(M[t>>>2]+4294967296*E[t+4>>>2])),E[e>>2>>>0]=t.getUTCSeconds(),E[e+4>>2>>>0]=t.getUTCMinutes(),E[e+8>>2>>>0]=t.getUTCHours(),E[e+12>>2>>>0]=t.getUTCDate(),E[e+16>>2>>>0]=t.getUTCMonth(),E[e+20>>2>>>0]=t.getUTCFullYear()-1900,E[e+24>>2>>>0]=t.getUTCDay(),E[e+28>>2>>>0]=(t.getTime()-Date.UTC(t.getUTCFullYear(),0,1,0,0,0,0))/864e5|0},Ea:function(t,e){t=new Date(1e3*(M[t>>>2]+4294967296*E[t+4>>>2])),E[e>>2>>>0]=t.getSeconds(),E[e+4>>2>>>0]=t.getMinutes(),E[e+8>>2>>>0]=t.getHours(),E[e+12>>2>>>0]=t.getDate(),E[e+16>>2>>>0]=t.getMonth(),E[e+20>>2>>>0]=t.getFullYear()-1900,E[e+24>>2>>>0]=t.getDay();var n=new Date(t.getFullYear(),0,1);E[e+28>>2>>>0]=(t.getTime()-n.getTime())/864e5|0,E[e+36>>2>>>0]=-60*t.getTimezoneOffset();var r=new Date(t.getFullYear(),6,1).getTimezoneOffset();n=n.getTimezoneOffset(),E[e+32>>2>>>0]=0|(r!=n&&t.getTimezoneOffset()==Math.min(n,r))},Fa:function(t){var e=new Date(E[t+20>>2>>>0]+1900,E[t+16>>2>>>0],E[t+12>>2>>>0],E[t+8>>2>>>0],E[t+4>>2>>>0],E[t>>2>>>0],0),n=E[t+32>>2>>>0],r=e.getTimezoneOffset(),a=new Date(e.getFullYear(),0,1),i=new Date(e.getFullYear(),6,1).getTimezoneOffset(),o=a.getTimezoneOffset(),u=Math.min(o,i);return 0>n?E[t+32>>2>>>0]=Number(i!=o&&u==r):0<n!=(u==r)&&(i=Math.max(o,i),e.setTime(e.getTime()+6e4*((0<n?u:i)-r))),E[t+24>>2>>>0]=e.getDay(),E[t+28>>2>>>0]=(e.getTime()-a.getTime())/864e5|0,E[t>>2>>>0]=e.getSeconds(),E[t+4>>2>>>0]=e.getMinutes(),E[t+8>>2>>>0]=e.getHours(),E[t+12>>2>>>0]=e.getDate(),E[t+16>>2>>>0]=e.getMonth(),e.getTime()/1e3|0},sa:function(){return-52},ta:function(){},Ga:function t(e,n,r){t.Vb||(t.Vb=!0,function(t,e,n){function r(t){return(t=t.toTimeString().match(/\\(([A-Za-z ]+)\\)$/))?t[1]:"GMT"}var a=(new Date).getFullYear(),i=new Date(a,0,1),o=new Date(a,6,1);a=i.getTimezoneOffset();var u=o.getTimezoneOffset();E[t>>2>>>0]=60*Math.max(a,u),E[e>>2>>>0]=Number(a!=u),t=r(i),e=r(o),t=it(t),e=it(e),u<a?(M[n>>2>>>0]=t,M[n+4>>2>>>0]=e):(M[n>>2>>>0]=e,M[n+4>>2>>>0]=t)}(e,n,r))},B:function(){V("")},ma:function(){return 4294901760},I:b?()=>{var t=process.hrtime();return 1e3*t[0]+t[1]/1e6}:()=>performance.now(),xa:function(t,e,n){T.copyWithin(t>>>0,e>>>0,e+n>>>0)},G:function(t){var e=T.length;if(4294901760<(t>>>=0))return!1;for(var n=1;4>=n;n*=2){var r=e*(1+.2/n);r=Math.min(r,t+100663296);var a=Math;r=Math.max(t,r),a=a.min.call(a,4294901760,r+(65536-r%65536)%65536);t:{try{O.grow(a-A.byteLength+65535>>>16),P();var i=1;break t}catch(t){}i=void 0}if(i)return!0}return!1},va:function(t,e){var n=0;return ut().forEach((function(r,a){var i=e+n;for(a=M[t+4*a>>2>>>0]=i,i=0;i<r.length;++i)S[a++>>0>>>0]=r.charCodeAt(i);S[a>>0>>>0]=0,n+=r.length+1})),0},wa:function(t,e){var n=ut();M[t>>2>>>0]=n.length;var r=0;return n.forEach((function(t){r+=t.length+1})),M[e>>2>>>0]=r,0},ba:function(t){_||0<L||(_t(),Z(W),wt(0),st[1].length&&lt(1,10),st[2].length&&lt(2,10)),_||0<L||(e.onExit&&e.onExit(t),C=!0),h(t,new J(t))},E:function(){return 52},Q:function(){return 52},ca:function(){return 70},P:function(t,e,n,r){for(var a=0,i=0;i<n;i++){var o=M[e>>2>>>0],u=M[e+4>>2>>>0];e+=8;for(var c=0;c<u;c++)lt(t,T[o+c>>>0]);a+=u}return M[r>>2>>>0]=a,0},c:function(){return ft},ja:function t(e,r){t.Mb||(t.Mb=function(){if("object"==typeof crypto&&"function"==typeof crypto.getRandomValues){var t=new Uint8Array(1);return()=>(crypto.getRandomValues(t),t[0])}if(b)try{var e=n(Object(function(){var t=new Error("Cannot find module \'crypto\'");throw t.code="MODULE_NOT_FOUND",t}()));return()=>e.randomBytes(1)[0]}catch(t){}return()=>V("randomDevice")}());for(var a=0;a<r;a++)S[e+a>>0>>>0]=t.Mb();return 0},ea:function(t,e,n){var r=At();try{return at(t)(e,n)}catch(t){if(St(r),t!==t+0)throw t;Ot(1,0)}},fa:function(t,e,n){var r=At();try{return at(t)(e,n)}catch(t){if(St(r),t!==t+0)throw t;Ot(1,0)}},J:function(t){var e=At();try{return at(t)()}catch(t){if(St(e),t!==t+0)throw t;Ot(1,0)}},e:function(t,e){var n=At();try{return at(t)(e)}catch(t){if(St(n),t!==t+0)throw t;Ot(1,0)}},N:function(t,e,n){var r=At();try{return at(t)(e,n)}catch(t){if(St(r),t!==t+0)throw t;Ot(1,0)}},O:function(t,e,n){var r=At();try{return at(t)(e,n)}catch(t){if(St(r),t!==t+0)throw t;Ot(1,0)}},j:function(t,e,n){var r=At();try{return at(t)(e,n)}catch(t){if(St(r),t!==t+0)throw t;Ot(1,0)}},o:function(t,e,n,r){var a=At();try{return at(t)(e,n,r)}catch(t){if(St(a),t!==t+0)throw t;Ot(1,0)}},p:function(t,e,n,r,a){var i=At();try{return at(t)(e,n,r,a)}catch(t){if(St(i),t!==t+0)throw t;Ot(1,0)}},M:function(t,e,n,r,a,i){var o=At();try{return at(t)(e,n,r,a,i)}catch(t){if(St(o),t!==t+0)throw t;Ot(1,0)}},r:function(t,e,n,r,a,i){var o=At();try{return at(t)(e,n,r,a,i)}catch(t){if(St(o),t!==t+0)throw t;Ot(1,0)}},v:function(t,e,n,r,a,i,o){var u=At();try{return at(t)(e,n,r,a,i,o)}catch(t){if(St(u),t!==t+0)throw t;Ot(1,0)}},K:function(t,e,n,r,a,i,o,u){var c=At();try{return at(t)(e,n,r,a,i,o,u)}catch(t){if(St(c),t!==t+0)throw t;Ot(1,0)}},D:function(t,e,n,r,a,i,o,u,c,s,l,f){var p=At();try{return at(t)(e,n,r,a,i,o,u,c,s,l,f)}catch(t){if(St(p),t!==t+0)throw t;Ot(1,0)}},X:function(t,e,n,r,a,i,o,u){var c=At();try{return Ft(t,e,n,r,a,i,o,u)}catch(t){if(St(c),t!==t+0)throw t;Ot(1,0)}},V:function(t,e,n,r,a,i,o){var u=At();try{return xt(t,e,n,r,a,i,o)}catch(t){if(St(u),t!==t+0)throw t;Ot(1,0)}},U:function(t,e,n,r,a){var i=At();try{return It(t,e,n,r,a)}catch(t){if(St(i),t!==t+0)throw t;Ot(1,0)}},Z:function(t,e,n,r){var a=At();try{return Pt(t,e,n,r)}catch(t){if(St(a),t!==t+0)throw t;Ot(1,0)}},W:function(t){var e=At();try{return Ct(t)}catch(t){if(St(e),t!==t+0)throw t;Ot(1,0)}},Y:function(t,e){var n=At();try{return Ut(t,e)}catch(t){if(St(n),t!==t+0)throw t;Ot(1,0)}},T:function(t,e,n){var r=At();try{return Rt(t,e,n)}catch(t){if(St(r),t!==t+0)throw t;Ot(1,0)}},f:function(t){var e=At();try{at(t)()}catch(t){if(St(e),t!==t+0)throw t;Ot(1,0)}},q:function(t,e){var n=At();try{at(t)(e)}catch(t){if(St(n),t!==t+0)throw t;Ot(1,0)}},h:function(t,e,n){var r=At();try{at(t)(e,n)}catch(t){if(St(r),t!==t+0)throw t;Ot(1,0)}},da:function(t,e,n,r){var a=At();try{at(t)(e,n,r)}catch(t){if(St(a),t!==t+0)throw t;Ot(1,0)}},l:function(t,e,n,r){var a=At();try{at(t)(e,n,r)}catch(t){if(St(a),t!==t+0)throw t;Ot(1,0)}},t:function(t,e,n,r,a){var i=At();try{at(t)(e,n,r,a)}catch(t){if(St(i),t!==t+0)throw t;Ot(1,0)}},u:function(t,e,n,r,a,i){var o=At();try{at(t)(e,n,r,a,i)}catch(t){if(St(o),t!==t+0)throw t;Ot(1,0)}},x:function(t,e,n,r,a,i,o){var u=At();try{at(t)(e,n,r,a,i,o)}catch(t){if(St(u),t!==t+0)throw t;Ot(1,0)}},z:function(t,e,n,r,a,i,o,u){var c=At();try{at(t)(e,n,r,a,i,o,u)}catch(t){if(St(c),t!==t+0)throw t;Ot(1,0)}},ga:function(t,e,n,r,a,i,o,u,c){var s=At();try{at(t)(e,n,r,a,i,o,u,c)}catch(t){if(St(s),t!==t+0)throw t;Ot(1,0)}},A:function(t,e,n,r,a,i,o,u,c,s,l){var f=At();try{at(t)(e,n,r,a,i,o,u,c,s,l)}catch(t){if(St(f),t!==t+0)throw t;Ot(1,0)}},C:function(t,e,n,r,a,i,o,u,c,s,l,f,p,h,d,y){var b=At();try{at(t)(e,n,r,a,i,o,u,c,s,l,f,p,h,d,y)}catch(t){if(St(b),t!==t+0)throw t;Ot(1,0)}},aa:function(t,e,n,r,a,i,o,u){var c=At();try{jt(t,e,n,r,a,i,o,u)}catch(t){if(St(c),t!==t+0)throw t;Ot(1,0)}},_:function(t,e,n,r,a,i,o,u,c,s,l,f){var p=At();try{Dt(t,e,n,r,a,i,o,u,c,s,l,f)}catch(t){if(St(p),t!==t+0)throw t;Ot(1,0)}},$:function(t,e,n,r,a,i){var o=At();try{kt(t,e,n,r,a,i)}catch(t){if(St(o),t!==t+0)throw t;Ot(1,0)}},n:function(t){return t},F:function(t){ft=t},ha:yt,y:function(t,e,n,r){return yt(t,e,n,r)}};!function(){function t(t){e.asm=t.exports,O=e.asm.Ka,P(),U=e.asm.ib,I.unshift(e.asm.La),B--,e.monitorRunDependencies&&e.monitorRunDependencies(B),0==B&&(null!==G&&(clearInterval(G),G=null),N&&(t=N,N=null,t()))}function n(e){t(e.instance)}function r(t){return function(){if(!g&&(d||y)){if("function"==typeof fetch&&!Y.startsWith("file://"))return fetch(Y,{credentials:"same-origin"}).then((function(t){if(!t.ok)throw"failed to load wasm binary file at \'"+Y+"\'";return t.arrayBuffer()})).catch((function(){return X()}));if(o)return new Promise((function(t,e){o(Y,(function(e){t(new Uint8Array(e))}),e)}))}return Promise.resolve().then((function(){return X()}))}().then((function(t){return WebAssembly.instantiate(t,i)})).then((function(t){return t})).then(t,(function(t){w("failed to asynchronously prepare wasm: "+t),V(t)}))}var i={a:bt};if(B++,e.monitorRunDependencies&&e.monitorRunDependencies(B),e.instantiateWasm)try{return e.instantiateWasm(i,t)}catch(t){return w("Module.instantiateWasm callback failed with error: "+t),!1}(g||"function"!=typeof WebAssembly.instantiateStreaming||$()||Y.startsWith("file://")||b||"function"!=typeof fetch?r(n):fetch(Y,{credentials:"same-origin"}).then((function(t){return WebAssembly.instantiateStreaming(t,i).then(n,(function(t){return w("wasm streaming compile failed: "+t),w("falling back to ArrayBuffer instantiation"),r(n)}))}))).catch(a)}(),e.___wasm_call_ctors=function(){return(e.___wasm_call_ctors=e.asm.La).apply(null,arguments)},e._OrtInit=function(){return(e._OrtInit=e.asm.Ma).apply(null,arguments)},e._OrtCreateSessionOptions=function(){return(e._OrtCreateSessionOptions=e.asm.Na).apply(null,arguments)},e._OrtAppendExecutionProvider=function(){return(e._OrtAppendExecutionProvider=e.asm.Oa).apply(null,arguments)},e._OrtAddSessionConfigEntry=function(){return(e._OrtAddSessionConfigEntry=e.asm.Pa).apply(null,arguments)},e._OrtReleaseSessionOptions=function(){return(e._OrtReleaseSessionOptions=e.asm.Qa).apply(null,arguments)},e._OrtCreateSession=function(){return(e._OrtCreateSession=e.asm.Ra).apply(null,arguments)},e._OrtReleaseSession=function(){return(e._OrtReleaseSession=e.asm.Sa).apply(null,arguments)},e._OrtGetInputCount=function(){return(e._OrtGetInputCount=e.asm.Ta).apply(null,arguments)},e._OrtGetOutputCount=function(){return(e._OrtGetOutputCount=e.asm.Ua).apply(null,arguments)},e._OrtGetInputName=function(){return(e._OrtGetInputName=e.asm.Va).apply(null,arguments)},e._OrtGetOutputName=function(){return(e._OrtGetOutputName=e.asm.Wa).apply(null,arguments)},e._OrtFree=function(){return(e._OrtFree=e.asm.Xa).apply(null,arguments)},e._OrtCreateTensor=function(){return(e._OrtCreateTensor=e.asm.Ya).apply(null,arguments)},e._OrtGetTensorData=function(){return(e._OrtGetTensorData=e.asm.Za).apply(null,arguments)},e._OrtReleaseTensor=function(){return(e._OrtReleaseTensor=e.asm._a).apply(null,arguments)},e._OrtCreateRunOptions=function(){return(e._OrtCreateRunOptions=e.asm.$a).apply(null,arguments)},e._OrtAddRunConfigEntry=function(){return(e._OrtAddRunConfigEntry=e.asm.ab).apply(null,arguments)},e._OrtReleaseRunOptions=function(){return(e._OrtReleaseRunOptions=e.asm.bb).apply(null,arguments)},e._OrtRun=function(){return(e._OrtRun=e.asm.cb).apply(null,arguments)},e._OrtEndProfiling=function(){return(e._OrtEndProfiling=e.asm.db).apply(null,arguments)};var mt,gt=e._malloc=function(){return(gt=e._malloc=e.asm.eb).apply(null,arguments)},vt=e._free=function(){return(vt=e._free=e.asm.fb).apply(null,arguments)},wt=e._fflush=function(){return(wt=e._fflush=e.asm.gb).apply(null,arguments)},_t=e.___funcs_on_exit=function(){return(_t=e.___funcs_on_exit=e.asm.hb).apply(null,arguments)},Ot=e._setThrew=function(){return(Ot=e._setThrew=e.asm.jb).apply(null,arguments)},At=e.stackSave=function(){return(At=e.stackSave=e.asm.kb).apply(null,arguments)},St=e.stackRestore=function(){return(St=e.stackRestore=e.asm.lb).apply(null,arguments)},Tt=e.stackAlloc=function(){return(Tt=e.stackAlloc=e.asm.mb).apply(null,arguments)},Et=e.___cxa_can_catch=function(){return(Et=e.___cxa_can_catch=e.asm.nb).apply(null,arguments)},Mt=e.___cxa_is_pointer_type=function(){return(Mt=e.___cxa_is_pointer_type=e.asm.ob).apply(null,arguments)},Ct=e.dynCall_j=function(){return(Ct=e.dynCall_j=e.asm.pb).apply(null,arguments)},xt=e.dynCall_iiiiij=function(){return(xt=e.dynCall_iiiiij=e.asm.qb).apply(null,arguments)},Rt=e.dynCall_jii=function(){return(Rt=e.dynCall_jii=e.asm.rb).apply(null,arguments)},jt=e.dynCall_viiiiij=function(){return(jt=e.dynCall_viiiiij=e.asm.sb).apply(null,arguments)},kt=e.dynCall_vjji=function(){return(kt=e.dynCall_vjji=e.asm.tb).apply(null,arguments)},Dt=e.dynCall_viiijjjii=function(){return(Dt=e.dynCall_viiijjjii=e.asm.ub).apply(null,arguments)},Pt=e.dynCall_iij=function(){return(Pt=e.dynCall_iij=e.asm.vb).apply(null,arguments)},Ut=e.dynCall_ji=function(){return(Ut=e.dynCall_ji=e.asm.wb).apply(null,arguments)},Ft=e.dynCall_iiiiiij=function(){return(Ft=e.dynCall_iiiiiij=e.asm.xb).apply(null,arguments)},It=e.dynCall_iiij=function(){return(It=e.dynCall_iiij=e.asm.yb).apply(null,arguments)};function Wt(){function t(){if(!mt&&(mt=!0,e.calledRun=!0,!C)){if(Z(I),r(e),e.onRuntimeInitialized&&e.onRuntimeInitialized(),e.postRun)for("function"==typeof e.postRun&&(e.postRun=[e.postRun]);e.postRun.length;){var t=e.postRun.shift();H.unshift(t)}Z(H)}}if(!(0<B)){if(e.preRun)for("function"==typeof e.preRun&&(e.preRun=[e.preRun]);e.preRun.length;)z();Z(F),0<B||(e.setStatus?(e.setStatus("Running..."),setTimeout((function(){setTimeout((function(){e.setStatus("")}),1),t()}),1)):t())}}if(e.UTF8ToString=j,e.stringToUTF8=function(t,e,n){return k(t,T,e,n)},e.lengthBytesUTF8=D,e.stackSave=At,e.stackRestore=St,e.stackAlloc=Tt,N=function t(){mt||Wt(),mt||(N=t)},e.preInit)for("function"==typeof e.preInit&&(e.preInit=[e.preInit]);0<e.preInit.length;)e.preInit.pop()();return Wt(),t.ready});t.exports=r},967:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.iterateExtraOptions=void 0,e.iterateExtraOptions=(t,n,r,a)=>{if("object"==typeof t&&null!==t){if(r.has(t))throw new Error("Circular reference in options");r.add(t)}Object.entries(t).forEach((([t,i])=>{const o=n?n+t:t;if("object"==typeof i)(0,e.iterateExtraOptions)(i,o+".",r,a);else if("string"==typeof i||"number"==typeof i)a(o,i.toString());else{if("boolean"!=typeof i)throw new Error("Can\'t handle extra config type: "+typeof i);a(o,i?"1":"0")}}))}},586:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.setRunOptions=void 0;const r=n(967),a=n(983),i=n(361);e.setRunOptions=t=>{const e=(0,i.getInstance)();let n=0;const o=[],u=t||{};try{if(void 0===(null==t?void 0:t.logSeverityLevel))u.logSeverityLevel=2;else if("number"!=typeof t.logSeverityLevel||!Number.isInteger(t.logSeverityLevel)||t.logSeverityLevel<0||t.logSeverityLevel>4)throw new Error(`log serverity level is not valid: ${t.logSeverityLevel}`);if(void 0===(null==t?void 0:t.logVerbosityLevel))u.logVerbosityLevel=0;else if("number"!=typeof t.logVerbosityLevel||!Number.isInteger(t.logVerbosityLevel))throw new Error(`log verbosity level is not valid: ${t.logVerbosityLevel}`);void 0===(null==t?void 0:t.terminate)&&(u.terminate=!1);let i=0;if(void 0!==(null==t?void 0:t.tag)&&(i=(0,a.allocWasmString)(t.tag,o)),n=e._OrtCreateRunOptions(u.logSeverityLevel,u.logVerbosityLevel,!!u.terminate,i),0===n)throw new Error("Can\'t create run options");return void 0!==(null==t?void 0:t.extra)&&(0,r.iterateExtraOptions)(t.extra,"",new WeakSet,((t,r)=>{const i=(0,a.allocWasmString)(t,o),u=(0,a.allocWasmString)(r,o);if(0!==e._OrtAddRunConfigEntry(n,i,u))throw new Error(`Can\'t set a run config entry: ${t} - ${r}`)})),[n,o]}catch(t){throw 0!==n&&e._OrtReleaseRunOptions(n),o.forEach(e._free),t}}},919:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.setSessionOptions=void 0;const r=n(967),a=n(983),i=n(361);e.setSessionOptions=t=>{const e=(0,i.getInstance)();let n=0;const o=[],u=t||{};(t=>{t.extra||(t.extra={}),t.extra.session||(t.extra.session={});const e=t.extra.session;e.use_ort_model_bytes_directly||(e.use_ort_model_bytes_directly="1")})(u);try{void 0===(null==t?void 0:t.graphOptimizationLevel)&&(u.graphOptimizationLevel="all");const c=(t=>{switch(t){case"disabled":return 0;case"basic":return 1;case"extended":return 2;case"all":return 99;default:throw new Error(`unsupported graph optimization level: ${t}`)}})(u.graphOptimizationLevel);void 0===(null==t?void 0:t.enableCpuMemArena)&&(u.enableCpuMemArena=!0),void 0===(null==t?void 0:t.enableMemPattern)&&(u.enableMemPattern=!0),void 0===(null==t?void 0:t.executionMode)&&(u.executionMode="sequential");const s=(t=>{switch(t){case"sequential":return 0;case"parallel":return 1;default:throw new Error(`unsupported execution mode: ${t}`)}})(u.executionMode);let l=0;if(void 0!==(null==t?void 0:t.logId)&&(l=(0,a.allocWasmString)(t.logId,o)),void 0===(null==t?void 0:t.logSeverityLevel))u.logSeverityLevel=2;else if("number"!=typeof t.logSeverityLevel||!Number.isInteger(t.logSeverityLevel)||t.logSeverityLevel<0||t.logSeverityLevel>4)throw new Error(`log serverity level is not valid: ${t.logSeverityLevel}`);if(void 0===(null==t?void 0:t.logVerbosityLevel))u.logVerbosityLevel=0;else if("number"!=typeof t.logVerbosityLevel||!Number.isInteger(t.logVerbosityLevel))throw new Error(`log verbosity level is not valid: ${t.logVerbosityLevel}`);if(void 0===(null==t?void 0:t.enableProfiling)&&(u.enableProfiling=!1),n=e._OrtCreateSessionOptions(c,!!u.enableCpuMemArena,!!u.enableMemPattern,s,!!u.enableProfiling,0,l,u.logSeverityLevel,u.logVerbosityLevel),0===n)throw new Error("Can\'t create session options");return(null==t?void 0:t.executionProviders)&&((t,e,n)=>{for(const r of e){let e="string"==typeof r?r:r.name;switch(e){case"xnnpack":e="XNNPACK";break;case"wasm":case"cpu":continue;default:throw new Error(`not supported EP: ${e}`)}const o=(0,a.allocWasmString)(e,n);if(0!==(0,i.getInstance)()._OrtAppendExecutionProvider(t,o))throw new Error(`Can\'t append execution provider: ${e}`)}})(n,t.executionProviders,o),void 0!==(null==t?void 0:t.extra)&&(0,r.iterateExtraOptions)(t.extra,"",new WeakSet,((t,r)=>{const i=(0,a.allocWasmString)(t,o),u=(0,a.allocWasmString)(r,o);if(0!==e._OrtAddSessionConfigEntry(n,i,u))throw new Error(`Can\'t set a session config entry: ${t} - ${r}`)})),[n,o]}catch(t){throw 0!==n&&e._OrtReleaseSessionOptions(n),o.forEach(e._free),t}}},983:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.allocWasmString=void 0;const r=n(361);e.allocWasmString=(t,e)=>{const n=(0,r.getInstance)(),a=n.lengthBytesUTF8(t)+1,i=n._malloc(a);return n.stringToUTF8(t,i,a),e.push(i),i}},349:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.extractTransferableBuffers=e.endProfiling=e.run=e.releaseSession=e.createSession=e.createSessionFinalize=e.createSessionAllocate=e.initOrt=void 0;const r=n(586),a=n(919),i=n(983),o=n(361);e.initOrt=(t,e)=>{const n=(0,o.getInstance)()._OrtInit(t,e);if(0!==n)throw new Error(`Can\'t initialize onnxruntime. error code = ${n}`)};const u=new Map;e.createSessionAllocate=t=>{const e=(0,o.getInstance)(),n=e._malloc(t.byteLength);return e.HEAPU8.set(t,n),[n,t.byteLength]},e.createSessionFinalize=(t,e)=>{const n=(0,o.getInstance)();let r=0,i=0,c=[];try{if([i,c]=(0,a.setSessionOptions)(e),r=n._OrtCreateSession(t[0],t[1],i),0===r)throw new Error("Can\'t create a session")}finally{n._free(t[0]),n._OrtReleaseSessionOptions(i),c.forEach(n._free)}const s=n._OrtGetInputCount(r),l=n._OrtGetOutputCount(r),f=[],p=[],h=[],d=[];for(let t=0;t<s;t++){const e=n._OrtGetInputName(r,t);if(0===e)throw new Error("Can\'t get an input name");p.push(e),f.push(n.UTF8ToString(e))}for(let t=0;t<l;t++){const e=n._OrtGetOutputName(r,t);if(0===e)throw new Error("Can\'t get an output name");d.push(e),h.push(n.UTF8ToString(e))}return u.set(r,[r,p,d]),[r,f,h]},e.createSession=(t,n)=>{const r=(0,e.createSessionAllocate)(t);return(0,e.createSessionFinalize)(r,n)},e.releaseSession=t=>{const e=(0,o.getInstance)(),n=u.get(t);if(!n)throw new Error("invalid session id");const r=n[0],a=n[1],i=n[2];a.forEach(e._OrtFree),i.forEach(e._OrtFree),e._OrtReleaseSession(r),u.delete(t)};const c=t=>{switch(t){case"int8":return 3;case"uint8":return 2;case"bool":return 9;case"int16":return 5;case"uint16":return 4;case"int32":return 6;case"uint32":return 12;case"float32":return 1;case"float64":return 11;case"string":return 8;case"int64":return 7;case"uint64":return 13;default:throw new Error(`unsupported data type: ${t}`)}},s=t=>{switch(t){case 3:return"int8";case 2:return"uint8";case 9:return"bool";case 5:return"int16";case 4:return"uint16";case 6:return"int32";case 12:return"uint32";case 1:return"float32";case 11:return"float64";case 8:return"string";case 7:return"int64";case 13:return"uint64";default:throw new Error(`unsupported data type: ${t}`)}},l=t=>{switch(t){case"float32":return Float32Array;case"uint8":case"bool":return Uint8Array;case"int8":return Int8Array;case"uint16":return Uint16Array;case"int16":return Int16Array;case"int32":return Int32Array;case"float64":return Float64Array;case"uint32":return Uint32Array;case"int64":return BigInt64Array;case"uint64":return BigUint64Array;default:throw new Error(`unsupported type: ${t}`)}};e.run=(t,e,n,a,f)=>{const p=(0,o.getInstance)(),h=u.get(t);if(!h)throw new Error("invalid session id");const d=h[0],y=h[1],b=h[2],m=e.length,g=a.length;let v=0,w=[];const _=[],O=[];try{[v,w]=(0,r.setRunOptions)(f);for(let t=0;t<m;t++){const e=n[t][0],r=n[t][1],a=n[t][2];let o,u;if(Array.isArray(a)){u=4*a.length,o=p._malloc(u),O.push(o);let t=o/4;for(let e=0;e<a.length;e++){if("string"!=typeof a[e])throw new TypeError(`tensor data at index ${e} is not a string`);p.HEAPU32[t++]=(0,i.allocWasmString)(a[e],O)}}else u=a.byteLength,o=p._malloc(u),O.push(o),p.HEAPU8.set(new Uint8Array(a.buffer,a.byteOffset,u),o);const s=p.stackSave(),l=p.stackAlloc(4*r.length);try{let t=l/4;r.forEach((e=>p.HEAP32[t++]=e));const n=p._OrtCreateTensor(c(e),o,u,l,r.length);if(0===n)throw new Error("Can\'t create a tensor");_.push(n)}finally{p.stackRestore(s)}}const t=p.stackSave(),o=p.stackAlloc(4*m),u=p.stackAlloc(4*m),h=p.stackAlloc(4*g),A=p.stackAlloc(4*g);try{let n=o/4,r=u/4,i=h/4,c=A/4;for(let t=0;t<m;t++)p.HEAPU32[n++]=_[t],p.HEAPU32[r++]=y[e[t]];for(let t=0;t<g;t++)p.HEAPU32[i++]=0,p.HEAPU32[c++]=b[a[t]];let f=p._OrtRun(d,u,o,m,A,g,h,v);const w=[];if(0===f)for(let t=0;t<g;t++){const e=p.HEAPU32[h/4+t],n=p.stackSave(),r=p.stackAlloc(16);let a,i=0;try{if(f=p._OrtGetTensorData(e,r,r+4,r+8,r+12),0!==f)throw new Error(`Can\'t access output tensor data. error code = ${f}`);let t=r/4;const o=p.HEAPU32[t++];i=p.HEAPU32[t++];const u=p.HEAPU32[t++],c=p.HEAPU32[t++],h=[];for(let t=0;t<c;t++)h.push(p.HEAPU32[u/4+t]);p._OrtFree(u);const d=0===h.length?1:h.reduce(((t,e)=>t*e));if(a=s(o),"string"===a){const t=[];let e=i/4;for(let n=0;n<d;n++){const r=p.HEAPU32[e++],a=n===d-1?void 0:p.HEAPU32[e]-r;t.push(p.UTF8ToString(r,a))}w.push([a,h,t])}else{const t=new(l(a))(d);new Uint8Array(t.buffer,t.byteOffset,t.byteLength).set(p.HEAPU8.subarray(i,i+t.byteLength)),w.push([a,h,t])}}finally{p.stackRestore(n),"string"===a&&i&&p._free(i),p._OrtReleaseTensor(e)}}if(0===f)return w;throw new Error(`failed to call OrtRun(). error code = ${f}.`)}finally{p.stackRestore(t)}}finally{_.forEach(p._OrtReleaseTensor),O.forEach(p._free),p._OrtReleaseRunOptions(v),w.forEach(p._free)}},e.endProfiling=t=>{const e=(0,o.getInstance)(),n=u.get(t);if(!n)throw new Error("invalid session id");const r=n[0],a=e._OrtEndProfiling(r);if(0===a)throw new Error("Can\'t get an profile file name");e._OrtFree(a)},e.extractTransferableBuffers=t=>{const e=[];for(const n of t){const t=n[2];!Array.isArray(t)&&t.buffer&&e.push(t.buffer)}return e}},361:function(t,e,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(t,e,n,r){void 0===r&&(r=n);var a=Object.getOwnPropertyDescriptor(e,n);a&&!("get"in a?!e.__esModule:a.writable||a.configurable)||(a={enumerable:!0,get:function(){return e[n]}}),Object.defineProperty(t,r,a)}:function(t,e,n,r){void 0===r&&(r=n),t[r]=e[n]}),a=this&&this.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),i=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)"default"!==n&&Object.prototype.hasOwnProperty.call(t,n)&&r(e,t,n);return a(e,t),e},o=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.dispose=e.getInstance=e.initializeWebAssembly=void 0;const u=i(n(449)),c=o(n(932)),s=n(474);let l,f=!1,p=!1,h=!1;const d=(t,e)=>e?t?"ort-wasm-simd-threaded.wasm":"ort-wasm-threaded.wasm":t?"ort-wasm-simd.wasm":"ort-wasm.wasm";e.initializeWebAssembly=async t=>{if(f)return Promise.resolve();if(p)throw new Error("multiple calls to \'initializeWebAssembly()\' detected.");if(h)throw new Error("previous call to \'initializeWebAssembly()\' failed.");p=!0;const e=t.initTimeout,r=t.numThreads,a=t.simd,i=r>1&&(()=>{try{return"undefined"!=typeof SharedArrayBuffer&&("undefined"!=typeof MessageChannel&&(new MessageChannel).port1.postMessage(new SharedArrayBuffer(1)),WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,5,4,1,3,1,1,10,11,1,9,0,65,0,254,16,2,0,26,11])))}catch(t){return!1}})(),o=a&&(()=>{try{return WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,10,30,1,28,0,65,0,253,15,253,12,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,253,186,1,26,11]))}catch(t){return!1}})(),y="string"==typeof t.wasmPaths?t.wasmPaths:void 0,b=d(!1,i),m=d(o,i),g="object"==typeof t.wasmPaths?t.wasmPaths[m]:void 0;let v=!1;const w=[];if(e>0&&w.push(new Promise((t=>{setTimeout((()=>{v=!0,t()}),e)}))),w.push(new Promise(((t,e)=>{const r=i?s:c.default,a={locateFile:(t,e)=>i&&t.endsWith(".worker.js")&&"undefined"!=typeof Blob?URL.createObjectURL(new Blob([n(154)],{type:"text/javascript"})):t===b?null!=g?g:(null!=y?y:e)+m:e+t};if(i)if("undefined"==typeof Blob)a.mainScriptUrlOrBlob=u.join("/","ort-wasm-threaded.js");else{const t=`var ortWasmThreaded=(function(){var _scriptDir;return ${r.toString()}})();`;a.mainScriptUrlOrBlob=new Blob([t],{type:"text/javascript"})}r(a).then((e=>{p=!1,f=!0,l=e,t()}),(t=>{p=!1,h=!0,e(t)}))}))),await Promise.race(w),v)throw new Error(`WebAssembly backend initializing failed due to timeout: ${e}ms`)},e.getInstance=()=>{if(f&&l)return l;throw new Error("WebAssembly is not initialized yet.")},e.dispose=()=>{var t;!f||p||h||(p=!0,null===(t=l.PThread)||void 0===t||t.terminateAllThreads(),l=void 0,p=!1,f=!1,h=!0)}},154:t=>{"use strict";t.exports=\'"use strict";var e={},t="object"==typeof process&&"object"==typeof process.versions&&"string"==typeof process.versions.node;if(t){var r=require("worker_threads"),a=r.parentPort;a.on("message",(e=>onmessage({data:e})));var o=require("fs");Object.assign(global,{self:global,require:require,Module:e,location:{href:__filename},Worker:r.Worker,importScripts:function(e){(0,eval)(o.readFileSync(e,"utf8"))},postMessage:function(e){a.postMessage(e)},performance:global.performance||{now:function(){return Date.now()}}})}var s=!1,n=[],i=function(){var e=Array.prototype.slice.call(arguments).join(" ");t?o.writeSync(2,e+"\\\\n"):console.error(e)};self.alert=function(){var t=Array.prototype.slice.call(arguments).join(" ");postMessage({cmd:"alert",text:t,threadId:e._pthread_self()})},e.instantiateWasm=(t,r)=>{var a=new WebAssembly.Instance(e.wasmModule,t);return r(a),e.wasmModule=null,a.exports},self.onunhandledrejection=e=>{throw e.reason??e},self.onmessage=t=>{try{if("load"===t.data.cmd){if(e.wasmModule=t.data.wasmModule,e.wasmMemory=t.data.wasmMemory,e.buffer=e.wasmMemory.buffer,e.ENVIRONMENT_IS_PTHREAD=!0,"string"==typeof t.data.urlOrBlob)importScripts(t.data.urlOrBlob);else{var r=URL.createObjectURL(t.data.urlOrBlob);importScripts(r),URL.revokeObjectURL(r)}ortWasmThreaded(e).then((function(t){e=t}))}else if("run"===t.data.cmd){e.__performance_now_clock_drift=performance.now()-t.data.time,e.__emscripten_thread_init(t.data.pthread_ptr,0,0,1),e.establishStackSpace(),e.PThread.receiveObjectTransfer(t.data),e.PThread.threadInitTLS(),s||(n.forEach((t=>{e.executeNotifiedProxyingQueue(t)})),n=[],s=!0);try{e.invokeEntryPoint(t.data.start_routine,t.data.arg)}catch(t){if("unwind"!=t){if(!(t instanceof e.ExitStatus))throw t;e.keepRuntimeAlive()||e.__emscripten_thread_exit(t.status)}}}else"cancel"===t.data.cmd?e._pthread_self()&&e.__emscripten_thread_exit(-1):"setimmediate"===t.data.target||("processProxyingQueue"===t.data.cmd?s?e.executeNotifiedProxyingQueue(t.data.queue):n.push(t.data.queue):(i("worker.js received unknown command "+t.data.cmd),i(t.data)))}catch(t){throw i("worker.js onmessage() captured an uncaught exception: "+t),t&&t.stack&&i(t.stack),e.__emscripten_thread_crashed&&e.__emscripten_thread_crashed(),t}};\\n\'},384:()=>{},993:()=>{},908:()=>{},953:()=>{},925:()=>{},449:()=>{}},e={};function n(r){var a=e[r];if(void 0!==a)return a.exports;var i=e[r]={exports:{}};return t[r].call(i.exports,i,i.exports,n),i.exports}n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),(()=>{"use strict";const t=n(349),e=n(361);self.onmessage=n=>{switch(n.data.type){case"init-wasm":(0,e.initializeWebAssembly)(n.data.in).then((()=>postMessage({type:"init-wasm"})),(t=>postMessage({type:"init-wasm",err:t})));break;case"init-ort":try{const{numThreads:e,loggingLevel:r}=n.data.in;(0,t.initOrt)(e,r),postMessage({type:"init-ort"})}catch(t){postMessage({type:"init-ort",err:t})}break;case"create_allocate":try{const{model:e}=n.data.in,r=(0,t.createSessionAllocate)(e);postMessage({type:"create_allocate",out:r})}catch(t){postMessage({type:"create_allocate",err:t})}break;case"create_finalize":try{const{modeldata:e,options:r}=n.data.in,a=(0,t.createSessionFinalize)(e,r);postMessage({type:"create_finalize",out:a})}catch(t){postMessage({type:"create_finalize",err:t})}break;case"create":try{const{model:e,options:r}=n.data.in,a=(0,t.createSession)(e,r);postMessage({type:"create",out:a})}catch(t){postMessage({type:"create",err:t})}break;case"release":try{const e=n.data.in;(0,t.releaseSession)(e),postMessage({type:"release"})}catch(t){postMessage({type:"release",err:t})}break;case"run":try{const{sessionId:e,inputIndices:r,inputs:a,outputIndices:i,options:o}=n.data.in,u=(0,t.run)(e,r,a,i,o);postMessage({type:"run",out:u},(0,t.extractTransferableBuffers)(u))}catch(t){postMessage({type:"run",err:t})}break;case"end-profiling":try{const e=n.data.in;(0,t.endProfiling)(e),postMessage({type:"end-profiling"})}catch(t){postMessage({type:"end-profiling",err:t})}}}})()})();\n',"Worker",void 0,void 0)}},477:e=>{"use strict";e.exports=function(e,t,n,r){var i=self||window;try{try{try{s=new i.Blob([e])}catch(t){(s=new(i.BlobBuilder||i.WebKitBlobBuilder||i.MozBlobBuilder||i.MSBlobBuilder)).append(e),s=s.getBlob()}var s,a=i.URL||i.webkitURL,o=a.createObjectURL(s),l=new i[t](o,n);return a.revokeObjectURL(o),l}catch(r){return new i[t]("data:application/javascript,".concat(encodeURIComponent(e)),n)}}catch(e){if(!r)throw Error("Inline worker is not supported");return new i[t](r,n)}}},4154:e=>{"use strict";e.exports='"use strict";var e={},t="object"==typeof process&&"object"==typeof process.versions&&"string"==typeof process.versions.node;if(t){var r=require("worker_threads"),a=r.parentPort;a.on("message",(e=>onmessage({data:e})));var o=require("fs");Object.assign(global,{self:global,require:require,Module:e,location:{href:__filename},Worker:r.Worker,importScripts:function(e){(0,eval)(o.readFileSync(e,"utf8"))},postMessage:function(e){a.postMessage(e)},performance:global.performance||{now:function(){return Date.now()}}})}var s=!1,n=[],i=function(){var e=Array.prototype.slice.call(arguments).join(" ");t?o.writeSync(2,e+"\\n"):console.error(e)};self.alert=function(){var t=Array.prototype.slice.call(arguments).join(" ");postMessage({cmd:"alert",text:t,threadId:e._pthread_self()})},e.instantiateWasm=(t,r)=>{var a=new WebAssembly.Instance(e.wasmModule,t);return r(a),e.wasmModule=null,a.exports},self.onunhandledrejection=e=>{throw e.reason??e},self.onmessage=t=>{try{if("load"===t.data.cmd){if(e.wasmModule=t.data.wasmModule,e.wasmMemory=t.data.wasmMemory,e.buffer=e.wasmMemory.buffer,e.ENVIRONMENT_IS_PTHREAD=!0,"string"==typeof t.data.urlOrBlob)importScripts(t.data.urlOrBlob);else{var r=URL.createObjectURL(t.data.urlOrBlob);importScripts(r),URL.revokeObjectURL(r)}ortWasmThreaded(e).then((function(t){e=t}))}else if("run"===t.data.cmd){e.__performance_now_clock_drift=performance.now()-t.data.time,e.__emscripten_thread_init(t.data.pthread_ptr,0,0,1),e.establishStackSpace(),e.PThread.receiveObjectTransfer(t.data),e.PThread.threadInitTLS(),s||(n.forEach((t=>{e.executeNotifiedProxyingQueue(t)})),n=[],s=!0);try{e.invokeEntryPoint(t.data.start_routine,t.data.arg)}catch(t){if("unwind"!=t){if(!(t instanceof e.ExitStatus))throw t;e.keepRuntimeAlive()||e.__emscripten_thread_exit(t.status)}}}else"cancel"===t.data.cmd?e._pthread_self()&&e.__emscripten_thread_exit(-1):"setimmediate"===t.data.target||("processProxyingQueue"===t.data.cmd?s?e.executeNotifiedProxyingQueue(t.data.queue):n.push(t.data.queue):(i("worker.js received unknown command "+t.data.cmd),i(t.data)))}catch(t){throw i("worker.js onmessage() captured an uncaught exception: "+t),t&&t.stack&&i(t.stack),e.__emscripten_thread_crashed&&e.__emscripten_thread_crashed(),t}};\n'},1670:e=>{"use strict";e.exports=__WEBPACK_EXTERNAL_MODULE__1670__},7067:()=>{},1296:()=>{},1384:()=>{},3993:()=>{},908:()=>{},6953:()=>{},9925:()=>{},2806:()=>{},6449:()=>{},2850:()=>{},5381:()=>{},5686:(e,t,n)=>{"use strict";n.r(t),n.d(t,{flatbuffers:()=>r});var r={};r.Offset,r.Table,r.SIZEOF_SHORT=2,r.SIZEOF_INT=4,r.FILE_IDENTIFIER_LENGTH=4,r.SIZE_PREFIX_LENGTH=4,r.Encoding={UTF8_BYTES:1,UTF16_STRING:2},r.int32=new Int32Array(2),r.float32=new Float32Array(r.int32.buffer),r.float64=new Float64Array(r.int32.buffer),r.isLittleEndian=1===new Uint16Array(new Uint8Array([1,0]).buffer)[0],r.Long=function(e,t){this.low=0|e,this.high=0|t},r.Long.create=function(e,t){return 0==e&&0==t?r.Long.ZERO:new r.Long(e,t)},r.Long.prototype.toFloat64=function(){return(this.low>>>0)+0x100000000*this.high},r.Long.prototype.equals=function(e){return this.low==e.low&&this.high==e.high},r.Long.ZERO=new r.Long(0,0),r.Builder=function(e){if(e)t=e;else var t=1024;this.bb=r.ByteBuffer.allocate(t),this.space=t,this.minalign=1,this.vtable=null,this.vtable_in_use=0,this.isNested=!1,this.object_start=0,this.vtables=[],this.vector_num_elems=0,this.force_defaults=!1},r.Builder.prototype.clear=function(){this.bb.clear(),this.space=this.bb.capacity(),this.minalign=1,this.vtable=null,this.vtable_in_use=0,this.isNested=!1,this.object_start=0,this.vtables=[],this.vector_num_elems=0,this.force_defaults=!1},r.Builder.prototype.forceDefaults=function(e){this.force_defaults=e},r.Builder.prototype.dataBuffer=function(){return this.bb},r.Builder.prototype.asUint8Array=function(){return this.bb.bytes().subarray(this.bb.position(),this.bb.position()+this.offset())},r.Builder.prototype.prep=function(e,t){e>this.minalign&&(this.minalign=e);for(var n=1+~(this.bb.capacity()-this.space+t)&e-1;this.space<n+e+t;){var i=this.bb.capacity();this.bb=r.Builder.growByteBuffer(this.bb),this.space+=this.bb.capacity()-i}this.pad(n)},r.Builder.prototype.pad=function(e){for(var t=0;t<e;t++)this.bb.writeInt8(--this.space,0)},r.Builder.prototype.writeInt8=function(e){this.bb.writeInt8(this.space-=1,e)},r.Builder.prototype.writeInt16=function(e){this.bb.writeInt16(this.space-=2,e)},r.Builder.prototype.writeInt32=function(e){this.bb.writeInt32(this.space-=4,e)},r.Builder.prototype.writeInt64=function(e){this.bb.writeInt64(this.space-=8,e)},r.Builder.prototype.writeFloat32=function(e){this.bb.writeFloat32(this.space-=4,e)},r.Builder.prototype.writeFloat64=function(e){this.bb.writeFloat64(this.space-=8,e)},r.Builder.prototype.addInt8=function(e){this.prep(1,0),this.writeInt8(e)},r.Builder.prototype.addInt16=function(e){this.prep(2,0),this.writeInt16(e)},r.Builder.prototype.addInt32=function(e){this.prep(4,0),this.writeInt32(e)},r.Builder.prototype.addInt64=function(e){this.prep(8,0),this.writeInt64(e)},r.Builder.prototype.addFloat32=function(e){this.prep(4,0),this.writeFloat32(e)},r.Builder.prototype.addFloat64=function(e){this.prep(8,0),this.writeFloat64(e)},r.Builder.prototype.addFieldInt8=function(e,t,n){(this.force_defaults||t!=n)&&(this.addInt8(t),this.slot(e))},r.Builder.prototype.addFieldInt16=function(e,t,n){(this.force_defaults||t!=n)&&(this.addInt16(t),this.slot(e))},r.Builder.prototype.addFieldInt32=function(e,t,n){(this.force_defaults||t!=n)&&(this.addInt32(t),this.slot(e))},r.Builder.prototype.addFieldInt64=function(e,t,n){!this.force_defaults&&t.equals(n)||(this.addInt64(t),this.slot(e))},r.Builder.prototype.addFieldFloat32=function(e,t,n){(this.force_defaults||t!=n)&&(this.addFloat32(t),this.slot(e))},r.Builder.prototype.addFieldFloat64=function(e,t,n){(this.force_defaults||t!=n)&&(this.addFloat64(t),this.slot(e))},r.Builder.prototype.addFieldOffset=function(e,t,n){(this.force_defaults||t!=n)&&(this.addOffset(t),this.slot(e))},r.Builder.prototype.addFieldStruct=function(e,t,n){t!=n&&(this.nested(t),this.slot(e))},r.Builder.prototype.nested=function(e){if(e!=this.offset())throw Error("FlatBuffers: struct must be serialized inline.")},r.Builder.prototype.notNested=function(){if(this.isNested)throw Error("FlatBuffers: object serialization must not be nested.")},r.Builder.prototype.slot=function(e){this.vtable[e]=this.offset()},r.Builder.prototype.offset=function(){return this.bb.capacity()-this.space},r.Builder.growByteBuffer=function(e){var t=e.capacity();if(0xc0000000&t)throw Error("FlatBuffers: cannot grow buffer beyond 2 gigabytes.");var n=t<<1,i=r.ByteBuffer.allocate(n);return i.setPosition(n-t),i.bytes().set(e.bytes(),n-t),i},r.Builder.prototype.addOffset=function(e){this.prep(r.SIZEOF_INT,0),this.writeInt32(this.offset()-e+r.SIZEOF_INT)},r.Builder.prototype.startObject=function(e){this.notNested(),null==this.vtable&&(this.vtable=[]),this.vtable_in_use=e;for(var t=0;t<e;t++)this.vtable[t]=0;this.isNested=!0,this.object_start=this.offset()},r.Builder.prototype.endObject=function(){if(null==this.vtable||!this.isNested)throw Error("FlatBuffers: endObject called without startObject");this.addInt32(0);for(var e=this.offset(),t=this.vtable_in_use-1;t>=0&&0==this.vtable[t];t--);for(var n=t+1;t>=0;t--)this.addInt16(0!=this.vtable[t]?e-this.vtable[t]:0);this.addInt16(e-this.object_start);var i=(n+2)*r.SIZEOF_SHORT;this.addInt16(i);var s=0,a=this.space;e:for(t=0;t<this.vtables.length;t++){var o=this.bb.capacity()-this.vtables[t];if(i==this.bb.readInt16(o)){for(var l=r.SIZEOF_SHORT;l<i;l+=r.SIZEOF_SHORT)if(this.bb.readInt16(a+l)!=this.bb.readInt16(o+l))continue e;s=this.vtables[t];break}}return s?(this.space=this.bb.capacity()-e,this.bb.writeInt32(this.space,s-e)):(this.vtables.push(this.offset()),this.bb.writeInt32(this.bb.capacity()-e,this.offset()-e)),this.isNested=!1,e},r.Builder.prototype.finish=function(e,t,n){var i=n?r.SIZE_PREFIX_LENGTH:0;if(t){var s=t;if(this.prep(this.minalign,r.SIZEOF_INT+r.FILE_IDENTIFIER_LENGTH+i),s.length!=r.FILE_IDENTIFIER_LENGTH)throw Error("FlatBuffers: file identifier must be length "+r.FILE_IDENTIFIER_LENGTH);for(var a=r.FILE_IDENTIFIER_LENGTH-1;a>=0;a--)this.writeInt8(s.charCodeAt(a))}this.prep(this.minalign,r.SIZEOF_INT+i),this.addOffset(e),i&&this.addInt32(this.bb.capacity()-this.space),this.bb.setPosition(this.space)},r.Builder.prototype.finishSizePrefixed=function(e,t){this.finish(e,t,!0)},r.Builder.prototype.requiredField=function(e,t){var n=this.bb.capacity()-e,r=n-this.bb.readInt32(n);if(0==this.bb.readInt16(r+t))throw Error("FlatBuffers: field "+t+" must be set")},r.Builder.prototype.startVector=function(e,t,n){this.notNested(),this.vector_num_elems=t,this.prep(r.SIZEOF_INT,e*t),this.prep(n,e*t)},r.Builder.prototype.endVector=function(){return this.writeInt32(this.vector_num_elems),this.offset()},r.Builder.prototype.createString=function(e){if(e instanceof Uint8Array)var t=e;else{t=[];for(var n=0;n<e.length;){var r,i=e.charCodeAt(n++);(r=i<55296||i>=56320?i:(i<<10)+e.charCodeAt(n++)+-0x35fdc00)<128?t.push(r):(r<2048?t.push(r>>6&31|192):(r<65536?t.push(r>>12&15|224):t.push(r>>18&7|240,r>>12&63|128),t.push(r>>6&63|128)),t.push(63&r|128))}}this.addInt8(0),this.startVector(1,t.length,1),this.bb.setPosition(this.space-=t.length),n=0;for(var s=this.space,a=this.bb.bytes();n<t.length;n++)a[s++]=t[n];return this.endVector()},r.Builder.prototype.createLong=function(e,t){return r.Long.create(e,t)},r.ByteBuffer=function(e){this.bytes_=e,this.position_=0},r.ByteBuffer.allocate=function(e){return new r.ByteBuffer(new Uint8Array(e))},r.ByteBuffer.prototype.clear=function(){this.position_=0},r.ByteBuffer.prototype.bytes=function(){return this.bytes_},r.ByteBuffer.prototype.position=function(){return this.position_},r.ByteBuffer.prototype.setPosition=function(e){this.position_=e},r.ByteBuffer.prototype.capacity=function(){return this.bytes_.length},r.ByteBuffer.prototype.readInt8=function(e){return this.readUint8(e)<<24>>24},r.ByteBuffer.prototype.readUint8=function(e){return this.bytes_[e]},r.ByteBuffer.prototype.readInt16=function(e){return this.readUint16(e)<<16>>16},r.ByteBuffer.prototype.readUint16=function(e){return this.bytes_[e]|this.bytes_[e+1]<<8},r.ByteBuffer.prototype.readInt32=function(e){return this.bytes_[e]|this.bytes_[e+1]<<8|this.bytes_[e+2]<<16|this.bytes_[e+3]<<24},r.ByteBuffer.prototype.readUint32=function(e){return this.readInt32(e)>>>0},r.ByteBuffer.prototype.readInt64=function(e){return new r.Long(this.readInt32(e),this.readInt32(e+4))},r.ByteBuffer.prototype.readUint64=function(e){return new r.Long(this.readUint32(e),this.readUint32(e+4))},r.ByteBuffer.prototype.readFloat32=function(e){return r.int32[0]=this.readInt32(e),r.float32[0]},r.ByteBuffer.prototype.readFloat64=function(e){return r.int32[r.isLittleEndian?0:1]=this.readInt32(e),r.int32[r.isLittleEndian?1:0]=this.readInt32(e+4),r.float64[0]},r.ByteBuffer.prototype.writeInt8=function(e,t){this.bytes_[e]=t},r.ByteBuffer.prototype.writeUint8=function(e,t){this.bytes_[e]=t},r.ByteBuffer.prototype.writeInt16=function(e,t){this.bytes_[e]=t,this.bytes_[e+1]=t>>8},r.ByteBuffer.prototype.writeUint16=function(e,t){this.bytes_[e]=t,this.bytes_[e+1]=t>>8},r.ByteBuffer.prototype.writeInt32=function(e,t){this.bytes_[e]=t,this.bytes_[e+1]=t>>8,this.bytes_[e+2]=t>>16,this.bytes_[e+3]=t>>24},r.ByteBuffer.prototype.writeUint32=function(e,t){this.bytes_[e]=t,this.bytes_[e+1]=t>>8,this.bytes_[e+2]=t>>16,this.bytes_[e+3]=t>>24},r.ByteBuffer.prototype.writeInt64=function(e,t){this.writeInt32(e,t.low),this.writeInt32(e+4,t.high)},r.ByteBuffer.prototype.writeUint64=function(e,t){this.writeUint32(e,t.low),this.writeUint32(e+4,t.high)},r.ByteBuffer.prototype.writeFloat32=function(e,t){r.float32[0]=t,this.writeInt32(e,r.int32[0])},r.ByteBuffer.prototype.writeFloat64=function(e,t){r.float64[0]=t,this.writeInt32(e,r.int32[r.isLittleEndian?0:1]),this.writeInt32(e+4,r.int32[r.isLittleEndian?1:0])},r.ByteBuffer.prototype.getBufferIdentifier=function(){if(this.bytes_.length<this.position_+r.SIZEOF_INT+r.FILE_IDENTIFIER_LENGTH)throw Error("FlatBuffers: ByteBuffer is too short to contain an identifier.");for(var e="",t=0;t<r.FILE_IDENTIFIER_LENGTH;t++)e+=String.fromCharCode(this.readInt8(this.position_+r.SIZEOF_INT+t));return e},r.ByteBuffer.prototype.__offset=function(e,t){var n=e-this.readInt32(e);return t<this.readInt16(n)?this.readInt16(n+t):0},r.ByteBuffer.prototype.__union=function(e,t){return e.bb_pos=t+this.readInt32(t),e.bb=this,e},r.ByteBuffer.prototype.__string=function(e,t){e+=this.readInt32(e);var n=this.readInt32(e),i="",s=0;if(e+=r.SIZEOF_INT,t===r.Encoding.UTF8_BYTES)return this.bytes_.subarray(e,e+n);for(;s<n;){var a,o=this.readUint8(e+s++);if(o<192)a=o;else{var l=this.readUint8(e+s++);if(o<224)a=(31&o)<<6|63&l;else{var u=this.readUint8(e+s++);a=o<240?(15&o)<<12|(63&l)<<6|63&u:(7&o)<<18|(63&l)<<12|(63&u)<<6|63&this.readUint8(e+s++)}}a<65536?i+=String.fromCharCode(a):(a-=65536,i+=String.fromCharCode(55296+(a>>10),56320+(1023&a)))}return i},r.ByteBuffer.prototype.__indirect=function(e){return e+this.readInt32(e)},r.ByteBuffer.prototype.__vector=function(e){return e+this.readInt32(e)+r.SIZEOF_INT},r.ByteBuffer.prototype.__vector_len=function(e){return this.readInt32(e+this.readInt32(e))},r.ByteBuffer.prototype.__has_identifier=function(e){if(e.length!=r.FILE_IDENTIFIER_LENGTH)throw Error("FlatBuffers: file identifier must be length "+r.FILE_IDENTIFIER_LENGTH);for(var t=0;t<r.FILE_IDENTIFIER_LENGTH;t++)if(e.charCodeAt(t)!=this.readInt8(this.position_+r.SIZEOF_INT+t))return!1;return!0},r.ByteBuffer.prototype.createLong=function(e,t){return r.Long.create(e,t)}}},__webpack_module_cache__={};function __nested_webpack_require_546802__(e){var t=__webpack_module_cache__[e];if(void 0!==t)return t.exports;var n=__webpack_module_cache__[e]={exports:{}};return __webpack_modules__[e].call(n.exports,n,n.exports,__nested_webpack_require_546802__),n.exports}__nested_webpack_require_546802__.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return __nested_webpack_require_546802__.d(t,{a:t}),t},__nested_webpack_require_546802__.d=(e,t)=>{for(var n in t)__nested_webpack_require_546802__.o(t,n)&&!__nested_webpack_require_546802__.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},__nested_webpack_require_546802__.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||Function("return this")()}catch(e){if("object"==typeof window)return window}}(),__nested_webpack_require_546802__.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),__nested_webpack_require_546802__.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var __nested_webpack_exports__=__nested_webpack_require_546802__(6018);return __nested_webpack_exports__})())},7526:(e,t)=>{"use strict";t.byteLength=u,t.toByteArray=h,t.fromByteArray=f;for(var n=[],r=[],i="undefined"!=typeof Uint8Array?Uint8Array:Array,s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",a=0,o=s.length;a<o;++a)n[a]=s[a],r[s.charCodeAt(a)]=a;function l(e){var t=e.length;if(t%4>0)throw Error("Invalid string. Length must be a multiple of 4");var n=e.indexOf("=");-1===n&&(n=t);var r=n===t?0:4-n%4;return[n,r]}function u(e){var t=l(e),n=t[0],r=t[1];return(n+r)*3/4-r}function c(e,t,n){return(t+n)*3/4-n}function h(e){var t,n,s=l(e),a=s[0],o=s[1],u=new i(c(e,a,o)),h=0,d=o>0?a-4:a;for(n=0;n<d;n+=4)t=r[e.charCodeAt(n)]<<18|r[e.charCodeAt(n+1)]<<12|r[e.charCodeAt(n+2)]<<6|r[e.charCodeAt(n+3)],u[h++]=t>>16&255,u[h++]=t>>8&255,u[h++]=255&t;return 2===o&&(t=r[e.charCodeAt(n)]<<2|r[e.charCodeAt(n+1)]>>4,u[h++]=255&t),1===o&&(t=r[e.charCodeAt(n)]<<10|r[e.charCodeAt(n+1)]<<4|r[e.charCodeAt(n+2)]>>2,u[h++]=t>>8&255,u[h++]=255&t),u}function d(e){return n[e>>18&63]+n[e>>12&63]+n[e>>6&63]+n[63&e]}function p(e,t,n){for(var r=[],i=t;i<n;i+=3)r.push(d((e[i]<<16&0xff0000)+(e[i+1]<<8&65280)+(255&e[i+2])));return r.join("")}function f(e){for(var t,r=e.length,i=r%3,s=[],a=16383,o=0,l=r-i;o<l;o+=a)s.push(p(e,o,o+a>l?l:o+a));return 1===i?s.push(n[(t=e[r-1])>>2]+n[t<<4&63]+"=="):2===i&&s.push(n[(t=(e[r-2]<<8)+e[r-1])>>10]+n[t>>4&63]+n[t<<2&63]+"="),s.join("")}r["-".charCodeAt(0)]=62,r["_".charCodeAt(0)]=63},8287:(e,t,n)=>{"use strict";var r,i=n(7526),s=n(251),a="function"==typeof Symbol&&"function"==typeof Symbol.for?Symbol.for("nodejs.util.inspect.custom"):null;t.hp=c,r=_,t.IS=50;var o=0x7fffffff;function l(){try{var e=new Uint8Array(1),t={foo:function(){return 42}};return Object.setPrototypeOf(t,Uint8Array.prototype),Object.setPrototypeOf(e,t),42===e.foo()}catch(e){return!1}}function u(e){if(e>o)throw RangeError('The value "'+e+'" is invalid for option "size"');var t=new Uint8Array(e);return Object.setPrototypeOf(t,c.prototype),t}function c(e,t,n){if("number"==typeof e){if("string"==typeof t)throw TypeError('The "string" argument must be of type string. Received type number');return f(e)}return h(e,t,n)}function h(e,t,n){if("string"==typeof e)return g(e,t);if(ArrayBuffer.isView(e))return y(e);if(null==e)throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e);if(J(e,ArrayBuffer)||e&&J(e.buffer,ArrayBuffer)||"undefined"!=typeof SharedArrayBuffer&&(J(e,SharedArrayBuffer)||e&&J(e.buffer,SharedArrayBuffer)))return b(e,t,n);if("number"==typeof e)throw TypeError('The "value" argument must not be of type number. Received type number');var r=e.valueOf&&e.valueOf();if(null!=r&&r!==e)return c.from(r,t,n);var i=v(e);if(i)return i;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof e[Symbol.toPrimitive])return c.from(e[Symbol.toPrimitive]("string"),t,n);throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e)}function d(e){if("number"!=typeof e)throw TypeError('"size" argument must be of type number');if(e<0)throw RangeError('The value "'+e+'" is invalid for option "size"')}function p(e,t,n){return(d(e),e<=0)?u(e):void 0!==t?"string"==typeof n?u(e).fill(t,n):u(e).fill(t):u(e)}function f(e){return d(e),u(e<0?0:0|w(e))}function g(e,t){if(("string"!=typeof t||""===t)&&(t="utf8"),!c.isEncoding(t))throw TypeError("Unknown encoding: "+t);var n=0|x(e,t),r=u(n),i=r.write(e,t);return i!==n&&(r=r.slice(0,i)),r}function m(e){for(var t=e.length<0?0:0|w(e.length),n=u(t),r=0;r<t;r+=1)n[r]=255&e[r];return n}function y(e){if(J(e,Uint8Array)){var t=new Uint8Array(e);return b(t.buffer,t.byteOffset,t.byteLength)}return m(e)}function b(e,t,n){var r;if(t<0||e.byteLength<t)throw RangeError('"offset" is outside of buffer bounds');if(e.byteLength<t+(n||0))throw RangeError('"length" is outside of buffer bounds');return Object.setPrototypeOf(r=void 0===t&&void 0===n?new Uint8Array(e):void 0===n?new Uint8Array(e,t):new Uint8Array(e,t,n),c.prototype),r}function v(e){if(c.isBuffer(e)){var t=0|w(e.length),n=u(t);return 0===n.length||e.copy(n,0,0,t),n}return void 0!==e.length?"number"!=typeof e.length||Z(e.length)?u(0):m(e):"Buffer"===e.type&&Array.isArray(e.data)?m(e.data):void 0}function w(e){if(e>=o)throw RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+o.toString(16)+" bytes");return 0|e}function _(e){return+e!=e&&(e=0),c.alloc(+e)}function x(e,t){if(c.isBuffer(e))return e.length;if(ArrayBuffer.isView(e)||J(e,ArrayBuffer))return e.byteLength;if("string"!=typeof e)throw TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof e);var n=e.length,r=arguments.length>2&&!0===arguments[2];if(!r&&0===n)return 0;for(var i=!1;;)switch(t){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":return H(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return Y(e).length;default:if(i)return r?-1:H(e).length;t=(""+t).toLowerCase(),i=!0}}function T(e,t,n){var r=!1;if((void 0===t||t<0)&&(t=0),t>this.length||((void 0===n||n>this.length)&&(n=this.length),n<=0||(n>>>=0)<=(t>>>=0)))return"";for(e||(e="utf8");;)switch(e){case"hex":return L(this,t,n);case"utf8":case"utf-8":return R(this,t,n);case"ascii":return P(this,t,n);case"latin1":case"binary":return M(this,t,n);case"base64":return $(this,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return z(this,t,n);default:if(r)throw TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),r=!0}}function I(e,t,n){var r=e[t];e[t]=e[n],e[n]=r}function k(e,t,n,r,i){if(0===e.length)return -1;if("string"==typeof n?(r=n,n=0):n>0x7fffffff?n=0x7fffffff:n<-0x80000000&&(n=-0x80000000),Z(n=+n)&&(n=i?0:e.length-1),n<0&&(n=e.length+n),n>=e.length){if(i)return -1;n=e.length-1}else if(n<0){if(!i)return -1;n=0}if("string"==typeof t&&(t=c.from(t,r)),c.isBuffer(t))return 0===t.length?-1:S(e,t,n,r,i);if("number"==typeof t)return(t&=255,"function"==typeof Uint8Array.prototype.indexOf)?i?Uint8Array.prototype.indexOf.call(e,t,n):Uint8Array.prototype.lastIndexOf.call(e,t,n):S(e,[t],n,r,i);throw TypeError("val must be string, number or Buffer")}function S(e,t,n,r,i){var s,a=1,o=e.length,l=t.length;if(void 0!==r&&("ucs2"===(r=String(r).toLowerCase())||"ucs-2"===r||"utf16le"===r||"utf-16le"===r)){if(e.length<2||t.length<2)return -1;a=2,o/=2,l/=2,n/=2}function u(e,t){return 1===a?e[t]:e.readUInt16BE(t*a)}if(i){var c=-1;for(s=n;s<o;s++)if(u(e,s)===u(t,-1===c?0:s-c)){if(-1===c&&(c=s),s-c+1===l)return c*a}else -1!==c&&(s-=s-c),c=-1}else for(n+l>o&&(n=o-l),s=n;s>=0;s--){for(var h=!0,d=0;d<l;d++)if(u(e,s+d)!==u(t,d)){h=!1;break}if(h)return s}return -1}function E(e,t,n,r){n=Number(n)||0;var i=e.length-n;r?(r=Number(r))>i&&(r=i):r=i;var s=t.length;r>s/2&&(r=s/2);for(var a=0;a<r;++a){var o=parseInt(t.substr(2*a,2),16);if(Z(o))break;e[n+a]=o}return a}function C(e,t,n,r){return Q(H(t,e.length-n),e,n,r)}function A(e,t,n,r){return Q(K(t),e,n,r)}function N(e,t,n,r){return Q(Y(t),e,n,r)}function O(e,t,n,r){return Q(X(t,e.length-n),e,n,r)}function $(e,t,n){return 0===t&&n===e.length?i.fromByteArray(e):i.fromByteArray(e.slice(t,n))}function R(e,t,n){n=Math.min(e.length,n);for(var r=[],i=t;i<n;){var s,a,o,l,u=e[i],c=null,h=u>239?4:u>223?3:u>191?2:1;if(i+h<=n)switch(h){case 1:u<128&&(c=u);break;case 2:(192&(s=e[i+1]))==128&&(l=(31&u)<<6|63&s)>127&&(c=l);break;case 3:s=e[i+1],a=e[i+2],(192&s)==128&&(192&a)==128&&(l=(15&u)<<12|(63&s)<<6|63&a)>2047&&(l<55296||l>57343)&&(c=l);break;case 4:s=e[i+1],a=e[i+2],o=e[i+3],(192&s)==128&&(192&a)==128&&(192&o)==128&&(l=(15&u)<<18|(63&s)<<12|(63&a)<<6|63&o)>65535&&l<1114112&&(c=l)}null===c?(c=65533,h=1):c>65535&&(c-=65536,r.push(c>>>10&1023|55296),c=56320|1023&c),r.push(c),i+=h}return F(r)}r=0x7fffffff,c.TYPED_ARRAY_SUPPORT=l(),c.TYPED_ARRAY_SUPPORT||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(c.prototype,"parent",{enumerable:!0,get:function(){if(c.isBuffer(this))return this.buffer}}),Object.defineProperty(c.prototype,"offset",{enumerable:!0,get:function(){if(c.isBuffer(this))return this.byteOffset}}),c.poolSize=8192,c.from=function(e,t,n){return h(e,t,n)},Object.setPrototypeOf(c.prototype,Uint8Array.prototype),Object.setPrototypeOf(c,Uint8Array),c.alloc=function(e,t,n){return p(e,t,n)},c.allocUnsafe=function(e){return f(e)},c.allocUnsafeSlow=function(e){return f(e)},c.isBuffer=function(e){return null!=e&&!0===e._isBuffer&&e!==c.prototype},c.compare=function(e,t){if(J(e,Uint8Array)&&(e=c.from(e,e.offset,e.byteLength)),J(t,Uint8Array)&&(t=c.from(t,t.offset,t.byteLength)),!c.isBuffer(e)||!c.isBuffer(t))throw TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(e===t)return 0;for(var n=e.length,r=t.length,i=0,s=Math.min(n,r);i<s;++i)if(e[i]!==t[i]){n=e[i],r=t[i];break}return n<r?-1:r<n?1:0},c.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},c.concat=function(e,t){if(!Array.isArray(e))throw TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return c.alloc(0);if(void 0===t)for(n=0,t=0;n<e.length;++n)t+=e[n].length;var n,r=c.allocUnsafe(t),i=0;for(n=0;n<e.length;++n){var s=e[n];if(J(s,Uint8Array))i+s.length>r.length?c.from(s).copy(r,i):Uint8Array.prototype.set.call(r,s,i);else if(c.isBuffer(s))s.copy(r,i);else throw TypeError('"list" argument must be an Array of Buffers');i+=s.length}return r},c.byteLength=x,c.prototype._isBuffer=!0,c.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)I(this,t,t+1);return this},c.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)I(this,t,t+3),I(this,t+1,t+2);return this},c.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)I(this,t,t+7),I(this,t+1,t+6),I(this,t+2,t+5),I(this,t+3,t+4);return this},c.prototype.toString=function(){var e=this.length;return 0===e?"":0==arguments.length?R(this,0,e):T.apply(this,arguments)},c.prototype.toLocaleString=c.prototype.toString,c.prototype.equals=function(e){if(!c.isBuffer(e))throw TypeError("Argument must be a Buffer");return this===e||0===c.compare(this,e)},c.prototype.inspect=function(){var e="",n=t.IS;return e=this.toString("hex",0,n).replace(/(.{2})/g,"$1 ").trim(),this.length>n&&(e+=" ... "),"<Buffer "+e+">"},a&&(c.prototype[a]=c.prototype.inspect),c.prototype.compare=function(e,t,n,r,i){if(J(e,Uint8Array)&&(e=c.from(e,e.offset,e.byteLength)),!c.isBuffer(e))throw TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof e);if(void 0===t&&(t=0),void 0===n&&(n=e?e.length:0),void 0===r&&(r=0),void 0===i&&(i=this.length),t<0||n>e.length||r<0||i>this.length)throw RangeError("out of range index");if(r>=i&&t>=n)return 0;if(r>=i)return -1;if(t>=n)return 1;if(t>>>=0,n>>>=0,r>>>=0,i>>>=0,this===e)return 0;for(var s=i-r,a=n-t,o=Math.min(s,a),l=this.slice(r,i),u=e.slice(t,n),h=0;h<o;++h)if(l[h]!==u[h]){s=l[h],a=u[h];break}return s<a?-1:a<s?1:0},c.prototype.includes=function(e,t,n){return -1!==this.indexOf(e,t,n)},c.prototype.indexOf=function(e,t,n){return k(this,e,t,n,!0)},c.prototype.lastIndexOf=function(e,t,n){return k(this,e,t,n,!1)},c.prototype.write=function(e,t,n,r){if(void 0===t)r="utf8",n=this.length,t=0;else if(void 0===n&&"string"==typeof t)r=t,n=this.length,t=0;else if(isFinite(t))t>>>=0,isFinite(n)?(n>>>=0,void 0===r&&(r="utf8")):(r=n,n=void 0);else throw Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");var i=this.length-t;if((void 0===n||n>i)&&(n=i),e.length>0&&(n<0||t<0)||t>this.length)throw RangeError("Attempt to write outside buffer bounds");r||(r="utf8");for(var s=!1;;)switch(r){case"hex":return E(this,e,t,n);case"utf8":case"utf-8":return C(this,e,t,n);case"ascii":case"latin1":case"binary":return A(this,e,t,n);case"base64":return N(this,e,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return O(this,e,t,n);default:if(s)throw TypeError("Unknown encoding: "+r);r=(""+r).toLowerCase(),s=!0}},c.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var D=4096;function F(e){var t=e.length;if(t<=D)return String.fromCharCode.apply(String,e);for(var n="",r=0;r<t;)n+=String.fromCharCode.apply(String,e.slice(r,r+=D));return n}function P(e,t,n){var r="";n=Math.min(e.length,n);for(var i=t;i<n;++i)r+=String.fromCharCode(127&e[i]);return r}function M(e,t,n){var r="";n=Math.min(e.length,n);for(var i=t;i<n;++i)r+=String.fromCharCode(e[i]);return r}function L(e,t,n){var r=e.length;(!t||t<0)&&(t=0),(!n||n<0||n>r)&&(n=r);for(var i="",s=t;s<n;++s)i+=ee[e[s]];return i}function z(e,t,n){for(var r=e.slice(t,n),i="",s=0;s<r.length-1;s+=2)i+=String.fromCharCode(r[s]+256*r[s+1]);return i}function B(e,t,n){if(e%1!=0||e<0)throw RangeError("offset is not uint");if(e+t>n)throw RangeError("Trying to access beyond buffer length")}function U(e,t,n,r,i,s){if(!c.isBuffer(e))throw TypeError('"buffer" argument must be a Buffer instance');if(t>i||t<s)throw RangeError('"value" argument is out of bounds');if(n+r>e.length)throw RangeError("Index out of range")}function V(e,t,n,r,i,s){if(n+r>e.length||n<0)throw RangeError("Index out of range")}function j(e,t,n,r,i){return t=+t,n>>>=0,i||V(e,t,n,4,34028234663852886e22,-34028234663852886e22),s.write(e,t,n,r,23,4),n+4}function G(e,t,n,r,i){return t=+t,n>>>=0,i||V(e,t,n,8,17976931348623157e292,-17976931348623157e292),s.write(e,t,n,r,52,8),n+8}c.prototype.slice=function(e,t){var n=this.length;e=~~e,t=void 0===t?n:~~t,e<0?(e+=n)<0&&(e=0):e>n&&(e=n),t<0?(t+=n)<0&&(t=0):t>n&&(t=n),t<e&&(t=e);var r=this.subarray(e,t);return Object.setPrototypeOf(r,c.prototype),r},c.prototype.readUintLE=c.prototype.readUIntLE=function(e,t,n){e>>>=0,t>>>=0,n||B(e,t,this.length);for(var r=this[e],i=1,s=0;++s<t&&(i*=256);)r+=this[e+s]*i;return r},c.prototype.readUintBE=c.prototype.readUIntBE=function(e,t,n){e>>>=0,t>>>=0,n||B(e,t,this.length);for(var r=this[e+--t],i=1;t>0&&(i*=256);)r+=this[e+--t]*i;return r},c.prototype.readUint8=c.prototype.readUInt8=function(e,t){return e>>>=0,t||B(e,1,this.length),this[e]},c.prototype.readUint16LE=c.prototype.readUInt16LE=function(e,t){return e>>>=0,t||B(e,2,this.length),this[e]|this[e+1]<<8},c.prototype.readUint16BE=c.prototype.readUInt16BE=function(e,t){return e>>>=0,t||B(e,2,this.length),this[e]<<8|this[e+1]},c.prototype.readUint32LE=c.prototype.readUInt32LE=function(e,t){return e>>>=0,t||B(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+0x1000000*this[e+3]},c.prototype.readUint32BE=c.prototype.readUInt32BE=function(e,t){return e>>>=0,t||B(e,4,this.length),0x1000000*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},c.prototype.readIntLE=function(e,t,n){e>>>=0,t>>>=0,n||B(e,t,this.length);for(var r=this[e],i=1,s=0;++s<t&&(i*=256);)r+=this[e+s]*i;return r>=(i*=128)&&(r-=Math.pow(2,8*t)),r},c.prototype.readIntBE=function(e,t,n){e>>>=0,t>>>=0,n||B(e,t,this.length);for(var r=t,i=1,s=this[e+--r];r>0&&(i*=256);)s+=this[e+--r]*i;return s>=(i*=128)&&(s-=Math.pow(2,8*t)),s},c.prototype.readInt8=function(e,t){return(e>>>=0,t||B(e,1,this.length),128&this[e])?-((255-this[e]+1)*1):this[e]},c.prototype.readInt16LE=function(e,t){e>>>=0,t||B(e,2,this.length);var n=this[e]|this[e+1]<<8;return 32768&n?0xffff0000|n:n},c.prototype.readInt16BE=function(e,t){e>>>=0,t||B(e,2,this.length);var n=this[e+1]|this[e]<<8;return 32768&n?0xffff0000|n:n},c.prototype.readInt32LE=function(e,t){return e>>>=0,t||B(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},c.prototype.readInt32BE=function(e,t){return e>>>=0,t||B(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},c.prototype.readFloatLE=function(e,t){return e>>>=0,t||B(e,4,this.length),s.read(this,e,!0,23,4)},c.prototype.readFloatBE=function(e,t){return e>>>=0,t||B(e,4,this.length),s.read(this,e,!1,23,4)},c.prototype.readDoubleLE=function(e,t){return e>>>=0,t||B(e,8,this.length),s.read(this,e,!0,52,8)},c.prototype.readDoubleBE=function(e,t){return e>>>=0,t||B(e,8,this.length),s.read(this,e,!1,52,8)},c.prototype.writeUintLE=c.prototype.writeUIntLE=function(e,t,n,r){if(e=+e,t>>>=0,n>>>=0,!r){var i=Math.pow(2,8*n)-1;U(this,e,t,n,i,0)}var s=1,a=0;for(this[t]=255&e;++a<n&&(s*=256);)this[t+a]=e/s&255;return t+n},c.prototype.writeUintBE=c.prototype.writeUIntBE=function(e,t,n,r){if(e=+e,t>>>=0,n>>>=0,!r){var i=Math.pow(2,8*n)-1;U(this,e,t,n,i,0)}var s=n-1,a=1;for(this[t+s]=255&e;--s>=0&&(a*=256);)this[t+s]=e/a&255;return t+n},c.prototype.writeUint8=c.prototype.writeUInt8=function(e,t,n){return e=+e,t>>>=0,n||U(this,e,t,1,255,0),this[t]=255&e,t+1},c.prototype.writeUint16LE=c.prototype.writeUInt16LE=function(e,t,n){return e=+e,t>>>=0,n||U(this,e,t,2,65535,0),this[t]=255&e,this[t+1]=e>>>8,t+2},c.prototype.writeUint16BE=c.prototype.writeUInt16BE=function(e,t,n){return e=+e,t>>>=0,n||U(this,e,t,2,65535,0),this[t]=e>>>8,this[t+1]=255&e,t+2},c.prototype.writeUint32LE=c.prototype.writeUInt32LE=function(e,t,n){return e=+e,t>>>=0,n||U(this,e,t,4,0xffffffff,0),this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e,t+4},c.prototype.writeUint32BE=c.prototype.writeUInt32BE=function(e,t,n){return e=+e,t>>>=0,n||U(this,e,t,4,0xffffffff,0),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},c.prototype.writeIntLE=function(e,t,n,r){if(e=+e,t>>>=0,!r){var i=Math.pow(2,8*n-1);U(this,e,t,n,i-1,-i)}var s=0,a=1,o=0;for(this[t]=255&e;++s<n&&(a*=256);)e<0&&0===o&&0!==this[t+s-1]&&(o=1),this[t+s]=(e/a>>0)-o&255;return t+n},c.prototype.writeIntBE=function(e,t,n,r){if(e=+e,t>>>=0,!r){var i=Math.pow(2,8*n-1);U(this,e,t,n,i-1,-i)}var s=n-1,a=1,o=0;for(this[t+s]=255&e;--s>=0&&(a*=256);)e<0&&0===o&&0!==this[t+s+1]&&(o=1),this[t+s]=(e/a>>0)-o&255;return t+n},c.prototype.writeInt8=function(e,t,n){return e=+e,t>>>=0,n||U(this,e,t,1,127,-128),e<0&&(e=255+e+1),this[t]=255&e,t+1},c.prototype.writeInt16LE=function(e,t,n){return e=+e,t>>>=0,n||U(this,e,t,2,32767,-32768),this[t]=255&e,this[t+1]=e>>>8,t+2},c.prototype.writeInt16BE=function(e,t,n){return e=+e,t>>>=0,n||U(this,e,t,2,32767,-32768),this[t]=e>>>8,this[t+1]=255&e,t+2},c.prototype.writeInt32LE=function(e,t,n){return e=+e,t>>>=0,n||U(this,e,t,4,0x7fffffff,-0x80000000),this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24,t+4},c.prototype.writeInt32BE=function(e,t,n){return e=+e,t>>>=0,n||U(this,e,t,4,0x7fffffff,-0x80000000),e<0&&(e=0xffffffff+e+1),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},c.prototype.writeFloatLE=function(e,t,n){return j(this,e,t,!0,n)},c.prototype.writeFloatBE=function(e,t,n){return j(this,e,t,!1,n)},c.prototype.writeDoubleLE=function(e,t,n){return G(this,e,t,!0,n)},c.prototype.writeDoubleBE=function(e,t,n){return G(this,e,t,!1,n)},c.prototype.copy=function(e,t,n,r){if(!c.isBuffer(e))throw TypeError("argument should be a Buffer");if(n||(n=0),r||0===r||(r=this.length),t>=e.length&&(t=e.length),t||(t=0),r>0&&r<n&&(r=n),r===n||0===e.length||0===this.length)return 0;if(t<0)throw RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw RangeError("Index out of range");if(r<0)throw RangeError("sourceEnd out of bounds");r>this.length&&(r=this.length),e.length-t<r-n&&(r=e.length-t+n);var i=r-n;return this===e&&"function"==typeof Uint8Array.prototype.copyWithin?this.copyWithin(t,n,r):Uint8Array.prototype.set.call(e,this.subarray(n,r),t),i},c.prototype.fill=function(e,t,n,r){if("string"==typeof e){if("string"==typeof t?(r=t,t=0,n=this.length):"string"==typeof n&&(r=n,n=this.length),void 0!==r&&"string"!=typeof r)throw TypeError("encoding must be a string");if("string"==typeof r&&!c.isEncoding(r))throw TypeError("Unknown encoding: "+r);if(1===e.length){var i,s=e.charCodeAt(0);("utf8"===r&&s<128||"latin1"===r)&&(e=s)}}else"number"==typeof e?e&=255:"boolean"==typeof e&&(e=Number(e));if(t<0||this.length<t||this.length<n)throw RangeError("Out of range index");if(n<=t)return this;if(t>>>=0,n=void 0===n?this.length:n>>>0,e||(e=0),"number"==typeof e)for(i=t;i<n;++i)this[i]=e;else{var a=c.isBuffer(e)?e:c.from(e,r),o=a.length;if(0===o)throw TypeError('The value "'+e+'" is invalid for argument "value"');for(i=0;i<n-t;++i)this[i+t]=a[i%o]}return this};var W=/[^+/0-9A-Za-z-_]/g;function q(e){if((e=(e=e.split("=")[0]).trim().replace(W,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}function H(e,t){t=t||1/0;for(var n,r=e.length,i=null,s=[],a=0;a<r;++a){if((n=e.charCodeAt(a))>55295&&n<57344){if(!i){if(n>56319||a+1===r){(t-=3)>-1&&s.push(239,191,189);continue}i=n;continue}if(n<56320){(t-=3)>-1&&s.push(239,191,189),i=n;continue}n=(i-55296<<10|n-56320)+65536}else i&&(t-=3)>-1&&s.push(239,191,189);if(i=null,n<128){if((t-=1)<0)break;s.push(n)}else if(n<2048){if((t-=2)<0)break;s.push(n>>6|192,63&n|128)}else if(n<65536){if((t-=3)<0)break;s.push(n>>12|224,n>>6&63|128,63&n|128)}else if(n<1114112){if((t-=4)<0)break;s.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}else throw Error("Invalid code point")}return s}function K(e){for(var t=[],n=0;n<e.length;++n)t.push(255&e.charCodeAt(n));return t}function X(e,t){for(var n,r,i=[],s=0;s<e.length&&!((t-=2)<0);++s)r=(n=e.charCodeAt(s))>>8,i.push(n%256),i.push(r);return i}function Y(e){return i.toByteArray(q(e))}function Q(e,t,n,r){for(var i=0;i<r&&!(i+n>=t.length)&&!(i>=e.length);++i)t[i+n]=e[i];return i}function J(e,t){return e instanceof t||null!=e&&null!=e.constructor&&null!=e.constructor.name&&e.constructor.name===t.name}function Z(e){return e!=e}var ee=function(){for(var e="0123456789abcdef",t=Array(256),n=0;n<16;++n)for(var r=16*n,i=0;i<16;++i)t[r+i]=e[n]+e[i];return t}()},251:(e,t)=>{t.read=function(e,t,n,r,i){var s,a,o=8*i-r-1,l=(1<<o)-1,u=l>>1,c=-7,h=n?i-1:0,d=n?-1:1,p=e[t+h];for(h+=d,s=p&(1<<-c)-1,p>>=-c,c+=o;c>0;s=256*s+e[t+h],h+=d,c-=8);for(a=s&(1<<-c)-1,s>>=-c,c+=r;c>0;a=256*a+e[t+h],h+=d,c-=8);if(0===s)s=1-u;else{if(s===l)return a?NaN:1/0*(p?-1:1);a+=Math.pow(2,r),s-=u}return(p?-1:1)*a*Math.pow(2,s-r)},t.write=function(e,t,n,r,i,s){var a,o,l,u=8*s-i-1,c=(1<<u)-1,h=c>>1,d=23===i?5960464477539062e-23:0,p=r?0:s-1,f=r?1:-1,g=t<0||0===t&&1/t<0?1:0;for(isNaN(t=Math.abs(t))||t===1/0?(o=isNaN(t)?1:0,a=c):(a=Math.floor(Math.log(t)/Math.LN2),t*(l=Math.pow(2,-a))<1&&(a--,l*=2),a+h>=1?t+=d/l:t+=d*Math.pow(2,1-h),t*l>=2&&(a++,l/=2),a+h>=c?(o=0,a=c):a+h>=1?(o=(t*l-1)*Math.pow(2,i),a+=h):(o=t*Math.pow(2,h-1)*Math.pow(2,i),a=0));i>=8;e[n+p]=255&o,p+=f,o/=256,i-=8);for(a=a<<i|o,u+=i;u>0;e[n+p]=255&a,p+=f,a/=256,u-=8);e[n+p-f]|=128*g}},8570:e=>{e.exports=n;var t=null;try{t=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch(e){}function n(e,t,n){this.low=0|e,this.high=0|t,this.unsigned=!!n}function r(e){return!0===(e&&e.__isLong__)}n.prototype.__isLong__,Object.defineProperty(n.prototype,"__isLong__",{value:!0}),n.isLong=r;var i={},s={};function a(e,t){var n,r,a;return t?(e>>>=0,(a=0<=e&&e<256)&&(r=s[e]))?r:(n=l(e,(0|e)<0?-1:0,!0),a&&(s[e]=n),n):(e|=0,(a=-128<=e&&e<128)&&(r=i[e]))?r:(n=l(e,e<0?-1:0,!1),a&&(i[e]=n),n)}function o(e,t){if(isNaN(e))return t?y:m;if(t){if(e<0)return y;if(e>=p)return x}else{if(e<=-f)return T;if(e+1>=f)return _}return e<0?o(-e,t).neg():l(e%d|0,e/d|0,t)}function l(e,t,r){return new n(e,t,r)}n.fromInt=a,n.fromNumber=o,n.fromBits=l;var u=Math.pow;function c(e,t,n){if(0===e.length)throw Error("empty string");if("NaN"===e||"Infinity"===e||"+Infinity"===e||"-Infinity"===e)return m;if("number"==typeof t?(n=t,t=!1):t=!!t,(n=n||10)<2||36<n)throw RangeError("radix");if((r=e.indexOf("-"))>0)throw Error("interior hyphen");if(0===r)return c(e.substring(1),t,n).neg();for(var r,i=o(u(n,8)),s=m,a=0;a<e.length;a+=8){var l=Math.min(8,e.length-a),h=parseInt(e.substring(a,a+l),n);if(l<8){var d=o(u(n,l));s=s.mul(d).add(o(h))}else s=(s=s.mul(i)).add(o(h))}return s.unsigned=t,s}function h(e,t){return"number"==typeof e?o(e,t):"string"==typeof e?c(e,t):l(e.low,e.high,"boolean"==typeof t?t:e.unsigned)}n.fromString=c,n.fromValue=h;var d=0x100000000,p=0xffffffffffffffff,f=0x8000000000000000,g=a(0x1000000),m=a(0);n.ZERO=m;var y=a(0,!0);n.UZERO=y;var b=a(1);n.ONE=b;var v=a(1,!0);n.UONE=v;var w=a(-1);n.NEG_ONE=w;var _=l(-1,0x7fffffff,!1);n.MAX_VALUE=_;var x=l(-1,-1,!0);n.MAX_UNSIGNED_VALUE=x;var T=l(0,-0x80000000,!1);n.MIN_VALUE=T;var I=n.prototype;I.toInt=function(){return this.unsigned?this.low>>>0:this.low},I.toNumber=function(){return this.unsigned?(this.high>>>0)*d+(this.low>>>0):this.high*d+(this.low>>>0)},I.toString=function(e){if((e=e||10)<2||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative()){if(!this.eq(T))return"-"+this.neg().toString(e);var t=o(e),n=this.div(t),r=n.mul(t).sub(this);return n.toString(e)+r.toInt().toString(e)}for(var i=o(u(e,6),this.unsigned),s=this,a="";;){var l=s.div(i),c=(s.sub(l.mul(i)).toInt()>>>0).toString(e);if((s=l).isZero())return c+a;for(;c.length<6;)c="0"+c;a=""+c+a}},I.getHighBits=function(){return this.high},I.getHighBitsUnsigned=function(){return this.high>>>0},I.getLowBits=function(){return this.low},I.getLowBitsUnsigned=function(){return this.low>>>0},I.getNumBitsAbs=function(){if(this.isNegative())return this.eq(T)?64:this.neg().getNumBitsAbs();for(var e=0!=this.high?this.high:this.low,t=31;t>0&&(e&1<<t)==0;t--);return 0!=this.high?t+33:t+1},I.isZero=function(){return 0===this.high&&0===this.low},I.eqz=I.isZero,I.isNegative=function(){return!this.unsigned&&this.high<0},I.isPositive=function(){return this.unsigned||this.high>=0},I.isOdd=function(){return(1&this.low)==1},I.isEven=function(){return(1&this.low)==0},I.equals=function(e){return r(e)||(e=h(e)),(this.unsigned===e.unsigned||this.high>>>31!=1||e.high>>>31!=1)&&this.high===e.high&&this.low===e.low},I.eq=I.equals,I.notEquals=function(e){return!this.eq(e)},I.neq=I.notEquals,I.ne=I.notEquals,I.lessThan=function(e){return 0>this.comp(e)},I.lt=I.lessThan,I.lessThanOrEqual=function(e){return 0>=this.comp(e)},I.lte=I.lessThanOrEqual,I.le=I.lessThanOrEqual,I.greaterThan=function(e){return this.comp(e)>0},I.gt=I.greaterThan,I.greaterThanOrEqual=function(e){return this.comp(e)>=0},I.gte=I.greaterThanOrEqual,I.ge=I.greaterThanOrEqual,I.compare=function(e){if(r(e)||(e=h(e)),this.eq(e))return 0;var t=this.isNegative(),n=e.isNegative();return t&&!n?-1:!t&&n?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1},I.comp=I.compare,I.negate=function(){return!this.unsigned&&this.eq(T)?T:this.not().add(b)},I.neg=I.negate,I.add=function(e){r(e)||(e=h(e));var t,n,i=this.high>>>16,s=65535&this.high,a=this.low>>>16,o=65535&this.low,u=e.high>>>16,c=65535&e.high,d=e.low>>>16,p=65535&e.low,f=0,g=0;return t=0+((n=0+(o+p))>>>16),n&=65535,t+=a+d,g+=t>>>16,t&=65535,g+=s+c,f+=g>>>16,g&=65535,f+=i+u,l(t<<16|n,(f&=65535)<<16|g,this.unsigned)},I.subtract=function(e){return r(e)||(e=h(e)),this.add(e.neg())},I.sub=I.subtract,I.multiply=function(e){if(this.isZero())return m;if(r(e)||(e=h(e)),t)return l(t.mul(this.low,this.high,e.low,e.high),t.get_high(),this.unsigned);if(e.isZero())return m;if(this.eq(T))return e.isOdd()?T:m;if(e.eq(T))return this.isOdd()?T:m;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(g)&&e.lt(g))return o(this.toNumber()*e.toNumber(),this.unsigned);var n,i,s=this.high>>>16,a=65535&this.high,u=this.low>>>16,c=65535&this.low,d=e.high>>>16,p=65535&e.high,f=e.low>>>16,y=65535&e.low,b=0,v=0;return n=0+((i=0+c*y)>>>16),i&=65535,n+=u*y,v+=n>>>16,n&=65535,n+=c*f,v+=n>>>16,n&=65535,v+=a*y,b+=v>>>16,v&=65535,v+=u*f,b+=v>>>16,v&=65535,v+=c*p,b+=v>>>16,v&=65535,b+=s*y+a*f+u*p+c*d,l(n<<16|i,(b&=65535)<<16|v,this.unsigned)},I.mul=I.multiply,I.divide=function(e){if(r(e)||(e=h(e)),e.isZero())throw Error("division by zero");if(t){var n,i,s;return this.unsigned||-0x80000000!==this.high||-1!==e.low||-1!==e.high?l((this.unsigned?t.div_u:t.div_s)(this.low,this.high,e.low,e.high),t.get_high(),this.unsigned):this}if(this.isZero())return this.unsigned?y:m;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return y;if(e.gt(this.shru(1)))return v;s=y}else{if(this.eq(T))return e.eq(b)||e.eq(w)?T:e.eq(T)?b:(n=this.shr(1).div(e).shl(1)).eq(m)?e.isNegative()?b:w:(i=this.sub(e.mul(n)),s=n.add(i.div(e)));if(e.eq(T))return this.unsigned?y:m;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();s=m}for(i=this;i.gte(e);){for(var a=Math.ceil(Math.log(n=Math.max(1,Math.floor(i.toNumber()/e.toNumber())))/Math.LN2),c=a<=48?1:u(2,a-48),d=o(n),p=d.mul(e);p.isNegative()||p.gt(i);)n-=c,p=(d=o(n,this.unsigned)).mul(e);d.isZero()&&(d=b),s=s.add(d),i=i.sub(p)}return s},I.div=I.divide,I.modulo=function(e){return(r(e)||(e=h(e)),t)?l((this.unsigned?t.rem_u:t.rem_s)(this.low,this.high,e.low,e.high),t.get_high(),this.unsigned):this.sub(this.div(e).mul(e))},I.mod=I.modulo,I.rem=I.modulo,I.not=function(){return l(~this.low,~this.high,this.unsigned)},I.and=function(e){return r(e)||(e=h(e)),l(this.low&e.low,this.high&e.high,this.unsigned)},I.or=function(e){return r(e)||(e=h(e)),l(this.low|e.low,this.high|e.high,this.unsigned)},I.xor=function(e){return r(e)||(e=h(e)),l(this.low^e.low,this.high^e.high,this.unsigned)},I.shiftLeft=function(e){return(r(e)&&(e=e.toInt()),0==(e&=63))?this:e<32?l(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):l(0,this.low<<e-32,this.unsigned)},I.shl=I.shiftLeft,I.shiftRight=function(e){return(r(e)&&(e=e.toInt()),0==(e&=63))?this:e<32?l(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):l(this.high>>e-32,this.high>=0?0:-1,this.unsigned)},I.shr=I.shiftRight,I.shiftRightUnsigned=function(e){if(r(e)&&(e=e.toInt()),0==(e&=63))return this;var t=this.high;return e<32?l(this.low>>>e|t<<32-e,t>>>e,this.unsigned):32===e?l(t,0,this.unsigned):l(t>>>e-32,0,this.unsigned)},I.shru=I.shiftRightUnsigned,I.shr_u=I.shiftRightUnsigned,I.toSigned=function(){return this.unsigned?l(this.low,this.high,!1):this},I.toUnsigned=function(){return this.unsigned?this:l(this.low,this.high,!0)},I.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()},I.toBytesLE=function(){var e=this.high,t=this.low;return[255&t,t>>>8&255,t>>>16&255,t>>>24,255&e,e>>>8&255,e>>>16&255,e>>>24]},I.toBytesBE=function(){var e=this.high,t=this.low;return[e>>>24,e>>>16&255,e>>>8&255,255&e,t>>>24,t>>>16&255,t>>>8&255,255&t]},n.fromBytes=function(e,t,r){return r?n.fromBytesLE(e,t):n.fromBytesBE(e,t)},n.fromBytesLE=function(e,t){return new n(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,t)},n.fromBytesBE=function(e,t){return new n(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],t)}},7836:(e,t,n)=>{"use strict";var r,i;e.exports=(null==(r=n.g.process)?void 0:r.env)&&"object"==typeof(null==(i=n.g.process)?void 0:i.env)?n.g.process:n(5307)},4562:(e,t,n)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/_app",function(){return n(1480)}])},5157:(e,t,n)=>{"use strict";function r(e,t,n,r){return!1}Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"getDomainLocale",{enumerable:!0,get:function(){return r}}),n(2063),("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)},6397:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return _}});let r=n(7677),i=n(4848),s=r._(n(6540)),a=n(6847),o=n(7785),l=n(2772),u=n(1278),c=n(6185),h=n(7644),d=n(6334),p=n(5157),f=n(296),g=n(1903),m=new Set;function y(e,t,n,r){if((0,o.isLocalURL)(t)){if(!r.bypassPrefetchedCheck){let i=t+"%"+n+"%"+(void 0!==r.locale?r.locale:"locale"in e?e.locale:void 0);if(m.has(i))return;m.add(i)}e.prefetch(t,n,r).catch(e=>{})}}function b(e){let t=e.currentTarget.getAttribute("target");return t&&"_self"!==t||e.metaKey||e.ctrlKey||e.shiftKey||e.altKey||e.nativeEvent&&2===e.nativeEvent.which}function v(e,t,n,r,i,s,a,l){let{nodeName:u}=e.currentTarget;"A"===u.toUpperCase()&&(b(e)||!(0,o.isLocalURL)(n))||(e.preventDefault(),(()=>{let e=null==a||a;"beforePopState"in t?t[i?"replace":"push"](n,r,{shallow:s,locale:l,scroll:e}):t[i?"replace":"push"](r||n,{scroll:e})})())}function w(e){return"string"==typeof e?e:(0,l.formatUrl)(e)}let _=s.default.forwardRef(function(e,t){let n,r;let{href:o,as:l,children:m,prefetch:b=null,passHref:_,replace:x,shallow:T,scroll:I,locale:k,onClick:S,onMouseEnter:E,onTouchStart:C,legacyBehavior:A=!1,...N}=e;n=m,A&&("string"==typeof n||"number"==typeof n)&&(n=(0,i.jsx)("a",{children:n}));let O=s.default.useContext(h.RouterContext),$=!1!==b,{href:R,as:D}=s.default.useMemo(()=>{if(!O){let e=w(o);return{href:e,as:l?w(l):e}}let[e,t]=(0,a.resolveHref)(O,o,!0);return{href:e,as:l?(0,a.resolveHref)(O,l):t||e}},[O,o,l]),F=s.default.useRef(R),P=s.default.useRef(D);A&&(r=s.default.Children.only(n));let M=A?r&&"object"==typeof r&&r.ref:t,[L,z,B]=(0,d.useIntersection)({rootMargin:"200px"}),U=s.default.useCallback(e=>{(P.current!==D||F.current!==R)&&(B(),P.current=D,F.current=R),L(e)},[D,R,B,L]),V=(0,g.useMergedRef)(U,M);s.default.useEffect(()=>{O&&z&&$&&y(O,R,D,{locale:k})},[D,R,z,k,$,null==O?void 0:O.locale,O]);let j={ref:V,onClick(e){A||"function"!=typeof S||S(e),A&&r.props&&"function"==typeof r.props.onClick&&r.props.onClick(e),O&&!e.defaultPrevented&&v(e,O,R,D,x,T,I,k)},onMouseEnter(e){A||"function"!=typeof E||E(e),A&&r.props&&"function"==typeof r.props.onMouseEnter&&r.props.onMouseEnter(e),O&&y(O,R,D,{locale:k,priority:!0,bypassPrefetchedCheck:!0})},onTouchStart:function(e){A||"function"!=typeof C||C(e),A&&r.props&&"function"==typeof r.props.onTouchStart&&r.props.onTouchStart(e),O&&y(O,R,D,{locale:k,priority:!0,bypassPrefetchedCheck:!0})}};if((0,u.isAbsoluteUrl)(D))j.href=D;else if(!A||_||"a"===r.type&&!("href"in r.props)){let e=void 0!==k?k:null==O?void 0:O.locale,t=(null==O?void 0:O.isLocaleDomain)&&(0,p.getDomainLocale)(D,e,null==O?void 0:O.locales,null==O?void 0:O.domainLocales);j.href=t||(0,f.addBasePath)((0,c.addLocale)(D,e,null==O?void 0:O.defaultLocale))}return A?s.default.cloneElement(r,j):(0,i.jsx)("a",{...N,...j,children:n})});("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)},6334:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"useIntersection",{enumerable:!0,get:function(){return c}});let r=n(6540),i=n(4959),s="function"==typeof IntersectionObserver,a=new Map,o=[];function l(e){let t;let n={root:e.root||null,margin:e.rootMargin||""},r=o.find(e=>e.root===n.root&&e.margin===n.margin);if(r&&(t=a.get(r)))return t;let i=new Map;return t={id:n,observer:new IntersectionObserver(e=>{e.forEach(e=>{let t=i.get(e.target),n=e.isIntersecting||e.intersectionRatio>0;t&&n&&t(n)})},e),elements:i},o.push(n),a.set(n,t),t}function u(e,t,n){let{id:r,observer:i,elements:s}=l(n);return s.set(e,t),i.observe(e),function(){if(s.delete(e),i.unobserve(e),0===s.size){i.disconnect(),a.delete(r);let e=o.findIndex(e=>e.root===r.root&&e.margin===r.margin);e>-1&&o.splice(e,1)}}}function c(e){let{rootRef:t,rootMargin:n,disabled:a}=e,o=a||!s,[l,c]=(0,r.useState)(!1),h=(0,r.useRef)(null),d=(0,r.useCallback)(e=>{h.current=e},[]);return(0,r.useEffect)(()=>{if(s){if(o||l)return;let e=h.current;if(e&&e.tagName)return u(e,e=>e&&c(e),{root:null==t?void 0:t.current,rootMargin:n})}else if(!l){let e=(0,i.requestIdleCallback)(()=>c(!0));return()=>(0,i.cancelIdleCallback)(e)}},[o,n,t,l,h.current]),[d,l,(0,r.useCallback)(()=>{c(!1)},[])]}("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)},1903:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"useMergedRef",{enumerable:!0,get:function(){return i}});let r=n(6540);function i(e,t){let n=(0,r.useRef)(()=>{}),i=(0,r.useRef)(()=>{});return(0,r.useMemo)(()=>e&&t?r=>{null===r?(n.current(),i.current()):(n.current=s(e,r),i.current=s(t,r))}:e||t,[e,t])}function s(e,t){if("function"!=typeof e)return e.current=t,()=>{e.current=null};{let n=e(t);return"function"==typeof n?n:()=>e(null)}}("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)},1480:(e,t,n)=>{"use strict";let r;n.r(t),n.d(t,{default:()=>Z});var i,s,a,o,l,u,c,h=n(4848);n(885);var d=n(1468),p=n(6737),f=n(4981);let g=e=>(0,p.U1)({reducer:{feedback:f.Ay},preloadedState:e}),m=e=>{let t=null!=r?r:g(e);return e&&r&&(t=g({...r.getState(),...e}),r=void 0),r||(r=t),t},y=e=>m(e);var b,v=n(6540),w=function(e,t){return(w=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},_=function(){return(_=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};function x(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&0>t.indexOf(r)&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)0>t.indexOf(r[i])&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}function T(e,t,n,r){return new(n||(n=Promise))(function(i,s){function a(e){try{l(r.next(e))}catch(e){s(e)}}function o(e){try{l(r.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?i(e.value):((t=e.value)instanceof n?t:new n(function(e){e(t)})).then(a,o)}l((r=r.apply(e,t||[])).next())})}function I(e,t){var n,r,i,s,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function o(o){return function(l){return function(o){if(n)throw TypeError("Generator is already executing.");for(;s&&(s=0,o[0]&&(a=0)),a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,l])}}}function k(e,t,n){if(n||2==arguments.length)for(var r,i=0,s=t.length;i<s;i++)!r&&i in t||(r||(r=Array.prototype.slice.call(t,0,i)),r[i]=t[i]);return e.concat(r||Array.prototype.slice.call(t))}!function(e){e.CONNECTED="connected",e.AUTHORIZATION_EXPIRED="authorization_expired",e.NOT_AUTHORIZED="not_authorized",e.UNKNOWN="unknown"}(b||(b={}));var S,E,C=b,A=function(e){function t(t,n,r){var i=e.call(this,t)||this;return i.code=n,i.type=r,i}return function(e,t){if("function"!=typeof t&&null!==t)throw TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}w(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}(t,e),t}(Error);!function(e){e.GET="get",e.POST="post",e.DELETE="delete"}(S||(S={})),function(e){e.UI="ui",e.API="api",e.LOGIN="login",e.LOGOUT="logout",e.GET_LOGIN_STATUS="getLoginStatus",e.GET_AUTH_RESPONSE="getAuthResponse"}(E||(E={}));var N,O={domain:"connect.facebook.net",version:"v15.0",cookie:!1,status:!1,xfbml:!1,language:"en_US",frictionlessRequests:!1,debug:!1,chatSupport:!1,autoLogAppEvents:!0,lazy:!1},$=function(){function e(e){if(!e.appId)throw Error("You need to set appId");this.options=_(_({},O),e),this.options.lazy||this.init()}return e.prototype.getAppId=function(){return this.options.appId},e.prototype.getFB=function(){return window.FB},e.prototype.init=function(){return T(this,void 0,void 0,function(){var e=this;return I(this,function(t){return this.loadingPromise||(this.loadingPromise=new Promise(function(t){var n=e.options,r=n.domain,i=n.language,s=n.debug,a=n.chatSupport,o=x(n,["domain","language","debug","chatSupport"]);if(window.fbAsyncInit=function(){window.FB.init({appId:o.appId,version:o.version,cookie:o.cookie,status:o.status,xfbml:o.xfbml,frictionlessRequests:o.frictionlessRequests}),t(e)},window.document.getElementById("facebook-jssdk"))return t(e);var l=window.document.createElement("script");l.id="facebook-jssdk",l.async=!0,l.defer=!0,l.crossOrigin="anonymous",l.src="https://".concat(r,"/").concat(i,"/sdk").concat(a?"/xfbml.customerchat":"").concat(s?"/debug":"",".js"),window.document.body.appendChild(l)})),[2,this.loadingPromise]})})},e.prototype.process=function(e,t,n){return void 0===t&&(t=[]),void 0===n&&(n=[]),T(this,void 0,void 0,function(){var r;return I(this,function(i){switch(i.label){case 0:return[4,this.init()];case 1:return i.sent(),r=this.getFB(),[2,new Promise(function(i,s){r[e].apply(r,k(k(k([],t,!1),[function(t){if(t){if(t&&"error"in t){var n=t.error,r=n.code,a=n.type;s(new A(n.message,r,a))}else i(t)}else{if(e===E.UI)return;s(Error("Response is undefined"))}}],!1),n,!1))})]}})})},e.prototype.ui=function(e){return T(this,void 0,void 0,function(){return I(this,function(t){return[2,this.process(E.UI,[e])]})})},e.prototype.api=function(e,t,n){return void 0===t&&(t=S.GET),void 0===n&&(n={}),T(this,void 0,void 0,function(){return I(this,function(r){return[2,this.process(E.API,[e,t,n])]})})},e.prototype.login=function(e){return T(this,void 0,void 0,function(){var t,n,r,i,s,a,o;return I(this,function(l){return t=e.scope,r=void 0===(n=e.authType)?[]:n,i=e.returnScopes,s=e.rerequest,a=e.reauthorize,o={scope:t},i&&(o.return_scopes=!0),s&&r.push("rerequest"),a&&r.push("reauthenticate"),r.length&&(o.auth_type=r.join(",")),[2,this.process(E.LOGIN,[],[o])]})})},e.prototype.logout=function(){return T(this,void 0,void 0,function(){return I(this,function(e){return[2,this.process(E.LOGOUT)]})})},e.prototype.getLoginStatus=function(){return T(this,void 0,void 0,function(){return I(this,function(e){return[2,this.process(E.GET_LOGIN_STATUS)]})})},e.prototype.getAuthResponse=function(){return T(this,void 0,void 0,function(){return I(this,function(e){return[2,this.process(E.GET_AUTH_RESPONSE)]})})},e.prototype.getTokenDetail=function(e){return T(this,void 0,void 0,function(){var t;return I(this,function(n){switch(n.label){case 0:return(null==e?void 0:e.status)===C.CONNECTED?[2,e.authResponse]:[4,this.getLoginStatus()];case 1:if((t=n.sent()).status===C.CONNECTED)return[2,t.authResponse];throw Error("Token is undefined")}})})},e.prototype.getProfile=function(e){return T(this,void 0,void 0,function(){return I(this,function(t){return[2,this.api("/me",S.GET,e)]})})},e.prototype.getTokenDetailWithProfile=function(e,t){return T(this,void 0,void 0,function(){var n;return I(this,function(r){switch(r.label){case 0:return[4,this.getTokenDetail(t)];case 1:return n=r.sent(),[4,this.getProfile(e)];case 2:return[2,{profile:r.sent(),tokenDetail:n}]}})})},e.prototype.getToken=function(){return T(this,void 0,void 0,function(){return I(this,function(e){switch(e.label){case 0:return[4,this.getTokenDetail()];case 1:return[2,e.sent().accessToken]}})})},e.prototype.getUserId=function(){return T(this,void 0,void 0,function(){return I(this,function(e){switch(e.label){case 0:return[4,this.getTokenDetail()];case 1:return[2,e.sent().userID]}})})},e.prototype.sendInvite=function(e,t){return T(this,void 0,void 0,function(){return I(this,function(n){return[2,this.ui(_({to:e,method:"apprequests"},t))]})})},e.prototype.postAction=function(e,t,n,r,i){return void 0===i&&(i=!1),T(this,void 0,void 0,function(){var s;return I(this,function(a){return s="/me/".concat(e,":").concat(t,"?").concat(n,"=").concat(encodeURIComponent(r)),!0===i&&(s+="&no_feed_story=true"),[2,this.api(s,S.POST)]})})},e.prototype.getPermissions=function(){return T(this,void 0,void 0,function(){return I(this,function(e){switch(e.label){case 0:return[4,this.api("/me/permissions")];case 1:return[2,e.sent().data]}})})},e.prototype.hasPermissions=function(e){return T(this,void 0,void 0,function(){var t;return I(this,function(n){switch(n.label){case 0:return[4,this.getPermissions()];case 1:return t=n.sent(),[2,e.filter(function(e){return!!t.find(function(t){var n=t.permission;return"granted"===t.status&&n===e})}).length===e.length]}})})},e.prototype.subscribe=function(e,t){return T(this,void 0,void 0,function(){var n=this;return I(this,function(r){switch(r.label){case 0:return[4,this.init()];case 1:return r.sent(),this.getFB().Event.subscribe(e,t),[2,function(){return n.unsubscribe(e,t)}]}})})},e.prototype.unsubscribe=function(e,t){return T(this,void 0,void 0,function(){return I(this,function(n){switch(n.label){case 0:return[4,this.init()];case 1:return n.sent(),this.getFB().Event.unsubscribe(e,t),[2]}})})},e.prototype.parse=function(e){return T(this,void 0,void 0,function(){return I(this,function(t){switch(t.label){case 0:return[4,this.init()];case 1:return t.sent(),void 0===e?this.getFB().XFBML.parse():this.getFB().XFBML.parse(e),[2]}})})},e.prototype.getRequests=function(){return T(this,void 0,void 0,function(){return I(this,function(e){return[2,this.api("/me/apprequests")]})})},e.prototype.removeRequest=function(e){return T(this,void 0,void 0,function(){return I(this,function(t){return[2,this.api(e,S.DELETE)]})})},e.prototype.setAutoGrow=function(){return T(this,void 0,void 0,function(){return I(this,function(e){switch(e.label){case 0:return[4,this.init()];case 1:return e.sent(),this.getFB().Canvas.setAutoGrow(),[2]}})})},e.prototype.paySimple=function(e,t){return void 0===t&&(t=1),T(this,void 0,void 0,function(){return I(this,function(n){return[2,this.ui({method:"pay",action:"purchaseitem",product:e,quantity:t})]})})},e.prototype.pay=function(e,t){return T(this,void 0,void 0,function(){return I(this,function(n){return[2,this.ui(_({method:"pay",action:"purchaseitem",product:e},t))]})})},e}(),R=(0,v.createContext)(void 0);function D(e){var t=e.children,n=x(e,["children"]),r=(0,v.useState)(!0),i=r[0],s=r[1],a=(0,v.useState)(!1),o=a[0],l=a[1],u=(0,v.useState)(),c=u[0],h=u[1];function d(){return T(this,void 0,void 0,function(){return I(this,function(e){switch(e.label){case 0:return e.trys.push([0,2,3,4]),N?[2,N.init()]:(l(!1),s(!0),[4,(N=new $(n)).init()]);case 1:return e.sent(),l(!0),[3,4];case 2:return h(e.sent()),[3,4];case 3:return s(!1),[7];case 4:return[2,N]}})})}(0,v.useEffect)(function(){n.lazy||d()},[]);var p={isLoading:i,error:c,init:d,api:o?N:void 0,parse:function(e){return T(this,void 0,void 0,function(){var t;return I(this,function(n){switch(n.label){case 0:return[4,d()];case 1:return(t=n.sent())?[4,t.parse(e)]:[3,3];case 2:n.sent(),n.label=3;case 3:return[2]}})})}};return v.createElement(R.Provider,{value:p},t)}function F(e){void 0===e&&(e={});var t=e.lazy,n=void 0!==t&&t,r=(0,v.useContext)(R);if(!r)throw Error("useFacebook must be used within a FacebookProvider");return(0,v.useEffect)(function(){n||r.init()},[n]),r}var P=(0,v.memo)((0,v.forwardRef)(function(e,t){var n=e.inline,r=e.children,i=x(e,["inline","children"]),s=n?"span":"div";return v.createElement(s,_({},i,{ref:t}),r)})),M=(0,v.memo)(function(e){var t=e.children,n=e.inline,r=x(e,["children","inline"]),i=F().parse,s=(0,v.useState)(null),a=s[0],o=s[1],l=(0,v.useCallback)(function(e){o(e)},[]);return(0,v.useEffect)(function(){a&&i(a)},[a]),v.createElement(P,_({inline:n},r,{ref:l}),t)}),L=!("undefined"==typeof window||!window.document||!window.document.createElement);function z(){return L?window.location.href:"https://www.facebook.com"}(0,v.memo)((0,v.forwardRef)(function(e,t){var n=e.href,r=void 0===n?z():n,i=e.layout,s=e.colorScheme,a=e.action,o=e.showFaces,l=e.share,u=e.children,c=e.width,h=e.size,d=e.kidDirectedSite,p=e.referral,f=e.lazy,g=x(e,["href","layout","colorScheme","action","showFaces","share","children","width","size","kidDirectedSite","referral","lazy"]);return v.createElement(M,null,v.createElement("div",_({className:"fb-like","data-ref":p,"data-href":r,"data-layout":i,"data-colorscheme":s,"data-action":a,"data-show-faces":o,"data-share":l,"data-width":c,"data-size":h,"data-lazy":f,"data-kid-directed-site":d},g,{ref:t}),u))}));(0,v.memo)((0,v.forwardRef)(function(e,t){var n=e.style,r=e.href,i=void 0===r?z():r,s=e.tabs,a=e.hideCover,o=e.width,l=e.height,u=e.showFacepile,c=e.hideCTA,h=e.smallHeader,d=e.adaptContainerWidth,p=e.children,f=e.lazy,g=x(e,["style","href","tabs","hideCover","width","height","showFacepile","hideCTA","smallHeader","adaptContainerWidth","children","lazy"]);return v.createElement(M,null,v.createElement("div",_({className:"fb-page",style:n,"data-tabs":s,"data-hide-cover":a,"data-show-facepile":u,"data-hide-cta":c,"data-href":i,"data-small-header":h,"data-adapt-container-width":d,"data-height":l,"data-width":o,"data-lazy":f},g,{ref:t}),p))})),(0,v.memo)((0,v.forwardRef)(function(e,t){var n=e.href,r=e.width,i=e.showText,s=e.lazy,a=e.children,o=x(e,["href","width","showText","lazy","children"]);return v.createElement(M,null,v.createElement("div",_({className:"fb-post","data-href":n,"data-width":r,"data-lazy":s,"data-show-text":i},o,{ref:t}),a))})),(0,v.memo)((0,v.forwardRef)(function(e,t){var n=e.href,r=e.width,i=e.showText,s=e.allowFullScreen,a=e.autoPlay,o=e.lazy,l=e.showCaptions,u=e.children,c=x(e,["href","width","showText","allowFullScreen","autoPlay","lazy","showCaptions","children"]);return v.createElement(M,null,v.createElement("div",_({className:"fb-video","data-href":n,"data-width":r,"data-show-text":i,"data-show-captions":l,"data-autoplay":a,"data-lazy":o,"data-allowfullscreen":s},c,{ref:t}),u))})),(0,v.memo)((0,v.forwardRef)(function(e,t){var n=e.colorScheme,r=e.href,i=void 0===r?z():r,s=e.numPosts,a=e.orderBy,o=e.width,l=e.children,u=e.mobile,c=e.lazy,h=x(e,["colorScheme","href","numPosts","orderBy","width","children","mobile","lazy"]);return v.createElement(M,null,v.createElement("div",_({className:"fb-comments","data-colorscheme":n,"data-numposts":s,"data-href":i,"data-order-by":a,"data-width":o,"data-skin":n,"data-mobile":u,"data-lazy":c},h,{ref:t}),l))})),(0,v.memo)((0,v.forwardRef)(function(e,t){var n=e.href,r=void 0===n?z():n,i=e.children,s=x(e,["href","children"]);return v.createElement(M,{inline:!0},v.createElement("span",_({className:"fb-comments-count","data-href":r},s,{ref:t}),i))})),(0,v.memo)((0,v.forwardRef)(function(e,t){var n=e.style,r=e.href,i=void 0===r?z():r,s=e.width,a=e.lazy,o=e.showSocialContext,l=e.showMetaData,u=e.children,c=e.skin,h=x(e,["style","href","width","lazy","showSocialContext","showMetaData","children","skin"]);return v.createElement(M,null,v.createElement("div",_({className:"fb-group",style:n,"data-href":i,"data-width":s,"data-show-social-context":o,"data-show-metadata":l,"data-skin":c,"data-lazy":a},h,{ref:t}),u))})),(0,v.memo)((0,v.forwardRef)(function(e,t){var n=e.style,r=e.uri,i=void 0===r?z():r,s=e.lazy,a=e.children,o=x(e,["style","uri","lazy","children"]);return v.createElement(M,null,v.createElement("div",_({className:"fb-save",style:n,"data-uri":i,"data-lazy":s},o,{ref:t}),a))})),(0,v.memo)((0,v.forwardRef)(function(e,t){var n=e.style,r=e.href,i=void 0===r?z():r,s=e.lazy,a=e.layout,o=e.size,l=e.children,u=x(e,["style","href","lazy","layout","size","children"]);return v.createElement(M,null,v.createElement("div",_({className:"fb-share-button",style:n,"data-href":i,"data-lazy":s,"data-size":o,"data-layout":a},u,{ref:t}),l))})),(0,v.memo)((0,v.forwardRef)(function(e,t){var n=e.children,r=e.pageId,i=e.themeColor,s=e.loggedInGreeting,a=e.loggedOutGreeting,o=e.dataRef,l=e.greetingDialogDisplay,u=e.greetingDialogDelay,c=e.minimized,h=x(e,["children","pageId","themeColor","loggedInGreeting","loggedOutGreeting","dataRef","greetingDialogDisplay","greetingDialogDelay","minimized"]);return v.createElement(M,null,v.createElement("div",_({className:"fb-customerchat",page_id:r,theme_color:i,logged_in_greeting:s,logged_out_greeting:a,greeting_dialog_display:l,greeting_dialog_delay:u,"data-ref":o,minimized:c},h,{ref:t}),n))})),(0,v.memo)((0,v.forwardRef)(function(e,t){var n=e.color,r=e.messengerAppId,i=e.pageId,s=e.children,a=e.size,o=e.dataRef,l=x(e,["color","messengerAppId","pageId","children","size","dataRef"]);return v.createElement(M,null,v.createElement("div",_({className:"fb-messengermessageus",messenger_app_id:r,page_id:i,"data-color":n,"data-size":a,"data-ref":o},l,{ref:t}),s))})),(0,v.memo)((0,v.forwardRef)(function(e,t){var n=e.origin,r=e.prechecked,i=e.allowLogin,s=e.userRef,a=e.messengerAppId,o=e.pageId,l=e.children,u=e.size,c=e.centerAlign,h=e.skin,d=x(e,["origin","prechecked","allowLogin","userRef","messengerAppId","pageId","children","size","centerAlign","skin"]);return v.createElement(M,null,v.createElement("div",_({className:"fb-messenger-checkbox",messenger_app_id:a,page_id:o,size:u,origin:n,user_ref:s,prechecked:r,allow_login:i,skin:h,center_align:c},d,{ref:t}),l))})),(0,v.memo)((0,v.forwardRef)(function(e,t){var n=e.color,r=e.messengerAppId,i=e.pageId,s=e.children,a=e.dataRef,o=e.size,l=e.enforceLogin,u=e.ctaText,c=x(e,["color","messengerAppId","pageId","children","dataRef","size","enforceLogin","ctaText"]);return v.createElement(M,null,v.createElement("div",_({className:"fb-send-to-messenger",messenger_app_id:r,page_id:i,"data-color":n,"data-size":o,"data-ref":a,enforce_login:l,cta_text:u},c,{ref:t}),s))})),function(e){e.SMALL="small",e.LARGE="large"}(i||(i={})),function(e){e.STANDARD="standard",e.BUTTON_COUNT="button_count",e.BUTTON="button",e.BOX_COUNT="box_count"}(s||(s={})),function(e){e.LIGHT="light",e.DARK="dark"}(a||(a={})),function(e){e.LIKE="like",e.RECOMMEND="recommend"}(o||(o={})),function(e){e.SOCIAL="social",e.REVERSE_TIME="reverse_time",e.TIME="time"}(l||(l={})),function(e){e.SMALL="small",e.MEDIUM="medium",e.STANDARD="standard",e.LARGE="large",e.XLARGE="xlarge"}(u||(u={})),function(e){e.BLUE="blue",e.WHITE="white"}(c||(c={}));var B=n(3093);n(1106);var U=n(6715),V=n(9279);let j=[["path",{d:"M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2",key:"169zse"}]],G=(0,V.A)("Activity",j),W=[["line",{x1:"18",x2:"18",y1:"20",y2:"10",key:"1xfpm4"}],["line",{x1:"12",x2:"12",y1:"20",y2:"4",key:"be30l9"}],["line",{x1:"6",x2:"6",y1:"20",y2:"14",key:"1r4le6"}]],q=(0,V.A)("ChartNoAxesColumn",W),H=[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}],["path",{d:"M12 7v6",key:"lw1j43"}],["path",{d:"M9 10h6",key:"9gxzsh"}]],K=(0,V.A)("MessageSquarePlus",H);var X=n(3020),Y=n(7031);let Q=n(7836).env.NEXT_PUBLIC_FIREBASE_ADMIN_EMAIL,J=()=>{let e=(0,U.useRouter)(),[t,n]=(0,v.useState)(null);(0,v.useEffect)(()=>{let e=(0,Y.hg)(X.j,e=>{e&&e.email===Q?n(e):n(null)});return()=>e()},[]);let r=async()=>{try{await (0,Y.CI)(X.j),e.push("/login")}catch(e){console.error("Error logging out:",e)}},i=t=>e.pathname===t?"bg-blue-800":"";return(0,h.jsx)("nav",{className:"bg-blue-600 shadow-lg",children:(0,h.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,h.jsxs)("div",{className:"flex items-center justify-between h-16",children:[(0,h.jsx)("div",{className:"flex items-center",children:(0,h.jsxs)("a",{href:"/",rel:"noopener noreferrer",className:"flex items-center text-white",children:[(0,h.jsx)(G,{className:"h-8 w-8"}),(0,h.jsx)("span",{className:"ml-2 text-xl font-bold",children:"Sentiment Tracker"})]})}),(0,h.jsxs)("div",{className:"flex space-x-4",children:[(0,h.jsxs)("a",{href:"/",rel:"noopener noreferrer",className:"flex items-center px-3 py-2 rounded-md text-sm font-medium text-white hover:bg-blue-700 transition-colors ".concat(i("/")),children:[(0,h.jsx)(q,{className:"h-4 w-4 mr-2"}),"Submit Opinion"]}),(0,h.jsxs)("span",{children:[(0,h.jsxs)("a",{href:"/dashboard",rel:"noopener noreferrer",className:"flex items-center px-3 py-2 rounded-md text-sm font-medium text-white hover:bg-blue-700 transition-colors ".concat(i("/dashboard")),children:[(0,h.jsx)(K,{className:"h-4 w-4 mr-2"}),"Admin Dashboard"]}),t&&(0,h.jsx)(h.Fragment,{children:(0,h.jsx)("button",{onClick:r,className:"bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-md",children:"Logout"})})]})]})]})})})};function Z(e){let{Component:t,pageProps:n}=e,r=y(n.initialReduxState);return(0,h.jsx)(d.Kq,{store:r,children:(0,h.jsxs)(D,{appId:"your_facebook_app_id",children:[(0,h.jsxs)("div",{className:"min-h-screen bg-gray-100",children:[(0,h.jsx)(J,{}),(0,h.jsx)("main",{className:"max-w-7xl mx-auto py-6 sm:px-6 lg:px-8",children:(0,h.jsx)(t,{...n})})]}),(0,h.jsx)(B.N9,{position:"bottom-right"})]})})}n(4338)},4338:()=>{},885:()=>{},8797:(e,t,n)=>{var r="/";!function(){var t={452:function(e){"use strict";e.exports=n(6271)}},i={};function s(e){var n=i[e];if(void 0!==n)return n.exports;var r=i[e]={exports:{}},a=!0;try{t[e](r,r.exports,s),a=!1}finally{a&&delete i[e]}return r.exports}s.ab=r+"/";var a={};!function(){var e,t=a,n=(e=s(452))&&"object"==typeof e&&"default"in e?e.default:e,r=/https?|ftp|gopher|file/;function i(e){"string"==typeof e&&(e=v(e));var t=function(e,t,n){var r=e.auth,i=e.hostname,s=e.protocol||"",a=e.pathname||"",o=e.hash||"",l=e.query||"",u=!1;r=r?encodeURIComponent(r).replace(/%3A/i,":")+"@":"",e.host?u=r+e.host:i&&(u=r+(~i.indexOf(":")?"["+i+"]":i),e.port&&(u+=":"+e.port)),l&&"object"==typeof l&&(l=t.encode(l));var c=e.search||l&&"?"+l||"";return s&&":"!==s.substr(-1)&&(s+=":"),e.slashes||(!s||n.test(s))&&!1!==u?(u="//"+(u||""),a&&"/"!==a[0]&&(a="/"+a)):u||(u=""),o&&"#"!==o[0]&&(o="#"+o),c&&"?"!==c[0]&&(c="?"+c),{protocol:s,host:u,pathname:a=a.replace(/[?#]/g,encodeURIComponent),search:c=c.replace("#","%23"),hash:o}}(e,n,r);return""+t.protocol+t.host+t.pathname+t.search+t.hash}var o="http://",l="w.w",u=o+l,c=/^([a-z0-9.+-]*:\/\/\/)([a-z0-9.+-]:\/*)?/i,h=/https?|ftp|gopher|file/;function d(e,t){var n="string"==typeof e?v(e):e;e="object"==typeof e?i(e):e;var r=v(t),s="";n.protocol&&!n.slashes&&(s=n.protocol,e=e.replace(n.protocol,""),s+="/"===t[0]||"/"===e[0]?"/":""),s&&r.protocol&&(s="",r.slashes||(s=r.protocol,t=t.replace(r.protocol,"")));var a=e.match(c);a&&!r.protocol&&(e=e.substr((s=a[1]+(a[2]||"")).length),/^\/\/[^/]/.test(t)&&(s=s.slice(0,-1)));var l=new URL(e,u+"/"),d=new URL(t,l).toString().replace(u,""),p=r.protocol||n.protocol;return p+=n.slashes||r.slashes?"//":"",!s&&p?d=d.replace(o,p):s&&(d=d.replace(o,"")),h.test(d)||~t.indexOf(".")||"/"===e.slice(-1)||"/"===t.slice(-1)||"/"!==d.slice(-1)||(d=d.slice(0,-1)),s&&(d=s+("/"===d[0]?d.substr(1):d)),d}function p(){}p.prototype.parse=v,p.prototype.format=i,p.prototype.resolve=d,p.prototype.resolveObject=d;var f=/^https?|ftp|gopher|file/,g=/^(.*?)([#?].*)/,m=/^([a-z0-9.+-]*:)(\/{0,3})(.*)/i,y=/^([a-z0-9.+-]*:)?\/\/\/*/i,b=/^([a-z0-9.+-]*:)(\/{0,2})\[(.*)\]$/i;function v(e,t,r){if(void 0===t&&(t=!1),void 0===r&&(r=!1),e&&"object"==typeof e&&e instanceof p)return e;var s=(e=e.trim()).match(g);e=s?s[1].replace(/\\/g,"/")+s[2]:e.replace(/\\/g,"/"),b.test(e)&&"/"!==e.slice(-1)&&(e+="/");var a=!/(^javascript)/.test(e)&&e.match(m),o=y.test(e),c="";a&&(f.test(a[1])||(c=a[1].toLowerCase(),e=""+a[2]+a[3]),a[2]||(o=!1,f.test(a[1])?(c=a[1],e=""+a[3]):e="//"+a[3]),3!==a[2].length&&1!==a[2].length||(c=a[1],e="/"+a[3]));var h,d=(s?s[1]:e).match(/^https?:\/\/[^/]+(:[0-9]+)(?=\/|$)/),v=d&&d[1],w=new p,_="",x="";try{h=new URL(e)}catch(t){_=t,c||r||!/^\/\//.test(e)||/^\/\/.+[@.]/.test(e)||(x="/",e=e.substr(1));try{h=new URL(e,u)}catch(e){return w.protocol=c,w.href=c,w}}w.slashes=o&&!x,w.host=h.host===l?"":h.host,w.hostname=h.hostname===l?"":h.hostname.replace(/(\[|\])/g,""),w.protocol=_?c||null:h.protocol,w.search=h.search.replace(/\\/g,"%5C"),w.hash=h.hash.replace(/\\/g,"%5C");var T=e.split("#");!w.search&&~T[0].indexOf("?")&&(w.search="?"),w.hash||""!==T[1]||(w.hash="#"),w.query=t?n.decode(h.search.substr(1)):w.search.substr(1),w.pathname=x+(a?function(e){return e.replace(/['^|`]/g,function(e){return"%"+e.charCodeAt().toString(16).toUpperCase()}).replace(/((?:%[0-9A-F]{2})+)/g,function(e,t){try{return decodeURIComponent(t).split("").map(function(e){var t=e.charCodeAt();return t>256||/^[a-z0-9]$/i.test(e)?e:"%"+t.toString(16).toUpperCase()}).join("")}catch(e){return t}})}(h.pathname):h.pathname),"about:"===w.protocol&&"blank"===w.pathname&&(w.protocol="",w.pathname=""),_&&"/"!==e[0]&&(w.pathname=w.pathname.substr(1)),c&&!f.test(c)&&"/"!==e.slice(-1)&&"/"===w.pathname&&(w.pathname=""),w.path=w.pathname+w.search,w.auth=[h.username,h.password].map(decodeURIComponent).filter(Boolean).join(":"),w.port=h.port,v&&!w.host.endsWith(v)&&(w.host+=v,w.port=v.slice(1)),w.href=x?""+w.pathname+w.search+w.hash:i(w);var I=/^(file)/.test(w.href)?["host","hostname"]:[];return Object.keys(w).forEach(function(e){~I.indexOf(e)||(w[e]=w[e]||null)}),w}t.parse=v,t.format=i,t.resolve=d,t.resolveObject=function(e,t){return v(d(e,t))},t.Url=p}(),e.exports=a}()},5307:e=>{var t="/";!function(){var n={229:function(e){var t,n,r,i=e.exports={};function s(){throw Error("setTimeout has not been defined")}function a(){throw Error("clearTimeout has not been defined")}function o(e){if(t===setTimeout)return setTimeout(e,0);if((t===s||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(n){try{return t.call(null,e,0)}catch(n){return t.call(this,e,0)}}}function l(e){if(n===clearTimeout)return clearTimeout(e);if((n===a||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(e);try{return n(e)}catch(t){try{return n.call(null,e)}catch(t){return n.call(this,e)}}}!function(){try{t="function"==typeof setTimeout?setTimeout:s}catch(e){t=s}try{n="function"==typeof clearTimeout?clearTimeout:a}catch(e){n=a}}();var u=[],c=!1,h=-1;function d(){c&&r&&(c=!1,r.length?u=r.concat(u):h=-1,u.length&&p())}function p(){if(!c){var e=o(d);c=!0;for(var t=u.length;t;){for(r=u,u=[];++h<t;)r&&r[h].run();h=-1,t=u.length}r=null,c=!1,l(e)}}function f(e,t){this.fun=e,this.array=t}function g(){}i.nextTick=function(e){var t=Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];u.push(new f(e,t)),1!==u.length||c||o(p)},f.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=g,i.addListener=g,i.once=g,i.off=g,i.removeListener=g,i.removeAllListeners=g,i.emit=g,i.prependListener=g,i.prependOnceListener=g,i.listeners=function(e){return[]},i.binding=function(e){throw Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(e){throw Error("process.chdir is not supported")},i.umask=function(){return 0}}},r={};function i(e){var t=r[e];if(void 0!==t)return t.exports;var s=r[e]={exports:{}},a=!0;try{n[e](s,s.exports,i),a=!1}finally{a&&delete r[e]}return s.exports}i.ab=t+"/";var s=i(229);e.exports=s}()},6271:e=>{var t="/";!function(){"use strict";var n={815:function(e){function t(e,t){return Object.prototype.hasOwnProperty.call(e,t)}e.exports=function(e,r,i,s){r=r||"&",i=i||"=";var a={};if("string"!=typeof e||0===e.length)return a;var o=/\+/g;e=e.split(r);var l=1e3;s&&"number"==typeof s.maxKeys&&(l=s.maxKeys);var u=e.length;l>0&&u>l&&(u=l);for(var c=0;c<u;++c){var h,d,p,f,g=e[c].replace(o,"%20"),m=g.indexOf(i);m>=0?(h=g.substr(0,m),d=g.substr(m+1)):(h=g,d=""),p=decodeURIComponent(h),f=decodeURIComponent(d),t(a,p)?n(a[p])?a[p].push(f):a[p]=[a[p],f]:a[p]=f}return a};var n=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)}},577:function(e){var t=function(e){switch(typeof e){case"string":return e;case"boolean":return e?"true":"false";case"number":return isFinite(e)?e:"";default:return""}};e.exports=function(e,s,a,o){return(s=s||"&",a=a||"=",null===e&&(e=void 0),"object"==typeof e)?r(i(e),function(i){var o=encodeURIComponent(t(i))+a;return n(e[i])?r(e[i],function(e){return o+encodeURIComponent(t(e))}).join(s):o+encodeURIComponent(t(e[i]))}).join(s):o?encodeURIComponent(t(o))+a+encodeURIComponent(t(e)):""};var n=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)};function r(e,t){if(e.map)return e.map(t);for(var n=[],r=0;r<e.length;r++)n.push(t(e[r],r));return n}var i=Object.keys||function(e){var t=[];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.push(n);return t}}},r={};function i(e){var t=r[e];if(void 0!==t)return t.exports;var s=r[e]={exports:{}},a=!0;try{n[e](s,s.exports,i),a=!1}finally{a&&delete r[e]}return s.exports}i.ab=t+"/";var s={};!function(){var e=s;e.decode=e.parse=i(815),e.encode=e.stringify=i(577)}(),e.exports=s}()},1106:(e,t,n)=>{n(6397)},6715:(e,t,n)=>{e.exports=n(8440)},7391:(e,t,n)=>{var r=n(7180),i=n(3181),s=n(3031),a=n(9067),o=n(6833),l=n(3717),u=n(4801);u.alea=r,u.xor128=i,u.xorwow=s,u.xorshift7=a,u.xor4096=o,u.tychei=l,e.exports=u},7180:function(e,t,n){var r;!function(e,i,s){function a(e){var t=this,n=u();t.next=function(){var e=2091639*t.s0+23283064365386963e-26*t.c;return t.s0=t.s1,t.s1=t.s2,t.s2=e-(t.c=0|e)},t.c=1,t.s0=n(" "),t.s1=n(" "),t.s2=n(" "),t.s0-=n(e),t.s0<0&&(t.s0+=1),t.s1-=n(e),t.s1<0&&(t.s1+=1),t.s2-=n(e),t.s2<0&&(t.s2+=1)}function o(e,t){return t.c=e.c,t.s0=e.s0,t.s1=e.s1,t.s2=e.s2,t}function l(e,t){var n=new a(e),r=t&&t.state,i=n.next;return i.int32=function(){return 0x100000000*n.next()|0},i.double=function(){return i()+(2097152*i()|0)*11102230246251565e-32},i.quick=i,r&&("object"==typeof r&&o(r,n),i.state=function(){return o(n,{})}),i}function u(){var e=0xefc8249d;return function(t){t=String(t);for(var n=0;n<t.length;n++){var r=.02519603282416938*(e+=t.charCodeAt(n));e=r>>>0,r-=e,r*=e,e=r>>>0,r-=e,e+=0x100000000*r}return(e>>>0)*23283064365386963e-26}}i&&i.exports?i.exports=l:n.amdD&&n.amdO?void 0!==(r=(function(){return l}).call(t,n,t,i))&&(i.exports=r):this.alea=l}(0,e=n.nmd(e),n.amdD)},3717:function(e,t,n){var r;!function(e,i,s){function a(e){var t=this,n="";t.next=function(){var e=t.b,n=t.c,r=t.d,i=t.a;return e=e<<25^e>>>7^n,n=n-r|0,r=r<<24^r>>>8^i,i=i-e|0,t.b=e=e<<20^e>>>12^n,t.c=n=n-r|0,t.d=r<<16^n>>>16^i,t.a=i-e|0},t.a=0,t.b=0,t.c=-0x61c88647,t.d=0x517cc1b7,e===Math.floor(e)?(t.a=e/0x100000000|0,t.b=0|e):n+=e;for(var r=0;r<n.length+20;r++)t.b^=0|n.charCodeAt(r),t.next()}function o(e,t){return t.a=e.a,t.b=e.b,t.c=e.c,t.d=e.d,t}function l(e,t){var n=new a(e),r=t&&t.state,i=function(){return(n.next()>>>0)/0x100000000};return i.double=function(){do var e=((n.next()>>>11)+(n.next()>>>0)/0x100000000)/2097152;while(0===e);return e},i.int32=n.next,i.quick=i,r&&("object"==typeof r&&o(r,n),i.state=function(){return o(n,{})}),i}i&&i.exports?i.exports=l:n.amdD&&n.amdO?void 0!==(r=(function(){return l}).call(t,n,t,i))&&(i.exports=r):this.tychei=l}(0,e=n.nmd(e),n.amdD)},3181:function(e,t,n){var r;!function(e,i,s){function a(e){var t=this,n="";t.x=0,t.y=0,t.z=0,t.w=0,t.next=function(){var e=t.x^t.x<<11;return t.x=t.y,t.y=t.z,t.z=t.w,t.w^=t.w>>>19^e^e>>>8},e===(0|e)?t.x=e:n+=e;for(var r=0;r<n.length+64;r++)t.x^=0|n.charCodeAt(r),t.next()}function o(e,t){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t}function l(e,t){var n=new a(e),r=t&&t.state,i=function(){return(n.next()>>>0)/0x100000000};return i.double=function(){do var e=((n.next()>>>11)+(n.next()>>>0)/0x100000000)/2097152;while(0===e);return e},i.int32=n.next,i.quick=i,r&&("object"==typeof r&&o(r,n),i.state=function(){return o(n,{})}),i}i&&i.exports?i.exports=l:n.amdD&&n.amdO?void 0!==(r=(function(){return l}).call(t,n,t,i))&&(i.exports=r):this.xor128=l}(0,e=n.nmd(e),n.amdD)},6833:function(e,t,n){var r;!function(e,i,s){function a(e){var t=this;t.next=function(){var e,n,r=t.w,i=t.X,s=t.i;return t.w=r=r+0x61c88647|0,n=i[s+34&127],e=i[s=s+1&127],n^=n<<13,e^=e<<17,n^=n>>>15,e^=e>>>12,n=i[s]=n^e,t.i=s,n+(r^r>>>16)|0},function(e,t){var n,r,i,s,a,o=[],l=128;for(t===(0|t)?(r=t,t=null):(t+="\0",r=0,l=Math.max(l,t.length)),i=0,s=-32;s<l;++s)t&&(r^=t.charCodeAt((s+32)%t.length)),0===s&&(a=r),r^=r<<10,r^=r>>>15,r^=r<<4,r^=r>>>13,s>=0&&(a=a+0x61c88647|0,i=0==(n=o[127&s]^=r+a)?i+1:0);for(i>=128&&(o[127&(t&&t.length||0)]=-1),i=127,s=512;s>0;--s)r=o[i+34&127],n=o[i=i+1&127],r^=r<<13,n^=n<<17,r^=r>>>15,n^=n>>>12,o[i]=r^n;e.w=a,e.X=o,e.i=i}(t,e)}function o(e,t){return t.i=e.i,t.w=e.w,t.X=e.X.slice(),t}function l(e,t){null==e&&(e=+new Date);var n=new a(e),r=t&&t.state,i=function(){return(n.next()>>>0)/0x100000000};return i.double=function(){do var e=((n.next()>>>11)+(n.next()>>>0)/0x100000000)/2097152;while(0===e);return e},i.int32=n.next,i.quick=i,r&&(r.X&&o(r,n),i.state=function(){return o(n,{})}),i}i&&i.exports?i.exports=l:n.amdD&&n.amdO?void 0!==(r=(function(){return l}).call(t,n,t,i))&&(i.exports=r):this.xor4096=l}(0,e=n.nmd(e),n.amdD)},9067:function(e,t,n){var r;!function(e,i,s){function a(e){var t=this;t.next=function(){var e,n,r=t.x,i=t.i;return e=r[i],e^=e>>>7,n=e^e<<24^((e=r[i+1&7])^e>>>10)^((e=r[i+3&7])^e>>>3)^((e=r[i+4&7])^e<<7),e=r[i+7&7],e^=e<<13,n^=e^e<<9,r[i]=n,t.i=i+1&7,n},function(e,t){var n,r,i=[];if(t===(0|t))r=i[0]=t;else for(n=0,t=""+t;n<t.length;++n)i[7&n]=i[7&n]<<15^t.charCodeAt(n)+i[n+1&7]<<13;for(;i.length<8;)i.push(0);for(n=0;n<8&&0===i[n];++n);for(r=8==n?i[7]=-1:i[n],e.x=i,e.i=0,n=256;n>0;--n)e.next()}(t,e)}function o(e,t){return t.x=e.x.slice(),t.i=e.i,t}function l(e,t){null==e&&(e=+new Date);var n=new a(e),r=t&&t.state,i=function(){return(n.next()>>>0)/0x100000000};return i.double=function(){do var e=((n.next()>>>11)+(n.next()>>>0)/0x100000000)/2097152;while(0===e);return e},i.int32=n.next,i.quick=i,r&&(r.x&&o(r,n),i.state=function(){return o(n,{})}),i}i&&i.exports?i.exports=l:n.amdD&&n.amdO?void 0!==(r=(function(){return l}).call(t,n,t,i))&&(i.exports=r):this.xorshift7=l}(0,e=n.nmd(e),n.amdD)},3031:function(e,t,n){var r;!function(e,i,s){function a(e){var t=this,n="";t.next=function(){var e=t.x^t.x>>>2;return t.x=t.y,t.y=t.z,t.z=t.w,t.w=t.v,(t.d=t.d+362437|0)+(t.v=t.v^t.v<<4^(e^e<<1))|0},t.x=0,t.y=0,t.z=0,t.w=0,t.v=0,e===(0|e)?t.x=e:n+=e;for(var r=0;r<n.length+64;r++)t.x^=0|n.charCodeAt(r),r==n.length&&(t.d=t.x<<10^t.x>>>4),t.next()}function o(e,t){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t.v=e.v,t.d=e.d,t}function l(e,t){var n=new a(e),r=t&&t.state,i=function(){return(n.next()>>>0)/0x100000000};return i.double=function(){do var e=((n.next()>>>11)+(n.next()>>>0)/0x100000000)/2097152;while(0===e);return e},i.int32=n.next,i.quick=i,r&&("object"==typeof r&&o(r,n),i.state=function(){return o(n,{})}),i}i&&i.exports?i.exports=l:n.amdD&&n.amdO?void 0!==(r=(function(){return l}).call(t,n,t,i))&&(i.exports=r):this.xorwow=l}(0,e=n.nmd(e),n.amdD)},4801:function(e,t,n){var r;!function(i,s,a){var o,l=256,u=6,c=52,h="random",d=a.pow(l,u),p=a.pow(2,c),f=2*p,g=l-1;function m(e,t,n){var r=[],i=w(v((t=!0==t?{entropy:!0}:t||{}).entropy?[e,x(s)]:null==e?_():e,3),r),o=new y(r),c=function(){for(var e=o.g(u),t=d,n=0;e<p;)e=(e+n)*l,t*=l,n=o.g(1);for(;e>=f;)e/=2,t/=2,n>>>=1;return(e+n)/t};return c.int32=function(){return 0|o.g(4)},c.quick=function(){return o.g(4)/0x100000000},c.double=c,w(x(o.S),s),(t.pass||n||function(e,t,n,r){return(r&&(r.S&&b(r,o),e.state=function(){return b(o,{})}),n)?(a[h]=e,t):e})(c,i,"global"in t?t.global:this==a,t.state)}function y(e){var t,n=e.length,r=this,i=0,s=r.i=r.j=0,a=r.S=[];for(n||(e=[n++]);i<l;)a[i]=i++;for(i=0;i<l;i++)a[i]=a[s=g&s+e[i%n]+(t=a[i])],a[s]=t;(r.g=function(e){for(var t,n=0,i=r.i,s=r.j,a=r.S;e--;)t=a[i=g&i+1],n=n*l+a[g&(a[i]=a[s=g&s+t])+(a[s]=t)];return r.i=i,r.j=s,n})(l)}function b(e,t){return t.i=e.i,t.j=e.j,t.S=e.S.slice(),t}function v(e,t){var n,r=[],i=typeof e;if(t&&"object"==i)for(n in e)try{r.push(v(e[n],t-1))}catch(e){}return r.length?r:"string"==i?e:e+"\0"}function w(e,t){for(var n,r=e+"",i=0;i<r.length;)t[g&i]=g&(n^=19*t[g&i])+r.charCodeAt(i++);return x(t)}function _(){try{var e;return o&&(e=o.randomBytes)?e=e(l):(e=new Uint8Array(l),(i.crypto||i.msCrypto).getRandomValues(e)),x(e)}catch(e){var t=i.navigator,n=t&&t.plugins;return[+new Date,i,n,i.screen,x(s)]}}function x(e){return String.fromCharCode.apply(0,e)}if(w(a.random(),s),e.exports){e.exports=m;try{o=n(1234)}catch(e){}}else void 0!==(r=(function(){return m}).call(t,n,t,e))&&(e.exports=r)}("undefined"!=typeof self?self:this,[],Math)},7172:(e,t,n)=>{e.exports={labels:n(7674),scoringStrategy:n(4283)}},4283:(e,t,n)=>{var r=n(3502);e.exports={apply:function(e,t,n){return t>0&&r[e[t-1]]&&(n=-n),n}}},3335:(e,t,n)=>{var r={"./en/index":7172};function i(e){return n(s(e))}function s(e){if(!n.o(r,e)){var t=Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return r[e]}i.keys=function(){return Object.keys(r)},i.resolve=s,e.exports=i,i.id=3335},362:(e,t,n)=>{var r=n(7836),i=n(8325),s=n(787),a=function(e){this.options=e};a.prototype.registerLanguage=function(e,t){s.addLanguage(e,t)},a.prototype.analyze=function(e,t,n){void 0===e&&(e=""),"function"==typeof t&&(n=t,t={});var a=(t=t||{}).language||"en",o=s.getLabels(a);"object"==typeof t.extras&&(o=Object.assign(o,t.extras));for(var l=i(e),u=0,c=[],h=[],d=[],p=[],f=l.length;f--;){var g=l[f];if(o.hasOwnProperty(g)){c.push(g);var m=o[g];(m=s.applyScoringStrategy(a,l,f,m))>0&&h.push(g),m<0&&d.push(g),u+=m;var y={};y[g]=m,p.push(y)}}var b={score:u,comparative:l.length>0?u/l.length:0,calculation:p,tokens:l,words:c,positive:h,negative:d};if("function"!=typeof n)return b;r.nextTick(function(){n(null,b)})},e.exports=a},787:(e,t,n)=>{var r=n(8864),i=n(7172);Object.assign(i.labels,r);var s={en:i};e.exports={addLanguage:function(e,t){if(!t.labels)throw Error("language.labels must be defined!");Object.assign(t.labels,r),s[e]=t},getLanguage:function(e){if(!e)return s.en;if(!s[e])try{var t=n(3335)("./"+e+"/index");this.addLanguage(e,t)}catch(t){throw Error("No language found: "+e)}return s[e]},getLabels:function(e){return this.getLanguage(e).labels},applyScoringStrategy:function(e,t,n,r){return(this.getLanguage(e).scoringStrategy||a).apply(t,n,r)}};var a={apply:function(e,t,n){return n}}},8325:e=>{e.exports=function(e){return e.toLowerCase().replace(/\n/g," ").replace(/[.,\/#!?$%\^&\*;:{}=_`\"~()]/g," ").replace(/\s\s+/g," ").trim().split(" ")}},5160:(e,t,n)=>{"use strict";var r=n(6540);function i(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t}var s="function"==typeof Object.is?Object.is:i,a=r.useSyncExternalStore,o=r.useRef,l=r.useEffect,u=r.useMemo,c=r.useDebugValue;t.useSyncExternalStoreWithSelector=function(e,t,n,r,i){var h=o(null);if(null===h.current){var d={hasValue:!1,value:null};h.current=d}else d=h.current;var p=a(e,(h=u(function(){function e(e){if(!l){if(l=!0,a=e,e=r(e),void 0!==i&&d.hasValue){var t=d.value;if(i(t,e))return o=t}return o=e}if(t=o,s(a,e))return t;var n=r(e);return void 0!==i&&i(t,n)?(a=e,t):(a=e,o=n)}var a,o,l=!1,u=void 0===n?null:n;return[function(){return e(t())},null===u?void 0:function(){return e(u())}]},[t,n,r,i]))[0],h[1]);return l(function(){d.hasValue=!0,d.value=p},[p]),c(p),p}},8418:(e,t,n)=>{"use strict";e.exports=n(5160)},7078:()=>{},6905:()=>{},4637:()=>{},279:()=>{},4222:()=>{},3052:()=>{},143:()=>{},2603:()=>{},7806:()=>{},2009:()=>{},6837:()=>{},1234:()=>{},9928:(e,t,n)=>{"use strict";let r,i;n.d(t,{MF:()=>H,j6:()=>V,xZ:()=>j,om:()=>U,Sx:()=>X,Wp:()=>K,KO:()=>Y});var s=n(5125),a=n(3424),o=n(6743);let l=(e,t)=>t.some(t=>e instanceof t);function u(){return r||(r=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function c(){return i||(i=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}let h=new WeakMap,d=new WeakMap,p=new WeakMap,f=new WeakMap,g=new WeakMap;function m(e){let t=new Promise((t,n)=>{let r=()=>{e.removeEventListener("success",i),e.removeEventListener("error",s)},i=()=>{t(x(e.result)),r()},s=()=>{n(e.error),r()};e.addEventListener("success",i),e.addEventListener("error",s)});return t.then(t=>{t instanceof IDBCursor&&h.set(t,e)}).catch(()=>{}),g.set(t,e),t}function y(e){if(d.has(e))return;let t=new Promise((t,n)=>{let r=()=>{e.removeEventListener("complete",i),e.removeEventListener("error",s),e.removeEventListener("abort",s)},i=()=>{t(),r()},s=()=>{n(e.error||new DOMException("AbortError","AbortError")),r()};e.addEventListener("complete",i),e.addEventListener("error",s),e.addEventListener("abort",s)});d.set(e,t)}let b={get(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return d.get(e);if("objectStoreNames"===t)return e.objectStoreNames||p.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return x(e[t])},set:(e,t,n)=>(e[t]=n,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function v(e){b=e(b)}function w(e){return e!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?c().includes(e)?function(...t){return e.apply(T(this),t),x(h.get(this))}:function(...t){return x(e.apply(T(this),t))}:function(t,...n){let r=e.call(T(this),t,...n);return p.set(r,t.sort?t.sort():[t]),x(r)}}function _(e){return"function"==typeof e?w(e):(e instanceof IDBTransaction&&y(e),l(e,u()))?new Proxy(e,b):e}function x(e){if(e instanceof IDBRequest)return m(e);if(f.has(e))return f.get(e);let t=_(e);return t!==e&&(f.set(e,t),g.set(t,e)),t}let T=e=>g.get(e);function I(e,t,{blocked:n,upgrade:r,blocking:i,terminated:s}={}){let a=indexedDB.open(e,t),o=x(a);return r&&a.addEventListener("upgradeneeded",e=>{r(x(a.result),e.oldVersion,e.newVersion,x(a.transaction),e)}),n&&a.addEventListener("blocked",e=>n(e.oldVersion,e.newVersion,e)),o.then(e=>{s&&e.addEventListener("close",()=>s()),i&&e.addEventListener("versionchange",e=>i(e.oldVersion,e.newVersion,e))}).catch(()=>{}),o}let k=["get","getKey","getAll","getAllKeys","count"],S=["put","add","delete","clear"],E=new Map;function C(e,t){if(!(e instanceof IDBDatabase&&!(t in e)&&"string"==typeof t))return;if(E.get(t))return E.get(t);let n=t.replace(/FromIndex$/,""),r=t!==n,i=S.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!(i||k.includes(n)))return;let s=async function(e,...t){let s=this.transaction(e,i?"readwrite":"readonly"),a=s.store;return r&&(a=a.index(t.shift())),(await Promise.all([a[n](...t),i&&s.done]))[0]};return E.set(t,s),s}v(e=>({...e,get:(t,n,r)=>C(t,n)||e.get(t,n,r),has:(t,n)=>!!C(t,n)||e.has(t,n)}));class A{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(e=>{if(!N(e))return null;{let t=e.getImmediate();return`${t.library}/${t.version}`}}).filter(e=>e).join(" ")}}function N(e){let t=e.getComponent();return(null==t?void 0:t.type)==="VERSION"}let O="@firebase/app",$="0.10.18",R=new a.Vy("@firebase/app"),D="11.2.0",F="[DEFAULT]",P={[O]:"fire-core","@firebase/app-compat":"fire-core-compat","@firebase/analytics":"fire-analytics","@firebase/analytics-compat":"fire-analytics-compat","@firebase/app-check":"fire-app-check","@firebase/app-check-compat":"fire-app-check-compat","@firebase/auth":"fire-auth","@firebase/auth-compat":"fire-auth-compat","@firebase/database":"fire-rtdb","@firebase/data-connect":"fire-data-connect","@firebase/database-compat":"fire-rtdb-compat","@firebase/functions":"fire-fn","@firebase/functions-compat":"fire-fn-compat","@firebase/installations":"fire-iid","@firebase/installations-compat":"fire-iid-compat","@firebase/messaging":"fire-fcm","@firebase/messaging-compat":"fire-fcm-compat","@firebase/performance":"fire-perf","@firebase/performance-compat":"fire-perf-compat","@firebase/remote-config":"fire-rc","@firebase/remote-config-compat":"fire-rc-compat","@firebase/storage":"fire-gcs","@firebase/storage-compat":"fire-gcs-compat","@firebase/firestore":"fire-fst","@firebase/firestore-compat":"fire-fst-compat","@firebase/vertexai":"fire-vertex","fire-js":"fire-js",firebase:"fire-js-all"},M=new Map,L=new Map,z=new Map;function B(e,t){try{e.container.addComponent(t)}catch(n){R.debug(`Component ${t.name} failed to register with FirebaseApp ${e.name}`,n)}}function U(e){let t=e.name;if(z.has(t))return R.debug(`There were multiple attempts to register component ${t}.`),!1;for(let n of(z.set(t,e),M.values()))B(n,e);for(let t of L.values())B(t,e);return!0}function V(e,t){let n=e.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),e.container.getProvider(t)}function j(e){return void 0!==e.settings}let G={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},W=new o.FA("app","Firebase",G);class q{constructor(e,t,n){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new s.uA("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw W.create("app-deleted",{appName:this._name})}}let H=D;function K(e,t={}){let n=e;"object"!=typeof t&&(t={name:t});let r=Object.assign({name:F,automaticDataCollectionEnabled:!1},t),i=r.name;if("string"!=typeof i||!i)throw W.create("bad-app-name",{appName:String(i)});if(n||(n=(0,o.T9)()),!n)throw W.create("no-options");let a=M.get(i);if(a){if((0,o.bD)(n,a.options)&&(0,o.bD)(r,a.config))return a;throw W.create("duplicate-app",{appName:i})}let l=new s.h1(i);for(let e of z.values())l.addComponent(e);let u=new q(n,r,l);return M.set(i,u),u}function X(e=F){let t=M.get(e);if(!t&&e===F&&(0,o.T9)())return K();if(!t)throw W.create("no-app",{appName:e});return t}function Y(e,t,n){var r;let i=null!==(r=P[e])&&void 0!==r?r:e;n&&(i+=`-${n}`);let a=i.match(/\s|\//),o=t.match(/\s|\//);if(a||o){let e=[`Unable to register library "${i}" with version "${t}":`];a&&e.push(`library name "${i}" contains illegal characters (whitespace or "/")`),a&&o&&e.push("and"),o&&e.push(`version name "${t}" contains illegal characters (whitespace or "/")`),R.warn(e.join(" "));return}U(new s.uA(`${i}-version`,()=>({library:i,version:t}),"VERSION"))}let Q="firebase-heartbeat-database",J=1,Z="firebase-heartbeat-store",ee=null;function et(){return ee||(ee=I(Q,J,{upgrade:(e,t)=>{if(0===t)try{e.createObjectStore(Z)}catch(e){console.warn(e)}}}).catch(e=>{throw W.create("idb-open",{originalErrorMessage:e.message})})),ee}async function en(e){try{let t=(await et()).transaction(Z),n=await t.objectStore(Z).get(ei(e));return await t.done,n}catch(e){if(e instanceof o.g)R.warn(e.message);else{let t=W.create("idb-get",{originalErrorMessage:null==e?void 0:e.message});R.warn(t.message)}}}async function er(e,t){try{let n=(await et()).transaction(Z,"readwrite"),r=n.objectStore(Z);await r.put(t,ei(e)),await n.done}catch(e){if(e instanceof o.g)R.warn(e.message);else{let t=W.create("idb-set",{originalErrorMessage:null==e?void 0:e.message});R.warn(t.message)}}}function ei(e){return`${e.name}!${e.options.appId}`}let es=1024,ea=2592e6;class eo{constructor(e){this.container=e,this._heartbeatsCache=null;let t=this.container.getProvider("app").getImmediate();this._storage=new ec(t),this._heartbeatsCachePromise=this._storage.read().then(e=>(this._heartbeatsCache=e,e))}async triggerHeartbeat(){var e,t;try{let n=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),r=el();if((null===(e=this._heartbeatsCache)||void 0===e?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,(null===(t=this._heartbeatsCache)||void 0===t?void 0:t.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===r||this._heartbeatsCache.heartbeats.some(e=>e.date===r))return;return this._heartbeatsCache.heartbeats.push({date:r,agent:n}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter(e=>{let t=new Date(e.date).valueOf();return Date.now()-t<=ea}),this._storage.overwrite(this._heartbeatsCache)}catch(e){R.warn(e)}}async getHeartbeatsHeader(){var e;try{if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,(null===(e=this._heartbeatsCache)||void 0===e?void 0:e.heartbeats)==null||0===this._heartbeatsCache.heartbeats.length)return"";let t=el(),{heartbeatsToSend:n,unsentEntries:r}=eu(this._heartbeatsCache.heartbeats),i=(0,o.Uj)(JSON.stringify({version:2,heartbeats:n}));return this._heartbeatsCache.lastSentHeartbeatDate=t,r.length>0?(this._heartbeatsCache.heartbeats=r,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}catch(e){return R.warn(e),""}}}function el(){return new Date().toISOString().substring(0,10)}function eu(e,t=es){let n=[],r=e.slice();for(let i of e){let e=n.find(e=>e.agent===i.agent);if(e){if(e.dates.push(i.date),eh(n)>t){e.dates.pop();break}}else if(n.push({agent:i.agent,dates:[i.date]}),eh(n)>t){n.pop();break}r=r.slice(1)}return{heartbeatsToSend:n,unsentEntries:r}}class ec{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!(0,o.zW)()&&(0,o.eX)().then(()=>!0).catch(()=>!1)}async read(){if(!await this._canUseIndexedDBPromise)return{heartbeats:[]};{let e=await en(this.app);return(null==e?void 0:e.heartbeats)?e:{heartbeats:[]}}}async overwrite(e){var t;if(await this._canUseIndexedDBPromise){let n=await this.read();return er(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:n.lastSentHeartbeatDate,heartbeats:e.heartbeats})}}async add(e){var t;if(await this._canUseIndexedDBPromise){let n=await this.read();return er(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:n.lastSentHeartbeatDate,heartbeats:[...n.heartbeats,...e.heartbeats]})}}}function eh(e){return(0,o.Uj)(JSON.stringify({version:2,heartbeats:e})).length}!function(e){U(new s.uA("platform-logger",e=>new A(e),"PRIVATE")),U(new s.uA("heartbeat",e=>new eo(e),"PRIVATE")),Y(O,$,""),Y(O,$,"esm2017"),Y("fire-js","")}(0)},5125:(e,t,n)=>{"use strict";n.d(t,{h1:()=>u,uA:()=>i});var r=n(6743);class i{constructor(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}let s="[DEFAULT]";class a{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){let t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){let e=new r.cY;if(this.instancesDeferred.set(t,e),this.isInitialized(t)||this.shouldAutoInitialize())try{let n=this.getOrInitializeService({instanceIdentifier:t});n&&e.resolve(n)}catch(e){}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;let n=this.normalizeInstanceIdentifier(null==e?void 0:e.identifier),r=null!==(t=null==e?void 0:e.optional)&&void 0!==t&&t;if(this.isInitialized(n)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:n})}catch(e){if(r)return null;throw e}else{if(r)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,this.shouldAutoInitialize()){if(l(e))try{this.getOrInitializeService({instanceIdentifier:s})}catch(e){}for(let[e,t]of this.instancesDeferred.entries()){let n=this.normalizeInstanceIdentifier(e);try{let e=this.getOrInitializeService({instanceIdentifier:n});t.resolve(e)}catch(e){}}}}clearInstance(e=s){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){let e=Array.from(this.instances.values());await Promise.all([...e.filter(e=>"INTERNAL"in e).map(e=>e.INTERNAL.delete()),...e.filter(e=>"_delete"in e).map(e=>e._delete())])}isComponentSet(){return null!=this.component}isInitialized(e=s){return this.instances.has(e)}getOptions(e=s){return this.instancesOptions.get(e)||{}}initialize(e={}){let{options:t={}}=e,n=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);let r=this.getOrInitializeService({instanceIdentifier:n,options:t});for(let[e,t]of this.instancesDeferred.entries())n===this.normalizeInstanceIdentifier(e)&&t.resolve(r);return r}onInit(e,t){var n;let r=this.normalizeInstanceIdentifier(t),i=null!==(n=this.onInitCallbacks.get(r))&&void 0!==n?n:new Set;i.add(e),this.onInitCallbacks.set(r,i);let s=this.instances.get(r);return s&&e(s,r),()=>{i.delete(e)}}invokeOnInitCallbacks(e,t){let n=this.onInitCallbacks.get(t);if(n)for(let r of n)try{r(e,t)}catch(e){}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let n=this.instances.get(e);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:o(e),options:t}),this.instances.set(e,n),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(n,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,n)}catch(e){}return n||null}normalizeInstanceIdentifier(e=s){return this.component?this.component.multipleInstances?e:s:e}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}function o(e){return e===s?void 0:e}function l(e){return"EAGER"===e.instantiationMode}class u{constructor(e){this.name=e,this.providers=new Map}addComponent(e){let t=this.getProvider(e.name);if(t.isComponentSet())throw Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);let t=new a(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}},3424:(e,t,n)=>{"use strict";var r;n.d(t,{$b:()=>r,Vy:()=>u});let i=[];!function(e){e[e.DEBUG=0]="DEBUG",e[e.VERBOSE=1]="VERBOSE",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.SILENT=5]="SILENT"}(r||(r={}));let s={debug:r.DEBUG,verbose:r.VERBOSE,info:r.INFO,warn:r.WARN,error:r.ERROR,silent:r.SILENT},a=r.INFO,o={[r.DEBUG]:"log",[r.VERBOSE]:"log",[r.INFO]:"info",[r.WARN]:"warn",[r.ERROR]:"error"},l=(e,t,...n)=>{if(t<e.logLevel)return;let r=new Date().toISOString(),i=o[t];if(i)console[i](`[${r}]  ${e.name}:`,...n);else throw Error(`Attempted to log a message with an invalid logType (value: ${t})`)};class u{constructor(e){this.name=e,this._logLevel=a,this._logHandler=l,this._userLogHandler=null,i.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in r))throw TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel="string"==typeof e?s[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if("function"!=typeof e)throw TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,r.DEBUG,...e),this._logHandler(this,r.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,r.VERBOSE,...e),this._logHandler(this,r.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,r.INFO,...e),this._logHandler(this,r.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,r.WARN,...e),this._logHandler(this,r.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,r.ERROR,...e),this._logHandler(this,r.ERROR,...e)}}},6737:(e,t,n)=>{"use strict";n.d(t,{U1:()=>e8,zD:()=>tu,Z0:()=>tm});var r,i=Symbol.for("immer-nothing"),s=Symbol.for("immer-draftable"),a=Symbol.for("immer-state");function o(e,...t){throw Error(`[Immer] minified error nr: ${e}. Full error at: https://bit.ly/3cXEKWf`)}var l=Object.getPrototypeOf;function u(e){return!!e&&!!e[a]}function c(e){return!!e&&(d(e)||Array.isArray(e)||!!e[s]||!!e.constructor?.[s]||b(e)||v(e))}var h=Object.prototype.constructor.toString();function d(e){if(!e||"object"!=typeof e)return!1;let t=l(e);if(null===t)return!0;let n=Object.hasOwnProperty.call(t,"constructor")&&t.constructor;return n===Object||"function"==typeof n&&Function.toString.call(n)===h}function p(e,t){0===f(e)?Reflect.ownKeys(e).forEach(n=>{t(n,e[n],e)}):e.forEach((n,r)=>t(r,n,e))}function f(e){let t=e[a];return t?t.type_:Array.isArray(e)?1:b(e)?2:v(e)?3:0}function g(e,t){return 2===f(e)?e.has(t):Object.prototype.hasOwnProperty.call(e,t)}function m(e,t,n){let r=f(e);2===r?e.set(t,n):3===r?e.add(n):e[t]=n}function y(e,t){return e===t?0!==e||1/e==1/t:e!=e&&t!=t}function b(e){return e instanceof Map}function v(e){return e instanceof Set}function w(e){return e.copy_||e.base_}function _(e,t){if(b(e))return new Map(e);if(v(e))return new Set(e);if(Array.isArray(e))return Array.prototype.slice.call(e);let n=d(e);if(!0!==t&&("class_only"!==t||n)){let t=l(e);return null!==t&&n?{...e}:Object.assign(Object.create(t),e)}{let t=Object.getOwnPropertyDescriptors(e);delete t[a];let n=Reflect.ownKeys(t);for(let r=0;r<n.length;r++){let i=n[r],s=t[i];!1===s.writable&&(s.writable=!0,s.configurable=!0),(s.get||s.set)&&(t[i]={configurable:!0,writable:!0,enumerable:s.enumerable,value:e[i]})}return Object.create(l(e),t)}}function x(e,t=!1){return I(e)||u(e)||!c(e)||(f(e)>1&&(e.set=e.add=e.clear=e.delete=T),Object.freeze(e),t&&Object.entries(e).forEach(([e,t])=>x(t,!0))),e}function T(){o(2)}function I(e){return Object.isFrozen(e)}var k={};function S(e){let t=k[e];return t||o(0,e),t}function E(){return r}function C(e,t){return{drafts_:[],parent_:e,immer_:t,canAutoFreeze_:!0,unfinalizedDrafts_:0}}function A(e,t){t&&(S("Patches"),e.patches_=[],e.inversePatches_=[],e.patchListener_=t)}function N(e){O(e),e.drafts_.forEach(R),e.drafts_=null}function O(e){e===r&&(r=e.parent_)}function $(e){return r=C(r,e)}function R(e){let t=e[a];0===t.type_||1===t.type_?t.revoke_():t.revoked_=!0}function D(e,t){t.unfinalizedDrafts_=t.drafts_.length;let n=t.drafts_[0];return void 0!==e&&e!==n?(n[a].modified_&&(N(t),o(4)),c(e)&&(e=F(t,e),t.parent_||M(t,e)),t.patches_&&S("Patches").generateReplacementPatches_(n[a].base_,e,t.patches_,t.inversePatches_)):e=F(t,n,[]),N(t),t.patches_&&t.patchListener_(t.patches_,t.inversePatches_),e!==i?e:void 0}function F(e,t,n){if(I(t))return t;let r=t[a];if(!r)return p(t,(i,s)=>P(e,r,t,i,s,n)),t;if(r.scope_!==e)return t;if(!r.modified_)return M(e,r.base_,!0),r.base_;if(!r.finalized_){r.finalized_=!0,r.scope_.unfinalizedDrafts_--;let t=r.copy_,i=t,s=!1;3===r.type_&&(i=new Set(t),t.clear(),s=!0),p(i,(i,a)=>P(e,r,t,i,a,n,s)),M(e,t,!1),n&&e.patches_&&S("Patches").generatePatches_(r,n,e.patches_,e.inversePatches_)}return r.copy_}function P(e,t,n,r,i,s,a){if(u(i)){let a=F(e,i,s&&t&&3!==t.type_&&!g(t.assigned_,r)?s.concat(r):void 0);if(m(n,r,a),!u(a))return;e.canAutoFreeze_=!1}else a&&n.add(i);if(c(i)&&!I(i)){if(!e.immer_.autoFreeze_&&e.unfinalizedDrafts_<1)return;F(e,i),(!t||!t.scope_.parent_)&&"symbol"!=typeof r&&Object.prototype.propertyIsEnumerable.call(n,r)&&M(e,i)}}function M(e,t,n=!1){!e.parent_&&e.immer_.autoFreeze_&&e.canAutoFreeze_&&x(t,n)}function L(e,t){let n=Array.isArray(e),r={type_:n?1:0,scope_:t?t.scope_:E(),modified_:!1,finalized_:!1,assigned_:{},parent_:t,base_:e,draft_:null,copy_:null,revoke_:null,isManual_:!1},i=r,s=z;n&&(i=[r],s=B);let{revoke:a,proxy:o}=Proxy.revocable(i,s);return r.draft_=o,r.revoke_=a,o}var z={get(e,t){if(t===a)return e;let n=w(e);if(!g(n,t))return V(e,n,t);let r=n[t];return e.finalized_||!c(r)?r:r===U(e.base_,t)?(W(e),e.copy_[t]=q(r,e)):r},has:(e,t)=>t in w(e),ownKeys:e=>Reflect.ownKeys(w(e)),set(e,t,n){let r=j(w(e),t);if(r?.set)return r.set.call(e.draft_,n),!0;if(!e.modified_){let r=U(w(e),t),i=r?.[a];if(i&&i.base_===n)return e.copy_[t]=n,e.assigned_[t]=!1,!0;if(y(n,r)&&(void 0!==n||g(e.base_,t)))return!0;W(e),G(e)}return!!(e.copy_[t]===n&&(void 0!==n||t in e.copy_)||Number.isNaN(n)&&Number.isNaN(e.copy_[t]))||(e.copy_[t]=n,e.assigned_[t]=!0,!0)},deleteProperty:(e,t)=>(void 0!==U(e.base_,t)||t in e.base_?(e.assigned_[t]=!1,W(e),G(e)):delete e.assigned_[t],e.copy_&&delete e.copy_[t],!0),getOwnPropertyDescriptor(e,t){let n=w(e),r=Reflect.getOwnPropertyDescriptor(n,t);return r?{writable:!0,configurable:1!==e.type_||"length"!==t,enumerable:r.enumerable,value:n[t]}:r},defineProperty(){o(11)},getPrototypeOf:e=>l(e.base_),setPrototypeOf(){o(12)}},B={};function U(e,t){let n=e[a];return(n?w(n):e)[t]}function V(e,t,n){let r=j(t,n);return r?"value"in r?r.value:r.get?.call(e.draft_):void 0}function j(e,t){if(!(t in e))return;let n=l(e);for(;n;){let e=Object.getOwnPropertyDescriptor(n,t);if(e)return e;n=l(n)}}function G(e){!e.modified_&&(e.modified_=!0,e.parent_&&G(e.parent_))}function W(e){e.copy_||(e.copy_=_(e.base_,e.scope_.immer_.useStrictShallowCopy_))}function q(e,t){let n=b(e)?S("MapSet").proxyMap_(e,t):v(e)?S("MapSet").proxySet_(e,t):L(e,t);return(t?t.scope_:E()).drafts_.push(n),n}function H(e){return u(e)||o(10,e),K(e)}function K(e){let t;if(!c(e)||I(e))return e;let n=e[a];if(n){if(!n.modified_)return n.base_;n.finalized_=!0,t=_(e,n.scope_.immer_.useStrictShallowCopy_)}else t=_(e,!0);return p(t,(e,n)=>{m(t,e,K(n))}),n&&(n.finalized_=!1),t}p(z,(e,t)=>{B[e]=function(){return arguments[0]=arguments[0][0],t.apply(this,arguments)}}),B.deleteProperty=function(e,t){return B.set.call(this,e,t,void 0)},B.set=function(e,t,n){return z.set.call(this,e[0],t,n,e[0])};var X=new class{constructor(e){this.autoFreeze_=!0,this.useStrictShallowCopy_=!1,this.produce=(e,t,n)=>{let r;if("function"==typeof e&&"function"!=typeof t){let n=t;t=e;let r=this;return function(e=n,...i){return r.produce(e,e=>t.call(this,e,...i))}}if("function"!=typeof t&&o(6),void 0!==n&&"function"!=typeof n&&o(7),c(e)){let i=$(this),s=q(e,void 0),a=!0;try{r=t(s),a=!1}finally{a?N(i):O(i)}return A(i,n),D(r,i)}if(e&&"object"==typeof e)o(1,e);else{if(void 0===(r=t(e))&&(r=e),r===i&&(r=void 0),this.autoFreeze_&&x(r,!0),n){let t=[],i=[];S("Patches").generateReplacementPatches_(e,r,t,i),n(t,i)}return r}},this.produceWithPatches=(e,t)=>{let n,r;return"function"==typeof e?(t,...n)=>this.produceWithPatches(t,t=>e(t,...n)):[this.produce(e,t,(e,t)=>{n=e,r=t}),n,r]},"boolean"==typeof e?.autoFreeze&&this.setAutoFreeze(e.autoFreeze),"boolean"==typeof e?.useStrictShallowCopy&&this.setUseStrictShallowCopy(e.useStrictShallowCopy)}createDraft(e){c(e)||o(8),u(e)&&(e=H(e));let t=$(this),n=q(e,void 0);return n[a].isManual_=!0,O(t),n}finishDraft(e,t){let n=e&&e[a];n&&n.isManual_||o(9);let{scope_:r}=n;return A(r,t),D(void 0,r)}setAutoFreeze(e){this.autoFreeze_=e}setUseStrictShallowCopy(e){this.useStrictShallowCopy_=e}applyPatches(e,t){let n;for(n=t.length-1;n>=0;n--){let r=t[n];if(0===r.path.length&&"replace"===r.op){e=r.value;break}}n>-1&&(t=t.slice(n+1));let r=S("Patches").applyPatches_;return u(e)?r(e,t):this.produce(e,e=>r(e,t))}},Y=X.produce;X.produceWithPatches.bind(X),X.setAutoFreeze.bind(X),X.setUseStrictShallowCopy.bind(X),X.applyPatches.bind(X),X.createDraft.bind(X),X.finishDraft.bind(X);function Q(e,t=`expected a function, instead received ${typeof e}`){if("function"!=typeof e)throw TypeError(t)}function J(e,t=`expected an object, instead received ${typeof e}`){if("object"!=typeof e)throw TypeError(t)}function Z(e,t="expected all items to be functions, instead received the following types: "){if(!e.every(e=>"function"==typeof e)){let n=e.map(e=>"function"==typeof e?`function ${e.name||"unnamed"}()`:typeof e).join(", ");throw TypeError(`${t}[${n}]`)}}var ee=e=>Array.isArray(e)?e:[e];function et(e){let t=Array.isArray(e[0])?e[0]:e;return Z(t,"createSelector expects all input-selectors to be functions, but received the following types: "),t}function en(e,t){let n=[],{length:r}=e;for(let i=0;i<r;i++)n.push(e[i].apply(null,t));return n}var er=0,ei=null,es=class{revision=er;_value;_lastValue;_isEqual=ea;constructor(e,t=ea){this._value=this._lastValue=e,this._isEqual=t}get value(){return ei?.add(this),this._value}set value(e){this.value!==e&&(this._value=e,this.revision=++er)}};function ea(e,t){return e===t}function eo(e){return e instanceof es||console.warn("Not a valid cell! ",e),e.value}function el(e,t){if(!(e instanceof es))throw TypeError("setValue must be passed a tracked store created with `createStorage`.");e.value=e._lastValue=t}function eu(e,t=ea){return new es(e,t)}var ec=(e,t)=>!1;function eh(){return eu(null,ec)}function ed(e,t){el(e,t)}var ep=e=>{let t=e.collectionTag;null===t&&(t=e.collectionTag=eh()),eo(t)},ef=e=>{let t=e.collectionTag;null!==t&&ed(t,null)};Symbol();var eg=0,em=Object.getPrototypeOf({}),ey=class{constructor(e){this.value=e,this.value=e,this.tag.value=e}proxy=new Proxy(this,eb);tag=eh();tags={};children={};collectionTag=null;id=eg++},eb={get:(e,t)=>(function(){let{value:n}=e,r=Reflect.get(n,t);if("symbol"==typeof t||t in em)return r;if("object"==typeof r&&null!==r){let n=e.children[t];return void 0===n&&(n=e.children[t]=e_(r)),n.tag&&eo(n.tag),n.proxy}{let n=e.tags[t];return void 0===n&&((n=e.tags[t]=eh()).value=r),eo(n),r}})(),ownKeys:e=>(ep(e),Reflect.ownKeys(e.value)),getOwnPropertyDescriptor:(e,t)=>Reflect.getOwnPropertyDescriptor(e.value,t),has:(e,t)=>Reflect.has(e.value,t)},ev=class{constructor(e){this.value=e,this.value=e,this.tag.value=e}proxy=new Proxy([this],ew);tag=eh();tags={};children={};collectionTag=null;id=eg++},ew={get:([e],t)=>("length"===t&&ep(e),eb.get(e,t)),ownKeys:([e])=>eb.ownKeys(e),getOwnPropertyDescriptor:([e],t)=>eb.getOwnPropertyDescriptor(e,t),has:([e],t)=>eb.has(e,t)};function e_(e){return Array.isArray(e)?new ev(e):new ey(e)}var ex=class{constructor(e){this.value=e}deref(){return this.value}},eT="undefined"!=typeof WeakRef?WeakRef:ex,eI=0,ek=1;function eS(){return{s:eI,v:void 0,o:null,p:null}}function eE(e,t={}){let n,r=eS(),{resultEqualityCheck:i}=t,s=0;function a(){let t,a=r,{length:o}=arguments;for(let e=0,t=o;e<t;e++){let t=arguments[e];if("function"==typeof t||"object"==typeof t&&null!==t){let e=a.o;null===e&&(a.o=e=new WeakMap);let n=e.get(t);void 0===n?(a=eS(),e.set(t,a)):a=n}else{let e=a.p;null===e&&(a.p=e=new Map);let n=e.get(t);void 0===n?(a=eS(),e.set(t,a)):a=n}}let l=a;if(a.s===ek)t=a.v;else if(t=e.apply(null,arguments),s++,i){let e=n?.deref?.()??n;null!=e&&i(e,t)&&(t=e,0!==s&&s--),n="object"==typeof t&&null!==t||"function"==typeof t?new eT(t):t}return l.s=ek,l.v=t,t}return a.clearCache=()=>{r=eS(),a.resetResultsCount()},a.resultsCount=()=>s,a.resetResultsCount=()=>{s=0},a}function eC(e,...t){let n="function"==typeof e?{memoize:e,memoizeOptions:t}:e,r=(...e)=>{let t,r=0,i=0,s={},a=e.pop();"object"==typeof a&&(s=a,a=e.pop()),Q(a,`createSelector expects an output function after the inputs, but received: [${typeof a}]`);let{memoize:o,memoizeOptions:l=[],argsMemoize:u=eE,argsMemoizeOptions:c=[],devModeChecks:h={}}={...n,...s},d=ee(l),p=ee(c),f=et(e),g=o(function(){return r++,a.apply(null,arguments)},...d);return Object.assign(u(function(){i++;let e=en(f,arguments);return t=g.apply(null,e)},...p),{resultFunc:a,memoizedResultFunc:g,dependencies:f,dependencyRecomputations:()=>i,resetDependencyRecomputations:()=>{i=0},lastResult:()=>t,recomputations:()=>r,resetRecomputations:()=>{r=0},memoize:o,argsMemoize:u})};return Object.assign(r,{withTypes:()=>r}),r}var eA=eC(eE),eN=Object.assign((e,t=eA)=>{J(e,`createStructuredSelector expects first argument to be an object where each property is a selector, instead received a ${typeof e}`);let n=Object.keys(e);return t(n.map(t=>e[t]),(...e)=>e.reduce((e,t,r)=>(e[n[r]]=t,e),{}))},{withTypes:()=>eN});function eO(e){return`Minified Redux error #${e}; visit https://redux.js.org/Errors?code=${e} for the full message or use the non-minified dev environment for full errors. `}var e$="function"==typeof Symbol&&Symbol.observable||"@@observable",eR=()=>Math.random().toString(36).substring(7).split("").join("."),eD={INIT:`@@redux/INIT${eR()}`,REPLACE:`@@redux/REPLACE${eR()}`,PROBE_UNKNOWN_ACTION:()=>`@@redux/PROBE_UNKNOWN_ACTION${eR()}`};function eF(e){if("object"!=typeof e||null===e)return!1;let t=e;for(;null!==Object.getPrototypeOf(t);)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t||null===Object.getPrototypeOf(e)}function eP(e,t,n){if("function"!=typeof e)throw Error(eO(2));if("function"==typeof t&&"function"==typeof n||"function"==typeof n&&"function"==typeof arguments[3])throw Error(eO(0));if("function"==typeof t&&void 0===n&&(n=t,t=void 0),void 0!==n){if("function"!=typeof n)throw Error(eO(1));return n(eP)(e,t)}let r=e,i=t,s=new Map,a=s,o=0,l=!1;function u(){a===s&&(a=new Map,s.forEach((e,t)=>{a.set(t,e)}))}function c(){if(l)throw Error(eO(3));return i}function h(e){if("function"!=typeof e)throw Error(eO(4));if(l)throw Error(eO(5));let t=!0;u();let n=o++;return a.set(n,e),function(){if(t){if(l)throw Error(eO(6));t=!1,u(),a.delete(n),s=null}}}function d(e){if(!eF(e))throw Error(eO(7));if(void 0===e.type)throw Error(eO(8));if("string"!=typeof e.type)throw Error(eO(17));if(l)throw Error(eO(9));try{l=!0,i=r(i,e)}finally{l=!1}return(s=a).forEach(e=>{e()}),e}function p(e){if("function"!=typeof e)throw Error(eO(10));r=e,d({type:eD.REPLACE})}function f(){let e=h;return{subscribe(t){if("object"!=typeof t||null===t)throw Error(eO(11));function n(){let e=t;e.next&&e.next(c())}return n(),{unsubscribe:e(n)}},[e$](){return this}}}return d({type:eD.INIT}),{dispatch:d,subscribe:h,getState:c,replaceReducer:p,[e$]:f}}function eM(e){Object.keys(e).forEach(t=>{let n=e[t];if(void 0===n(void 0,{type:eD.INIT}))throw Error(eO(12));if(void 0===n(void 0,{type:eD.PROBE_UNKNOWN_ACTION()}))throw Error(eO(13))})}function eL(e){let t;let n=Object.keys(e),r={};for(let t=0;t<n.length;t++){let i=n[t];"function"==typeof e[i]&&(r[i]=e[i])}let i=Object.keys(r);try{eM(r)}catch(e){t=e}return function(e={},n){if(t)throw t;let s=!1,a={};for(let t=0;t<i.length;t++){let o=i[t],l=r[o],u=e[o],c=l(u,n);if(void 0===c)throw n&&n.type,Error(eO(14));a[o]=c,s=s||c!==u}return(s=s||i.length!==Object.keys(e).length)?a:e}}function ez(...e){return 0===e.length?e=>e:1===e.length?e[0]:e.reduce((e,t)=>(...n)=>e(t(...n)))}function eB(...e){return t=>(n,r)=>{let i=t(n,r),s=()=>{throw Error(eO(15))},a={getState:i.getState,dispatch:(e,...t)=>s(e,...t)};return s=ez(...e.map(e=>e(a)))(i.dispatch),{...i,dispatch:s}}}function eU(e){return eF(e)&&"type"in e&&"string"==typeof e.type}function eV(e){return({dispatch:t,getState:n})=>r=>i=>"function"==typeof i?i(t,n,e):r(i)}var ej=eV(),eG=eV;n(7836),((...e)=>{let t=eC(...e),n=Object.assign((...e)=>{let n=t(...e),r=(e,...t)=>n(u(e)?H(e):e,...t);return Object.assign(r,n),r},{withTypes:()=>n})})(eE);var eW="undefined"!=typeof window&&window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__?window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__:function(){if(0!=arguments.length)return"object"==typeof arguments[0]?ez:ez.apply(null,arguments)};"undefined"!=typeof window&&window.__REDUX_DEVTOOLS_EXTENSION__&&window.__REDUX_DEVTOOLS_EXTENSION__;var eq=e=>e&&"function"==typeof e.match;function eH(e,t){function n(...r){if(t){let n=t(...r);if(!n)throw Error(tK(0));return{type:e,payload:n.payload,..."meta"in n&&{meta:n.meta},..."error"in n&&{error:n.error}}}return{type:e,payload:r[0]}}return n.toString=()=>`${e}`,n.type=e,n.match=t=>eU(t)&&t.type===e,n}function eK(e){return isAction(e)&&Object.keys(e).every(eX)}function eX(e){return["type","payload","error","meta"].indexOf(e)>-1}var eY=class e extends Array{constructor(...t){super(...t),Object.setPrototypeOf(this,e.prototype)}static get[Symbol.species](){return e}concat(...e){return super.concat.apply(this,e)}prepend(...t){return 1===t.length&&Array.isArray(t[0])?new e(...t[0].concat(this)):new e(...t.concat(this))}};function eQ(e){return c(e)?Y(e,()=>{}):e}function eJ(e,t,n){if(e.has(t)){let r=e.get(t);return n.update&&(r=n.update(r,t,e),e.set(t,r)),r}if(!n.insert)throw Error(tK(10));let r=n.insert(t,e);return e.set(t,r),r}function eZ(e){return"boolean"==typeof e}var e0=()=>function(e){let{thunk:t=!0,immutableCheck:n=!0,serializableCheck:r=!0,actionCreatorCheck:i=!0}=e??{},s=new eY;return t&&(eZ(t)?s.push(ej):s.push(eG(t.extraArgument))),s},e1="RTK_autoBatch",e2=e=>t=>{setTimeout(t,e)},e3="undefined"!=typeof window&&window.requestAnimationFrame?window.requestAnimationFrame:e2(10),e4=(e={type:"raf"})=>t=>(...n)=>{let r=t(...n),i=!0,s=!1,a=!1,o=new Set,l="tick"===e.type?queueMicrotask:"raf"===e.type?e3:"callback"===e.type?e.queueNotification:e2(e.timeout),u=()=>{a=!1,s&&(s=!1,o.forEach(e=>e()))};return Object.assign({},r,{subscribe(e){let t=()=>i&&e(),n=r.subscribe(t);return o.add(e),()=>{n(),o.delete(e)}},dispatch(e){try{return(s=!(i=!e?.meta?.[e1]))&&!a&&(a=!0,l(u)),r.dispatch(e)}finally{i=!0}}})},e6=e=>function(t){let{autoBatch:n=!0}=t??{},r=new eY(e);return n&&r.push(e4("object"==typeof n?n:void 0)),r},e5=!0;function e8(e){let t,n;let r=e0(),{reducer:i,middleware:s,devTools:a=!0,preloadedState:o,enhancers:l}=e||{};if("function"==typeof i)t=i;else if(eF(i))t=eL(i);else throw Error(tK(1));if(!e5&&s&&"function"!=typeof s)throw Error(tK(2));if("function"==typeof s){if(n=s(r),!e5&&!Array.isArray(n))throw Error(tK(3))}else n=r();if(!e5&&n.some(e=>"function"!=typeof e))throw Error(tK(4));let u=ez;a&&(u=eW({trace:!e5,..."object"==typeof a&&a}));let c=eB(...n),h=e6(c);if(!e5&&l&&"function"!=typeof l)throw Error(tK(5));let d="function"==typeof l?l(h):h();if(!e5&&!Array.isArray(d))throw Error(tK(6));if(!e5&&d.some(e=>"function"!=typeof e))throw Error(tK(7));return e5||!n.length||d.includes(c)||console.error("middlewares were provided, but middleware enhancer was not included in final enhancers - make sure to call `getDefaultEnhancers`"),eP(t,o,u(...d))}function e7(e){let t;let n={},r=[],i={addCase(e,t){let r="string"==typeof e?e:e.type;if(!r)throw Error(tK(28));if(r in n)throw Error(tK(29));return n[r]=t,i},addMatcher:(e,t)=>(r.push({matcher:e,reducer:t}),i),addDefaultCase:e=>(t=e,i)};return e(i),[n,r,t]}function e9(e){return"function"==typeof e}function te(e,t){let n;let[r,i,s]=e7(t);if(e9(e))n=()=>eQ(e());else{let t=eQ(e);n=()=>t}function a(e=n(),t){let o=[r[t.type],...i.filter(({matcher:e})=>e(t)).map(({reducer:e})=>e)];return 0===o.filter(e=>!!e).length&&(o=[s]),o.reduce((e,n)=>{if(n){if(u(e)){let r=n(e,t);return void 0===r?e:r}if(c(e))return Y(e,e=>n(e,t));{let r=n(e,t);if(void 0===r){if(null===e)return e;throw Error(tK(9))}return r}}return e},e)}return a.getInitialState=n,a}var tt="ModuleSymbhasOwnPr-0123456789ABCDEFGHNRVfgctiUvz_KqYTJkLxpZXIjQW",tn=(e=21)=>{let t="",n=e;for(;n--;)t+=tt[64*Math.random()|0];return t},tr=(e,t)=>eq(e)?e.match(t):e(t);function ti(...e){return t=>e.some(e=>tr(e,t))}var ts=["name","message","stack","code"],ta=class{constructor(e,t){this.payload=e,this.meta=t}_type},to=class{constructor(e,t){this.payload=e,this.meta=t}_type},tl=e=>{if("object"==typeof e&&null!==e){let t={};for(let n of ts)"string"==typeof e[n]&&(t[n]=e[n]);return t}return{message:String(e)}},tu=(()=>{function e(e,t,n){let r=eH(e+"/fulfilled",(e,t,n,r)=>({payload:e,meta:{...r||{},arg:n,requestId:t,requestStatus:"fulfilled"}})),i=eH(e+"/pending",(e,t,n)=>({payload:void 0,meta:{...n||{},arg:t,requestId:e,requestStatus:"pending"}})),s=eH(e+"/rejected",(e,t,r,i,s)=>({payload:i,error:(n&&n.serializeError||tl)(e||"Rejected"),meta:{...s||{},arg:r,requestId:t,rejectedWithValue:!!i,requestStatus:"rejected",aborted:e?.name==="AbortError",condition:e?.name==="ConditionError"}}));return Object.assign(function(e){return(a,o,l)=>{let u,c;let h=n?.idGenerator?n.idGenerator(e):tn(),d=new AbortController;function p(e){c=e,d.abort()}let f=async function(){let f;try{let s=n?.condition?.(e,{getState:o,extra:l});if(th(s)&&(s=await s),!1===s||d.signal.aborted)throw{name:"ConditionError",message:"Aborted due to condition callback returning false."};let g=new Promise((e,t)=>{u=()=>{t({name:"AbortError",message:c||"Aborted"})},d.signal.addEventListener("abort",u)});a(i(h,e,n?.getPendingMeta?.({requestId:h,arg:e},{getState:o,extra:l}))),f=await Promise.race([g,Promise.resolve(t(e,{dispatch:a,getState:o,extra:l,requestId:h,signal:d.signal,abort:p,rejectWithValue:(e,t)=>new ta(e,t),fulfillWithValue:(e,t)=>new to(e,t)})).then(t=>{if(t instanceof ta)throw t;return t instanceof to?r(t.payload,h,e,t.meta):r(t,h,e)})])}catch(t){f=t instanceof ta?s(null,h,e,t.payload,t.meta):s(t,h,e)}finally{u&&d.signal.removeEventListener("abort",u)}return n&&!n.dispatchConditionRejection&&s.match(f)&&f.meta.condition||a(f),f}();return Object.assign(f,{abort:p,requestId:h,arg:e,unwrap:()=>f.then(tc)})}},{pending:i,rejected:s,fulfilled:r,settled:ti(s,r),typePrefix:e})}return e.withTypes=()=>e,e})();function tc(e){if(e.meta&&e.meta.rejectedWithValue)throw e.payload;if(e.error)throw e.error;return e.payload}function th(e){return null!==e&&"object"==typeof e&&"function"==typeof e.then}var td=Symbol.for("rtk-slice-createasyncthunk"),tp=(e=>(e.reducer="reducer",e.reducerWithPrepare="reducerWithPrepare",e.asyncThunk="asyncThunk",e))(tp||{});function tf(e,t){return`${e}/${t}`}function tg(e,t,n,r){function i(s,...a){let o=t(s);return void 0===o&&r&&(o=n()),e(o,...a)}return i.unwrapped=e,i}var tm=function({creators:e}={}){let t=e?.asyncThunk?.[td];return function(e){let n;let{name:r,reducerPath:i=r}=e;if(!r)throw Error(tK(11));let s=("function"==typeof e.reducers?e.reducers(ty()):e.reducers)||{},a=Object.keys(s),o={},l={},u={},c=[],h={addCase(e,t){let n="string"==typeof e?e:e.type;if(!n)throw Error(tK(12));if(n in l)throw Error(tK(13));return l[n]=t,h},addMatcher:(e,t)=>(c.push({matcher:e,reducer:t}),h),exposeAction:(e,t)=>(u[e]=t,h),exposeCaseReducer:(e,t)=>(o[e]=t,h)};function d(){let[t={},n=[],r]="function"==typeof e.extraReducers?e7(e.extraReducers):[e.extraReducers],i={...t,...l};return te(e.initialState,e=>{for(let t in i)e.addCase(t,i[t]);for(let t of c)e.addMatcher(t.matcher,t.reducer);for(let t of n)e.addMatcher(t.matcher,t.reducer);r&&e.addDefaultCase(r)})}a.forEach(n=>{let i=s[n],a={reducerName:n,type:tf(r,n),createNotation:"function"==typeof e.reducers};tv(i)?t_(a,i,h,t):tb(a,i,h)});let p=e=>e,f=new Map;function g(e,t){return n||(n=d()),n(e,t)}function m(){return n||(n=d()),n.getInitialState()}function y(t,n=!1){function r(e){let r=e[t];return void 0===r&&n&&(r=m()),r}function i(t=p){let r=eJ(f,n,{insert:()=>new WeakMap});return eJ(r,t,{insert:()=>{let r={};for(let[i,s]of Object.entries(e.selectors??{}))r[i]=tg(s,t,m,n);return r}})}return{reducerPath:t,getSelectors:i,get selectors(){return i(r)},selectSlice:r}}let b={name:r,reducer:g,actions:u,caseReducers:o,getInitialState:m,...y(i),injectInto(e,{reducerPath:t,...n}={}){let r=t??i;return e.inject({reducerPath:r,reducer:g},n),{...b,...y(r,!0)}}};return b}}();function ty(){function e(e,t){return{_reducerDefinitionType:"asyncThunk",payloadCreator:e,...t}}return e.withTypes=()=>e,{reducer:e=>Object.assign({[e.name]:(...t)=>e(...t)}[e.name],{_reducerDefinitionType:"reducer"}),preparedReducer:(e,t)=>({_reducerDefinitionType:"reducerWithPrepare",prepare:e,reducer:t}),asyncThunk:e}}function tb({type:e,reducerName:t,createNotation:n},r,i){let s,a;if("reducer"in r){if(n&&!tw(r))throw Error(tK(17));s=r.reducer,a=r.prepare}else s=r;i.addCase(e,s).exposeCaseReducer(t,s).exposeAction(t,a?eH(e,a):eH(e))}function tv(e){return"asyncThunk"===e._reducerDefinitionType}function tw(e){return"reducerWithPrepare"===e._reducerDefinitionType}function t_({type:e,reducerName:t},n,r,i){if(!i)throw Error(tK(18));let{payloadCreator:s,fulfilled:a,pending:o,rejected:l,settled:u,options:c}=n,h=i(e,s,c);r.exposeAction(t,h),a&&r.addCase(h.fulfilled,a),o&&r.addCase(h.pending,o),l&&r.addCase(h.rejected,l),u&&r.addMatcher(h.settled,u),r.exposeCaseReducer(t,{fulfilled:a||tx,pending:o||tx,rejected:l||tx,settled:u||tx})}function tx(){}var tT=null;function tI(e){let t=tk((t,n)=>e(n));return function(e){return t(e,void 0)}}function tk(e){return function(t,n){function r(e){return eK(e)}let i=t=>{r(n)?e(n.payload,t):e(n,t)};return tT(t)?(i(t),t):createNextState3(t,i)}}function tS(e,t){return t(e)}function tE(e){return Array.isArray(e)||(e=Object.values(e)),e}function tC(e,t,n){e=tE(e);let r=[],i=[];for(let s of e){let e=tS(s,t);e in n.entities?i.push({id:e,changes:s}):r.push(s)}return[r,i]}var tA="task",tN="cancelled",tO=null,t$=class{constructor(e){this.code=e,this.message=`${tA} ${tN} (reason: ${e})`}name="TaskAbortError";message},tR=(e,t)=>{if("function"!=typeof e)throw Error(tK(32))},tD=()=>{},tF=(e,t=tD)=>(e.catch(t),e),tP=(e,t)=>(e.addEventListener("abort",t,{once:!0}),()=>e.removeEventListener("abort",t)),tM=(e,t)=>{let n=e.signal;n.aborted||("reason"in n||Object.defineProperty(n,"reason",{enumerable:!0,value:t,configurable:!0,writable:!0}),e.abort(t))},tL=e=>{if(e.aborted){let{reason:t}=e;throw new t$(t)}};function tz(e,t){let n=tD;return new Promise((r,i)=>{let s=()=>i(new t$(e.reason));if(e.aborted){s();return}n=tP(e,s),t.finally(()=>n()).then(r,i)}).finally(()=>{n=tD})}var tB=e=>t=>tF(tz(e,t).then(t=>(tL(e),t))),{assign:tU}=Object,tV="listenerMiddleware",tj=e=>{let{type:t,actionCreator:n,matcher:r,predicate:i,effect:s}=e;if(t)i=eH(t).match;else if(n)t=n.type,i=n.match;else if(r)i=r;else if(i);else throw Error(tK(21));return tR(s,"options.listener"),{predicate:i,type:t,effect:s}},tG=Object.assign(e=>{let{type:t,predicate:n,effect:r}=tj(e);return{id:tn(),effect:r,type:t,predicate:n,pending:new Set,unsubscribe:()=>{throw Error(tK(22))}}},{withTypes:()=>tG}),tW=Object.assign(eH(`${tV}/add`),{withTypes:()=>tW}),tq=(eH(`${tV}/removeAll`),Object.assign(eH(`${tV}/remove`),{withTypes:()=>tq})),tH=Symbol.for("rtk-state-proxy-original");function tK(e){return`Minified Redux Toolkit error #${e}; visit https://redux-toolkit.js.org/Errors?code=${e} for the full message or use the non-minified dev environment for full errors. `}},7031:(e,t,n)=>{"use strict";n.d(t,{xI:()=>rE,hg:()=>tF,x9:()=>tN,CI:()=>tP});var r=n(9928),i=n(6743),s=n(3424);function a(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&0>t.indexOf(r)&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var i=0,r=Object.getOwnPropertySymbols(e);i<r.length;i++)0>t.indexOf(r[i])&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]]);return n}Object.create,Object.create;var o=("function"==typeof SuppressedError&&SuppressedError,n(5125));function l(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}let u=l,c=new i.FA("auth","Firebase",l()),h=new s.Vy("@firebase/auth");function d(e,...t){h.logLevel<=s.$b.WARN&&h.warn(`Auth (${r.MF}): ${e}`,...t)}function p(e,...t){h.logLevel<=s.$b.ERROR&&h.error(`Auth (${r.MF}): ${e}`,...t)}function f(e,...t){throw b(e,...t)}function g(e,...t){return b(e,...t)}function m(e,t,n){let r=Object.assign(Object.assign({},u()),{[t]:n});return new i.FA("auth","Firebase",r).create(t,{appName:e.name})}function y(e){return m(e,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function b(e,...t){if("string"!=typeof e){let n=t[0],r=[...t.slice(1)];return r[0]&&(r[0].appName=e.name),e._errorFactory.create(n,...r)}return c.create(e,...t)}function v(e,t,...n){if(!e)throw b(t,...n)}function w(e){let t="INTERNAL ASSERTION FAILED: "+e;throw p(t),Error(t)}function _(e,t){e||w(t)}function x(){var e;return"undefined"!=typeof self&&(null===(e=self.location)||void 0===e?void 0:e.href)||""}function T(){return"http:"===I()||"https:"===I()}function I(){var e;return"undefined"!=typeof self&&(null===(e=self.location)||void 0===e?void 0:e.protocol)||null}function k(){return!("undefined"!=typeof navigator&&navigator&&"onLine"in navigator&&"boolean"==typeof navigator.onLine&&(T()||(0,i.sr)()||"connection"in navigator))||navigator.onLine}function S(){if("undefined"==typeof navigator)return null;let e=navigator;return e.languages&&e.languages[0]||e.language||null}class E{constructor(e,t){this.shortDelay=e,this.longDelay=t,_(t>e,"Short delay should be less than long delay!"),this.isMobile=(0,i.jZ)()||(0,i.lV)()}get(){return k()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}function C(e,t){_(e.emulator,"Emulator should always be set here");let{url:n}=e.emulator;return t?`${n}${t.startsWith("/")?t.slice(1):t}`:n}class A{static initialize(e,t,n){this.fetchImpl=e,t&&(this.headersImpl=t),n&&(this.responseImpl=n)}static fetch(){return this.fetchImpl?this.fetchImpl:"undefined"!=typeof self&&"fetch"in self?self.fetch:"undefined"!=typeof globalThis&&globalThis.fetch?globalThis.fetch:"undefined"!=typeof fetch?fetch:void w("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){return this.headersImpl?this.headersImpl:"undefined"!=typeof self&&"Headers"in self?self.Headers:"undefined"!=typeof globalThis&&globalThis.Headers?globalThis.Headers:"undefined"!=typeof Headers?Headers:void w("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){return this.responseImpl?this.responseImpl:"undefined"!=typeof self&&"Response"in self?self.Response:"undefined"!=typeof globalThis&&globalThis.Response?globalThis.Response:"undefined"!=typeof Response?Response:void w("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}let N={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"},O=new E(3e4,6e4);function $(e,t){return e.tenantId&&!t.tenantId?Object.assign(Object.assign({},t),{tenantId:e.tenantId}):t}async function R(e,t,n,r,s={}){return D(e,s,async()=>{let s={},a={};r&&("GET"===t?a=r:s={body:JSON.stringify(r)});let o=(0,i.Am)(Object.assign({key:e.config.apiKey},a)).slice(1),l=await e._getAdditionalHeaders();l["Content-Type"]="application/json",e.languageCode&&(l["X-Firebase-Locale"]=e.languageCode);let u=Object.assign({method:t,headers:l},s);return(0,i.c1)()||(u.referrerPolicy="no-referrer"),A.fetch()(P(e,e.config.apiHost,n,o),u)})}async function D(e,t,n){e._canInitEmulator=!1;let r=Object.assign(Object.assign({},N),t);try{let t=new L(e),i=await Promise.race([n(),t.promise]);t.clearNetworkTimeout();let s=await i.json();if("needConfirmation"in s)throw z(e,"account-exists-with-different-credential",s);if(i.ok&&!("errorMessage"in s))return s;{let[t,n]=(i.ok?s.errorMessage:s.error.message).split(" : ");if("FEDERATED_USER_ID_ALREADY_LINKED"===t)throw z(e,"credential-already-in-use",s);if("EMAIL_EXISTS"===t)throw z(e,"email-already-in-use",s);if("USER_DISABLED"===t)throw z(e,"user-disabled",s);let a=r[t]||t.toLowerCase().replace(/[_\s]+/g,"-");if(n)throw m(e,a,n);f(e,a)}}catch(t){if(t instanceof i.g)throw t;f(e,"network-request-failed",{message:String(t)})}}async function F(e,t,n,r,i={}){let s=await R(e,t,n,r,i);return"mfaPendingCredential"in s&&f(e,"multi-factor-auth-required",{_serverResponse:s}),s}function P(e,t,n,r){let i=`${t}${n}?${r}`;return e.config.emulator?C(e.config,i):`${e.config.apiScheme}://${i}`}function M(e){switch(e){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class L{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((e,t)=>{this.timer=setTimeout(()=>t(g(this.auth,"network-request-failed")),O.get())})}}function z(e,t,n){let r={appName:e.name};n.email&&(r.email=n.email),n.phoneNumber&&(r.phoneNumber=n.phoneNumber);let i=g(e,t,r);return i.customData._tokenResponse=n,i}function B(e){return void 0!==e&&void 0!==e.enterprise}class U{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],void 0===e.recaptchaKey)throw Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||0===this.recaptchaEnforcementState.length)return null;for(let t of this.recaptchaEnforcementState)if(t.provider&&t.provider===e)return M(t.enforcementState);return null}isProviderEnabled(e){return"ENFORCE"===this.getProviderEnforcementState(e)||"AUDIT"===this.getProviderEnforcementState(e)}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}async function V(e,t){return R(e,"GET","/v2/recaptchaConfig",$(e,t))}async function j(e,t){return R(e,"POST","/v1/accounts:delete",t)}async function G(e,t){return R(e,"POST","/v1/accounts:lookup",t)}function W(e){if(e)try{let t=new Date(Number(e));if(!isNaN(t.getTime()))return t.toUTCString()}catch(e){}}async function q(e,t=!1){let n=(0,i.Ku)(e),r=await n.getIdToken(t),s=K(r);v(s&&s.exp&&s.auth_time&&s.iat,n.auth,"internal-error");let a="object"==typeof s.firebase?s.firebase:void 0,o=null==a?void 0:a.sign_in_provider;return{claims:s,token:r,authTime:W(H(s.auth_time)),issuedAtTime:W(H(s.iat)),expirationTime:W(H(s.exp)),signInProvider:o||null,signInSecondFactor:(null==a?void 0:a.sign_in_second_factor)||null}}function H(e){return 1e3*Number(e)}function K(e){let[t,n,r]=e.split(".");if(void 0===t||void 0===n||void 0===r)return p("JWT malformed, contained fewer than 3 sections"),null;try{let e=(0,i.u)(n);if(!e)return p("Failed to decode base64 JWT payload"),null;return JSON.parse(e)}catch(e){return p("Caught error parsing JWT payload as JSON",null==e?void 0:e.toString()),null}}function X(e){let t=K(e);return v(t,"internal-error"),v(void 0!==t.exp,"internal-error"),v(void 0!==t.iat,"internal-error"),Number(t.exp)-Number(t.iat)}async function Y(e,t,n=!1){if(n)return t;try{return await t}catch(t){throw t instanceof i.g&&Q(t)&&e.auth.currentUser===e&&await e.auth.signOut(),t}}function Q({code:e}){return"auth/user-disabled"===e||"auth/user-token-expired"===e}class J{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,null!==this.timerId&&clearTimeout(this.timerId))}getInterval(e){var t;if(!e)return this.errorBackoff=3e4,Math.max(0,(null!==(t=this.user.stsTokenManager.expirationTime)&&void 0!==t?t:0)-Date.now()-3e5);{let e=this.errorBackoff;return this.errorBackoff=Math.min(2*this.errorBackoff,96e4),e}}schedule(e=!1){if(!this.isRunning)return;let t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){(null==e?void 0:e.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}class Z{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=W(this.lastLoginAt),this.creationTime=W(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function ee(e){var t;let n=e.auth,r=await e.getIdToken(),i=await Y(e,G(n,{idToken:r}));v(null==i?void 0:i.users.length,n,"internal-error");let s=i.users[0];e._notifyReloadListener(s);let a=(null===(t=s.providerUserInfo)||void 0===t?void 0:t.length)?er(s.providerUserInfo):[],o=en(e.providerData,a),l=e.isAnonymous,u=!(e.email&&s.passwordHash)&&!(null==o?void 0:o.length),c=!!l&&u;Object.assign(e,{uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:o,metadata:new Z(s.createdAt,s.lastLoginAt),isAnonymous:c})}async function et(e){let t=(0,i.Ku)(e);await ee(t),await t.auth._persistUserIfCurrent(t),t.auth._notifyListenersIfCurrent(t)}function en(e,t){return[...e.filter(e=>!t.some(t=>t.providerId===e.providerId)),...t]}function er(e){return e.map(e=>{var{providerId:t}=e,n=a(e,["providerId"]);return{providerId:t,uid:n.rawId||"",displayName:n.displayName||null,email:n.email||null,phoneNumber:n.phoneNumber||null,photoURL:n.photoUrl||null}})}async function ei(e,t){let n=await D(e,{},async()=>{let n=(0,i.Am)({grant_type:"refresh_token",refresh_token:t}).slice(1),{tokenApiHost:r,apiKey:s}=e.config,a=P(e,r,"/v1/token",`key=${s}`),o=await e._getAdditionalHeaders();return o["Content-Type"]="application/x-www-form-urlencoded",A.fetch()(a,{method:"POST",headers:o,body:n})});return{accessToken:n.access_token,expiresIn:n.expires_in,refreshToken:n.refresh_token}}async function es(e,t){return R(e,"POST","/v2/accounts:revokeToken",$(e,t))}class ea{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){v(e.idToken,"internal-error"),v(void 0!==e.idToken,"internal-error"),v(void 0!==e.refreshToken,"internal-error");let t="expiresIn"in e&&void 0!==e.expiresIn?Number(e.expiresIn):X(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){v(0!==e.length,"internal-error");let t=X(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e,t=!1){return t||!this.accessToken||this.isExpired?(v(this.refreshToken,e,"user-token-expired"),this.refreshToken)?(await this.refresh(e,this.refreshToken),this.accessToken):null:this.accessToken}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){let{accessToken:n,refreshToken:r,expiresIn:i}=await ei(e,t);this.updateTokensAndExpiration(n,r,Number(i))}updateTokensAndExpiration(e,t,n){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+1e3*n}static fromJSON(e,t){let{refreshToken:n,accessToken:r,expirationTime:i}=t,s=new ea;return n&&(v("string"==typeof n,"internal-error",{appName:e}),s.refreshToken=n),r&&(v("string"==typeof r,"internal-error",{appName:e}),s.accessToken=r),i&&(v("number"==typeof i,"internal-error",{appName:e}),s.expirationTime=i),s}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new ea,this.toJSON())}_performRefresh(){return w("not implemented")}}function eo(e,t){v("string"==typeof e||void 0===e,"internal-error",{appName:t})}class el{constructor(e){var{uid:t,auth:n,stsTokenManager:r}=e,i=a(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new J(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=n,this.stsTokenManager=r,this.accessToken=r.accessToken,this.displayName=i.displayName||null,this.email=i.email||null,this.emailVerified=i.emailVerified||!1,this.phoneNumber=i.phoneNumber||null,this.photoURL=i.photoURL||null,this.isAnonymous=i.isAnonymous||!1,this.tenantId=i.tenantId||null,this.providerData=i.providerData?[...i.providerData]:[],this.metadata=new Z(i.createdAt||void 0,i.lastLoginAt||void 0)}async getIdToken(e){let t=await Y(this,this.stsTokenManager.getToken(this.auth,e));return v(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return q(this,e)}reload(){return et(this)}_assign(e){this!==e&&(v(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(e=>Object.assign({},e)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){let t=new el(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return t.metadata._copy(this.metadata),t}_onReload(e){v(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let n=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),n=!0),t&&await ee(this),await this.auth._persistUserIfCurrent(this),n&&this.auth._notifyListenersIfCurrent(this)}async delete(){if((0,r.xZ)(this.auth.app))return Promise.reject(y(this.auth));let e=await this.getIdToken();return await Y(this,j(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var n,r,i,s,a,o,l,u;let c=null!==(n=t.displayName)&&void 0!==n?n:void 0,h=null!==(r=t.email)&&void 0!==r?r:void 0,d=null!==(i=t.phoneNumber)&&void 0!==i?i:void 0,p=null!==(s=t.photoURL)&&void 0!==s?s:void 0,f=null!==(a=t.tenantId)&&void 0!==a?a:void 0,g=null!==(o=t._redirectEventId)&&void 0!==o?o:void 0,m=null!==(l=t.createdAt)&&void 0!==l?l:void 0,y=null!==(u=t.lastLoginAt)&&void 0!==u?u:void 0,{uid:b,emailVerified:w,isAnonymous:_,providerData:x,stsTokenManager:T}=t;v(b&&T,e,"internal-error");let I=ea.fromJSON(this.name,T);v("string"==typeof b,e,"internal-error"),eo(c,e.name),eo(h,e.name),v("boolean"==typeof w,e,"internal-error"),v("boolean"==typeof _,e,"internal-error"),eo(d,e.name),eo(p,e.name),eo(f,e.name),eo(g,e.name),eo(m,e.name),eo(y,e.name);let k=new el({uid:b,auth:e,email:h,emailVerified:w,displayName:c,isAnonymous:_,photoURL:p,phoneNumber:d,tenantId:f,stsTokenManager:I,createdAt:m,lastLoginAt:y});return x&&Array.isArray(x)&&(k.providerData=x.map(e=>Object.assign({},e))),g&&(k._redirectEventId=g),k}static async _fromIdTokenResponse(e,t,n=!1){let r=new ea;r.updateFromServerResponse(t);let i=new el({uid:t.localId,auth:e,stsTokenManager:r,isAnonymous:n});return await ee(i),i}static async _fromGetAccountInfoResponse(e,t,n){let r=t.users[0];v(void 0!==r.localId,"internal-error");let i=void 0!==r.providerUserInfo?er(r.providerUserInfo):[],s=!(r.email&&r.passwordHash)&&!(null==i?void 0:i.length),a=new ea;a.updateFromIdToken(n);let o=new el({uid:r.localId,auth:e,stsTokenManager:a,isAnonymous:s});return Object.assign(o,{uid:r.localId,displayName:r.displayName||null,photoURL:r.photoUrl||null,email:r.email||null,emailVerified:r.emailVerified||!1,phoneNumber:r.phoneNumber||null,tenantId:r.tenantId||null,providerData:i,metadata:new Z(r.createdAt,r.lastLoginAt),isAnonymous:!(r.email&&r.passwordHash)&&!(null==i?void 0:i.length)}),o}}let eu=new Map;function ec(e){_(e instanceof Function,"Expected a class definition");let t=eu.get(e);return t?_(t instanceof e,"Instance stored in cache mismatched with class"):(t=new e,eu.set(e,t)),t}class eh{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){let t=this.storage[e];return void 0===t?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}eh.type="NONE";let ed=eh;function ep(e,t,n){return`firebase:${e}:${t}:${n}`}class ef{constructor(e,t,n){this.persistence=e,this.auth=t,this.userKey=n;let{config:r,name:i}=this.auth;this.fullUserKey=ep(this.userKey,r.apiKey,i),this.fullPersistenceKey=ep("persistence",r.apiKey,i),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){let e=await this.persistence._get(this.fullUserKey);return e?el._fromJSON(this.auth,e):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;let t=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,n="authUser"){if(!t.length)return new ef(ec(ed),e,n);let r=(await Promise.all(t.map(async e=>{if(await e._isAvailable())return e}))).filter(e=>e),i=r[0]||ec(ed),s=ep(n,e.config.apiKey,e.name),a=null;for(let n of t)try{let t=await n._get(s);if(t){let r=el._fromJSON(e,t);n!==i&&(a=r),i=n;break}}catch(e){}let o=r.filter(e=>e._shouldAllowMigration);return i._shouldAllowMigration&&o.length&&(i=o[0],a&&await i._set(s,a.toJSON()),await Promise.all(t.map(async e=>{if(e!==i)try{await e._remove(s)}catch(e){}}))),new ef(i,e,n)}}function eg(e){let t=e.toLowerCase();if(t.includes("opera/")||t.includes("opr/")||t.includes("opios/"))return"Opera";if(ev(t))return"IEMobile";if(t.includes("msie")||t.includes("trident/"))return"IE";{if(t.includes("edge/"))return"Edge";if(em(t))return"Firefox";if(t.includes("silk/"))return"Silk";if(e_(t))return"Blackberry";if(ex(t))return"Webos";if(ey(t))return"Safari";if((t.includes("chrome/")||eb(t))&&!t.includes("edge/"))return"Chrome";if(ew(t))return"Android";let n=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,r=e.match(n);if((null==r?void 0:r.length)===2)return r[1]}return"Other"}function em(e=(0,i.ZQ)()){return/firefox\//i.test(e)}function ey(e=(0,i.ZQ)()){let t=e.toLowerCase();return t.includes("safari/")&&!t.includes("chrome/")&&!t.includes("crios/")&&!t.includes("android")}function eb(e=(0,i.ZQ)()){return/crios\//i.test(e)}function ev(e=(0,i.ZQ)()){return/iemobile/i.test(e)}function ew(e=(0,i.ZQ)()){return/android/i.test(e)}function e_(e=(0,i.ZQ)()){return/blackberry/i.test(e)}function ex(e=(0,i.ZQ)()){return/webos/i.test(e)}function eT(e=(0,i.ZQ)()){return/iphone|ipad|ipod/i.test(e)||/macintosh/i.test(e)&&/mobile/i.test(e)}function eI(e=(0,i.ZQ)()){var t;return eT(e)&&!!(null===(t=window.navigator)||void 0===t?void 0:t.standalone)}function ek(){return(0,i.lT)()&&10===document.documentMode}function eS(e=(0,i.ZQ)()){return eT(e)||ew(e)||ex(e)||e_(e)||/windows phone/i.test(e)||ev(e)}function eE(e,t=[]){let n;switch(e){case"Browser":n=eg((0,i.ZQ)());break;case"Worker":n=`${eg((0,i.ZQ)())}-${e}`;break;default:n=e}let s=t.length?t.join(","):"FirebaseCore-web";return`${n}/JsCore/${r.MF}/${s}`}class eC{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){let n=t=>new Promise((n,r)=>{try{let r=e(t);n(r)}catch(e){r(e)}});n.onAbort=t,this.queue.push(n);let r=this.queue.length-1;return()=>{this.queue[r]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;let t=[];try{for(let n of this.queue)await n(e),n.onAbort&&t.push(n.onAbort)}catch(e){for(let e of(t.reverse(),t))try{e()}catch(e){}throw this.auth._errorFactory.create("login-blocked",{originalMessage:null==e?void 0:e.message})}}}async function eA(e,t={}){return R(e,"GET","/v2/passwordPolicy",$(e,t))}let eN=6;class eO{constructor(e){var t,n,r,i;let s=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=null!==(t=s.minPasswordLength)&&void 0!==t?t:eN,s.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=s.maxPasswordLength),void 0!==s.containsLowercaseCharacter&&(this.customStrengthOptions.containsLowercaseLetter=s.containsLowercaseCharacter),void 0!==s.containsUppercaseCharacter&&(this.customStrengthOptions.containsUppercaseLetter=s.containsUppercaseCharacter),void 0!==s.containsNumericCharacter&&(this.customStrengthOptions.containsNumericCharacter=s.containsNumericCharacter),void 0!==s.containsNonAlphanumericCharacter&&(this.customStrengthOptions.containsNonAlphanumericCharacter=s.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,"ENFORCEMENT_STATE_UNSPECIFIED"===this.enforcementState&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=null!==(r=null===(n=e.allowedNonAlphanumericCharacters)||void 0===n?void 0:n.join(""))&&void 0!==r?r:"",this.forceUpgradeOnSignin=null!==(i=e.forceUpgradeOnSignin)&&void 0!==i&&i,this.schemaVersion=e.schemaVersion}validatePassword(e){var t,n,r,i,s,a;let o={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,o),this.validatePasswordCharacterOptions(e,o),o.isValid&&(o.isValid=null===(t=o.meetsMinPasswordLength)||void 0===t||t),o.isValid&&(o.isValid=null===(n=o.meetsMaxPasswordLength)||void 0===n||n),o.isValid&&(o.isValid=null===(r=o.containsLowercaseLetter)||void 0===r||r),o.isValid&&(o.isValid=null===(i=o.containsUppercaseLetter)||void 0===i||i),o.isValid&&(o.isValid=null===(s=o.containsNumericCharacter)||void 0===s||s),o.isValid&&(o.isValid=null===(a=o.containsNonAlphanumericCharacter)||void 0===a||a),o}validatePasswordLengthOptions(e,t){let n=this.customStrengthOptions.minPasswordLength,r=this.customStrengthOptions.maxPasswordLength;n&&(t.meetsMinPasswordLength=e.length>=n),r&&(t.meetsMaxPasswordLength=e.length<=r)}validatePasswordCharacterOptions(e,t){let n;this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);for(let r=0;r<e.length;r++)n=e.charAt(r),this.updatePasswordCharacterOptionsStatuses(t,n>="a"&&n<="z",n>="A"&&n<="Z",n>="0"&&n<="9",this.allowedNonAlphanumericCharacters.includes(n))}updatePasswordCharacterOptionsStatuses(e,t,n,r,i){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=n)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=r)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=i))}}class e${constructor(e,t,n,r){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=n,this.config=r,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new eD(this),this.idTokenSubscription=new eD(this),this.beforeStateQueue=new eC(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=c,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=r.sdkClientVersion}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=ec(t)),this._initializationPromise=this.queue(async()=>{var n,r;if(!this._deleted&&(this.persistenceManager=await ef.create(this,e),!this._deleted)){if(null===(n=this._popupRedirectResolver)||void 0===n?void 0:n._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch(e){}await this.initializeCurrentUser(t),this.lastNotifiedUid=(null===(r=this.currentUser)||void 0===r?void 0:r.uid)||null,this._deleted||(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;let e=await this.assertedPersistence.getCurrentUser();if(this.currentUser||e){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{let t=await G(this,{idToken:e}),n=await el._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(n)}catch(e){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",e),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var t;if((0,r.xZ)(this.app)){let e=this.app.settings.authIdToken;return e?new Promise(t=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(e).then(t,t))}):this.directlySetCurrentUser(null)}let n=await this.assertedPersistence.getCurrentUser(),i=n,s=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();let n=null===(t=this.redirectUser)||void 0===t?void 0:t._redirectEventId,r=null==i?void 0:i._redirectEventId,a=await this.tryRedirectSignIn(e);(!n||n===r)&&(null==a?void 0:a.user)&&(i=a.user,s=!0)}if(!i)return this.directlySetCurrentUser(null);if(!i._redirectEventId){if(s)try{await this.beforeStateQueue.runMiddleware(i)}catch(e){i=n,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(e))}return i?this.reloadAndSetCurrentUserOrClear(i):this.directlySetCurrentUser(null)}return(v(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===i._redirectEventId)?this.directlySetCurrentUser(i):this.reloadAndSetCurrentUserOrClear(i)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch(e){await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await ee(e)}catch(e){if((null==e?void 0:e.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=S()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if((0,r.xZ)(this.app))return Promise.reject(y(this));let t=e?(0,i.Ku)(e):null;return t&&v(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&v(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return(0,r.xZ)(this.app)?Promise.reject(y(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return(0,r.xZ)(this.app)?Promise.reject(y(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(ec(e))})}_getRecaptchaConfig(){return null==this.tenantId?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();let t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return null===this.tenantId?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){let e=new eO(await eA(this));null===this.tenantId?this._projectPasswordPolicy=e:this._tenantPasswordPolicies[this.tenantId]=e}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new i.FA("auth","Firebase",e())}onAuthStateChanged(e,t,n){return this.registerStateListener(this.authStateSubscription,e,t,n)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,n){return this.registerStateListener(this.idTokenSubscription,e,t,n)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{let n=this.onAuthStateChanged(()=>{n(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){let t={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:await this.currentUser.getIdToken()};null!=this.tenantId&&(t.tenantId=this.tenantId),await es(this,t)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:null===(e=this._currentUser)||void 0===e?void 0:e.toJSON()}}async _setRedirectUser(e,t){let n=await this.getOrInitRedirectPersistenceManager(t);return null===e?n.removeCurrentUser():n.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){let t=e&&ec(e)||this._popupRedirectResolver;v(t,this,"argument-error"),this.redirectPersistenceManager=await ef.create(this,[ec(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var t,n;return(this._isInitialized&&await this.queue(async()=>{}),(null===(t=this._currentUser)||void 0===t?void 0:t._redirectEventId)===e)?this._currentUser:(null===(n=this.redirectUser)||void 0===n?void 0:n._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);let n=null!==(t=null===(e=this.currentUser)||void 0===e?void 0:e.uid)&&void 0!==t?t:null;this.lastNotifiedUid!==n&&(this.lastNotifiedUid=n,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,n,r){if(this._deleted)return()=>{};let i="function"==typeof t?t:t.next.bind(t),s=!1,a=this._isInitialized?Promise.resolve():this._initializationPromise;if(v(a,this,"internal-error"),a.then(()=>{s||i(this.currentUser)}),"function"==typeof t){let i=e.addObserver(t,n,r);return()=>{s=!0,i()}}{let n=e.addObserver(t);return()=>{s=!0,n()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return v(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=eE(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;let t={"X-Client-Version":this.clientVersion};this.app.options.appId&&(t["X-Firebase-gmpid"]=this.app.options.appId);let n=await (null===(e=this.heartbeatServiceProvider.getImmediate({optional:!0}))||void 0===e?void 0:e.getHeartbeatsHeader());n&&(t["X-Firebase-Client"]=n);let r=await this._getAppCheckToken();return r&&(t["X-Firebase-AppCheck"]=r),t}async _getAppCheckToken(){var e;let t=await (null===(e=this.appCheckServiceProvider.getImmediate({optional:!0}))||void 0===e?void 0:e.getToken());return(null==t?void 0:t.error)&&d(`Error while retrieving App Check token: ${t.error}`),null==t?void 0:t.token}}function eR(e){return(0,i.Ku)(e)}class eD{constructor(e){this.auth=e,this.observer=null,this.addObserver=(0,i.tD)(e=>this.observer=e)}get next(){return v(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}let eF={async loadJS(){throw Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function eP(e){eF=e}function eM(e){return eF.loadJS(e)}function eL(){return eF.recaptchaEnterpriseScript}function ez(){return eF.gapiScript}function eB(e){return`__${e}${Math.floor(1e6*Math.random())}`}class eU{constructor(){this.enterprise=new eV}ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}class eV{ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}let ej="recaptcha-enterprise",eG="NO_RECAPTCHA";class eW{constructor(e){this.type=ej,this.auth=eR(e)}async verify(e="verify",t=!1){async function n(e){if(!t){if(null==e.tenantId&&null!=e._agentRecaptchaConfig)return e._agentRecaptchaConfig.siteKey;if(null!=e.tenantId&&void 0!==e._tenantRecaptchaConfigs[e.tenantId])return e._tenantRecaptchaConfigs[e.tenantId].siteKey}return new Promise(async(t,n)=>{V(e,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(r=>{if(void 0===r.recaptchaKey)n(Error("recaptcha Enterprise site key undefined"));else{let n=new U(r);return null==e.tenantId?e._agentRecaptchaConfig=n:e._tenantRecaptchaConfigs[e.tenantId]=n,t(n.siteKey)}}).catch(e=>{n(e)})})}function r(t,n,r){let i=window.grecaptcha;B(i)?i.enterprise.ready(()=>{i.enterprise.execute(t,{action:e}).then(e=>{n(e)}).catch(()=>{n(eG)})}):r(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?new eU().execute("siteKey",{action:"verify"}):new Promise((e,i)=>{n(this.auth).then(n=>{if(!t&&B(window.grecaptcha))r(n,e,i);else{if("undefined"==typeof window){i(Error("RecaptchaVerifier is only supported in browser"));return}let t=eL();0!==t.length&&(t+=n),eM(t).then(()=>{r(n,e,i)}).catch(e=>{i(e)})}}).catch(e=>{i(e)})})}}async function eq(e,t,n,r=!1,i=!1){let s;let a=new eW(e);if(i)s=eG;else try{s=await a.verify(n)}catch(e){s=await a.verify(n,!0)}let o=Object.assign({},t);if("mfaSmsEnrollment"===n||"mfaSmsSignIn"===n){if("phoneEnrollmentInfo"in o){let e=o.phoneEnrollmentInfo.phoneNumber,t=o.phoneEnrollmentInfo.recaptchaToken;Object.assign(o,{phoneEnrollmentInfo:{phoneNumber:e,recaptchaToken:t,captchaResponse:s,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in o){let e=o.phoneSignInInfo.recaptchaToken;Object.assign(o,{phoneSignInInfo:{recaptchaToken:e,captchaResponse:s,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return o}return r?Object.assign(o,{captchaResp:s}):Object.assign(o,{captchaResponse:s}),Object.assign(o,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(o,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),o}async function eH(e,t,n,r,i){var s,a;if("EMAIL_PASSWORD_PROVIDER"===i){if(null===(s=e._getRecaptchaConfig())||void 0===s||!s.isProviderEnabled("EMAIL_PASSWORD_PROVIDER"))return r(e,t).catch(async i=>{if("auth/missing-recaptcha-token"!==i.code)return Promise.reject(i);{console.log(`${n} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);let i=await eq(e,t,n,"getOobCode"===n);return r(e,i)}});{let i=await eq(e,t,n,"getOobCode"===n);return r(e,i)}}if("PHONE_PROVIDER"!==i)return Promise.reject(i+" provider is not supported.");if(null===(a=e._getRecaptchaConfig())||void 0===a?void 0:a.isProviderEnabled("PHONE_PROVIDER")){let i=await eq(e,t,n);return r(e,i).catch(async i=>{var s;if((null===(s=e._getRecaptchaConfig())||void 0===s?void 0:s.getProviderEnforcementState("PHONE_PROVIDER"))==="AUDIT"&&("auth/missing-recaptcha-token"===i.code||"auth/invalid-app-credential"===i.code)){console.log(`Failed to verify with reCAPTCHA Enterprise. Automatically triggering the reCAPTCHA v2 flow to complete the ${n} flow.`);let i=await eq(e,t,n,!1,!0);return r(e,i)}return Promise.reject(i)})}{let i=await eq(e,t,n,!1,!0);return r(e,i)}}async function eK(e){let t=eR(e),n=new U(await V(t,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}));null==t.tenantId?t._agentRecaptchaConfig=n:t._tenantRecaptchaConfigs[t.tenantId]=n,n.isAnyProviderEnabled()&&new eW(t).verify()}function eX(e,t){let n=(0,r.j6)(e,"auth");if(n.isInitialized()){let e=n.getImmediate(),r=n.getOptions();if((0,i.bD)(r,null!=t?t:{}))return e;f(e,"already-initialized")}return n.initialize({options:t})}function eY(e,t){let n=(null==t?void 0:t.persistence)||[],r=(Array.isArray(n)?n:[n]).map(ec);(null==t?void 0:t.errorMap)&&e._updateErrorMap(t.errorMap),e._initializeWithPersistence(r,null==t?void 0:t.popupRedirectResolver)}function eQ(e,t,n){let r=eR(e);v(r._canInitEmulator,r,"emulator-config-failed"),v(/^https?:\/\//.test(t),r,"invalid-emulator-scheme");let i=!!(null==n?void 0:n.disableWarnings),s=eJ(t),{host:a,port:o}=eZ(t),l=null===o?"":`:${o}`;r.config.emulator={url:`${s}//${a}${l}/`},r.settings.appVerificationDisabledForTesting=!0,r.emulatorConfig=Object.freeze({host:a,port:o,protocol:s.replace(":",""),options:Object.freeze({disableWarnings:i})}),i||e1()}function eJ(e){let t=e.indexOf(":");return t<0?"":e.substr(0,t+1)}function eZ(e){let t=eJ(e),n=/(\/\/)?([^?#/]+)/.exec(e.substr(t.length));if(!n)return{host:"",port:null};let r=n[2].split("@").pop()||"",i=/^(\[[^\]]+\])(:|$)/.exec(r);if(i){let e=i[1];return{host:e,port:e0(r.substr(e.length+1))}}{let[e,t]=r.split(":");return{host:e,port:e0(t)}}}function e0(e){if(!e)return null;let t=Number(e);return isNaN(t)?null:t}function e1(){function e(){let e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}"undefined"!=typeof console&&"function"==typeof console.info&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),"undefined"!=typeof window&&"undefined"!=typeof document&&("loading"===document.readyState?window.addEventListener("DOMContentLoaded",e):e())}class e2{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return w("not implemented")}_getIdTokenResponse(e){return w("not implemented")}_linkToIdToken(e,t){return w("not implemented")}_getReauthenticationResolver(e){return w("not implemented")}}async function e3(e,t){return R(e,"POST","/v1/accounts:signUp",t)}async function e4(e,t){return F(e,"POST","/v1/accounts:signInWithPassword",$(e,t))}async function e6(e,t){return F(e,"POST","/v1/accounts:signInWithEmailLink",$(e,t))}async function e5(e,t){return F(e,"POST","/v1/accounts:signInWithEmailLink",$(e,t))}class e8 extends e2{constructor(e,t,n,r=null){super("password",n),this._email=e,this._password=t,this._tenantId=r}static _fromEmailAndPassword(e,t){return new e8(e,t,"password")}static _fromEmailAndCode(e,t,n=null){return new e8(e,t,"emailLink",n)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){let t="string"==typeof e?JSON.parse(e):e;if((null==t?void 0:t.email)&&(null==t?void 0:t.password)){if("password"===t.signInMethod)return this._fromEmailAndPassword(t.email,t.password);if("emailLink"===t.signInMethod)return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":return eH(e,{returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"},"signInWithPassword",e4,"EMAIL_PASSWORD_PROVIDER");case"emailLink":return e6(e,{email:this._email,oobCode:this._password});default:f(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":return eH(e,{idToken:t,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",e3,"EMAIL_PASSWORD_PROVIDER");case"emailLink":return e5(e,{idToken:t,email:this._email,oobCode:this._password});default:f(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}async function e7(e,t){return F(e,"POST","/v1/accounts:signInWithIdp",$(e,t))}let e9="http://localhost";class te extends e2{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){let t=new te(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):f("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){let t="string"==typeof e?JSON.parse(e):e,{providerId:n,signInMethod:r}=t,i=a(t,["providerId","signInMethod"]);if(!n||!r)return null;let s=new te(n,r);return s.idToken=i.idToken||void 0,s.accessToken=i.accessToken||void 0,s.secret=i.secret,s.nonce=i.nonce,s.pendingToken=i.pendingToken||null,s}_getIdTokenResponse(e){return e7(e,this.buildRequest())}_linkToIdToken(e,t){let n=this.buildRequest();return n.idToken=t,e7(e,n)}_getReauthenticationResolver(e){let t=this.buildRequest();return t.autoCreate=!1,e7(e,t)}buildRequest(){let e={requestUri:e9,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{let t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=(0,i.Am)(t)}return e}}async function tt(e,t){return R(e,"POST","/v1/accounts:sendVerificationCode",$(e,t))}async function tn(e,t){return F(e,"POST","/v1/accounts:signInWithPhoneNumber",$(e,t))}async function tr(e,t){let n=await F(e,"POST","/v1/accounts:signInWithPhoneNumber",$(e,t));if(n.temporaryProof)throw z(e,"account-exists-with-different-credential",n);return n}let ti={USER_NOT_FOUND:"user-not-found"};async function ts(e,t){return F(e,"POST","/v1/accounts:signInWithPhoneNumber",$(e,Object.assign(Object.assign({},t),{operation:"REAUTH"})),ti)}class ta extends e2{constructor(e){super("phone","phone"),this.params=e}static _fromVerification(e,t){return new ta({verificationId:e,verificationCode:t})}static _fromTokenResponse(e,t){return new ta({phoneNumber:e,temporaryProof:t})}_getIdTokenResponse(e){return tn(e,this._makeVerificationRequest())}_linkToIdToken(e,t){return tr(e,Object.assign({idToken:t},this._makeVerificationRequest()))}_getReauthenticationResolver(e){return ts(e,this._makeVerificationRequest())}_makeVerificationRequest(){let{temporaryProof:e,phoneNumber:t,verificationId:n,verificationCode:r}=this.params;return e&&t?{temporaryProof:e,phoneNumber:t}:{sessionInfo:n,code:r}}toJSON(){let e={providerId:this.providerId};return this.params.phoneNumber&&(e.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(e.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(e.verificationCode=this.params.verificationCode),this.params.verificationId&&(e.verificationId=this.params.verificationId),e}static fromJSON(e){"string"==typeof e&&(e=JSON.parse(e));let{verificationId:t,verificationCode:n,phoneNumber:r,temporaryProof:i}=e;return n||t||r||i?new ta({verificationId:t,verificationCode:n,phoneNumber:r,temporaryProof:i}):null}}function to(e){switch(e){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function tl(e){let t=(0,i.I9)((0,i.hp)(e)).link,n=t?(0,i.I9)((0,i.hp)(t)).deep_link_id:null,r=(0,i.I9)((0,i.hp)(e)).deep_link_id;return(r?(0,i.I9)((0,i.hp)(r)).link:null)||r||n||t||e}class tu{constructor(e){var t,n,r,s,a,o;let l=(0,i.I9)((0,i.hp)(e)),u=null!==(t=l.apiKey)&&void 0!==t?t:null,c=null!==(n=l.oobCode)&&void 0!==n?n:null,h=to(null!==(r=l.mode)&&void 0!==r?r:null);v(u&&c&&h,"argument-error"),this.apiKey=u,this.operation=h,this.code=c,this.continueUrl=null!==(s=l.continueUrl)&&void 0!==s?s:null,this.languageCode=null!==(a=l.languageCode)&&void 0!==a?a:null,this.tenantId=null!==(o=l.tenantId)&&void 0!==o?o:null}static parseLink(e){let t=tl(e);try{return new tu(t)}catch(e){return null}}}class tc{constructor(){this.providerId=tc.PROVIDER_ID}static credential(e,t){return e8._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){let n=tu.parseLink(t);return v(n,"argument-error"),e8._fromEmailAndCode(e,n.code,n.tenantId)}}tc.PROVIDER_ID="password",tc.EMAIL_PASSWORD_SIGN_IN_METHOD="password",tc.EMAIL_LINK_SIGN_IN_METHOD="emailLink";class th{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}class td extends th{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class tp extends td{constructor(){super("facebook.com")}static credential(e){return te._fromParams({providerId:tp.PROVIDER_ID,signInMethod:tp.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return tp.credentialFromTaggedObject(e)}static credentialFromError(e){return tp.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return tp.credential(e.oauthAccessToken)}catch(e){return null}}}tp.FACEBOOK_SIGN_IN_METHOD="facebook.com",tp.PROVIDER_ID="facebook.com";class tf extends td{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return te._fromParams({providerId:tf.PROVIDER_ID,signInMethod:tf.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return tf.credentialFromTaggedObject(e)}static credentialFromError(e){return tf.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;let{oauthIdToken:t,oauthAccessToken:n}=e;if(!t&&!n)return null;try{return tf.credential(t,n)}catch(e){return null}}}tf.GOOGLE_SIGN_IN_METHOD="google.com",tf.PROVIDER_ID="google.com";class tg extends td{constructor(){super("github.com")}static credential(e){return te._fromParams({providerId:tg.PROVIDER_ID,signInMethod:tg.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return tg.credentialFromTaggedObject(e)}static credentialFromError(e){return tg.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return tg.credential(e.oauthAccessToken)}catch(e){return null}}}tg.GITHUB_SIGN_IN_METHOD="github.com",tg.PROVIDER_ID="github.com";class tm extends td{constructor(){super("twitter.com")}static credential(e,t){return te._fromParams({providerId:tm.PROVIDER_ID,signInMethod:tm.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return tm.credentialFromTaggedObject(e)}static credentialFromError(e){return tm.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;let{oauthAccessToken:t,oauthTokenSecret:n}=e;if(!t||!n)return null;try{return tm.credential(t,n)}catch(e){return null}}}tm.TWITTER_SIGN_IN_METHOD="twitter.com",tm.PROVIDER_ID="twitter.com";class ty{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,n,r=!1){return new ty({user:await el._fromIdTokenResponse(e,n,r),providerId:tb(n),_tokenResponse:n,operationType:t})}static async _forOperation(e,t,n){return await e._updateTokensIfNecessary(n,!0),new ty({user:e,providerId:tb(n),_tokenResponse:n,operationType:t})}}function tb(e){return e.providerId?e.providerId:"phoneNumber"in e?"phone":null}class tv extends i.g{constructor(e,t,n,r){var i;super(t.code,t.message),this.operationType=n,this.user=r,Object.setPrototypeOf(this,tv.prototype),this.customData={appName:e.name,tenantId:null!==(i=e.tenantId)&&void 0!==i?i:void 0,_serverResponse:t.customData._serverResponse,operationType:n}}static _fromErrorAndOperation(e,t,n,r){return new tv(e,t,n,r)}}function tw(e,t,n,r){return("reauthenticate"===t?n._getReauthenticationResolver(e):n._getIdTokenResponse(e)).catch(n=>{if("auth/multi-factor-auth-required"===n.code)throw tv._fromErrorAndOperation(e,n,t,r);throw n})}function t_(e){return new Set(e.map(({providerId:e})=>e).filter(e=>!!e))}async function tx(e,t,n=!1){let r=await Y(e,t._linkToIdToken(e.auth,await e.getIdToken()),n);return ty._forOperation(e,"link",r)}async function tT(e,t,n=!1){let{auth:i}=e;if((0,r.xZ)(i.app))return Promise.reject(y(i));let s="reauthenticate";try{let r=await Y(e,tw(i,s,t,e),n);v(r.idToken,i,"internal-error");let a=K(r.idToken);v(a,i,"internal-error");let{sub:o}=a;return v(e.uid===o,i,"user-mismatch"),ty._forOperation(e,s,r)}catch(e){throw(null==e?void 0:e.code)==="auth/user-not-found"&&f(i,"user-mismatch"),e}}async function tI(e,t,n=!1){if((0,r.xZ)(e.app))return Promise.reject(y(e));let i="signIn",s=await tw(e,i,t),a=await ty._fromIdTokenResponse(e,i,s);return n||await e._updateCurrentUser(a.user),a}async function tk(e,t){return tI(eR(e),t)}class tS{constructor(e,t){this.factorId=e,this.uid=t.mfaEnrollmentId,this.enrollmentTime=new Date(t.enrolledAt).toUTCString(),this.displayName=t.displayName}static _fromServerResponse(e,t){return"phoneInfo"in t?tE._fromServerResponse(e,t):"totpInfo"in t?tC._fromServerResponse(e,t):f(e,"internal-error")}}class tE extends tS{constructor(e){super("phone",e),this.phoneNumber=e.phoneInfo}static _fromServerResponse(e,t){return new tE(t)}}class tC extends tS{constructor(e){super("totp",e)}static _fromServerResponse(e,t){return new tC(t)}}async function tA(e){let t=eR(e);t._getPasswordPolicyInternal()&&await t._updatePasswordPolicy()}function tN(e,t,n){return(0,r.xZ)(e.app)?Promise.reject(y(e)):tk((0,i.Ku)(e),tc.credential(t,n)).catch(async t=>{throw"auth/password-does-not-meet-requirements"===t.code&&tA(e),t})}class tO{constructor(e,t,n={}){this.isNewUser=e,this.providerId=t,this.profile=n}}class t$ extends tO{constructor(e,t,n,r){super(e,t,n),this.username=r}}function tR(e,t,n,r){return(0,i.Ku)(e).onIdTokenChanged(t,n,r)}function tD(e,t,n){return(0,i.Ku)(e).beforeAuthStateChanged(t,n)}function tF(e,t,n,r){return(0,i.Ku)(e).onAuthStateChanged(t,n,r)}function tP(e){return(0,i.Ku)(e).signOut()}class tM{constructor(e,t,n){this.type=e,this.credential=t,this.user=n}static _fromIdtoken(e,t){return new tM("enroll",e,t)}static _fromMfaPendingCredential(e){return new tM("signin",e)}toJSON(){return{multiFactorSession:{["enroll"===this.type?"idToken":"pendingCredential"]:this.credential}}}static fromJSON(e){var t,n;if(null==e?void 0:e.multiFactorSession){if(null===(t=e.multiFactorSession)||void 0===t?void 0:t.pendingCredential)return tM._fromMfaPendingCredential(e.multiFactorSession.pendingCredential);if(null===(n=e.multiFactorSession)||void 0===n?void 0:n.idToken)return tM._fromIdtoken(e.multiFactorSession.idToken)}return null}}class tL{constructor(e,t,n){this.session=e,this.hints=t,this.signInResolver=n}static _fromError(e,t){let n=eR(e),r=t.customData._serverResponse,i=(r.mfaInfo||[]).map(e=>tS._fromServerResponse(n,e));v(r.mfaPendingCredential,n,"internal-error");let s=tM._fromMfaPendingCredential(r.mfaPendingCredential);return new tL(s,i,async e=>{let i=await e._process(n,s);delete r.mfaInfo,delete r.mfaPendingCredential;let a=Object.assign(Object.assign({},r),{idToken:i.idToken,refreshToken:i.refreshToken});switch(t.operationType){case"signIn":let o=await ty._fromIdTokenResponse(n,t.operationType,a);return await n._updateCurrentUser(o.user),o;case"reauthenticate":return v(t.user,n,"internal-error"),ty._forOperation(t.user,t.operationType,a);default:f(n,"internal-error")}})}async resolveSignIn(e){let t=e;return this.signInResolver(t)}}function tz(e,t){return R(e,"POST","/v2/accounts/mfaEnrollment:start",$(e,t))}function tB(e,t){return R(e,"POST","/v2/accounts/mfaEnrollment:finalize",$(e,t))}function tU(e,t){return R(e,"POST","/v2/accounts/mfaEnrollment:start",$(e,t))}function tV(e,t){return R(e,"POST","/v2/accounts/mfaEnrollment:finalize",$(e,t))}function tj(e,t){return R(e,"POST","/v2/accounts/mfaEnrollment:withdraw",$(e,t))}class tG{constructor(e){this.user=e,this.enrolledFactors=[],e._onReload(t=>{t.mfaInfo&&(this.enrolledFactors=t.mfaInfo.map(t=>tS._fromServerResponse(e.auth,t)))})}static _fromUser(e){return new tG(e)}async getSession(){return tM._fromIdtoken(await this.user.getIdToken(),this.user)}async enroll(e,t){let n=e,r=await this.getSession(),i=await Y(this.user,n._process(this.user.auth,r,t));return await this.user._updateTokensIfNecessary(i),this.user.reload()}async unenroll(e){let t="string"==typeof e?e:e.uid,n=await this.user.getIdToken();try{let e=await Y(this.user,tj(this.user.auth,{idToken:n,mfaEnrollmentId:t}));this.enrolledFactors=this.enrolledFactors.filter(({uid:e})=>e!==t),await this.user._updateTokensIfNecessary(e),await this.user.reload()}catch(e){throw e}}}new WeakMap;let tW="__sak";class tq{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{if(!this.storage)return Promise.resolve(!1);return this.storage.setItem(tW,"1"),this.storage.removeItem(tW),Promise.resolve(!0)}catch(e){return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){let t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}let tH=1e3,tK=10;class tX extends tq{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=eS(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(let t of Object.keys(this.listeners)){let n=this.storage.getItem(t),r=this.localCache[t];n!==r&&e(t,r,n)}}onStorageEvent(e,t=!1){if(!e.key){this.forAllChangedKeys((e,t,n)=>{this.notifyListeners(e,n)});return}let n=e.key;t?this.detachListener():this.stopPolling();let r=()=>{let e=this.storage.getItem(n);(t||this.localCache[n]!==e)&&this.notifyListeners(n,e)},i=this.storage.getItem(n);ek()&&i!==e.newValue&&e.newValue!==e.oldValue?setTimeout(r,tK):r()}notifyListeners(e,t){this.localCache[e]=t;let n=this.listeners[e];if(n)for(let e of Array.from(n))e(t?JSON.parse(t):t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,n)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:n}),!0)})},tH)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){0===Object.keys(this.listeners).length&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){let t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}tX.type="LOCAL";let tY=tX;class tQ extends tq{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}tQ.type="SESSION";let tJ=tQ;function tZ(e){return Promise.all(e.map(async e=>{try{let t=await e;return{fulfilled:!0,value:t}}catch(e){return{fulfilled:!1,reason:e}}}))}class t0{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){let t=this.receivers.find(t=>t.isListeningto(e));if(t)return t;let n=new t0(e);return this.receivers.push(n),n}isListeningto(e){return this.eventTarget===e}async handleEvent(e){let t=e,{eventId:n,eventType:r,data:i}=t.data,s=this.handlersMap[r];if(!(null==s?void 0:s.size))return;t.ports[0].postMessage({status:"ack",eventId:n,eventType:r});let a=Array.from(s).map(async e=>e(t.origin,i)),o=await tZ(a);t.ports[0].postMessage({status:"done",eventId:n,eventType:r,response:o})}_subscribe(e,t){0===Object.keys(this.handlersMap).length&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),t&&0!==this.handlersMap[e].size||delete this.handlersMap[e],0===Object.keys(this.handlersMap).length&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}function t1(e="",t=10){let n="";for(let e=0;e<t;e++)n+=Math.floor(10*Math.random());return e+n}t0.receivers=[];class t2{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,n=50){let r,i;let s="undefined"!=typeof MessageChannel?new MessageChannel:null;if(!s)throw Error("connection_unavailable");return new Promise((a,o)=>{let l=t1("",20);s.port1.start();let u=setTimeout(()=>{o(Error("unsupported_event"))},n);i={messageChannel:s,onMessage(e){let t=e;if(t.data.eventId===l)switch(t.data.status){case"ack":clearTimeout(u),r=setTimeout(()=>{o(Error("timeout"))},3e3);break;case"done":clearTimeout(r),a(t.data.response);break;default:clearTimeout(u),clearTimeout(r),o(Error("invalid_response"))}}},this.handlers.add(i),s.port1.addEventListener("message",i.onMessage),this.target.postMessage({eventType:e,eventId:l,data:t},[s.port2])}).finally(()=>{i&&this.removeMessageHandler(i)})}}function t3(){return window}function t4(e){t3().location.href=e}function t6(){return void 0!==t3().WorkerGlobalScope&&"function"==typeof t3().importScripts}async function t5(){if(!(null==navigator?void 0:navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch(e){return null}}function t8(){var e;return(null===(e=null==navigator?void 0:navigator.serviceWorker)||void 0===e?void 0:e.controller)||null}function t7(){return t6()?self:null}let t9="firebaseLocalStorageDb",ne=1,nt="firebaseLocalStorage",nn="fbase_key";class nr{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function ni(e,t){return e.transaction([nt],t?"readwrite":"readonly").objectStore(nt)}function ns(){return new nr(indexedDB.deleteDatabase(t9)).toPromise()}function na(){let e=indexedDB.open(t9,ne);return new Promise((t,n)=>{e.addEventListener("error",()=>{n(e.error)}),e.addEventListener("upgradeneeded",()=>{let t=e.result;try{t.createObjectStore(nt,{keyPath:nn})}catch(e){n(e)}}),e.addEventListener("success",async()=>{let n=e.result;n.objectStoreNames.contains(nt)?t(n):(n.close(),await ns(),t(await na()))})})}async function no(e,t,n){return new nr(ni(e,!0).put({[nn]:t,value:n})).toPromise()}async function nl(e,t){let n=ni(e,!1).get(t),r=await new nr(n).toPromise();return void 0===r?null:r.value}function nu(e,t){return new nr(ni(e,!0).delete(t)).toPromise()}let nc=800,nh=3;class nd{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db||(this.db=await na()),this.db}async _withRetries(e){let t=0;for(;;)try{let t=await this._openDb();return await e(t)}catch(e){if(t++>nh)throw e;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return t6()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=t0._getInstance(t7()),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){var e,t;if(this.activeServiceWorker=await t5(),!this.activeServiceWorker)return;this.sender=new t2(this.activeServiceWorker);let n=await this.sender._send("ping",{},800);n&&(null===(e=n[0])||void 0===e?void 0:e.fulfilled)&&(null===(t=n[0])||void 0===t?void 0:t.value.includes("keyChanged"))&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(this.sender&&this.activeServiceWorker&&t8()===this.activeServiceWorker)try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch(e){}}async _isAvailable(){try{if(!indexedDB)return!1;let e=await na();return await no(e,tW,"1"),await nu(e,tW),!0}catch(e){}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(n=>no(n,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){let t=await this._withRetries(t=>nl(t,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>nu(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){let e=await this._withRetries(e=>new nr(ni(e,!1).getAll()).toPromise());if(!e||0!==this.pendingWrites)return[];let t=[],n=new Set;if(0!==e.length)for(let{fbase_key:r,value:i}of e)n.add(r),JSON.stringify(this.localCache[r])!==JSON.stringify(i)&&(this.notifyListeners(r,i),t.push(r));for(let e of Object.keys(this.localCache))this.localCache[e]&&!n.has(e)&&(this.notifyListeners(e,null),t.push(e));return t}notifyListeners(e,t){this.localCache[e]=t;let n=this.listeners[e];if(n)for(let e of Array.from(n))e(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),nc)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){0===Object.keys(this.listeners).length&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&this.stopPolling()}}nd.type="LOCAL";let np=nd;function nf(e,t){return R(e,"POST","/v2/accounts/mfaSignIn:start",$(e,t))}function ng(e,t){return R(e,"POST","/v2/accounts/mfaSignIn:finalize",$(e,t))}function nm(e,t){return R(e,"POST","/v2/accounts/mfaSignIn:finalize",$(e,t))}eB("rcb"),new E(3e4,6e4);let ny="recaptcha";async function nb(e,t,n){var r;if(!e._getRecaptchaConfig())try{await eK(e)}catch(e){console.log("Failed to initialize reCAPTCHA Enterprise config. Triggering the reCAPTCHA v2 verification.")}try{let i;if(i="string"==typeof t?{phoneNumber:t}:t,"session"in i){let t=i.session;if("phoneNumber"in i){v("enroll"===t.type,e,"internal-error");let r={idToken:t.credential,phoneEnrollmentInfo:{phoneNumber:i.phoneNumber,clientType:"CLIENT_TYPE_WEB"}},s=async(e,t)=>{if(t.phoneEnrollmentInfo.captchaResponse===eG){v((null==n?void 0:n.type)===ny,e,"argument-error");let r=await nv(e,t,n);return tz(e,r)}return tz(e,t)},a=eH(e,r,"mfaSmsEnrollment",s,"PHONE_PROVIDER");return(await a.catch(e=>Promise.reject(e))).phoneSessionInfo.sessionInfo}{v("signin"===t.type,e,"internal-error");let s=(null===(r=i.multiFactorHint)||void 0===r?void 0:r.uid)||i.multiFactorUid;v(s,e,"missing-multi-factor-info");let a={mfaPendingCredential:t.credential,mfaEnrollmentId:s,phoneSignInInfo:{clientType:"CLIENT_TYPE_WEB"}},o=async(e,t)=>{if(t.phoneSignInInfo.captchaResponse===eG){v((null==n?void 0:n.type)===ny,e,"argument-error");let r=await nv(e,t,n);return nf(e,r)}return nf(e,t)},l=eH(e,a,"mfaSmsSignIn",o,"PHONE_PROVIDER");return(await l.catch(e=>Promise.reject(e))).phoneResponseInfo.sessionInfo}}{let t={phoneNumber:i.phoneNumber,clientType:"CLIENT_TYPE_WEB"},r=async(e,t)=>{if(t.captchaResponse===eG){v((null==n?void 0:n.type)===ny,e,"argument-error");let r=await nv(e,t,n);return tt(e,r)}return tt(e,t)},s=eH(e,t,"sendVerificationCode",r,"PHONE_PROVIDER");return(await s.catch(e=>Promise.reject(e))).sessionInfo}}finally{null==n||n._reset()}}async function nv(e,t,n){v(n.type===ny,e,"argument-error");let r=await n.verify();v("string"==typeof r,e,"argument-error");let i=Object.assign({},t);if("phoneEnrollmentInfo"in i){let e=i.phoneEnrollmentInfo.phoneNumber,t=i.phoneEnrollmentInfo.captchaResponse,n=i.phoneEnrollmentInfo.clientType,s=i.phoneEnrollmentInfo.recaptchaVersion;return Object.assign(i,{phoneEnrollmentInfo:{phoneNumber:e,recaptchaToken:r,captchaResponse:t,clientType:n,recaptchaVersion:s}}),i}if(!("phoneSignInInfo"in i))return Object.assign(i,{recaptchaToken:r}),i;{let e=i.phoneSignInInfo.captchaResponse,t=i.phoneSignInInfo.clientType,n=i.phoneSignInInfo.recaptchaVersion;return Object.assign(i,{phoneSignInInfo:{recaptchaToken:r,captchaResponse:e,clientType:t,recaptchaVersion:n}}),i}}class nw{constructor(e){this.providerId=nw.PROVIDER_ID,this.auth=eR(e)}verifyPhoneNumber(e,t){return nb(this.auth,e,(0,i.Ku)(t))}static credential(e,t){return ta._fromVerification(e,t)}static credentialFromResult(e){let t=e;return nw.credentialFromTaggedObject(t)}static credentialFromError(e){return nw.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;let{phoneNumber:t,temporaryProof:n}=e;return t&&n?ta._fromTokenResponse(t,n):null}}function n_(e,t){return t?ec(t):(v(e._popupRedirectResolver,e,"argument-error"),e._popupRedirectResolver)}nw.PROVIDER_ID="phone",nw.PHONE_SIGN_IN_METHOD="phone";class nx extends e2{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return e7(e,this._buildIdpRequest())}_linkToIdToken(e,t){return e7(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return e7(e,this._buildIdpRequest())}_buildIdpRequest(e){let t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function nT(e){return tI(e.auth,new nx(e),e.bypassAuthState)}function nI(e){let{auth:t,user:n}=e;return v(n,t,"internal-error"),tT(n,new nx(e),e.bypassAuthState)}async function nk(e){let{auth:t,user:n}=e;return v(n,t,"internal-error"),tx(n,new nx(e),e.bypassAuthState)}class nS{constructor(e,t,n,r,i=!1){this.auth=e,this.resolver=n,this.user=r,this.bypassAuthState=i,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(e){this.reject(e)}})}async onAuthEvent(e){let{urlResponse:t,sessionId:n,postBody:r,tenantId:i,error:s,type:a}=e;if(s){this.reject(s);return}let o={auth:this.auth,requestUri:t,sessionId:n,tenantId:i||void 0,postBody:r||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(a)(o))}catch(e){this.reject(e)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return nT;case"linkViaPopup":case"linkViaRedirect":return nk;case"reauthViaPopup":case"reauthViaRedirect":return nI;default:f(this.auth,"internal-error")}}resolve(e){_(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){_(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}let nE=new E(2e3,1e4);class nC extends nS{constructor(e,t,n,r,i){super(e,t,r,i),this.provider=n,this.authWindow=null,this.pollId=null,nC.currentPopupAction&&nC.currentPopupAction.cancel(),nC.currentPopupAction=this}async executeNotNull(){let e=await this.execute();return v(e,this.auth,"internal-error"),e}async onExecution(){_(1===this.filter.length,"Popup operations only handle one event");let e=t1();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(e=>{this.reject(e)}),this.resolver._isIframeWebStorageSupported(this.auth,e=>{e||this.reject(g(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return(null===(e=this.authWindow)||void 0===e?void 0:e.associatedEvent)||null}cancel(){this.reject(g(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,nC.currentPopupAction=null}pollUserCancellation(){let e=()=>{var t,n;if(null===(n=null===(t=this.authWindow)||void 0===t?void 0:t.window)||void 0===n?void 0:n.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(g(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,nE.get())};e()}}nC.currentPopupAction=null;let nA="pendingRedirect",nN=new Map;class nO extends nS{constructor(e,t,n=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,n),this.eventId=null}async execute(){let e=nN.get(this.auth._key());if(!e){try{let t=await n$(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(t)}catch(t){e=()=>Promise.reject(t)}nN.set(this.auth._key(),e)}return this.bypassAuthState||nN.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if("signInViaRedirect"===e.type)return super.onAuthEvent(e);if("unknown"===e.type){this.resolve(null);return}if(e.eventId){let t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function n$(e,t){let n=nF(t),r=nD(e);if(!await r._isAvailable())return!1;let i=await r._get(n)==="true";return await r._remove(n),i}function nR(e,t){nN.set(e._key(),t)}function nD(e){return ec(e._redirectPersistence)}function nF(e){return ep(nA,e.config.apiKey,e.name)}async function nP(e,t,n=!1){if((0,r.xZ)(e.app))return Promise.reject(y(e));let i=eR(e),s=n_(i,t),a=new nO(i,s,n),o=await a.execute();return o&&!n&&(delete o.user._redirectEventId,await i._persistUserIfCurrent(o.user),await i._setRedirectUser(null,t)),o}let nM=6e5;class nL{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(n=>{this.isEventForConsumer(e,n)&&(t=!0,this.sendToConsumer(e,n),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!nU(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var n;if(e.error&&!nB(e)){let r=(null===(n=e.error.code)||void 0===n?void 0:n.split("auth/")[1])||"internal-error";t.onError(g(this.auth,r))}else t.onAuthEvent(e)}isEventForConsumer(e,t){let n=null===t.eventId||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&n}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=nM&&this.cachedEventUids.clear(),this.cachedEventUids.has(nz(e))}saveEventToCache(e){this.cachedEventUids.add(nz(e)),this.lastProcessedEventTime=Date.now()}}function nz(e){return[e.type,e.eventId,e.sessionId,e.tenantId].filter(e=>e).join("-")}function nB({type:e,error:t}){return"unknown"===e&&(null==t?void 0:t.code)==="auth/no-auth-event"}function nU(e){switch(e.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return nB(e);default:return!1}}async function nV(e,t={}){return R(e,"GET","/v1/projects",t)}let nj=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,nG=/^https?/;async function nW(e){if(e.config.emulator)return;let{authorizedDomains:t}=await nV(e);for(let e of t)try{if(nq(e))return}catch(e){}f(e,"unauthorized-domain")}function nq(e){let t=x(),{protocol:n,hostname:r}=new URL(t);if(e.startsWith("chrome-extension://")){let i=new URL(e);return""===i.hostname&&""===r?"chrome-extension:"===n&&e.replace("chrome-extension://","")===t.replace("chrome-extension://",""):"chrome-extension:"===n&&i.hostname===r}if(!nG.test(n))return!1;if(nj.test(e))return r===e;let i=e.replace(/\./g,"\\.");return RegExp("^(.+\\."+i+"|"+i+")$","i").test(r)}let nH=new E(3e4,6e4);function nK(){let e=t3().___jsl;if(null==e?void 0:e.H){for(let t of Object.keys(e.H))if(e.H[t].r=e.H[t].r||[],e.H[t].L=e.H[t].L||[],e.H[t].r=[...e.H[t].L],e.CP)for(let t=0;t<e.CP.length;t++)e.CP[t]=null}}function nX(e){return new Promise((t,n)=>{var r,i,s;function a(){nK(),gapi.load("gapi.iframes",{callback:()=>{t(gapi.iframes.getContext())},ontimeout:()=>{nK(),n(g(e,"network-request-failed"))},timeout:nH.get()})}if(null===(i=null===(r=t3().gapi)||void 0===r?void 0:r.iframes)||void 0===i?void 0:i.Iframe)t(gapi.iframes.getContext());else if(null===(s=t3().gapi)||void 0===s?void 0:s.load)a();else{let t=eB("iframefcb");return t3()[t]=()=>{gapi.load?a():n(g(e,"network-request-failed"))},eM(`${ez()}?onload=${t}`).catch(e=>n(e))}}).catch(e=>{throw nY=null,e})}let nY=null;function nQ(e){return nY=nY||nX(e)}let nJ=new E(5e3,15e3),nZ="__/auth/iframe",n0="emulator/auth/iframe",n1={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},n2=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function n3(e){let t=e.config;v(t.authDomain,e,"auth-domain-config-required");let n=t.emulator?C(t,n0):`https://${e.config.authDomain}/${nZ}`,s={apiKey:t.apiKey,appName:e.name,v:r.MF},a=n2.get(e.config.apiHost);a&&(s.eid=a);let o=e._getFrameworks();return o.length&&(s.fw=o.join(",")),`${n}?${(0,i.Am)(s).slice(1)}`}async function n4(e){let t=await nQ(e),n=t3().gapi;return v(n,e,"internal-error"),t.open({where:document.body,url:n3(e),messageHandlersFilter:n.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:n1,dontclear:!0},t=>new Promise(async(n,r)=>{await t.restyle({setHideOnLeave:!1});let i=g(e,"network-request-failed"),s=t3().setTimeout(()=>{r(i)},nJ.get());function a(){t3().clearTimeout(s),n(t)}t.ping(a).then(a,()=>{r(i)})}))}let n6={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},n5=500,n8=600,n7="_blank",n9="http://localhost";class re{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch(e){}}}function rt(e,t,n,r=n5,s=n8){let a=Math.max((window.screen.availHeight-s)/2,0).toString(),o=Math.max((window.screen.availWidth-r)/2,0).toString(),l="",u=Object.assign(Object.assign({},n6),{width:r.toString(),height:s.toString(),top:a,left:o}),c=(0,i.ZQ)().toLowerCase();n&&(l=eb(c)?n7:n),em(c)&&(t=t||n9,u.scrollbars="yes");let h=Object.entries(u).reduce((e,[t,n])=>`${e}${t}=${n},`,"");if(eI(c)&&"_self"!==l)return rn(t||"",l),new re(null);let d=window.open(t||"",l,h);v(d,e,"popup-blocked");try{d.focus()}catch(e){}return new re(d)}function rn(e,t){let n=document.createElement("a");n.href=e,n.target=t;let r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),n.dispatchEvent(r)}let rr="__/auth/handler",ri="emulator/auth/handler",rs=encodeURIComponent("fac");async function ra(e,t,n,s,a,o){v(e.config.authDomain,e,"auth-domain-config-required"),v(e.config.apiKey,e,"invalid-api-key");let l={apiKey:e.config.apiKey,appName:e.name,authType:n,redirectUrl:s,v:r.MF,eventId:a};if(t instanceof th)for(let[n,r]of(t.setDefaultLanguage(e.languageCode),l.providerId=t.providerId||"",(0,i.Im)(t.getCustomParameters())||(l.customParameters=JSON.stringify(t.getCustomParameters())),Object.entries(o||{})))l[n]=r;if(t instanceof td){let e=t.getScopes().filter(e=>""!==e);e.length>0&&(l.scopes=e.join(","))}e.tenantId&&(l.tid=e.tenantId);let u=l;for(let e of Object.keys(u))void 0===u[e]&&delete u[e];let c=await e._getAppCheckToken(),h=c?`#${rs}=${encodeURIComponent(c)}`:"";return`${ro(e)}?${(0,i.Am)(u).slice(1)}${h}`}function ro({config:e}){return e.emulator?C(e,ri):`https://${e.authDomain}/${rr}`}let rl="webStorageSupport";class ru{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=tJ,this._completeRedirectFn=nP,this._overrideRedirectResult=nR}async _openPopup(e,t,n,r){var i;_(null===(i=this.eventManagers[e._key()])||void 0===i?void 0:i.manager,"_initialize() not called before _openPopup()");let s=await ra(e,t,n,x(),r);return rt(e,s,t1())}async _openRedirect(e,t,n,r){return await this._originValidation(e),t4(await ra(e,t,n,x(),r)),new Promise(()=>{})}_initialize(e){let t=e._key();if(this.eventManagers[t]){let{manager:e,promise:n}=this.eventManagers[t];return e?Promise.resolve(e):(_(n,"If manager is not set, promise should be"),n)}let n=this.initAndGetManager(e);return this.eventManagers[t]={promise:n},n.catch(()=>{delete this.eventManagers[t]}),n}async initAndGetManager(e){let t=await n4(e),n=new nL(e);return t.register("authEvent",t=>(v(null==t?void 0:t.authEvent,e,"invalid-auth-event"),{status:n.onEvent(t.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:n},this.iframes[e._key()]=t,n}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(rl,{type:rl},n=>{var r;let i=null===(r=null==n?void 0:n[0])||void 0===r?void 0:r[rl];void 0!==i&&t(!!i),f(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){let t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=nW(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return eS()||ey()||eT()}}let rc=ru;class rh{constructor(e){this.factorId=e}_process(e,t,n){switch(t.type){case"enroll":return this._finalizeEnroll(e,t.credential,n);case"signin":return this._finalizeSignIn(e,t.credential);default:return w("unexpected MultiFactorSessionType")}}}class rd extends rh{constructor(e){super("phone"),this.credential=e}static _fromCredential(e){return new rd(e)}_finalizeEnroll(e,t,n){return tB(e,{idToken:t,displayName:n,phoneVerificationInfo:this.credential._makeVerificationRequest()})}_finalizeSignIn(e,t){return ng(e,{mfaPendingCredential:t,phoneVerificationInfo:this.credential._makeVerificationRequest()})}}class rp{constructor(){}static assertion(e){return rd._fromCredential(e)}}rp.FACTOR_ID="phone";class rf{static assertionForEnrollment(e,t){return rg._fromSecret(e,t)}static assertionForSignIn(e,t){return rg._fromEnrollmentId(e,t)}static async generateSecret(e){var t;let n=e;v(void 0!==(null===(t=n.user)||void 0===t?void 0:t.auth),"internal-error");let r=await tU(n.user.auth,{idToken:n.credential,totpEnrollmentInfo:{}});return rm._fromStartTotpMfaEnrollmentResponse(r,n.user.auth)}}rf.FACTOR_ID="totp";class rg extends rh{constructor(e,t,n){super("totp"),this.otp=e,this.enrollmentId=t,this.secret=n}static _fromSecret(e,t){return new rg(t,void 0,e)}static _fromEnrollmentId(e,t){return new rg(t,e)}async _finalizeEnroll(e,t,n){return v(void 0!==this.secret,e,"argument-error"),tV(e,{idToken:t,displayName:n,totpVerificationInfo:this.secret._makeTotpVerificationInfo(this.otp)})}async _finalizeSignIn(e,t){v(void 0!==this.enrollmentId&&void 0!==this.otp,e,"argument-error");let n={verificationCode:this.otp};return nm(e,{mfaPendingCredential:t,mfaEnrollmentId:this.enrollmentId,totpVerificationInfo:n})}}class rm{constructor(e,t,n,r,i,s,a){this.sessionInfo=s,this.auth=a,this.secretKey=e,this.hashingAlgorithm=t,this.codeLength=n,this.codeIntervalSeconds=r,this.enrollmentCompletionDeadline=i}static _fromStartTotpMfaEnrollmentResponse(e,t){return new rm(e.totpSessionInfo.sharedSecretKey,e.totpSessionInfo.hashingAlgorithm,e.totpSessionInfo.verificationCodeLength,e.totpSessionInfo.periodSec,new Date(e.totpSessionInfo.finalizeEnrollmentTime).toUTCString(),e.totpSessionInfo.sessionInfo,t)}_makeTotpVerificationInfo(e){return{sessionInfo:this.sessionInfo,verificationCode:e}}generateQrCodeUrl(e,t){var n;let r=!1;return(ry(e)||ry(t))&&(r=!0),r&&(ry(e)&&(e=(null===(n=this.auth.currentUser)||void 0===n?void 0:n.email)||"unknownuser"),ry(t)&&(t=this.auth.name)),`otpauth://totp/${t}:${e}?secret=${this.secretKey}&issuer=${t}&algorithm=${this.hashingAlgorithm}&digits=${this.codeLength}`}}function ry(e){return void 0===e||(null==e?void 0:e.length)===0}var rb="@firebase/auth",rv="1.8.2";class rw{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),(null===(e=this.auth.currentUser)||void 0===e?void 0:e.uid)||null}async getToken(e){return(this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser)?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;let t=this.auth.onIdTokenChanged(t=>{e((null==t?void 0:t.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();let t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){v(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}function r_(e){switch(e){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function rx(e){(0,r.om)(new o.uA("auth",(t,{options:n})=>{let r=t.getProvider("app").getImmediate(),i=t.getProvider("heartbeat"),s=t.getProvider("app-check-internal"),{apiKey:a,authDomain:o}=r.options;v(a&&!a.includes(":"),"invalid-api-key",{appName:r.name});let l=new e$(r,i,s,{apiKey:a,authDomain:o,clientPlatform:e,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:eE(e)});return eY(l,n),l},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,n)=>{e.getProvider("auth-internal").initialize()})),(0,r.om)(new o.uA("auth-internal",e=>new rw(eR(e.getProvider("auth").getImmediate())),"PRIVATE").setInstantiationMode("EXPLICIT")),(0,r.KO)(rb,rv,r_(e)),(0,r.KO)(rb,rv,"esm2017")}let rT=300,rI=(0,i.XA)("authIdTokenMaxAge")||rT,rk=null,rS=e=>async t=>{let n=t&&await t.getIdTokenResult(),r=n&&(new Date().getTime()-Date.parse(n.issuedAtTime))/1e3;if(r&&r>rI)return;let i=null==n?void 0:n.token;rk!==i&&(rk=i,await fetch(e,{method:i?"POST":"DELETE",headers:i?{Authorization:`Bearer ${i}`}:{}}))};function rE(e=(0,r.Sx)()){let t=(0,r.j6)(e,"auth");if(t.isInitialized())return t.getImmediate();let n=eX(e,{popupRedirectResolver:rc,persistence:[np,tY,tJ]}),s=(0,i.XA)("authTokenSyncURL");if(s&&"boolean"==typeof isSecureContext&&isSecureContext){let e=new URL(s,location.origin);if(location.origin===e.origin){let t=rS(e.toString());tD(n,t,()=>t(n.currentUser)),tR(n,e=>t(e))}}let a=(0,i.Tj)("auth");return a&&eQ(n,`http://${a}`),n}function rC(){var e,t;return null!==(t=null===(e=document.getElementsByTagName("head"))||void 0===e?void 0:e[0])&&void 0!==t?t:document}eP({loadJS:e=>new Promise((t,n)=>{let r=document.createElement("script");r.setAttribute("src",e),r.onload=t,r.onerror=e=>{let t=g("internal-error");t.customData=e,n(t)},r.type="text/javascript",r.charset="UTF-8",rC().appendChild(r)}),gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="}),rx("Browser")},9279:(e,t,n)=>{"use strict";n.d(t,{A:()=>l});var r=n(6540);let i=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),s=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.filter((e,t,n)=>!!e&&""!==e.trim()&&n.indexOf(e)===t).join(" ").trim()};var a={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let o=(0,r.forwardRef)((e,t)=>{let{color:n="currentColor",size:i=24,strokeWidth:o=2,absoluteStrokeWidth:l,className:u="",children:c,iconNode:h,...d}=e;return(0,r.createElement)("svg",{ref:t,...a,width:i,height:i,stroke:n,strokeWidth:l?24*Number(o)/Number(i):o,className:s("lucide",u),...d},[...h.map(e=>{let[t,n]=e;return(0,r.createElement)(t,n)}),...Array.isArray(c)?c:[c]])}),l=(e,t)=>{let n=(0,r.forwardRef)((n,a)=>{let{className:l,...u}=n;return(0,r.createElement)(o,{ref:a,iconNode:t,className:s("lucide-".concat(i(e)),l),...u})});return n.displayName="".concat(e),n}},3020:(e,t,n)=>{"use strict";n.d(t,{j:()=>uh});var r,i,s,a,o,l,u,c,h,d,p,f,g,m,y,b=n(9928),v="firebase",w="11.2.0";(0,b.KO)(v,w,"app");var _=n(7031),x=n(5125),T=n(3424),I=n(6743),k="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},S={};(function(){function e(){this.blockSize=-1,this.blockSize=64,this.g=[,,,,],this.B=Array(this.blockSize),this.o=this.h=0,this.s()}function t(e,t,n){n||(n=0);var r=Array(16);if("string"==typeof t)for(var i=0;16>i;++i)r[i]=t.charCodeAt(n++)|t.charCodeAt(n++)<<8|t.charCodeAt(n++)<<16|t.charCodeAt(n++)<<24;else for(i=0;16>i;++i)r[i]=t[n++]|t[n++]<<8|t[n++]<<16|t[n++]<<24;t=e.g[0],n=e.g[1],i=e.g[2];var s=e.g[3],a=t+(s^n&(i^s))+r[0]+0xd76aa478&0xffffffff;a=s+(i^(t=n+(a<<7&0xffffffff|a>>>25))&(n^i))+r[1]+0xe8c7b756&0xffffffff,a=i+(n^(s=t+(a<<12&0xffffffff|a>>>20))&(t^n))+r[2]+0x242070db&0xffffffff,a=n+(t^(i=s+(a<<17&0xffffffff|a>>>15))&(s^t))+r[3]+0xc1bdceee&0xffffffff,a=t+(s^(n=i+(a<<22&0xffffffff|a>>>10))&(i^s))+r[4]+0xf57c0faf&0xffffffff,a=s+(i^(t=n+(a<<7&0xffffffff|a>>>25))&(n^i))+r[5]+0x4787c62a&0xffffffff,a=i+(n^(s=t+(a<<12&0xffffffff|a>>>20))&(t^n))+r[6]+0xa8304613&0xffffffff,a=n+(t^(i=s+(a<<17&0xffffffff|a>>>15))&(s^t))+r[7]+0xfd469501&0xffffffff,a=t+(s^(n=i+(a<<22&0xffffffff|a>>>10))&(i^s))+r[8]+0x698098d8&0xffffffff,a=s+(i^(t=n+(a<<7&0xffffffff|a>>>25))&(n^i))+r[9]+0x8b44f7af&0xffffffff,a=i+(n^(s=t+(a<<12&0xffffffff|a>>>20))&(t^n))+r[10]+0xffff5bb1&0xffffffff,a=n+(t^(i=s+(a<<17&0xffffffff|a>>>15))&(s^t))+r[11]+0x895cd7be&0xffffffff,a=t+(s^(n=i+(a<<22&0xffffffff|a>>>10))&(i^s))+r[12]+0x6b901122&0xffffffff,a=s+(i^(t=n+(a<<7&0xffffffff|a>>>25))&(n^i))+r[13]+0xfd987193&0xffffffff,a=i+(n^(s=t+(a<<12&0xffffffff|a>>>20))&(t^n))+r[14]+0xa679438e&0xffffffff,a=n+(t^(i=s+(a<<17&0xffffffff|a>>>15))&(s^t))+r[15]+0x49b40821&0xffffffff,n=i+(a<<22&0xffffffff|a>>>10),a=t+(i^s&(n^i))+r[1]+0xf61e2562&0xffffffff,t=n+(a<<5&0xffffffff|a>>>27),a=s+(n^i&(t^n))+r[6]+0xc040b340&0xffffffff,s=t+(a<<9&0xffffffff|a>>>23),a=i+(t^n&(s^t))+r[11]+0x265e5a51&0xffffffff,i=s+(a<<14&0xffffffff|a>>>18),a=n+(s^t&(i^s))+r[0]+0xe9b6c7aa&0xffffffff,n=i+(a<<20&0xffffffff|a>>>12),a=t+(i^s&(n^i))+r[5]+0xd62f105d&0xffffffff,t=n+(a<<5&0xffffffff|a>>>27),a=s+(n^i&(t^n))+r[10]+0x2441453&0xffffffff,s=t+(a<<9&0xffffffff|a>>>23),a=i+(t^n&(s^t))+r[15]+0xd8a1e681&0xffffffff,i=s+(a<<14&0xffffffff|a>>>18),a=n+(s^t&(i^s))+r[4]+0xe7d3fbc8&0xffffffff,n=i+(a<<20&0xffffffff|a>>>12),a=t+(i^s&(n^i))+r[9]+0x21e1cde6&0xffffffff,t=n+(a<<5&0xffffffff|a>>>27),a=s+(n^i&(t^n))+r[14]+0xc33707d6&0xffffffff,s=t+(a<<9&0xffffffff|a>>>23),a=i+(t^n&(s^t))+r[3]+0xf4d50d87&0xffffffff,i=s+(a<<14&0xffffffff|a>>>18),a=n+(s^t&(i^s))+r[8]+0x455a14ed&0xffffffff,n=i+(a<<20&0xffffffff|a>>>12),a=t+(i^s&(n^i))+r[13]+0xa9e3e905&0xffffffff,t=n+(a<<5&0xffffffff|a>>>27),a=s+(n^i&(t^n))+r[2]+0xfcefa3f8&0xffffffff,s=t+(a<<9&0xffffffff|a>>>23),a=i+(t^n&(s^t))+r[7]+0x676f02d9&0xffffffff,i=s+(a<<14&0xffffffff|a>>>18),a=n+(s^t&(i^s))+r[12]+0x8d2a4c8a&0xffffffff,a=t+((n=i+(a<<20&0xffffffff|a>>>12))^i^s)+r[5]+0xfffa3942&0xffffffff,a=s+((t=n+(a<<4&0xffffffff|a>>>28))^n^i)+r[8]+0x8771f681&0xffffffff,a=i+((s=t+(a<<11&0xffffffff|a>>>21))^t^n)+r[11]+0x6d9d6122&0xffffffff,a=n+((i=s+(a<<16&0xffffffff|a>>>16))^s^t)+r[14]+0xfde5380c&0xffffffff,a=t+((n=i+(a<<23&0xffffffff|a>>>9))^i^s)+r[1]+0xa4beea44&0xffffffff,a=s+((t=n+(a<<4&0xffffffff|a>>>28))^n^i)+r[4]+0x4bdecfa9&0xffffffff,a=i+((s=t+(a<<11&0xffffffff|a>>>21))^t^n)+r[7]+0xf6bb4b60&0xffffffff,a=n+((i=s+(a<<16&0xffffffff|a>>>16))^s^t)+r[10]+0xbebfbc70&0xffffffff,a=t+((n=i+(a<<23&0xffffffff|a>>>9))^i^s)+r[13]+0x289b7ec6&0xffffffff,a=s+((t=n+(a<<4&0xffffffff|a>>>28))^n^i)+r[0]+0xeaa127fa&0xffffffff,a=i+((s=t+(a<<11&0xffffffff|a>>>21))^t^n)+r[3]+0xd4ef3085&0xffffffff,a=n+((i=s+(a<<16&0xffffffff|a>>>16))^s^t)+r[6]+0x4881d05&0xffffffff,a=t+((n=i+(a<<23&0xffffffff|a>>>9))^i^s)+r[9]+0xd9d4d039&0xffffffff,a=s+((t=n+(a<<4&0xffffffff|a>>>28))^n^i)+r[12]+0xe6db99e5&0xffffffff,a=i+((s=t+(a<<11&0xffffffff|a>>>21))^t^n)+r[15]+0x1fa27cf8&0xffffffff,a=n+((i=s+(a<<16&0xffffffff|a>>>16))^s^t)+r[2]+0xc4ac5665&0xffffffff,n=i+(a<<23&0xffffffff|a>>>9),a=t+(i^(n|~s))+r[0]+0xf4292244&0xffffffff,t=n+(a<<6&0xffffffff|a>>>26),a=s+(n^(t|~i))+r[7]+0x432aff97&0xffffffff,s=t+(a<<10&0xffffffff|a>>>22),a=i+(t^(s|~n))+r[14]+0xab9423a7&0xffffffff,i=s+(a<<15&0xffffffff|a>>>17),a=n+(s^(i|~t))+r[5]+0xfc93a039&0xffffffff,n=i+(a<<21&0xffffffff|a>>>11),a=t+(i^(n|~s))+r[12]+0x655b59c3&0xffffffff,t=n+(a<<6&0xffffffff|a>>>26),a=s+(n^(t|~i))+r[3]+0x8f0ccc92&0xffffffff,s=t+(a<<10&0xffffffff|a>>>22),a=i+(t^(s|~n))+r[10]+0xffeff47d&0xffffffff,i=s+(a<<15&0xffffffff|a>>>17),a=n+(s^(i|~t))+r[1]+0x85845dd1&0xffffffff,n=i+(a<<21&0xffffffff|a>>>11),a=t+(i^(n|~s))+r[8]+0x6fa87e4f&0xffffffff,t=n+(a<<6&0xffffffff|a>>>26),a=s+(n^(t|~i))+r[15]+0xfe2ce6e0&0xffffffff,s=t+(a<<10&0xffffffff|a>>>22),a=i+(t^(s|~n))+r[6]+0xa3014314&0xffffffff,i=s+(a<<15&0xffffffff|a>>>17),a=n+(s^(i|~t))+r[13]+0x4e0811a1&0xffffffff,n=i+(a<<21&0xffffffff|a>>>11),a=t+(i^(n|~s))+r[4]+0xf7537e82&0xffffffff,t=n+(a<<6&0xffffffff|a>>>26),a=s+(n^(t|~i))+r[11]+0xbd3af235&0xffffffff,s=t+(a<<10&0xffffffff|a>>>22),a=i+(t^(s|~n))+r[2]+0x2ad7d2bb&0xffffffff,i=s+(a<<15&0xffffffff|a>>>17),a=n+(s^(i|~t))+r[9]+0xeb86d391&0xffffffff,e.g[0]=e.g[0]+t&0xffffffff,e.g[1]=e.g[1]+(i+(a<<21&0xffffffff|a>>>11))&0xffffffff,e.g[2]=e.g[2]+i&0xffffffff,e.g[3]=e.g[3]+s&0xffffffff}function n(e,t){var n=o;return Object.prototype.hasOwnProperty.call(n,e)?n[e]:n[e]=t(e)}function s(e,t){this.h=t;for(var n=[],r=!0,i=e.length-1;0<=i;i--){var s=0|e[i];r&&s==t||(n[i]=s,r=!1)}this.g=n}(function(e,t){function n(){}n.prototype=t.prototype,e.D=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.C=function(e,n,r){for(var i=Array(arguments.length-2),s=2;s<arguments.length;s++)i[s-2]=arguments[s];return t.prototype[n].apply(e,i)}})(e,function(){this.blockSize=-1}),e.prototype.s=function(){this.g[0]=0x67452301,this.g[1]=0xefcdab89,this.g[2]=0x98badcfe,this.g[3]=0x10325476,this.o=this.h=0},e.prototype.u=function(e,n){void 0===n&&(n=e.length);for(var r=n-this.blockSize,i=this.B,s=this.h,a=0;a<n;){if(0==s)for(;a<=r;)t(this,e,a),a+=this.blockSize;if("string"==typeof e){for(;a<n;)if(i[s++]=e.charCodeAt(a++),s==this.blockSize){t(this,i),s=0;break}}else for(;a<n;)if(i[s++]=e[a++],s==this.blockSize){t(this,i),s=0;break}}this.h=s,this.o+=n},e.prototype.v=function(){var e=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);e[0]=128;for(var t=1;t<e.length-8;++t)e[t]=0;var n=8*this.o;for(t=e.length-8;t<e.length;++t)e[t]=255&n,n/=256;for(this.u(e),e=Array(16),t=n=0;4>t;++t)for(var r=0;32>r;r+=8)e[n++]=this.g[t]>>>r&255;return e};var a,o={};function l(e){return -128<=e&&128>e?n(e,function(e){return new s([0|e],0>e?-1:0)}):new s([0|e],0>e?-1:0)}function u(e){if(isNaN(e)||!isFinite(e))return h;if(0>e)return m(u(-e));for(var t=[],n=1,r=0;e>=n;r++)t[r]=e/n|0,n*=0x100000000;return new s(t,0)}function c(e,t){if(0==e.length)throw Error("number format error: empty string");if(2>(t=t||10)||36<t)throw Error("radix out of range: "+t);if("-"==e.charAt(0))return m(c(e.substring(1),t));if(0<=e.indexOf("-"))throw Error('number format error: interior "-" character');for(var n=u(Math.pow(t,8)),r=h,i=0;i<e.length;i+=8){var s=Math.min(8,e.length-i),a=parseInt(e.substring(i,i+s),t);8>s?(s=u(Math.pow(t,s)),r=r.j(s).add(u(a))):r=(r=r.j(n)).add(u(a))}return r}var h=l(0),d=l(1),p=l(0x1000000);function f(e){if(0!=e.h)return!1;for(var t=0;t<e.g.length;t++)if(0!=e.g[t])return!1;return!0}function g(e){return -1==e.h}function m(e){for(var t=e.g.length,n=[],r=0;r<t;r++)n[r]=~e.g[r];return new s(n,~e.h).add(d)}function y(e,t){return e.add(m(t))}function b(e,t){for(;(65535&e[t])!=e[t];)e[t+1]+=e[t]>>>16,e[t]&=65535,t++}function v(e,t){this.g=e,this.h=t}function w(e,t){if(f(t))throw Error("division by zero");if(f(e))return new v(h,h);if(g(e))return t=w(m(e),t),new v(m(t.g),m(t.h));if(g(t))return t=w(e,m(t)),new v(m(t.g),t.h);if(30<e.g.length){if(g(e)||g(t))throw Error("slowDivide_ only works with positive integers.");for(var n=d,r=t;0>=r.l(e);)n=_(n),r=_(r);var i=x(n,1),s=x(r,1);for(r=x(r,2),n=x(n,2);!f(r);){var a=s.add(r);0>=a.l(e)&&(i=i.add(n),s=a),r=x(r,1),n=x(n,1)}return t=y(e,i.j(t)),new v(i,t)}for(i=h;0<=e.l(t);){for(r=48>=(r=Math.ceil(Math.log(n=Math.max(1,Math.floor(e.m()/t.m())))/Math.LN2))?1:Math.pow(2,r-48),a=(s=u(n)).j(t);g(a)||0<a.l(e);)n-=r,a=(s=u(n)).j(t);f(s)&&(s=d),i=i.add(s),e=y(e,a)}return new v(i,e)}function _(e){for(var t=e.g.length+1,n=[],r=0;r<t;r++)n[r]=e.i(r)<<1|e.i(r-1)>>>31;return new s(n,e.h)}function x(e,t){var n=t>>5;t%=32;for(var r=e.g.length-n,i=[],a=0;a<r;a++)i[a]=0<t?e.i(a+n)>>>t|e.i(a+n+1)<<32-t:e.i(a+n);return new s(i,e.h)}(a=s.prototype).m=function(){if(g(this))return-m(this).m();for(var e=0,t=1,n=0;n<this.g.length;n++){var r=this.i(n);e+=(0<=r?r:0x100000000+r)*t,t*=0x100000000}return e},a.toString=function(e){if(2>(e=e||10)||36<e)throw Error("radix out of range: "+e);if(f(this))return"0";if(g(this))return"-"+m(this).toString(e);for(var t=u(Math.pow(e,6)),n=this,r="";;){var i=w(n,t).g,s=((0<(n=y(n,i.j(t))).g.length?n.g[0]:n.h)>>>0).toString(e);if(f(n=i))return s+r;for(;6>s.length;)s="0"+s;r=s+r}},a.i=function(e){return 0>e?0:e<this.g.length?this.g[e]:this.h},a.l=function(e){return g(e=y(this,e))?-1:f(e)?0:1},a.abs=function(){return g(this)?m(this):this},a.add=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],r=0,i=0;i<=t;i++){var a=r+(65535&this.i(i))+(65535&e.i(i)),o=(a>>>16)+(this.i(i)>>>16)+(e.i(i)>>>16);r=o>>>16,a&=65535,o&=65535,n[i]=o<<16|a}return new s(n,-0x80000000&n[n.length-1]?-1:0)},a.j=function(e){if(f(this)||f(e))return h;if(g(this))return g(e)?m(this).j(m(e)):m(m(this).j(e));if(g(e))return m(this.j(m(e)));if(0>this.l(p)&&0>e.l(p))return u(this.m()*e.m());for(var t=this.g.length+e.g.length,n=[],r=0;r<2*t;r++)n[r]=0;for(r=0;r<this.g.length;r++)for(var i=0;i<e.g.length;i++){var a=this.i(r)>>>16,o=65535&this.i(r),l=e.i(i)>>>16,c=65535&e.i(i);n[2*r+2*i]+=o*c,b(n,2*r+2*i),n[2*r+2*i+1]+=a*c,b(n,2*r+2*i+1),n[2*r+2*i+1]+=o*l,b(n,2*r+2*i+1),n[2*r+2*i+2]+=a*l,b(n,2*r+2*i+2)}for(r=0;r<t;r++)n[r]=n[2*r+1]<<16|n[2*r];for(r=t;r<2*t;r++)n[r]=0;return new s(n,0)},a.A=function(e){return w(this,e).h},a.and=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],r=0;r<t;r++)n[r]=this.i(r)&e.i(r);return new s(n,this.h&e.h)},a.or=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],r=0;r<t;r++)n[r]=this.i(r)|e.i(r);return new s(n,this.h|e.h)},a.xor=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],r=0;r<t;r++)n[r]=this.i(r)^e.i(r);return new s(n,this.h^e.h)},e.prototype.digest=e.prototype.v,e.prototype.reset=e.prototype.s,e.prototype.update=e.prototype.u,i=S.Md5=e,s.prototype.add=s.prototype.add,s.prototype.multiply=s.prototype.j,s.prototype.modulo=s.prototype.A,s.prototype.compare=s.prototype.l,s.prototype.toNumber=s.prototype.m,s.prototype.toString=s.prototype.toString,s.prototype.getBits=s.prototype.i,s.fromNumber=u,s.fromString=c,r=S.Integer=s}).apply(void 0!==k?k:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{});var E="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},C={};(function(){var e,t,n="function"==typeof Object.defineProperties?Object.defineProperty:function(e,t,n){return e==Array.prototype||e==Object.prototype||(e[t]=n.value),e},r=function(e){e=["object"==typeof globalThis&&globalThis,e,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof E&&E];for(var t=0;t<e.length;++t){var n=e[t];if(n&&n.Math==Math)return n}throw Error("Cannot find global object")}(this);function i(e,t){e instanceof String&&(e+="");var n=0,r=!1,i={next:function(){if(!r&&n<e.length){var i=n++;return{value:t(i,e[i]),done:!1}}return r=!0,{done:!0,value:void 0}}};return i[Symbol.iterator]=function(){return i},i}!function(e,t){if(t)t:{var i=r;e=e.split(".");for(var s=0;s<e.length-1;s++){var a=e[s];if(!(a in i))break t;i=i[a]}(t=t(s=i[e=e[e.length-1]]))!=s&&null!=t&&n(i,e,{configurable:!0,writable:!0,value:t})}}("Array.prototype.values",function(e){return e||function(){return i(this,function(e,t){return t})}});var f=f||{},g=this||self;function m(e){var t=typeof e;return"array"==(t="object"!=t?t:e?Array.isArray(e)?"array":t:"null")||"object"==t&&"number"==typeof e.length}function y(e){var t=typeof e;return"object"==t&&null!=e||"function"==t}function b(e,t,n){return e.call.apply(e.bind,arguments)}function v(e,t,n){if(!e)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,r),e.apply(t,n)}}return function(){return e.apply(t,arguments)}}function w(e,t,n){return(w=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?b:v).apply(null,arguments)}function _(e,t){var n=Array.prototype.slice.call(arguments,1);return function(){var t=n.slice();return t.push.apply(t,arguments),e.apply(this,t)}}function x(e,t){function n(){}n.prototype=t.prototype,e.aa=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.Qb=function(e,n,r){for(var i=Array(arguments.length-2),s=2;s<arguments.length;s++)i[s-2]=arguments[s];return t.prototype[n].apply(e,i)}}function T(e){let t=e.length;if(0<t){let n=Array(t);for(let r=0;r<t;r++)n[r]=e[r];return n}return[]}function I(e,t){for(let t=1;t<arguments.length;t++){let n=arguments[t];if(m(n)){let t=e.length||0,r=n.length||0;e.length=t+r;for(let i=0;i<r;i++)e[t+i]=n[i]}else e.push(n)}}class k{constructor(e,t){this.i=e,this.j=t,this.h=0,this.g=null}get(){let e;return 0<this.h?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}}function S(e){return/^[\s\xa0]*$/.test(e)}function A(){var e=g.navigator;return e&&(e=e.userAgent)?e:""}function N(e){return N[" "](e),e}N[" "]=function(){};var O=-1!=A().indexOf("Gecko")&&!(-1!=A().toLowerCase().indexOf("webkit")&&-1==A().indexOf("Edge"))&&!(-1!=A().indexOf("Trident")||-1!=A().indexOf("MSIE"))&&-1==A().indexOf("Edge");function $(e,t,n){for(let r in e)t.call(n,e[r],r,e)}function R(e,t){for(let n in e)t.call(void 0,e[n],n,e)}function D(e){let t={};for(let n in e)t[n]=e[n];return t}let F="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function P(e,t){let n,r;for(let t=1;t<arguments.length;t++){for(n in r=arguments[t])e[n]=r[n];for(let t=0;t<F.length;t++)n=F[t],Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}}function M(e){var t=1;e=e.split(":");let n=[];for(;0<t&&e.length;)n.push(e.shift()),t--;return e.length&&n.push(e.join(":")),n}function L(e){g.setTimeout(()=>{throw e},0)}function z(){var e=W;let t=null;return e.g&&(t=e.g,e.g=e.g.next,e.g||(e.h=null),t.next=null),t}class B{constructor(){this.h=this.g=null}add(e,t){let n=U.get();n.set(e,t),this.h?this.h.next=n:this.g=n,this.h=n}}var U=new k(()=>new V,e=>e.reset());class V{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}let j,G=!1,W=new B,q=()=>{let e=g.Promise.resolve(void 0);j=()=>{e.then(H)}};var H=()=>{for(var e;e=z();){try{e.h.call(e.g)}catch(e){L(e)}var t=U;t.j(e),100>t.h&&(t.h++,e.next=t.g,t.g=e)}G=!1};function K(){this.s=this.s,this.C=this.C}function X(e,t){this.type=e,this.g=this.target=t,this.defaultPrevented=!1}K.prototype.s=!1,K.prototype.ma=function(){this.s||(this.s=!0,this.N())},K.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()},X.prototype.h=function(){this.defaultPrevented=!0};var Y=function(){if(!g.addEventListener||!Object.defineProperty)return!1;var e=!1,t=Object.defineProperty({},"passive",{get:function(){e=!0}});try{let e=()=>{};g.addEventListener("test",e,t),g.removeEventListener("test",e,t)}catch(e){}return e}();function Q(e,t){if(X.call(this,e?e.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,e){var n=this.type=e.type,r=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:null;if(this.target=e.target||e.srcElement,this.g=t,t=e.relatedTarget){if(O){t:{try{N(t.nodeName);var i=!0;break t}catch(e){}i=!1}i||(t=null)}}else"mouseover"==n?t=e.fromElement:"mouseout"==n&&(t=e.toElement);this.relatedTarget=t,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==e.clientX?e.clientX:e.pageX,this.clientY=void 0!==e.clientY?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0),this.button=e.button,this.key=e.key||"",this.ctrlKey=e.ctrlKey,this.altKey=e.altKey,this.shiftKey=e.shiftKey,this.metaKey=e.metaKey,this.pointerId=e.pointerId||0,this.pointerType="string"==typeof e.pointerType?e.pointerType:J[e.pointerType]||"",this.state=e.state,this.i=e,e.defaultPrevented&&Q.aa.h.call(this)}}x(Q,X);var J={2:"touch",3:"pen",4:"mouse"};Q.prototype.h=function(){Q.aa.h.call(this);var e=this.i;e.preventDefault?e.preventDefault():e.returnValue=!1};var Z="closure_listenable_"+(1e6*Math.random()|0),ee=0;function et(e,t,n,r,i){this.listener=e,this.proxy=null,this.src=t,this.type=n,this.capture=!!r,this.ha=i,this.key=++ee,this.da=this.fa=!1}function en(e){e.da=!0,e.listener=null,e.proxy=null,e.src=null,e.ha=null}function er(e){this.src=e,this.g={},this.h=0}function ei(e,t){var n=t.type;if(n in e.g){var r,i=e.g[n],s=Array.prototype.indexOf.call(i,t,void 0);(r=0<=s)&&Array.prototype.splice.call(i,s,1),r&&(en(t),0==e.g[n].length&&(delete e.g[n],e.h--))}}function es(e,t,n,r){for(var i=0;i<e.length;++i){var s=e[i];if(!s.da&&s.listener==t&&!!n==s.capture&&s.ha==r)return i}return -1}er.prototype.add=function(e,t,n,r,i){var s=e.toString();(e=this.g[s])||(e=this.g[s]=[],this.h++);var a=es(e,t,r,i);return -1<a?(t=e[a],n||(t.fa=!1)):((t=new et(t,this.src,s,!!r,i)).fa=n,e.push(t)),t};var ea="closure_lm_"+(1e6*Math.random()|0),eo={};function el(e,t,n,r,i){if(r&&r.once)return eh(e,t,n,r,i);if(Array.isArray(t)){for(var s=0;s<t.length;s++)el(e,t[s],n,r,i);return null}return n=eb(n),e&&e[Z]?e.K(t,n,y(r)?!!r.capture:!!r,i):eu(e,t,n,!1,r,i)}function eu(e,t,n,r,i,s){if(!t)throw Error("Invalid event type");var a=y(i)?!!i.capture:!!i,o=em(e);if(o||(e[ea]=o=new er(e)),(n=o.add(t,n,r,a,s)).proxy)return n;if(r=ec(),n.proxy=r,r.src=e,r.listener=n,e.addEventListener)Y||(i=a),void 0===i&&(i=!1),e.addEventListener(t.toString(),r,i);else if(e.attachEvent)e.attachEvent(ef(t.toString()),r);else if(e.addListener&&e.removeListener)e.addListener(r);else throw Error("addEventListener and attachEvent are unavailable.");return n}function ec(){function e(n){return t.call(e.src,e.listener,n)}let t=eg;return e}function eh(e,t,n,r,i){if(Array.isArray(t)){for(var s=0;s<t.length;s++)eh(e,t[s],n,r,i);return null}return n=eb(n),e&&e[Z]?e.L(t,n,y(r)?!!r.capture:!!r,i):eu(e,t,n,!0,r,i)}function ed(e,t,n,r,i){if(Array.isArray(t))for(var s=0;s<t.length;s++)ed(e,t[s],n,r,i);else(r=y(r)?!!r.capture:!!r,n=eb(n),e&&e[Z])?(e=e.i,(t=String(t).toString())in e.g&&-1<(n=es(s=e.g[t],n,r,i))&&(en(s[n]),Array.prototype.splice.call(s,n,1),0==s.length&&(delete e.g[t],e.h--))):e&&(e=em(e))&&(t=e.g[t.toString()],e=-1,t&&(e=es(t,n,r,i)),(n=-1<e?t[e]:null)&&ep(n))}function ep(e){if("number"!=typeof e&&e&&!e.da){var t=e.src;if(t&&t[Z])ei(t.i,e);else{var n=e.type,r=e.proxy;t.removeEventListener?t.removeEventListener(n,r,e.capture):t.detachEvent?t.detachEvent(ef(n),r):t.addListener&&t.removeListener&&t.removeListener(r),(n=em(t))?(ei(n,e),0==n.h&&(n.src=null,t[ea]=null)):en(e)}}}function ef(e){return e in eo?eo[e]:eo[e]="on"+e}function eg(e,t){if(e.da)e=!0;else{t=new Q(t,this);var n=e.listener,r=e.ha||e.src;e.fa&&ep(e),e=n.call(r,t)}return e}function em(e){return(e=e[ea])instanceof er?e:null}var ey="__closure_events_fn_"+(1e9*Math.random()>>>0);function eb(e){return"function"==typeof e?e:(e[ey]||(e[ey]=function(t){return e.handleEvent(t)}),e[ey])}function ev(){K.call(this),this.i=new er(this),this.M=this,this.F=null}function ew(e,t){var n,r=e.F;if(r)for(n=[];r;r=r.F)n.push(r);if(e=e.M,r=t.type||t,"string"==typeof t)t=new X(t,e);else if(t instanceof X)t.target=t.target||e;else{var i=t;P(t=new X(r,e),i)}if(i=!0,n)for(var s=n.length-1;0<=s;s--){var a=t.g=n[s];i=e_(a,r,!0,t)&&i}if(i=e_(a=t.g=e,r,!0,t)&&i,i=e_(a,r,!1,t)&&i,n)for(s=0;s<n.length;s++)i=e_(a=t.g=n[s],r,!1,t)&&i}function e_(e,t,n,r){if(!(t=e.i.g[String(t)]))return!0;t=t.concat();for(var i=!0,s=0;s<t.length;++s){var a=t[s];if(a&&!a.da&&a.capture==n){var o=a.listener,l=a.ha||a.src;a.fa&&ei(e.i,a),i=!1!==o.call(l,r)&&i}}return i&&!r.defaultPrevented}function ex(e,t,n){if("function"==typeof e)n&&(e=w(e,n));else if(e&&"function"==typeof e.handleEvent)e=w(e.handleEvent,e);else throw Error("Invalid listener argument");return 0x7fffffff<Number(t)?-1:g.setTimeout(e,t||0)}function eT(e){e.g=ex(()=>{e.g=null,e.i&&(e.i=!1,eT(e))},e.l);let t=e.h;e.h=null,e.m.apply(null,t)}x(ev,K),ev.prototype[Z]=!0,ev.prototype.removeEventListener=function(e,t,n,r){ed(this,e,t,n,r)},ev.prototype.N=function(){if(ev.aa.N.call(this),this.i){var e,t=this.i;for(e in t.g){for(var n=t.g[e],r=0;r<n.length;r++)en(n[r]);delete t.g[e],t.h--}}this.F=null},ev.prototype.K=function(e,t,n,r){return this.i.add(String(e),t,!1,n,r)},ev.prototype.L=function(e,t,n,r){return this.i.add(String(e),t,!0,n,r)};class eI extends K{constructor(e,t){super(),this.m=e,this.l=t,this.h=null,this.i=!1,this.g=null}j(e){this.h=arguments,this.g?this.i=!0:eT(this)}N(){super.N(),this.g&&(g.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function ek(e){K.call(this),this.h=e,this.g={}}x(ek,K);var eS=[];function eE(e){$(e.g,function(e,t){this.g.hasOwnProperty(t)&&ep(e)},e),e.g={}}ek.prototype.N=function(){ek.aa.N.call(this),eE(this)},ek.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var eC=g.JSON.stringify,eA=g.JSON.parse,eN=class{stringify(e){return g.JSON.stringify(e,void 0)}parse(e){return g.JSON.parse(e,void 0)}};function eO(){}function e$(e){return e.h||(e.h=e.i())}function eR(){}eO.prototype.h=null;var eD={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function eF(){X.call(this,"d")}function eP(){X.call(this,"c")}x(eF,X),x(eP,X);var eM={},eL=null;function ez(){return eL=eL||new ev}function eB(e){X.call(this,eM.La,e)}function eU(e){let t=ez();ew(t,new eB(t))}function eV(e,t){X.call(this,eM.STAT_EVENT,e),this.stat=t}function ej(e){let t=ez();ew(t,new eV(t,e))}function eG(e,t){X.call(this,eM.Ma,e),this.size=t}function eW(e,t){if("function"!=typeof e)throw Error("Fn must not be null and must be a function");return g.setTimeout(function(){e()},t)}function eq(){this.g=!0}function eH(e,t,n,r,i,s){e.info(function(){if(e.g){if(s)for(var a="",o=s.split("&"),l=0;l<o.length;l++){var u=o[l].split("=");if(1<u.length){var c=u[0];u=u[1];var h=c.split("_");a=2<=h.length&&"type"==h[1]?a+(c+"=")+u+"&":a+(c+"=redacted&")}}else a=null}else a=s;return"XMLHTTP REQ ("+r+") [attempt "+i+"]: "+t+"\n"+n+"\n"+a})}function eK(e,t,n,r,i,s,a){e.info(function(){return"XMLHTTP RESP ("+r+") [ attempt "+i+"]: "+t+"\n"+n+"\n"+s+" "+a})}function eX(e,t,n,r){e.info(function(){return"XMLHTTP TEXT ("+t+"): "+eQ(e,n)+(r?" "+r:"")})}function eY(e,t){e.info(function(){return"TIMEOUT: "+t})}function eQ(e,t){if(!e.g)return t;if(!t)return null;try{var n=JSON.parse(t);if(n){for(e=0;e<n.length;e++)if(Array.isArray(n[e])){var r=n[e];if(!(2>r.length)){var i=r[1];if(Array.isArray(i)&&!(1>i.length)){var s=i[0];if("noop"!=s&&"stop"!=s&&"close"!=s)for(var a=1;a<i.length;a++)i[a]=""}}}}return eC(n)}catch(e){return t}}eM.La="serverreachability",x(eB,X),eM.STAT_EVENT="statevent",x(eV,X),eM.Ma="timingevent",x(eG,X),eq.prototype.xa=function(){this.g=!1},eq.prototype.info=function(){};var eJ={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},eZ={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"};function e0(){}function e1(e,t,n,r){this.j=e,this.i=t,this.l=n,this.R=r||1,this.U=new ek(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new e2}function e2(){this.i=null,this.g="",this.h=!1}x(e0,eO),e0.prototype.g=function(){return new XMLHttpRequest},e0.prototype.i=function(){return{}},e=new e0;var e3={},e4={};function e6(e,t,n){e.L=1,e.v=tI(tv(t)),e.m=n,e.P=!0,e5(e,null)}function e5(e,t){e.F=Date.now(),e9(e),e.A=tv(e.v);var n=e.A,r=e.R;Array.isArray(r)||(r=[String(r)]),tM(n.i,"t",r),e.C=0,n=e.j.J,e.h=new e2,e.g=nv(e.j,n?t:null,!e.m),0<e.O&&(e.M=new eI(w(e.Y,e,e.g),e.O)),t=e.U,n=e.g,r=e.ca;var i="readystatechange";Array.isArray(i)||(i&&(eS[0]=i.toString()),i=eS);for(var s=0;s<i.length;s++){var a=el(n,i[s],r||t.handleEvent,!1,t.h||t);if(!a)break;t.g[a.key]=a}t=e.H?D(e.H):{},e.m?(e.u||(e.u="POST"),t["Content-Type"]="application/x-www-form-urlencoded",e.g.ea(e.A,e.u,e.m,t)):(e.u="GET",e.g.ea(e.A,e.u,null,t)),eU(),eH(e.i,e.u,e.A,e.l,e.R,e.m)}function e8(e){return!!e.g&&"GET"==e.u&&2!=e.L&&e.j.Ca}function e7(e,t){var n=e.C,r=t.indexOf("\n",n);return -1==r?e4:isNaN(n=Number(t.substring(n,r)))?e3:(r+=1)+n>t.length?e4:(t=t.slice(r,r+n),e.C=r+n,t)}function e9(e){e.S=Date.now()+e.I,te(e,e.I)}function te(e,t){if(null!=e.B)throw Error("WatchDog timer not null");e.B=eW(w(e.ba,e),t)}function tt(e){e.B&&(g.clearTimeout(e.B),e.B=null)}function tn(e){0==e.j.G||e.J||nf(e.j,e)}function tr(e){tt(e);var t=e.M;t&&"function"==typeof t.ma&&t.ma(),e.M=null,eE(e.U),e.g&&(t=e.g,e.g=null,t.abort(),t.ma())}function ti(e,t){try{var n=e.j;if(0!=n.G&&(n.g==e||tu(n.h,e))){if(!e.K&&tu(n.h,e)&&3==n.G){try{var r=n.Da.g.parse(t)}catch(e){r=null}if(Array.isArray(r)&&3==r.length){var i=r;if(0==i[0]){t:if(!n.u){if(n.g){if(n.g.F+3e3<e.F)np(n),nn(n);else break t}nc(n),ej(18)}}else n.za=i[1],0<n.za-n.T&&37500>i[2]&&n.F&&0==n.v&&!n.C&&(n.C=eW(w(n.Za,n),6e3));if(1>=tl(n.h)&&n.ca){try{n.ca()}catch(e){}n.ca=void 0}}else nm(n,11)}else if((e.K||n.g==e)&&np(n),!S(t))for(i=n.Da.g.parse(t),t=0;t<i.length;t++){let u=i[t];if(n.T=u[0],u=u[1],2==n.G){if("c"==u[0]){n.K=u[1],n.ia=u[2];let t=u[3];null!=t&&(n.la=t,n.j.info("VER="+n.la));let i=u[4];null!=i&&(n.Aa=i,n.j.info("SVER="+n.Aa));let c=u[5];null!=c&&"number"==typeof c&&0<c&&(r=1.5*c,n.L=r,n.j.info("backChannelRequestTimeoutMs_="+r)),r=n;let h=e.g;if(h){let e=h.g?h.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(e){var s=r.h;s.g||-1==e.indexOf("spdy")&&-1==e.indexOf("quic")&&-1==e.indexOf("h2")||(s.j=s.l,s.g=new Set,s.h&&(tc(s,s.h),s.h=null))}if(r.D){let e=h.g?h.g.getResponseHeader("X-HTTP-Session-Id"):null;e&&(r.ya=e,tT(r.I,r.D,e))}}n.G=3,n.l&&n.l.ua(),n.ba&&(n.R=Date.now()-e.F,n.j.info("Handshake RTT: "+n.R+"ms")),r=n;var a=e;if(r.qa=nb(r,r.J?r.ia:null,r.W),a.K){th(r.h,a);var o=a,l=r.L;l&&(o.I=l),o.B&&(tt(o),e9(o)),r.g=a}else nu(r);0<n.i.length&&ni(n)}else"stop"!=u[0]&&"close"!=u[0]||nm(n,7)}else 3==n.G&&("stop"==u[0]||"close"==u[0]?"stop"==u[0]?nm(n,7):nt(n):"noop"!=u[0]&&n.l&&n.l.ta(u),n.v=0)}}eU(4)}catch(e){}}e1.prototype.ca=function(e){e=e.target;let t=this.M;t&&3==t5(e)?t.j():this.Y(e)},e1.prototype.Y=function(e){try{if(e==this.g)t:{let h=t5(this.g);var t=this.g.Ba();let d=this.g.Z();if(!(3>h)&&(3!=h||this.g&&(this.h.h||this.g.oa()||t8(this.g)))){this.J||4!=h||7==t||(8==t||0>=d?eU(3):eU(2)),tt(this);var n=this.g.Z();this.X=n;n:if(e8(this)){var r=t8(this.g);e="";var i=r.length,s=4==t5(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){tr(this),tn(this);var a="";break n}this.h.i=new g.TextDecoder}for(t=0;t<i;t++)this.h.h=!0,e+=this.h.i.decode(r[t],{stream:!(s&&t==i-1)});r.length=0,this.h.g+=e,this.C=0,a=this.h.g}else a=this.g.oa();if(this.o=200==n,eK(this.i,this.u,this.A,this.l,this.R,h,n),this.o){if(this.T&&!this.K){n:{if(this.g){var o,l=this.g;if((o=l.g?l.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!S(o)){var u=o;break n}}u=null}if(n=u)eX(this.i,this.l,n,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,ti(this,n);else{this.o=!1,this.s=3,ej(12),tr(this),tn(this);break t}}if(this.P){let e;for(n=!0;!this.J&&this.C<a.length;)if((e=e7(this,a))==e4){4==h&&(this.s=4,ej(14),n=!1),eX(this.i,this.l,null,"[Incomplete Response]");break}else if(e==e3){this.s=4,ej(15),eX(this.i,this.l,a,"[Invalid Chunk]"),n=!1;break}else eX(this.i,this.l,e,null),ti(this,e);if(e8(this)&&0!=this.C&&(this.h.g=this.h.g.slice(this.C),this.C=0),4!=h||0!=a.length||this.h.h||(this.s=1,ej(16),n=!1),this.o=this.o&&n,n){if(0<a.length&&!this.W){this.W=!0;var c=this.j;c.g==this&&c.ba&&!c.M&&(c.j.info("Great, no buffering proxy detected. Bytes received: "+a.length),nh(c),c.M=!0,ej(11))}}else eX(this.i,this.l,a,"[Invalid Chunked Response]"),tr(this),tn(this)}else eX(this.i,this.l,a,null),ti(this,a);4==h&&tr(this),this.o&&!this.J&&(4==h?nf(this.j,this):(this.o=!1,e9(this)))}else t7(this.g),400==n&&0<a.indexOf("Unknown SID")?(this.s=3,ej(12)):(this.s=0,ej(13)),tr(this),tn(this)}}}catch(e){}finally{}},e1.prototype.cancel=function(){this.J=!0,tr(this)},e1.prototype.ba=function(){this.B=null;let e=Date.now();0<=e-this.S?(eY(this.i,this.A),2!=this.L&&(eU(),ej(17)),tr(this),this.s=2,tn(this)):te(this,this.S-e)};var ts=class{constructor(e,t){this.g=e,this.map=t}};function ta(e){this.l=e||10,e=g.PerformanceNavigationTiming?0<(e=g.performance.getEntriesByType("navigation")).length&&("hq"==e[0].nextHopProtocol||"h2"==e[0].nextHopProtocol):!!(g.chrome&&g.chrome.loadTimes&&g.chrome.loadTimes()&&g.chrome.loadTimes().wasFetchedViaSpdy),this.j=e?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function to(e){return!!e.h||!!e.g&&e.g.size>=e.j}function tl(e){return e.h?1:e.g?e.g.size:0}function tu(e,t){return e.h?e.h==t:!!e.g&&e.g.has(t)}function tc(e,t){e.g?e.g.add(t):e.h=t}function th(e,t){e.h&&e.h==t?e.h=null:e.g&&e.g.has(t)&&e.g.delete(t)}function td(e){if(null!=e.h)return e.i.concat(e.h.D);if(null!=e.g&&0!==e.g.size){let t=e.i;for(let n of e.g.values())t=t.concat(n.D);return t}return T(e.i)}function tp(e){if(e.V&&"function"==typeof e.V)return e.V();if("undefined"!=typeof Map&&e instanceof Map||"undefined"!=typeof Set&&e instanceof Set)return Array.from(e.values());if("string"==typeof e)return e.split("");if(m(e)){for(var t=[],n=e.length,r=0;r<n;r++)t.push(e[r]);return t}for(r in t=[],n=0,e)t[n++]=e[r];return t}function tf(e){if(e.na&&"function"==typeof e.na)return e.na();if(!e.V||"function"!=typeof e.V){if("undefined"!=typeof Map&&e instanceof Map)return Array.from(e.keys());if(!("undefined"!=typeof Set&&e instanceof Set)){if(m(e)||"string"==typeof e){var t=[];e=e.length;for(var n=0;n<e;n++)t.push(n);return t}for(let r in t=[],n=0,e)t[n++]=r;return t}}}function tg(e,t){if(e.forEach&&"function"==typeof e.forEach)e.forEach(t,void 0);else if(m(e)||"string"==typeof e)Array.prototype.forEach.call(e,t,void 0);else for(var n=tf(e),r=tp(e),i=r.length,s=0;s<i;s++)t.call(void 0,r[s],n&&n[s],e)}ta.prototype.cancel=function(){if(this.i=td(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(let e of this.g.values())e.cancel();this.g.clear()}};var tm=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function ty(e,t){if(e){e=e.split("&");for(var n=0;n<e.length;n++){var r=e[n].indexOf("="),i=null;if(0<=r){var s=e[n].substring(0,r);i=e[n].substring(r+1)}else s=e[n];t(s,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}function tb(e){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,e instanceof tb){this.h=e.h,tw(this,e.j),this.o=e.o,this.g=e.g,t_(this,e.s),this.l=e.l;var t=e.i,n=new tR;n.i=t.i,t.g&&(n.g=new Map(t.g),n.h=t.h),tx(this,n),this.m=e.m}else e&&(t=String(e).match(tm))?(this.h=!1,tw(this,t[1]||"",!0),this.o=tk(t[2]||""),this.g=tk(t[3]||"",!0),t_(this,t[4]),this.l=tk(t[5]||"",!0),tx(this,t[6]||"",!0),this.m=tk(t[7]||"")):(this.h=!1,this.i=new tR(null,this.h))}function tv(e){return new tb(e)}function tw(e,t,n){e.j=n?tk(t,!0):t,e.j&&(e.j=e.j.replace(/:$/,""))}function t_(e,t){if(t){if(isNaN(t=Number(t))||0>t)throw Error("Bad port number "+t);e.s=t}else e.s=null}function tx(e,t,n){t instanceof tR?(e.i=t,tz(e.i,e.h)):(n||(t=tS(t,tO)),e.i=new tR(t,e.h))}function tT(e,t,n){e.i.set(t,n)}function tI(e){return tT(e,"zx",Math.floor(0x80000000*Math.random()).toString(36)+Math.abs(Math.floor(0x80000000*Math.random())^Date.now()).toString(36)),e}function tk(e,t){return e?t?decodeURI(e.replace(/%25/g,"%2525")):decodeURIComponent(e):""}function tS(e,t,n){return"string"==typeof e?(e=encodeURI(e).replace(t,tE),n&&(e=e.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),e):null}function tE(e){return"%"+((e=e.charCodeAt(0))>>4&15).toString(16)+(15&e).toString(16)}tb.prototype.toString=function(){var e=[],t=this.j;t&&e.push(tS(t,tC,!0),":");var n=this.g;return(n||"file"==t)&&(e.push("//"),(t=this.o)&&e.push(tS(t,tC,!0),"@"),e.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.s)&&e.push(":",String(n))),(n=this.l)&&(this.g&&"/"!=n.charAt(0)&&e.push("/"),e.push(tS(n,"/"==n.charAt(0)?tN:tA,!0))),(n=this.i.toString())&&e.push("?",n),(n=this.m)&&e.push("#",tS(n,t$)),e.join("")};var tC=/[#\/\?@]/g,tA=/[#\?:]/g,tN=/[#\?]/g,tO=/[#\?@]/g,t$=/#/g;function tR(e,t){this.h=this.g=null,this.i=e||null,this.j=!!t}function tD(e){e.g||(e.g=new Map,e.h=0,e.i&&ty(e.i,function(t,n){e.add(decodeURIComponent(t.replace(/\+/g," ")),n)}))}function tF(e,t){tD(e),t=tL(e,t),e.g.has(t)&&(e.i=null,e.h-=e.g.get(t).length,e.g.delete(t))}function tP(e,t){return tD(e),t=tL(e,t),e.g.has(t)}function tM(e,t,n){tF(e,t),0<n.length&&(e.i=null,e.g.set(tL(e,t),T(n)),e.h+=n.length)}function tL(e,t){return t=String(t),e.j&&(t=t.toLowerCase()),t}function tz(e,t){t&&!e.j&&(tD(e),e.i=null,e.g.forEach(function(e,t){var n=t.toLowerCase();t!=n&&(tF(this,t),tM(this,n,e))},e)),e.j=t}function tB(e,t){let n=new eq;if(g.Image){let r=new Image;r.onload=_(tV,n,"TestLoadImage: loaded",!0,t,r),r.onerror=_(tV,n,"TestLoadImage: error",!1,t,r),r.onabort=_(tV,n,"TestLoadImage: abort",!1,t,r),r.ontimeout=_(tV,n,"TestLoadImage: timeout",!1,t,r),g.setTimeout(function(){r.ontimeout&&r.ontimeout()},1e4),r.src=e}else t(!1)}function tU(e,t){let n=new eq,r=new AbortController,i=setTimeout(()=>{r.abort(),tV(n,"TestPingServer: timeout",!1,t)},1e4);fetch(e,{signal:r.signal}).then(e=>{clearTimeout(i),e.ok?tV(n,"TestPingServer: ok",!0,t):tV(n,"TestPingServer: server error",!1,t)}).catch(()=>{clearTimeout(i),tV(n,"TestPingServer: error",!1,t)})}function tV(e,t,n,r,i){try{i&&(i.onload=null,i.onerror=null,i.onabort=null,i.ontimeout=null),r(n)}catch(e){}}function tj(){this.g=new eN}function tG(e,t,n){let r=n||"";try{tg(e,function(e,n){let i=e;y(e)&&(i=eC(e)),t.push(r+n+"="+encodeURIComponent(i))})}catch(e){throw t.push(r+"type="+encodeURIComponent("_badmap")),e}}function tW(e){this.l=e.Ub||null,this.j=e.eb||!1}function tq(e,t){ev.call(this),this.D=e,this.o=t,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}function tH(e){e.j.read().then(e.Pa.bind(e)).catch(e.ga.bind(e))}function tK(e){e.readyState=4,e.l=null,e.j=null,e.v=null,tX(e)}function tX(e){e.onreadystatechange&&e.onreadystatechange.call(e)}function tY(e){let t="";return $(e,function(e,n){t+=n,t+=":",t+=e,t+="\r\n"}),t}function tQ(e,t,n){t:{for(r in n){var r=!1;break t}r=!0}r||(n=tY(n),"string"==typeof e?null!=n&&encodeURIComponent(String(n)):tT(e,t,n))}function tJ(e){ev.call(this),this.headers=new Map,this.o=e||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}(t=tR.prototype).add=function(e,t){tD(this),this.i=null,e=tL(this,e);var n=this.g.get(e);return n||this.g.set(e,n=[]),n.push(t),this.h+=1,this},t.forEach=function(e,t){tD(this),this.g.forEach(function(n,r){n.forEach(function(n){e.call(t,n,r,this)},this)},this)},t.na=function(){tD(this);let e=Array.from(this.g.values()),t=Array.from(this.g.keys()),n=[];for(let r=0;r<t.length;r++){let i=e[r];for(let e=0;e<i.length;e++)n.push(t[r])}return n},t.V=function(e){tD(this);let t=[];if("string"==typeof e)tP(this,e)&&(t=t.concat(this.g.get(tL(this,e))));else{e=Array.from(this.g.values());for(let n=0;n<e.length;n++)t=t.concat(e[n])}return t},t.set=function(e,t){return tD(this),this.i=null,tP(this,e=tL(this,e))&&(this.h-=this.g.get(e).length),this.g.set(e,[t]),this.h+=1,this},t.get=function(e,t){return e&&0<(e=this.V(e)).length?String(e[0]):t},t.toString=function(){if(this.i)return this.i;if(!this.g)return"";let e=[],t=Array.from(this.g.keys());for(var n=0;n<t.length;n++){var r=t[n];let s=encodeURIComponent(String(r)),a=this.V(r);for(r=0;r<a.length;r++){var i=s;""!==a[r]&&(i+="="+encodeURIComponent(String(a[r]))),e.push(i)}}return this.i=e.join("&")},x(tW,eO),tW.prototype.g=function(){return new tq(this.l,this.j)},tW.prototype.i=function(e){return function(){return e}}({}),x(tq,ev),(t=tq.prototype).open=function(e,t){if(0!=this.readyState)throw this.abort(),Error("Error reopening a connection");this.B=e,this.A=t,this.readyState=1,tX(this)},t.send=function(e){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;let t={headers:this.u,method:this.B,credentials:this.m,cache:void 0};e&&(t.body=e),(this.D||g).fetch(new Request(this.A,t)).then(this.Sa.bind(this),this.ga.bind(this))},t.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,tK(this)),this.readyState=0},t.Sa=function(e){if(this.g&&(this.l=e,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=e.headers,this.readyState=2,tX(this)),this.g&&(this.readyState=3,tX(this),this.g))){if("arraybuffer"===this.responseType)e.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(void 0!==g.ReadableStream&&"body"in e){if(this.j=e.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;tH(this)}else e.text().then(this.Ra.bind(this),this.ga.bind(this))}},t.Pa=function(e){if(this.g){if(this.o&&e.value)this.response.push(e.value);else if(!this.o){var t=e.value?e.value:new Uint8Array(0);(t=this.v.decode(t,{stream:!e.done}))&&(this.response=this.responseText+=t)}e.done?tK(this):tX(this),3==this.readyState&&tH(this)}},t.Ra=function(e){this.g&&(this.response=this.responseText=e,tK(this))},t.Qa=function(e){this.g&&(this.response=e,tK(this))},t.ga=function(){this.g&&tK(this)},t.setRequestHeader=function(e,t){this.u.append(e,t)},t.getResponseHeader=function(e){return this.h&&this.h.get(e.toLowerCase())||""},t.getAllResponseHeaders=function(){if(!this.h)return"";let e=[],t=this.h.entries();for(var n=t.next();!n.done;)e.push((n=n.value)[0]+": "+n[1]),n=t.next();return e.join("\r\n")},Object.defineProperty(tq.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(e){this.m=e?"include":"same-origin"}}),x(tJ,ev);var tZ=/^https?$/i,t0=["POST","PUT"];function t1(e,t){e.h=!1,e.g&&(e.j=!0,e.g.abort(),e.j=!1),e.l=t,e.m=5,t2(e),t4(e)}function t2(e){e.A||(e.A=!0,ew(e,"complete"),ew(e,"error"))}function t3(e){if(e.h&&void 0!==f&&(!e.v[1]||4!=t5(e)||2!=e.Z())){if(e.u&&4==t5(e))ex(e.Ea,0,e);else if(ew(e,"readystatechange"),4==t5(e)){e.h=!1;try{let a=e.Z();switch(a){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var t,n,r=!0;break;default:r=!1}if(!(t=r)){if(n=0===a){var i=String(e.D).match(tm)[1]||null;!i&&g.self&&g.self.location&&(i=g.self.location.protocol.slice(0,-1)),n=!tZ.test(i?i.toLowerCase():"")}t=n}if(t)ew(e,"complete"),ew(e,"success");else{e.m=6;try{var s=2<t5(e)?e.g.statusText:""}catch(e){s=""}e.l=s+" ["+e.Z()+"]",t2(e)}}finally{t4(e)}}}}function t4(e,t){if(e.g){t6(e);let n=e.g,r=e.v[0]?()=>{}:null;e.g=null,e.v=null,t||ew(e,"ready");try{n.onreadystatechange=r}catch(e){}}}function t6(e){e.I&&(g.clearTimeout(e.I),e.I=null)}function t5(e){return e.g?e.g.readyState:0}function t8(e){try{if(!e.g)return null;if("response"in e.g)return e.g.response;switch(e.H){case"":case"text":return e.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in e.g)return e.g.mozResponseArrayBuffer}return null}catch(e){return null}}function t7(e){let t={};e=(e.g&&2<=t5(e)&&e.g.getAllResponseHeaders()||"").split("\r\n");for(let r=0;r<e.length;r++){if(S(e[r]))continue;var n=M(e[r]);let i=n[0];if("string"!=typeof(n=n[1]))continue;n=n.trim();let s=t[i]||[];t[i]=s,s.push(n)}R(t,function(e){return e.join(", ")})}function t9(e,t,n){return n&&n.internalChannelParams&&n.internalChannelParams[e]||t}function ne(e){this.Aa=0,this.i=[],this.j=new eq,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=t9("failFast",!1,e),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=t9("baseRetryDelayMs",5e3,e),this.cb=t9("retryDelaySeedMs",1e4,e),this.Wa=t9("forwardChannelMaxRetries",2,e),this.wa=t9("forwardChannelRequestTimeoutMs",2e4,e),this.pa=e&&e.xmlHttpFactory||void 0,this.Xa=e&&e.Tb||void 0,this.Ca=e&&e.useFetchStreams||!1,this.L=void 0,this.J=e&&e.supportsCrossDomainXhr||!1,this.K="",this.h=new ta(e&&e.concurrentRequestLimit),this.Da=new tj,this.P=e&&e.fastHandshake||!1,this.O=e&&e.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=e&&e.Rb||!1,e&&e.xa&&this.j.xa(),e&&e.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&e&&e.detectBufferingProxy||!1,this.ja=void 0,e&&e.longPollingTimeout&&0<e.longPollingTimeout&&(this.ja=e.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}function nt(e){if(nr(e),3==e.G){var t=e.U++,n=tv(e.I);if(tT(n,"SID",e.K),tT(n,"RID",t),tT(n,"TYPE","terminate"),no(e,n),(t=new e1(e,e.j,t)).L=2,t.v=tI(tv(n)),n=!1,g.navigator&&g.navigator.sendBeacon)try{n=g.navigator.sendBeacon(t.v.toString(),"")}catch(e){}!n&&g.Image&&((new Image).src=t.v,n=!0),n||(t.g=nv(t.j,null),t.g.ea(t.v)),t.F=Date.now(),e9(t)}ny(e)}function nn(e){e.g&&(nh(e),e.g.cancel(),e.g=null)}function nr(e){nn(e),e.u&&(g.clearTimeout(e.u),e.u=null),np(e),e.h.cancel(),e.s&&("number"==typeof e.s&&g.clearTimeout(e.s),e.s=null)}function ni(e){if(!to(e.h)&&!e.s){e.s=!0;var t=e.Ga;j||q(),G||(j(),G=!0),W.add(t,e),e.B=0}}function ns(e,t){return!(tl(e.h)>=e.h.j-(e.s?1:0))&&(e.s?(e.i=t.D.concat(e.i),!0):1!=e.G&&2!=e.G&&!(e.B>=(e.Va?0:e.Wa))&&(e.s=eW(w(e.Ga,e,t),ng(e,e.B)),e.B++,!0))}function na(e,t){var n;n=t?t.l:e.U++;let r=tv(e.I);tT(r,"SID",e.K),tT(r,"RID",n),tT(r,"AID",e.T),no(e,r),e.m&&e.o&&tQ(r,e.m,e.o),n=new e1(e,e.j,n,e.B+1),null===e.m&&(n.H=e.o),t&&(e.i=t.D.concat(e.i)),t=nl(e,n,1e3),n.I=Math.round(.5*e.wa)+Math.round(.5*e.wa*Math.random()),tc(e.h,n),e6(n,r,t)}function no(e,t){e.H&&$(e.H,function(e,n){tT(t,n,e)}),e.l&&tg({},function(e,n){tT(t,n,e)})}function nl(e,t,n){n=Math.min(e.i.length,n);var r=e.l?w(e.l.Na,e.l,e):null;t:{var i=e.i;let t=-1;for(;;){let e=["count="+n];-1==t?0<n?(t=i[0].g,e.push("ofs="+t)):t=0:e.push("ofs="+t);let s=!0;for(let a=0;a<n;a++){let n=i[a].g,o=i[a].map;if(0>(n-=t))t=Math.max(0,i[a].g-100),s=!1;else try{tG(o,e,"req"+n+"_")}catch(e){r&&r(o)}}if(s){r=e.join("&");break t}}}return e=e.i.splice(0,n),t.D=e,r}function nu(e){if(!e.g&&!e.u){e.Y=1;var t=e.Fa;j||q(),G||(j(),G=!0),W.add(t,e),e.v=0}}function nc(e){return!e.g&&!e.u&&!(3<=e.v)&&(e.Y++,e.u=eW(w(e.Fa,e),ng(e,e.v)),e.v++,!0)}function nh(e){null!=e.A&&(g.clearTimeout(e.A),e.A=null)}function nd(e){e.g=new e1(e,e.j,"rpc",e.Y),null===e.m&&(e.g.H=e.o),e.g.O=0;var t=tv(e.qa);tT(t,"RID","rpc"),tT(t,"SID",e.K),tT(t,"AID",e.T),tT(t,"CI",e.F?"0":"1"),!e.F&&e.ja&&tT(t,"TO",e.ja),tT(t,"TYPE","xmlhttp"),no(e,t),e.m&&e.o&&tQ(t,e.m,e.o),e.L&&(e.g.I=e.L);var n=e.g;e=e.ia,n.L=1,n.v=tI(tv(t)),n.m=null,n.P=!0,e5(n,e)}function np(e){null!=e.C&&(g.clearTimeout(e.C),e.C=null)}function nf(e,t){var n=null;if(e.g==t){np(e),nh(e),e.g=null;var r=2}else{if(!tu(e.h,t))return;n=t.D,th(e.h,t),r=1}if(0!=e.G){if(t.o){if(1==r){n=t.m?t.m.length:0,t=Date.now()-t.F;var i=e.B;ew(r=ez(),new eG(r,n)),ni(e)}else nu(e)}else if(3==(i=t.s)||0==i&&0<t.X||!(1==r&&ns(e,t)||2==r&&nc(e)))switch(n&&0<n.length&&((t=e.h).i=t.i.concat(n)),i){case 1:nm(e,5);break;case 4:nm(e,10);break;case 3:nm(e,6);break;default:nm(e,2)}}}function ng(e,t){let n=e.Ta+Math.floor(Math.random()*e.cb);return e.isActive()||(n*=2),n*t}function nm(e,t){if(e.j.info("Error code "+t),2==t){var n=w(e.fb,e),r=e.Xa;let t=!r;r=new tb(r||"//www.google.com/images/cleardot.gif"),g.location&&"http"==g.location.protocol||tw(r,"https"),tI(r),t?tB(r.toString(),n):tU(r.toString(),n)}else ej(2);e.G=0,e.l&&e.l.sa(t),ny(e),nr(e)}function ny(e){if(e.G=0,e.ka=[],e.l){let t=td(e.h);(0!=t.length||0!=e.i.length)&&(I(e.ka,t),I(e.ka,e.i),e.h.i.length=0,T(e.i),e.i.length=0),e.l.ra()}}function nb(e,t,n){var r=n instanceof tb?tv(n):new tb(n);if(""!=r.g)t&&(r.g=t+"."+r.g),t_(r,r.s);else{var i=g.location;r=i.protocol,t=t?t+"."+i.hostname:i.hostname,i=+i.port;var s=new tb(null);r&&tw(s,r),t&&(s.g=t),i&&t_(s,i),n&&(s.l=n),r=s}return n=e.D,t=e.ya,n&&t&&tT(r,n,t),tT(r,"VER",e.la),no(e,r),r}function nv(e,t,n){if(t&&!e.J)throw Error("Can't create secondary domain capable XhrIo object.");return(t=new tJ(e.Ca&&!e.pa?new tW({eb:n}):e.pa)).Ha(e.J),t}function nw(){}function n_(){}function nx(e,t){ev.call(this),this.g=new ne(t),this.l=e,this.h=t&&t.messageUrlParams||null,e=t&&t.messageHeaders||null,t&&t.clientProtocolHeaderRequired&&(e?e["X-Client-Protocol"]="webchannel":e={"X-Client-Protocol":"webchannel"}),this.g.o=e,e=t&&t.initMessageHeaders||null,t&&t.messageContentType&&(e?e["X-WebChannel-Content-Type"]=t.messageContentType:e={"X-WebChannel-Content-Type":t.messageContentType}),t&&t.va&&(e?e["X-WebChannel-Client-Profile"]=t.va:e={"X-WebChannel-Client-Profile":t.va}),this.g.S=e,(e=t&&t.Sb)&&!S(e)&&(this.g.m=e),this.v=t&&t.supportsCrossDomainXhr||!1,this.u=t&&t.sendRawJson||!1,(t=t&&t.httpSessionIdParam)&&!S(t)&&(this.g.D=t,null!==(e=this.h)&&t in e&&t in(e=this.h)&&delete e[t]),this.j=new nk(this)}function nT(e){eF.call(this),e.__headers__&&(this.headers=e.__headers__,this.statusCode=e.__status__,delete e.__headers__,delete e.__status__);var t=e.__sm__;if(t){t:{for(let n in t){e=n;break t}e=void 0}(this.i=e)&&(e=this.i,t=null!==t&&e in t?t[e]:void 0),this.data=t}else this.data=e}function nI(){eP.call(this),this.status=1}function nk(e){this.g=e}(t=tJ.prototype).Ha=function(e){this.J=e},t.ea=function(t,n,r,i){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+t);n=n?n.toUpperCase():"GET",this.D=t,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():e.g(),this.v=this.o?e$(this.o):e$(e),this.g.onreadystatechange=w(this.Ea,this);try{this.B=!0,this.g.open(n,String(t),!0),this.B=!1}catch(e){t1(this,e);return}if(t=r||"",r=new Map(this.headers),i){if(Object.getPrototypeOf(i)===Object.prototype)for(var s in i)r.set(s,i[s]);else if("function"==typeof i.keys&&"function"==typeof i.get)for(let e of i.keys())r.set(e,i.get(e));else throw Error("Unknown input type for opt_headers: "+String(i))}for(let[e,a]of(i=Array.from(r.keys()).find(e=>"content-type"==e.toLowerCase()),s=g.FormData&&t instanceof g.FormData,!(0<=Array.prototype.indexOf.call(t0,n,void 0))||i||s||r.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),r))this.g.setRequestHeader(e,a);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{t6(this),this.u=!0,this.g.send(t),this.u=!1}catch(e){t1(this,e)}},t.abort=function(e){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=e||7,ew(this,"complete"),ew(this,"abort"),t4(this))},t.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),t4(this,!0)),tJ.aa.N.call(this)},t.Ea=function(){this.s||(this.B||this.u||this.j?t3(this):this.bb())},t.bb=function(){t3(this)},t.isActive=function(){return!!this.g},t.Z=function(){try{return 2<t5(this)?this.g.status:-1}catch(e){return -1}},t.oa=function(){try{return this.g?this.g.responseText:""}catch(e){return""}},t.Oa=function(e){if(this.g){var t=this.g.responseText;return e&&0==t.indexOf(e)&&(t=t.substring(e.length)),eA(t)}},t.Ba=function(){return this.m},t.Ka=function(){return"string"==typeof this.l?this.l:String(this.l)},(t=ne.prototype).la=8,t.G=1,t.connect=function(e,t,n,r){ej(0),this.W=e,this.H=t||{},n&&void 0!==r&&(this.H.OSID=n,this.H.OAID=r),this.F=this.X,this.I=nb(this,null,this.W),ni(this)},t.Ga=function(e){if(this.s){if(this.s=null,1==this.G){if(!e){this.U=Math.floor(1e5*Math.random()),e=this.U++;let i=new e1(this,this.j,e),s=this.o;if(this.S&&(s?P(s=D(s),this.S):s=this.S),null!==this.m||this.O||(i.H=s,s=null),this.P)t:{for(var t=0,n=0;n<this.i.length;n++){n:{var r=this.i[n];if("__data__"in r.map&&"string"==typeof(r=r.map.__data__)){r=r.length;break n}r=void 0}if(void 0===r)break;if(4096<(t+=r)){t=n;break t}if(4096===t||n===this.i.length-1){t=n+1;break t}}t=1e3}else t=1e3;t=nl(this,i,t),tT(n=tv(this.I),"RID",e),tT(n,"CVER",22),this.D&&tT(n,"X-HTTP-Session-Id",this.D),no(this,n),s&&(this.O?t="headers="+encodeURIComponent(String(tY(s)))+"&"+t:this.m&&tQ(n,this.m,s)),tc(this.h,i),this.Ua&&tT(n,"TYPE","init"),this.P?(tT(n,"$req",t),tT(n,"SID","null"),i.T=!0,e6(i,n,null)):e6(i,n,t),this.G=2}}else 3==this.G&&(e?na(this,e):0==this.i.length||to(this.h)||na(this))}},t.Fa=function(){if(this.u=null,nd(this),this.ba&&!(this.M||null==this.g||0>=this.R)){var e=2*this.R;this.j.info("BP detection timer enabled: "+e),this.A=eW(w(this.ab,this),e)}},t.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,ej(10),nn(this),nd(this))},t.Za=function(){null!=this.C&&(this.C=null,nn(this),nc(this),ej(19))},t.fb=function(e){e?(this.j.info("Successfully pinged google.com"),ej(2)):(this.j.info("Failed to ping google.com"),ej(1))},t.isActive=function(){return!!this.l&&this.l.isActive(this)},(t=nw.prototype).ua=function(){},t.ta=function(){},t.sa=function(){},t.ra=function(){},t.isActive=function(){return!0},t.Na=function(){},n_.prototype.g=function(e,t){return new nx(e,t)},x(nx,ev),nx.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},nx.prototype.close=function(){nt(this.g)},nx.prototype.o=function(e){var t=this.g;if("string"==typeof e){var n={};n.__data__=e,e=n}else this.u&&((n={}).__data__=eC(e),e=n);t.i.push(new ts(t.Ya++,e)),3==t.G&&ni(t)},nx.prototype.N=function(){this.g.l=null,delete this.j,nt(this.g),delete this.g,nx.aa.N.call(this)},x(nT,eF),x(nI,eP),x(nk,nw),nk.prototype.ua=function(){ew(this.g,"a")},nk.prototype.ta=function(e){ew(this.g,new nT(e))},nk.prototype.sa=function(e){ew(this.g,new nI)},nk.prototype.ra=function(){ew(this.g,"b")},n_.prototype.createWebChannel=n_.prototype.g,nx.prototype.send=nx.prototype.o,nx.prototype.open=nx.prototype.m,nx.prototype.close=nx.prototype.close,p=C.createWebChannelTransport=function(){return new n_},d=C.getStatEventTarget=function(){return ez()},h=C.Event=eM,c=C.Stat={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},eJ.NO_ERROR=0,eJ.TIMEOUT=8,eJ.HTTP_ERROR=6,u=C.ErrorCode=eJ,eZ.COMPLETE="complete",l=C.EventType=eZ,eR.EventType=eD,eD.OPEN="a",eD.CLOSE="b",eD.ERROR="c",eD.MESSAGE="d",ev.prototype.listen=ev.prototype.K,o=C.WebChannel=eR,a=C.FetchXmlHttpFactory=tW,tJ.prototype.listenOnce=tJ.prototype.L,tJ.prototype.getLastError=tJ.prototype.Ka,tJ.prototype.getLastErrorCode=tJ.prototype.Ba,tJ.prototype.getStatus=tJ.prototype.Z,tJ.prototype.getResponseJson=tJ.prototype.Oa,tJ.prototype.getResponseText=tJ.prototype.oa,tJ.prototype.send=tJ.prototype.ea,tJ.prototype.setWithCredentials=tJ.prototype.Ha,s=C.XhrIo=tJ}).apply(void 0!==E?E:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{});var A=n(7836),N=n(8287).hp;let O="@firebase/firestore";class ${constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}$.UNAUTHENTICATED=new $(null),$.GOOGLE_CREDENTIALS=new $("google-credentials-uid"),$.FIRST_PARTY=new $("first-party-uid"),$.MOCK_USER=new $("mock-user");let R="11.2.0",D=new T.Vy("@firebase/firestore");function F(){return D.logLevel}function P(e,...t){if(D.logLevel<=T.$b.DEBUG){let n=t.map(z);D.debug(`Firestore (${R}): ${e}`,...n)}}function M(e,...t){if(D.logLevel<=T.$b.ERROR){let n=t.map(z);D.error(`Firestore (${R}): ${e}`,...n)}}function L(e,...t){if(D.logLevel<=T.$b.WARN){let n=t.map(z);D.warn(`Firestore (${R}): ${e}`,...n)}}function z(e){if("string"==typeof e)return e;try{return function(e){return JSON.stringify(e)}(e)}catch(t){return e}}function B(e="Unexpected state"){let t=`FIRESTORE (${R}) INTERNAL ASSERTION FAILED: `+e;throw M(t),Error(t)}function U(e,t){e||B()}function V(e,t){return e}let j={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class G extends I.g{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class W{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}class q{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class H{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t($.UNAUTHENTICATED))}shutdown(){}}class K{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class X{constructor(e){this.t=e,this.currentUser=$.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){U(void 0===this.o);let n=this.i,r=e=>this.i!==n?(n=this.i,t(e)):Promise.resolve(),i=new W;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new W,e.enqueueRetryable(()=>r(this.currentUser))};let s=()=>{let t=i;e.enqueueRetryable(async()=>{await t.promise,await r(this.currentUser)})},a=e=>{P("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=e,this.o&&(this.auth.addAuthTokenListener(this.o),s())};this.t.onInit(e=>a(e)),setTimeout(()=>{if(!this.auth){let e=this.t.getImmediate({optional:!0});e?a(e):(P("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new W)}},0),s()}getToken(){let e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(t=>this.i!==e?(P("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):t?(U("string"==typeof t.accessToken),new q(t.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){let e=this.auth&&this.auth.getUid();return U(null===e||"string"==typeof e),new $(e)}}class Y{constructor(e,t,n){this.l=e,this.h=t,this.P=n,this.type="FirstParty",this.user=$.FIRST_PARTY,this.T=new Map}I(){return this.P?this.P():null}get headers(){this.T.set("X-Goog-AuthUser",this.l);let e=this.I();return e&&this.T.set("Authorization",e),this.h&&this.T.set("X-Goog-Iam-Authorization-Token",this.h),this.T}}class Q{constructor(e,t,n){this.l=e,this.h=t,this.P=n}getToken(){return Promise.resolve(new Y(this.l,this.h,this.P))}start(e,t){e.enqueueRetryable(()=>t($.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class J{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class Z{constructor(e){this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(e,t){U(void 0===this.o);let n=e=>{null!=e.error&&P("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${e.error.message}`);let n=e.token!==this.R;return this.R=e.token,P("FirebaseAppCheckTokenProvider",`Received ${n?"new":"existing"} token.`),n?t(e.token):Promise.resolve()};this.o=t=>{e.enqueueRetryable(()=>n(t))};let r=e=>{P("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=e,this.o&&this.appCheck.addTokenListener(this.o)};this.A.onInit(e=>r(e)),setTimeout(()=>{if(!this.appCheck){let e=this.A.getImmediate({optional:!0});e?r(e):P("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){let e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(e=>e?(U("string"==typeof e.token),this.R=e.token,new J(e.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}function ee(e){let t="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(e);if(t&&"function"==typeof t.getRandomValues)t.getRandomValues(n);else for(let t=0;t<e;t++)n[t]=Math.floor(256*Math.random());return n}class et{static newId(){let e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length,n="";for(;n.length<20;){let r=ee(40);for(let i=0;i<r.length;++i)n.length<20&&r[i]<t&&(n+=e.charAt(r[i]%e.length))}return n}}function en(e,t){return e<t?-1:e>t?1:0}function er(e,t,n){return e.length===t.length&&e.every((e,r)=>n(e,t[r]))}function ei(e){return e+"\0"}class es{static now(){return es.fromMillis(Date.now())}static fromDate(e){return es.fromMillis(e.getTime())}static fromMillis(e){let t=Math.floor(e/1e3),n=Math.floor(1e6*(e-1e3*t));return new es(t,n)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0||t>=1e9)throw new G(j.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-0xe7791f700||e>=0x3afff44180)throw new G(j.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?en(this.nanoseconds,e.nanoseconds):en(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){return String(this.seconds- -0xe7791f700).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class ea{static fromTimestamp(e){return new ea(e)}static min(){return new ea(new es(0,0))}static max(){return new ea(new es(0x3afff4417f,0x3b9ac9ff))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}class eo{constructor(e,t,n){void 0===t?t=0:t>e.length&&B(),void 0===n?n=e.length-t:n>e.length-t&&B(),this.segments=e,this.offset=t,this.len=n}get length(){return this.len}isEqual(e){return 0===eo.comparator(this,e)}child(e){let t=this.segments.slice(this.offset,this.limit());return e instanceof eo?e.forEach(e=>{t.push(e)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=void 0===e?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){let n=Math.min(e.length,t.length);for(let r=0;r<n;r++){let n=eo.compareSegments(e.get(r),t.get(r));if(0!==n)return n}return Math.sign(e.length-t.length)}static compareSegments(e,t){let n=eo.isNumericId(e),r=eo.isNumericId(t);return n&&!r?-1:!n&&r?1:n&&r?eo.extractNumericId(e).compare(eo.extractNumericId(t)):e<t?-1:e>t?1:0}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return r.fromString(e.substring(4,e.length-2))}}class el extends eo{construct(e,t,n){return new el(e,t,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){let t=[];for(let n of e){if(n.indexOf("//")>=0)throw new G(j.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);t.push(...n.split("/").filter(e=>e.length>0))}return new el(t)}static emptyPath(){return new el([])}}let eu=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class ec extends eo{construct(e,t,n){return new ec(e,t,n)}static isValidIdentifier(e){return eu.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),ec.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new ec(["__name__"])}static fromServerFormat(e){let t=[],n="",r=0,i=()=>{if(0===n.length)throw new G(j.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(n),n=""},s=!1;for(;r<e.length;){let t=e[r];if("\\"===t){if(r+1===e.length)throw new G(j.INVALID_ARGUMENT,"Path has trailing escape character: "+e);let t=e[r+1];if("\\"!==t&&"."!==t&&"`"!==t)throw new G(j.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=t,r+=2}else"`"===t?s=!s:"."!==t||s?n+=t:i(),r++}if(i(),s)throw new G(j.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new ec(t)}static emptyPath(){return new ec([])}}class eh{constructor(e){this.path=e}static fromPath(e){return new eh(el.fromString(e))}static fromName(e){return new eh(el.fromString(e).popFirst(5))}static empty(){return new eh(el.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===el.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return el.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new eh(new el(e.slice()))}}class ed{constructor(e,t,n,r){this.indexId=e,this.collectionGroup=t,this.fields=n,this.indexState=r}}function ep(e){return e.fields.find(e=>2===e.kind)}function ef(e){return e.fields.filter(e=>2!==e.kind)}ed.UNKNOWN_ID=-1;class eg{constructor(e,t){this.fieldPath=e,this.kind=t}}function em(e,t){let n=ec.comparator(e.fieldPath,t.fieldPath);return 0!==n?n:en(e.kind,t.kind)}class ey{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new ey(0,ew.min())}}function eb(e,t){let n=e.toTimestamp().seconds,r=e.toTimestamp().nanoseconds+1;return new ew(ea.fromTimestamp(1e9===r?new es(n+1,0):new es(n,r)),eh.empty(),t)}function ev(e){return new ew(e.readTime,e.key,-1)}class ew{constructor(e,t,n){this.readTime=e,this.documentKey=t,this.largestBatchId=n}static min(){return new ew(ea.min(),eh.empty(),-1)}static max(){return new ew(ea.max(),eh.empty(),-1)}}function e_(e,t){let n=e.readTime.compareTo(t.readTime);return 0!==n?n:0!==(n=eh.comparator(e.documentKey,t.documentKey))?n:en(e.largestBatchId,t.largestBatchId)}let ex="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class eT{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}async function eI(e){if(e.code!==j.FAILED_PRECONDITION||e.message!==ex)throw e;P("LocalStore","Unexpectedly lost primary lease")}class ek{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)},e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&B(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new ek((n,r)=>{this.nextCallback=t=>{this.wrapSuccess(e,t).next(n,r)},this.catchCallback=e=>{this.wrapFailure(t,e).next(n,r)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{let t=e();return t instanceof ek?t:ek.resolve(t)}catch(e){return ek.reject(e)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):ek.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):ek.reject(t)}static resolve(e){return new ek((t,n)=>{t(e)})}static reject(e){return new ek((t,n)=>{n(e)})}static waitFor(e){return new ek((t,n)=>{let r=0,i=0,s=!1;e.forEach(e=>{++r,e.next(()=>{++i,s&&i===r&&t()},e=>n(e))}),s=!0,i===r&&t()})}static or(e){let t=ek.resolve(!1);for(let n of e)t=t.next(e=>e?ek.resolve(e):n());return t}static forEach(e,t){let n=[];return e.forEach((e,r)=>{n.push(t.call(this,e,r))}),this.waitFor(n)}static mapArray(e,t){return new ek((n,r)=>{let i=e.length,s=Array(i),a=0;for(let o=0;o<i;o++){let l=o;t(e[l]).next(e=>{s[l]=e,++a===i&&n(s)},e=>r(e))}})}static doWhile(e,t){return new ek((n,r)=>{let i=()=>{!0===e()?t().next(()=>{i()},r):n()};i()})}}class eS{static open(e,t,n,r){try{return new eS(t,e.transaction(r,n))}catch(e){throw new eN(t,e)}}constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.V=new W,this.transaction.oncomplete=()=>{this.V.resolve()},this.transaction.onabort=()=>{t.error?this.V.reject(new eN(e,t.error)):this.V.resolve()},this.transaction.onerror=t=>{let n=eF(t.target.error);this.V.reject(new eN(e,n))}}get m(){return this.V.promise}abort(e){e&&this.V.reject(e),this.aborted||(P("SimpleDb","Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}g(){let e=this.transaction;this.aborted||"function"!=typeof e.commit||e.commit()}store(e){return new e$(this.transaction.objectStore(e))}}class eE{static delete(e){return P("SimpleDb","Removing database:",e),eR(window.indexedDB.deleteDatabase(e)).toPromise()}static p(){if(!(0,I.zW)())return!1;if(eE.S())return!0;let e=(0,I.ZQ)(),t=eE.D(e),n=0<t&&t<10,r=eC(e),i=0<r&&r<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||n||i)}static S(){var e;return void 0!==A&&"YES"===(null===(e=A.__PRIVATE_env)||void 0===e?void 0:e.v)}static C(e,t){return e.store(t)}static D(e){let t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i);return Number(t?t[1].split("_").slice(0,2).join("."):"-1")}constructor(e,t,n){this.name=e,this.version=t,this.F=n,12.2===eE.D((0,I.ZQ)())&&M("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}async M(e){return this.db||(P("SimpleDb","Opening database:",this.name),this.db=await new Promise((t,n)=>{let r=indexedDB.open(this.name,this.version);r.onsuccess=e=>{t(e.target.result)},r.onblocked=()=>{n(new eN(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},r.onerror=t=>{let r=t.target.error;"VersionError"===r.name?n(new G(j.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):"InvalidStateError"===r.name?n(new G(j.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+r)):n(new eN(e,r))},r.onupgradeneeded=e=>{P("SimpleDb",'Database "'+this.name+'" requires upgrade from version:',e.oldVersion);let t=e.target.result;this.F.O(t,r.transaction,e.oldVersion,this.version).next(()=>{P("SimpleDb","Database upgrade to version "+this.version+" complete")})}})),this.N&&(this.db.onversionchange=e=>this.N(e)),this.db}B(e){this.N=e,this.db&&(this.db.onversionchange=t=>e(t))}async runTransaction(e,t,n,r){let i="readonly"===t,s=0;for(;;){++s;try{this.db=await this.M(e);let t=eS.open(this.db,e,i?"readonly":"readwrite",n),s=r(t).next(e=>(t.g(),e)).catch(e=>(t.abort(e),ek.reject(e))).toPromise();return s.catch(()=>{}),await t.m,s}catch(n){let e=n,t="FirebaseError"!==e.name&&s<3;if(P("SimpleDb","Transaction failed with error:",e.message,"Retrying:",t),this.close(),!t)return Promise.reject(e)}}}close(){this.db&&this.db.close(),this.db=void 0}}function eC(e){let t=e.match(/Android ([\d.]+)/i);return Number(t?t[1].split(".").slice(0,2).join("."):"-1")}class eA{constructor(e){this.L=e,this.k=!1,this.q=null}get isDone(){return this.k}get K(){return this.q}set cursor(e){this.L=e}done(){this.k=!0}$(e){this.q=e}delete(){return eR(this.L.delete())}}class eN extends G{constructor(e,t){super(j.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function eO(e){return"IndexedDbTransactionError"===e.name}class e${constructor(e){this.store=e}put(e,t){let n;return void 0!==t?(P("SimpleDb","PUT",this.store.name,e,t),n=this.store.put(t,e)):(P("SimpleDb","PUT",this.store.name,"<auto-key>",e),n=this.store.put(e)),eR(n)}add(e){return P("SimpleDb","ADD",this.store.name,e,e),eR(this.store.add(e))}get(e){return eR(this.store.get(e)).next(t=>(void 0===t&&(t=null),P("SimpleDb","GET",this.store.name,e,t),t))}delete(e){return P("SimpleDb","DELETE",this.store.name,e),eR(this.store.delete(e))}count(){return P("SimpleDb","COUNT",this.store.name),eR(this.store.count())}U(e,t){let n=this.options(e,t),r=n.index?this.store.index(n.index):this.store;if("function"==typeof r.getAll){let e=r.getAll(n.range);return new ek((t,n)=>{e.onerror=e=>{n(e.target.error)},e.onsuccess=e=>{t(e.target.result)}})}{let e=this.cursor(n),t=[];return this.W(e,(e,n)=>{t.push(n)}).next(()=>t)}}G(e,t){let n=this.store.getAll(e,null===t?void 0:t);return new ek((e,t)=>{n.onerror=e=>{t(e.target.error)},n.onsuccess=t=>{e(t.target.result)}})}j(e,t){P("SimpleDb","DELETE ALL",this.store.name);let n=this.options(e,t);n.H=!1;let r=this.cursor(n);return this.W(r,(e,t,n)=>n.delete())}J(e,t){let n;t?n=e:(n={},t=e);let r=this.cursor(n);return this.W(r,t)}Y(e){let t=this.cursor({});return new ek((n,r)=>{t.onerror=e=>{r(eF(e.target.error))},t.onsuccess=t=>{let r=t.target.result;r?e(r.primaryKey,r.value).next(e=>{e?r.continue():n()}):n()}})}W(e,t){let n=[];return new ek((r,i)=>{e.onerror=e=>{i(e.target.error)},e.onsuccess=e=>{let i=e.target.result;if(!i)return void r();let s=new eA(i),a=t(i.primaryKey,i.value,s);if(a instanceof ek){let e=a.catch(e=>(s.done(),ek.reject(e)));n.push(e)}s.isDone?r():null===s.K?i.continue():i.continue(s.K)}}).next(()=>ek.waitFor(n))}options(e,t){let n;return void 0!==e&&("string"==typeof e?n=e:t=e),{index:n,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){let n=this.store.index(e.index);return e.H?n.openKeyCursor(e.range,t):n.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function eR(e){return new ek((t,n)=>{e.onsuccess=e=>{t(e.target.result)},e.onerror=e=>{n(eF(e.target.error))}})}let eD=!1;function eF(e){let t=eE.D((0,I.ZQ)());if(t>=12.2&&t<13){let t="An internal error was encountered in the Indexed Database server";if(e.message.indexOf(t)>=0){let e=new G("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return eD||(eD=!0,setTimeout(()=>{throw e},0)),e}}return e}class eP{constructor(e,t){this.asyncQueue=e,this.Z=t,this.task=null}start(){this.X(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return null!==this.task}X(e){P("IndexBackfiller",`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,async()=>{this.task=null;try{P("IndexBackfiller",`Documents written: ${await this.Z.ee()}`)}catch(e){eO(e)?P("IndexBackfiller","Ignoring IndexedDB error during index backfill: ",e):await eI(e)}await this.X(6e4)})}}class eM{constructor(e,t){this.localStore=e,this.persistence=t}async ee(e=50){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",t=>this.te(t,e))}te(e,t){let n=new Set,r=t,i=!0;return ek.doWhile(()=>!0===i&&r>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(t=>{if(null!==t&&!n.has(t))return P("IndexBackfiller",`Processing collection: ${t}`),this.ne(e,t,r).next(e=>{r-=e,n.add(t)});i=!1})).next(()=>t-r)}ne(e,t,n){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(r=>this.localStore.localDocuments.getNextDocuments(e,t,r,n).next(n=>{let i=n.changes;return this.localStore.indexManager.updateIndexEntries(e,i).next(()=>this.re(r,n)).next(n=>(P("IndexBackfiller",`Updating offset: ${n}`),this.localStore.indexManager.updateCollectionGroup(e,t,n))).next(()=>i.size)}))}re(e,t){let n=e;return t.changes.forEach((e,t)=>{let r=ev(t);e_(r,n)>0&&(n=r)}),new ew(n.readTime,n.documentKey,Math.max(t.batchId,e.largestBatchId))}}class eL{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=e=>this.ie(e),this.se=e=>t.writeSequenceNumber(e))}ie(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){let e=++this.previousValue;return this.se&&this.se(e),e}}function ez(e){return null==e}function eB(e){return 0===e&&1/e==-1/0}function eU(e){return"number"==typeof e&&Number.isInteger(e)&&!eB(e)&&e<=Number.MAX_SAFE_INTEGER&&e>=Number.MIN_SAFE_INTEGER}function eV(e){let t="";for(let n=0;n<e.length;n++)t.length>0&&(t=eG(t)),t=ej(e.get(n),t);return eG(t)}function ej(e,t){let n=t,r=e.length;for(let t=0;t<r;t++){let r=e.charAt(t);switch(r){case"\0":n+="\x01\x10";break;case"\x01":n+="\x01\x11";break;default:n+=r}}return n}function eG(e){return e+"\x01\x01"}function eW(e){let t=e.length;if(U(t>=2),2===t)return U("\x01"===e.charAt(0)&&"\x01"===e.charAt(1)),el.emptyPath();let n=t-2,r=[],i="";for(let s=0;s<t;){let t=e.indexOf("\x01",s);switch((t<0||t>n)&&B(),e.charAt(t+1)){case"\x01":let a;let o=e.substring(s,t);0===i.length?a=o:(i+=o,a=i,i=""),r.push(a);break;case"\x10":i+=e.substring(s,t),i+="\0";break;case"\x11":i+=e.substring(s,t+1);break;default:B()}s=t+2}return new el(r)}eL.oe=-1;let eq=["userId","batchId"];function eH(e,t){return[e,eV(t)]}function eK(e,t,n){return[e,eV(t),n]}let eX={},eY=["prefixPath","collectionGroup","readTime","documentId"],eQ=["prefixPath","collectionGroup","documentId"],eJ=["collectionGroup","readTime","prefixPath","documentId"],eZ=["canonicalId","targetId"],e0=["targetId","path"],e1=["path","targetId"],e2=["collectionId","parent"],e3=["indexId","uid"],e4=["uid","sequenceNumber"],e6=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],e5=["indexId","uid","orderedDocumentKey"],e8=["userId","collectionPath","documentId"],e7=["userId","collectionPath","largestBatchId"],e9=["userId","collectionGroup","largestBatchId"],te=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],tt=[...te,"documentOverlays"],tn=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],tr=tn,ti=[...tr,"indexConfiguration","indexState","indexEntries"],ts=ti,ta=[...ti,"globals"];class to extends eT{constructor(e,t){super(),this._e=e,this.currentSequenceNumber=t}}function tl(e,t){let n=V(e);return eE.C(n._e,t)}function tu(e){let t=0;for(let n in e)Object.prototype.hasOwnProperty.call(e,n)&&t++;return t}function tc(e,t){for(let n in e)Object.prototype.hasOwnProperty.call(e,n)&&t(n,e[n])}function th(e){for(let t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}class td{constructor(e,t){this.comparator=e,this.root=t||tf.EMPTY}insert(e,t){return new td(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,tf.BLACK,null,null))}remove(e){return new td(this.comparator,this.root.remove(e,this.comparator).copy(null,null,tf.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){let n=this.comparator(e,t.key);if(0===n)return t.value;n<0?t=t.left:n>0&&(t=t.right)}return null}indexOf(e){let t=0,n=this.root;for(;!n.isEmpty();){let r=this.comparator(e,n.key);if(0===r)return t+n.left.size;r<0?n=n.left:(t+=n.left.size+1,n=n.right)}return -1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,n)=>(e(t,n),!1))}toString(){let e=[];return this.inorderTraversal((t,n)=>(e.push(`${t}:${n}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new tp(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new tp(this.root,e,this.comparator,!1)}getReverseIterator(){return new tp(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new tp(this.root,e,this.comparator,!0)}}class tp{constructor(e,t,n,r){this.isReverse=r,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?n(e.key,t):1,t&&r&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(0===i){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop(),t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;let e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class tf{constructor(e,t,n,r,i){this.key=e,this.value=t,this.color=null!=n?n:tf.RED,this.left=null!=r?r:tf.EMPTY,this.right=null!=i?i:tf.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,n,r,i){return new tf(null!=e?e:this.key,null!=t?t:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let r=this,i=n(e,r.key);return(r=i<0?r.copy(null,null,null,r.left.insert(e,t,n),null):0===i?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,n))).fixUp()}removeMin(){if(this.left.isEmpty())return tf.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),(e=e.copy(null,null,null,e.left.removeMin(),null)).fixUp()}remove(e,t){let n,r=this;if(0>t(e,r.key))r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(e,t),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),0===t(e,r.key)){if(r.right.isEmpty())return tf.EMPTY;n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(e,t))}return r.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=(e=(e=e.copy(null,null,null,null,e.right.rotateRight())).rotateLeft()).colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=(e=e.rotateRight()).colorFlip()),e}rotateLeft(){let e=this.copy(null,null,tf.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){let e=this.copy(null,null,tf.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){let e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){return Math.pow(2,this.check())<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw B();let e=this.left.check();if(e!==this.right.check())throw B();return e+(this.isRed()?0:1)}}tf.EMPTY=null,tf.RED=!0,tf.BLACK=!1,tf.EMPTY=new class{constructor(){this.size=0}get key(){throw B()}get value(){throw B()}get color(){throw B()}get left(){throw B()}get right(){throw B()}copy(e,t,n,r,i){return this}insert(e,t,n){return new tf(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class tg{constructor(e){this.comparator=e,this.data=new td(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,n)=>(e(t),!1))}forEachInRange(e,t){let n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){let r=n.getNext();if(this.comparator(r.key,e[1])>=0)return;t(r.key)}}forEachWhile(e,t){let n;for(n=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){let t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new tm(this.data.getIterator())}getIteratorFrom(e){return new tm(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(e=>{t=t.add(e)}),t}isEqual(e){if(!(e instanceof tg)||this.size!==e.size)return!1;let t=this.data.getIterator(),n=e.data.getIterator();for(;t.hasNext();){let e=t.getNext().key,r=n.getNext().key;if(0!==this.comparator(e,r))return!1}return!0}toArray(){let e=[];return this.forEach(t=>{e.push(t)}),e}toString(){let e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){let t=new tg(this.comparator);return t.data=e,t}}class tm{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function ty(e){return e.hasNext()?e.getNext():void 0}class tb{constructor(e){this.fields=e,e.sort(ec.comparator)}static empty(){return new tb([])}unionWith(e){let t=new tg(ec.comparator);for(let e of this.fields)t=t.add(e);for(let n of e)t=t.add(n);return new tb(t.toArray())}covers(e){for(let t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return er(this.fields,e.fields,(e,t)=>e.isEqual(t))}}class tv extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class tw{constructor(e){this.binaryString=e}static fromBase64String(e){return new tw(function(e){try{return atob(e)}catch(e){throw"undefined"!=typeof DOMException&&e instanceof DOMException?new tv("Invalid base64 string: "+e):e}}(e))}static fromUint8Array(e){return new tw(function(e){let t="";for(let n=0;n<e.length;++n)t+=String.fromCharCode(e[n]);return t}(e))}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(e){return btoa(e)}(this.binaryString)}toUint8Array(){return function(e){let t=new Uint8Array(e.length);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return en(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}tw.EMPTY_BYTE_STRING=new tw("");let t_=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function tx(e){if(U(!!e),"string"==typeof e){let t=0,n=t_.exec(e);if(U(!!n),n[1]){let e=n[1];t=Number(e=(e+"000000000").substr(0,9))}return{seconds:Math.floor(new Date(e).getTime()/1e3),nanos:t}}return{seconds:tT(e.seconds),nanos:tT(e.nanos)}}function tT(e){return"number"==typeof e?e:"string"==typeof e?Number(e):0}function tI(e){return"string"==typeof e?tw.fromBase64String(e):tw.fromUint8Array(e)}function tk(e){var t,n;return"server_timestamp"===(null===(n=((null===(t=null==e?void 0:e.mapValue)||void 0===t?void 0:t.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function tS(e){let t=e.mapValue.fields.__previous_value__;return tk(t)?tS(t):t}function tE(e){let t=tx(e.mapValue.fields.__local_write_time__.timestampValue);return new es(t.seconds,t.nanos)}class tC{constructor(e,t,n,r,i,s,a,o,l){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=r,this.ssl=i,this.forceLongPolling=s,this.autoDetectLongPolling=a,this.longPollingOptions=o,this.useFetchStreams=l}}class tA{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new tA("","")}get isDefaultDatabase(){return"(default)"===this.database}isEqual(e){return e instanceof tA&&e.projectId===this.projectId&&e.database===this.database}}let tN={mapValue:{fields:{__type__:{stringValue:"__max__"}}}},tO={nullValue:"NULL_VALUE"};function t$(e){return"nullValue"in e?0:"booleanValue"in e?1:"integerValue"in e||"doubleValue"in e?2:"timestampValue"in e?3:"stringValue"in e?5:"bytesValue"in e?6:"referenceValue"in e?7:"geoPointValue"in e?8:"arrayValue"in e?9:"mapValue"in e?tk(e)?4:tX(e)?0x1fffffffffffff:tH(e)?10:11:B()}function tR(e,t){if(e===t)return!0;let n=t$(e);if(n!==t$(t))return!1;switch(n){case 0:case 0x1fffffffffffff:return!0;case 1:return e.booleanValue===t.booleanValue;case 4:return tE(e).isEqual(tE(t));case 3:return function(e,t){if("string"==typeof e.timestampValue&&"string"==typeof t.timestampValue&&e.timestampValue.length===t.timestampValue.length)return e.timestampValue===t.timestampValue;let n=tx(e.timestampValue),r=tx(t.timestampValue);return n.seconds===r.seconds&&n.nanos===r.nanos}(e,t);case 5:return e.stringValue===t.stringValue;case 6:return function(e,t){return tI(e.bytesValue).isEqual(tI(t.bytesValue))}(e,t);case 7:return e.referenceValue===t.referenceValue;case 8:return function(e,t){return tT(e.geoPointValue.latitude)===tT(t.geoPointValue.latitude)&&tT(e.geoPointValue.longitude)===tT(t.geoPointValue.longitude)}(e,t);case 2:return function(e,t){if("integerValue"in e&&"integerValue"in t)return tT(e.integerValue)===tT(t.integerValue);if("doubleValue"in e&&"doubleValue"in t){let n=tT(e.doubleValue),r=tT(t.doubleValue);return n===r?eB(n)===eB(r):isNaN(n)&&isNaN(r)}return!1}(e,t);case 9:return er(e.arrayValue.values||[],t.arrayValue.values||[],tR);case 10:case 11:return function(e,t){let n=e.mapValue.fields||{},r=t.mapValue.fields||{};if(tu(n)!==tu(r))return!1;for(let e in n)if(n.hasOwnProperty(e)&&(void 0===r[e]||!tR(n[e],r[e])))return!1;return!0}(e,t);default:return B()}}function tD(e,t){return void 0!==(e.values||[]).find(e=>tR(e,t))}function tF(e,t){if(e===t)return 0;let n=t$(e),r=t$(t);if(n!==r)return en(n,r);switch(n){case 0:case 0x1fffffffffffff:return 0;case 1:return en(e.booleanValue,t.booleanValue);case 2:return function(e,t){let n=tT(e.integerValue||e.doubleValue),r=tT(t.integerValue||t.doubleValue);return n<r?-1:n>r?1:n===r?0:isNaN(n)?isNaN(r)?0:-1:1}(e,t);case 3:return tP(e.timestampValue,t.timestampValue);case 4:return tP(tE(e),tE(t));case 5:return en(e.stringValue,t.stringValue);case 6:return function(e,t){let n=tI(e),r=tI(t);return n.compareTo(r)}(e.bytesValue,t.bytesValue);case 7:return function(e,t){let n=e.split("/"),r=t.split("/");for(let e=0;e<n.length&&e<r.length;e++){let t=en(n[e],r[e]);if(0!==t)return t}return en(n.length,r.length)}(e.referenceValue,t.referenceValue);case 8:return function(e,t){let n=en(tT(e.latitude),tT(t.latitude));return 0!==n?n:en(tT(e.longitude),tT(t.longitude))}(e.geoPointValue,t.geoPointValue);case 9:return tM(e.arrayValue,t.arrayValue);case 10:return function(e,t){var n,r,i,s;let a=e.fields||{},o=t.fields||{},l=null===(n=a.value)||void 0===n?void 0:n.arrayValue,u=null===(r=o.value)||void 0===r?void 0:r.arrayValue,c=en((null===(i=null==l?void 0:l.values)||void 0===i?void 0:i.length)||0,(null===(s=null==u?void 0:u.values)||void 0===s?void 0:s.length)||0);return 0!==c?c:tM(l,u)}(e.mapValue,t.mapValue);case 11:return function(e,t){if(e===tN.mapValue&&t===tN.mapValue)return 0;if(e===tN.mapValue)return 1;if(t===tN.mapValue)return -1;let n=e.fields||{},r=Object.keys(n),i=t.fields||{},s=Object.keys(i);r.sort(),s.sort();for(let e=0;e<r.length&&e<s.length;++e){let t=en(r[e],s[e]);if(0!==t)return t;let a=tF(n[r[e]],i[s[e]]);if(0!==a)return a}return en(r.length,s.length)}(e.mapValue,t.mapValue);default:throw B()}}function tP(e,t){if("string"==typeof e&&"string"==typeof t&&e.length===t.length)return en(e,t);let n=tx(e),r=tx(t),i=en(n.seconds,r.seconds);return 0!==i?i:en(n.nanos,r.nanos)}function tM(e,t){let n=e.values||[],r=t.values||[];for(let e=0;e<n.length&&e<r.length;++e){let t=tF(n[e],r[e]);if(t)return t}return en(n.length,r.length)}function tL(e){return tz(e)}function tz(e){return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?function(e){let t=tx(e);return`time(${t.seconds},${t.nanos})`}(e.timestampValue):"stringValue"in e?e.stringValue:"bytesValue"in e?function(e){return tI(e).toBase64()}(e.bytesValue):"referenceValue"in e?function(e){return eh.fromName(e).toString()}(e.referenceValue):"geoPointValue"in e?function(e){return`geo(${e.latitude},${e.longitude})`}(e.geoPointValue):"arrayValue"in e?function(e){let t="[",n=!0;for(let r of e.values||[])n?n=!1:t+=",",t+=tz(r);return t+"]"}(e.arrayValue):"mapValue"in e?function(e){let t=Object.keys(e.fields||{}).sort(),n="{",r=!0;for(let i of t)r?r=!1:n+=",",n+=`${i}:${tz(e.fields[i])}`;return n+"}"}(e.mapValue):B()}function tB(e){switch(t$(e)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:let t=tS(e);return t?16+tB(t):16;case 5:return 2*e.stringValue.length;case 6:return tI(e.bytesValue).approximateByteSize();case 7:return e.referenceValue.length;case 9:return function(e){return(e.values||[]).reduce((e,t)=>e+tB(t),0)}(e.arrayValue);case 10:case 11:return function(e){let t=0;return tc(e.fields,(e,n)=>{t+=e.length+tB(n)}),t}(e.mapValue);default:throw B()}}function tU(e,t){return{referenceValue:`projects/${e.projectId}/databases/${e.database}/documents/${t.path.canonicalString()}`}}function tV(e){return!!e&&"integerValue"in e}function tj(e){return!!e&&"arrayValue"in e}function tG(e){return!!e&&"nullValue"in e}function tW(e){return!!e&&"doubleValue"in e&&isNaN(Number(e.doubleValue))}function tq(e){return!!e&&"mapValue"in e}function tH(e){var t,n;return"__vector__"===(null===(n=((null===(t=null==e?void 0:e.mapValue)||void 0===t?void 0:t.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function tK(e){if(e.geoPointValue)return{geoPointValue:Object.assign({},e.geoPointValue)};if(e.timestampValue&&"object"==typeof e.timestampValue)return{timestampValue:Object.assign({},e.timestampValue)};if(e.mapValue){let t={mapValue:{fields:{}}};return tc(e.mapValue.fields,(e,n)=>t.mapValue.fields[e]=tK(n)),t}if(e.arrayValue){let t={arrayValue:{values:[]}};for(let n=0;n<(e.arrayValue.values||[]).length;++n)t.arrayValue.values[n]=tK(e.arrayValue.values[n]);return t}return Object.assign({},e)}function tX(e){return"__max__"===(((e.mapValue||{}).fields||{}).__type__||{}).stringValue}let tY={mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{}}}}};function tQ(e){return"nullValue"in e?tO:"booleanValue"in e?{booleanValue:!1}:"integerValue"in e||"doubleValue"in e?{doubleValue:NaN}:"timestampValue"in e?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in e?{stringValue:""}:"bytesValue"in e?{bytesValue:""}:"referenceValue"in e?tU(tA.empty(),eh.empty()):"geoPointValue"in e?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in e?{arrayValue:{}}:"mapValue"in e?tH(e)?tY:{mapValue:{}}:B()}function tJ(e){return"nullValue"in e?{booleanValue:!1}:"booleanValue"in e?{doubleValue:NaN}:"integerValue"in e||"doubleValue"in e?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in e?{stringValue:""}:"stringValue"in e?{bytesValue:""}:"bytesValue"in e?tU(tA.empty(),eh.empty()):"referenceValue"in e?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in e?{arrayValue:{}}:"arrayValue"in e?tY:"mapValue"in e?tH(e)?{mapValue:{}}:tN:B()}function tZ(e,t){let n=tF(e.value,t.value);return 0!==n?n:e.inclusive&&!t.inclusive?-1:!e.inclusive&&t.inclusive?1:0}function t0(e,t){let n=tF(e.value,t.value);return 0!==n?n:e.inclusive&&!t.inclusive?1:!e.inclusive&&t.inclusive?-1:0}class t1{constructor(e){this.value=e}static empty(){return new t1({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let n=0;n<e.length-1;++n)if(!tq(t=(t.mapValue.fields||{})[e.get(n)]))return null;return(t=(t.mapValue.fields||{})[e.lastSegment()])||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=tK(t)}setAll(e){let t=ec.emptyPath(),n={},r=[];e.forEach((e,i)=>{if(!t.isImmediateParentOf(i)){let e=this.getFieldsMap(t);this.applyChanges(e,n,r),n={},r=[],t=i.popLast()}e?n[i.lastSegment()]=tK(e):r.push(i.lastSegment())});let i=this.getFieldsMap(t);this.applyChanges(i,n,r)}delete(e){let t=this.field(e.popLast());tq(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return tR(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let n=0;n<e.length;++n){let r=t.mapValue.fields[e.get(n)];tq(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},t.mapValue.fields[e.get(n)]=r),t=r}return t.mapValue.fields}applyChanges(e,t,n){for(let r of(tc(t,(t,n)=>e[t]=n),n))delete e[r]}clone(){return new t1(tK(this.value))}}function t2(e){let t=[];return tc(e.fields,(e,n)=>{let r=new ec([e]);if(tq(n)){let e=t2(n.mapValue).fields;if(0===e.length)t.push(r);else for(let n of e)t.push(r.child(n))}else t.push(r)}),new tb(t)}class t3{constructor(e,t,n,r,i,s,a){this.key=e,this.documentType=t,this.version=n,this.readTime=r,this.createTime=i,this.data=s,this.documentState=a}static newInvalidDocument(e){return new t3(e,0,ea.min(),ea.min(),ea.min(),t1.empty(),0)}static newFoundDocument(e,t,n,r){return new t3(e,1,t,ea.min(),n,r,0)}static newNoDocument(e,t){return new t3(e,2,t,ea.min(),ea.min(),t1.empty(),0)}static newUnknownDocument(e,t){return new t3(e,3,t,ea.min(),ea.min(),t1.empty(),2)}convertToFoundDocument(e,t){return this.createTime.isEqual(ea.min())&&(2===this.documentType||0===this.documentType)&&(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=t1.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=t1.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=ea.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof t3&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new t3(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class t4{constructor(e,t){this.position=e,this.inclusive=t}}function t6(e,t,n){let r=0;for(let i=0;i<e.position.length;i++){let s=t[i],a=e.position[i];if(r=s.field.isKeyField()?eh.comparator(eh.fromName(a.referenceValue),n.key):tF(a,n.data.field(s.field)),"desc"===s.dir&&(r*=-1),0!==r)break}return r}function t5(e,t){if(null===e)return null===t;if(null===t||e.inclusive!==t.inclusive||e.position.length!==t.position.length)return!1;for(let n=0;n<e.position.length;n++)if(!tR(e.position[n],t.position[n]))return!1;return!0}class t8{constructor(e,t="asc"){this.field=e,this.dir=t}}function t7(e,t){return e.dir===t.dir&&e.field.isEqual(t.field)}class t9{}class ne extends t9{constructor(e,t,n){super(),this.field=e,this.op=t,this.value=n}static create(e,t,n){return e.isKeyField()?"in"===t||"not-in"===t?this.createKeyFieldInFilter(e,t,n):new nc(e,t,n):"array-contains"===t?new nf(e,n):"in"===t?new ng(e,n):"not-in"===t?new nm(e,n):"array-contains-any"===t?new ny(e,n):new ne(e,t,n)}static createKeyFieldInFilter(e,t,n){return"in"===t?new nh(e,n):new nd(e,n)}matches(e){let t=e.data.field(this.field);return"!="===this.op?null!==t&&this.matchesComparison(tF(t,this.value)):null!==t&&t$(this.value)===t$(t)&&this.matchesComparison(tF(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return B()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class nt extends t9{constructor(e,t){super(),this.filters=e,this.op=t,this.ae=null}static create(e,t){return new nt(e,t)}matches(e){return nn(this)?void 0===this.filters.find(t=>!t.matches(e)):void 0!==this.filters.find(t=>t.matches(e))}getFlattenedFilters(){return null!==this.ae||(this.ae=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.ae}getFilters(){return Object.assign([],this.filters)}}function nn(e){return"and"===e.op}function nr(e){return"or"===e.op}function ni(e){return ns(e)&&nn(e)}function ns(e){for(let t of e.filters)if(t instanceof nt)return!1;return!0}function na(e){if(e instanceof ne)return e.field.canonicalString()+e.op.toString()+tL(e.value);if(ni(e))return e.filters.map(e=>na(e)).join(",");{let t=e.filters.map(e=>na(e)).join(",");return`${e.op}(${t})`}}function no(e,t){return e instanceof ne?function(e,t){return t instanceof ne&&e.op===t.op&&e.field.isEqual(t.field)&&tR(e.value,t.value)}(e,t):e instanceof nt?function(e,t){return t instanceof nt&&e.op===t.op&&e.filters.length===t.filters.length&&e.filters.reduce((e,n,r)=>e&&no(n,t.filters[r]),!0)}(e,t):void B()}function nl(e,t){let n=e.filters.concat(t);return nt.create(n,e.op)}function nu(e){return e instanceof ne?function(e){return`${e.field.canonicalString()} ${e.op} ${tL(e.value)}`}(e):e instanceof nt?function(e){return e.op.toString()+" {"+e.getFilters().map(nu).join(" ,")+"}"}(e):"Filter"}class nc extends ne{constructor(e,t,n){super(e,t,n),this.key=eh.fromName(n.referenceValue)}matches(e){let t=eh.comparator(e.key,this.key);return this.matchesComparison(t)}}class nh extends ne{constructor(e,t){super(e,"in",t),this.keys=np("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class nd extends ne{constructor(e,t){super(e,"not-in",t),this.keys=np("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function np(e,t){var n;return((null===(n=t.arrayValue)||void 0===n?void 0:n.values)||[]).map(e=>eh.fromName(e.referenceValue))}class nf extends ne{constructor(e,t){super(e,"array-contains",t)}matches(e){let t=e.data.field(this.field);return tj(t)&&tD(t.arrayValue,this.value)}}class ng extends ne{constructor(e,t){super(e,"in",t)}matches(e){let t=e.data.field(this.field);return null!==t&&tD(this.value.arrayValue,t)}}class nm extends ne{constructor(e,t){super(e,"not-in",t)}matches(e){if(tD(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;let t=e.data.field(this.field);return null!==t&&!tD(this.value.arrayValue,t)}}class ny extends ne{constructor(e,t){super(e,"array-contains-any",t)}matches(e){let t=e.data.field(this.field);return!(!tj(t)||!t.arrayValue.values)&&t.arrayValue.values.some(e=>tD(this.value.arrayValue,e))}}class nb{constructor(e,t=null,n=[],r=[],i=null,s=null,a=null){this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=s,this.endAt=a,this.ue=null}}function nv(e,t=null,n=[],r=[],i=null,s=null,a=null){return new nb(e,t,n,r,i,s,a)}function nw(e){let t=V(e);if(null===t.ue){let e=t.path.canonicalString();null!==t.collectionGroup&&(e+="|cg:"+t.collectionGroup),e+="|f:",e+=t.filters.map(e=>na(e)).join(","),e+="|ob:",e+=t.orderBy.map(e=>(function(e){return e.field.canonicalString()+e.dir})(e)).join(","),ez(t.limit)||(e+="|l:",e+=t.limit),t.startAt&&(e+="|lb:",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map(e=>tL(e)).join(",")),t.endAt&&(e+="|ub:",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map(e=>tL(e)).join(",")),t.ue=e}return t.ue}function n_(e,t){if(e.limit!==t.limit||e.orderBy.length!==t.orderBy.length)return!1;for(let n=0;n<e.orderBy.length;n++)if(!t7(e.orderBy[n],t.orderBy[n]))return!1;if(e.filters.length!==t.filters.length)return!1;for(let n=0;n<e.filters.length;n++)if(!no(e.filters[n],t.filters[n]))return!1;return e.collectionGroup===t.collectionGroup&&!!e.path.isEqual(t.path)&&!!t5(e.startAt,t.startAt)&&t5(e.endAt,t.endAt)}function nx(e){return eh.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}function nT(e,t){return e.filters.filter(e=>e instanceof ne&&e.field.isEqual(t))}function nI(e,t,n){let r=tO,i=!0;for(let n of nT(e,t)){let e=tO,t=!0;switch(n.op){case"<":case"<=":e=tQ(n.value);break;case"==":case"in":case">=":e=n.value;break;case">":e=n.value,t=!1;break;case"!=":case"not-in":e=tO}0>tZ({value:r,inclusive:i},{value:e,inclusive:t})&&(r=e,i=t)}if(null!==n){for(let s=0;s<e.orderBy.length;++s)if(e.orderBy[s].field.isEqual(t)){let e=n.position[s];0>tZ({value:r,inclusive:i},{value:e,inclusive:n.inclusive})&&(r=e,i=n.inclusive);break}}return{value:r,inclusive:i}}function nk(e,t,n){let r=tN,i=!0;for(let n of nT(e,t)){let e=tN,t=!0;switch(n.op){case">=":case">":e=tJ(n.value),t=!1;break;case"==":case"in":case"<=":e=n.value;break;case"<":e=n.value,t=!1;break;case"!=":case"not-in":e=tN}t0({value:r,inclusive:i},{value:e,inclusive:t})>0&&(r=e,i=t)}if(null!==n){for(let s=0;s<e.orderBy.length;++s)if(e.orderBy[s].field.isEqual(t)){let e=n.position[s];t0({value:r,inclusive:i},{value:e,inclusive:n.inclusive})>0&&(r=e,i=n.inclusive);break}}return{value:r,inclusive:i}}class nS{constructor(e,t=null,n=[],r=[],i=null,s="F",a=null,o=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=r,this.limit=i,this.limitType=s,this.startAt=a,this.endAt=o,this.ce=null,this.le=null,this.he=null,this.startAt,this.endAt}}function nE(e,t,n,r,i,s,a,o){return new nS(e,t,n,r,i,s,a,o)}function nC(e){return new nS(e)}function nA(e){return 0===e.filters.length&&null===e.limit&&null==e.startAt&&null==e.endAt&&(0===e.explicitOrderBy.length||1===e.explicitOrderBy.length&&e.explicitOrderBy[0].field.isKeyField())}function nN(e){return null!==e.collectionGroup}function nO(e){let t=V(e);if(null===t.ce){t.ce=[];let e=new Set;for(let n of t.explicitOrderBy)t.ce.push(n),e.add(n.field.canonicalString());let n=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc";(function(e){let t=new tg(ec.comparator);return e.filters.forEach(e=>{e.getFlattenedFilters().forEach(e=>{e.isInequality()&&(t=t.add(e.field))})}),t})(t).forEach(r=>{e.has(r.canonicalString())||r.isKeyField()||t.ce.push(new t8(r,n))}),e.has(ec.keyField().canonicalString())||t.ce.push(new t8(ec.keyField(),n))}return t.ce}function n$(e){let t=V(e);return t.le||(t.le=nD(t,nO(e))),t.le}function nR(e){let t=V(e);return t.he||(t.he=nD(t,e.explicitOrderBy)),t.he}function nD(e,t){if("F"===e.limitType)return nv(e.path,e.collectionGroup,t,e.filters,e.limit,e.startAt,e.endAt);{t=t.map(e=>{let t="desc"===e.dir?"asc":"desc";return new t8(e.field,t)});let n=e.endAt?new t4(e.endAt.position,e.endAt.inclusive):null,r=e.startAt?new t4(e.startAt.position,e.startAt.inclusive):null;return nv(e.path,e.collectionGroup,t,e.filters,e.limit,n,r)}}function nF(e,t){let n=e.filters.concat([t]);return new nS(e.path,e.collectionGroup,e.explicitOrderBy.slice(),n,e.limit,e.limitType,e.startAt,e.endAt)}function nP(e,t,n){return new nS(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,n,e.startAt,e.endAt)}function nM(e,t){return n_(n$(e),n$(t))&&e.limitType===t.limitType}function nL(e){return`${nw(n$(e))}|lt:${e.limitType}`}function nz(e){return`Query(target=${function(e){let t=e.path.canonicalString();return null!==e.collectionGroup&&(t+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(t+=`, filters: [${e.filters.map(e=>nu(e)).join(", ")}]`),ez(e.limit)||(t+=", limit: "+e.limit),e.orderBy.length>0&&(t+=`, orderBy: [${e.orderBy.map(e=>(function(e){return`${e.field.canonicalString()} (${e.dir})`})(e)).join(", ")}]`),e.startAt&&(t+=", startAt: ",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(e=>tL(e)).join(",")),e.endAt&&(t+=", endAt: ",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(e=>tL(e)).join(",")),`Target(${t})`}(n$(e))}; limitType=${e.limitType})`}function nB(e,t){return t.isFoundDocument()&&function(e,t){let n=t.key.path;return null!==e.collectionGroup?t.key.hasCollectionId(e.collectionGroup)&&e.path.isPrefixOf(n):eh.isDocumentKey(e.path)?e.path.isEqual(n):e.path.isImmediateParentOf(n)}(e,t)&&function(e,t){for(let n of nO(e))if(!n.field.isKeyField()&&null===t.data.field(n.field))return!1;return!0}(e,t)&&function(e,t){for(let n of e.filters)if(!n.matches(t))return!1;return!0}(e,t)&&function(e,t){return(!e.startAt||!!function(e,t,n){let r=t6(e,t,n);return e.inclusive?r<=0:r<0}(e.startAt,nO(e),t))&&(!e.endAt||!!function(e,t,n){let r=t6(e,t,n);return e.inclusive?r>=0:r>0}(e.endAt,nO(e),t))}(e,t)}function nU(e){return e.collectionGroup||(e.path.length%2==1?e.path.lastSegment():e.path.get(e.path.length-2))}function nV(e){return(t,n)=>{let r=!1;for(let i of nO(e)){let e=nj(i,t,n);if(0!==e)return e;r=r||i.field.isKeyField()}return 0}}function nj(e,t,n){let r=e.field.isKeyField()?eh.comparator(t.key,n.key):function(e,t,n){let r=t.data.field(e),i=n.data.field(e);return null!==r&&null!==i?tF(r,i):B()}(e.field,t,n);switch(e.dir){case"asc":return r;case"desc":return -1*r;default:return B()}}class nG{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){let t=this.mapKeyFn(e),n=this.inner[t];if(void 0!==n){for(let[t,r]of n)if(this.equalsFn(t,e))return r}}has(e){return void 0!==this.get(e)}set(e,t){let n=this.mapKeyFn(e),r=this.inner[n];if(void 0===r)return this.inner[n]=[[e,t]],void this.innerSize++;for(let n=0;n<r.length;n++)if(this.equalsFn(r[n][0],e))return void(r[n]=[e,t]);r.push([e,t]),this.innerSize++}delete(e){let t=this.mapKeyFn(e),n=this.inner[t];if(void 0===n)return!1;for(let r=0;r<n.length;r++)if(this.equalsFn(n[r][0],e))return 1===n.length?delete this.inner[t]:n.splice(r,1),this.innerSize--,!0;return!1}forEach(e){tc(this.inner,(t,n)=>{for(let[t,r]of n)e(t,r)})}isEmpty(){return th(this.inner)}size(){return this.innerSize}}let nW=new td(eh.comparator);function nq(){return nW}let nH=new td(eh.comparator);function nK(...e){let t=nH;for(let n of e)t=t.insert(n.key,n);return t}function nX(e){let t=nH;return e.forEach((e,n)=>t=t.insert(e,n.overlayedDocument)),t}function nY(){return nJ()}function nQ(){return nJ()}function nJ(){return new nG(e=>e.toString(),(e,t)=>e.isEqual(t))}let nZ=new td(eh.comparator),n0=new tg(eh.comparator);function n1(...e){let t=n0;for(let n of e)t=t.add(n);return t}let n2=new tg(en);function n3(){return n2}function n4(e,t){if(e.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:eB(t)?"-0":t}}function n6(e){return{integerValue:""+e}}function n5(e,t){return eU(t)?n6(t):n4(e,t)}class n8{constructor(){this._=void 0}}function n7(e,t,n){return e instanceof rt?function(e,t){let n={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:e.seconds,nanos:e.nanoseconds}}}};return t&&tk(t)&&(t=tS(t)),t&&(n.fields.__previous_value__=t),{mapValue:n}}(n,t):e instanceof rn?rr(e,t):e instanceof ri?rs(e,t):function(e,t){let n=re(e,t),r=ro(n)+ro(e.Pe);return tV(n)&&tV(e.Pe)?n6(r):n4(e.serializer,r)}(e,t)}function n9(e,t,n){return e instanceof rn?rr(e,t):e instanceof ri?rs(e,t):n}function re(e,t){return e instanceof ra?!function(e){return tV(e)||function(e){return!!e&&"doubleValue"in e}(e)}(t)?{integerValue:0}:t:null}class rt extends n8{}class rn extends n8{constructor(e){super(),this.elements=e}}function rr(e,t){let n=rl(t);for(let t of e.elements)n.some(e=>tR(e,t))||n.push(t);return{arrayValue:{values:n}}}class ri extends n8{constructor(e){super(),this.elements=e}}function rs(e,t){let n=rl(t);for(let t of e.elements)n=n.filter(e=>!tR(e,t));return{arrayValue:{values:n}}}class ra extends n8{constructor(e,t){super(),this.serializer=e,this.Pe=t}}function ro(e){return tT(e.integerValue||e.doubleValue)}function rl(e){return tj(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}class ru{constructor(e,t){this.field=e,this.transform=t}}function rc(e,t){return e.field.isEqual(t.field)&&function(e,t){return e instanceof rn&&t instanceof rn||e instanceof ri&&t instanceof ri?er(e.elements,t.elements,tR):e instanceof ra&&t instanceof ra?tR(e.Pe,t.Pe):e instanceof rt&&t instanceof rt}(e.transform,t.transform)}class rh{constructor(e,t){this.version=e,this.transformResults=t}}class rd{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new rd}static exists(e){return new rd(void 0,e)}static updateTime(e){return new rd(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function rp(e,t){return void 0!==e.updateTime?t.isFoundDocument()&&t.version.isEqual(e.updateTime):void 0===e.exists||e.exists===t.isFoundDocument()}class rf{}function rg(e,t){if(!e.hasLocalMutations||t&&0===t.fields.length)return null;if(null===t)return e.isNoDocument()?new rk(e.key,rd.none()):new rw(e.key,e.data,rd.none());{let n=e.data,r=t1.empty(),i=new tg(ec.comparator);for(let e of t.fields)if(!i.has(e)){let t=n.field(e);null===t&&e.length>1&&(e=e.popLast(),t=n.field(e)),null===t?r.delete(e):r.set(e,t),i=i.add(e)}return new r_(e.key,r,new tb(i.toArray()),rd.none())}}function rm(e,t,n){e instanceof rw?function(e,t,n){let r=e.value.clone(),i=rT(e.fieldTransforms,t,n.transformResults);r.setAll(i),t.convertToFoundDocument(n.version,r).setHasCommittedMutations()}(e,t,n):e instanceof r_?function(e,t,n){if(!rp(e.precondition,t))return void t.convertToUnknownDocument(n.version);let r=rT(e.fieldTransforms,t,n.transformResults),i=t.data;i.setAll(rx(e)),i.setAll(r),t.convertToFoundDocument(n.version,i).setHasCommittedMutations()}(e,t,n):function(e,t,n){t.convertToNoDocument(n.version).setHasCommittedMutations()}(0,t,n)}function ry(e,t,n,r){return e instanceof rw?function(e,t,n,r){if(!rp(e.precondition,t))return n;let i=e.value.clone(),s=rI(e.fieldTransforms,r,t);return i.setAll(s),t.convertToFoundDocument(t.version,i).setHasLocalMutations(),null}(e,t,n,r):e instanceof r_?function(e,t,n,r){if(!rp(e.precondition,t))return n;let i=rI(e.fieldTransforms,r,t),s=t.data;return(s.setAll(rx(e)),s.setAll(i),t.convertToFoundDocument(t.version,s).setHasLocalMutations(),null===n)?null:n.unionWith(e.fieldMask.fields).unionWith(e.fieldTransforms.map(e=>e.field))}(e,t,n,r):function(e,t,n){return rp(e.precondition,t)?(t.convertToNoDocument(t.version).setHasLocalMutations(),null):n}(e,t,n)}function rb(e,t){let n=null;for(let r of e.fieldTransforms){let e=t.data.field(r.field),i=re(r.transform,e||null);null!=i&&(null===n&&(n=t1.empty()),n.set(r.field,i))}return n||null}function rv(e,t){return e.type===t.type&&!!e.key.isEqual(t.key)&&!!e.precondition.isEqual(t.precondition)&&!!function(e,t){return void 0===e&&void 0===t||!(!e||!t)&&er(e,t,(e,t)=>rc(e,t))}(e.fieldTransforms,t.fieldTransforms)&&(0===e.type?e.value.isEqual(t.value):1!==e.type||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask))}class rw extends rf{constructor(e,t,n,r=[]){super(),this.key=e,this.value=t,this.precondition=n,this.fieldTransforms=r,this.type=0}getFieldMask(){return null}}class r_ extends rf{constructor(e,t,n,r,i=[]){super(),this.key=e,this.data=t,this.fieldMask=n,this.precondition=r,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function rx(e){let t=new Map;return e.fieldMask.fields.forEach(n=>{if(!n.isEmpty()){let r=e.data.field(n);t.set(n,r)}}),t}function rT(e,t,n){let r=new Map;U(e.length===n.length);for(let i=0;i<n.length;i++){let s=e[i],a=s.transform,o=t.data.field(s.field);r.set(s.field,n9(a,o,n[i]))}return r}function rI(e,t,n){let r=new Map;for(let i of e){let e=i.transform,s=n.data.field(i.field);r.set(i.field,n7(e,s,t))}return r}class rk extends rf{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class rS extends rf{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class rE{constructor(e,t,n,r){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,this.mutations=r}applyToRemoteDocument(e,t){let n=t.mutationResults;for(let t=0;t<this.mutations.length;t++){let r=this.mutations[t];r.key.isEqual(e.key)&&rm(r,e,n[t])}}applyToLocalView(e,t){for(let n of this.baseMutations)n.key.isEqual(e.key)&&(t=ry(n,e,t,this.localWriteTime));for(let n of this.mutations)n.key.isEqual(e.key)&&(t=ry(n,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){let n=nQ();return this.mutations.forEach(r=>{let i=e.get(r.key),s=i.overlayedDocument,a=this.applyToLocalView(s,i.mutatedFields),o=rg(s,a=t.has(r.key)?null:a);null!==o&&n.set(r.key,o),s.isValidDocument()||s.convertToNoDocument(ea.min())}),n}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),n1())}isEqual(e){return this.batchId===e.batchId&&er(this.mutations,e.mutations,(e,t)=>rv(e,t))&&er(this.baseMutations,e.baseMutations,(e,t)=>rv(e,t))}}class rC{constructor(e,t,n,r){this.batch=e,this.commitVersion=t,this.mutationResults=n,this.docVersions=r}static from(e,t,n){U(e.mutations.length===n.length);let r=nZ,i=e.mutations;for(let e=0;e<i.length;e++)r=r.insert(i[e].key,n[e].version);return new rC(e,t,n,r)}}class rA{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}class rN{constructor(e,t){this.count=e,this.unchangedNames=t}}function rO(e){switch(e){default:return B();case j.CANCELLED:case j.UNKNOWN:case j.DEADLINE_EXCEEDED:case j.RESOURCE_EXHAUSTED:case j.INTERNAL:case j.UNAVAILABLE:case j.UNAUTHENTICATED:return!1;case j.INVALID_ARGUMENT:case j.NOT_FOUND:case j.ALREADY_EXISTS:case j.PERMISSION_DENIED:case j.FAILED_PRECONDITION:case j.ABORTED:case j.OUT_OF_RANGE:case j.UNIMPLEMENTED:case j.DATA_LOSS:return!0}}function r$(e){if(void 0===e)return M("GRPC error has no .code"),j.UNKNOWN;switch(e){case f.OK:return j.OK;case f.CANCELLED:return j.CANCELLED;case f.UNKNOWN:return j.UNKNOWN;case f.DEADLINE_EXCEEDED:return j.DEADLINE_EXCEEDED;case f.RESOURCE_EXHAUSTED:return j.RESOURCE_EXHAUSTED;case f.INTERNAL:return j.INTERNAL;case f.UNAVAILABLE:return j.UNAVAILABLE;case f.UNAUTHENTICATED:return j.UNAUTHENTICATED;case f.INVALID_ARGUMENT:return j.INVALID_ARGUMENT;case f.NOT_FOUND:return j.NOT_FOUND;case f.ALREADY_EXISTS:return j.ALREADY_EXISTS;case f.PERMISSION_DENIED:return j.PERMISSION_DENIED;case f.FAILED_PRECONDITION:return j.FAILED_PRECONDITION;case f.ABORTED:return j.ABORTED;case f.OUT_OF_RANGE:return j.OUT_OF_RANGE;case f.UNIMPLEMENTED:return j.UNIMPLEMENTED;case f.DATA_LOSS:return j.DATA_LOSS;default:return B()}}(g=f||(f={}))[g.OK=0]="OK",g[g.CANCELLED=1]="CANCELLED",g[g.UNKNOWN=2]="UNKNOWN",g[g.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",g[g.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",g[g.NOT_FOUND=5]="NOT_FOUND",g[g.ALREADY_EXISTS=6]="ALREADY_EXISTS",g[g.PERMISSION_DENIED=7]="PERMISSION_DENIED",g[g.UNAUTHENTICATED=16]="UNAUTHENTICATED",g[g.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",g[g.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",g[g.ABORTED=10]="ABORTED",g[g.OUT_OF_RANGE=11]="OUT_OF_RANGE",g[g.UNIMPLEMENTED=12]="UNIMPLEMENTED",g[g.INTERNAL=13]="INTERNAL",g[g.UNAVAILABLE=14]="UNAVAILABLE",g[g.DATA_LOSS=15]="DATA_LOSS";let rR=null;function rD(){return new TextEncoder}let rF=new r([0xffffffff,0xffffffff],0);function rP(e){let t=rD().encode(e),n=new i;return n.update(t),new Uint8Array(n.digest())}function rM(e){let t=new DataView(e.buffer),n=t.getUint32(0,!0),i=t.getUint32(4,!0),s=t.getUint32(8,!0),a=t.getUint32(12,!0);return[new r([n,i],0),new r([s,a],0)]}class rL{constructor(e,t,n){if(this.bitmap=e,this.padding=t,this.hashCount=n,t<0||t>=8)throw new rz(`Invalid padding: ${t}`);if(n<0||e.length>0&&0===this.hashCount)throw new rz(`Invalid hash count: ${n}`);if(0===e.length&&0!==t)throw new rz(`Invalid padding when bitmap length is 0: ${t}`);this.Te=8*e.length-t,this.Ie=r.fromNumber(this.Te)}de(e,t,n){let i=e.add(t.multiply(r.fromNumber(n)));return 1===i.compare(rF)&&(i=new r([i.getBits(0),i.getBits(1)],0)),i.modulo(this.Ie).toNumber()}Ee(e){return 0!=(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(0===this.Te)return!1;let[t,n]=rM(rP(e));for(let e=0;e<this.hashCount;e++){let r=this.de(t,n,e);if(!this.Ee(r))return!1}return!0}static create(e,t,n){let r=e%8==0?0:8-e%8,i=new rL(new Uint8Array(Math.ceil(e/8)),r,t);return n.forEach(e=>i.insert(e)),i}insert(e){if(0===this.Te)return;let[t,n]=rM(rP(e));for(let e=0;e<this.hashCount;e++){let r=this.de(t,n,e);this.Ae(r)}}Ae(e){let t=Math.floor(e/8),n=e%8;this.bitmap[t]|=1<<n}}class rz extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class rB{constructor(e,t,n,r,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t,n){let r=new Map;return r.set(e,rU.createSynthesizedTargetChangeForCurrentChange(e,t,n)),new rB(ea.min(),r,new td(en),nq(),n1())}}class rU{constructor(e,t,n,r,i){this.resumeToken=e,this.current=t,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t,n){return new rU(n,t,n1(),n1(),n1())}}class rV{constructor(e,t,n,r){this.Re=e,this.removedTargetIds=t,this.key=n,this.Ve=r}}class rj{constructor(e,t){this.targetId=e,this.me=t}}class rG{constructor(e,t,n=tw.EMPTY_BYTE_STRING,r=null){this.state=e,this.targetIds=t,this.resumeToken=n,this.cause=r}}class rW{constructor(){this.fe=0,this.ge=rK(),this.pe=tw.EMPTY_BYTE_STRING,this.ye=!1,this.we=!0}get current(){return this.ye}get resumeToken(){return this.pe}get Se(){return 0!==this.fe}get be(){return this.we}De(e){e.approximateByteSize()>0&&(this.we=!0,this.pe=e)}ve(){let e=n1(),t=n1(),n=n1();return this.ge.forEach((r,i)=>{switch(i){case 0:e=e.add(r);break;case 2:t=t.add(r);break;case 1:n=n.add(r);break;default:B()}}),new rU(this.pe,this.ye,e,t,n)}Ce(){this.we=!1,this.ge=rK()}Fe(e,t){this.we=!0,this.ge=this.ge.insert(e,t)}Me(e){this.we=!0,this.ge=this.ge.remove(e)}xe(){this.fe+=1}Oe(){this.fe-=1,U(this.fe>=0)}Ne(){this.we=!0,this.ye=!0}}class rq{constructor(e){this.Be=e,this.Le=new Map,this.ke=nq(),this.qe=rH(),this.Qe=rH(),this.Ke=new td(en)}$e(e){for(let t of e.Re)e.Ve&&e.Ve.isFoundDocument()?this.Ue(t,e.Ve):this.We(t,e.key,e.Ve);for(let t of e.removedTargetIds)this.We(t,e.key,e.Ve)}Ge(e){this.forEachTarget(e,t=>{let n=this.ze(t);switch(e.state){case 0:this.je(t)&&n.De(e.resumeToken);break;case 1:n.Oe(),n.Se||n.Ce(),n.De(e.resumeToken);break;case 2:n.Oe(),n.Se||this.removeTarget(t);break;case 3:this.je(t)&&(n.Ne(),n.De(e.resumeToken));break;case 4:this.je(t)&&(this.He(t),n.De(e.resumeToken));break;default:B()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.Le.forEach((e,n)=>{this.je(n)&&t(n)})}Je(e){let t=e.targetId,n=e.me.count,r=this.Ye(t);if(r){let i=r.target;if(nx(i)){if(0===n){let e=new eh(i.path);this.We(t,e,t3.newNoDocument(e,ea.min()))}else U(1===n)}else{let r=this.Ze(t);if(r!==n){let n=this.Xe(e),i=n?this.et(n,e,r):1;if(0!==i){this.He(t);let e=2===i?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ke=this.Ke.insert(t,e)}null==rR||rR.tt(function(e,t,n,r,i){var s,a,o,l,u,c;let h={localCacheCount:e,existenceFilterCount:t.count,databaseId:n.database,projectId:n.projectId},d=t.unchangedNames;return d&&(h.bloomFilter={applied:0===i,hashCount:null!==(s=null==d?void 0:d.hashCount)&&void 0!==s?s:0,bitmapLength:null!==(l=null===(o=null===(a=null==d?void 0:d.bits)||void 0===a?void 0:a.bitmap)||void 0===o?void 0:o.length)&&void 0!==l?l:0,padding:null!==(c=null===(u=null==d?void 0:d.bits)||void 0===u?void 0:u.padding)&&void 0!==c?c:0,mightContain:e=>{var t;return null!==(t=null==r?void 0:r.mightContain(e))&&void 0!==t&&t}}),h}(r,e.me,this.Be.nt(),n,i))}}}}Xe(e){let t,n;let r=e.me.unchangedNames;if(!r||!r.bits)return null;let{bits:{bitmap:i="",padding:s=0},hashCount:a=0}=r;try{t=tI(i).toUint8Array()}catch(e){if(e instanceof tv)return L("Decoding the base64 bloom filter in existence filter failed ("+e.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw e}try{n=new rL(t,s,a)}catch(e){return L(e instanceof rz?"BloomFilter error: ":"Applying bloom filter failed: ",e),null}return 0===n.Te?null:n}et(e,t,n){return t.me.count===n-this.rt(e,t.targetId)?0:2}rt(e,t){let n=this.Be.getRemoteKeysForTarget(t),r=0;return n.forEach(n=>{let i=this.Be.nt(),s=`projects/${i.projectId}/databases/${i.database}/documents/${n.path.canonicalString()}`;e.mightContain(s)||(this.We(t,n,null),r++)}),r}it(e){let t=new Map;this.Le.forEach((n,r)=>{let i=this.Ye(r);if(i){if(n.current&&nx(i.target)){let t=new eh(i.target.path);this.st(t).has(r)||this.ot(r,t)||this.We(r,t,t3.newNoDocument(t,e))}n.be&&(t.set(r,n.ve()),n.Ce())}});let n=n1();this.Qe.forEach((e,t)=>{let r=!0;t.forEachWhile(e=>{let t=this.Ye(e);return!t||"TargetPurposeLimboResolution"===t.purpose||(r=!1,!1)}),r&&(n=n.add(e))}),this.ke.forEach((t,n)=>n.setReadTime(e));let r=new rB(e,t,this.Ke,this.ke,n);return this.ke=nq(),this.qe=rH(),this.Qe=rH(),this.Ke=new td(en),r}Ue(e,t){if(!this.je(e))return;let n=this.ot(e,t.key)?2:0;this.ze(e).Fe(t.key,n),this.ke=this.ke.insert(t.key,t),this.qe=this.qe.insert(t.key,this.st(t.key).add(e)),this.Qe=this.Qe.insert(t.key,this._t(t.key).add(e))}We(e,t,n){if(!this.je(e))return;let r=this.ze(e);this.ot(e,t)?r.Fe(t,1):r.Me(t),this.Qe=this.Qe.insert(t,this._t(t).delete(e)),this.Qe=this.Qe.insert(t,this._t(t).add(e)),n&&(this.ke=this.ke.insert(t,n))}removeTarget(e){this.Le.delete(e)}Ze(e){let t=this.ze(e).ve();return this.Be.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}xe(e){this.ze(e).xe()}ze(e){let t=this.Le.get(e);return t||(t=new rW,this.Le.set(e,t)),t}_t(e){let t=this.Qe.get(e);return t||(t=new tg(en),this.Qe=this.Qe.insert(e,t)),t}st(e){let t=this.qe.get(e);return t||(t=new tg(en),this.qe=this.qe.insert(e,t)),t}je(e){let t=null!==this.Ye(e);return t||P("WatchChangeAggregator","Detected inactive target",e),t}Ye(e){let t=this.Le.get(e);return t&&t.Se?null:this.Be.ut(e)}He(e){this.Le.set(e,new rW),this.Be.getRemoteKeysForTarget(e).forEach(t=>{this.We(e,t,null)})}ot(e,t){return this.Be.getRemoteKeysForTarget(e).has(t)}}function rH(){return new td(eh.comparator)}function rK(){return new td(eh.comparator)}let rX={asc:"ASCENDING",desc:"DESCENDING"},rY={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},rQ={and:"AND",or:"OR"};class rJ{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function rZ(e,t){return e.useProto3Json||ez(t)?t:{value:t}}function r0(e,t){return e.useProto3Json?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function r1(e,t){return e.useProto3Json?t.toBase64():t.toUint8Array()}function r2(e,t){return r0(e,t.toTimestamp())}function r3(e){return U(!!e),ea.fromTimestamp(function(e){let t=tx(e);return new es(t.seconds,t.nanos)}(e))}function r4(e,t){return r6(e,t).canonicalString()}function r6(e,t){let n=(function(e){return new el(["projects",e.projectId,"databases",e.database])})(e).child("documents");return void 0===t?n:n.child(t)}function r5(e){let t=el.fromString(e);return U(ik(t)),t}function r8(e,t){return r4(e.databaseId,t.path)}function r7(e,t){let n=r5(t);if(n.get(1)!==e.databaseId.projectId)throw new G(j.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+e.databaseId.projectId);if(n.get(3)!==e.databaseId.database)throw new G(j.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+e.databaseId.database);return new eh(ir(n))}function r9(e,t){return r4(e.databaseId,t)}function ie(e){let t=r5(e);return 4===t.length?el.emptyPath():ir(t)}function it(e){return new el(["projects",e.databaseId.projectId,"databases",e.databaseId.database]).canonicalString()}function ir(e){return U(e.length>4&&"documents"===e.get(4)),e.popFirst(5)}function ii(e,t,n){return{name:r8(e,t),fields:n.value.mapValue.fields}}function is(e,t,n){let r=r7(e,t.name),i=r3(t.updateTime),s=t.createTime?r3(t.createTime):ea.min(),a=new t1({mapValue:{fields:t.fields}}),o=t3.newFoundDocument(r,i,s,a);return n&&o.setHasCommittedMutations(),n?o.setHasCommittedMutations():o}function ia(e,t){return"found"in t?function(e,t){U(!!t.found),t.found.name,t.found.updateTime;let n=r7(e,t.found.name),r=r3(t.found.updateTime),i=t.found.createTime?r3(t.found.createTime):ea.min(),s=new t1({mapValue:{fields:t.found.fields}});return t3.newFoundDocument(n,r,i,s)}(e,t):"missing"in t?function(e,t){U(!!t.missing),U(!!t.readTime);let n=r7(e,t.missing),r=r3(t.readTime);return t3.newNoDocument(n,r)}(e,t):B()}function io(e,t){let n;if("targetChange"in t){t.targetChange;let r=function(e){return"NO_CHANGE"===e?0:"ADD"===e?1:"REMOVE"===e?2:"CURRENT"===e?3:"RESET"===e?4:B()}(t.targetChange.targetChangeType||"NO_CHANGE"),i=t.targetChange.targetIds||[],s=function(e,t){return e.useProto3Json?(U(void 0===t||"string"==typeof t),tw.fromBase64String(t||"")):(U(void 0===t||t instanceof N||t instanceof Uint8Array),tw.fromUint8Array(t||new Uint8Array))}(e,t.targetChange.resumeToken),a=t.targetChange.cause;n=new rG(r,i,s,a&&function(e){return new G(void 0===e.code?j.UNKNOWN:r$(e.code),e.message||"")}(a)||null)}else if("documentChange"in t){t.documentChange;let r=t.documentChange;r.document,r.document.name,r.document.updateTime;let i=r7(e,r.document.name),s=r3(r.document.updateTime),a=r.document.createTime?r3(r.document.createTime):ea.min(),o=new t1({mapValue:{fields:r.document.fields}}),l=t3.newFoundDocument(i,s,a,o);n=new rV(r.targetIds||[],r.removedTargetIds||[],l.key,l)}else if("documentDelete"in t){t.documentDelete;let r=t.documentDelete;r.document;let i=r7(e,r.document),s=r.readTime?r3(r.readTime):ea.min(),a=t3.newNoDocument(i,s);n=new rV([],r.removedTargetIds||[],a.key,a)}else if("documentRemove"in t){t.documentRemove;let r=t.documentRemove;r.document;let i=r7(e,r.document);n=new rV([],r.removedTargetIds||[],i,null)}else{if(!("filter"in t))return B();{t.filter;let e=t.filter;e.targetId;let{count:r=0,unchangedNames:i}=e,s=new rN(r,i);n=new rj(e.targetId,s)}}return n}function il(e,t){let n;if(t instanceof rw)n={update:ii(e,t.key,t.value)};else if(t instanceof rk)n={delete:r8(e,t.key)};else if(t instanceof r_)n={update:ii(e,t.key,t.data),updateMask:iI(t.fieldMask)};else{if(!(t instanceof rS))return B();n={verify:r8(e,t.key)}}return t.fieldTransforms.length>0&&(n.updateTransforms=t.fieldTransforms.map(e=>(function(e,t){let n=t.transform;if(n instanceof rt)return{fieldPath:t.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof rn)return{fieldPath:t.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof ri)return{fieldPath:t.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof ra)return{fieldPath:t.field.canonicalString(),increment:n.Pe};throw B()})(0,e))),t.precondition.isNone||(n.currentDocument=function(e,t){return void 0!==t.updateTime?{updateTime:r2(e,t.updateTime)}:void 0!==t.exists?{exists:t.exists}:B()}(e,t.precondition)),n}function iu(e,t){let n=t.currentDocument?function(e){return void 0!==e.updateTime?rd.updateTime(r3(e.updateTime)):void 0!==e.exists?rd.exists(e.exists):rd.none()}(t.currentDocument):rd.none(),r=t.updateTransforms?t.updateTransforms.map(t=>(function(e,t){let n=null;return"setToServerValue"in t?(U("REQUEST_TIME"===t.setToServerValue),n=new rt):"appendMissingElements"in t?n=new rn(t.appendMissingElements.values||[]):"removeAllFromArray"in t?n=new ri(t.removeAllFromArray.values||[]):"increment"in t?n=new ra(e,t.increment):B(),new ru(ec.fromServerFormat(t.fieldPath),n)})(e,t)):[];if(t.update){t.update.name;let i=r7(e,t.update.name),s=new t1({mapValue:{fields:t.update.fields}});return t.updateMask?new r_(i,s,function(e){return new tb((e.fieldPaths||[]).map(e=>ec.fromServerFormat(e)))}(t.updateMask),n,r):new rw(i,s,n,r)}return t.delete?new rk(r7(e,t.delete),n):t.verify?new rS(r7(e,t.verify),n):B()}function ic(e,t){return e&&e.length>0?(U(void 0!==t),e.map(e=>(function(e,t){let n=e.updateTime?r3(e.updateTime):r3(t);return n.isEqual(ea.min())&&(n=r3(t)),new rh(n,e.transformResults||[])})(e,t))):[]}function ih(e,t){return{documents:[r9(e,t.path)]}}function id(e,t){let n;let r={structuredQuery:{}},i=t.path;null!==t.collectionGroup?(n=i,r.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(n=i.popLast(),r.structuredQuery.from=[{collectionId:i.lastSegment()}]),r.parent=r9(e,n);let s=function(e){if(0!==e.length)return iT(nt.create(e,"and"))}(t.filters);s&&(r.structuredQuery.where=s);let a=function(e){if(0!==e.length)return e.map(e=>(function(e){return{field:i_(e.field),direction:ib(e.dir)}})(e))}(t.orderBy);a&&(r.structuredQuery.orderBy=a);let o=rZ(e,t.limit);return null!==o&&(r.structuredQuery.limit=o),t.startAt&&(r.structuredQuery.startAt=function(e){return{before:e.inclusive,values:e.position}}(t.startAt)),t.endAt&&(r.structuredQuery.endAt=function(e){return{before:!e.inclusive,values:e.position}}(t.endAt)),{ct:r,parent:n}}function ip(e,t,n,r){let{ct:i,parent:s}=id(e,t),a={},o=[],l=0;return n.forEach(e=>{let t=r?e.alias:"aggregate_"+l++;a[t]=e.alias,"count"===e.aggregateType?o.push({alias:t,count:{}}):"avg"===e.aggregateType?o.push({alias:t,avg:{field:i_(e.fieldPath)}}):"sum"===e.aggregateType&&o.push({alias:t,sum:{field:i_(e.fieldPath)}})}),{request:{structuredAggregationQuery:{aggregations:o,structuredQuery:i.structuredQuery},parent:i.parent},lt:a,parent:s}}function ig(e){let t=ie(e.parent),n=e.structuredQuery,r=n.from?n.from.length:0,i=null;if(r>0){U(1===r);let e=n.from[0];e.allDescendants?i=e.collectionId:t=t.child(e.collectionId)}let s=[];n.where&&(s=function(e){let t=iy(e);return t instanceof nt&&ni(t)?t.getFilters():[t]}(n.where));let a=[];n.orderBy&&(a=function(e){return e.map(e=>(function(e){return new t8(ix(e.field),function(e){switch(e){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(e.direction))})(e))}(n.orderBy));let o=null;n.limit&&(o=function(e){let t;return ez(t="object"==typeof e?e.value:e)?null:t}(n.limit));let l=null;n.startAt&&(l=function(e){let t=!!e.before;return new t4(e.values||[],t)}(n.startAt));let u=null;return n.endAt&&(u=function(e){let t=!e.before;return new t4(e.values||[],t)}(n.endAt)),nE(t,i,a,s,o,"F",l,u)}function im(e,t){let n=function(e){switch(e){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return B()}}(t.purpose);return null==n?null:{"goog-listen-tags":n}}function iy(e){return void 0!==e.unaryFilter?function(e){switch(e.unaryFilter.op){case"IS_NAN":let t=ix(e.unaryFilter.field);return ne.create(t,"==",{doubleValue:NaN});case"IS_NULL":let n=ix(e.unaryFilter.field);return ne.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":let r=ix(e.unaryFilter.field);return ne.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":let i=ix(e.unaryFilter.field);return ne.create(i,"!=",{nullValue:"NULL_VALUE"});default:return B()}}(e):void 0!==e.fieldFilter?function(e){return ne.create(ix(e.fieldFilter.field),function(e){switch(e){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return B()}}(e.fieldFilter.op),e.fieldFilter.value)}(e):void 0!==e.compositeFilter?function(e){return nt.create(e.compositeFilter.filters.map(e=>iy(e)),function(e){switch(e){case"AND":return"and";case"OR":return"or";default:return B()}}(e.compositeFilter.op))}(e):B()}function ib(e){return rX[e]}function iv(e){return rY[e]}function iw(e){return rQ[e]}function i_(e){return{fieldPath:e.canonicalString()}}function ix(e){return ec.fromServerFormat(e.fieldPath)}function iT(e){return e instanceof ne?function(e){if("=="===e.op){if(tW(e.value))return{unaryFilter:{field:i_(e.field),op:"IS_NAN"}};if(tG(e.value))return{unaryFilter:{field:i_(e.field),op:"IS_NULL"}}}else if("!="===e.op){if(tW(e.value))return{unaryFilter:{field:i_(e.field),op:"IS_NOT_NAN"}};if(tG(e.value))return{unaryFilter:{field:i_(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:i_(e.field),op:iv(e.op),value:e.value}}}(e):e instanceof nt?function(e){let t=e.getFilters().map(e=>iT(e));return 1===t.length?t[0]:{compositeFilter:{op:iw(e.op),filters:t}}}(e):B()}function iI(e){let t=[];return e.fields.forEach(e=>t.push(e.canonicalString())),{fieldPaths:t}}function ik(e){return e.length>=4&&"projects"===e.get(0)&&"databases"===e.get(2)}class iS{constructor(e,t,n,r,i=ea.min(),s=ea.min(),a=tw.EMPTY_BYTE_STRING,o=null){this.target=e,this.targetId=t,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=s,this.resumeToken=a,this.expectedCount=o}withSequenceNumber(e){return new iS(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new iS(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new iS(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new iS(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class iE{constructor(e){this.ht=e}}function iC(e,t){let n;if(t.document)n=is(e.ht,t.document,!!t.hasCommittedMutations);else if(t.noDocument){let e=eh.fromSegments(t.noDocument.path),r=i$(t.noDocument.readTime);n=t3.newNoDocument(e,r),t.hasCommittedMutations&&n.setHasCommittedMutations()}else{if(!t.unknownDocument)return B();{let e=eh.fromSegments(t.unknownDocument.path),r=i$(t.unknownDocument.version);n=t3.newUnknownDocument(e,r)}}return t.readTime&&n.setReadTime(function(e){let t=new es(e[0],e[1]);return ea.fromTimestamp(t)}(t.readTime)),n}function iA(e,t){let n=t.key,r={prefixPath:n.getCollectionPath().popLast().toArray(),collectionGroup:n.collectionGroup,documentId:n.path.lastSegment(),readTime:iN(t.readTime),hasCommittedMutations:t.hasCommittedMutations};if(t.isFoundDocument())r.document=function(e,t){return{name:r8(e,t.key),fields:t.data.value.mapValue.fields,updateTime:r0(e,t.version.toTimestamp()),createTime:r0(e,t.createTime.toTimestamp())}}(e.ht,t);else if(t.isNoDocument())r.noDocument={path:n.path.toArray(),readTime:iO(t.version)};else{if(!t.isUnknownDocument())return B();r.unknownDocument={path:n.path.toArray(),version:iO(t.version)}}return r}function iN(e){let t=e.toTimestamp();return[t.seconds,t.nanoseconds]}function iO(e){let t=e.toTimestamp();return{seconds:t.seconds,nanoseconds:t.nanoseconds}}function i$(e){let t=new es(e.seconds,e.nanoseconds);return ea.fromTimestamp(t)}function iR(e,t){let n=(t.baseMutations||[]).map(t=>iu(e.ht,t));for(let e=0;e<t.mutations.length-1;++e){let n=t.mutations[e];if(e+1<t.mutations.length&&void 0!==t.mutations[e+1].transform){let r=t.mutations[e+1];n.updateTransforms=r.transform.fieldTransforms,t.mutations.splice(e+1,1),++e}}let r=t.mutations.map(t=>iu(e.ht,t)),i=es.fromMillis(t.localWriteTimeMs);return new rE(t.batchId,i,n,r)}function iD(e){let t=i$(e.readTime),n=void 0!==e.lastLimboFreeSnapshotVersion?i$(e.lastLimboFreeSnapshotVersion):ea.min();return new iS(!function(e){return void 0!==e.documents}(e.query)?function(e){return n$(ig(e))}(e.query):function(e){return U(1===e.documents.length),n$(nC(ie(e.documents[0])))}(e.query),e.targetId,"TargetPurposeListen",e.lastListenSequenceNumber,t,n,tw.fromBase64String(e.resumeToken))}function iF(e,t){let n;let r=iO(t.snapshotVersion),i=iO(t.lastLimboFreeSnapshotVersion);n=nx(t.target)?ih(e.ht,t.target):id(e.ht,t.target).ct;let s=t.resumeToken.toBase64();return{targetId:t.targetId,canonicalId:nw(t.target),readTime:r,resumeToken:s,lastListenSequenceNumber:t.sequenceNumber,lastLimboFreeSnapshotVersion:i,query:n}}function iP(e){let t=ig({parent:e.parent,structuredQuery:e.structuredQuery});return"LAST"===e.limitType?nP(t,t.limit,"L"):t}function iM(e,t){return new rA(t.largestBatchId,iu(e.ht,t.overlayMutation))}function iL(e,t){let n=t.path.lastSegment();return[e,eV(t.path.popLast()),n]}function iz(e,t,n,r){return{indexId:e,uid:t,sequenceNumber:n,readTime:iO(r.readTime),documentKey:eV(r.documentKey.path),largestBatchId:r.largestBatchId}}class iB{getBundleMetadata(e,t){return iU(e).get(t).next(e=>{if(e)return function(e){return{id:e.bundleId,createTime:i$(e.createTime),version:e.version}}(e)})}saveBundleMetadata(e,t){return iU(e).put(function(e){return{bundleId:e.id,createTime:iO(r3(e.createTime)),version:e.version}}(t))}getNamedQuery(e,t){return iV(e).get(t).next(e=>{if(e)return function(e){return{name:e.name,query:iP(e.bundledQuery),readTime:i$(e.readTime)}}(e)})}saveNamedQuery(e,t){return iV(e).put(function(e){return{name:e.name,readTime:iO(r3(e.readTime)),bundledQuery:e.bundledQuery}}(t))}}function iU(e){return tl(e,"bundles")}function iV(e){return tl(e,"namedQueries")}class ij{constructor(e,t){this.serializer=e,this.userId=t}static Pt(e,t){return new ij(e,t.uid||"")}getOverlay(e,t){return iG(e).get(iL(this.userId,t)).next(e=>e?iM(this.serializer,e):null)}getOverlays(e,t){let n=nY();return ek.forEach(t,t=>this.getOverlay(e,t).next(e=>{null!==e&&n.set(t,e)})).next(()=>n)}saveOverlays(e,t,n){let r=[];return n.forEach((n,i)=>{let s=new rA(t,i);r.push(this.Tt(e,s))}),ek.waitFor(r)}removeOverlaysForBatchId(e,t,n){let r=new Set;t.forEach(e=>r.add(eV(e.getCollectionPath())));let i=[];return r.forEach(t=>{let r=IDBKeyRange.bound([this.userId,t,n],[this.userId,t,n+1],!1,!0);i.push(iG(e).j("collectionPathOverlayIndex",r))}),ek.waitFor(i)}getOverlaysForCollection(e,t,n){let r=nY(),i=eV(t),s=IDBKeyRange.bound([this.userId,i,n],[this.userId,i,Number.POSITIVE_INFINITY],!0);return iG(e).U("collectionPathOverlayIndex",s).next(e=>{for(let t of e){let e=iM(this.serializer,t);r.set(e.getKey(),e)}return r})}getOverlaysForCollectionGroup(e,t,n,r){let i;let s=nY(),a=IDBKeyRange.bound([this.userId,t,n],[this.userId,t,Number.POSITIVE_INFINITY],!0);return iG(e).J({index:"collectionGroupOverlayIndex",range:a},(e,t,n)=>{let a=iM(this.serializer,t);s.size()<r||a.largestBatchId===i?(s.set(a.getKey(),a),i=a.largestBatchId):n.done()}).next(()=>s)}Tt(e,t){return iG(e).put(function(e,t,n){let[r,i,s]=iL(t,n.mutation.key);return{userId:t,collectionPath:i,documentId:s,collectionGroup:n.mutation.key.getCollectionGroup(),largestBatchId:n.largestBatchId,overlayMutation:il(e.ht,n.mutation)}}(this.serializer,this.userId,t))}}function iG(e){return tl(e,"documentOverlays")}class iW{It(e){return tl(e,"globals")}getSessionToken(e){return this.It(e).get("sessionToken").next(e=>{let t=null==e?void 0:e.value;return t?tw.fromUint8Array(t):tw.EMPTY_BYTE_STRING})}setSessionToken(e,t){return this.It(e).put({name:"sessionToken",value:t.toUint8Array()})}}class iq{constructor(){}dt(e,t){this.Et(e,t),t.At()}Et(e,t){if("nullValue"in e)this.Rt(t,5);else if("booleanValue"in e)this.Rt(t,10),t.Vt(e.booleanValue?1:0);else if("integerValue"in e)this.Rt(t,15),t.Vt(tT(e.integerValue));else if("doubleValue"in e){let n=tT(e.doubleValue);isNaN(n)?this.Rt(t,13):(this.Rt(t,15),eB(n)?t.Vt(0):t.Vt(n))}else if("timestampValue"in e){let n=e.timestampValue;this.Rt(t,20),"string"==typeof n&&(n=tx(n)),t.ft(`${n.seconds||""}`),t.Vt(n.nanos||0)}else if("stringValue"in e)this.gt(e.stringValue,t),this.yt(t);else if("bytesValue"in e)this.Rt(t,30),t.wt(tI(e.bytesValue)),this.yt(t);else if("referenceValue"in e)this.St(e.referenceValue,t);else if("geoPointValue"in e){let n=e.geoPointValue;this.Rt(t,45),t.Vt(n.latitude||0),t.Vt(n.longitude||0)}else"mapValue"in e?tX(e)?this.Rt(t,Number.MAX_SAFE_INTEGER):tH(e)?this.bt(e.mapValue,t):(this.Dt(e.mapValue,t),this.yt(t)):"arrayValue"in e?(this.vt(e.arrayValue,t),this.yt(t)):B()}gt(e,t){this.Rt(t,25),this.Ct(e,t)}Ct(e,t){t.ft(e)}Dt(e,t){let n=e.fields||{};for(let e of(this.Rt(t,55),Object.keys(n)))this.gt(e,t),this.Et(n[e],t)}bt(e,t){var n,r;let i=e.fields||{};this.Rt(t,53);let s="value",a=(null===(r=null===(n=i[s].arrayValue)||void 0===n?void 0:n.values)||void 0===r?void 0:r.length)||0;this.Rt(t,15),t.Vt(tT(a)),this.gt(s,t),this.Et(i[s],t)}vt(e,t){let n=e.values||[];for(let e of(this.Rt(t,50),n))this.Et(e,t)}St(e,t){this.Rt(t,37),eh.fromName(e).path.forEach(e=>{this.Rt(t,60),this.Ct(e,t)})}Rt(e,t){e.Vt(t)}yt(e){e.Vt(2)}}function iH(e){if(0===e)return 8;let t=0;return e>>4==0&&(t+=4,e<<=4),e>>6==0&&(t+=2,e<<=2),e>>7==0&&(t+=1),t}function iK(e){return Math.ceil((64-function(e){let t=0;for(let n=0;n<8;++n){let r=iH(255&e[n]);if(t+=r,8!==r)break}return t}(e))/8)}iq.Ft=new iq;class iX{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Mt(e){let t=e[Symbol.iterator](),n=t.next();for(;!n.done;)this.xt(n.value),n=t.next();this.Ot()}Nt(e){let t=e[Symbol.iterator](),n=t.next();for(;!n.done;)this.Bt(n.value),n=t.next();this.Lt()}kt(e){for(let t of e){let e=t.charCodeAt(0);if(e<128)this.xt(e);else if(e<2048)this.xt(960|e>>>6),this.xt(128|63&e);else if(t<"\ud800"||"\udbff"<t)this.xt(480|e>>>12),this.xt(128|63&e>>>6),this.xt(128|63&e);else{let e=t.codePointAt(0);this.xt(240|e>>>18),this.xt(128|63&e>>>12),this.xt(128|63&e>>>6),this.xt(128|63&e)}}this.Ot()}qt(e){for(let t of e){let e=t.charCodeAt(0);if(e<128)this.Bt(e);else if(e<2048)this.Bt(960|e>>>6),this.Bt(128|63&e);else if(t<"\ud800"||"\udbff"<t)this.Bt(480|e>>>12),this.Bt(128|63&e>>>6),this.Bt(128|63&e);else{let e=t.codePointAt(0);this.Bt(240|e>>>18),this.Bt(128|63&e>>>12),this.Bt(128|63&e>>>6),this.Bt(128|63&e)}}this.Lt()}Qt(e){let t=this.Kt(e),n=iK(t);this.$t(1+n),this.buffer[this.position++]=255&n;for(let e=t.length-n;e<t.length;++e)this.buffer[this.position++]=255&t[e]}Ut(e){let t=this.Kt(e),n=iK(t);this.$t(1+n),this.buffer[this.position++]=~(255&n);for(let e=t.length-n;e<t.length;++e)this.buffer[this.position++]=~(255&t[e])}Wt(){this.Gt(255),this.Gt(255)}zt(){this.jt(255),this.jt(255)}reset(){this.position=0}seed(e){this.$t(e.length),this.buffer.set(e,this.position),this.position+=e.length}Ht(){return this.buffer.slice(0,this.position)}Kt(e){let t=function(e){let t=new DataView(new ArrayBuffer(8));return t.setFloat64(0,e,!1),new Uint8Array(t.buffer)}(e),n=0!=(128&t[0]);t[0]^=n?255:128;for(let e=1;e<t.length;++e)t[e]^=n?255:0;return t}xt(e){let t=255&e;0===t?(this.Gt(0),this.Gt(255)):255===t?(this.Gt(255),this.Gt(0)):this.Gt(t)}Bt(e){let t=255&e;0===t?(this.jt(0),this.jt(255)):255===t?(this.jt(255),this.jt(0)):this.jt(e)}Ot(){this.Gt(0),this.Gt(1)}Lt(){this.jt(0),this.jt(1)}Gt(e){this.$t(1),this.buffer[this.position++]=e}jt(e){this.$t(1),this.buffer[this.position++]=~e}$t(e){let t=e+this.position;if(t<=this.buffer.length)return;let n=2*this.buffer.length;n<t&&(n=t);let r=new Uint8Array(n);r.set(this.buffer),this.buffer=r}}class iY{constructor(e){this.Jt=e}wt(e){this.Jt.Mt(e)}ft(e){this.Jt.kt(e)}Vt(e){this.Jt.Qt(e)}At(){this.Jt.Wt()}}class iQ{constructor(e){this.Jt=e}wt(e){this.Jt.Nt(e)}ft(e){this.Jt.qt(e)}Vt(e){this.Jt.Ut(e)}At(){this.Jt.zt()}}class iJ{constructor(){this.Jt=new iX,this.Yt=new iY(this.Jt),this.Zt=new iQ(this.Jt)}seed(e){this.Jt.seed(e)}Xt(e){return 0===e?this.Yt:this.Zt}Ht(){return this.Jt.Ht()}reset(){this.Jt.reset()}}class iZ{constructor(e,t,n,r){this.indexId=e,this.documentKey=t,this.arrayValue=n,this.directionalValue=r}en(){let e=this.directionalValue.length,t=0===e||255===this.directionalValue[e-1]?e+1:e,n=new Uint8Array(t);return n.set(this.directionalValue,0),t!==e?n.set([0],this.directionalValue.length):++n[n.length-1],new iZ(this.indexId,this.documentKey,this.arrayValue,n)}}function i0(e,t){let n=e.indexId-t.indexId;return 0!==n?n:0!==(n=i1(e.arrayValue,t.arrayValue))?n:0!==(n=i1(e.directionalValue,t.directionalValue))?n:eh.comparator(e.documentKey,t.documentKey)}function i1(e,t){for(let n=0;n<e.length&&n<t.length;++n){let r=e[n]-t[n];if(0!==r)return r}return e.length-t.length}class i2{constructor(e){for(let t of(this.tn=new tg((e,t)=>ec.comparator(e.field,t.field)),this.collectionId=null!=e.collectionGroup?e.collectionGroup:e.path.lastSegment(),this.nn=e.orderBy,this.rn=[],e.filters)){let e=t;e.isInequality()?this.tn=this.tn.add(e):this.rn.push(e)}}get sn(){return this.tn.size>1}on(e){if(U(e.collectionGroup===this.collectionId),this.sn)return!1;let t=ep(e);if(void 0!==t&&!this._n(t))return!1;let n=ef(e),r=new Set,i=0,s=0;for(;i<n.length&&this._n(n[i]);++i)r=r.add(n[i].fieldPath.canonicalString());if(i===n.length)return!0;if(this.tn.size>0){let e=this.tn.getIterator().getNext();if(!r.has(e.field.canonicalString())){let t=n[i];if(!this.an(e,t)||!this.un(this.nn[s++],t))return!1}++i}for(;i<n.length;++i){let e=n[i];if(s>=this.nn.length||!this.un(this.nn[s++],e))return!1}return!0}cn(){if(this.sn)return null;let e=new tg(ec.comparator),t=[];for(let n of this.rn)if(!n.field.isKeyField()){if("array-contains"===n.op||"array-contains-any"===n.op)t.push(new eg(n.field,2));else{if(e.has(n.field))continue;e=e.add(n.field),t.push(new eg(n.field,0))}}for(let n of this.nn)n.field.isKeyField()||e.has(n.field)||(e=e.add(n.field),t.push(new eg(n.field,"asc"===n.dir?0:1)));return new ed(ed.UNKNOWN_ID,this.collectionId,t,ey.empty())}_n(e){for(let t of this.rn)if(this.an(t,e))return!0;return!1}an(e,t){if(void 0===e||!e.field.isEqual(t.fieldPath))return!1;let n="array-contains"===e.op||"array-contains-any"===e.op;return 2===t.kind===n}un(e,t){return!!e.field.isEqual(t.fieldPath)&&(0===t.kind&&"asc"===e.dir||1===t.kind&&"desc"===e.dir)}}function i3(e){var t,n;if(U(e instanceof ne||e instanceof nt),e instanceof ne){if(e instanceof ng){let r=(null===(n=null===(t=e.value.arrayValue)||void 0===t?void 0:t.values)||void 0===n?void 0:n.map(t=>ne.create(e.field,"==",t)))||[];return nt.create(r,"or")}return e}let r=e.filters.map(e=>i3(e));return nt.create(r,e.op)}function i4(e){if(0===e.getFilters().length)return[];let t=i7(i3(e));return U(i8(t)),i6(t)||i5(t)?[t]:t.getFilters()}function i6(e){return e instanceof ne}function i5(e){return e instanceof nt&&ni(e)}function i8(e){return i6(e)||i5(e)||function(e){if(e instanceof nt&&nr(e)){for(let t of e.getFilters())if(!i6(t)&&!i5(t))return!1;return!0}return!1}(e)}function i7(e){if(U(e instanceof ne||e instanceof nt),e instanceof ne)return e;if(1===e.filters.length)return i7(e.filters[0]);let t=e.filters.map(e=>i7(e)),n=nt.create(t,e.op);return i8(n=st(n))?n:(U(n instanceof nt),U(nn(n)),U(n.filters.length>1),n.filters.reduce((e,t)=>i9(e,t)))}function i9(e,t){return U(e instanceof ne||e instanceof nt),U(t instanceof ne||t instanceof nt),st(e instanceof ne?t instanceof ne?function(e,t){return nt.create([e,t],"and")}(e,t):se(e,t):t instanceof ne?se(t,e):function(e,t){if(U(e.filters.length>0&&t.filters.length>0),nn(e)&&nn(t))return nl(e,t.getFilters());let n=nr(e)?e:t,r=nr(e)?t:e,i=n.filters.map(e=>i9(e,r));return nt.create(i,"or")}(e,t))}function se(e,t){if(nn(t))return nl(t,e.getFilters());{let n=t.filters.map(t=>i9(e,t));return nt.create(n,"or")}}function st(e){if(U(e instanceof ne||e instanceof nt),e instanceof ne)return e;let t=e.getFilters();if(1===t.length)return st(t[0]);if(ns(e))return e;let n=t.map(e=>st(e)),r=[];return n.forEach(t=>{t instanceof ne?r.push(t):t instanceof nt&&(t.op===e.op?r.push(...t.filters):r.push(t))}),1===r.length?r[0]:nt.create(r,e.op)}class sn{constructor(){this.ln=new sr}addToCollectionParentIndex(e,t){return this.ln.add(t),ek.resolve()}getCollectionParents(e,t){return ek.resolve(this.ln.getEntries(t))}addFieldIndex(e,t){return ek.resolve()}deleteFieldIndex(e,t){return ek.resolve()}deleteAllFieldIndexes(e){return ek.resolve()}createTargetIndexes(e,t){return ek.resolve()}getDocumentsMatchingTarget(e,t){return ek.resolve(null)}getIndexType(e,t){return ek.resolve(0)}getFieldIndexes(e,t){return ek.resolve([])}getNextCollectionGroupToUpdate(e){return ek.resolve(null)}getMinOffset(e,t){return ek.resolve(ew.min())}getMinOffsetFromCollectionGroup(e,t){return ek.resolve(ew.min())}updateCollectionGroup(e,t,n){return ek.resolve()}updateIndexEntries(e,t){return ek.resolve()}}class sr{constructor(){this.index={}}add(e){let t=e.lastSegment(),n=e.popLast(),r=this.index[t]||new tg(el.comparator),i=!r.has(n);return this.index[t]=r.add(n),i}has(e){let t=e.lastSegment(),n=e.popLast(),r=this.index[t];return r&&r.has(n)}getEntries(e){return(this.index[e]||new tg(el.comparator)).toArray()}}let si=new Uint8Array(0);class ss{constructor(e,t){this.databaseId=t,this.hn=new sr,this.Pn=new nG(e=>nw(e),(e,t)=>n_(e,t)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.hn.has(t)){let n=t.lastSegment(),r=t.popLast();e.addOnCommittedListener(()=>{this.hn.add(t)});let i={collectionId:n,parent:eV(r)};return sa(e).put(i)}return ek.resolve()}getCollectionParents(e,t){let n=[],r=IDBKeyRange.bound([t,""],[ei(t),""],!1,!0);return sa(e).U(r).next(e=>{for(let r of e){if(r.collectionId!==t)break;n.push(eW(r.parent))}return n})}addFieldIndex(e,t){let n=sl(e),r=function(e){return{indexId:e.indexId,collectionGroup:e.collectionGroup,fields:e.fields.map(e=>[e.fieldPath.canonicalString(),e.kind])}}(t);delete r.indexId;let i=n.add(r);if(t.indexState){let n=su(e);return i.next(e=>{n.put(iz(e,this.uid,t.indexState.sequenceNumber,t.indexState.offset))})}return i.next()}deleteFieldIndex(e,t){let n=sl(e),r=su(e),i=so(e);return n.delete(t.indexId).next(()=>r.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}deleteAllFieldIndexes(e){let t=sl(e),n=so(e),r=su(e);return t.j().next(()=>n.j()).next(()=>r.j())}createTargetIndexes(e,t){return ek.forEach(this.Tn(t),t=>this.getIndexType(e,t).next(n=>{if(0===n||1===n){let n=new i2(t).cn();if(null!=n)return this.addFieldIndex(e,n)}}))}getDocumentsMatchingTarget(e,t){let n=so(e),r=!0,i=new Map;return ek.forEach(this.Tn(t),t=>this.In(e,t).next(e=>{r&&(r=!!e),i.set(t,e)})).next(()=>{if(r){let e=n1(),r=[];return ek.forEach(i,(i,s)=>{P("IndexedDbIndexManager",`Using index ${function(e){return`id=${e.indexId}|cg=${e.collectionGroup}|f=${e.fields.map(e=>`${e.fieldPath}:${e.kind}`).join(",")}`}(i)} to execute ${nw(t)}`);let a=function(e,t){let n=ep(t);if(void 0===n)return null;for(let t of nT(e,n.fieldPath))switch(t.op){case"array-contains-any":return t.value.arrayValue.values||[];case"array-contains":return[t.value]}return null}(s,i),o=function(e,t){let n=new Map;for(let r of ef(t))for(let t of nT(e,r.fieldPath))switch(t.op){case"==":case"in":n.set(r.fieldPath.canonicalString(),t.value);break;case"not-in":case"!=":return n.set(r.fieldPath.canonicalString(),t.value),Array.from(n.values())}return null}(s,i),l=function(e,t){let n=[],r=!0;for(let i of ef(t)){let t=0===i.kind?nI(e,i.fieldPath,e.startAt):nk(e,i.fieldPath,e.startAt);n.push(t.value),r&&(r=t.inclusive)}return new t4(n,r)}(s,i),u=function(e,t){let n=[],r=!0;for(let i of ef(t)){let t=0===i.kind?nk(e,i.fieldPath,e.endAt):nI(e,i.fieldPath,e.endAt);n.push(t.value),r&&(r=t.inclusive)}return new t4(n,r)}(s,i),c=this.dn(i,s,l),h=this.dn(i,s,u),d=this.En(i,s,o),p=this.An(i.indexId,a,c,l.inclusive,h,u.inclusive,d);return ek.forEach(p,i=>n.G(i,t.limit).next(t=>{t.forEach(t=>{let n=eh.fromSegments(t.documentKey);e.has(n)||(e=e.add(n),r.push(n))})}))}).next(()=>r)}return ek.resolve(null)})}Tn(e){let t=this.Pn.get(e);return t||(t=0===e.filters.length?[e]:i4(nt.create(e.filters,"and")).map(t=>nv(e.path,e.collectionGroup,e.orderBy,t.getFilters(),e.limit,e.startAt,e.endAt)),this.Pn.set(e,t)),t}An(e,t,n,r,i,s,a){let o=(null!=t?t.length:1)*Math.max(n.length,i.length),l=o/(null!=t?t.length:1),u=[];for(let c=0;c<o;++c){let o=t?this.Rn(t[c/l]):si,h=this.Vn(e,o,n[c%l],r),d=this.mn(e,o,i[c%l],s),p=a.map(t=>this.Vn(e,o,t,!0));u.push(...this.createRange(h,d,p))}return u}Vn(e,t,n,r){let i=new iZ(e,eh.empty(),t,n);return r?i:i.en()}mn(e,t,n,r){let i=new iZ(e,eh.empty(),t,n);return r?i.en():i}In(e,t){let n=new i2(t),r=null!=t.collectionGroup?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,r).next(e=>{let t=null;for(let r of e)n.on(r)&&(!t||r.fields.length>t.fields.length)&&(t=r);return t})}getIndexType(e,t){let n=2,r=this.Tn(t);return ek.forEach(r,t=>this.In(e,t).next(e=>{e?0!==n&&e.fields.length<function(e){let t=new tg(ec.comparator),n=!1;for(let r of e.filters)for(let e of r.getFlattenedFilters())e.field.isKeyField()||("array-contains"===e.op||"array-contains-any"===e.op?n=!0:t=t.add(e.field));for(let n of e.orderBy)n.field.isKeyField()||(t=t.add(n.field));return t.size+(n?1:0)}(t)&&(n=1):n=0})).next(()=>(function(e){return null!==e.limit})(t)&&r.length>1&&2===n?1:n)}fn(e,t){let n=new iJ;for(let r of ef(e)){let e=t.data.field(r.fieldPath);if(null==e)return null;let i=n.Xt(r.kind);iq.Ft.dt(e,i)}return n.Ht()}Rn(e){let t=new iJ;return iq.Ft.dt(e,t.Xt(0)),t.Ht()}gn(e,t){let n=new iJ;return iq.Ft.dt(tU(this.databaseId,t),n.Xt(function(e){let t=ef(e);return 0===t.length?0:t[t.length-1].kind}(e))),n.Ht()}En(e,t,n){if(null===n)return[];let r=[];r.push(new iJ);let i=0;for(let s of ef(e)){let e=n[i++];for(let n of r)if(this.pn(t,s.fieldPath)&&tj(e))r=this.yn(r,s,e);else{let t=n.Xt(s.kind);iq.Ft.dt(e,t)}}return this.wn(r)}dn(e,t,n){return this.En(e,t,n.position)}wn(e){let t=[];for(let n=0;n<e.length;++n)t[n]=e[n].Ht();return t}yn(e,t,n){let r=[...e],i=[];for(let e of n.arrayValue.values||[])for(let n of r){let r=new iJ;r.seed(n.Ht()),iq.Ft.dt(e,r.Xt(t.kind)),i.push(r)}return i}pn(e,t){return!!e.filters.find(e=>e instanceof ne&&e.field.isEqual(t)&&("in"===e.op||"not-in"===e.op))}getFieldIndexes(e,t){let n=sl(e),r=su(e);return(t?n.U("collectionGroupIndex",IDBKeyRange.bound(t,t)):n.U()).next(e=>{let t=[];return ek.forEach(e,e=>r.get([e.indexId,this.uid]).next(n=>{t.push(function(e,t){let n=t?new ey(t.sequenceNumber,new ew(i$(t.readTime),new eh(eW(t.documentKey)),t.largestBatchId)):ey.empty(),r=e.fields.map(([e,t])=>new eg(ec.fromServerFormat(e),t));return new ed(e.indexId,e.collectionGroup,r,n)}(e,n))})).next(()=>t)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(e=>0===e.length?null:(e.sort((e,t)=>{let n=e.indexState.sequenceNumber-t.indexState.sequenceNumber;return 0!==n?n:en(e.collectionGroup,t.collectionGroup)}),e[0].collectionGroup))}updateCollectionGroup(e,t,n){let r=sl(e),i=su(e);return this.Sn(e).next(e=>r.U("collectionGroupIndex",IDBKeyRange.bound(t,t)).next(t=>ek.forEach(t,t=>i.put(iz(t.indexId,this.uid,e,n)))))}updateIndexEntries(e,t){let n=new Map;return ek.forEach(t,(t,r)=>{let i=n.get(t.collectionGroup);return(i?ek.resolve(i):this.getFieldIndexes(e,t.collectionGroup)).next(i=>(n.set(t.collectionGroup,i),ek.forEach(i,n=>this.bn(e,t,n).next(t=>{let i=this.Dn(r,n);return t.isEqual(i)?ek.resolve():this.vn(e,r,n,t,i)}))))})}Cn(e,t,n,r){return so(e).put({indexId:r.indexId,uid:this.uid,arrayValue:r.arrayValue,directionalValue:r.directionalValue,orderedDocumentKey:this.gn(n,t.key),documentKey:t.key.path.toArray()})}Fn(e,t,n,r){return so(e).delete([r.indexId,this.uid,r.arrayValue,r.directionalValue,this.gn(n,t.key),t.key.path.toArray()])}bn(e,t,n){let r=so(e),i=new tg(i0);return r.J({index:"documentKeyIndex",range:IDBKeyRange.only([n.indexId,this.uid,this.gn(n,t)])},(e,r)=>{i=i.add(new iZ(n.indexId,t,r.arrayValue,r.directionalValue))}).next(()=>i)}Dn(e,t){let n=new tg(i0),r=this.fn(t,e);if(null==r)return n;let i=ep(t);if(null!=i){let s=e.data.field(i.fieldPath);if(tj(s))for(let i of s.arrayValue.values||[])n=n.add(new iZ(t.indexId,e.key,this.Rn(i),r))}else n=n.add(new iZ(t.indexId,e.key,si,r));return n}vn(e,t,n,r,i){P("IndexedDbIndexManager","Updating index entries for document '%s'",t.key);let s=[];return function(e,t,n,r,i){let s=e.getIterator(),a=t.getIterator(),o=ty(s),l=ty(a);for(;o||l;){let e=!1,t=!1;if(o&&l){let r=n(o,l);r<0?t=!0:r>0&&(e=!0)}else null!=o?t=!0:e=!0;e?(r(l),l=ty(a)):t?(i(o),o=ty(s)):(o=ty(s),l=ty(a))}}(r,i,i0,r=>{s.push(this.Cn(e,t,n,r))},r=>{s.push(this.Fn(e,t,n,r))}),ek.waitFor(s)}Sn(e){let t=1;return su(e).J({index:"sequenceNumberIndex",reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(e,n,r)=>{r.done(),t=n.sequenceNumber+1}).next(()=>t)}createRange(e,t,n){n=n.sort((e,t)=>i0(e,t)).filter((e,t,n)=>!t||0!==i0(e,n[t-1]));let r=[];for(let i of(r.push(e),n)){let n=i0(i,e),s=i0(i,t);if(0===n)r[0]=e.en();else if(n>0&&s<0)r.push(i),r.push(i.en());else if(s>0)break}r.push(t);let i=[];for(let e=0;e<r.length;e+=2){if(this.Mn(r[e],r[e+1]))return[];let t=[r[e].indexId,this.uid,r[e].arrayValue,r[e].directionalValue,si,[]],n=[r[e+1].indexId,this.uid,r[e+1].arrayValue,r[e+1].directionalValue,si,[]];i.push(IDBKeyRange.bound(t,n))}return i}Mn(e,t){return i0(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(sc)}getMinOffset(e,t){return ek.mapArray(this.Tn(t),t=>this.In(e,t).next(e=>e||B())).next(sc)}}function sa(e){return tl(e,"collectionParents")}function so(e){return tl(e,"indexEntries")}function sl(e){return tl(e,"indexConfiguration")}function su(e){return tl(e,"indexState")}function sc(e){U(0!==e.length);let t=e[0].indexState.offset,n=t.largestBatchId;for(let r=1;r<e.length;r++){let i=e[r].indexState.offset;0>e_(i,t)&&(t=i),n<i.largestBatchId&&(n=i.largestBatchId)}return new ew(t.readTime,t.documentKey,n)}let sh={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class sd{static withCacheSize(e){return new sd(e,sd.DEFAULT_COLLECTION_PERCENTILE,sd.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,n){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=n}}function sp(e,t,n){let r=e.store("mutations"),i=e.store("documentMutations"),s=[],a=IDBKeyRange.only(n.batchId),o=0,l=r.J({range:a},(e,t,n)=>(o++,n.delete()));s.push(l.next(()=>{U(1===o)}));let u=[];for(let e of n.mutations){let r=eK(t,e.key.path,n.batchId);s.push(i.delete(r)),u.push(e.key)}return ek.waitFor(s).next(()=>u)}function sf(e){let t;if(!e)return 0;if(e.document)t=e.document;else if(e.unknownDocument)t=e.unknownDocument;else{if(!e.noDocument)throw B();t=e.noDocument}return JSON.stringify(t).length}sd.DEFAULT_COLLECTION_PERCENTILE=10,sd.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,sd.DEFAULT=new sd(0x2800000,sd.DEFAULT_COLLECTION_PERCENTILE,sd.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),sd.DISABLED=new sd(-1,0,0);class sg{constructor(e,t,n,r){this.userId=e,this.serializer=t,this.indexManager=n,this.referenceDelegate=r,this.xn={}}static Pt(e,t,n,r){return U(""!==e.uid),new sg(e.isAuthenticated()?e.uid:"",t,n,r)}checkEmpty(e){let t=!0,n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return sy(e).J({index:"userMutationsIndex",range:n},(e,n,r)=>{t=!1,r.done()}).next(()=>t)}addMutationBatch(e,t,n,r){let i=sb(e),s=sy(e);return s.add({}).next(a=>{U("number"==typeof a);let o=new rE(a,t,n,r),l=function(e,t,n){let r=n.baseMutations.map(t=>il(e.ht,t)),i=n.mutations.map(t=>il(e.ht,t));return{userId:t,batchId:n.batchId,localWriteTimeMs:n.localWriteTime.toMillis(),baseMutations:r,mutations:i}}(this.serializer,this.userId,o),u=[],c=new tg((e,t)=>en(e.canonicalString(),t.canonicalString()));for(let e of r){let t=eK(this.userId,e.key.path,a);c=c.add(e.key.path.popLast()),u.push(s.put(l)),u.push(i.put(t,eX))}return c.forEach(t=>{u.push(this.indexManager.addToCollectionParentIndex(e,t))}),e.addOnCommittedListener(()=>{this.xn[a]=o.keys()}),ek.waitFor(u).next(()=>o)})}lookupMutationBatch(e,t){return sy(e).get(t).next(e=>e?(U(e.userId===this.userId),iR(this.serializer,e)):null)}On(e,t){return this.xn[t]?ek.resolve(this.xn[t]):this.lookupMutationBatch(e,t).next(e=>{if(e){let n=e.keys();return this.xn[t]=n,n}return null})}getNextMutationBatchAfterBatchId(e,t){let n=t+1,r=IDBKeyRange.lowerBound([this.userId,n]),i=null;return sy(e).J({index:"userMutationsIndex",range:r},(e,t,r)=>{t.userId===this.userId&&(U(t.batchId>=n),i=iR(this.serializer,t)),r.done()}).next(()=>i)}getHighestUnacknowledgedBatchId(e){let t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),n=-1;return sy(e).J({index:"userMutationsIndex",range:t,reverse:!0},(e,t,r)=>{n=t.batchId,r.done()}).next(()=>n)}getAllMutationBatches(e){let t=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return sy(e).U("userMutationsIndex",t).next(e=>e.map(e=>iR(this.serializer,e)))}getAllMutationBatchesAffectingDocumentKey(e,t){let n=eH(this.userId,t.path),r=IDBKeyRange.lowerBound(n),i=[];return sb(e).J({range:r},(n,r,s)=>{let[a,o,l]=n,u=eW(o);if(a===this.userId&&t.path.isEqual(u))return sy(e).get(l).next(e=>{if(!e)throw B();U(e.userId===this.userId),i.push(iR(this.serializer,e))});s.done()}).next(()=>i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new tg(en),r=[];return t.forEach(t=>{let i=eH(this.userId,t.path),s=IDBKeyRange.lowerBound(i),a=sb(e).J({range:s},(e,r,i)=>{let[s,a,o]=e,l=eW(a);s===this.userId&&t.path.isEqual(l)?n=n.add(o):i.done()});r.push(a)}),ek.waitFor(r).next(()=>this.Nn(e,n))}getAllMutationBatchesAffectingQuery(e,t){let n=t.path,r=n.length+1,i=eH(this.userId,n),s=IDBKeyRange.lowerBound(i),a=new tg(en);return sb(e).J({range:s},(e,t,i)=>{let[s,o,l]=e,u=eW(o);s===this.userId&&n.isPrefixOf(u)?u.length===r&&(a=a.add(l)):i.done()}).next(()=>this.Nn(e,a))}Nn(e,t){let n=[],r=[];return t.forEach(t=>{r.push(sy(e).get(t).next(e=>{if(null===e)throw B();U(e.userId===this.userId),n.push(iR(this.serializer,e))}))}),ek.waitFor(r).next(()=>n)}removeMutationBatch(e,t){return sp(e._e,this.userId,t).next(n=>(e.addOnCommittedListener(()=>{this.Bn(t.batchId)}),ek.forEach(n,t=>this.referenceDelegate.markPotentiallyOrphaned(e,t))))}Bn(e){delete this.xn[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return ek.resolve();let n=IDBKeyRange.lowerBound(function(e){return[e]}(this.userId)),r=[];return sb(e).J({range:n},(e,t,n)=>{if(e[0]===this.userId){let t=eW(e[1]);r.push(t)}else n.done()}).next(()=>{U(0===r.length)})})}containsKey(e,t){return sm(e,this.userId,t)}Ln(e){return sv(e).get(this.userId).next(e=>e||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""})}}function sm(e,t,n){let r=eH(t,n.path),i=r[1],s=IDBKeyRange.lowerBound(r),a=!1;return sb(e).J({range:s,H:!0},(e,n,r)=>{let[s,o,l]=e;s===t&&o===i&&(a=!0),r.done()}).next(()=>a)}function sy(e){return tl(e,"mutations")}function sb(e){return tl(e,"documentMutations")}function sv(e){return tl(e,"mutationQueues")}class sw{constructor(e){this.kn=e}next(){return this.kn+=2,this.kn}static qn(){return new sw(0)}static Qn(){return new sw(-1)}}class s_{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.Kn(e).next(t=>{let n=new sw(t.highestTargetId);return t.highestTargetId=n.next(),this.$n(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.Kn(e).next(e=>ea.fromTimestamp(new es(e.lastRemoteSnapshotVersion.seconds,e.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.Kn(e).next(e=>e.highestListenSequenceNumber)}setTargetsMetadata(e,t,n){return this.Kn(e).next(r=>(r.highestListenSequenceNumber=t,n&&(r.lastRemoteSnapshotVersion=n.toTimestamp()),t>r.highestListenSequenceNumber&&(r.highestListenSequenceNumber=t),this.$n(e,r)))}addTargetData(e,t){return this.Un(e,t).next(()=>this.Kn(e).next(n=>(n.targetCount+=1,this.Wn(t,n),this.$n(e,n))))}updateTargetData(e,t){return this.Un(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>sx(e).delete(t.targetId)).next(()=>this.Kn(e)).next(t=>(U(t.targetCount>0),t.targetCount-=1,this.$n(e,t)))}removeTargets(e,t,n){let r=0,i=[];return sx(e).J((s,a)=>{let o=iD(a);o.sequenceNumber<=t&&null===n.get(o.targetId)&&(r++,i.push(this.removeTargetData(e,o)))}).next(()=>ek.waitFor(i)).next(()=>r)}forEachTarget(e,t){return sx(e).J((e,n)=>{t(iD(n))})}Kn(e){return sT(e).get("targetGlobalKey").next(e=>(U(null!==e),e))}$n(e,t){return sT(e).put("targetGlobalKey",t)}Un(e,t){return sx(e).put(iF(this.serializer,t))}Wn(e,t){let n=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,n=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,n=!0),n}getTargetCount(e){return this.Kn(e).next(e=>e.targetCount)}getTargetData(e,t){let n=nw(t),r=IDBKeyRange.bound([n,Number.NEGATIVE_INFINITY],[n,Number.POSITIVE_INFINITY]),i=null;return sx(e).J({range:r,index:"queryTargetsIndex"},(e,n,r)=>{let s=iD(n);n_(t,s.target)&&(i=s,r.done())}).next(()=>i)}addMatchingKeys(e,t,n){let r=[],i=sI(e);return t.forEach(t=>{let s=eV(t.path);r.push(i.put({targetId:n,path:s})),r.push(this.referenceDelegate.addReference(e,n,t))}),ek.waitFor(r)}removeMatchingKeys(e,t,n){let r=sI(e);return ek.forEach(t,t=>{let i=eV(t.path);return ek.waitFor([r.delete([n,i]),this.referenceDelegate.removeReference(e,n,t)])})}removeMatchingKeysForTargetId(e,t){let n=sI(e),r=IDBKeyRange.bound([t],[t+1],!1,!0);return n.delete(r)}getMatchingKeysForTargetId(e,t){let n=IDBKeyRange.bound([t],[t+1],!1,!0),r=sI(e),i=n1();return r.J({range:n,H:!0},(e,t,n)=>{let r=new eh(eW(e[1]));i=i.add(r)}).next(()=>i)}containsKey(e,t){let n=eV(t.path),r=IDBKeyRange.bound([n],[ei(n)],!1,!0),i=0;return sI(e).J({index:"documentTargetsIndex",H:!0,range:r},([e,t],n,r)=>{0!==e&&(i++,r.done())}).next(()=>i>0)}ut(e,t){return sx(e).get(t).next(e=>e?iD(e):null)}}function sx(e){return tl(e,"targets")}function sT(e){return tl(e,"targetGlobal")}function sI(e){return tl(e,"targetDocuments")}function sk([e,t],[n,r]){let i=en(e,n);return 0===i?en(t,r):i}class sS{constructor(e){this.Gn=e,this.buffer=new tg(sk),this.zn=0}jn(){return++this.zn}Hn(e){let t=[e,this.jn()];if(this.buffer.size<this.Gn)this.buffer=this.buffer.add(t);else{let e=this.buffer.last();0>sk(t,e)&&(this.buffer=this.buffer.delete(e).add(t))}}get maxValue(){return this.buffer.last()[0]}}class sE{constructor(e,t,n){this.garbageCollector=e,this.asyncQueue=t,this.localStore=n,this.Jn=null}start(){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.Yn(6e4)}stop(){this.Jn&&(this.Jn.cancel(),this.Jn=null)}get started(){return null!==this.Jn}Yn(e){P("LruGarbageCollector",`Garbage collection scheduled in ${e}ms`),this.Jn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.Jn=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(e){eO(e)?P("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",e):await eI(e)}await this.Yn(3e5)})}}class sC{constructor(e,t){this.Zn=e,this.params=t}calculateTargetCount(e,t){return this.Zn.Xn(e).next(e=>Math.floor(t/100*e))}nthSequenceNumber(e,t){if(0===t)return ek.resolve(eL.oe);let n=new sS(t);return this.Zn.forEachTarget(e,e=>n.Hn(e.sequenceNumber)).next(()=>this.Zn.er(e,e=>n.Hn(e))).next(()=>n.maxValue)}removeTargets(e,t,n){return this.Zn.removeTargets(e,t,n)}removeOrphanedDocuments(e,t){return this.Zn.removeOrphanedDocuments(e,t)}collect(e,t){return -1===this.params.cacheSizeCollectionThreshold?(P("LruGarbageCollector","Garbage collection skipped; disabled"),ek.resolve(sh)):this.getCacheSize(e).next(n=>n<this.params.cacheSizeCollectionThreshold?(P("LruGarbageCollector",`Garbage collection skipped; Cache size ${n} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),sh):this.tr(e,t))}getCacheSize(e){return this.Zn.getCacheSize(e)}tr(e,t){let n,r,i,s,a,o,l;let u=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(t=>(t>this.params.maximumSequenceNumbersToCollect?(P("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${t}`),r=this.params.maximumSequenceNumbersToCollect):r=t,s=Date.now(),this.nthSequenceNumber(e,r))).next(r=>(n=r,a=Date.now(),this.removeTargets(e,n,t))).next(t=>(i=t,o=Date.now(),this.removeOrphanedDocuments(e,n))).next(e=>(l=Date.now(),F()<=T.$b.DEBUG&&P("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${s-u}ms
	Determined least recently used ${r} in `+(a-s)+"ms\n"+`	Removed ${i} targets in `+(o-a)+"ms\n"+`	Removed ${e} documents in `+(l-o)+"ms\n"+`Total Duration: ${l-u}ms`),ek.resolve({didRun:!0,sequenceNumbersCollected:r,targetsRemoved:i,documentsRemoved:e})))}}function sA(e,t){return new sC(e,t)}class sN{constructor(e,t){this.db=e,this.garbageCollector=sA(this,t)}Xn(e){let t=this.nr(e);return this.db.getTargetCache().getTargetCount(e).next(e=>t.next(t=>e+t))}nr(e){let t=0;return this.er(e,e=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}er(e,t){return this.rr(e,(e,n)=>t(n))}addReference(e,t,n){return sO(e,n)}removeReference(e,t,n){return sO(e,n)}removeTargets(e,t,n){return this.db.getTargetCache().removeTargets(e,t,n)}markPotentiallyOrphaned(e,t){return sO(e,t)}ir(e,t){return function(e,t){let n=!1;return sv(e).Y(r=>sm(e,r,t).next(e=>(e&&(n=!0),ek.resolve(!e)))).next(()=>n)}(e,t)}removeOrphanedDocuments(e,t){let n=this.db.getRemoteDocumentCache().newChangeBuffer(),r=[],i=0;return this.rr(e,(s,a)=>{if(a<=t){let t=this.ir(e,s).next(t=>{if(!t)return i++,n.getEntry(e,s).next(()=>(n.removeEntry(s,ea.min()),sI(e).delete(function(e){return[0,eV(e.path)]}(s))))});r.push(t)}}).next(()=>ek.waitFor(r)).next(()=>n.apply(e)).next(()=>i)}removeTarget(e,t){let n=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,n)}updateLimboDocument(e,t){return sO(e,t)}rr(e,t){let n=sI(e),r,i=eL.oe;return n.J({index:"documentTargetsIndex"},([e,n],{path:s,sequenceNumber:a})=>{0===e?(i!==eL.oe&&t(new eh(eW(r)),i),i=a,r=s):i=eL.oe}).next(()=>{i!==eL.oe&&t(new eh(eW(r)),i)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function sO(e,t){return sI(e).put(function(e,t){return{targetId:0,path:eV(e.path),sequenceNumber:t}}(t,e.currentSequenceNumber))}class s${constructor(){this.changes=new nG(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,t3.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();let n=this.changes.get(t);return void 0!==n?ek.resolve(n):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class sR{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,n){return sM(e).put(n)}removeEntry(e,t,n){return sM(e).delete(function(e,t){let n=e.path.toArray();return[n.slice(0,n.length-2),n[n.length-2],iN(t),n[n.length-1]]}(t,n))}updateMetadata(e,t){return this.getMetadata(e).next(n=>(n.byteSize+=t,this.sr(e,n)))}getEntry(e,t){let n=t3.newInvalidDocument(t);return sM(e).J({index:"documentKeyIndex",range:IDBKeyRange.only(sL(t))},(e,r)=>{n=this._r(t,r)}).next(()=>n)}ar(e,t){let n={size:0,document:t3.newInvalidDocument(t)};return sM(e).J({index:"documentKeyIndex",range:IDBKeyRange.only(sL(t))},(e,r)=>{n={document:this._r(t,r),size:sf(r)}}).next(()=>n)}getEntries(e,t){let n=nq();return this.ur(e,t,(e,t)=>{let r=this._r(e,t);n=n.insert(e,r)}).next(()=>n)}cr(e,t){let n=nq(),r=new td(eh.comparator);return this.ur(e,t,(e,t)=>{let i=this._r(e,t);n=n.insert(e,i),r=r.insert(e,sf(t))}).next(()=>({documents:n,lr:r}))}ur(e,t,n){if(t.isEmpty())return ek.resolve();let r=new tg(sB);t.forEach(e=>r=r.add(e));let i=IDBKeyRange.bound(sL(r.first()),sL(r.last())),s=r.getIterator(),a=s.getNext();return sM(e).J({index:"documentKeyIndex",range:i},(e,t,r)=>{let i=eh.fromSegments([...t.prefixPath,t.collectionGroup,t.documentId]);for(;a&&0>sB(a,i);)n(a,null),a=s.getNext();a&&a.isEqual(i)&&(n(a,t),a=s.hasNext()?s.getNext():null),a?r.$(sL(a)):r.done()}).next(()=>{for(;a;)n(a,null),a=s.hasNext()?s.getNext():null})}getDocumentsMatchingQuery(e,t,n,r,i){let s=t.path,a=[s.popLast().toArray(),s.lastSegment(),iN(n.readTime),n.documentKey.path.isEmpty()?"":n.documentKey.path.lastSegment()],o=[s.popLast().toArray(),s.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return sM(e).U(IDBKeyRange.bound(a,o,!0)).next(e=>{null==i||i.incrementDocumentReadCount(e.length);let n=nq();for(let i of e){let e=this._r(eh.fromSegments(i.prefixPath.concat(i.collectionGroup,i.documentId)),i);e.isFoundDocument()&&(nB(t,e)||r.has(e.key))&&(n=n.insert(e.key,e))}return n})}getAllFromCollectionGroup(e,t,n,r){let i=nq(),s=sz(t,n),a=sz(t,ew.max());return sM(e).J({index:"collectionGroupIndex",range:IDBKeyRange.bound(s,a,!0)},(e,t,n)=>{let s=this._r(eh.fromSegments(t.prefixPath.concat(t.collectionGroup,t.documentId)),t);(i=i.insert(s.key,s)).size===r&&n.done()}).next(()=>i)}newChangeBuffer(e){return new sF(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(e=>e.byteSize)}getMetadata(e){return sP(e).get("remoteDocumentGlobalKey").next(e=>(U(!!e),e))}sr(e,t){return sP(e).put("remoteDocumentGlobalKey",t)}_r(e,t){if(t){let e=iC(this.serializer,t);if(!(e.isNoDocument()&&e.version.isEqual(ea.min())))return e}return t3.newInvalidDocument(e)}}function sD(e){return new sR(e)}class sF extends s${constructor(e,t){super(),this.hr=e,this.trackRemovals=t,this.Pr=new nG(e=>e.toString(),(e,t)=>e.isEqual(t))}applyChanges(e){let t=[],n=0,r=new tg((e,t)=>en(e.canonicalString(),t.canonicalString()));return this.changes.forEach((i,s)=>{let a=this.Pr.get(i);if(t.push(this.hr.removeEntry(e,i,a.readTime)),s.isValidDocument()){let o=iA(this.hr.serializer,s);r=r.add(i.path.popLast());let l=sf(o);n+=l-a.size,t.push(this.hr.addEntry(e,i,o))}else if(n-=a.size,this.trackRemovals){let n=iA(this.hr.serializer,s.convertToNoDocument(ea.min()));t.push(this.hr.addEntry(e,i,n))}}),r.forEach(n=>{t.push(this.hr.indexManager.addToCollectionParentIndex(e,n))}),t.push(this.hr.updateMetadata(e,n)),ek.waitFor(t)}getFromCache(e,t){return this.hr.ar(e,t).next(e=>(this.Pr.set(t,{size:e.size,readTime:e.document.readTime}),e.document))}getAllFromCache(e,t){return this.hr.cr(e,t).next(({documents:e,lr:t})=>(t.forEach((t,n)=>{this.Pr.set(t,{size:n,readTime:e.get(t).readTime})}),e))}}function sP(e){return tl(e,"remoteDocumentGlobal")}function sM(e){return tl(e,"remoteDocumentsV14")}function sL(e){let t=e.path.toArray();return[t.slice(0,t.length-2),t[t.length-2],t[t.length-1]]}function sz(e,t){let n=t.documentKey.path.toArray();return[e,iN(t.readTime),n.slice(0,n.length-2),n.length>0?n[n.length-1]:""]}function sB(e,t){let n=e.path.toArray(),r=t.path.toArray(),i=0;for(let e=0;e<n.length-2&&e<r.length-2;++e)if(i=en(n[e],r[e]))return i;return(i=en(n.length,r.length))||(i=en(n[n.length-2],r[r.length-2]))||en(n[n.length-1],r[r.length-1])}class sU{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class sV{constructor(e,t,n,r){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=n,this.indexManager=r}getDocument(e,t){let n=null;return this.documentOverlayCache.getOverlay(e,t).next(r=>(n=r,this.remoteDocumentCache.getEntry(e,t))).next(e=>(null!==n&&ry(n.mutation,e,tb.empty(),es.now()),e))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(t=>this.getLocalViewOfDocuments(e,t,n1()).next(()=>t))}getLocalViewOfDocuments(e,t,n=n1()){let r=nY();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,n).next(e=>{let t=nK();return e.forEach((e,n)=>{t=t.insert(e,n.overlayedDocument)}),t}))}getOverlayedDocuments(e,t){let n=nY();return this.populateOverlays(e,n,t).next(()=>this.computeViews(e,t,n,n1()))}populateOverlays(e,t,n){let r=[];return n.forEach(e=>{t.has(e)||r.push(e)}),this.documentOverlayCache.getOverlays(e,r).next(e=>{e.forEach((e,n)=>{t.set(e,n)})})}computeViews(e,t,n,r){let i=nq(),s=nJ(),a=function(){return nJ()}();return t.forEach((e,t)=>{let a=n.get(t.key);r.has(t.key)&&(void 0===a||a.mutation instanceof r_)?i=i.insert(t.key,t):void 0!==a?(s.set(t.key,a.mutation.getFieldMask()),ry(a.mutation,t,a.mutation.getFieldMask(),es.now())):s.set(t.key,tb.empty())}),this.recalculateAndSaveOverlays(e,i).next(e=>(e.forEach((e,t)=>s.set(e,t)),t.forEach((e,t)=>{var n;return a.set(e,new sU(t,null!==(n=s.get(e))&&void 0!==n?n:null))}),a))}recalculateAndSaveOverlays(e,t){let n=nJ(),r=new td((e,t)=>e-t),i=n1();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(e=>{for(let i of e)i.keys().forEach(e=>{let s=t.get(e);if(null===s)return;let a=n.get(e)||tb.empty();a=i.applyToLocalView(s,a),n.set(e,a);let o=(r.get(i.batchId)||n1()).add(e);r=r.insert(i.batchId,o)})}).next(()=>{let s=[],a=r.getReverseIterator();for(;a.hasNext();){let r=a.getNext(),o=r.key,l=r.value,u=nQ();l.forEach(e=>{if(!i.has(e)){let r=rg(t.get(e),n.get(e));null!==r&&u.set(e,r),i=i.add(e)}}),s.push(this.documentOverlayCache.saveOverlays(e,o,u))}return ek.waitFor(s)}).next(()=>n)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(t=>this.recalculateAndSaveOverlays(e,t))}getDocumentsMatchingQuery(e,t,n,r){return!function(e){return eh.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}(t)?nN(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,n,r):this.getDocumentsMatchingCollectionQuery(e,t,n,r):this.getDocumentsMatchingDocumentQuery(e,t.path)}getNextDocuments(e,t,n,r){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,n,r).next(i=>{let s=r-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,n.largestBatchId,r-i.size):ek.resolve(nY()),a=-1,o=i;return s.next(t=>ek.forEach(t,(t,n)=>(a<n.largestBatchId&&(a=n.largestBatchId),i.get(t)?ek.resolve():this.remoteDocumentCache.getEntry(e,t).next(e=>{o=o.insert(t,e)}))).next(()=>this.populateOverlays(e,t,i)).next(()=>this.computeViews(e,o,t,n1())).next(e=>({batchId:a,changes:nX(e)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new eh(t)).next(e=>{let t=nK();return e.isFoundDocument()&&(t=t.insert(e.key,e)),t})}getDocumentsMatchingCollectionGroupQuery(e,t,n,r){let i=t.collectionGroup,s=nK();return this.indexManager.getCollectionParents(e,i).next(a=>ek.forEach(a,a=>{let o=function(e,t){return new nS(t,null,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}(t,a.child(i));return this.getDocumentsMatchingCollectionQuery(e,o,n,r).next(e=>{e.forEach((e,t)=>{s=s.insert(e,t)})})}).next(()=>s))}getDocumentsMatchingCollectionQuery(e,t,n,r){let i;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,n.largestBatchId).next(s=>(i=s,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,n,i,r))).next(e=>{i.forEach((t,n)=>{let r=n.getKey();null===e.get(r)&&(e=e.insert(r,t3.newInvalidDocument(r)))});let n=nK();return e.forEach((e,r)=>{let s=i.get(e);void 0!==s&&ry(s.mutation,r,tb.empty(),es.now()),nB(t,r)&&(n=n.insert(e,r))}),n})}}class sj{constructor(e){this.serializer=e,this.Tr=new Map,this.Ir=new Map}getBundleMetadata(e,t){return ek.resolve(this.Tr.get(t))}saveBundleMetadata(e,t){return this.Tr.set(t.id,function(e){return{id:e.id,version:e.version,createTime:r3(e.createTime)}}(t)),ek.resolve()}getNamedQuery(e,t){return ek.resolve(this.Ir.get(t))}saveNamedQuery(e,t){return this.Ir.set(t.name,function(e){return{name:e.name,query:iP(e.bundledQuery),readTime:r3(e.readTime)}}(t)),ek.resolve()}}class sG{constructor(){this.overlays=new td(eh.comparator),this.dr=new Map}getOverlay(e,t){return ek.resolve(this.overlays.get(t))}getOverlays(e,t){let n=nY();return ek.forEach(t,t=>this.getOverlay(e,t).next(e=>{null!==e&&n.set(t,e)})).next(()=>n)}saveOverlays(e,t,n){return n.forEach((n,r)=>{this.Tt(e,t,r)}),ek.resolve()}removeOverlaysForBatchId(e,t,n){let r=this.dr.get(n);return void 0!==r&&(r.forEach(e=>this.overlays=this.overlays.remove(e)),this.dr.delete(n)),ek.resolve()}getOverlaysForCollection(e,t,n){let r=nY(),i=t.length+1,s=new eh(t.child("")),a=this.overlays.getIteratorFrom(s);for(;a.hasNext();){let e=a.getNext().value,s=e.getKey();if(!t.isPrefixOf(s.path))break;s.path.length===i&&e.largestBatchId>n&&r.set(e.getKey(),e)}return ek.resolve(r)}getOverlaysForCollectionGroup(e,t,n,r){let i=new td((e,t)=>e-t),s=this.overlays.getIterator();for(;s.hasNext();){let e=s.getNext().value;if(e.getKey().getCollectionGroup()===t&&e.largestBatchId>n){let t=i.get(e.largestBatchId);null===t&&(t=nY(),i=i.insert(e.largestBatchId,t)),t.set(e.getKey(),e)}}let a=nY(),o=i.getIterator();for(;o.hasNext()&&(o.getNext().value.forEach((e,t)=>a.set(e,t)),!(a.size()>=r)););return ek.resolve(a)}Tt(e,t,n){let r=this.overlays.get(n.key);if(null!==r){let e=this.dr.get(r.largestBatchId).delete(n.key);this.dr.set(r.largestBatchId,e)}this.overlays=this.overlays.insert(n.key,new rA(t,n));let i=this.dr.get(t);void 0===i&&(i=n1(),this.dr.set(t,i)),this.dr.set(t,i.add(n.key))}}class sW{constructor(){this.sessionToken=tw.EMPTY_BYTE_STRING}getSessionToken(e){return ek.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,ek.resolve()}}class sq{constructor(){this.Er=new tg(sH.Ar),this.Rr=new tg(sH.Vr)}isEmpty(){return this.Er.isEmpty()}addReference(e,t){let n=new sH(e,t);this.Er=this.Er.add(n),this.Rr=this.Rr.add(n)}mr(e,t){e.forEach(e=>this.addReference(e,t))}removeReference(e,t){this.gr(new sH(e,t))}pr(e,t){e.forEach(e=>this.removeReference(e,t))}yr(e){let t=new eh(new el([])),n=new sH(t,e),r=new sH(t,e+1),i=[];return this.Rr.forEachInRange([n,r],e=>{this.gr(e),i.push(e.key)}),i}wr(){this.Er.forEach(e=>this.gr(e))}gr(e){this.Er=this.Er.delete(e),this.Rr=this.Rr.delete(e)}Sr(e){let t=new eh(new el([])),n=new sH(t,e),r=new sH(t,e+1),i=n1();return this.Rr.forEachInRange([n,r],e=>{i=i.add(e.key)}),i}containsKey(e){let t=new sH(e,0),n=this.Er.firstAfterOrEqual(t);return null!==n&&e.isEqual(n.key)}}class sH{constructor(e,t){this.key=e,this.br=t}static Ar(e,t){return eh.comparator(e.key,t.key)||en(e.br,t.br)}static Vr(e,t){return en(e.br,t.br)||eh.comparator(e.key,t.key)}}class sK{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.Dr=1,this.vr=new tg(sH.Ar)}checkEmpty(e){return ek.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,n,r){let i=this.Dr;this.Dr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];let s=new rE(i,t,n,r);for(let t of(this.mutationQueue.push(s),r))this.vr=this.vr.add(new sH(t.key,i)),this.indexManager.addToCollectionParentIndex(e,t.key.path.popLast());return ek.resolve(s)}lookupMutationBatch(e,t){return ek.resolve(this.Cr(t))}getNextMutationBatchAfterBatchId(e,t){let n=t+1,r=this.Fr(n),i=r<0?0:r;return ek.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return ek.resolve(0===this.mutationQueue.length?-1:this.Dr-1)}getAllMutationBatches(e){return ek.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){let n=new sH(t,0),r=new sH(t,Number.POSITIVE_INFINITY),i=[];return this.vr.forEachInRange([n,r],e=>{let t=this.Cr(e.br);i.push(t)}),ek.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new tg(en);return t.forEach(e=>{let t=new sH(e,0),r=new sH(e,Number.POSITIVE_INFINITY);this.vr.forEachInRange([t,r],e=>{n=n.add(e.br)})}),ek.resolve(this.Mr(n))}getAllMutationBatchesAffectingQuery(e,t){let n=t.path,r=n.length+1,i=n;eh.isDocumentKey(i)||(i=i.child(""));let s=new sH(new eh(i),0),a=new tg(en);return this.vr.forEachWhile(e=>{let t=e.key.path;return!!n.isPrefixOf(t)&&(t.length===r&&(a=a.add(e.br)),!0)},s),ek.resolve(this.Mr(a))}Mr(e){let t=[];return e.forEach(e=>{let n=this.Cr(e);null!==n&&t.push(n)}),t}removeMutationBatch(e,t){U(0===this.Or(t.batchId,"removed")),this.mutationQueue.shift();let n=this.vr;return ek.forEach(t.mutations,r=>{let i=new sH(r.key,t.batchId);return n=n.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,r.key)}).next(()=>{this.vr=n})}Bn(e){}containsKey(e,t){let n=new sH(t,0),r=this.vr.firstAfterOrEqual(n);return ek.resolve(t.isEqual(r&&r.key))}performConsistencyCheck(e){return this.mutationQueue.length,ek.resolve()}Or(e,t){return this.Fr(e)}Fr(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}Cr(e){let t=this.Fr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class sX{constructor(e){this.Nr=e,this.docs=function(){return new td(eh.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){let n=t.key,r=this.docs.get(n),i=r?r.size:0,s=this.Nr(t);return this.docs=this.docs.insert(n,{document:t.mutableCopy(),size:s}),this.size+=s-i,this.indexManager.addToCollectionParentIndex(e,n.path.popLast())}removeEntry(e){let t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){let n=this.docs.get(t);return ek.resolve(n?n.document.mutableCopy():t3.newInvalidDocument(t))}getEntries(e,t){let n=nq();return t.forEach(e=>{let t=this.docs.get(e);n=n.insert(e,t?t.document.mutableCopy():t3.newInvalidDocument(e))}),ek.resolve(n)}getDocumentsMatchingQuery(e,t,n,r){let i=nq(),s=t.path,a=new eh(s.child("__id-9223372036854775808__")),o=this.docs.getIteratorFrom(a);for(;o.hasNext();){let{key:e,value:{document:a}}=o.getNext();if(!s.isPrefixOf(e.path))break;e.path.length>s.length+1||0>=e_(ev(a),n)||(r.has(a.key)||nB(t,a))&&(i=i.insert(a.key,a.mutableCopy()))}return ek.resolve(i)}getAllFromCollectionGroup(e,t,n,r){B()}Br(e,t){return ek.forEach(this.docs,e=>t(e))}newChangeBuffer(e){return new sY(this)}getSize(e){return ek.resolve(this.size)}}class sY extends s${constructor(e){super(),this.hr=e}applyChanges(e){let t=[];return this.changes.forEach((n,r)=>{r.isValidDocument()?t.push(this.hr.addEntry(e,r)):this.hr.removeEntry(n)}),ek.waitFor(t)}getFromCache(e,t){return this.hr.getEntry(e,t)}getAllFromCache(e,t){return this.hr.getEntries(e,t)}}class sQ{constructor(e){this.persistence=e,this.Lr=new nG(e=>nw(e),n_),this.lastRemoteSnapshotVersion=ea.min(),this.highestTargetId=0,this.kr=0,this.qr=new sq,this.targetCount=0,this.Qr=sw.qn()}forEachTarget(e,t){return this.Lr.forEach((e,n)=>t(n)),ek.resolve()}getLastRemoteSnapshotVersion(e){return ek.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return ek.resolve(this.kr)}allocateTargetId(e){return this.highestTargetId=this.Qr.next(),ek.resolve(this.highestTargetId)}setTargetsMetadata(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.kr&&(this.kr=t),ek.resolve()}Un(e){this.Lr.set(e.target,e);let t=e.targetId;t>this.highestTargetId&&(this.Qr=new sw(t),this.highestTargetId=t),e.sequenceNumber>this.kr&&(this.kr=e.sequenceNumber)}addTargetData(e,t){return this.Un(t),this.targetCount+=1,ek.resolve()}updateTargetData(e,t){return this.Un(t),ek.resolve()}removeTargetData(e,t){return this.Lr.delete(t.target),this.qr.yr(t.targetId),this.targetCount-=1,ek.resolve()}removeTargets(e,t,n){let r=0,i=[];return this.Lr.forEach((s,a)=>{a.sequenceNumber<=t&&null===n.get(a.targetId)&&(this.Lr.delete(s),i.push(this.removeMatchingKeysForTargetId(e,a.targetId)),r++)}),ek.waitFor(i).next(()=>r)}getTargetCount(e){return ek.resolve(this.targetCount)}getTargetData(e,t){let n=this.Lr.get(t)||null;return ek.resolve(n)}addMatchingKeys(e,t,n){return this.qr.mr(t,n),ek.resolve()}removeMatchingKeys(e,t,n){this.qr.pr(t,n);let r=this.persistence.referenceDelegate,i=[];return r&&t.forEach(t=>{i.push(r.markPotentiallyOrphaned(e,t))}),ek.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this.qr.yr(t),ek.resolve()}getMatchingKeysForTargetId(e,t){let n=this.qr.Sr(t);return ek.resolve(n)}containsKey(e,t){return ek.resolve(this.qr.containsKey(t))}}class sJ{constructor(e,t){this.Kr={},this.overlays={},this.$r=new eL(0),this.Ur=!1,this.Ur=!0,this.Wr=new sW,this.referenceDelegate=e(this),this.Gr=new sQ(this),this.indexManager=new sn,this.remoteDocumentCache=function(e){return new sX(e)}(e=>this.referenceDelegate.zr(e)),this.serializer=new iE(t),this.jr=new sj(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.Ur=!1,Promise.resolve()}get started(){return this.Ur}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new sG,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let n=this.Kr[e.toKey()];return n||(n=new sK(t,this.referenceDelegate),this.Kr[e.toKey()]=n),n}getGlobalsCache(){return this.Wr}getTargetCache(){return this.Gr}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.jr}runTransaction(e,t,n){P("MemoryPersistence","Starting transaction:",e);let r=new sZ(this.$r.next());return this.referenceDelegate.Hr(),n(r).next(e=>this.referenceDelegate.Jr(r).next(()=>e)).toPromise().then(e=>(r.raiseOnCommittedEvent(),e))}Yr(e,t){return ek.or(Object.values(this.Kr).map(n=>()=>n.containsKey(e,t)))}}class sZ extends eT{constructor(e){super(),this.currentSequenceNumber=e}}class s0{constructor(e){this.persistence=e,this.Zr=new sq,this.Xr=null}static ei(e){return new s0(e)}get ti(){if(this.Xr)return this.Xr;throw B()}addReference(e,t,n){return this.Zr.addReference(n,t),this.ti.delete(n.toString()),ek.resolve()}removeReference(e,t,n){return this.Zr.removeReference(n,t),this.ti.add(n.toString()),ek.resolve()}markPotentiallyOrphaned(e,t){return this.ti.add(t.toString()),ek.resolve()}removeTarget(e,t){this.Zr.yr(t.targetId).forEach(e=>this.ti.add(e.toString()));let n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,t.targetId).next(e=>{e.forEach(e=>this.ti.add(e.toString()))}).next(()=>n.removeTargetData(e,t))}Hr(){this.Xr=new Set}Jr(e){let t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return ek.forEach(this.ti,n=>{let r=eh.fromPath(n);return this.ni(e,r).next(e=>{e||t.removeEntry(r,ea.min())})}).next(()=>(this.Xr=null,t.apply(e)))}updateLimboDocument(e,t){return this.ni(e,t).next(e=>{e?this.ti.delete(t.toString()):this.ti.add(t.toString())})}zr(e){return 0}ni(e,t){return ek.or([()=>ek.resolve(this.Zr.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Yr(e,t)])}}class s1{constructor(e,t){this.persistence=e,this.ri=new nG(e=>eV(e.path),(e,t)=>e.isEqual(t)),this.garbageCollector=sA(this,t)}static ei(e,t){return new s1(e,t)}Hr(){}Jr(e){return ek.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}Xn(e){let t=this.nr(e);return this.persistence.getTargetCache().getTargetCount(e).next(e=>t.next(t=>e+t))}nr(e){let t=0;return this.er(e,e=>{t++}).next(()=>t)}er(e,t){return ek.forEach(this.ri,(n,r)=>this.ir(e,n,r).next(e=>e?ek.resolve():t(r)))}removeTargets(e,t,n){return this.persistence.getTargetCache().removeTargets(e,t,n)}removeOrphanedDocuments(e,t){let n=0,r=this.persistence.getRemoteDocumentCache(),i=r.newChangeBuffer();return r.Br(e,r=>this.ir(e,r,t).next(e=>{e||(n++,i.removeEntry(r,ea.min()))})).next(()=>i.apply(e)).next(()=>n)}markPotentiallyOrphaned(e,t){return this.ri.set(t,e.currentSequenceNumber),ek.resolve()}removeTarget(e,t){let n=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,n)}addReference(e,t,n){return this.ri.set(n,e.currentSequenceNumber),ek.resolve()}removeReference(e,t,n){return this.ri.set(n,e.currentSequenceNumber),ek.resolve()}updateLimboDocument(e,t){return this.ri.set(t,e.currentSequenceNumber),ek.resolve()}zr(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=tB(e.data.value)),t}ir(e,t,n){return ek.or([()=>this.persistence.Yr(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{let e=this.ri.get(t);return ek.resolve(void 0!==e&&e>n)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}class s2{constructor(e){this.serializer=e}O(e,t,n,r){let i=new eS("createOrUpgrade",t);n<1&&r>=1&&(!function(e){e.createObjectStore("owner")}(e),function(e){e.createObjectStore("mutationQueues",{keyPath:"userId"}),e.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",eq,{unique:!0}),e.createObjectStore("documentMutations")}(e),s3(e),function(e){e.createObjectStore("remoteDocuments")}(e));let s=ek.resolve();return n<3&&r>=3&&(0!==n&&(function(e){e.deleteObjectStore("targetDocuments"),e.deleteObjectStore("targets"),e.deleteObjectStore("targetGlobal")}(e),s3(e)),s=s.next(()=>(function(e){let t=e.store("targetGlobal"),n={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:ea.min().toTimestamp(),targetCount:0};return t.put("targetGlobalKey",n)})(i))),n<4&&r>=4&&(0!==n&&(s=s.next(()=>(function(e,t){return t.store("mutations").U().next(n=>{e.deleteObjectStore("mutations"),e.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",eq,{unique:!0});let r=t.store("mutations"),i=n.map(e=>r.put(e));return ek.waitFor(i)})})(e,i))),s=s.next(()=>{!function(e){e.createObjectStore("clientMetadata",{keyPath:"clientId"})}(e)})),n<5&&r>=5&&(s=s.next(()=>this.ii(i))),n<6&&r>=6&&(s=s.next(()=>((function(e){e.createObjectStore("remoteDocumentGlobal")})(e),this.si(i)))),n<7&&r>=7&&(s=s.next(()=>this.oi(i))),n<8&&r>=8&&(s=s.next(()=>this._i(e,i))),n<9&&r>=9&&(s=s.next(()=>{!function(e){e.objectStoreNames.contains("remoteDocumentChanges")&&e.deleteObjectStore("remoteDocumentChanges")}(e)})),n<10&&r>=10&&(s=s.next(()=>this.ai(i))),n<11&&r>=11&&(s=s.next(()=>{(function(e){e.createObjectStore("bundles",{keyPath:"bundleId"})})(e),function(e){e.createObjectStore("namedQueries",{keyPath:"name"})}(e)})),n<12&&r>=12&&(s=s.next(()=>{!function(e){let t=e.createObjectStore("documentOverlays",{keyPath:e8});t.createIndex("collectionPathOverlayIndex",e7,{unique:!1}),t.createIndex("collectionGroupOverlayIndex",e9,{unique:!1})}(e)})),n<13&&r>=13&&(s=s.next(()=>(function(e){let t=e.createObjectStore("remoteDocumentsV14",{keyPath:eY});t.createIndex("documentKeyIndex",eQ),t.createIndex("collectionGroupIndex",eJ)})(e)).next(()=>this.ui(e,i)).next(()=>e.deleteObjectStore("remoteDocuments"))),n<14&&r>=14&&(s=s.next(()=>this.ci(e,i))),n<15&&r>=15&&(s=s.next(()=>(function(e){e.createObjectStore("indexConfiguration",{keyPath:"indexId",autoIncrement:!0}).createIndex("collectionGroupIndex","collectionGroup",{unique:!1}),e.createObjectStore("indexState",{keyPath:e3}).createIndex("sequenceNumberIndex",e4,{unique:!1}),e.createObjectStore("indexEntries",{keyPath:e6}).createIndex("documentKeyIndex",e5,{unique:!1})})(e))),n<16&&r>=16&&(s=s.next(()=>{t.objectStore("indexState").clear()}).next(()=>{t.objectStore("indexEntries").clear()})),n<17&&r>=17&&(s=s.next(()=>{!function(e){e.createObjectStore("globals",{keyPath:"name"})}(e)})),s}si(e){let t=0;return e.store("remoteDocuments").J((e,n)=>{t+=sf(n)}).next(()=>{let n={byteSize:t};return e.store("remoteDocumentGlobal").put("remoteDocumentGlobalKey",n)})}ii(e){let t=e.store("mutationQueues"),n=e.store("mutations");return t.U().next(t=>ek.forEach(t,t=>{let r=IDBKeyRange.bound([t.userId,-1],[t.userId,t.lastAcknowledgedBatchId]);return n.U("userMutationsIndex",r).next(n=>ek.forEach(n,n=>{U(n.userId===t.userId);let r=iR(this.serializer,n);return sp(e,t.userId,r).next(()=>{})}))}))}oi(e){let t=e.store("targetDocuments"),n=e.store("remoteDocuments");return e.store("targetGlobal").get("targetGlobalKey").next(e=>{let r=[];return n.J((n,i)=>{let s=new el(n),a=function(e){return[0,eV(e)]}(s);r.push(t.get(a).next(n=>{let r;return n?ek.resolve():(r=s,t.put({targetId:0,path:eV(r),sequenceNumber:e.highestListenSequenceNumber}))}))}).next(()=>ek.waitFor(r))})}_i(e,t){e.createObjectStore("collectionParents",{keyPath:e2});let n=t.store("collectionParents"),r=new sr,i=e=>{if(r.add(e)){let t=e.lastSegment(),r=e.popLast();return n.put({collectionId:t,parent:eV(r)})}};return t.store("remoteDocuments").J({H:!0},(e,t)=>i(new el(e).popLast())).next(()=>t.store("documentMutations").J({H:!0},([e,t,n],r)=>i(eW(t).popLast())))}ai(e){let t=e.store("targets");return t.J((e,n)=>{let r=iD(n),i=iF(this.serializer,r);return t.put(i)})}ui(e,t){let n=t.store("remoteDocuments"),r=[];return n.J((e,n)=>{let i=t.store("remoteDocumentsV14"),s=(function(e){return e.document?new eh(el.fromString(e.document.name).popFirst(5)):e.noDocument?eh.fromSegments(e.noDocument.path):e.unknownDocument?eh.fromSegments(e.unknownDocument.path):B()})(n).path.toArray(),a={prefixPath:s.slice(0,s.length-2),collectionGroup:s[s.length-2],documentId:s[s.length-1],readTime:n.readTime||[0,0],unknownDocument:n.unknownDocument,noDocument:n.noDocument,document:n.document,hasCommittedMutations:!!n.hasCommittedMutations};r.push(i.put(a))}).next(()=>ek.waitFor(r))}ci(e,t){let n=t.store("mutations"),r=sD(this.serializer),i=new sJ(s0.ei,this.serializer.ht);return n.U().next(e=>{let n=new Map;return e.forEach(e=>{var t;let r=null!==(t=n.get(e.userId))&&void 0!==t?t:n1();iR(this.serializer,e).keys().forEach(e=>r=r.add(e)),n.set(e.userId,r)}),ek.forEach(n,(e,n)=>{let s=new $(n),a=ij.Pt(this.serializer,s),o=i.getIndexManager(s);return new sV(r,sg.Pt(s,this.serializer,o,i.referenceDelegate),a,o).recalculateAndSaveOverlaysForDocumentKeys(new to(t,eL.oe),e).next()})})}}function s3(e){e.createObjectStore("targetDocuments",{keyPath:e0}).createIndex("documentTargetsIndex",e1,{unique:!0}),e.createObjectStore("targets",{keyPath:"targetId"}).createIndex("queryTargetsIndex",eZ,{unique:!0}),e.createObjectStore("targetGlobal")}let s4="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.";class s6{constructor(e,t,n,r,i,s,a,o,l,u,c=17){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=n,this.li=i,this.window=s,this.document=a,this.hi=l,this.Pi=u,this.Ti=c,this.$r=null,this.Ur=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Ii=null,this.inForeground=!1,this.di=null,this.Ei=null,this.Ai=Number.NEGATIVE_INFINITY,this.Ri=e=>Promise.resolve(),!s6.p())throw new G(j.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new sN(this,r),this.Vi=t+"main",this.serializer=new iE(o),this.mi=new eE(this.Vi,this.Ti,new s2(this.serializer)),this.Wr=new iW,this.Gr=new s_(this.referenceDelegate,this.serializer),this.remoteDocumentCache=sD(this.serializer),this.jr=new iB,this.window&&this.window.localStorage?this.fi=this.window.localStorage:(this.fi=null,!1===u&&M("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.gi().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new G(j.FAILED_PRECONDITION,s4);return this.pi(),this.yi(),this.wi(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.Gr.getHighestSequenceNumber(e))}).then(e=>{this.$r=new eL(e,this.hi)}).then(()=>{this.Ur=!0}).catch(e=>(this.mi&&this.mi.close(),Promise.reject(e)))}Si(e){return this.Ri=async t=>{if(this.started)return e(t)},e(this.isPrimary)}setDatabaseDeletedListener(e){this.mi.B(async t=>{null===t.newVersion&&await e()})}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.li.enqueueAndForget(async()=>{this.started&&await this.gi()}))}gi(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>s8(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.bi(e).next(e=>{e||(this.isPrimary=!1,this.li.enqueueRetryable(()=>this.Ri(!1)))})}).next(()=>this.Di(e)).next(t=>this.isPrimary&&!t?this.vi(e).next(()=>!1):!!t&&this.Ci(e).next(()=>!0))).catch(e=>{if(eO(e))return P("IndexedDbPersistence","Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return P("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.li.enqueueRetryable(()=>this.Ri(e)),this.isPrimary=e})}bi(e){return s5(e).get("owner").next(e=>ek.resolve(this.Fi(e)))}Mi(e){return s8(e).delete(this.clientId)}async xi(){if(this.isPrimary&&!this.Oi(this.Ai,18e5)){this.Ai=Date.now();let e=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",e=>{let t=tl(e,"clientMetadata");return t.U().next(e=>{let n=this.Ni(e,18e5),r=e.filter(e=>-1===n.indexOf(e));return ek.forEach(r,e=>t.delete(e.clientId)).next(()=>r)})}).catch(()=>[]);if(this.fi)for(let t of e)this.fi.removeItem(this.Bi(t.clientId))}}wi(){this.Ei=this.li.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.gi().then(()=>this.xi()).then(()=>this.wi()))}Fi(e){return!!e&&e.ownerId===this.clientId}Di(e){return this.Pi?ek.resolve(!0):s5(e).get("owner").next(t=>{if(null!==t&&this.Oi(t.leaseTimestampMs,5e3)&&!this.Li(t.ownerId)){if(this.Fi(t)&&this.networkEnabled)return!0;if(!this.Fi(t)){if(!t.allowTabSynchronization)throw new G(j.FAILED_PRECONDITION,s4);return!1}}return!(!this.networkEnabled||!this.inForeground)||s8(e).U().next(e=>void 0===this.Ni(e,5e3).find(e=>{if(this.clientId!==e.clientId){let t=!this.networkEnabled&&e.networkEnabled,n=!this.inForeground&&e.inForeground,r=this.networkEnabled===e.networkEnabled;if(t||n&&r)return!0}return!1}))}).next(e=>(this.isPrimary!==e&&P("IndexedDbPersistence",`Client ${e?"is":"is not"} eligible for a primary lease.`),e))}async shutdown(){this.Ur=!1,this.ki(),this.Ei&&(this.Ei.cancel(),this.Ei=null),this.qi(),this.Qi(),await this.mi.runTransaction("shutdown","readwrite",["owner","clientMetadata"],e=>{let t=new to(e,eL.oe);return this.vi(t).next(()=>this.Mi(t))}),this.mi.close(),this.Ki()}Ni(e,t){return e.filter(e=>this.Oi(e.updateTimeMs,t)&&!this.Li(e.clientId))}$i(){return this.runTransaction("getActiveClients","readonly",e=>s8(e).U().next(e=>this.Ni(e,18e5).map(e=>e.clientId)))}get started(){return this.Ur}getGlobalsCache(){return this.Wr}getMutationQueue(e,t){return sg.Pt(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.Gr}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new ss(e,this.serializer.ht.databaseId)}getDocumentOverlayCache(e){return ij.Pt(this.serializer,e)}getBundleCache(){return this.jr}runTransaction(e,t,n){let r;P("IndexedDbPersistence","Starting transaction:",e);let i="readonly"===t?"readonly":"readwrite",s=function(e){return 17===e?ta:16===e?ts:15===e?ti:14===e?tr:13===e?tn:12===e?tt:11===e?te:void B()}(this.Ti);return this.mi.runTransaction(e,i,s,i=>(r=new to(i,this.$r?this.$r.next():eL.oe),"readwrite-primary"===t?this.bi(r).next(e=>!!e||this.Di(r)).next(t=>{if(!t)throw M(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.li.enqueueRetryable(()=>this.Ri(!1)),new G(j.FAILED_PRECONDITION,ex);return n(r)}).next(e=>this.Ci(r).next(()=>e)):this.Ui(r).next(()=>n(r)))).then(e=>(r.raiseOnCommittedEvent(),e))}Ui(e){return s5(e).get("owner").next(e=>{if(null!==e&&this.Oi(e.leaseTimestampMs,5e3)&&!this.Li(e.ownerId)&&!this.Fi(e)&&!(this.Pi||this.allowTabSynchronization&&e.allowTabSynchronization))throw new G(j.FAILED_PRECONDITION,s4)})}Ci(e){let t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return s5(e).put("owner",t)}static p(){return eE.p()}vi(e){let t=s5(e);return t.get("owner").next(e=>this.Fi(e)?(P("IndexedDbPersistence","Releasing primary lease."),t.delete("owner")):ek.resolve())}Oi(e,t){let n=Date.now();return!(e<n-t)&&(!(e>n)||(M(`Detected an update time that is in the future: ${e} > ${n}`),!1))}pi(){null!==this.document&&"function"==typeof this.document.addEventListener&&(this.di=()=>{this.li.enqueueAndForget(()=>(this.inForeground="visible"===this.document.visibilityState,this.gi()))},this.document.addEventListener("visibilitychange",this.di),this.inForeground="visible"===this.document.visibilityState)}qi(){this.di&&(this.document.removeEventListener("visibilitychange",this.di),this.di=null)}yi(){var e;"function"==typeof(null===(e=this.window)||void 0===e?void 0:e.addEventListener)&&(this.Ii=()=>{this.ki();let e=/(?:Version|Mobile)\/1[456]/;(0,I.nr)()&&(navigator.appVersion.match(e)||navigator.userAgent.match(e))&&this.li.enterRestrictedMode(!0),this.li.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.Ii))}Qi(){this.Ii&&(this.window.removeEventListener("pagehide",this.Ii),this.Ii=null)}Li(e){var t;try{let n=null!==(null===(t=this.fi)||void 0===t?void 0:t.getItem(this.Bi(e)));return P("IndexedDbPersistence",`Client '${e}' ${n?"is":"is not"} zombied in LocalStorage`),n}catch(e){return M("IndexedDbPersistence","Failed to get zombied client id.",e),!1}}ki(){if(this.fi)try{this.fi.setItem(this.Bi(this.clientId),String(Date.now()))}catch(e){M("Failed to set zombie client id.",e)}}Ki(){if(this.fi)try{this.fi.removeItem(this.Bi(this.clientId))}catch(e){}}Bi(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function s5(e){return tl(e,"owner")}function s8(e){return tl(e,"clientMetadata")}function s7(e,t){let n=e.projectId;return e.isDefaultDatabase||(n+="."+e.database),"firestore/"+t+"/"+n+"/"}class s9{constructor(e,t,n,r){this.targetId=e,this.fromCache=t,this.Wi=n,this.Gi=r}static zi(e,t){let n=n1(),r=n1();for(let e of t.docChanges)switch(e.type){case 0:n=n.add(e.doc.key);break;case 1:r=r.add(e.doc.key)}return new s9(e,t.fromCache,n,r)}}class ae{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}class at{constructor(){this.ji=!1,this.Hi=!1,this.Ji=100,this.Yi=function(){return(0,I.nr)()?8:eC((0,I.ZQ)())>0?6:4}()}initialize(e,t){this.Zi=e,this.indexManager=t,this.ji=!0}getDocumentsMatchingQuery(e,t,n,r){let i={result:null};return this.Xi(e,t).next(e=>{i.result=e}).next(()=>{if(!i.result)return this.es(e,t,r,n).next(e=>{i.result=e})}).next(()=>{if(i.result)return;let n=new ae;return this.ts(e,t,n).next(r=>{if(i.result=r,this.Hi)return this.ns(e,t,n,r.size)})}).next(()=>i.result)}ns(e,t,n,r){return n.documentReadCount<this.Ji?(F()<=T.$b.DEBUG&&P("QueryEngine","SDK will not create cache indexes for query:",nz(t),"since it only creates cache indexes for collection contains","more than or equal to",this.Ji,"documents"),ek.resolve()):(F()<=T.$b.DEBUG&&P("QueryEngine","Query:",nz(t),"scans",n.documentReadCount,"local documents and returns",r,"documents as results."),n.documentReadCount>this.Yi*r?(F()<=T.$b.DEBUG&&P("QueryEngine","The SDK decides to create cache indexes for query:",nz(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,n$(t))):ek.resolve())}Xi(e,t){if(nA(t))return ek.resolve(null);let n=n$(t);return this.indexManager.getIndexType(e,n).next(r=>0===r?null:(null!==t.limit&&1===r&&(n=n$(t=nP(t,null,"F"))),this.indexManager.getDocumentsMatchingTarget(e,n).next(r=>{let i=n1(...r);return this.Zi.getDocuments(e,i).next(r=>this.indexManager.getMinOffset(e,n).next(n=>{let s=this.rs(t,r);return this.ss(t,s,i,n.readTime)?this.Xi(e,nP(t,null,"F")):this.os(e,s,t,n)}))})))}es(e,t,n,r){return nA(t)||r.isEqual(ea.min())?ek.resolve(null):this.Zi.getDocuments(e,n).next(i=>{let s=this.rs(t,i);return this.ss(t,s,n,r)?ek.resolve(null):(F()<=T.$b.DEBUG&&P("QueryEngine","Re-using previous result from %s to execute query: %s",r.toString(),nz(t)),this.os(e,s,t,eb(r,-1)).next(e=>e))})}rs(e,t){let n=new tg(nV(e));return t.forEach((t,r)=>{nB(e,r)&&(n=n.add(r))}),n}ss(e,t,n,r){if(null===e.limit)return!1;if(n.size!==t.size)return!0;let i="F"===e.limitType?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(r)>0)}ts(e,t,n){return F()<=T.$b.DEBUG&&P("QueryEngine","Using full collection scan to execute query:",nz(t)),this.Zi.getDocumentsMatchingQuery(e,t,ew.min(),n)}os(e,t,n,r){return this.Zi.getDocumentsMatchingQuery(e,n,r).next(e=>(t.forEach(t=>{e=e.insert(t.key,t)}),e))}}class an{constructor(e,t,n,r){this.persistence=e,this._s=t,this.serializer=r,this.us=new td(en),this.cs=new nG(e=>nw(e),n_),this.ls=new Map,this.hs=e.getRemoteDocumentCache(),this.Gr=e.getTargetCache(),this.jr=e.getBundleCache(),this.Ps(n)}Ps(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new sV(this.hs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.hs.setIndexManager(this.indexManager),this._s.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.us))}}function ar(e,t,n,r){return new an(e,t,n,r)}async function ai(e,t){let n=V(e);return await n.persistence.runTransaction("Handle user change","readonly",e=>{let r;return n.mutationQueue.getAllMutationBatches(e).next(i=>(r=i,n.Ps(t),n.mutationQueue.getAllMutationBatches(e))).next(t=>{let i=[],s=[],a=n1();for(let e of r)for(let t of(i.push(e.batchId),e.mutations))a=a.add(t.key);for(let e of t)for(let t of(s.push(e.batchId),e.mutations))a=a.add(t.key);return n.localDocuments.getDocuments(e,a).next(e=>({Ts:e,removedBatchIds:i,addedBatchIds:s}))})})}function as(e,t){let n=V(e);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",e=>{let r=t.batch.keys(),i=n.hs.newChangeBuffer({trackRemovals:!0});return(function(e,t,n,r){let i=n.batch,s=i.keys(),a=ek.resolve();return s.forEach(e=>{a=a.next(()=>r.getEntry(t,e)).next(t=>{let s=n.docVersions.get(e);U(null!==s),0>t.version.compareTo(s)&&(i.applyToRemoteDocument(t,n),t.isValidDocument()&&(t.setReadTime(n.commitVersion),r.addEntry(t)))})}),a.next(()=>e.mutationQueue.removeMutationBatch(t,i))})(n,e,t,i).next(()=>i.apply(e)).next(()=>n.mutationQueue.performConsistencyCheck(e)).next(()=>n.documentOverlayCache.removeOverlaysForBatchId(e,r,t.batch.batchId)).next(()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,function(e){let t=n1();for(let n=0;n<e.mutationResults.length;++n)e.mutationResults[n].transformResults.length>0&&(t=t.add(e.batch.mutations[n].key));return t}(t))).next(()=>n.localDocuments.getDocuments(e,r))})}function aa(e){let t=V(e);return t.persistence.runTransaction("Get last remote snapshot version","readonly",e=>t.Gr.getLastRemoteSnapshotVersion(e))}function ao(e,t){let n=V(e),r=t.snapshotVersion,i=n.us;return n.persistence.runTransaction("Apply remote event","readwrite-primary",e=>{let s=n.hs.newChangeBuffer({trackRemovals:!0});i=n.us;let a=[];t.targetChanges.forEach((s,o)=>{let l=i.get(o);if(!l)return;a.push(n.Gr.removeMatchingKeys(e,s.removedDocuments,o).next(()=>n.Gr.addMatchingKeys(e,s.addedDocuments,o)));let u=l.withSequenceNumber(e.currentSequenceNumber);null!==t.targetMismatches.get(o)?u=u.withResumeToken(tw.EMPTY_BYTE_STRING,ea.min()).withLastLimboFreeSnapshotVersion(ea.min()):s.resumeToken.approximateByteSize()>0&&(u=u.withResumeToken(s.resumeToken,r)),i=i.insert(o,u),function(e,t,n){return!!(0===e.resumeToken.approximateByteSize()||t.snapshotVersion.toMicroseconds()-e.snapshotVersion.toMicroseconds()>=3e8)||n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size>0}(l,u,s)&&a.push(n.Gr.updateTargetData(e,u))});let o=nq(),l=n1();if(t.documentUpdates.forEach(r=>{t.resolvedLimboDocuments.has(r)&&a.push(n.persistence.referenceDelegate.updateLimboDocument(e,r))}),a.push(al(e,s,t.documentUpdates).next(e=>{o=e.Is,l=e.ds})),!r.isEqual(ea.min())){let t=n.Gr.getLastRemoteSnapshotVersion(e).next(t=>n.Gr.setTargetsMetadata(e,e.currentSequenceNumber,r));a.push(t)}return ek.waitFor(a).next(()=>s.apply(e)).next(()=>n.localDocuments.getLocalViewOfDocuments(e,o,l)).next(()=>o)}).then(e=>(n.us=i,e))}function al(e,t,n){let r=n1(),i=n1();return n.forEach(e=>r=r.add(e)),t.getEntries(e,r).next(e=>{let r=nq();return n.forEach((n,s)=>{let a=e.get(n);s.isFoundDocument()!==a.isFoundDocument()&&(i=i.add(n)),s.isNoDocument()&&s.version.isEqual(ea.min())?(t.removeEntry(n,s.readTime),r=r.insert(n,s)):!a.isValidDocument()||s.version.compareTo(a.version)>0||0===s.version.compareTo(a.version)&&a.hasPendingWrites?(t.addEntry(s),r=r.insert(n,s)):P("LocalStore","Ignoring outdated watch update for ",n,". Current version:",a.version," Watch version:",s.version)}),{Is:r,ds:i}})}function au(e,t){let n=V(e);return n.persistence.runTransaction("Get next mutation batch","readonly",e=>(void 0===t&&(t=-1),n.mutationQueue.getNextMutationBatchAfterBatchId(e,t)))}function ac(e,t){let n=V(e);return n.persistence.runTransaction("Allocate target","readwrite",e=>{let r;return n.Gr.getTargetData(e,t).next(i=>i?(r=i,ek.resolve(r)):n.Gr.allocateTargetId(e).next(i=>(r=new iS(t,i,"TargetPurposeListen",e.currentSequenceNumber),n.Gr.addTargetData(e,r).next(()=>r))))}).then(e=>{let r=n.us.get(e.targetId);return(null===r||e.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(n.us=n.us.insert(e.targetId,e),n.cs.set(t,e.targetId)),e})}async function ah(e,t,n){let r=V(e),i=r.us.get(t),s=n?"readwrite":"readwrite-primary";try{n||await r.persistence.runTransaction("Release target",s,e=>r.persistence.referenceDelegate.removeTarget(e,i))}catch(e){if(!eO(e))throw e;P("LocalStore",`Failed to update sequence numbers for target ${t}: ${e}`)}r.us=r.us.remove(t),r.cs.delete(i.target)}function ad(e,t,n){let r=V(e),i=ea.min(),s=n1();return r.persistence.runTransaction("Execute query","readwrite",e=>(function(e,t,n){let r=V(e),i=r.cs.get(n);return void 0!==i?ek.resolve(r.us.get(i)):r.Gr.getTargetData(t,n)})(r,e,n$(t)).next(t=>{if(t)return i=t.lastLimboFreeSnapshotVersion,r.Gr.getMatchingKeysForTargetId(e,t.targetId).next(e=>{s=e})}).next(()=>r._s.getDocumentsMatchingQuery(e,t,n?i:ea.min(),n?s:n1())).next(e=>(ag(r,nU(t),e),{documents:e,Es:s})))}function ap(e,t){let n=V(e),r=V(n.Gr),i=n.us.get(t);return i?Promise.resolve(i.target):n.persistence.runTransaction("Get target data","readonly",e=>r.ut(e,t).next(e=>e?e.target:null))}function af(e,t){let n=V(e),r=n.ls.get(t)||ea.min();return n.persistence.runTransaction("Get new document changes","readonly",e=>n.hs.getAllFromCollectionGroup(e,t,eb(r,-1),Number.MAX_SAFE_INTEGER)).then(e=>(ag(n,t,e),e))}function ag(e,t,n){let r=e.ls.get(t)||ea.min();n.forEach((e,t)=>{t.readTime.compareTo(r)>0&&(r=t.readTime)}),e.ls.set(t,r)}async function am(e,t,n,r){let i=V(e),s=n1(),a=nq();for(let e of n){let n=t.As(e.metadata.name);e.document&&(s=s.add(n));let r=t.Rs(e);r.setReadTime(t.Vs(e.metadata.readTime)),a=a.insert(n,r)}let o=i.hs.newChangeBuffer({trackRemovals:!0}),l=await ac(i,function(e){return n$(nC(el.fromString(`__bundle__/docs/${e}`)))}(r));return i.persistence.runTransaction("Apply bundle documents","readwrite",e=>al(e,o,a).next(t=>(o.apply(e),t)).next(t=>i.Gr.removeMatchingKeysForTargetId(e,l.targetId).next(()=>i.Gr.addMatchingKeys(e,s,l.targetId)).next(()=>i.localDocuments.getLocalViewOfDocuments(e,t.Is,t.ds)).next(()=>t.Is)))}async function ay(e,t,n=n1()){let r=await ac(e,n$(iP(t.bundledQuery))),i=V(e);return i.persistence.runTransaction("Save named query","readwrite",e=>{let s=r3(t.readTime);if(r.snapshotVersion.compareTo(s)>=0)return i.jr.saveNamedQuery(e,t);let a=r.withResumeToken(tw.EMPTY_BYTE_STRING,s);return i.us=i.us.insert(a.targetId,a),i.Gr.updateTargetData(e,a).next(()=>i.Gr.removeMatchingKeysForTargetId(e,r.targetId)).next(()=>i.Gr.addMatchingKeys(e,n,r.targetId)).next(()=>i.jr.saveNamedQuery(e,t))})}function ab(e,t){return`firestore_clients_${e}_${t}`}function av(e,t,n){let r=`firestore_mutations_${e}_${n}`;return t.isAuthenticated()&&(r+=`_${t.uid}`),r}function aw(e,t){return`firestore_targets_${e}_${t}`}class a_{constructor(e,t,n,r){this.user=e,this.batchId=t,this.state=n,this.error=r}static fs(e,t,n){let r=JSON.parse(n),i,s="object"==typeof r&&-1!==["pending","acknowledged","rejected"].indexOf(r.state)&&(void 0===r.error||"object"==typeof r.error);return s&&r.error&&(s="string"==typeof r.error.message&&"string"==typeof r.error.code)&&(i=new G(r.error.code,r.error.message)),s?new a_(e,t,r.state,i):(M("SharedClientState",`Failed to parse mutation state for ID '${t}': ${n}`),null)}gs(){let e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class ax{constructor(e,t,n){this.targetId=e,this.state=t,this.error=n}static fs(e,t){let n=JSON.parse(t),r,i="object"==typeof n&&-1!==["not-current","current","rejected"].indexOf(n.state)&&(void 0===n.error||"object"==typeof n.error);return i&&n.error&&(i="string"==typeof n.error.message&&"string"==typeof n.error.code)&&(r=new G(n.error.code,n.error.message)),i?new ax(e,n.state,r):(M("SharedClientState",`Failed to parse target state for ID '${e}': ${t}`),null)}gs(){let e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class aT{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static fs(e,t){let n=JSON.parse(t),r="object"==typeof n&&n.activeTargetIds instanceof Array,i=n3();for(let e=0;r&&e<n.activeTargetIds.length;++e)r=eU(n.activeTargetIds[e]),i=i.add(n.activeTargetIds[e]);return r?new aT(e,i):(M("SharedClientState",`Failed to parse client data for instance '${e}': ${t}`),null)}}class aI{constructor(e,t){this.clientId=e,this.onlineState=t}static fs(e){let t=JSON.parse(e);return"object"==typeof t&&-1!==["Unknown","Online","Offline"].indexOf(t.onlineState)&&"string"==typeof t.clientId?new aI(t.clientId,t.onlineState):(M("SharedClientState",`Failed to parse online state: ${e}`),null)}}class ak{constructor(){this.activeTargetIds=n3()}ps(e){this.activeTargetIds=this.activeTargetIds.add(e)}ys(e){this.activeTargetIds=this.activeTargetIds.delete(e)}gs(){return JSON.stringify({activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()})}}class aS{constructor(e,t,n,r,i){this.window=e,this.li=t,this.persistenceKey=n,this.ws=r,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.Ss=this.bs.bind(this),this.Ds=new td(en),this.started=!1,this.vs=[];let s=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.Cs=ab(this.persistenceKey,this.ws),this.Fs=function(e){return`firestore_sequence_number_${e}`}(this.persistenceKey),this.Ds=this.Ds.insert(this.ws,new ak),this.Ms=RegExp(`^firestore_clients_${s}_([^_]*)$`),this.xs=RegExp(`^firestore_mutations_${s}_(\\d+)(?:_(.*))?$`),this.Os=RegExp(`^firestore_targets_${s}_(\\d+)$`),this.Ns=function(e){return`firestore_online_state_${e}`}(this.persistenceKey),this.Bs=function(e){return`firestore_bundle_loaded_v2_${e}`}(this.persistenceKey),this.window.addEventListener("storage",this.Ss)}static p(e){return!(!e||!e.localStorage)}async start(){for(let e of(await this.syncEngine.$i())){if(e===this.ws)continue;let t=this.getItem(ab(this.persistenceKey,e));if(t){let n=aT.fs(e,t);n&&(this.Ds=this.Ds.insert(n.clientId,n))}}this.Ls();let e=this.storage.getItem(this.Ns);if(e){let t=this.ks(e);t&&this.qs(t)}for(let e of this.vs)this.bs(e);this.vs=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0}writeSequenceNumber(e){this.setItem(this.Fs,JSON.stringify(e))}getAllActiveQueryTargets(){return this.Qs(this.Ds)}isActiveQueryTarget(e){let t=!1;return this.Ds.forEach((n,r)=>{r.activeTargetIds.has(e)&&(t=!0)}),t}addPendingMutation(e){this.Ks(e,"pending")}updateMutationState(e,t,n){this.Ks(e,t,n),this.$s(e)}addLocalQueryTarget(e,t=!0){let n="not-current";if(this.isActiveQueryTarget(e)){let t=this.storage.getItem(aw(this.persistenceKey,e));if(t){let r=ax.fs(e,t);r&&(n=r.state)}}return t&&this.Us.ps(e),this.Ls(),n}removeLocalQueryTarget(e){this.Us.ys(e),this.Ls()}isLocalQueryTarget(e){return this.Us.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(aw(this.persistenceKey,e))}updateQueryState(e,t,n){this.Ws(e,t,n)}handleUserChange(e,t,n){t.forEach(e=>{this.$s(e)}),this.currentUser=e,n.forEach(e=>{this.addPendingMutation(e)})}setOnlineState(e){this.Gs(e)}notifyBundleLoaded(e){this.zs(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.Ss),this.removeItem(this.Cs),this.started=!1)}getItem(e){let t=this.storage.getItem(e);return P("SharedClientState","READ",e,t),t}setItem(e,t){P("SharedClientState","SET",e,t),this.storage.setItem(e,t)}removeItem(e){P("SharedClientState","REMOVE",e),this.storage.removeItem(e)}bs(e){let t=e;if(t.storageArea===this.storage){if(P("SharedClientState","EVENT",t.key,t.newValue),t.key===this.Cs)return void M("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.li.enqueueRetryable(async()=>{if(this.started){if(null!==t.key){if(this.Ms.test(t.key)){if(null==t.newValue){let e=this.js(t.key);return this.Hs(e,null)}{let e=this.Js(t.key,t.newValue);if(e)return this.Hs(e.clientId,e)}}else if(this.xs.test(t.key)){if(null!==t.newValue){let e=this.Ys(t.key,t.newValue);if(e)return this.Zs(e)}}else if(this.Os.test(t.key)){if(null!==t.newValue){let e=this.Xs(t.key,t.newValue);if(e)return this.eo(e)}}else if(t.key===this.Ns){if(null!==t.newValue){let e=this.ks(t.newValue);if(e)return this.qs(e)}}else if(t.key===this.Fs){let e=function(e){let t=eL.oe;if(null!=e)try{let n=JSON.parse(e);U("number"==typeof n),t=n}catch(e){M("SharedClientState","Failed to read sequence number from WebStorage",e)}return t}(t.newValue);e!==eL.oe&&this.sequenceNumberHandler(e)}else if(t.key===this.Bs){let e=this.no(t.newValue);await Promise.all(e.map(e=>this.syncEngine.ro(e)))}}}else this.vs.push(t)})}}get Us(){return this.Ds.get(this.ws)}Ls(){this.setItem(this.Cs,this.Us.gs())}Ks(e,t,n){let r=new a_(this.currentUser,e,t,n),i=av(this.persistenceKey,this.currentUser,e);this.setItem(i,r.gs())}$s(e){let t=av(this.persistenceKey,this.currentUser,e);this.removeItem(t)}Gs(e){let t={clientId:this.ws,onlineState:e};this.storage.setItem(this.Ns,JSON.stringify(t))}Ws(e,t,n){let r=aw(this.persistenceKey,e),i=new ax(e,t,n);this.setItem(r,i.gs())}zs(e){let t=JSON.stringify(Array.from(e));this.setItem(this.Bs,t)}js(e){let t=this.Ms.exec(e);return t?t[1]:null}Js(e,t){let n=this.js(e);return aT.fs(n,t)}Ys(e,t){let n=this.xs.exec(e),r=Number(n[1]),i=void 0!==n[2]?n[2]:null;return a_.fs(new $(i),r,t)}Xs(e,t){let n=Number(this.Os.exec(e)[1]);return ax.fs(n,t)}ks(e){return aI.fs(e)}no(e){return JSON.parse(e)}async Zs(e){if(e.user.uid===this.currentUser.uid)return this.syncEngine.io(e.batchId,e.state,e.error);P("SharedClientState",`Ignoring mutation for non-active user ${e.user.uid}`)}eo(e){return this.syncEngine.so(e.targetId,e.state,e.error)}Hs(e,t){let n=t?this.Ds.insert(e,t):this.Ds.remove(e),r=this.Qs(this.Ds),i=this.Qs(n),s=[],a=[];return i.forEach(e=>{r.has(e)||s.push(e)}),r.forEach(e=>{i.has(e)||a.push(e)}),this.syncEngine.oo(s,a).then(()=>{this.Ds=n})}qs(e){this.Ds.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}Qs(e){let t=n3();return e.forEach((e,n)=>{t=t.unionWith(n.activeTargetIds)}),t}}class aE{constructor(){this._o=new ak,this.ao={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,n){}addLocalQueryTarget(e,t=!0){return t&&this._o.ps(e),this.ao[e]||"not-current"}updateQueryState(e,t,n){this.ao[e]=t}removeLocalQueryTarget(e){this._o.ys(e)}isLocalQueryTarget(e){return this._o.activeTargetIds.has(e)}clearQueryState(e){delete this.ao[e]}getAllActiveQueryTargets(){return this._o.activeTargetIds}isActiveQueryTarget(e){return this._o.activeTargetIds.has(e)}start(){return this._o=new ak,Promise.resolve()}handleUserChange(e,t,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class aC{uo(e){}shutdown(){}}class aA{constructor(){this.co=()=>this.lo(),this.ho=()=>this.Po(),this.To=[],this.Io()}uo(e){this.To.push(e)}shutdown(){window.removeEventListener("online",this.co),window.removeEventListener("offline",this.ho)}Io(){window.addEventListener("online",this.co),window.addEventListener("offline",this.ho)}lo(){for(let e of(P("ConnectivityMonitor","Network connectivity changed: AVAILABLE"),this.To))e(0)}Po(){for(let e of(P("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE"),this.To))e(1)}static p(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}let aN=null;function aO(){return null===aN?aN=function e(){return 0x10000000+Math.round(0x80000000*Math.random())}():aN++,"0x"+aN.toString(16)}let a$={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class aR{constructor(e){this.Eo=e.Eo,this.Ao=e.Ao}Ro(e){this.Vo=e}mo(e){this.fo=e}po(e){this.yo=e}onMessage(e){this.wo=e}close(){this.Ao()}send(e){this.Eo(e)}So(){this.Vo()}bo(){this.fo()}Do(e){this.yo(e)}vo(e){this.wo(e)}}let aD="WebChannelConnection";class aF extends class{get Co(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;let t=e.ssl?"https":"http",n=encodeURIComponent(this.databaseId.projectId),r=encodeURIComponent(this.databaseId.database);this.Fo=t+"://"+e.host,this.Mo=`projects/${n}/databases/${r}`,this.xo="(default)"===this.databaseId.database?`project_id=${n}`:`project_id=${n}&database_id=${r}`}Oo(e,t,n,r,i){let s=aO(),a=this.No(e,t.toUriEncodedString());P("RestConnection",`Sending RPC '${e}' ${s}:`,a,n);let o={"google-cloud-resource-prefix":this.Mo,"x-goog-request-params":this.xo};return this.Bo(o,r,i),this.Lo(e,a,o,n).then(t=>(P("RestConnection",`Received RPC '${e}' ${s}: `,t),t),t=>{throw L("RestConnection",`RPC '${e}' ${s} failed with error: `,t,"url: ",a,"request:",n),t})}ko(e,t,n,r,i,s){return this.Oo(e,t,n,r,i)}Bo(e,t,n){e["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+R}(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach((t,n)=>e[n]=t),n&&n.headers.forEach((t,n)=>e[n]=t)}No(e,t){let n=a$[e];return`${this.Fo}/v1/${t}:${n}`}terminate(){}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Lo(e,t,n,r){let i=aO();return new Promise((a,o)=>{let c=new s;c.setWithCredentials(!0),c.listenOnce(l.COMPLETE,()=>{try{switch(c.getLastErrorCode()){case u.NO_ERROR:let t=c.getResponseJson();P(aD,`XHR for RPC '${e}' ${i} received:`,JSON.stringify(t)),a(t);break;case u.TIMEOUT:P(aD,`RPC '${e}' ${i} timed out`),o(new G(j.DEADLINE_EXCEEDED,"Request time out"));break;case u.HTTP_ERROR:let n=c.getStatus();if(P(aD,`RPC '${e}' ${i} failed with status:`,n,"response text:",c.getResponseText()),n>0){let e=c.getResponseJson();Array.isArray(e)&&(e=e[0]);let t=null==e?void 0:e.error;if(t&&t.status&&t.message){let e=function(e){let t=e.toLowerCase().replace(/_/g,"-");return Object.values(j).indexOf(t)>=0?t:j.UNKNOWN}(t.status);o(new G(e,t.message))}else o(new G(j.UNKNOWN,"Server responded with status "+c.getStatus()))}else o(new G(j.UNAVAILABLE,"Connection failed."));break;default:B()}}finally{P(aD,`RPC '${e}' ${i} completed.`)}});let h=JSON.stringify(r);P(aD,`RPC '${e}' ${i} sending request:`,r),c.send(t,"POST",h,n,15)})}qo(e,t,n){let r=aO(),i=[this.Fo,"/","google.firestore.v1.Firestore","/",e,"/channel"],s=p(),a=d(),l={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},u=this.longPollingOptions.timeoutSeconds;void 0!==u&&(l.longPollingTimeout=Math.round(1e3*u)),this.useFetchStreams&&(l.useFetchStreams=!0),this.Bo(l.initMessageHeaders,t,n),l.encodeInitMessageHeaders=!0;let g=i.join("");P(aD,`Creating RPC '${e}' stream ${r}: ${g}`,l);let m=s.createWebChannel(g,l),y=!1,b=!1,v=new aR({Eo:t=>{b?P(aD,`Not sending because RPC '${e}' stream ${r} is closed:`,t):(y||(P(aD,`Opening RPC '${e}' stream ${r} transport.`),m.open(),y=!0),P(aD,`RPC '${e}' stream ${r} sending:`,t),m.send(t))},Ao:()=>m.close()}),w=(e,t,n)=>{e.listen(t,e=>{try{n(e)}catch(e){setTimeout(()=>{throw e},0)}})};return w(m,o.EventType.OPEN,()=>{b||(P(aD,`RPC '${e}' stream ${r} transport opened.`),v.So())}),w(m,o.EventType.CLOSE,()=>{b||(b=!0,P(aD,`RPC '${e}' stream ${r} transport closed`),v.Do())}),w(m,o.EventType.ERROR,t=>{b||(b=!0,L(aD,`RPC '${e}' stream ${r} transport errored:`,t),v.Do(new G(j.UNAVAILABLE,"The operation could not be completed")))}),w(m,o.EventType.MESSAGE,t=>{var n;if(!b){let i=t.data[0];U(!!i);let s=i,a=(null==s?void 0:s.error)||(null===(n=s[0])||void 0===n?void 0:n.error);if(a){P(aD,`RPC '${e}' stream ${r} received error:`,a);let t=a.status,n=function(e){let t=f[e];if(void 0!==t)return r$(t)}(t),i=a.message;void 0===n&&(n=j.INTERNAL,i="Unknown error status: "+t+" with message "+a.message),b=!0,v.Do(new G(n,i)),m.close()}else P(aD,`RPC '${e}' stream ${r} received:`,i),v.vo(i)}}),w(a,h.STAT_EVENT,t=>{t.stat===c.PROXY?P(aD,`RPC '${e}' stream ${r} detected buffering proxy`):t.stat===c.NOPROXY&&P(aD,`RPC '${e}' stream ${r} detected no buffering proxy`)}),setTimeout(()=>{v.bo()},0),v}}function aP(){return"undefined"!=typeof window?window:null}function aM(){return"undefined"!=typeof document?document:null}function aL(e){return new rJ(e,!0)}class az{constructor(e,t,n=1e3,r=1.5,i=6e4){this.li=e,this.timerId=t,this.Qo=n,this.Ko=r,this.$o=i,this.Uo=0,this.Wo=null,this.Go=Date.now(),this.reset()}reset(){this.Uo=0}zo(){this.Uo=this.$o}jo(e){this.cancel();let t=Math.floor(this.Uo+this.Ho()),n=Math.max(0,Date.now()-this.Go),r=Math.max(0,t-n);r>0&&P("ExponentialBackoff",`Backing off for ${r} ms (base delay: ${this.Uo} ms, delay with jitter: ${t} ms, last attempt: ${n} ms ago)`),this.Wo=this.li.enqueueAfterDelay(this.timerId,r,()=>(this.Go=Date.now(),e())),this.Uo*=this.Ko,this.Uo<this.Qo&&(this.Uo=this.Qo),this.Uo>this.$o&&(this.Uo=this.$o)}Jo(){null!==this.Wo&&(this.Wo.skipDelay(),this.Wo=null)}cancel(){null!==this.Wo&&(this.Wo.cancel(),this.Wo=null)}Ho(){return(Math.random()-.5)*this.Uo}}class aB{constructor(e,t,n,r,i,s,a,o){this.li=e,this.Yo=n,this.Zo=r,this.connection=i,this.authCredentialsProvider=s,this.appCheckCredentialsProvider=a,this.listener=o,this.state=0,this.Xo=0,this.e_=null,this.t_=null,this.stream=null,this.n_=0,this.r_=new az(e,t)}i_(){return 1===this.state||5===this.state||this.s_()}s_(){return 2===this.state||3===this.state}start(){this.n_=0,4!==this.state?this.auth():this.o_()}async stop(){this.i_()&&await this.close(0)}__(){this.state=0,this.r_.reset()}a_(){this.s_()&&null===this.e_&&(this.e_=this.li.enqueueAfterDelay(this.Yo,6e4,()=>this.u_()))}c_(e){this.l_(),this.stream.send(e)}async u_(){if(this.s_())return this.close(0)}l_(){this.e_&&(this.e_.cancel(),this.e_=null)}h_(){this.t_&&(this.t_.cancel(),this.t_=null)}async close(e,t){this.l_(),this.h_(),this.r_.cancel(),this.Xo++,4!==e?this.r_.reset():t&&t.code===j.RESOURCE_EXHAUSTED?(M(t.toString()),M("Using maximum backoff delay to prevent overloading the backend."),this.r_.zo()):t&&t.code===j.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.P_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.po(t)}P_(){}auth(){this.state=1;let e=this.T_(this.Xo),t=this.Xo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([e,n])=>{this.Xo===t&&this.I_(e,n)},t=>{e(()=>{let e=new G(j.UNKNOWN,"Fetching auth token failed: "+t.message);return this.d_(e)})})}I_(e,t){let n=this.T_(this.Xo);this.stream=this.E_(e,t),this.stream.Ro(()=>{n(()=>this.listener.Ro())}),this.stream.mo(()=>{n(()=>(this.state=2,this.t_=this.li.enqueueAfterDelay(this.Zo,1e4,()=>(this.s_()&&(this.state=3),Promise.resolve())),this.listener.mo()))}),this.stream.po(e=>{n(()=>this.d_(e))}),this.stream.onMessage(e=>{n(()=>1==++this.n_?this.A_(e):this.onNext(e))})}o_(){this.state=5,this.r_.jo(async()=>{this.state=0,this.start()})}d_(e){return P("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}T_(e){return t=>{this.li.enqueueAndForget(()=>this.Xo===e?t():(P("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class aU extends aB{constructor(e,t,n,r,i,s){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,n,r,s),this.serializer=i}E_(e,t){return this.connection.qo("Listen",e,t)}A_(e){return this.onNext(e)}onNext(e){this.r_.reset();let t=io(this.serializer,e),n=function(e){if(!("targetChange"in e))return ea.min();let t=e.targetChange;return t.targetIds&&t.targetIds.length?ea.min():t.readTime?r3(t.readTime):ea.min()}(e);return this.listener.R_(t,n)}V_(e){let t={};t.database=it(this.serializer),t.addTarget=function(e,t){let n;let r=t.target;if((n=nx(r)?{documents:ih(e,r)}:{query:id(e,r).ct}).targetId=t.targetId,t.resumeToken.approximateByteSize()>0){n.resumeToken=r1(e,t.resumeToken);let r=rZ(e,t.expectedCount);null!==r&&(n.expectedCount=r)}else if(t.snapshotVersion.compareTo(ea.min())>0){n.readTime=r0(e,t.snapshotVersion.toTimestamp());let r=rZ(e,t.expectedCount);null!==r&&(n.expectedCount=r)}return n}(this.serializer,e);let n=im(this.serializer,e);n&&(t.labels=n),this.c_(t)}m_(e){let t={};t.database=it(this.serializer),t.removeTarget=e,this.c_(t)}}class aV extends aB{constructor(e,t,n,r,i,s){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,n,r,s),this.serializer=i}get f_(){return this.n_>0}start(){this.lastStreamToken=void 0,super.start()}P_(){this.f_&&this.g_([])}E_(e,t){return this.connection.qo("Write",e,t)}A_(e){return U(!!e.streamToken),this.lastStreamToken=e.streamToken,U(!e.writeResults||0===e.writeResults.length),this.listener.p_()}onNext(e){U(!!e.streamToken),this.lastStreamToken=e.streamToken,this.r_.reset();let t=ic(e.writeResults,e.commitTime),n=r3(e.commitTime);return this.listener.y_(n,t)}w_(){let e={};e.database=it(this.serializer),this.c_(e)}g_(e){let t={streamToken:this.lastStreamToken,writes:e.map(e=>il(this.serializer,e))};this.c_(t)}}class aj extends class{}{constructor(e,t,n,r){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=n,this.serializer=r,this.S_=!1}b_(){if(this.S_)throw new G(j.FAILED_PRECONDITION,"The client has already been terminated.")}Oo(e,t,n,r){return this.b_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,s])=>this.connection.Oo(e,r6(t,n),r,i,s)).catch(e=>{throw"FirebaseError"===e.name?(e.code===j.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new G(j.UNKNOWN,e.toString())})}ko(e,t,n,r,i){return this.b_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,a])=>this.connection.ko(e,r6(t,n),r,s,a,i)).catch(e=>{throw"FirebaseError"===e.name?(e.code===j.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new G(j.UNKNOWN,e.toString())})}terminate(){this.S_=!0,this.connection.terminate()}}class aG{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.D_=0,this.v_=null,this.C_=!0}F_(){0===this.D_&&(this.M_("Unknown"),this.v_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.v_=null,this.x_("Backend didn't respond within 10 seconds."),this.M_("Offline"),Promise.resolve())))}O_(e){"Online"===this.state?this.M_("Unknown"):(this.D_++,this.D_>=1&&(this.N_(),this.x_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.M_("Offline")))}set(e){this.N_(),this.D_=0,"Online"===e&&(this.C_=!1),this.M_(e)}M_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}x_(e){let t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.C_?(M(t),this.C_=!1):P("OnlineStateTracker",t)}N_(){null!==this.v_&&(this.v_.cancel(),this.v_=null)}}class aW{constructor(e,t,n,r,i){this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.B_=[],this.L_=new Map,this.k_=new Set,this.q_=[],this.Q_=i,this.Q_.uo(e=>{n.enqueueAndForget(async()=>{a0(this)&&(P("RemoteStore","Restarting streams for network reachability change."),await async function(e){let t=V(e);t.k_.add(4),await aH(t),t.K_.set("Unknown"),t.k_.delete(4),await aq(t)}(this))})}),this.K_=new aG(n,r)}}async function aq(e){if(a0(e))for(let t of e.q_)await t(!0)}async function aH(e){for(let t of e.q_)await t(!1)}function aK(e,t){let n=V(e);n.L_.has(t.targetId)||(n.L_.set(t.targetId,t),aZ(n)?aJ(n):ou(n).s_()&&aY(n,t))}function aX(e,t){let n=V(e),r=ou(n);n.L_.delete(t),r.s_()&&aQ(n,t),0===n.L_.size&&(r.s_()?r.a_():a0(n)&&n.K_.set("Unknown"))}function aY(e,t){if(e.U_.xe(t.targetId),t.resumeToken.approximateByteSize()>0||t.snapshotVersion.compareTo(ea.min())>0){let n=e.remoteSyncer.getRemoteKeysForTarget(t.targetId).size;t=t.withExpectedCount(n)}ou(e).V_(t)}function aQ(e,t){e.U_.xe(t),ou(e).m_(t)}function aJ(e){e.U_=new rq({getRemoteKeysForTarget:t=>e.remoteSyncer.getRemoteKeysForTarget(t),ut:t=>e.L_.get(t)||null,nt:()=>e.datastore.serializer.databaseId}),ou(e).start(),e.K_.F_()}function aZ(e){return a0(e)&&!ou(e).i_()&&e.L_.size>0}function a0(e){return 0===V(e).k_.size}function a1(e){e.U_=void 0}async function a2(e){e.K_.set("Online")}async function a3(e){e.L_.forEach((t,n)=>{aY(e,t)})}async function a4(e,t){a1(e),aZ(e)?(e.K_.O_(t),aJ(e)):e.K_.set("Unknown")}async function a6(e,t,n){if(e.K_.set("Online"),t instanceof rG&&2===t.state&&t.cause)try{await async function(e,t){let n=t.cause;for(let r of t.targetIds)e.L_.has(r)&&(await e.remoteSyncer.rejectListen(r,n),e.L_.delete(r),e.U_.removeTarget(r))}(e,t)}catch(n){P("RemoteStore","Failed to remove targets %s: %s ",t.targetIds.join(","),n),await a5(e,n)}else if(t instanceof rV?e.U_.$e(t):t instanceof rj?e.U_.Je(t):e.U_.Ge(t),!n.isEqual(ea.min()))try{let t=await aa(e.localStore);n.compareTo(t)>=0&&await function(e,t){let n=e.U_.it(t);return n.targetChanges.forEach((n,r)=>{if(n.resumeToken.approximateByteSize()>0){let i=e.L_.get(r);i&&e.L_.set(r,i.withResumeToken(n.resumeToken,t))}}),n.targetMismatches.forEach((t,n)=>{let r=e.L_.get(t);if(!r)return;e.L_.set(t,r.withResumeToken(tw.EMPTY_BYTE_STRING,r.snapshotVersion)),aQ(e,t);let i=new iS(r.target,t,n,r.sequenceNumber);aY(e,i)}),e.remoteSyncer.applyRemoteEvent(n)}(e,n)}catch(t){P("RemoteStore","Failed to raise snapshot:",t),await a5(e,t)}}async function a5(e,t,n){if(!eO(t))throw t;e.k_.add(1),await aH(e),e.K_.set("Offline"),n||(n=()=>aa(e.localStore)),e.asyncQueue.enqueueRetryable(async()=>{P("RemoteStore","Retrying IndexedDB access"),await n(),e.k_.delete(1),await aq(e)})}function a8(e,t){return t().catch(n=>a5(e,n,t))}async function a7(e){let t=V(e),n=oc(t),r=t.B_.length>0?t.B_[t.B_.length-1].batchId:-1;for(;a9(t);)try{let e=await au(t.localStore,r);if(null===e){0===t.B_.length&&n.a_();break}r=e.batchId,oe(t,e)}catch(e){await a5(t,e)}ot(t)&&on(t)}function a9(e){return a0(e)&&e.B_.length<10}function oe(e,t){e.B_.push(t);let n=oc(e);n.s_()&&n.f_&&n.g_(t.mutations)}function ot(e){return a0(e)&&!oc(e).i_()&&e.B_.length>0}function on(e){oc(e).start()}async function or(e){oc(e).w_()}async function oi(e){let t=oc(e);for(let n of e.B_)t.g_(n.mutations)}async function os(e,t,n){let r=e.B_.shift(),i=rC.from(r,t,n);await a8(e,()=>e.remoteSyncer.applySuccessfulWrite(i)),await a7(e)}async function oa(e,t){t&&oc(e).f_&&await async function(e,t){if(function(e){return rO(e)&&e!==j.ABORTED}(t.code)){let n=e.B_.shift();oc(e).__(),await a8(e,()=>e.remoteSyncer.rejectFailedWrite(n.batchId,t)),await a7(e)}}(e,t),ot(e)&&on(e)}async function oo(e,t){let n=V(e);n.asyncQueue.verifyOperationInProgress(),P("RemoteStore","RemoteStore received new credentials");let r=a0(n);n.k_.add(3),await aH(n),r&&n.K_.set("Unknown"),await n.remoteSyncer.handleCredentialChange(t),n.k_.delete(3),await aq(n)}async function ol(e,t){let n=V(e);t?(n.k_.delete(2),await aq(n)):t||(n.k_.add(2),await aH(n),n.K_.set("Unknown"))}function ou(e){return e.W_||(e.W_=function(e,t,n){let r=V(e);return r.b_(),new aU(t,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,n)}(e.datastore,e.asyncQueue,{Ro:a2.bind(null,e),mo:a3.bind(null,e),po:a4.bind(null,e),R_:a6.bind(null,e)}),e.q_.push(async t=>{t?(e.W_.__(),aZ(e)?aJ(e):e.K_.set("Unknown")):(await e.W_.stop(),a1(e))})),e.W_}function oc(e){return e.G_||(e.G_=function(e,t,n){let r=V(e);return r.b_(),new aV(t,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,n)}(e.datastore,e.asyncQueue,{Ro:()=>Promise.resolve(),mo:or.bind(null,e),po:oa.bind(null,e),p_:oi.bind(null,e),y_:os.bind(null,e)}),e.q_.push(async t=>{t?(e.G_.__(),await a7(e)):(await e.G_.stop(),e.B_.length>0&&(P("RemoteStore",`Stopping write stream with ${e.B_.length} pending writes`),e.B_=[]))})),e.G_}class oh{constructor(e,t,n,r,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=r,this.removalCallback=i,this.deferred=new W,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(e=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,n,r,i){let s=new oh(e,t,Date.now()+n,r,i);return s.start(n),s}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new G(j.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function od(e,t){if(M("AsyncQueue",`${t}: ${e}`),eO(e))return new G(j.UNAVAILABLE,`${t}: ${e}`);throw e}class op{static emptySet(e){return new op(e.comparator)}constructor(e){this.comparator=e?(t,n)=>e(t,n)||eh.comparator(t.key,n.key):(e,t)=>eh.comparator(e.key,t.key),this.keyedMap=nK(),this.sortedSet=new td(this.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){let t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,n)=>(e(t),!1))}add(e){let t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){let t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof op)||this.size!==e.size)return!1;let t=this.sortedSet.getIterator(),n=e.sortedSet.getIterator();for(;t.hasNext();){let e=t.getNext().key,r=n.getNext().key;if(!e.isEqual(r))return!1}return!0}toString(){let e=[];return this.forEach(t=>{e.push(t.toString())}),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,t){let n=new op;return n.comparator=this.comparator,n.keyedMap=e,n.sortedSet=t,n}}class of{constructor(){this.z_=new td(eh.comparator)}track(e){let t=e.doc.key,n=this.z_.get(t);n?0!==e.type&&3===n.type?this.z_=this.z_.insert(t,e):3===e.type&&1!==n.type?this.z_=this.z_.insert(t,{type:n.type,doc:e.doc}):2===e.type&&2===n.type?this.z_=this.z_.insert(t,{type:2,doc:e.doc}):2===e.type&&0===n.type?this.z_=this.z_.insert(t,{type:0,doc:e.doc}):1===e.type&&0===n.type?this.z_=this.z_.remove(t):1===e.type&&2===n.type?this.z_=this.z_.insert(t,{type:1,doc:n.doc}):0===e.type&&1===n.type?this.z_=this.z_.insert(t,{type:2,doc:e.doc}):B():this.z_=this.z_.insert(t,e)}j_(){let e=[];return this.z_.inorderTraversal((t,n)=>{e.push(n)}),e}}class og{constructor(e,t,n,r,i,s,a,o,l){this.query=e,this.docs=t,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=i,this.fromCache=s,this.syncStateChanged=a,this.excludesMetadataChanges=o,this.hasCachedResults=l}static fromInitialDocuments(e,t,n,r,i){let s=[];return t.forEach(e=>{s.push({type:0,doc:e})}),new og(e,t,op.emptySet(t),s,n,r,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&nM(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;let t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(let e=0;e<t.length;e++)if(t[e].type!==n[e].type||!t[e].doc.isEqual(n[e].doc))return!1;return!0}}class om{constructor(){this.H_=void 0,this.J_=[]}Y_(){return this.J_.some(e=>e.Z_())}}class oy{constructor(){this.queries=ob(),this.onlineState="Unknown",this.X_=new Set}terminate(){!function(e,t){let n=V(e),r=n.queries;n.queries=ob(),r.forEach((e,n)=>{for(let e of n.J_)e.onError(t)})}(this,new G(j.ABORTED,"Firestore shutting down"))}}function ob(){return new nG(e=>nL(e),nM)}function ov(e,t){let n=V(e),r=!1;for(let e of t){let t=e.query,i=n.queries.get(t);if(i){for(let t of i.J_)t.ta(e)&&(r=!0);i.H_=e}}r&&o_(n)}function ow(e,t,n){let r=V(e),i=r.queries.get(t);if(i)for(let e of i.J_)e.onError(n);r.queries.delete(t)}function o_(e){e.X_.forEach(e=>{e.next()})}(y=m||(m={})).na="default",y.Cache="cache";class ox{constructor(e,t){this.ca=e,this.byteLength=t}la(){return"metadata"in this.ca}}class oT{constructor(e){this.serializer=e}As(e){return r7(this.serializer,e)}Rs(e){return e.metadata.exists?is(this.serializer,e.document,!1):t3.newNoDocument(this.As(e.metadata.name),this.Vs(e.metadata.readTime))}Vs(e){return r3(e)}}class oI{constructor(e,t,n){this.ha=e,this.localStore=t,this.serializer=n,this.queries=[],this.documents=[],this.collectionGroups=new Set,this.progress=ok(e)}Pa(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.ca.namedQuery)this.queries.push(e.ca.namedQuery);else if(e.ca.documentMetadata){this.documents.push({metadata:e.ca.documentMetadata}),e.ca.documentMetadata.exists||++t;let n=el.fromString(e.ca.documentMetadata.name);this.collectionGroups.add(n.get(n.length-2))}else e.ca.document&&(this.documents[this.documents.length-1].document=e.ca.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null}Ta(e){let t=new Map,n=new oT(this.serializer);for(let r of e)if(r.metadata.queries){let e=n.As(r.metadata.name);for(let n of r.metadata.queries){let r=(t.get(n)||n1()).add(e);t.set(n,r)}}return t}async complete(){let e=await am(this.localStore,new oT(this.serializer),this.documents,this.ha.id),t=this.Ta(this.documents);for(let e of this.queries)await ay(this.localStore,e,t.get(e.name));return this.progress.taskState="Success",{progress:this.progress,Ia:this.collectionGroups,da:e}}}function ok(e){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:e.totalDocuments,totalBytes:e.totalBytes}}class oS{constructor(e){this.key=e}}class oE{constructor(e){this.key=e}}class oC{constructor(e,t){this.query=e,this.Ea=t,this.Aa=null,this.hasCachedResults=!1,this.current=!1,this.Ra=n1(),this.mutatedKeys=n1(),this.Va=nV(e),this.ma=new op(this.Va)}get fa(){return this.Ea}ga(e,t){let n=t?t.pa:new of,r=t?t.ma:this.ma,i=t?t.mutatedKeys:this.mutatedKeys,s=r,a=!1,o="F"===this.query.limitType&&r.size===this.query.limit?r.last():null,l="L"===this.query.limitType&&r.size===this.query.limit?r.first():null;if(e.inorderTraversal((e,t)=>{let u=r.get(e),c=nB(this.query,t)?t:null,h=!!u&&this.mutatedKeys.has(u.key),d=!!c&&(c.hasLocalMutations||this.mutatedKeys.has(c.key)&&c.hasCommittedMutations),p=!1;u&&c?u.data.isEqual(c.data)?h!==d&&(n.track({type:3,doc:c}),p=!0):this.ya(u,c)||(n.track({type:2,doc:c}),p=!0,(o&&this.Va(c,o)>0||l&&0>this.Va(c,l))&&(a=!0)):!u&&c?(n.track({type:0,doc:c}),p=!0):u&&!c&&(n.track({type:1,doc:u}),p=!0,(o||l)&&(a=!0)),p&&(c?(s=s.add(c),i=d?i.add(e):i.delete(e)):(s=s.delete(e),i=i.delete(e)))}),null!==this.query.limit)for(;s.size>this.query.limit;){let e="F"===this.query.limitType?s.last():s.first();s=s.delete(e.key),i=i.delete(e.key),n.track({type:1,doc:e})}return{ma:s,pa:n,ss:a,mutatedKeys:i}}ya(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,n,r){let i=this.ma;this.ma=e.ma,this.mutatedKeys=e.mutatedKeys;let s=e.pa.j_();s.sort((e,t)=>(function(e,t){let n=e=>{switch(e){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return B()}};return n(e)-n(t)})(e.type,t.type)||this.Va(e.doc,t.doc)),this.wa(n),r=null!=r&&r;let a=t&&!r?this.Sa():[],o=0===this.Ra.size&&this.current&&!r?1:0,l=o!==this.Aa;return(this.Aa=o,0!==s.length||l)?{snapshot:new og(this.query,e.ma,i,s,e.mutatedKeys,0===o,l,!1,!!n&&n.resumeToken.approximateByteSize()>0),ba:a}:{ba:a}}ea(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({ma:this.ma,pa:new of,mutatedKeys:this.mutatedKeys,ss:!1},!1)):{ba:[]}}Da(e){return!this.Ea.has(e)&&!!this.ma.has(e)&&!this.ma.get(e).hasLocalMutations}wa(e){e&&(e.addedDocuments.forEach(e=>this.Ea=this.Ea.add(e)),e.modifiedDocuments.forEach(e=>{}),e.removedDocuments.forEach(e=>this.Ea=this.Ea.delete(e)),this.current=e.current)}Sa(){if(!this.current)return[];let e=this.Ra;this.Ra=n1(),this.ma.forEach(e=>{this.Da(e.key)&&(this.Ra=this.Ra.add(e.key))});let t=[];return e.forEach(e=>{this.Ra.has(e)||t.push(new oE(e))}),this.Ra.forEach(n=>{e.has(n)||t.push(new oS(n))}),t}va(e){this.Ea=e.Es,this.Ra=n1();let t=this.ga(e.documents);return this.applyChanges(t,!0)}Ca(){return og.fromInitialDocuments(this.query,this.ma,this.mutatedKeys,0===this.Aa,this.hasCachedResults)}}class oA{constructor(e,t,n){this.query=e,this.targetId=t,this.view=n}}class oN{constructor(e){this.key=e,this.Fa=!1}}class oO{constructor(e,t,n,r,i,s){this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=r,this.currentUser=i,this.maxConcurrentLimboResolutions=s,this.Ma={},this.xa=new nG(e=>nL(e),nM),this.Oa=new Map,this.Na=new Set,this.Ba=new td(eh.comparator),this.La=new Map,this.ka=new sq,this.qa={},this.Qa=new Map,this.Ka=sw.Qn(),this.onlineState="Unknown",this.$a=void 0}get isPrimaryClient(){return!0===this.$a}}async function o$(e,t,n=!0){let r;let i=o7(e),s=i.xa.get(t);return s?(i.sharedClientState.addLocalQueryTarget(s.targetId),r=s.view.Ca()):r=await oD(i,t,n,!0),r}async function oR(e,t){let n=o7(e);await oD(n,t,!0,!1)}async function oD(e,t,n,r){let i;let s=await ac(e.localStore,n$(t)),a=s.targetId,o=e.sharedClientState.addLocalQueryTarget(a,n);return r&&(i=await oF(e,t,a,"current"===o,s.resumeToken)),e.isPrimaryClient&&n&&aK(e.remoteStore,s),i}async function oF(e,t,n,r,i){e.Ua=(t,n,r)=>(async function(e,t,n,r){let i=t.view.ga(n);i.ss&&(i=await ad(e.localStore,t.query,!1).then(({documents:e})=>t.view.ga(e,i)));let s=r&&r.targetChanges.get(t.targetId),a=r&&null!=r.targetMismatches.get(t.targetId),o=t.view.applyChanges(i,e.isPrimaryClient,s,a);return oH(e,t.targetId,o.ba),o.snapshot})(e,t,n,r);let s=await ad(e.localStore,t,!0),a=new oC(t,s.Es),o=a.ga(s.documents),l=rU.createSynthesizedTargetChangeForCurrentChange(n,r&&"Offline"!==e.onlineState,i),u=a.applyChanges(o,e.isPrimaryClient,l);oH(e,n,u.ba);let c=new oA(t,n,a);return e.xa.set(t,c),e.Oa.has(n)?e.Oa.get(n).push(t):e.Oa.set(n,[t]),u.snapshot}async function oP(e,t,n){let r=V(e),i=r.xa.get(t),s=r.Oa.get(i.targetId);if(s.length>1)return r.Oa.set(i.targetId,s.filter(e=>!nM(e,t))),void r.xa.delete(t);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(i.targetId),r.sharedClientState.isActiveQueryTarget(i.targetId)||await ah(r.localStore,i.targetId,!1).then(()=>{r.sharedClientState.clearQueryState(i.targetId),n&&aX(r.remoteStore,i.targetId),oW(r,i.targetId)}).catch(eI)):(oW(r,i.targetId),await ah(r.localStore,i.targetId,!0))}async function oM(e,t){let n=V(e),r=n.xa.get(t),i=n.Oa.get(r.targetId);n.isPrimaryClient&&1===i.length&&(n.sharedClientState.removeLocalQueryTarget(r.targetId),aX(n.remoteStore,r.targetId))}async function oL(e,t){let n=V(e);try{let e=await ao(n.localStore,t);t.targetChanges.forEach((e,t)=>{let r=n.La.get(t);r&&(U(e.addedDocuments.size+e.modifiedDocuments.size+e.removedDocuments.size<=1),e.addedDocuments.size>0?r.Fa=!0:e.modifiedDocuments.size>0?U(r.Fa):e.removedDocuments.size>0&&(U(r.Fa),r.Fa=!1))}),await oY(n,e,t)}catch(e){await eI(e)}}function oz(e,t,n){let r=V(e);if(r.isPrimaryClient&&0===n||!r.isPrimaryClient&&1===n){let e=[];r.xa.forEach((n,r)=>{let i=r.view.ea(t);i.snapshot&&e.push(i.snapshot)}),function(e,t){let n=V(e);n.onlineState=t;let r=!1;n.queries.forEach((e,n)=>{for(let e of n.J_)e.ea(t)&&(r=!0)}),r&&o_(n)}(r.eventManager,t),e.length&&r.Ma.R_(e),r.onlineState=t,r.isPrimaryClient&&r.sharedClientState.setOnlineState(t)}}async function oB(e,t,n){let r=V(e);r.sharedClientState.updateQueryState(t,"rejected",n);let i=r.La.get(t),s=i&&i.key;if(s){let e=new td(eh.comparator);e=e.insert(s,t3.newNoDocument(s,ea.min()));let n=n1().add(s),i=new rB(ea.min(),new Map,new td(en),e,n);await oL(r,i),r.Ba=r.Ba.remove(s),r.La.delete(t),oX(r)}else await ah(r.localStore,t,!1).then(()=>oW(r,t,n)).catch(eI)}async function oU(e,t){let n=V(e),r=t.batch.batchId;try{let e=await as(n.localStore,t);oG(n,r,null),oj(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),await oY(n,e)}catch(e){await eI(e)}}async function oV(e,t,n){let r=V(e);try{let e=await function(e,t){let n=V(e);return n.persistence.runTransaction("Reject batch","readwrite-primary",e=>{let r;return n.mutationQueue.lookupMutationBatch(e,t).next(t=>(U(null!==t),r=t.keys(),n.mutationQueue.removeMutationBatch(e,t))).next(()=>n.mutationQueue.performConsistencyCheck(e)).next(()=>n.documentOverlayCache.removeOverlaysForBatchId(e,r,t)).next(()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,r)).next(()=>n.localDocuments.getDocuments(e,r))})}(r.localStore,t);oG(r,t,n),oj(r,t),r.sharedClientState.updateMutationState(t,"rejected",n),await oY(r,e)}catch(e){await eI(e)}}function oj(e,t){(e.Qa.get(t)||[]).forEach(e=>{e.resolve()}),e.Qa.delete(t)}function oG(e,t,n){let r=V(e),i=r.qa[r.currentUser.toKey()];if(i){let e=i.get(t);e&&(n?e.reject(n):e.resolve(),i=i.remove(t)),r.qa[r.currentUser.toKey()]=i}}function oW(e,t,n=null){for(let r of(e.sharedClientState.removeLocalQueryTarget(t),e.Oa.get(t)))e.xa.delete(r),n&&e.Ma.Wa(r,n);e.Oa.delete(t),e.isPrimaryClient&&e.ka.yr(t).forEach(t=>{e.ka.containsKey(t)||oq(e,t)})}function oq(e,t){e.Na.delete(t.path.canonicalString());let n=e.Ba.get(t);null!==n&&(aX(e.remoteStore,n),e.Ba=e.Ba.remove(t),e.La.delete(n),oX(e))}function oH(e,t,n){for(let r of n)r instanceof oS?(e.ka.addReference(r.key,t),oK(e,r)):r instanceof oE?(P("SyncEngine","Document no longer in limbo: "+r.key),e.ka.removeReference(r.key,t),e.ka.containsKey(r.key)||oq(e,r.key)):B()}function oK(e,t){let n=t.key,r=n.path.canonicalString();e.Ba.get(n)||e.Na.has(r)||(P("SyncEngine","New document in limbo: "+n),e.Na.add(r),oX(e))}function oX(e){for(;e.Na.size>0&&e.Ba.size<e.maxConcurrentLimboResolutions;){let t=e.Na.values().next().value;e.Na.delete(t);let n=new eh(el.fromString(t)),r=e.Ka.next();e.La.set(r,new oN(n)),e.Ba=e.Ba.insert(n,r),aK(e.remoteStore,new iS(n$(nC(n.path)),r,"TargetPurposeLimboResolution",eL.oe))}}async function oY(e,t,n){let r=V(e),i=[],s=[],a=[];r.xa.isEmpty()||(r.xa.forEach((e,o)=>{a.push(r.Ua(o,t,n).then(e=>{var t;if((e||n)&&r.isPrimaryClient){let i=e?!e.fromCache:null===(t=null==n?void 0:n.targetChanges.get(o.targetId))||void 0===t?void 0:t.current;r.sharedClientState.updateQueryState(o.targetId,i?"current":"not-current")}if(e){i.push(e);let t=s9.zi(o.targetId,e);s.push(t)}}))}),await Promise.all(a),r.Ma.R_(i),await async function(e,t){let n=V(e);try{await n.persistence.runTransaction("notifyLocalViewChanges","readwrite",e=>ek.forEach(t,t=>ek.forEach(t.Wi,r=>n.persistence.referenceDelegate.addReference(e,t.targetId,r)).next(()=>ek.forEach(t.Gi,r=>n.persistence.referenceDelegate.removeReference(e,t.targetId,r)))))}catch(e){if(!eO(e))throw e;P("LocalStore","Failed to update sequence numbers: "+e)}for(let e of t){let t=e.targetId;if(!e.fromCache){let e=n.us.get(t),r=e.snapshotVersion,i=e.withLastLimboFreeSnapshotVersion(r);n.us=n.us.insert(t,i)}}}(r.localStore,s))}async function oQ(e,t){let n=V(e);if(!n.currentUser.isEqual(t)){P("SyncEngine","User change. New user:",t.toKey());let e=await ai(n.localStore,t);n.currentUser=t,function(e,t){e.Qa.forEach(e=>{e.forEach(e=>{e.reject(new G(j.CANCELLED,t))})}),e.Qa.clear()}(n,"'waitForPendingWrites' promise is rejected due to a user change."),n.sharedClientState.handleUserChange(t,e.removedBatchIds,e.addedBatchIds),await oY(n,e.Ts)}}function oJ(e,t){let n=V(e),r=n.La.get(t);if(r&&r.Fa)return n1().add(r.key);{let e=n1(),r=n.Oa.get(t);if(!r)return e;for(let t of r){let r=n.xa.get(t);e=e.unionWith(r.view.fa)}return e}}async function oZ(e,t){let n=V(e),r=await ad(n.localStore,t.query,!0),i=t.view.va(r);return n.isPrimaryClient&&oH(n,t.targetId,i.ba),i}async function o0(e,t){let n=V(e);return af(n.localStore,t).then(e=>oY(n,e))}async function o1(e,t,n,r){let i=V(e),s=await function(e,t){let n=V(e),r=V(n.mutationQueue);return n.persistence.runTransaction("Lookup mutation documents","readonly",e=>r.On(e,t).next(t=>t?n.localDocuments.getDocuments(e,t):ek.resolve(null)))}(i.localStore,t);null!==s?("pending"===n?await a7(i.remoteStore):"acknowledged"===n||"rejected"===n?(oG(i,t,r||null),oj(i,t),function(e,t){V(V(e).mutationQueue).Bn(t)}(i.localStore,t)):B(),await oY(i,s)):P("SyncEngine","Cannot apply mutation batch with id: "+t)}async function o2(e,t){let n=V(e);if(o7(n),o9(n),!0===t&&!0!==n.$a){let e=n.sharedClientState.getAllActiveQueryTargets(),t=await o3(n,e.toArray());for(let e of(n.$a=!0,await ol(n.remoteStore,!0),t))aK(n.remoteStore,e)}else if(!1===t&&!1!==n.$a){let e=[],t=Promise.resolve();n.Oa.forEach((r,i)=>{n.sharedClientState.isLocalQueryTarget(i)?e.push(i):t=t.then(()=>(oW(n,i),ah(n.localStore,i,!0))),aX(n.remoteStore,i)}),await t,await o3(n,e),function(e){let t=V(e);t.La.forEach((e,n)=>{aX(t.remoteStore,n)}),t.ka.wr(),t.La=new Map,t.Ba=new td(eh.comparator)}(n),n.$a=!1,await ol(n.remoteStore,!1)}}async function o3(e,t,n){let r=V(e),i=[],s=[];for(let e of t){let t;let n=r.Oa.get(e);if(n&&0!==n.length)for(let e of(t=await ac(r.localStore,n$(n[0])),n)){let t=r.xa.get(e),n=await oZ(r,t);n.snapshot&&s.push(n.snapshot)}else{let n=await ap(r.localStore,e);t=await ac(r.localStore,n),await oF(r,o4(n),e,!1,t.resumeToken)}i.push(t)}return r.Ma.R_(s),i}function o4(e){return nE(e.path,e.collectionGroup,e.orderBy,e.filters,e.limit,"F",e.startAt,e.endAt)}function o6(e){return function(e){return V(V(e).persistence).$i()}(V(e).localStore)}async function o5(e,t,n,r){let i=V(e);if(i.$a)return void P("SyncEngine","Ignoring unexpected query state notification.");let s=i.Oa.get(t);if(s&&s.length>0)switch(n){case"current":case"not-current":{let e=await af(i.localStore,nU(s[0])),r=rB.createSynthesizedRemoteEventForCurrentChange(t,"current"===n,tw.EMPTY_BYTE_STRING);await oY(i,e,r);break}case"rejected":await ah(i.localStore,t,!0),oW(i,t,r);break;default:B()}}async function o8(e,t,n){let r=o7(e);if(r.$a){for(let e of t){if(r.Oa.has(e)&&r.sharedClientState.isActiveQueryTarget(e)){P("SyncEngine","Adding an already active target "+e);continue}let t=await ap(r.localStore,e),n=await ac(r.localStore,t);await oF(r,o4(t),n.targetId,!1,n.resumeToken),aK(r.remoteStore,n)}for(let e of n)r.Oa.has(e)&&await ah(r.localStore,e,!1).then(()=>{aX(r.remoteStore,e),oW(r,e)}).catch(eI)}}function o7(e){let t=V(e);return t.remoteStore.remoteSyncer.applyRemoteEvent=oL.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=oJ.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=oB.bind(null,t),t.Ma.R_=ov.bind(null,t.eventManager),t.Ma.Wa=ow.bind(null,t.eventManager),t}function o9(e){let t=V(e);return t.remoteStore.remoteSyncer.applySuccessfulWrite=oU.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=oV.bind(null,t),t}class le{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=aL(e.databaseInfo.databaseId),this.sharedClientState=this.za(e),this.persistence=this.ja(e),await this.persistence.start(),this.localStore=this.Ha(e),this.gcScheduler=this.Ja(e,this.localStore),this.indexBackfillerScheduler=this.Ya(e,this.localStore)}Ja(e,t){return null}Ya(e,t){return null}Ha(e){return ar(this.persistence,new at,e.initialUser,this.serializer)}ja(e){return new sJ(s0.ei,this.serializer)}za(e){return new aE}async terminate(){var e,t;null===(e=this.gcScheduler)||void 0===e||e.stop(),null===(t=this.indexBackfillerScheduler)||void 0===t||t.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}le.provider={build:()=>new le};class lt extends le{constructor(e){super(),this.cacheSizeBytes=e}Ja(e,t){return U(this.persistence.referenceDelegate instanceof s1),new sE(this.persistence.referenceDelegate.garbageCollector,e.asyncQueue,t)}ja(e){let t=void 0!==this.cacheSizeBytes?sd.withCacheSize(this.cacheSizeBytes):sd.DEFAULT;return new sJ(e=>s1.ei(e,t),this.serializer)}}class ln extends le{constructor(e,t,n){super(),this.Za=e,this.cacheSizeBytes=t,this.forceOwnership=n,this.kind="persistent",this.synchronizeTabs=!1}async initialize(e){await super.initialize(e),await this.Za.initialize(this,e),await o9(this.Za.syncEngine),await a7(this.Za.remoteStore),await this.persistence.Si(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))}Ha(e){return ar(this.persistence,new at,e.initialUser,this.serializer)}Ja(e,t){return new sE(this.persistence.referenceDelegate.garbageCollector,e.asyncQueue,t)}Ya(e,t){let n=new eM(t,this.persistence);return new eP(e.asyncQueue,n)}ja(e){let t=s7(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),n=void 0!==this.cacheSizeBytes?sd.withCacheSize(this.cacheSizeBytes):sd.DEFAULT;return new s6(this.synchronizeTabs,t,e.clientId,n,e.asyncQueue,aP(),aM(),this.serializer,this.sharedClientState,!!this.forceOwnership)}za(e){return new aE}}class lr{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=e=>oz(this.syncEngine,e,1),this.remoteStore.remoteSyncer.handleCredentialChange=oQ.bind(null,this.syncEngine),await ol(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return function(){return new oy}()}createDatastore(e){let t=aL(e.databaseInfo.databaseId),n=function(e){return new aF(e)}(e.databaseInfo);return function(e,t,n,r){return new aj(e,t,n,r)}(e.authCredentials,e.appCheckCredentials,n,t)}createRemoteStore(e){return function(e,t,n,r,i){return new aW(e,t,n,r,i)}(this.localStore,this.datastore,e.asyncQueue,e=>oz(this.syncEngine,e,0),function(){return aA.p()?new aA:new aC}())}createSyncEngine(e,t){return function(e,t,n,r,i,s,a){let o=new oO(e,t,n,r,i,s);return a&&(o.$a=!0),o}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){var e,t;await async function(e){let t=V(e);P("RemoteStore","RemoteStore shutting down."),t.k_.add(5),await aH(t),t.Q_.shutdown(),t.K_.set("Unknown")}(this.remoteStore),null===(e=this.datastore)||void 0===e||e.terminate(),null===(t=this.eventManager)||void 0===t||t.terminate()}}lr.provider={build:()=>new lr};class li{constructor(e,t,n,r,i){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=n,this.databaseInfo=r,this.user=$.UNAUTHENTICATED,this.clientId=et.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=i,this.authCredentials.start(n,async e=>{P("FirestoreClient","Received user=",e.uid),await this.authCredentialListener(e),this.user=e}),this.appCheckCredentials.start(n,e=>(P("FirestoreClient","Received new app check token=",e),this.appCheckCredentialListener(e,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();let e=new W;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(n){let t=od(n,"Failed to shutdown persistence");e.reject(t)}}),e.promise}}async function ls(e,t){e.asyncQueue.verifyOperationInProgress(),P("FirestoreClient","Initializing OfflineComponentProvider");let n=e.configuration;await t.initialize(n);let r=n.initialUser;e.setCredentialChangeListener(async e=>{r.isEqual(e)||(await ai(t.localStore,e),r=e)}),t.persistence.setDatabaseDeletedListener(()=>e.terminate()),e._offlineComponents=t}async function la(e,t){e.asyncQueue.verifyOperationInProgress();let n=await lo(e);P("FirestoreClient","Initializing OnlineComponentProvider"),await t.initialize(n,e.configuration),e.setCredentialChangeListener(e=>oo(t.remoteStore,e)),e.setAppCheckTokenChangeListener((e,n)=>oo(t.remoteStore,n)),e._onlineComponents=t}async function lo(e){if(!e._offlineComponents){if(e._uninitializedComponentsProvider){P("FirestoreClient","Using user provided OfflineComponentProvider");try{await ls(e,e._uninitializedComponentsProvider._offline)}catch(n){let t=n;if(!function(e){return"FirebaseError"===e.name?e.code===j.FAILED_PRECONDITION||e.code===j.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&e instanceof DOMException)||22===e.code||20===e.code||11===e.code}(t))throw t;L("Error using user provided cache. Falling back to memory cache: "+t),await ls(e,new le)}}else P("FirestoreClient","Using default OfflineComponentProvider"),await ls(e,new lt(void 0))}return e._offlineComponents}async function ll(e){return e._onlineComponents||(e._uninitializedComponentsProvider?(P("FirestoreClient","Using user provided OnlineComponentProvider"),await la(e,e._uninitializedComponentsProvider._online)):(P("FirestoreClient","Using default OnlineComponentProvider"),await la(e,new lr))),e._onlineComponents}function lu(e){return lo(e).then(e=>e.localStore)}function lc(e){return ll(e).then(e=>e.datastore)}function lh(e){let t={};return void 0!==e.timeoutSeconds&&(t.timeoutSeconds=e.timeoutSeconds),t}let ld=new Map;function lp(e,t,n,r){if(!0===t&&!0===r)throw new G(j.INVALID_ARGUMENT,`${e} and ${n} cannot be used together.`)}function lf(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return e.length>20&&(e=`${e.substring(0,20)}...`),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"==typeof e){if(e instanceof Array)return"an array";{let t=function(e){return e.constructor?e.constructor.name:null}(e);return t?`a custom ${t} object`:"an object"}}return"function"==typeof e?"a function":B()}function lg(e,t){if("_delegate"in e&&(e=e._delegate),!(e instanceof t)){if(t.name===e.constructor.name)throw new G(j.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{let n=lf(e);throw new G(j.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${n}`)}}return e}class lm{constructor(e){var t,n;if(void 0===e.host){if(void 0!==e.ssl)throw new G(j.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=null===(t=e.ssl)||void 0===t||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,void 0===e.cacheSizeBytes)this.cacheSizeBytes=0x2800000;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new G(j.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}lp("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:void 0===e.experimentalAutoDetectLongPolling?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=lh(null!==(n=e.experimentalLongPollingOptions)&&void 0!==n?n:{}),function(e){if(void 0!==e.timeoutSeconds){if(isNaN(e.timeoutSeconds))throw new G(j.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (must not be NaN)`);if(e.timeoutSeconds<5)throw new G(j.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (minimum allowed value is 5)`);if(e.timeoutSeconds>30)throw new G(j.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(e,t){return e.timeoutSeconds===t.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class ly{constructor(e,t,n,r){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=n,this._app=r,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new lm({}),this._settingsFrozen=!1,this._terminateTask="notTerminated"}get app(){if(!this._app)throw new G(j.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return"notTerminated"!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new G(j.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new lm(e),void 0!==e.credentials&&(this._authCredentials=function(e){if(!e)return new H;switch(e.type){case"firstParty":return new Q(e.sessionIndex||"0",e.iamToken||null,e.authTokenFactory||null);case"provider":return e.client;default:throw new G(j.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return"notTerminated"===this._terminateTask&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){"notTerminated"===this._terminateTask?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){let t=ld.get(e);t&&(P("ComponentProvider","Removing Datastore"),ld.delete(e),t.terminate())}(this),Promise.resolve()}}function lb(e,t,n,r={}){var i;let s=(e=lg(e,ly))._getSettings(),a=`${t}:${n}`;if("firestore.googleapis.com"!==s.host&&s.host!==a&&L("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),e._setSettings(Object.assign(Object.assign({},s),{host:a,ssl:!1})),r.mockUserToken){let t,n;if("string"==typeof r.mockUserToken)t=r.mockUserToken,n=$.MOCK_USER;else{t=(0,I.Fy)(r.mockUserToken,null===(i=e._app)||void 0===i?void 0:i.options.projectId);let s=r.mockUserToken.sub||r.mockUserToken.user_id;if(!s)throw new G(j.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");n=new $(s)}e._authCredentials=new K(new q(t,n))}}class lv{constructor(e,t,n){this.converter=t,this._query=n,this.type="query",this.firestore=e}withConverter(e){return new lv(this.firestore,e,this._query)}}class lw{constructor(e,t,n){this.converter=t,this._key=n,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new l_(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new lw(this.firestore,e,this._key)}}class l_ extends lv{constructor(e,t,n){super(e,t,nC(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){let e=this._path.popLast();return e.isEmpty()?null:new lw(this.firestore,null,new eh(e))}withConverter(e){return new l_(this.firestore,e,this._path)}}class lx{constructor(e=Promise.resolve()){this.Iu=[],this.du=!1,this.Eu=[],this.Au=null,this.Ru=!1,this.Vu=!1,this.mu=[],this.r_=new az(this,"async_queue_retry"),this.fu=()=>{let e=aM();e&&P("AsyncQueue","Visibility state changed to "+e.visibilityState),this.r_.Jo()},this.gu=e;let t=aM();t&&"function"==typeof t.addEventListener&&t.addEventListener("visibilitychange",this.fu)}get isShuttingDown(){return this.du}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.pu(),this.yu(e)}enterRestrictedMode(e){if(!this.du){this.du=!0,this.Vu=e||!1;let t=aM();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.fu)}}enqueue(e){if(this.pu(),this.du)return new Promise(()=>{});let t=new W;return this.yu(()=>this.du&&this.Vu?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Iu.push(e),this.wu()))}async wu(){if(0!==this.Iu.length){try{await this.Iu[0](),this.Iu.shift(),this.r_.reset()}catch(e){if(!eO(e))throw e;P("AsyncQueue","Operation failed with retryable error: "+e)}this.Iu.length>0&&this.r_.jo(()=>this.wu())}}yu(e){let t=this.gu.then(()=>(this.Ru=!0,e().catch(e=>{throw this.Au=e,this.Ru=!1,M("INTERNAL UNHANDLED ERROR: ",function(e){let t=e.message||"";return e.stack&&(t=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack),t}(e)),e}).then(e=>(this.Ru=!1,e))));return this.gu=t,t}enqueueAfterDelay(e,t,n){this.pu(),this.mu.indexOf(e)>-1&&(t=0);let r=oh.createAndSchedule(this,e,t,n,e=>this.Su(e));return this.Eu.push(r),r}pu(){this.Au&&B()}verifyOperationInProgress(){}async bu(){let e;do e=this.gu,await e;while(e!==this.gu)}Du(e){for(let t of this.Eu)if(t.timerId===e)return!0;return!1}vu(e){return this.bu().then(()=>{for(let t of(this.Eu.sort((e,t)=>e.targetTimeMs-t.targetTimeMs),this.Eu))if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.bu()})}Cu(e){this.mu.push(e)}Su(e){let t=this.Eu.indexOf(e);this.Eu.splice(t,1)}}class lT extends ly{constructor(e,t,n,r){super(e,t,n,r),this.type="firestore",this._queue=new lx,this._persistenceKey=(null==r?void 0:r.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){let e=this._firestoreClient.terminate();this._queue=new lx(e),this._firestoreClient=void 0,await e}}}function lI(e,t){let n="object"==typeof e?e:(0,b.Sx)(),r="string"==typeof e?e:t||"(default)",i=(0,b.j6)(n,"firestore").getImmediate({identifier:r});if(!i._initialized){let e=(0,I.yU)("firestore");e&&lb(i,...e)}return i}function lk(e){var t,n,r;let i=e._freezeSettings(),s=function(e,t,n,r){return new tC(e,t,n,r.host,r.ssl,r.experimentalForceLongPolling,r.experimentalAutoDetectLongPolling,lh(r.experimentalLongPollingOptions),r.useFetchStreams)}(e._databaseId,(null===(t=e._app)||void 0===t?void 0:t.options.appId)||"",e._persistenceKey,i);e._componentsProvider||(null===(n=i.localCache)||void 0===n?void 0:n._offlineComponentProvider)&&(null===(r=i.localCache)||void 0===r?void 0:r._onlineComponentProvider)&&(e._componentsProvider={_offline:i.localCache._offlineComponentProvider,_online:i.localCache._onlineComponentProvider}),e._firestoreClient=new li(e._authCredentials,e._appCheckCredentials,e._queue,s,e._componentsProvider&&function(e){let t=null==e?void 0:e._online.build();return{_offline:null==e?void 0:e._offline.build(t),_online:t}}(e._componentsProvider))}class lS{constructor(e){this._byteString=e}static fromBase64String(e){try{return new lS(tw.fromBase64String(e))}catch(e){throw new G(j.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(e){return new lS(tw.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}class lE{constructor(...e){for(let t=0;t<e.length;++t)if(0===e[t].length)throw new G(j.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new ec(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class lC{constructor(e){this._methodName=e}}class lA{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new G(j.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new G(j.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return en(this._lat,e._lat)||en(this._long,e._long)}}class lN{constructor(e){this._values=(e||[]).map(e=>e)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;++n)if(e[n]!==t[n])return!1;return!0}(this._values,e._values)}}let lO=/^__.*__$/;class l${constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return null!==this.fieldMask?new r_(e,this.data,this.fieldMask,t,this.fieldTransforms):new rw(e,this.data,t,this.fieldTransforms)}}class lR{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return new r_(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function lD(e){switch(e){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw B()}}class lF{constructor(e,t,n,r,i,s){this.settings=e,this.databaseId=t,this.serializer=n,this.ignoreUndefinedProperties=r,void 0===i&&this.Fu(),this.fieldTransforms=i||[],this.fieldMask=s||[]}get path(){return this.settings.path}get Mu(){return this.settings.Mu}xu(e){return new lF(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Ou(e){var t;let n=null===(t=this.path)||void 0===t?void 0:t.child(e),r=this.xu({path:n,Nu:!1});return r.Bu(e),r}Lu(e){var t;let n=null===(t=this.path)||void 0===t?void 0:t.child(e),r=this.xu({path:n,Nu:!1});return r.Fu(),r}ku(e){return this.xu({path:void 0,Nu:!0})}qu(e){return lJ(e,this.settings.methodName,this.settings.Qu||!1,this.path,this.settings.Ku)}contains(e){return void 0!==this.fieldMask.find(t=>e.isPrefixOf(t))||void 0!==this.fieldTransforms.find(t=>e.isPrefixOf(t.field))}Fu(){if(this.path)for(let e=0;e<this.path.length;e++)this.Bu(this.path.get(e))}Bu(e){if(0===e.length)throw this.qu("Document fields must not be empty");if(lD(this.Mu)&&lO.test(e))throw this.qu('Document fields cannot begin and end with "__"')}}class lP{constructor(e,t,n){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=n||aL(e)}$u(e,t,n,r=!1){return new lF({Mu:e,methodName:t,Ku:n,path:ec.emptyPath(),Nu:!1,Qu:r},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function lM(e){let t=e._freezeSettings(),n=aL(e._databaseId);return new lP(e._databaseId,!!t.ignoreUndefinedProperties,n)}class lL extends lC{_toFieldTransform(e){if(2!==e.Mu)throw 1===e.Mu?e.qu(`${this._methodName}() can only appear at the top level of your update data`):e.qu(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof lL}}function lz(e,t,n){return new lF({Mu:3,Ku:t.settings.Ku,methodName:e._methodName,Nu:n},t.databaseId,t.serializer,t.ignoreUndefinedProperties)}class lB extends null{_toFieldTransform(e){return new ru(e.path,new rt)}isEqual(e){return e instanceof lB}}class lU extends lC{constructor(e,t){super(e),this.Uu=t}_toFieldTransform(e){let t=lz(this,e,!0),n=new rn(this.Uu.map(e=>lW(e,t)));return new ru(e.path,n)}isEqual(e){return e instanceof lU&&(0,I.bD)(this.Uu,e.Uu)}}class lV extends lC{constructor(e,t){super(e),this.Uu=t}_toFieldTransform(e){let t=lz(this,e,!0),n=new ri(this.Uu.map(e=>lW(e,t)));return new ru(e.path,n)}isEqual(e){return e instanceof lV&&(0,I.bD)(this.Uu,e.Uu)}}class lj extends lC{constructor(e,t){super(e),this.Wu=t}_toFieldTransform(e){let t=new ra(e.serializer,n5(e.serializer,this.Wu));return new ru(e.path,t)}isEqual(e){return e instanceof lj&&this.Wu===e.Wu}}function lG(e,t,n,r=!1){return lW(n,e.$u(r?4:3,t))}function lW(e,t){if(lH(e=(0,I.Ku)(e)))return lK("Unsupported field value:",t,e),lq(e,t);if(e instanceof lC)return function(e,t){if(!lD(t.Mu))throw t.qu(`${e._methodName}() can only be used with update() and set()`);if(!t.path)throw t.qu(`${e._methodName}() is not currently supported inside arrays`);let n=e._toFieldTransform(t);n&&t.fieldTransforms.push(n)}(e,t),null;if(void 0===e&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),e instanceof Array){if(t.settings.Nu&&4!==t.Mu)throw t.qu("Nested arrays are not supported");return function(e,t){let n=[],r=0;for(let i of e){let e=lW(i,t.ku(r));null==e&&(e={nullValue:"NULL_VALUE"}),n.push(e),r++}return{arrayValue:{values:n}}}(e,t)}return function(e,t){if(null===(e=(0,I.Ku)(e)))return{nullValue:"NULL_VALUE"};if("number"==typeof e)return n5(t.serializer,e);if("boolean"==typeof e)return{booleanValue:e};if("string"==typeof e)return{stringValue:e};if(e instanceof Date){let n=es.fromDate(e);return{timestampValue:r0(t.serializer,n)}}if(e instanceof es){let n=new es(e.seconds,1e3*Math.floor(e.nanoseconds/1e3));return{timestampValue:r0(t.serializer,n)}}if(e instanceof lA)return{geoPointValue:{latitude:e.latitude,longitude:e.longitude}};if(e instanceof lS)return{bytesValue:r1(t.serializer,e._byteString)};if(e instanceof lw){let n=t.databaseId,r=e.firestore._databaseId;if(!r.isEqual(n))throw t.qu(`Document reference is for database ${r.projectId}/${r.database} but should be for database ${n.projectId}/${n.database}`);return{referenceValue:r4(e.firestore._databaseId||t.databaseId,e._key.path)}}if(e instanceof lN)return function(e,t){return{mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{values:e.toArray().map(e=>{if("number"!=typeof e)throw t.qu("VectorValues must only contain numeric values.");return n4(t.serializer,e)})}}}}}}(e,t);throw t.qu(`Unsupported field value: ${lf(e)}`)}(e,t)}function lq(e,t){let n={};return th(e)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):tc(e,(e,r)=>{let i=lW(r,t.Ou(e));null!=i&&(n[e]=i)}),{mapValue:{fields:n}}}function lH(e){return!("object"!=typeof e||null===e||e instanceof Array||e instanceof Date||e instanceof es||e instanceof lA||e instanceof lS||e instanceof lw||e instanceof lC||e instanceof lN)}function lK(e,t,n){if(!lH(n)||!function(e){return"object"==typeof e&&null!==e&&(Object.getPrototypeOf(e)===Object.prototype||null===Object.getPrototypeOf(e))}(n)){let r=lf(n);throw"an object"===r?t.qu(e+" a custom object"):t.qu(e+" "+r)}}function lX(e,t,n){if((t=(0,I.Ku)(t))instanceof lE)return t._internalPath;if("string"==typeof t)return lQ(e,t);throw lJ("Field path arguments must be of type string or ",e,!1,void 0,n)}let lY=RegExp("[~\\*/\\[\\]]");function lQ(e,t,n){if(t.search(lY)>=0)throw lJ(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,e,!1,void 0,n);try{return new lE(...t.split("."))._internalPath}catch(r){throw lJ(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,e,!1,void 0,n)}}function lJ(e,t,n,r,i){let s=r&&!r.isEmpty(),a=void 0!==i,o=`Function ${t}() called with invalid data`;n&&(o+=" (via `toFirestore()`)"),o+=". ";let l="";return(s||a)&&(l+=" (found",s&&(l+=` in field ${r}`),a&&(l+=` in document ${i}`),l+=")"),new G(j.INVALID_ARGUMENT,o+e+l)}function lZ(e,t){return e.some(e=>e.isEqual(t))}class l0{constructor(e,t,n,r,i){this._firestore=e,this._userDataWriter=t,this._key=n,this._document=r,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new lw(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){let e=new l1(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){let t=this._document.data.field(l2("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class l1 extends l0{data(){return super.data()}}function l2(e,t){return"string"==typeof t?lQ(e,t):t instanceof lE?t._internalPath:t._delegate._internalPath}class l3{}class l4 extends l3{}class l6 extends l4{constructor(e,t,n){super(),this._field=e,this._op=t,this._value=n,this.type="where"}static _create(e,t,n){return new l6(e,t,n)}_apply(e){let t=this._parse(e);return ui(e._query,t),new lv(e.firestore,e.converter,nF(e._query,t))}_parse(e){let t=lM(e.firestore);return function(e,t,n,r,i,s,a){let o;if(i.isKeyField()){if("array-contains"===s||"array-contains-any"===s)throw new G(j.INVALID_ARGUMENT,`Invalid Query. You can't perform '${s}' queries on documentId().`);if("in"===s||"not-in"===s){ur(a,s);let t=[];for(let n of a)t.push(un(r,e,n));o={arrayValue:{values:t}}}else o=un(r,e,a)}else"in"!==s&&"not-in"!==s&&"array-contains-any"!==s||ur(a,s),o=lG(n,t,a,"in"===s||"not-in"===s);return ne.create(i,s,o)}(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}}class l5 extends l3{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new l5(e,t)}_parse(e){let t=this._queryConstraints.map(t=>t._parse(e)).filter(e=>e.getFilters().length>0);return 1===t.length?t[0]:nt.create(t,this._getOperator())}_apply(e){let t=this._parse(e);return 0===t.getFilters().length?e:(function(e,t){let n=e;for(let e of t.getFlattenedFilters())ui(n,e),n=nF(n,e)}(e._query,t),new lv(e.firestore,e.converter,nF(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return"and"===this.type?"and":"or"}}class l8 extends l4{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new l8(e,t)}_apply(e){let t=function(e,t,n){if(null!==e.startAt)throw new G(j.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==e.endAt)throw new G(j.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new t8(t,n)}(e._query,this._field,this._direction);return new lv(e.firestore,e.converter,function(e,t){let n=e.explicitOrderBy.concat([t]);return new nS(e.path,e.collectionGroup,n,e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}(e._query,t))}}class l7 extends l4{constructor(e,t,n){super(),this.type=e,this._limit=t,this._limitType=n}static _create(e,t,n){return new l7(e,t,n)}_apply(e){return new lv(e.firestore,e.converter,nP(e._query,this._limit,this._limitType))}}class l9 extends l4{constructor(e,t,n){super(),this.type=e,this._docOrFields=t,this._inclusive=n}static _create(e,t,n){return new l9(e,t,n)}_apply(e){let t=ut(e,this.type,this._docOrFields,this._inclusive);return new lv(e.firestore,e.converter,function(e,t){return new nS(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,t,e.endAt)}(e._query,t))}}class ue extends l4{constructor(e,t,n){super(),this.type=e,this._docOrFields=t,this._inclusive=n}static _create(e,t,n){return new ue(e,t,n)}_apply(e){let t=ut(e,this.type,this._docOrFields,this._inclusive);return new lv(e.firestore,e.converter,function(e,t){return new nS(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,e.startAt,t)}(e._query,t))}}function ut(e,t,n,r){if(n[0]=(0,I.Ku)(n[0]),n[0]instanceof l0)return function(e,t,n,r,i){if(!r)throw new G(j.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${n}().`);let s=[];for(let n of nO(e))if(n.field.isKeyField())s.push(tU(t,r.key));else{let e=r.data.field(n.field);if(tk(e))throw new G(j.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+n.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===e){let e=n.field.canonicalString();throw new G(j.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${e}' (used as the orderBy) does not exist.`)}s.push(e)}return new t4(s,i)}(e._query,e.firestore._databaseId,t,n[0]._document,r);{let i=lM(e.firestore);return function(e,t,n,r,i,s){let a=e.explicitOrderBy;if(i.length>a.length)throw new G(j.INVALID_ARGUMENT,`Too many arguments provided to ${r}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);let o=[];for(let s=0;s<i.length;s++){let l=i[s];if(a[s].field.isKeyField()){if("string"!=typeof l)throw new G(j.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${r}(), but got a ${typeof l}`);if(!nN(e)&&-1!==l.indexOf("/"))throw new G(j.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${r}() must be a plain document ID, but '${l}' contains a slash.`);let n=e.path.child(el.fromString(l));if(!eh.isDocumentKey(n))throw new G(j.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${r}() must result in a valid document path, but '${n}' is not because it contains an odd number of segments.`);let i=new eh(n);o.push(tU(t,i))}else{let e=lG(n,r,l);o.push(e)}}return new t4(o,s)}(e._query,e.firestore._databaseId,i,t,n,r)}}function un(e,t,n){if("string"==typeof(n=(0,I.Ku)(n))){if(""===n)throw new G(j.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!nN(t)&&-1!==n.indexOf("/"))throw new G(j.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);let r=t.path.child(el.fromString(n));if(!eh.isDocumentKey(r))throw new G(j.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return tU(e,new eh(r))}if(n instanceof lw)return tU(e,n._key);throw new G(j.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${lf(n)}.`)}function ur(e,t){if(!Array.isArray(e)||0===e.length)throw new G(j.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${t.toString()}' filters.`)}function ui(e,t){let n=function(e,t){for(let n of e)for(let e of n.getFlattenedFilters())if(t.indexOf(e.op)>=0)return e.op;return null}(e.filters,function(e){switch(e){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(t.op));if(null!==n)throw n===t.op?new G(j.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${t.op.toString()}' filter.`):new G(j.INVALID_ARGUMENT,`Invalid query. You cannot use '${t.op.toString()}' filters with '${n.toString()}' filters.`)}class us{convertValue(e,t="none"){switch(t$(e)){case 0:return null;case 1:return e.booleanValue;case 2:return tT(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(tI(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw B()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){let n={};return tc(e,(e,r)=>{n[e]=this.convertValue(r,t)}),n}convertVectorValue(e){var t,n,r;return new lN(null===(r=null===(n=null===(t=e.fields)||void 0===t?void 0:t.value.arrayValue)||void 0===n?void 0:n.values)||void 0===r?void 0:r.map(e=>tT(e.doubleValue)))}convertGeoPoint(e){return new lA(tT(e.latitude),tT(e.longitude))}convertArray(e,t){return(e.values||[]).map(e=>this.convertValue(e,t))}convertServerTimestamp(e,t){switch(t){case"previous":let n=tS(e);return null==n?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(tE(e));default:return null}}convertTimestamp(e){let t=tx(e);return new es(t.seconds,t.nanos)}convertDocumentKey(e,t){let n=el.fromString(e);U(ik(n));let r=new tA(n.get(1),n.get(3)),i=new eh(n.popFirst(5));return r.isEqual(t)||M(`Document ${i} contains a document reference within a different database (${r.projectId}/${r.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}}class ua extends l0{constructor(e,t,n,r,i,s){super(e,t,n,r,s),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){let t=new uo(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){let n=this._document.data.field(l2("DocumentSnapshot.get",e));if(null!==n)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}}class uo extends ua{data(e={}){return super.data(e)}}class ul{constructor(e){this.forceOwnership=e,this.kind="persistentSingleTab"}toJSON(){return{kind:this.kind}}_initialize(e){this._onlineComponentProvider=lr.provider,this._offlineComponentProvider={build:t=>new ln(t,null==e?void 0:e.cacheSizeBytes,this.forceOwnership)}}}new WeakMap,function(e=!0){(function(e){R=e})(b.MF),(0,b.om)(new x.uA("firestore",(t,{instanceIdentifier:n,options:r})=>{let i=t.getProvider("app").getImmediate(),s=new lT(new X(t.getProvider("auth-internal")),new Z(t.getProvider("app-check-internal")),function(e,t){if(!Object.prototype.hasOwnProperty.apply(e.options,["projectId"]))throw new G(j.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new tA(e.options.projectId,t)}(i,n),i);return r=Object.assign({useFetchStreams:e},r),s._setSettings(r),s},"PUBLIC").setMultipleInstances(!0)),(0,b.KO)(O,"4.7.6",void 0),(0,b.KO)(O,"4.7.6","esm2017")}();let uu={apiKey:"AIzaSyDh2ztJiyRUB-wgJeYFrdf5NhE-LHiVy70",authDomain:"sentiment-tracking-c9a95.firebaseapp.com",projectId:"sentiment-tracking-c9a95",storageBucket:"sentiment-tracking-c9a95.firebasestorage.app",messagingSenderId:"38978031824",appId:"1:38978031824:web:bc2b0f006d009954314ed5"},uc=(0,b.Wp)(uu),uh=(0,_.xI)(uc);lI(uc)},4981:(e,t,n)=>{"use strict";n.d(t,{Ay:()=>h,CJ:()=>c,iq:()=>l,oN:()=>a});var r=n(6737),i=n(1484);let s={entries:[],loading:!1,error:null},a=(0,r.zD)("feedback/addFeedbackWithSentiment",async(e,t)=>{let{rejectWithValue:n}=t;try{let t=await (0,i.Gu)(e.feedback),n=void 0!==t.confidence?t.confidence:0;return{...e,predictedSpectrum:t.politicalSpectrum,sentiment:{score:t.score,magnitude:t.magnitude,confidence:n},timestamp:Date.now()}}catch(e){return n(e.message||"Failed to analyze sentiment")}}),o=(0,r.Z0)({name:"feedback",initialState:s,reducers:{setFeedback(e,t){e.entries=t.payload},clearFeedback:e=>{e.entries=[]}},extraReducers:e=>{e.addCase(a.pending,e=>{e.loading=!0}).addCase(a.fulfilled,(e,t)=>{e.entries.push(t.payload),e.loading=!1}).addCase(a.rejected,(e,t)=>{e.error=t.payload||"An error occurred",e.loading=!1})}}),{setFeedback:l,clearFeedback:u}=o.actions,c=e=>e.feedback.entries,h=o.reducer},1484:(e,t,n)=>{"use strict";let r,i,s,a,o,l,u,c,h,d,p;n.d(t,{Gu:()=>qn,ES:()=>qr});var f,g,m,y,b,v,w,_,x,T,I,k,S,E,C,A={};n.r(A),n.d(A,{assertParamsValid:()=>aq,computeFlatOffset:()=>a6,computeOutShape:()=>aK,getNormalizedAxes:()=>aJ,isSliceContinous:()=>a4,maskToAxes:()=>aH,parseSliceParams:()=>a5,sliceInfo:()=>a8,startForAxis:()=>a2,startIndicesWithElidedDims:()=>aZ,stopForAxis:()=>a3,stopIndicesWithElidedDims:()=>a0,stridesForAxis:()=>a1,stridesWithElidedDims:()=>aX});var N={};n.r(N),n.d(N,{collectGatherOpShapeInfo:()=>cH,computeOutShape:()=>cq,segOpComputeOptimalWindowSize:()=>cW});var O={};n.r(O),n.d(O,{ERF_A1:()=>cu,ERF_A2:()=>cc,ERF_A3:()=>ch,ERF_A4:()=>cd,ERF_A5:()=>cp,ERF_P:()=>cl,PARALLELIZE_THRESHOLD:()=>u4,RowPartitionType:()=>w,SELU_SCALE:()=>co,SELU_SCALEALPHA:()=>ca,applyActivation:()=>un,assertAndGetBroadcastShape:()=>av,assertAxesAreInnerMostDims:()=>lr,assertParamsConsistent:()=>uJ,assignToTypedArray:()=>cv,axesAreInnerMostDims:()=>o9,calculateShapes:()=>cs,checkEinsumDimSizes:()=>cC,checkPadOnDimRoundingMode:()=>o_,combineLocations:()=>le,combineRaggedTensorToTensorShapes:()=>u0,complexWithEvenIndex:()=>cm,complexWithOddIndex:()=>cy,computeConv2DInfo:()=>oa,computeConv3DInfo:()=>oo,computeDefaultPad:()=>oc,computeDilation2DInfo:()=>or,computeOptimalWindowSize:()=>u6,computeOutAndReduceShapes:()=>lt,computeOutShape:()=>uZ,computePool2DInfo:()=>oi,computePool3DInfo:()=>os,convertConv2DDataFormat:()=>ow,decodeEinsumEquation:()=>cS,eitherStridesOrDilationsAreOne:()=>ob,expandShapeToKeepDim:()=>ln,exponent:()=>c_,exponents:()=>cw,fromStringArrayToUint8:()=>cX,fromUint8ToStringArray:()=>cK,getAxesPermutation:()=>li,getBroadcastDims:()=>ay,getComplexWithIndex:()=>cb,getEinsumComputePath:()=>cA,getEinsumPermutation:()=>cE,getFusedBiasGradient:()=>ut,getFusedDyActivation:()=>ue,getImageCenter:()=>u5,getInnerMostAxes:()=>la,getPermuted:()=>u7,getRaggedRank:()=>u2,getReductionAxes:()=>ab,getReshaped:()=>u8,getReshapedPermuted:()=>u9,getRowPartitionTypesHelper:()=>u1,getSliceBeginCoords:()=>ce,getSliceSize:()=>ct,getSparseFillEmptyRowsIndicesDenseShapeMismatch:()=>cR,getSparseFillEmptyRowsNegativeIndexErrorMessage:()=>cD,getSparseFillEmptyRowsOutOfRangeIndexErrorMessage:()=>cF,getSparseReshapeEmptyTensorZeroOutputDimErrorMessage:()=>cL,getSparseReshapeInputOutputMismatchErrorMessage:()=>cB,getSparseReshapeInputOutputMultipleErrorMessage:()=>cz,getSparseReshapeMultipleNegativeOneOutputDimErrorMessage:()=>cP,getSparseReshapeNegativeOutputDimErrorMessage:()=>cM,getSparseSegmentReductionIndicesOutOfRangeErrorMessage:()=>cG,getSparseSegmentReductionNegativeSegmentIdsErrorMessage:()=>cU,getSparseSegmentReductionNonIncreasingSegmentIdsErrorMessage:()=>cV,getSparseSegmentReductionSegmentIdOutOfRangeErrorMessage:()=>cj,getUndoAxesPermutation:()=>ls,isIdentityPermutation:()=>cN,log:()=>r_,mergeRealAndImagArrays:()=>cf,prepareAndValidate:()=>cn,prepareSplitSize:()=>c$,segment_util:()=>N,shouldFuse:()=>ur,slice_util:()=>A,splitRealAndImagArrays:()=>cg,stridesOrDilationsArePositive:()=>ov,tupleValuesAreOne:()=>oy,upcastType:()=>iw,validateDefaultValueShape:()=>u3,validateInput:()=>ci,validateUpdateShape:()=>cr,warn:()=>rw});var $={};n.r($),n.d($,{mx:()=>v7,XI:()=>wj,Nk:()=>wG,f6:()=>wq,ct:()=>v3,YG:()=>wY,hH:()=>w2,z3:()=>_A,sG:()=>_B,uM:()=>_W,vS:()=>_9,qB:()=>xa,GG:()=>xl,lg:()=>xp,rq:()=>xc,cu:()=>xS,WR:()=>xT,GE:()=>xA,px:()=>xO,jC:()=>xG,He:()=>xH,hE:()=>x4,BF:()=>_x,Dk:()=>Tr,cl:()=>Th,_B:()=>TI,ub:()=>TR,_f:()=>TP,Ku:()=>TV,qy:()=>TG,Zy:()=>T2,bu:()=>T6,zv:()=>vK,dH:()=>wa,HS:()=>wz,yH:()=>Im,l3:()=>Ib,z9:()=>Iw,x6:()=>Ik,_m:()=>IO,eW:()=>IP,GK:()=>Iz,SP:()=>IV,yr:()=>IG,dl:()=>_Y,Dw:()=>IX,xT:()=>IJ,_X:()=>wp,wz:()=>I8});let R=1e-7,D=1e-4;class F{constructor(e,t){this.backend=e,this.dataMover=t,this.data=new WeakMap,this.dataIdsCount=0}get(e){return this.data.has(e)||this.dataMover.moveData(this.backend,e),this.data.get(e)}set(e,t){this.dataIdsCount++,this.data.set(e,t)}has(e){return this.data.has(e)}delete(e){return this.dataIdsCount--,this.data.delete(e)}numDataIds(){return this.dataIdsCount}}class P{refCount(e){return M("refCount")}incRef(e){return M("incRef")}timerAvailable(){return!0}time(e){return M("time")}read(e){return M("read")}readSync(e){return M("readSync")}readToGPU(e,t){return M("readToGPU")}numDataIds(){return M("numDataIds")}disposeData(e,t){return M("disposeData")}write(e,t,n){return M("write")}move(e,t,n,r,i){return M("move")}createTensorFromGPUData(e,t,n){return M("createTensorFromGPUData")}memory(){return M("memory")}floatPrecision(){return M("floatPrecision")}epsilon(){return 32===this.floatPrecision()?R:D}dispose(){return M("dispose")}}function M(e){throw Error(`'${e}' not yet implemented or not found in the registry. This kernel may not be supported by the tfjs backend you have chosen`)}function L(e){let t=e.length,n=0;for(;t>0;)n=Math.random()*t|0,U(e,--t,n)}function z(e,t,n){return Math.max(e,Math.min(t,n))}function B(e){return e%2==0?e:e+1}function U(e,t,n){let r=e[t];e[t]=e[n],e[n]=r}function V(e){let t=0;for(let n=0;n<e.length;n++)t+=e[n];return t}function j(e,t){if(!e)throw Error("string"==typeof t?t:t())}function G(e,t,n=""){j(H(e,t),()=>n+` Shapes ${e} and ${t} must match`)}function W(e){j(null!=e,()=>"The input to the tensor constructor must be a non-null value.")}function q(e){if(0===e.length)return 1;let t=e[0];for(let n=1;n<e.length;n++)t*=e[n];return t}function H(e,t){if(e===t)return!0;if(null==e||null==t||e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}function K(e){return e%1==0}function X(e){let t=Math.ceil(Math.sqrt(e));return[t,Math.ceil(e/t)]}function Y(e,t){return t<=e.length?e:e+" ".repeat(t-e.length)}function Q(e,t=e=>0,n,r){return new Promise((i,s)=>{let a=0,o=()=>{if(e()){i();return}let l=t(++a);if(null!=n&&a>=n){s();return}null!=r?r(o,l):setTimeout(o,l)};o()})}function J(e,t){let n=1,r=-1;for(let t=0;t<e.length;++t)if(e[t]>=0)n*=e[t];else if(-1===e[t]){if(-1!==r)throw Error(`Shapes can only have 1 implicit size. Found -1 at dim ${r} and dim ${t}`);r=t}else if(e[t]<0)throw Error(`Shapes can not be < 0. Found ${e[t]} at dim ${t}`);if(-1===r){if(t>0&&t!==n)throw Error(`Size(${t}) must match the product of shape ${e}`);return e}if(0===n)throw Error(`Cannot infer the missing size in [${e}] when there are 0 elements`);if(t%n!=0)throw Error(`The implicit shape can't be a fractional number. Got ${t} / ${n}`);let i=e.slice();return i[r]=t/n,i}function Z(e,t){let n=t.length;return j((e=null==e?t.map((e,t)=>t):[].concat(e)).every(e=>e>=-n&&e<n),()=>`All values in axis param must be in range [-${n}, ${n}) but got axis ${e}`),j(e.every(e=>K(e)),()=>`All values in axis param must be integers but got axis ${e}`),e.map(e=>e<0?n+e:e)}function ee(e,t){let n=[],r=[],i=null!=t&&Array.isArray(t)&&0===t.length,s=null==t||i?null:Z(t,e).sort(),a=0;for(let t=0;t<e.length;++t){if(null!=s){if(s[a]===t&&1!==e[t])throw Error(`Can't squeeze axis ${t} since its dim '${e[t]}' is not 1`);(null==s[a]||s[a]>t)&&1===e[t]&&(n.push(e[t]),r.push(t)),s[a]<=t&&a++}1!==e[t]&&(n.push(e[t]),r.push(t))}return{newShape:n,keptDims:r}}function et(e,t){return en(e,t)}function en(e,t){let n=null;if(null==e||"float32"===e)n=new Float32Array(t);else if("int32"===e)n=new Int32Array(t);else if("bool"===e)n=new Uint8Array(t);else if("string"===e)n=Array(t);else throw Error(`Unknown data type ${e}`);return n}function er(e,t){for(let n=0;n<e.length;n++){let r=e[n];if(isNaN(r)||!isFinite(r))throw Error(`A tensor of type ${t} being uploaded contains ${r}.`)}}function ei(e){return"bool"===e||"complex64"===e||"float32"===e||"int32"===e||"string"===e}function es(e,t){return"complex64"!==t&&("float32"!==t||"complex64"===e)&&("int32"!==t||"float32"===e||"complex64"===e)&&("bool"!==t||"bool"!==e)}function ea(e){if("float32"===e||"int32"===e)return 4;if("complex64"===e)return 8;if("bool"===e)return 1;throw Error(`Unknown dtype ${e}`)}function eo(e){if(null==e)return 0;let t=0;return e.forEach(e=>t+=e.length),t}function el(e){return"string"==typeof e||e instanceof String}function eu(e){return"boolean"==typeof e}function ec(e){return"number"==typeof e}function eh(e){if(Array.isArray(e))return eh(e[0]);if(e instanceof Float32Array);else if(e instanceof Int32Array||e instanceof Uint8Array||e instanceof Uint8ClampedArray)return"int32";else if(ec(e));else if(el(e))return"string";else if(eu(e))return"bool";return"float32"}function ed(e){return!!(e&&e.constructor&&e.call&&e.apply)}function ep(e,t){for(let n=t;n<e;++n)if(e%n==0)return n;return e}function ef(e){let t=e.length;if(t<2)return[];let n=Array(t-1);n[t-2]=e[t-1];for(let r=t-3;r>=0;--r)n[r]=n[r+1]*e[r+1];return n}function eg(e,t,n,r=!1){let i=[];if(1===t.length){let s=t[0]*(r?2:1);for(let t=0;t<s;t++)i[t]=n[e+t]}else{let s=t[0],a=t.slice(1),o=a.reduce((e,t)=>e*t)*(r?2:1);for(let t=0;t<s;t++)i[t]=eg(e+t*o,a,n,r)}return i}function em(e,t,n=!1){if(0===e.length)return t[0];let r=e.reduce((e,t)=>e*t)*(n?2:1);if(0===r)return[];if(r!==t.length)throw Error(`[${e}] does not match the input size ${t.length}${n?" for a complex tensor":""}.`);return eg(0,e,t,n)}function ey(e,t){if(Array.isArray(e))return e;if("float32"===t)return e instanceof Float32Array?e:new Float32Array(e);if("int32"===t)return e instanceof Int32Array?e:new Int32Array(e);if("bool"===t||"string"===t)return Uint8Array.from(new Int32Array(e));throw Error(`Unknown dtype ${t}`)}function eb(e,t){let n=ev(e,t);for(let e=0;e<n.length;e++)n[e]=1;return n}function ev(e,t){if(null==t||"float32"===t||"complex64"===t)return new Float32Array(e);if("int32"===t)return new Int32Array(e);if("bool"===t)return new Uint8Array(e);throw Error(`Unknown data type ${t}`)}function ew(e,t){let n=e.reduce((e,t)=>e*t,1);if(null==t||"float32"===t)return em(e,new Float32Array(n));if("int32"===t)return em(e,new Int32Array(n));if("bool"===t)return em(e,new Uint8Array(n));throw Error(`Unknown data type ${t}`)}function e_(e){e.forEach(t=>{j(Number.isInteger(t)&&t>=0,()=>`Tensor must have a shape comprised of positive integers but got shape [${e}].`)})}function ex(e,t,n){if(0===t)return 0;if(1===t)return e[0];let r=e[e.length-1];for(let t=0;t<e.length-1;++t)r+=n[t]*e[t];return r}function eT(e,t,n){if(0===t)return[];if(1===t)return[e];let r=Array(t);for(let t=0;t<r.length-1;++t)r[t]=Math.floor(e/n[t]),e-=r[t]*n[t];return r[r.length-1]=e,r}function eI(e){return e&&e.then&&"function"==typeof e.then}let ek="tfjsflags";class eS{constructor(e){this.global=e,this.flags={},this.flagRegistry={},this.urlFlags={},this.getQueryParams=eE,this.populateURLFlags()}setPlatform(e,t){null==this.platform||eN().getBool("IS_TEST")||eN().getBool("PROD")||console.warn(`Platform ${this.platformName} has already been set. Overwriting the platform with ${e}.`),this.platformName=e,this.platform=t}registerFlag(e,t,n){if(this.flagRegistry[e]={evaluationFn:t,setHook:n},null!=this.urlFlags[e]){let t=this.urlFlags[e];eN().getBool("IS_TEST")||eN().getBool("PROD")||console.warn(`Setting feature override from URL ${e}: ${t}.`),this.set(e,t)}}async getAsync(e){return e in this.flags||(this.flags[e]=await this.evaluateFlag(e)),this.flags[e]}get(e){if(e in this.flags)return this.flags[e];let t=this.evaluateFlag(e);if(eI(t))throw Error(`Flag ${e} cannot be synchronously evaluated. Please use getAsync() instead.`);return this.flags[e]=t,this.flags[e]}getNumber(e){return this.get(e)}getBool(e){return this.get(e)}getString(e){return this.get(e)}getFlags(){return this.flags}get features(){return this.flags}set(e,t){if(null==this.flagRegistry[e])throw Error(`Cannot set flag ${e} as it has not been registered.`);this.flags[e]=t,null!=this.flagRegistry[e].setHook&&this.flagRegistry[e].setHook(t)}evaluateFlag(e){if(null==this.flagRegistry[e])throw Error(`Cannot evaluate flag '${e}': no evaluation function found.`);return this.flagRegistry[e].evaluationFn()}setFlags(e){this.flags=Object.assign({},e)}reset(){this.flags={},this.urlFlags={},this.populateURLFlags()}populateURLFlags(){if(void 0===this.global||void 0===this.global.location||void 0===this.global.location.search)return;let e=this.getQueryParams(this.global.location.search);ek in e&&e[ek].split(",").forEach(e=>{let[t,n]=e.split(":");this.urlFlags[t]=eA(t,n)})}}function eE(e){let t={};return e.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,(e,...n)=>(eC(t,n[0],n[1]),n.join("="))),t}function eC(e,t,n){e[decodeURIComponent(t)]=decodeURIComponent(n||"")}function eA(e,t){let n=t.toLowerCase();return"true"===n||"false"===n?"true"===n:`${+n}`===n?+n:t}function eN(){return eO}let eO=null;function e$(e){eO=e}var eR=n(7836);function eD(){if(null==r){let e;if("undefined"!=typeof window)e=window;else if(void 0!==n.g)e=n.g;else if(void 0!==eR)e=eR;else if("undefined"!=typeof self)e=self;else throw Error("Could not find a global object");r=e}return r}function eF(){let e=eD();return null==e._tfGlobals&&(e._tfGlobals=new Map),e._tfGlobals}function eP(e,t){let n=eF();if(n.has(e))return n.get(e);{let r=t();return n.set(e,r),n.get(e)}}let eM="Abs",eL="Acos",ez="Acosh",eB="Add",eU="AddN",eV="All",ej="Any",eG="ArgMax",eW="ArgMin",eq="Asin",eH="Asinh",eK="Atan",eX="Atanh",eY="Atan2",eQ="AvgPool",eJ="AvgPoolGrad",eZ="AvgPool3D",e0="AvgPool3DGrad",e1="BatchMatMul",e2="BatchToSpaceND",e3="Bincount",e4="BitwiseAnd",e6="BroadcastTo",e5="BroadcastArgs",e8="Cast",e7="Ceil",e9="ClipByValue",te="Complex",tt="ComplexAbs",tn="Concat",tr="Conv2D",ti="Conv2DBackpropFilter",ts="Conv2DBackpropInput",ta="Conv3D",to="Conv3DBackpropFilterV2",tl="Conv3DBackpropInputV2",tu="Cos",tc="Cosh",th="Cumprod",td="Cumsum",tp="CropAndResize",tf="DenseBincount",tg="DepthToSpace",tm="DepthwiseConv2dNative",ty="DepthwiseConv2dNativeBackpropFilter",tb="DepthwiseConv2dNativeBackpropInput",tv="Diag",tw="Dilation2D",t_="Dilation2DBackpropInput",tx="Dilation2DBackpropFilter",tT="Draw",tI="RealDiv",tk="Einsum",tS="Elu",tE="EluGrad",tC="Erf",tA="Equal",tN="Exp",tO="ExpandDims",t$="Expm1",tR="FFT",tD="Fill",tF="FlipLeftRight",tP="Floor",tM="FloorDiv",tL="FusedBatchNorm",tz="GatherV2",tB="GatherNd",tU="Greater",tV="GreaterEqual",tj="Identity",tG="IFFT",tW="Imag",tq="IsFinite",tH="IsInf",tK="IsNan",tX="LeakyRelu",tY="Less",tQ="LessEqual",tJ="LinSpace",tZ="Log",t0="Log1p",t1="LogicalAnd",t2="LogicalNot",t3="LogicalOr",t4="LogSoftmax",t6="LRN",t5="LRNGrad",t8="Max",t7="Maximum",t9="MaxPool",ne="MaxPoolGrad",nt="MaxPool3D",nn="MaxPool3DGrad",nr="MaxPoolWithArgmax",ni="Mean",ns="Min",na="Minimum",no="MirrorPad",nl="Mod",nu="Multinomial",nc="Multiply",nh="Neg",nd="NotEqual",np="NonMaxSuppressionV3",nf="NonMaxSuppressionV4",ng="NonMaxSuppressionV5",nm="OnesLike",ny="OneHot",nb="Pack",nv="PadV2",nw="Pow",n_="Prelu",nx="Prod",nT="RaggedGather",nI="RaggedRange",nk="RaggedTensorToTensor",nS="Range",nE="Real",nC="Reciprocal",nA="Relu",nN="Reshape",nO="ResizeNearestNeighbor",n$="ResizeNearestNeighborGrad",nR="ResizeBilinear",nD="ResizeBilinearGrad",nF="Relu6",nP="Reverse",nM="Round",nL="Rsqrt",nz="ScatterNd",nB="TensorScatterUpdate",nU="SearchSorted",nV="Select",nj="Selu",nG="Slice",nW="Sin",nq="Sinh",nH="Sign",nK="Sigmoid",nX="Softplus",nY="Sqrt",nQ="Sum",nJ="SpaceToBatchND",nZ="SplitV",n0="Softmax",n1="SparseFillEmptyRows",n2="SparseReshape",n3="SparseSegmentMean",n4="SparseSegmentSum",n6="SparseToDense",n5="SquaredDifference",n8="Square",n7="StaticRegexReplace",n9="StridedSlice",re="StringNGrams",rt="StringSplit",rn="StringToHashBucketFast",rr="Sub",ri="Tan",rs="Tanh",ra="Tile",ro="TopK",rl="Transform",ru="Transpose",rc="Unique",rh="Unpack",rd="UnsortedSegmentSum",rp="ZerosLike",rf="Step",rg="FromPixels",rm="RotateWithOffset",ry="_FusedMatMul",rb="FusedConv2D",rv="FusedDepthwiseConv2D";function rw(...e){eN().getBool("IS_TEST")||eN().getBool("PROD")||console.warn(...e)}function r_(...e){eN().getBool("IS_TEST")||eN().getBool("PROD")||console.log(...e)}let rx=eP("kernelRegistry",()=>new Map),rT=eP("gradRegistry",()=>new Map);function rI(e,t){let n=rA(e,t);return rx.get(n)}function rk(e){return rT.get(e)}function rS(e){let t=rx.entries(),n=[];for(;;){let{done:r,value:i}=t.next();if(r)break;let[s,a]=i,[o]=s.split("_");o===e&&n.push(a)}return n}function rE(e){let{kernelName:t,backendName:n}=e,r=rA(t,n);rx.has(r)&&rw(`The kernel '${t}' for backend '${n}' is already registered`),rx.set(r,e)}function rC(e){let{kernelName:t}=e;rT.has(t)&&eN().getBool("DEBUG")&&rw(`Overriding the gradient for '${t}'`),rT.set(t,e)}function rA(e,t){return`${t}_${e}`}function rN(e){return e instanceof Float32Array||e instanceof Int32Array||e instanceof Uint8Array||e instanceof Uint8ClampedArray}var rO=n(8570);let r$=n.n(rO)()||rO;function rR(e){return r$.fromString(e,!0,16)}let rD=rR("c3a5c85c97cb3127"),rF=rR("b492b66fbe98f273"),rP=rR("9ae16a3b2f90404f");function rM(e){return e.xor(e.shru(47))}function rL(e,t,n){let r=e.slice(t,t+n);return r$.fromBytes(Array.from(r),!0,!0)}function rz(e,t){return rL(e,t,8)}function rB(e,t){return rL(e,t,4)}function rU(e,t){return 0===t?e:e.shru(t).or(e.shl(64-t))}function rV(e,t,n=rR("9ddfea08eb382d69")){let r=e.xor(t).mul(n);r=r.xor(r.shru(47));let i=t.xor(r).mul(n);return(i=i.xor(i.shru(47))).mul(n)}function rj(e,t,n,r,i,s){i=i.add(e),s=rU(s.add(i).add(r),21);let a=i;return i=(i=i.add(t)).add(n),s=s.add(rU(i,44)),[i.add(r),s.add(a)]}function rG(e,t,n,r){return rj(rz(e,t),rz(e,t+8),rz(e,t+16),rz(e,t+24),n,r)}function rW(e,t=e.length){if(t>=8){let n=rP.add(2*t),r=rz(e,0).add(rP),i=rz(e,t-8);return rV(rU(i,37).mul(n).add(r),rU(r,25).add(i).mul(n),n)}if(t>=4){let n=rP.add(2*t);return rV(rB(e,0).shl(3).add(t),rB(e,t-4),n)}if(t>0){let n=e[0],r=e[t>>1],i=e[t-1],s=n+(r<<8),a=t+(i<<2);return rM(rP.mul(s).xor(rD.mul(a))).mul(rP)}return rP}function rq(e,t=e.length){let n=rP.add(2*t),r=rz(e,0).mul(rF),i=rz(e,8),s=rz(e,t-8).mul(n),a=rz(e,t-16).mul(rP);return rV(rU(r.add(i),43).add(rU(s,30)).add(a),r.add(rU(i.add(rP),18)).add(s),n)}function rH(e,t=e.length){let n=rP.add(2*t),r=rz(e,0).mul(rP),i=rz(e,8),s=rz(e,t-8).mul(n),a=rz(e,t-16).mul(rP),o=rU(r.add(i),43).add(rU(s,30)).add(a),l=rV(o,r.add(rU(i.add(rP),18)).add(s),n),u=rz(e,16).mul(n),c=rz(e,24),h=o.add(rz(e,t-32)).mul(n),d=l.add(rz(e,t-24)).mul(n);return rV(rU(u.add(c),43).add(rU(h,30)).add(d),u.add(rU(c.add(r),18)).add(h),n)}function rK(e,t=e.length){let n=r$.fromNumber(81,!0);if(t<=32)return t<=16?rW(e,t):rq(e,t);if(t<=64)return rH(e,t);let r=n,i=n.mul(rF).add(113),s=rM(i.mul(rP).add(113)).mul(rP),a=[r$.UZERO,r$.UZERO],o=[r$.UZERO,r$.UZERO];r=r.mul(rP).add(rz(e,0));let l=0,u=(t-1>>6)*64,c=u+(t-1&63)-63;do r=rU(r.add(i).add(a[0]).add(rz(e,l+8)),37).mul(rF),i=rU(i.add(a[1]).add(rz(e,l+48)),42).mul(rF),r=r.xor(o[1]),i=i.add(a[0]).add(rz(e,l+40)),s=rU(s.add(o[0]),33).mul(rF),a=rG(e,l,a[1].mul(rF),r.add(o[0])),o=rG(e,l+32,s.add(o[1]),i.add(rz(e,l+16))),[s,r]=[r,s],l+=64;while(l!==u);let h=rF.add(s.and(255).shl(1));return l=c,o[0]=o[0].add(t-1&63),a[0]=a[0].add(o[0]),o[0]=o[0].add(a[0]),r=rU(r.add(i).add(a[0]).add(rz(e,l+8)),37).mul(h),i=rU(i.add(a[1]).add(rz(e,l+48)),42).mul(h),r=r.xor(o[1].mul(9)),i=i.add(a[0].mul(9).add(rz(e,l+40))),s=rU(s.add(o[0]),33).mul(h),a=rG(e,l,a[1].mul(h),r.add(o[0])),o=rG(e,l+32,s.add(o[1]),i.add(rz(e,l+16))),[s,r]=[r,s],rV(rV(a[0],o[0],h).add(rM(i).mul(rD)).add(s),rV(a[1],o[1],h).add(r),h)}function rX(e,t){return"string"===t?rZ(e):rQ([e],t)}function rY(e,t){return e instanceof Float32Array&&"float32"===t||e instanceof Int32Array&&"int32"===t||e instanceof Uint8Array&&"bool"===t}function rQ(e,t){if("string"===t)throw Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(e)&&(e=r2(e)),eN().getBool("DEBUG")&&er(e,t),rY(e,t))return e;if(null==t||"float32"===t||"complex64"===t)return new Float32Array(e);if("int32"===t)return new Int32Array(e);if("bool"===t){let t=new Uint8Array(e.length);for(let n=0;n<t.length;++n)0!==Math.round(e[n])&&(t[n]=1);return t}throw Error(`Unknown data type ${t}`)}function rJ(){return eN().platform.now()}function rZ(e,t="utf-8"){return t=t||"utf-8",eN().platform.encode(e,t)}function r0(e,t="utf-8"){return t=t||"utf-8",eN().platform.decode(e,t)}function r1(e){return null!=eN().platform.isTypedArray?eN().platform.isTypedArray(e):rN(e)}function r2(e,t=[],n=!1){if(null==t&&(t=[]),"boolean"==typeof e||"number"==typeof e||"string"==typeof e||eI(e)||null==e||r1(e)&&n)t.push(e);else if(Array.isArray(e)||r1(e))for(let r=0;r<e.length;++r)r2(e[r],t,n);else{let r=-1;for(let t of Object.keys(e))/^([1-9]+[0-9]*|0)$/.test(t)&&(r=Math.max(r,Number(t)));for(let i=0;i<=r;i++)r2(e[i],t,n)}return t}class r3{constructor(e,t){this.backendTimer=e,this.logger=t,null==t&&(this.logger=new r6)}profileKernel(e,t,n){let r,i;let s=()=>{r=n()},a=rJ();if(this.backendTimer.timerAvailable())i=this.backendTimer.time(s);else{for(let e of(s(),r))e.dataSync();i=Promise.resolve({kernelMs:rJ()-a})}if(eN().getBool("CHECK_COMPUTATION_FOR_ERRORS"))for(let t=0;t<r.length;t++){let n=r[t];n.data().then(t=>{r4(t,n.dtype,e)})}return{kernelName:e,outputs:r,inputs:t,timeMs:i.then(e=>e.kernelMs),extraInfo:i.then(e=>null!=e.getExtraProfileInfo?e.getExtraProfileInfo():"")}}logKernelProfile(e){let{kernelName:t,outputs:n,timeMs:r,inputs:i,extraInfo:s}=e;n.forEach(e=>{Promise.all([e.data(),r,s]).then(n=>{this.logger.logKernelProfile(t,e,n[0],n[1],i,n[2])})})}}function r4(e,t,n){if("float32"!==t)return!1;for(let t=0;t<e.length;t++){let r=e[t];if(isNaN(r)||!isFinite(r))return console.warn(`Found ${r} in the result of '${n}'`),!0}return!1}class r6{logKernelProfile(e,t,n,r,i,s){let a="number"==typeof r?Y(`${r}ms`,9):r.error,o=Y(e,25),l=t.rank,u=t.size,c=Y(t.shape.toString(),14),h="";for(let e in i){let n=i[e];if(null!=n){let r=n.shape||t.shape,i=r.length;h+=`${e}: ${i}D ${i>0?r:""} `}}console.log(`%c${o}	%c${a}	%c${l}D ${c}	%c${u}	%c${h}	%c${s}`,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")}}function r5(e,t,n){let r={},i={};for(let e=0;e<t.length;e++)r[t[e].id]=!0;for(let n=0;n<e.length;n++){let s=e[n],a=s.inputs;for(let e in a){let n=a[e],o=!1;for(let e=0;e<t.length;e++)if(r[n.id]){s.outputs.forEach(e=>r[e.id]=!0),o=!0,i[s.id]=!0;break}if(o)break}}let s={};s[n.id]=!0;let a={};for(let t=e.length-1;t>=0;t--){let n=e[t],r=n.inputs;for(let e=0;e<n.outputs.length;e++)if(s[n.outputs[e].id]){for(let e in r)s[r[e].id]=!0,a[n.id]=!0;break}}let o=[];for(let t=0;t<e.length;t++){let n=e[t];if(i[n.id]&&a[n.id]){let e={};for(let t in n.inputs){let i=n.inputs[t];r[i.id]&&(e[t]=i)}let t=Object.assign({},n);t.inputs=e,t.outputs=n.outputs,o.push(t)}}return o}function r8(e,t,n,r){for(let i=t.length-1;i>=0;i--){let s=t[i],a=[];if(s.outputs.forEach(t=>{let n=e[t.id];null!=n?a.push(n):a.push(null)}),null==s.gradient)throw Error(`Cannot compute gradient: gradient function not found for ${s.kernelName}.`);let o=s.gradient(a);for(let t in s.inputs){if(!(t in o))throw Error(`Cannot backprop through input ${t}. Available gradients found: ${Object.keys(o)}.`);let i=n(()=>o[t]());if("float32"!==i.dtype)throw Error(`Error in gradient for op ${s.kernelName}. The gradient of input ${t} must have 'float32' dtype, but has '${i.dtype}'`);let a=s.inputs[t];if(!H(i.shape,a.shape))throw Error(`Error in gradient for op ${s.kernelName}. The gradient of input '${t}' has shape '${i.shape}', which does not match the shape of the input '${a.shape}'`);if(null==e[a.id])e[a.id]=i;else{let t=e[a.id];e[a.id]=r(t,i),t.dispose()}}}}let r7=20,r9=3,ie=7;function it(e,t,n,r){let i=ef(t),s=ir(e,t,n,i),a=t.length,o=ia(e,t,n,i,s),l=["Tensor"];return r&&(l.push(`  dtype: ${n}`),l.push(`  rank: ${a}`),l.push(`  shape: [${t}]`),l.push("  values:")),l.push(o.map(e=>"    "+e).join("\n")),l.join("\n")}function ir(e,t,n,r){let i=q(t),s=r[r.length-1],a=Array(s).fill(0),o=t.length,l="complex64"===n?io(e):e;if(o>1)for(let e=0;e<i/s;e++){let t=e*s;for(let e=0;e<s;e++)a[e]=Math.max(a[e],ii(l[t+e],0,n).length)}return a}function ii(e,t,n){let r;return Y(r=Array.isArray(e)?`${parseFloat(e[0].toFixed(ie))} + ${parseFloat(e[1].toFixed(ie))}j`:el(e)?`'${e}'`:"bool"===n?is(e):parseFloat(e.toFixed(ie)).toString(),t)}function is(e){return 0===e?"false":"true"}function ia(e,t,n,r,i,s=!0){let a="complex64"===n?2:1,o=t[0],l=t.length;if(0===l)return"complex64"===n?[ii(io(e)[0],0,n)]:"bool"===n?[is(e[0])]:[e[0].toString()];if(1===l){if(o>r7){let t=r9*a,r=Array.from(e.slice(0,t)),s=Array.from(e.slice((o-r9)*a,o*a));return"complex64"===n&&(r=io(r),s=io(s)),["["+r.map((e,t)=>ii(e,i[t],n)).join(", ")+", ..., "+s.map((e,t)=>ii(e,i[o-r9+t],n)).join(", ")+"]"]}return["["+("complex64"===n?io(e):Array.from(e)).map((e,t)=>ii(e,i[t],n)).join(", ")+"]"]}let u=t.slice(1),c=r.slice(1),h=r[0]*a,d=[];if(o>r7){for(let t=0;t<r9;t++){let r=t*h,s=r+h;d.push(...ia(e.slice(r,s),u,n,c,i,!1))}d.push("...");for(let t=o-r9;t<o;t++){let r=t*h,s=r+h;d.push(...ia(e.slice(r,s),u,n,c,i,t===o-1))}}else for(let t=0;t<o;t++){let r=t*h,s=r+h;d.push(...ia(e.slice(r,s),u,n,c,i,t===o-1))}let p=2===l?",":"";d[0]="["+(o>0?d[0]+p:"");for(let e=1;e<d.length-1;e++)d[e]=" "+d[e]+p;let f=",\n";for(let e=2;e<l;e++)f+="\n";return d[d.length-1]=" "+d[d.length-1]+"]"+(s?"":f),d}function io(e){let t=[];for(let n=0;n<e.length;n+=2)t.push([e[n],e[n+1]]);return t}class il{constructor(e,t,n){if(this.dtype=t,this.shape=e.slice(),this.size=q(e),null!=n){let e=n.length;j(e===this.size,()=>`Length of values '${e}' does not match the size inferred by the shape '${this.size}'.`)}if("complex64"===t)throw Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=n||en(t,this.size),this.strides=ef(e)}set(e,...t){0===t.length&&(t=[0]),j(t.length===this.rank,()=>`The number of provided coordinates (${t.length}) must match the rank (${this.rank})`);let n=this.locToIndex(t);this.values[n]=e}get(...e){0===e.length&&(e=[0]);let t=0;for(let n of e){if(n<0||n>=this.shape[t])throw Error(`Requested out of range element at ${e}.   Buffer shape=${this.shape}`);t++}let n=e[e.length-1];for(let t=0;t<e.length-1;++t)n+=this.strides[t]*e[t];return this.values[n]}locToIndex(e){if(0===this.rank)return 0;if(1===this.rank)return e[0];let t=e[e.length-1];for(let n=0;n<e.length-1;++n)t+=this.strides[n]*e[n];return t}indexToLoc(e){if(0===this.rank)return[];if(1===this.rank)return[e];let t=Array(this.shape.length);for(let n=0;n<t.length-1;++n)t[n]=Math.floor(e/this.strides[n]),e-=t[n]*this.strides[n];return t[t.length-1]=e,t}get rank(){return this.shape.length}toTensor(){return iu().makeTensor(this.values,this.shape,this.dtype)}}let iu=null,ic=null,ih=null;function id(e){iu=e}function ip(e){ic=e}function ig(e){ih=e}class im{constructor(e,t,n,r){this.kept=!1,this.isDisposedInternal=!1,this.shape=e.slice(),this.dtype=t||"float32",this.size=q(e),this.strides=ef(e),this.dataId=n,this.id=r,this.rankType=this.rank<5?this.rank.toString():"higher"}get rank(){return this.shape.length}async buffer(){let e=await this.data();return ic.buffer(this.shape,this.dtype,e)}bufferSync(){return ic.buffer(this.shape,this.dtype,this.dataSync())}async array(){let e=await this.data();return em(this.shape,e,"complex64"===this.dtype)}arraySync(){return em(this.shape,this.dataSync(),"complex64"===this.dtype)}async data(){this.throwIfDisposed();let e=iu().read(this.dataId);if("string"===this.dtype){let t=await e;try{return t.map(e=>r0(e))}catch(e){throw Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}}return e}dataToGPU(e){return this.throwIfDisposed(),iu().readToGPU(this.dataId,e)}dataSync(){this.throwIfDisposed();let e=iu().readSync(this.dataId);if("string"===this.dtype)try{return e.map(e=>r0(e))}catch(e){throw Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return e}async bytes(){this.throwIfDisposed();let e=await iu().read(this.dataId);return"string"===this.dtype?e:new Uint8Array(e.buffer)}dispose(){this.isDisposed||(this.kerasMask&&this.kerasMask.dispose(),iu().disposeTensor(this),this.isDisposedInternal=!0)}get isDisposed(){return this.isDisposedInternal}throwIfDisposed(){if(this.isDisposed)throw Error("Tensor is disposed.")}print(e=!1){return ic.print(this,e)}clone(){return this.throwIfDisposed(),ic.clone(this)}toString(e=!1){return it(this.dataSync(),this.shape,this.dtype,e)}cast(e){return this.throwIfDisposed(),ic.cast(this,e)}variable(e=!0,t,n){return this.throwIfDisposed(),iu().makeVariable(this,e,t,n)}}function iy(){return eP("Tensor",()=>im)}Object.defineProperty(im,Symbol.hasInstance,{value:e=>!!e&&null!=e.data&&null!=e.dataSync&&null!=e.throwIfDisposed}),iy();class ib extends im{constructor(e,t,n,r){super(e.shape,e.dtype,e.dataId,r),this.trainable=t,this.name=n}assign(e){if(e.dtype!==this.dtype)throw Error(`dtype of the new value (${e.dtype}) and previous value (${this.dtype}) must match`);if(!H(e.shape,this.shape))throw Error(`shape of the new value (${e.shape}) and previous value (${this.shape}) must match`);iu().disposeTensor(this),this.dataId=e.dataId,iu().incRef(this,null)}dispose(){iu().disposeVariable(this),this.isDisposedInternal=!0}}Object.defineProperty(ib,Symbol.hasInstance,{value:e=>e instanceof im&&null!=e.assign&&e.assign instanceof Function}),function(e){e.R0="R0",e.R1="R1",e.R2="R2",e.R3="R3",e.R4="R4",e.R5="R5",e.R6="R6"}(f||(f={})),function(e){e.float32="float32",e.int32="int32",e.bool="int32",e.complex64="complex64"}(g||(g={})),function(e){e.float32="float32",e.int32="int32",e.bool="bool",e.complex64="complex64"}(m||(m={})),function(e){e.float32="float32",e.int32="float32",e.bool="float32",e.complex64="complex64"}(y||(y={})),function(e){e.float32="complex64",e.int32="complex64",e.bool="complex64",e.complex64="complex64"}(b||(b={}));let iv={float32:y,int32:g,bool:m,complex64:b};function iw(e,t){if("string"===e||"string"===t){if("string"===e&&"string"===t)return"string";throw Error(`Can not upcast ${e} with ${t}`)}return iv[e][t]}function i_(e){return iw(e,"int32")}function ix(e){return null!=e&&"object"==typeof e&&"texture"in e&&e.texture instanceof WebGLTexture}function iT(e){return"undefined"!=typeof GPUBuffer&&null!=e&&"object"==typeof e&&"buffer"in e&&e.buffer instanceof GPUBuffer}function iI(e,t){if(e.dtype===t.dtype)return[e,t];let n=iw(e.dtype,t.dtype);return[e.cast(n),t.cast(n)]}function ik(e,t){return t.some(t=>t.id===e.id)}function iS(e){let t=[];return iE(e,t,new Set),t}function iE(e,t,n){if(null==e)return;if(e instanceof im){t.push(e);return}if(!iC(e))return;let r=e;for(let e in r){let i=r[e];n.has(i)||(n.add(i),iE(i,t,n))}}function iC(e){return Array.isArray(e)||"object"==typeof e}function iA(e){return null!=e.kernelName}class iN{constructor(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null,get kernelNames(){return Array.from(new Set(this.kernels.map(e=>e.name)))}}}dispose(){for(let e in this.registeredVariables)this.registeredVariables[e].dispose()}}class iO{constructor(e){this.ENV=e,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new iN}async ready(){if(null!=this.pendingBackendInit)return this.pendingBackendInit.then(()=>{});if(null!=this.backendInstance)return;let e=this.getSortedBackends();for(let t=0;t<e.length;t++){let n=e[t];if(await this.initializeBackend(n).success){await this.setBackend(n);return}}throw Error("Could not initialize any backends, all backend initializations failed.")}get backend(){if(null!=this.pendingBackendInit)throw Error(`Backend '${this.backendName}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);if(null==this.backendInstance){let{name:e,asyncInit:t}=this.initializeBackendsAndReturnBest();if(t)throw Error(`The highest priority backend '${e}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);this.setBackend(e)}return this.backendInstance}backendNames(){return Object.keys(this.registryFactory)}findBackend(e){if(!(e in this.registry)){if(!(e in this.registryFactory))return null;{let{asyncInit:t}=this.initializeBackend(e);if(t)return null}}return this.registry[e]}findBackendFactory(e){return e in this.registryFactory?this.registryFactory[e].factory:null}registerBackend(e,t,n=1){return e in this.registryFactory?(rw(`${e} backend was already registered. Reusing existing backend factory.`),!1):(this.registryFactory[e]={factory:t,priority:n},!0)}async setBackend(e){if(null==this.registryFactory[e])throw Error(`Backend name '${e}' not found in registry`);if(this.backendName=e,null==this.registry[e]){this.backendInstance=null;let{success:t,asyncInit:n}=this.initializeBackend(e);if(!(n?await t:t))return!1}return this.backendInstance=this.registry[e],this.setupRegisteredKernels(),this.profiler=new r3(this.backendInstance),!0}setupRegisteredKernels(){rS(this.backendName).forEach(e=>{null!=e.setupFunc&&e.setupFunc(this.backendInstance)})}disposeRegisteredKernels(e){rS(e).forEach(t=>{null!=t.disposeFunc&&t.disposeFunc(this.registry[e])})}initializeBackend(e){let t=this.registryFactory[e];if(null==t)throw Error(`Cannot initialize backend ${e}, no registration found.`);try{let n=t.factory();if(!n||n instanceof P||"function"!=typeof n.then)return this.registry[e]=n,{success:!0,asyncInit:!1};{let t=++this.pendingBackendInitId,r=n.then(n=>!(t<this.pendingBackendInitId)&&(this.registry[e]=n,this.pendingBackendInit=null,!0)).catch(n=>!(t<this.pendingBackendInitId)&&(this.pendingBackendInit=null,rw(`Initialization of backend ${e} failed`),rw(n.stack||n.message),!1));return this.pendingBackendInit=r,{success:r,asyncInit:!0}}}catch(t){return rw(`Initialization of backend ${e} failed`),rw(t.stack||t.message),{success:!1,asyncInit:!1}}}removeBackend(e){if(!(e in this.registryFactory))throw Error(`${e} backend not found in registry`);this.backendName===e&&null!=this.pendingBackendInit&&this.pendingBackendInitId++,e in this.registry&&(this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e]),delete this.registryFactory[e],this.backendName===e&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)}getSortedBackends(){if(0===Object.keys(this.registryFactory).length)throw Error("No backend found in registry.");return Object.keys(this.registryFactory).sort((e,t)=>this.registryFactory[t].priority-this.registryFactory[e].priority)}initializeBackendsAndReturnBest(){let e=this.getSortedBackends();for(let t=0;t<e.length;t++){let n=e[t],{success:r,asyncInit:i}=this.initializeBackend(n);if(i||r)return{name:n,asyncInit:i}}throw Error("Could not initialize any backends, all backend initializations failed.")}moveData(e,t){let n=this.state.tensorInfo.get(t),r=n.backend,i=this.readSync(t),s=r.refCount(t);r.disposeData(t,!0),n.backend=e,e.move(t,i,n.shape,n.dtype,s),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++}tidy(e,t){let n,r=null;if(null==t){if("function"!=typeof e)throw Error("Please provide a function to tidy()");t=e}else{if("string"!=typeof e&&!(e instanceof String))throw Error("When calling with two arguments, the first argument to tidy() must be a string");if("function"!=typeof t)throw Error("When calling with two arguments, the 2nd argument to tidy() must be a function");r=e}return this.scopedRun(()=>this.startScope(r),()=>this.endScope(n),()=>((n=t())instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),n))}scopedRun(e,t,n){e();try{let e=n();return t(),e}catch(e){throw t(),e}}nextTensorId(){return iO.nextTensorId++}nextVariableId(){return iO.nextVariableId++}clone(e){let t=iD.runKernel(tj,{x:e}),n={x:e},r=e=>({x:()=>{let t={x:e},n={dtype:"float32"};return iD.runKernel(e8,t,n)}}),i=[];return this.addTapeNode(this.state.activeScope.name,n,[t],r,i,{}),t}runKernel(e,t,n){if(null==this.backendName&&this.backend,!(null!=rI(e,this.backendName)))throw Error(`Kernel '${e}' not registered for backend '${this.backendName}'`);return this.runKernelFunc({kernelName:e,inputs:t,attrs:n})}shouldCheckForMemLeaks(){return this.ENV.getBool("IS_TEST")}checkKernelForMemLeak(e,t,n){let r=this.backend.numDataIds(),i=0;n.forEach(e=>{i+="complex64"===e.dtype?3:1});let s=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],a=r-t-i-s;if(a>0)throw Error(`Backend '${this.backendName}' has an internal memory leak (${a} data ids) after running '${e}'`)}runKernelFunc(e){let t,n,r,i;let s=[],a=this.isTapeOn(),o=this.state.numBytes,l=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0),null==this.backendName&&this.backend;let u=iA(e)?e.kernelName:null!=this.state.activeScope?this.state.activeScope.name:"";if(iA(e)){let{kernelName:t,inputs:i,attrs:o}=e;null==this.backendName&&this.backend;let l=rI(t,this.backendName);j(null!=l,()=>`Cannot find registered kernel '${t}' for backend '${this.backendName}'`),n=()=>{let e=this.backend.numDataIds(),n=Array.isArray(r=l.kernelFunc({inputs:i,attrs:o,backend:this.backend}))?r:[r];this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(t,e,n);let u=n.map(e=>null!=e.rank?e:this.makeTensorFromTensorInfo(e));if(a){let e=this.getTensorsForGradient(t,i,u);s=this.saveTensorsForBackwardMode(e)}return u}}else{let{forwardFunc:t}=e,i=e=>{a&&(s=e.map(e=>this.keep(this.clone(e))))};n=()=>{let e=this.backend.numDataIds(),n=Array.isArray(r=this.tidy(()=>t(this.backend,i)))?r:[r];return this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(u,e,n),n}}let{inputs:c,attrs:h}=e,d=iA(e)?null:e.backwardsFunc;return this.scopedRun(()=>this.state.kernelDepth++,()=>this.state.kernelDepth--,()=>{this.ENV.getBool("DEBUG")||this.state.profiling?(i=this.profiler.profileKernel(u,c,()=>n()),this.ENV.getBool("DEBUG")&&this.profiler.logKernelProfile(i),t=i.outputs):t=n()}),a&&this.addTapeNode(u,c,t,d,s,h),this.state.profiling&&this.state.activeProfile.kernels.push({name:u,bytesAdded:this.state.numBytes-o,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-l,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(c).map(e=>null!=c[e]?c[e].shape:null),outputShapes:t.map(e=>e.shape),kernelTimeMs:i.timeMs,extraInfo:i.extraInfo}),Array.isArray(r)?t:t[0]}saveTensorsForBackwardMode(e){return e.map(e=>this.keep(this.clone(e)))}getTensorsForGradient(e,t,n){let r=rk(e);if(null!=r){let e;let i=r.inputsToSave||[],s=r.outputsToSave||[];r.saveAllInputs?(j(Array.isArray(t),()=>"saveAllInputs is true, expected inputs to be an array."),e=Object.keys(t).map(e=>t[e])):e=i.map(e=>t[e]);let a=n.filter((e,t)=>s[t]);return e.concat(a)}return[]}makeTensor(e,t,n,r){if(null==e)throw Error("Values passed to engine.makeTensor() are null");n=n||"float32",r=r||this.backend;let i=e;"string"===n&&el(e[0])&&(i=e.map(e=>rZ(e)));let s=r.write(i,t,n),a=new im(t,n,s,this.nextTensorId());if(this.trackTensor(a,r),"string"===n){let e=this.state.tensorInfo.get(s),t=eo(i);this.state.numBytes+=t-e.bytes,e.bytes=t}return a}makeTensorFromDataId(e,t,n,r){let i={dataId:e,shape:t,dtype:n=n||"float32"};return this.makeTensorFromTensorInfo(i,r)}makeTensorFromTensorInfo(e,t){let{dataId:n,shape:r,dtype:i}=e,s=new im(r,i,n,this.nextTensorId());return this.trackTensor(s,t),s}makeVariable(e,t=!0,n,r){n=n||this.nextVariableId().toString(),null!=r&&r!==e.dtype&&(e=e.cast(r));let i=new ib(e,t,n,this.nextTensorId());if(null!=this.state.registeredVariables[i.name])throw Error(`Variable with name ${i.name} was already registered`);return this.state.registeredVariables[i.name]=i,this.incRef(i,this.backend),i}trackTensor(e,t){this.state.numTensors++,"string"===e.dtype&&this.state.numStringTensors++;let n=0;"complex64"!==e.dtype&&"string"!==e.dtype&&(n=e.size*ea(e.dtype)),this.state.numBytes+=n,this.state.tensorInfo.has(e.dataId)||(this.state.numDataBuffers++,this.state.tensorInfo.set(e.dataId,{backend:t||this.backend,dtype:e.dtype,shape:e.shape,bytes:n})),e instanceof ib||this.track(e)}incRef(e,t){this.trackTensor(e,t),this.backend.incRef(e.dataId)}removeDataId(e,t){this.state.tensorInfo.has(e)&&this.state.tensorInfo.get(e).backend===t&&(this.state.tensorInfo.delete(e),this.state.numDataBuffers--)}disposeTensor(e){if(!this.state.tensorInfo.has(e.dataId))return;let t=this.state.tensorInfo.get(e.dataId);if(this.state.numTensors--,"string"===e.dtype&&(this.state.numStringTensors--,this.state.numBytes-=t.bytes),"complex64"!==e.dtype&&"string"!==e.dtype){let t=e.size*ea(e.dtype);this.state.numBytes-=t}t.backend.disposeData(e.dataId)&&this.removeDataId(e.dataId,t.backend)}disposeVariables(){for(let e in this.state.registeredVariables){let t=this.state.registeredVariables[e];this.disposeVariable(t)}}disposeVariable(e){this.disposeTensor(e),null!=this.state.registeredVariables[e.name]&&delete this.state.registeredVariables[e.name]}memory(){let e=this.backend.memory();return e.numTensors=this.state.numTensors,e.numDataBuffers=this.state.numDataBuffers,e.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(e.unreliable=!0,null==e.reasons&&(e.reasons=[]),e.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),e}async profile(e){this.state.profiling=!0;let t=this.state.numBytes,n=this.state.numTensors;for(let r of(this.state.activeProfile.kernels=[],this.state.activeProfile.result=await e(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max(...this.state.activeProfile.kernels.map(e=>e.totalBytesSnapshot)),this.state.activeProfile.newBytes=this.state.numBytes-t,this.state.activeProfile.newTensors=this.state.numTensors-n,this.state.activeProfile.kernels))r.kernelTimeMs=await r.kernelTimeMs,r.extraInfo=await r.extraInfo;return this.state.activeProfile}isTapeOn(){return this.state.gradientDepth>0&&0===this.state.kernelDepth}addTapeNode(e,t,n,r,i,s){let a={id:this.state.nextTapeNodeId++,kernelName:e,inputs:t,outputs:n,saved:i},o=rk(e);null!=o&&(r=o.gradFunc),null!=r&&(a.gradient=e=>(e=e.map((e,t)=>{if(null==e){let e=n[t],r=ev(e.size,e.dtype);return this.makeTensor(r,e.shape,e.dtype)}return e}),r(e.length>1?e:e[0],i,s))),this.state.activeTape.push(a)}keep(e){return e.kept=!0,e}startTape(){0===this.state.gradientDepth&&(this.state.activeTape=[]),this.state.gradientDepth++}endTape(){this.state.gradientDepth--}startScope(e){let t={track:[],name:"unnamed scope",id:this.state.nextScopeId++};e&&(t.name=e),this.state.scopeStack.push(t),this.state.activeScope=t}endScope(e){let t=iS(e),n=new Set(t.map(e=>e.id));for(let e=0;e<this.state.activeScope.track.length;e++){let t=this.state.activeScope.track[e];t.kept||n.has(t.id)||t.dispose()}let r=this.state.scopeStack.pop();this.state.activeScope=0===this.state.scopeStack.length?null:this.state.scopeStack[this.state.scopeStack.length-1],t.forEach(e=>{e.kept||e.scopeId!==r.id||this.track(e)})}gradients(e,t,n,r=!1){if(j(t.length>0,()=>"gradients() received an empty list of xs."),null!=n&&"float32"!==n.dtype)throw Error(`dy must have 'float32' dtype, but has '${n.dtype}'`);let i=this.scopedRun(()=>this.startTape(),()=>this.endTape(),()=>this.tidy("forward",e));j(i instanceof im,()=>"The result y returned by f() must be a tensor.");let s=r5(this.state.activeTape,t,i);if(!r&&0===s.length&&t.length>0)throw Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",()=>{let e={};e[i.id]=null==n?i$(i.shape):n,r8(e,s,e=>this.tidy(e),iF);let r=t.map(t=>e[t.id]);return 0===this.state.gradientDepth&&(this.state.activeTape.forEach(e=>{for(let t of e.saved)t.dispose()}),this.state.activeTape=null),{value:i,grads:r}})}customGrad(e){return j(ed(e),()=>"The f passed in customGrad(f) must be a function."),(...t)=>{let n;j(t.every(e=>e instanceof im),()=>"The args passed in customGrad(f)(x1, x2,...) must all be tensors");let r={};t.forEach((e,t)=>{r[t]=e});let i=(r,i)=>(j((n=e(...t,i)).value instanceof im,()=>"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"),j(ed(n.gradFunc),()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."),n.value),s=(e,r)=>{let i=n.gradFunc(e,r),s=Array.isArray(i)?i:[i];j(s.length===t.length,()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."),j(s.every(e=>e instanceof im),()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors.");let a={};return s.forEach((e,t)=>{a[t]=()=>e}),a};return this.runKernelFunc({forwardFunc:i,backwardsFunc:s,inputs:r})}}readSync(e){return this.state.tensorInfo.get(e).backend.readSync(e)}read(e){return this.state.tensorInfo.get(e).backend.read(e)}readToGPU(e,t){return this.state.tensorInfo.get(e).backend.readToGPU(e,t)}async time(e){let t=rJ(),n=await this.backend.time(e);return n.wallMs=rJ()-t,n}track(e){return null!=this.state.activeScope&&(e.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(e)),e}get registeredVariables(){return this.state.registeredVariables}reset(){for(let e in this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new iN,this.registry)this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null}}function i$(e){let t=eb(q(e),"float32");return iD.makeTensor(t,e,"float32")}function iR(){let e=eD();if(null==e._tfengine){let t=new eS(e);e._tfengine=new iO(t)}return e$(e._tfengine.ENV),id(()=>e._tfengine),e._tfengine}iO.nextTensorId=0,iO.nextVariableId=0;let iD=iR();function iF(e,t){let n={a:e,b:t};return iD.runKernel(eB,n)}function iP(){return"undefined"!=typeof navigator&&null!=navigator}function iM(e){if(void 0!==i)return i;if(e||iP()){if(e||(e=navigator),"ReactNative"===e.product)return!0;let t=e.userAgent||e.vendor||("undefined"!=typeof window?window.opera:"");if(!t){let t=e;return t.userAgentData&&t.userAgentData.mobile}return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0,4))}return!1}function iL(){return"undefined"!=typeof window&&null!=window.document||"undefined"!=typeof WorkerGlobalScope}var iz=n(7836);let iB=eN();function iU(e,t){let n=e;if(r1(e))return"string"===t?[]:[e.length];if(ix(e)){let t=e.channels||"RGBA";return[e.height,e.width*t.length]}if(iT(e))return[e.buffer.size/(null==t?4:ea(t))];if(!Array.isArray(e))return[];let r=[];for(;Array.isArray(n)||r1(n)&&"string"!==t;)r.push(n.length),n=n[0];return Array.isArray(e)&&eN().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&iV(e,r,[]),r}function iV(e,t,n){if(n=n||[],!Array.isArray(e)&&!r1(e)){j(0===t.length,()=>`Element arr[${n.join("][")}] is a primitive, but should be an array/TypedArray of ${t[0]} elements`);return}j(t.length>0,()=>`Element arr[${n.join("][")}] should be a primitive, but is an array of ${e.length} elements`),j(e.length===t[0],()=>`Element arr[${n.join("][")}] should have ${t[0]} elements, but has ${e.length} elements`);let r=t.slice(1);for(let t=0;t<e.length;++t)iV(e[t],r,n.concat(t))}function ij(e,t,n,r){if("string_or_numeric"!==e){if(null==e)throw Error("Expected dtype cannot be null.");if("numeric"!==e&&e!==t||"numeric"===e&&"string"===t)throw Error(`Argument '${n}' passed to '${r}' must be ${e} tensor, but got ${t} tensor`)}}function iG(e,t,n,r="numeric"){if(e instanceof iy())return ij(r,e.dtype,t,n),e;let i=eh(e);if("string"!==i&&["bool","int32","float32"].indexOf(r)>=0&&(i=r),ij(r,i,t,n),null==e||!r1(e)&&!Array.isArray(e)&&"number"!=typeof e&&"boolean"!=typeof e&&"string"!=typeof e){let r=null==e?"null":e.constructor.name;throw Error(`Argument '${t}' passed to '${n}' must be a Tensor or TensorLike, but got '${r}'`)}let s=iU(e,i);r1(e)||Array.isArray(e)||(e=[e]);let a=!0,o="string"!==i?rQ(e,i):r2(e,[],a);return iD.makeTensor(o,s,i)}function iW(e,t,n,r="numeric"){if(!Array.isArray(e))throw Error(`Argument ${t} passed to ${n} must be a \`Tensor[]\` or \`TensorLike[]\``);return e.map((e,i)=>iG(e,`${t}[${i}]`,n,r))}iB.registerFlag("DEBUG",()=>!1,e=>{e&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")}),iB.registerFlag("IS_BROWSER",()=>iL()),iB.registerFlag("IS_NODE",()=>void 0!==iz&&void 0!==iz.versions&&void 0!==iz.versions.node),iB.registerFlag("IS_CHROME",()=>"undefined"!=typeof navigator&&null!=navigator&&null!=navigator.userAgent&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)),iB.registerFlag("IS_SAFARI",()=>"undefined"!=typeof navigator&&null!=navigator&&null!=navigator.userAgent&&/Safari/.test(navigator.userAgent)&&/Apple/.test(navigator.vendor)),iB.registerFlag("PROD",()=>!1),iB.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",()=>iB.getBool("DEBUG")),iB.registerFlag("DEPRECATION_WARNINGS_ENABLED",()=>!0),iB.registerFlag("IS_TEST",()=>!1),iB.registerFlag("CHECK_COMPUTATION_FOR_ERRORS",()=>iB.getBool("DEBUG")),iB.registerFlag("WRAP_TO_IMAGEBITMAP",()=>!1),iB.registerFlag("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU",()=>!1),iB.registerFlag("USE_SETTIMEOUTCUSTOM",()=>!1);let iq="__op";function iH(e){let t=Object.keys(e);if(1!==t.length)throw Error(`Please provide an object with a single key (operation name) mapping to a function. Got an object with ${t.length} keys.`);let n=t[0],r=e[n];n.endsWith("_")&&(n=n.substring(0,n.length-1));let i=(...e)=>{iD.startScope(n);try{let t=r(...e);return eI(t)&&console.error("Cannot return a Promise inside of tidy."),iD.endScope(t),t}catch(e){throw iD.endScope(null),e}};return Object.defineProperty(i,"name",{value:n+=iq,configurable:!0}),i}let iK=iH({complex_:function(e,t){let n=iG(e,"real","complex"),r=iG(t,"imag","complex");G(n.shape,r.shape,`real and imag shapes, ${n.shape} and ${r.shape}, must match in call to tf.complex().`);let i={real:n,imag:r};return iD.runKernel(te,i)}});function iX(e,t,n,r){if(null==r)r=eh(e);else if("complex64"===r)throw Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(iT(e)||ix(e)){if("float32"!==r&&"int32"!==r)throw Error(`Creating tensor from GPU data only supports 'float32'|'int32' dtype, while the dtype is ${r}.`);return iD.backend.createTensorFromGPUData(e,t||n,r)}if(!r1(e)&&!Array.isArray(e)&&"number"!=typeof e&&"boolean"!=typeof e&&"string"!=typeof e)throw Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(null!=t){e_(t);let e=q(t),r=q(n);j(e===r,()=>`Based on the provided shape, [${t}], the tensor should have ${e} values but has ${r}`);for(let e=0;e<n.length;++e){let r=n[e],i=e!==n.length-1||r!==q(t.slice(e));j(n[e]===t[e]||!i,()=>`Error creating a new Tensor. Inferred shape (${n}) does not match the provided shape (${t}). `)}}return r1(e)||Array.isArray(e)||(e=[e]),t=t||n,e="string"!==r?rQ(e,r):r2(e,[],!0),iD.makeTensor(e,t,r)}function iY(e,t,n){let r=iU(e,n);return iX(e,t,r,n)}let iQ={float32:4,float16:2,int32:4,uint16:2,uint8:1,bool:1,complex64:8};class iJ{static join(e){return new iJ(e).slice()}constructor(e){if(this.shards=[],this.previousShardIndex=0,null==e||(e instanceof Array||(e=[e]),0===(e=e.map(e=>r1(e)?e.buffer:e)).length))return;this.bufferUniformSize=e[0].byteLength;let t=0;for(let n=0;n<e.length;n++){let r=e[n];n!==e.length-1&&r.byteLength!==this.bufferUniformSize&&(this.bufferUniformSize=void 0);let i=t+r.byteLength;this.shards.push({buffer:r,start:t,end:i}),t=i}0===this.shards.length&&(this.byteLength=0),this.byteLength=this.shards[this.shards.length-1].end}slice(e=0,t=this.byteLength){if(0===this.shards.length||(e=isNaN(Number(e))?0:e,t=isNaN(Number(t))?0:t,e=Math.max(0,e),(t=Math.min(this.byteLength,t))<=e))return new ArrayBuffer(0);let n=this.findShardForByte(e);if(-1===n)throw Error(`Could not find start shard for byte ${e}`);let r=new ArrayBuffer(t-e),i=new Uint8Array(r),s=0;for(let r=n;r<this.shards.length;r++){let n=this.shards[r],a=e+s-n.start,o=s,l=Math.min(t,n.end)-n.start,u=new Uint8Array(n.buffer,a,l-a);if(i.set(u,o),s+=u.length,t<n.end)break}return r}findShardForByte(e){if(0===this.shards.length||e<0||e>=this.byteLength)return -1;if(null!=this.bufferUniformSize)return this.previousShardIndex=Math.floor(e/this.bufferUniformSize),this.previousShardIndex;function t(t){return e<t.start?-1:e>=t.end?1:0}if(0===t(this.shards[this.previousShardIndex]))return this.previousShardIndex;let n=iZ(this.shards,t);return -1===n?-1:(this.previousShardIndex=n,this.previousShardIndex)}}function iZ(e,t){let n=0,r=e.length;for(;n<=r;){let i=Math.floor((r-n)/2)+n,s=t(e[i]);if(0===s)return i;s<0?r=i:n=i+1}return -1}function i0(){return iD}function i1(){return iD.memory()}function i2(e,t){return iD.tidy(e,t)}function i3(e){iS(e).forEach(e=>e.dispose())}function i4(e){return iD.keep(e)}function i6(e){return iD.setBackend(e)}function i5(){return iD.ready()}function i8(){return iD.backendName}function i7(e,t,n=1){return iD.registerBackend(e,t,n)}function i9(){return iD.backend}ig(function(e){eN().getBool("DEPRECATION_WARNINGS_ENABLED")&&console.warn(e+" You can disable deprecation warnings with tf.disableDeprecationWarnings().")});var se=n(8287).hp;let st=4;async function sn(e,t){let n=[],r=[],i=Array.isArray(e)?e.map(e=>e.name):Object.keys(e);for(let s=0;s<i.length;++s){let a=i[s],o=Array.isArray(e)?e[s].tensor:e[a];if("float32"!==o.dtype&&"int32"!==o.dtype&&"bool"!==o.dtype&&"string"!==o.dtype&&"complex64"!==o.dtype)throw Error(`Unsupported dtype in weight '${a}': ${o.dtype}`);let l={name:a,shape:o.shape,dtype:o.dtype};if("string"===o.dtype){let e=new Promise(async e=>{let t=await o.bytes(),n=new Uint8Array(t.reduce((e,t)=>e+t.length,0)+st*t.length),r=0;for(let e=0;e<t.length;e++){let i=t[e],s=new Uint8Array(new Uint32Array([i.length]).buffer);n.set(s,r),r+=st,n.set(i,r),r+=i.length}e(n)});r.push(e)}else r.push(o.data());null!=t&&(l.group=t),n.push(l)}return{data:ss(await Promise.all(r)),specs:n}}function sr(e,t){let n;let r=q(e.shape);if("quantization"in e)n=iQ[e.quantization.dtype];else if("string"===e.dtype){let e=0;for(let n=0;n<r;n++)e+=st+new Uint32Array(t(e,e+st))[0];return e}else n=iQ[e.dtype];return r*n}function si(e,t){let n;let r=e.name,i=e.dtype,s=e.shape,a=q(s),o=0;if("quantization"in e){let s=e.quantization;if("uint8"===s.dtype||"uint16"===s.dtype){if(!("min"in s&&"scale"in s))throw Error(`Weight ${e.name} with quantization ${s.dtype} doesn't have corresponding metadata min and scale.`)}else if("float16"===s.dtype){if("float32"!==i)throw Error(`Weight ${e.name} is quantized with ${s.dtype} which only supports weights of type float32 not ${i}.`)}else throw Error(`Weight ${e.name} has unknown quantization dtype ${s.dtype}. Supported quantization dtypes are: 'uint8', 'uint16', and 'float16'.`);let l=iQ[s.dtype],u="uint8"===s.dtype?new Uint8Array(t):new Uint16Array(t);if("float32"===i){if("uint8"===s.dtype||"uint16"===s.dtype){n=new Float32Array(u.length);for(let e=0;e<u.length;e++){let t=u[e];n[e]=t*s.scale+s.min}}else if("float16"===s.dtype)n=sv()(u);else throw Error(`Unsupported quantization type ${s.dtype} for weight type float32.`)}else if("int32"===i){if("uint8"!==s.dtype&&"uint16"!==s.dtype)throw Error(`Unsupported quantization type ${s.dtype} for weight type int32.`);n=new Int32Array(u.length);for(let e=0;e<u.length;e++){let t=u[e];n[e]=Math.round(t*s.scale+s.min)}}else throw Error(`Unsupported dtype in weight '${r}': ${i}`);o+=a*l}else if("string"===i){let r=q(e.shape);n=[];for(let e=0;e<r;e++){let e=new Uint32Array(t.slice(o,o+st))[0];o+=st;let r=new Uint8Array(t.slice(o,o+e));n.push(r),o+=e}}else{let e=iQ[i];if("float32"===i)n=new Float32Array(t);else if("int32"===i)n=new Int32Array(t);else if("bool"===i)n=new Uint8Array(t);else if("complex64"===i){n=new Float32Array(t);let e=new Float32Array(n.length/2),r=new Float32Array(n.length/2);for(let t=0;t<e.length;t++)e[t]=n[2*t],r[t]=n[2*t+1];let i=iY(e,s,"float32"),a=iY(r,s,"float32"),o=iK(i,a);return i.dispose(),a.dispose(),o}else throw Error(`Unsupported dtype in weight '${r}': ${i}`);o+=a*e}return iY(n,s,i)}function ss(e){if(null===e)throw Error(`Invalid input value: ${JSON.stringify(e)}`);let t=0,n=[];e.forEach(e=>{if(t+=e.byteLength,n.push(e.byteLength===e.buffer.byteLength?e:new e.constructor(e)),!(e instanceof Float32Array||e instanceof Int32Array||e instanceof Uint8Array))throw Error(`Unsupported TypedArray subtype: ${e.constructor.name}`)});let r=new Uint8Array(t),i=0;return n.forEach(e=>{r.set(new Uint8Array(e.buffer),i),i+=e.byteLength}),r.buffer}let sa=void 0!==se&&("undefined"==typeof Blob||"undefined"==typeof atob||"undefined"==typeof btoa);function so(e){return sa?se.byteLength(e,"utf8"):new Blob([e]).size}function sl(e){if(sa)return se.from(e).toString("base64");let t=new Uint8Array(e),n="";for(let e=0,r=t.length;e<r;e++)n+=String.fromCharCode(t[e]);return btoa(n)}function su(e){if(sa){let t=se.from(e,"base64");return t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength)}let t=atob(e),n=new Uint8Array(t.length);for(let e=0;e<t.length;++e)n.set([t.charCodeAt(e)],e);return n.buffer}function sc(e){return iJ.join(e)}function sh(e,t){let n={modelTopology:e.modelTopology,format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,weightsManifest:t};return null!=e.signature&&(n.signature=e.signature),null!=e.userDefinedMetadata&&(n.userDefinedMetadata=e.userDefinedMetadata),null!=e.modelInitializer&&(n.modelInitializer=e.modelInitializer),null!=e.initializerSignature&&(n.initializerSignature=e.initializerSignature),null!=e.trainingConfig&&(n.trainingConfig=e.trainingConfig),n}function sd(e,t,n){let r={modelTopology:e.modelTopology,format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy};if(null!=e.trainingConfig&&(r.trainingConfig=e.trainingConfig),null!=e.weightsManifest){if(!t)throw Error("modelJSON has weightsManifest but weightSpecs is null");if(!n)throw Error("modelJSON has weightsManifest but weightData is null");r.weightSpecs=t,r.weightData=n}return null!=e.signature&&(r.signature=e.signature),null!=e.userDefinedMetadata&&(r.userDefinedMetadata=e.userDefinedMetadata),null!=e.modelInitializer&&(r.modelInitializer=e.modelInitializer),null!=e.initializerSignature&&(r.initializerSignature=e.initializerSignature),r}async function sp(e,t){let n,r;return null!=e.weightsManifest&&([n,r]=await t(e.weightsManifest)),sd(e,n,r)}function sf(e){if(e.modelTopology instanceof ArrayBuffer)throw Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:null==e.modelTopology?0:so(JSON.stringify(e.modelTopology)),weightSpecsBytes:null==e.weightSpecs?0:so(JSON.stringify(e.weightSpecs)),weightDataBytes:null==e.weightData?0:new iJ(e.weightData).byteLength}}function sg(e){let t=[];for(let n of e)t.push(...n.weights);return t}function sm(){let e=e=>{let t=e<<13,n=0;for(;(8388608&t)==0;)n-=8388608,t<<=1;return(t&=-8388609)|(n+=0x38800000)},t=new Uint32Array(2048);t[0]=0;for(let n=1;n<1024;n++)t[n]=e(n);for(let e=1024;e<2048;e++)t[e]=0x38000000+(e-1024<<13);return t}function sy(){let e=new Uint32Array(64);e[0]=0,e[31]=0x47800000,e[32]=0x80000000,e[63]=0xc7800000;for(let t=1;t<31;t++)e[t]=t<<23;for(let t=33;t<63;t++)e[t]=0x80000000+(t-32<<23);return e}function sb(){let e=new Uint32Array(64);for(let t=0;t<64;t++)e[t]=1024;return e[0]=e[32]=0,e}function sv(){let e=sm(),t=sy(),n=sb();return r=>{let i=new ArrayBuffer(4*r.length),s=new Uint32Array(i);for(let i=0;i<r.length;i++){let a=r[i],o=e[n[a>>10]+(1023&a)]+t[a>>10];s[i]=o}return new Float32Array(i)}}class sw{constructor(){this.saveRouters=[],this.loadRouters=[]}static getInstance(){return null==sw.instance&&(sw.instance=new sw),sw.instance}static registerSaveRouter(e){sw.getInstance().saveRouters.push(e)}static registerLoadRouter(e){sw.getInstance().loadRouters.push(e)}static getSaveHandlers(e){return sw.getHandlers(e,"save")}static getLoadHandlers(e,t){return sw.getHandlers(e,"load",t)}static getHandlers(e,t,n){let r=[];return("load"===t?sw.getInstance().loadRouters:sw.getInstance().saveRouters).forEach(t=>{let i=t(e,n);null!==i&&r.push(i)}),r}}let s_=e=>sw.getSaveHandlers(e),sx="tensorflowjs",sT=1,sI="models_store",sk="model_info_store";function sS(){if(!eN().getBool("IS_BROWSER"))throw Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");let e="undefined"==typeof window?self:window,t=e.indexedDB||e.mozIndexedDB||e.webkitIndexedDB||e.msIndexedDB||e.shimIndexedDB;if(null==t)throw Error("The current browser does not appear to support IndexedDB.");return t}function sE(e){let t=e.result;t.createObjectStore(sI,{keyPath:"modelPath"}),t.createObjectStore(sk,{keyPath:"modelPath"})}class sC{constructor(e){if(this.indexedDB=sS(),null==e||!e)throw Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=e}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return this.databaseAction(this.modelPath,e)}async load(){return this.databaseAction(this.modelPath)}databaseAction(e,t){return new Promise((e,n)=>{let r=this.indexedDB.open(sx,sT);r.onupgradeneeded=()=>sE(r),r.onsuccess=()=>{let i=r.result;if(null==t){let t=i.transaction(sI,"readonly"),r=t.objectStore(sI).get(this.modelPath);r.onsuccess=()=>{if(null==r.result)return i.close(),n(Error(`Cannot find model with path '${this.modelPath}' in IndexedDB.`));e(r.result.modelArtifacts)},r.onerror=e=>(i.close(),n(r.error)),t.oncomplete=()=>i.close()}else{let r,s;t.weightData=iJ.join(t.weightData);let a=sf(t),o=i.transaction(sk,"readwrite"),l=o.objectStore(sk);try{r=l.put({modelPath:this.modelPath,modelArtifactsInfo:a})}catch(e){return n(e)}r.onsuccess=()=>{let r;let u=(s=i.transaction(sI,"readwrite")).objectStore(sI);try{r=u.put({modelPath:this.modelPath,modelArtifacts:t,modelArtifactsInfo:a})}catch(e){return n(e)}r.onsuccess=()=>e({modelArtifactsInfo:a}),r.onerror=e=>{let t=(l=o.objectStore(sk)).delete(this.modelPath);t.onsuccess=()=>(i.close(),n(r.error)),t.onerror=e=>(i.close(),n(r.error))}},r.onerror=e=>(i.close(),n(r.error)),o.oncomplete=()=>{null==s?i.close():s.oncomplete=()=>i.close()}}},r.onerror=e=>n(r.error)})}}sC.URL_SCHEME="indexeddb://";let sA=e=>eN().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(sC.URL_SCHEME)?sN(e.slice(sC.URL_SCHEME.length)):null;function sN(e){return new sC(e)}function sO(e){return e.startsWith(sC.URL_SCHEME)?e.slice(sC.URL_SCHEME.length):e}sw.registerSaveRouter(sA),sw.registerLoadRouter(sA);class s${constructor(){this.indexedDB=sS()}async listModels(){return new Promise((e,t)=>{let n=this.indexedDB.open(sx,sT);n.onupgradeneeded=()=>sE(n),n.onsuccess=()=>{let r=n.result,i=r.transaction(sk,"readonly"),s=i.objectStore(sk).getAll();s.onsuccess=()=>{let t={};for(let e of s.result)t[e.modelPath]=e.modelArtifactsInfo;e(t)},s.onerror=e=>(r.close(),t(s.error)),i.oncomplete=()=>r.close()},n.onerror=e=>t(n.error)})}async removeModel(e){return e=sO(e),new Promise((t,n)=>{let r=this.indexedDB.open(sx,sT);r.onupgradeneeded=()=>sE(r),r.onsuccess=()=>{let i;let s=r.result,a=s.transaction(sk,"readwrite"),o=a.objectStore(sk),l=o.get(e);l.onsuccess=()=>{if(null==l.result)return s.close(),n(Error(`Cannot find model with path '${e}' in IndexedDB.`));{let r=o.delete(e),a=()=>{let r=(i=s.transaction(sI,"readwrite")).objectStore(sI).delete(e);r.onsuccess=()=>t(l.result.modelArtifactsInfo),r.onerror=e=>n(l.error)};r.onsuccess=a,r.onerror=e=>(a(),s.close(),n(l.error))}},l.onerror=e=>(s.close(),n(l.error)),a.oncomplete=()=>{null==i?s.close():i.oncomplete=()=>s.close()}},r.onerror=e=>n(r.error)})}}let sR="/",sD="tensorflowjs_models",sF="info",sP="model_topology",sM="weight_specs",sL="weight_data",sz="model_metadata";function sB(e){return{info:[sD,e,sF].join(sR),topology:[sD,e,sP].join(sR),weightSpecs:[sD,e,sM].join(sR),weightData:[sD,e,sL].join(sR),modelMetadata:[sD,e,sz].join(sR)}}function sU(e){for(let t of Object.values(e))window.localStorage.removeItem(t)}function sV(e){let t=e.split(sR);if(t.length<3)throw Error(`Invalid key format: ${e}`);return t.slice(1,t.length-1).join(sR)}function sj(e){return e.startsWith(sG.URL_SCHEME)?e.slice(sG.URL_SCHEME.length):e}class sG{constructor(e){if(!eN().getBool("IS_BROWSER")||"undefined"==typeof window||void 0===window.localStorage)throw Error("The current environment does not support local storage.");if(this.LS=window.localStorage,null==e||!e)throw Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=e,this.keys=sB(this.modelPath)}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");{let t=JSON.stringify(e.modelTopology),n=JSON.stringify(e.weightSpecs),r=sf(e),i=iJ.join(e.weightData);try{this.LS.setItem(this.keys.info,JSON.stringify(r)),this.LS.setItem(this.keys.topology,t),this.LS.setItem(this.keys.weightSpecs,n),this.LS.setItem(this.keys.weightData,sl(i));let s={format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,signature:null!=e.signature?e.signature:void 0,userDefinedMetadata:null!=e.userDefinedMetadata?e.userDefinedMetadata:void 0,modelInitializer:null!=e.modelInitializer?e.modelInitializer:void 0,initializerSignature:null!=e.initializerSignature?e.initializerSignature:void 0,trainingConfig:null!=e.trainingConfig?e.trainingConfig:void 0};return this.LS.setItem(this.keys.modelMetadata,JSON.stringify(s)),{modelArtifactsInfo:r}}catch(e){throw sU(this.keys),Error(`Failed to save model '${this.modelPath}' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes=${r.modelTopologyBytes}, weightSpecsBytes=${r.weightSpecsBytes}, weightDataBytes=${r.weightDataBytes}.`)}}}async load(){let e=JSON.parse(this.LS.getItem(this.keys.info));if(null==e)throw Error(`In local storage, there is no model with name '${this.modelPath}'`);if("JSON"!==e.modelTopologyType)throw Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");let t={},n=JSON.parse(this.LS.getItem(this.keys.topology));if(null==n)throw Error(`In local storage, the topology of model '${this.modelPath}' is missing.`);t.modelTopology=n;let r=JSON.parse(this.LS.getItem(this.keys.weightSpecs));if(null==r)throw Error(`In local storage, the weight specs of model '${this.modelPath}' are missing.`);t.weightSpecs=r;let i=this.LS.getItem(this.keys.modelMetadata);if(null!=i){let e=JSON.parse(i);t.format=e.format,t.generatedBy=e.generatedBy,t.convertedBy=e.convertedBy,null!=e.signature&&(t.signature=e.signature),null!=e.userDefinedMetadata&&(t.userDefinedMetadata=e.userDefinedMetadata),null!=e.modelInitializer&&(t.modelInitializer=e.modelInitializer),null!=e.initializerSignature&&(t.initializerSignature=e.initializerSignature),null!=e.trainingConfig&&(t.trainingConfig=e.trainingConfig)}let s=this.LS.getItem(this.keys.weightData);if(null==s)throw Error(`In local storage, the binary weight values of model '${this.modelPath}' are missing.`);return t.weightData=su(s),t}}sG.URL_SCHEME="localstorage://";let sW=e=>eN().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(sG.URL_SCHEME)?sq(e.slice(sG.URL_SCHEME.length)):null;function sq(e){return new sG(e)}sw.registerSaveRouter(sW),sw.registerLoadRouter(sW);class sH{constructor(){j(eN().getBool("IS_BROWSER"),()=>"Current environment is not a web browser"),j("undefined"==typeof window||void 0!==window.localStorage,()=>"Current browser does not appear to support localStorage"),this.LS=window.localStorage}async listModels(){let e={},t=sD+sR,n=sR+sF;for(let r=0;r<this.LS.length;++r){let i=this.LS.key(r);i.startsWith(t)&&i.endsWith(n)&&(e[sV(i)]=JSON.parse(this.LS.getItem(i)))}return e}async removeModel(e){let t=sB(e=sj(e));if(null==this.LS.getItem(t.info))throw Error(`Cannot find model at path '${e}'`);let n=JSON.parse(this.LS.getItem(t.info));return sU(t),n}}let sK="://";class sX{constructor(){this.managers={}}static getInstance(){return null==sX.instance&&(sX.instance=new sX),sX.instance}static registerManager(e,t){j(null!=e,()=>"scheme must not be undefined or null."),e.endsWith(sK)&&(e=e.slice(0,e.indexOf(sK))),j(e.length>0,()=>"scheme must not be an empty string.");let n=sX.getInstance();j(null==n.managers[e],()=>`A model store manager is already registered for scheme '${e}'.`),n.managers[e]=t}static getManager(e){let t=sX.getInstance().managers[e];if(null==t)throw Error(`Cannot find model manager for scheme '${e}'`);return t}static getSchemes(){return Object.keys(sX.getInstance().managers)}}class sY{constructor(){this.messageName="setTimeoutCustom",this.functionRefs=[],this.handledMessageCount=0,this.hasEventListener=!1}fetch(e,t){return fetch(e,t)}now(){return performance.now()}encode(e,t){if("utf-8"!==t&&"utf8"!==t)throw Error(`Browser's encoder only supports utf-8, but got ${t}`);return null==this.textEncoder&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(e)}decode(e,t){return new TextDecoder(t).decode(e)}setTimeoutCustom(e,t){if("undefined"==typeof window||!eN().getBool("USE_SETTIMEOUTCUSTOM")){setTimeout(e,t);return}this.functionRefs.push(e),setTimeout(()=>{window.postMessage({name:this.messageName,index:this.functionRefs.length-1},"*")},t),this.hasEventListener||(this.hasEventListener=!0,window.addEventListener("message",e=>{e.source===window&&e.data.name===this.messageName&&(e.stopPropagation(),(0,this.functionRefs[e.data.index])(),this.handledMessageCount++,this.handledMessageCount===this.functionRefs.length&&(this.functionRefs=[],this.handledMessageCount=0))},!0))}isTypedArray(e){return rN(e)}}if(eN().get("IS_BROWSER")){eN().setPlatform("browser",new sY);try{sX.registerManager(sG.URL_SCHEME,new sH)}catch(e){}try{sX.registerManager(sC.URL_SCHEME,new s$)}catch(e){}}var sQ=n(7836);let sJ={importFetch:()=>n(7078)};class sZ{constructor(){this.util=n(6905),this.textEncoder=new this.util.TextEncoder}fetch(e,t){return null!=eN().global.fetch?eN().global.fetch(e,t):(null==s&&(s=sJ.importFetch()),s(e,t))}now(){let e=sQ.hrtime();return 1e3*e[0]+e[1]/1e6}encode(e,t){if("utf-8"!==t&&"utf8"!==t)throw Error(`Node built-in encoder only supports utf-8, but got ${t}`);return this.textEncoder.encode(e)}decode(e,t){return 0===e.length?"":new this.util.TextDecoder(t).decode(e)}isTypedArray(e){return this.util.types.isFloat32Array(e)||this.util.types.isInt32Array(e)||this.util.types.isUint8Array(e)||this.util.types.isUint8ClampedArray(e)}}function s0(e,t="float32",n){return t=t||"float32",e_(e),new il(e,t,n)}eN().get("IS_NODE")&&!eN().get("IS_BROWSER")&&eN().setPlatform("node",new sZ);let s1=iH({cast_:function(e,t){let n=iG(e,"x","cast");if(!ei(t))throw Error(`Failed to cast to unknown dtype ${t}`);if("string"===t&&"string"!==n.dtype||"string"!==t&&"string"===n.dtype)throw Error("Only strings can be casted to strings");let r={x:n},i={dtype:t};return iD.runKernel(e8,r,i)}}),s2=iH({clone_:function(e){let t={x:iG(e,"x","clone","string_or_numeric")};return iD.runKernel(tj,t)}});function s3(e,t=!1){console.log(e.toString(t))}iR(),ip({buffer:s0,cast:s1,clone:s2,print:s3});let s4=iH({add_:function(e,t){let n=iG(e,"a","add"),r=iG(t,"b","add");[n,r]=iI(n,r);let i={a:n,b:r};return iD.runKernel(eB,i)}}),s6=iH({floorDiv_:function(e,t){let n=iG(e,"a","floorDiv"),r=iG(t,"b","floorDiv");[n,r]=iI(n,r);let i={a:n,b:r};return iD.runKernel(tM,i)}}),s5=iH({div_:function(e,t){let n=iG(e,"a","div"),r=iG(t,"b","div");if([n,r]=iI(n,r),"int32"===n.dtype&&"int32"===r.dtype)return s6(n,r);let i={a:n,b:r},s={};return iD.runKernel(tI,i,s)}}),s8=iH({mul_:function(e,t){let n=iG(e,"a","mul"),r=iG(t,"b","mul");[n,r]=iI(n,r);let i={a:n,b:r};return iD.runKernel(nc,i)}}),s7=iH({sqrt_:function(e){let t={x:iG(e,"x","sqrt","float32")};return iD.runKernel(nY,t)}}),s9=iH({square_:function(e){let t=iG(e,"x","square"),n={};return iD.runKernel("Square",{x:t},n)}}),ae=iH({zerosLike_:function(e){let t={x:iG(e,"x","zerosLike")};return iD.runKernel(rp,t)}});function at(e,t){j(ed(e),()=>"The f passed in variableGrads(f) must be a function"),j(null==t||Array.isArray(t)&&t.every(e=>e instanceof ib),()=>"The varList passed in variableGrads(f, varList) must be an array of variables");let n=null!=t;if(!n)for(let e in t=[],iD.registeredVariables)t.push(iD.registeredVariables[e]);let r=n?t.filter(e=>!e.trainable):null,i=t.length;j((t=t.filter(e=>e.trainable)).length>0,()=>`variableGrads() expects at least one of the input variables to be trainable, but none of the ${i} variables is trainable.`);let s=!0,{value:a,grads:o}=iD.gradients(e,t,null,s);j(o.some(e=>null!=e),()=>"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."),j(0===a.rank,()=>`The f passed in variableGrads(f) must return a scalar, but it returned a rank-${a.rank} tensor`);let l={};return t.forEach((e,t)=>{null!=o[t]&&(l[e.name]=o[t])}),null!=r&&r.forEach(e=>l[e.name]=null),{value:a,grads:l}}function an(e){return iD.customGrad(e)}function ar(e,t){if((r1(e)&&"string"!==t||Array.isArray(e))&&"complex64"!==t)throw Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if("string"===t&&r1(e)&&!(e instanceof Uint8Array))throw Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return iX(e,[],[],t)}let ai=new Map,as=new Map;class aa{getClassName(){return this.constructor.className}static fromConfig(e,t){return new e(t)}}class ao{constructor(){this.classNameMap={}}static getMap(){return null==ao.instance&&(ao.instance=new ao),ao.instance}static register(e){ao.getMap().classNameMap[e.className]=[e,e.fromConfig]}}function al(e,t,n){j(null!=e.className,()=>"Class being registered does not have the static className property defined."),j("string"==typeof e.className,()=>"className is required to be a string, but got type "+typeof e.className),j(e.className.length>0,()=>"Class being registered has an empty-string as its className, which is disallowed."),void 0===t&&(t="Custom"),void 0===n&&(n=e.className);let r=t+">"+n;return ao.register(e),ai.set(r,e),as.set(e,r),e}class au extends aa{minimize(e,t=!1,n){let{value:r,grads:i}=this.computeGradients(e,n);if(null!=n){let e=n.map(e=>({name:e.name,tensor:i[e.name]}));this.applyGradients(e)}else this.applyGradients(i);return(i3(i),t)?r:(r.dispose(),null)}get iterations(){return null==this.iterations_&&(this.iterations_=0),this.iterations_}incrementIterations(){this.iterations_=this.iterations+1}computeGradients(e,t){return at(e,t)}dispose(){null!=this.iterations_&&i3(this.iterations_)}async saveIterations(){return null==this.iterations_&&(this.iterations_=0),{name:"iter",tensor:ar(this.iterations_,"int32")}}async getWeights(){throw Error("getWeights() is not implemented for this optimizer yet.")}async setWeights(e){throw Error(`setWeights() is not implemented for this optimizer class ${this.getClassName()}`)}async extractIterations(e){return this.iterations_=(await e[0].tensor.data())[0],e.slice(1)}}Object.defineProperty(au,Symbol.hasInstance,{value:e=>null!=e.minimize&&null!=e.computeGradients&&null!=e.applyGradients});class ac extends au{static get className(){return"Adadelta"}constructor(e,t,n=null){super(),this.learningRate=e,this.rho=t,this.epsilon=n,this.accumulatedGrads=[],this.accumulatedUpdates=[],null==n&&(this.epsilon=iD.backend.epsilon())}applyGradients(e){(Array.isArray(e)?e.map(e=>e.name):Object.keys(e)).forEach((t,n)=>{let r=iD.registeredVariables[t],i=!1;null==this.accumulatedGrads[n]&&(this.accumulatedGrads[n]={originalName:`${t}/accum_grad`,variable:i2(()=>ae(r).variable(i))}),null==this.accumulatedUpdates[n]&&(this.accumulatedUpdates[n]={originalName:`${t}/accum_var`,variable:i2(()=>ae(r).variable(i))});let s=Array.isArray(e)?e[n].tensor:e[t];if(null==s)return;let a=this.accumulatedGrads[n].variable,o=this.accumulatedUpdates[n].variable;i2(()=>{let e=s4(s8(a,this.rho),s8(s9(s),1-this.rho)),t=s8(s5(s7(s4(o,this.epsilon)),s7(s4(a,this.epsilon))),s),n=s4(s8(o,this.rho),s8(s9(t),1-this.rho));a.assign(e),o.assign(n);let i=s4(s8(t,-this.learningRate),r);r.assign(i)})}),this.incrementIterations()}dispose(){null!=this.accumulatedUpdates&&(i3(this.accumulatedGrads.map(e=>e.variable)),i3(this.accumulatedUpdates.map(e=>e.variable)))}async getWeights(){let e=[...this.accumulatedGrads,...this.accumulatedUpdates];return[await this.saveIterations()].concat(e.map(e=>({name:e.originalName,tensor:e.variable})))}async setWeights(e){let t=(e=await this.extractIterations(e)).length/2,n=!1;this.accumulatedGrads=e.slice(0,t).map(e=>({originalName:e.name,variable:e.tensor.variable(n)})),this.accumulatedUpdates=e.slice(t,2*t).map(e=>({originalName:e.name,variable:e.tensor.variable(n)}))}getConfig(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}}static fromConfig(e,t){return new e(t.learningRate,t.rho,t.epsilon)}}function ah(e,t,n){e_(e),n=n||eh(t);let r={shape:e,value:t,dtype:n};return iD.runKernel(tD,{},r)}class ad extends au{static get className(){return"Adagrad"}constructor(e,t=.1){super(),this.learningRate=e,this.initialAccumulatorValue=t,this.accumulatedGrads=[]}applyGradients(e){(Array.isArray(e)?e.map(e=>e.name):Object.keys(e)).forEach((t,n)=>{let r=iD.registeredVariables[t];if(null==this.accumulatedGrads[n]){let e=!1;this.accumulatedGrads[n]={originalName:`${t}/accumulator`,variable:i2(()=>ah(r.shape,this.initialAccumulatorValue).variable(e))}}let i=Array.isArray(e)?e[n].tensor:e[t];if(null==i)return;let s=this.accumulatedGrads[n].variable;i2(()=>{let e=s4(s,s9(i));s.assign(e);let t=s4(s8(s5(i,s7(s4(e,iD.backend.epsilon()))),-this.learningRate),r);r.assign(t)})}),this.incrementIterations()}dispose(){null!=this.accumulatedGrads&&i3(this.accumulatedGrads.map(e=>e.variable))}async getWeights(){return[await this.saveIterations()].concat(this.accumulatedGrads.map(e=>({name:e.originalName,tensor:e.variable})))}async setWeights(e){e=await this.extractIterations(e);let t=!1;this.accumulatedGrads=e.map(e=>({originalName:e.name,variable:e.tensor.variable(t)}))}getConfig(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}}static fromConfig(e,t){return new e(t.learningRate,t.initialAccumulatorValue)}}let ap=iH({pow_:function(e,t){let n=iG(e,"base","pow"),r=iG(t,"exp","pow");[n,r]=iI(n,r);let i={a:n,b:r};return iD.runKernel(nw,i)}}),af=iH({sub_:function(e,t){let n=iG(e,"a","sub"),r=iG(t,"b","sub");[n,r]=iI(n,r);let i={a:n,b:r};return iD.runKernel(rr,i)}});class ag extends au{static get className(){return"Adam"}constructor(e,t,n,r=null){super(),this.learningRate=e,this.beta1=t,this.beta2=n,this.epsilon=r,this.accumulatedFirstMoment=[],this.accumulatedSecondMoment=[],i2(()=>{this.accBeta1=ar(t).variable(),this.accBeta2=ar(n).variable()}),null==r&&(this.epsilon=iD.backend.epsilon())}applyGradients(e){let t=Array.isArray(e)?e.map(e=>e.name):Object.keys(e);i2(()=>{let n=af(1,this.accBeta1),r=af(1,this.accBeta2);t.forEach((t,i)=>{let s=iD.registeredVariables[t],a=!1;null==this.accumulatedFirstMoment[i]&&(this.accumulatedFirstMoment[i]={originalName:`${t}/m`,variable:i2(()=>ae(s).variable(a))}),null==this.accumulatedSecondMoment[i]&&(this.accumulatedSecondMoment[i]={originalName:`${t}/v`,variable:i2(()=>ae(s).variable(a))});let o=Array.isArray(e)?e[i].tensor:e[t];if(null==o)return;let l=this.accumulatedFirstMoment[i].variable,u=this.accumulatedSecondMoment[i].variable,c=s4(s8(l,this.beta1),s8(o,1-this.beta1)),h=s4(s8(u,this.beta2),s8(s9(o),1-this.beta2)),d=s5(c,n),p=s5(h,r);l.assign(c),u.assign(h);let f=s4(s8(s5(d,s4(s7(p),this.epsilon)),-this.learningRate),s);s.assign(f)}),this.accBeta1.assign(s8(this.accBeta1,this.beta1)),this.accBeta2.assign(s8(this.accBeta2,this.beta2))}),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.accBeta2.dispose(),null!=this.accumulatedFirstMoment&&i3(this.accumulatedFirstMoment.map(e=>e.variable)),null!=this.accumulatedSecondMoment&&i3(this.accumulatedSecondMoment.map(e=>e.variable))}async getWeights(){let e=[...this.accumulatedFirstMoment,...this.accumulatedSecondMoment];return[await this.saveIterations()].concat(e.map(e=>({name:e.originalName,tensor:e.variable})))}async setWeights(e){e=await this.extractIterations(e),i2(()=>{this.accBeta1.assign(ap(this.beta1,this.iterations_+1)),this.accBeta2.assign(ap(this.beta2,this.iterations_+1))});let t=e.length/2,n=!1;this.accumulatedFirstMoment=e.slice(0,t).map(e=>({originalName:e.name,variable:e.tensor.variable(n)})),this.accumulatedSecondMoment=e.slice(t,2*t).map(e=>({originalName:e.name,variable:e.tensor.variable(n)}))}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}}static fromConfig(e,t){return new e(t.learningRate,t.beta1,t.beta2,t.epsilon)}}let am=iH({abs_:function(e){let t=iG(e,"x","abs");if("complex64"===t.dtype){let e={x:t};return iD.runKernel(tt,e)}{let e={x:t};return iD.runKernel(eM,e)}}});function ay(e,t){let n=e.length,r=[];for(let i=0;i<n;i++){let s=n-1-i,a=e[s]||1;(t[t.length-1-i]||1)>1&&1===a&&r.unshift(s)}return r}function ab(e,t){let n=[];for(let r=0;r<t.length;r++){let i=e[e.length-r-1],s=t.length-r-1,a=t[s];(null==i||1===i&&a>1)&&n.unshift(s)}return n}function av(e,t){let n=Math.max(e.length,t.length),r=Array(n);for(let i=0;i<n;i++){let s=e[e.length-i-1];null==s&&(s=1);let a=t[t.length-i-1];if(null==a&&(a=1),1===s)r[n-i-1]=a;else if(1===a)r[n-i-1]=s;else if(s!==a)throw Error(`Operands could not be broadcast together with shapes ${e} and ${t}.`);else r[n-i-1]=s}return r}let aw=iH({maximum_:function(e,t){let n=iG(e,"a","maximum"),r=iG(t,"b","maximum");[n,r]=iI(n,r),"bool"===n.dtype&&(n=s1(n,"int32"),r=s1(r,"int32")),av(n.shape,r.shape);let i={a:n,b:r};return iD.runKernel(t7,i)}});class a_ extends au{static get className(){return"Adamax"}constructor(e,t,n,r=null,i=0){super(),this.learningRate=e,this.beta1=t,this.beta2=n,this.epsilon=r,this.decay=i,this.accumulatedFirstMoment=[],this.accumulatedWeightedInfNorm=[],i2(()=>{this.iteration=ar(0).variable(),this.accBeta1=ar(t).variable()}),null==r&&(this.epsilon=iD.backend.epsilon())}applyGradients(e){let t=Array.isArray(e)?e.map(e=>e.name):Object.keys(e);i2(()=>{let n=af(1,this.accBeta1),r=s5(-this.learningRate,s4(s8(this.iteration,this.decay),1));t.forEach((t,i)=>{let s=iD.registeredVariables[t],a=!1;null==this.accumulatedFirstMoment[i]&&(this.accumulatedFirstMoment[i]={originalName:`${t}/m`,variable:ae(s).variable(a)}),null==this.accumulatedWeightedInfNorm[i]&&(this.accumulatedWeightedInfNorm[i]={originalName:`${t}/v`,variable:ae(s).variable(a)});let o=Array.isArray(e)?e[i].tensor:e[t];if(null==o)return;let l=this.accumulatedFirstMoment[i].variable,u=this.accumulatedWeightedInfNorm[i].variable,c=s4(s8(l,this.beta1),s8(o,1-this.beta1)),h=aw(s8(u,this.beta2),am(o));l.assign(c),u.assign(h);let d=s4(s8(s5(r,n),s5(c,s4(h,this.epsilon))),s);s.assign(d)}),this.iteration.assign(s4(this.iteration,1)),this.accBeta1.assign(s8(this.accBeta1,this.beta1))}),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.iteration.dispose(),null!=this.accumulatedFirstMoment&&i3(this.accumulatedFirstMoment.map(e=>e.variable)),null!=this.accumulatedWeightedInfNorm&&i3(this.accumulatedWeightedInfNorm.map(e=>e.variable))}async getWeights(){throw Error("getWeights() is not implemented for Adamax yet.")}async setWeights(e){throw Error("setWeights() is not implemented for Adamax yet.")}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}}static fromConfig(e,t){return new e(t.learningRate,t.beta1,t.beta2,t.epsilon,t.decay)}}class ax extends au{static get className(){return"SGD"}constructor(e){super(),this.learningRate=e,this.setLearningRate(e)}applyGradients(e){(Array.isArray(e)?e.map(e=>e.name):Object.keys(e)).forEach((t,n)=>{let r=Array.isArray(e)?e[n].tensor:e[t];if(null==r)return;let i=iD.registeredVariables[t];i2(()=>{let e=s4(s8(this.c,r),i);i.assign(e)})}),this.incrementIterations()}setLearningRate(e){this.learningRate=e,null!=this.c&&this.c.dispose(),this.c=i4(ar(-e))}dispose(){this.c.dispose()}async getWeights(){return[await this.saveIterations()]}async setWeights(e){if(0!==(e=await this.extractIterations(e)).length)throw Error("SGD optimizer does not have settable weights.")}getConfig(){return{learningRate:this.learningRate}}static fromConfig(e,t){return new e(t.learningRate)}}class aT extends ax{static get className(){return"Momentum"}constructor(e,t,n=!1){super(e),this.learningRate=e,this.momentum=t,this.useNesterov=n,this.accumulations=[],this.m=ar(this.momentum)}applyGradients(e){(Array.isArray(e)?e.map(e=>e.name):Object.keys(e)).forEach((t,n)=>{let r=iD.registeredVariables[t];if(null==this.accumulations[n]){let e=!1;this.accumulations[n]={originalName:`${t}/momentum`,variable:i2(()=>ae(r).variable(e))}}let i=this.accumulations[n].variable,s=Array.isArray(e)?e[n].tensor:e[t];null!=s&&i2(()=>{let e;let t=s4(s8(this.m,i),s);e=this.useNesterov?s4(s8(this.c,s4(s,s8(t,this.m))),r):s4(s8(this.c,t),r),i.assign(t),r.assign(e)})}),this.incrementIterations()}dispose(){this.m.dispose(),null!=this.accumulations&&i3(this.accumulations.map(e=>e.variable))}setMomentum(e){this.momentum=e}async getWeights(){return[await this.saveIterations()].concat(this.accumulations.map(e=>({name:e.originalName,tensor:e.variable})))}async setWeights(e){e=await this.extractIterations(e);let t=!1;this.accumulations=e.map(e=>({originalName:e.name,variable:e.tensor.variable(t)}))}getConfig(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}}static fromConfig(e,t){return new e(t.learningRate,t.momentum,t.useNesterov)}}class aI extends au{static get className(){return"RMSProp"}constructor(e,t=.9,n=0,r=null,i=!1){if(super(),this.learningRate=e,this.decay=t,this.momentum=n,this.epsilon=r,this.accumulatedMeanSquares=[],this.accumulatedMoments=[],this.accumulatedMeanGrads=[],this.centered=i,null==r&&(this.epsilon=iD.backend.epsilon()),null==e)throw Error("learningRate for RMSPropOptimizer must be defined.")}applyGradients(e){(Array.isArray(e)?e.map(e=>e.name):Object.keys(e)).forEach((t,n)=>{let r=iD.registeredVariables[t],i=!1;null==this.accumulatedMeanSquares[n]&&(this.accumulatedMeanSquares[n]={originalName:`${t}/rms`,variable:i2(()=>ae(r).variable(i))}),null==this.accumulatedMoments[n]&&(this.accumulatedMoments[n]={originalName:`${t}/momentum`,variable:i2(()=>ae(r).variable(i))}),null==this.accumulatedMeanGrads[n]&&this.centered&&(this.accumulatedMeanGrads[n]={originalName:`${t}/mg`,variable:i2(()=>ae(r).variable(i))});let s=Array.isArray(e)?e[n].tensor:e[t];if(null==s)return;let a=this.accumulatedMeanSquares[n].variable,o=this.accumulatedMoments[n].variable;i2(()=>{let e=s4(s8(a,this.decay),s8(s9(s),1-this.decay));if(this.centered){let t=this.accumulatedMeanGrads[n].variable,i=s4(s8(t,this.decay),s8(s,1-this.decay)),l=s5(s8(s,this.learningRate),s7(af(e,s4(s9(i),this.epsilon)))),u=s4(s8(o,this.momentum),l);a.assign(e),t.assign(i),o.assign(u);let c=af(r,u);r.assign(c)}else{let e=s4(s8(a,this.decay),s8(s9(s),1-this.decay)),t=s4(s8(o,this.momentum),s5(s8(s,this.learningRate),s7(s4(e,this.epsilon))));a.assign(e),o.assign(t);let n=af(r,t);r.assign(n)}})}),this.incrementIterations()}dispose(){null!=this.accumulatedMeanSquares&&i3(this.accumulatedMeanSquares.map(e=>e.variable)),null!=this.accumulatedMeanGrads&&this.centered&&i3(this.accumulatedMeanGrads.map(e=>e.variable)),null!=this.accumulatedMoments&&i3(this.accumulatedMoments.map(e=>e.variable))}async getWeights(){let e=[...this.accumulatedMeanSquares,...this.accumulatedMoments];return this.centered&&e.push(...this.accumulatedMeanGrads),[await this.saveIterations()].concat(e.map(e=>({name:e.originalName,tensor:e.variable})))}async setWeights(e){e=await this.extractIterations(e);let t=this.centered?e.length/3:e.length/2,n=!1;this.accumulatedMeanSquares=e.slice(0,t).map(e=>({originalName:e.name,variable:e.tensor.variable(n)})),this.accumulatedMoments=e.slice(t,2*t).map(e=>({originalName:e.name,variable:e.tensor.variable(n)})),this.centered&&(this.accumulatedMeanGrads=e.slice(2*t,3*t).map(e=>({originalName:e.name,variable:e.tensor.variable(n)})))}getConfig(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}}static fromConfig(e,t){return new e(t.learningRate,t.decay,t.momentum,t.epsilon,t.centered)}}let ak=[ac,ad,ag,a_,aT,aI,ax];function aS(){for(let e of ak)al(e)}let aE="model",aC=".json",aA=".weights.bin";function aN(e){return new Promise(e=>setTimeout(e)).then(e)}class aO{constructor(e){if(!eN().getBool("IS_BROWSER"))throw Error("browserDownloads() cannot proceed because the current environment is not a browser.");e.startsWith(aO.URL_SCHEME)&&(e=e.slice(aO.URL_SCHEME.length)),(null==e||0===e.length)&&(e=aE),this.modelJsonFileName=e+aC,this.weightDataFileName=e+aA}async save(e){if("undefined"==typeof document)throw Error("Browser downloads are not supported in this environment since `document` is not present");let t=iJ.join(e.weightData),n=window.URL.createObjectURL(new Blob([t],{type:"application/octet-stream"}));if(e.modelTopology instanceof ArrayBuffer)throw Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");{let t=[{paths:["./"+this.weightDataFileName],weights:e.weightSpecs}],r=sh(e,t),i=window.URL.createObjectURL(new Blob([JSON.stringify(r)],{type:"application/json"})),s=null==this.modelJsonAnchor?document.createElement("a"):this.modelJsonAnchor;if(s.download=this.modelJsonFileName,s.href=i,await aN(()=>s.dispatchEvent(new MouseEvent("click"))),null!=e.weightData){let e=null==this.weightDataAnchor?document.createElement("a"):this.weightDataAnchor;e.download=this.weightDataFileName,e.href=n,await aN(()=>e.dispatchEvent(new MouseEvent("click")))}return{modelArtifactsInfo:sf(e)}}}}aO.URL_SCHEME="downloads://";let a$=e=>eN().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(aO.URL_SCHEME)?aR(e.slice(aO.URL_SCHEME.length)):null;function aR(e="model"){return new aO(e)}function aD(e,t,n,r){a(e),o(n=null==n?0:n,r=null==r?1:r);let i=0,s=s=>(s.then(s=>(t(n+ ++i/e.length*(r-n)),s)),s);function a(e){j(null!=e&&Array.isArray(e)&&e.length>0,()=>"promises must be a none empty array")}function o(e,t){j(e>=0&&e<=1,()=>`Progress fraction must be in range [0, 1], but got startFraction ${e}`),j(t>=0&&t<=1,()=>`Progress fraction must be in range [0, 1], but got endFraction ${t}`),j(t>=e,()=>`startFraction must be no more than endFraction, but got startFraction ${e} and endFraction ${t}`)}return Promise.all(e.map(s))}async function aF(e,t){null==t&&(t={});let n=null==t.fetchFunc?eN().platform.fetch:t.fetchFunc,r=e.map(e=>n(e,t.requestInit,{isBinary:!0})),i=0,s=.5,a=(null==t.onProgress?await Promise.all(r):await aD(r,t.onProgress,i,s)).map(e=>e.arrayBuffer()),o=.5,l=1;return null==t.onProgress?await Promise.all(a):await aD(a,t.onProgress,o,l)}function aP(e,t){var n;let r;let i=null==t.fetchFunc?eN().platform.fetch:t.fetchFunc,s=0;return null===(n=t.onProgress)||void 0===n||n.call(t,0),new ReadableStream({pull:async n=>{for(var a;s<e.length;){r||(r=(await i(e[s],t.requestInit,{isBinary:!0})).body.getReader());let{done:o,value:l}=await r.read();if(o){s++,r=void 0,null===(a=t.onProgress)||void 0===a||a.call(t,s/e.length);continue}n.enqueue(l);return}n.close()}})}sw.registerSaveRouter(a$);let aM="application/octet-stream",aL="application/json";class az{constructor(e,t){if(this.DEFAULT_METHOD="POST",null==t&&(t={}),this.weightPathPrefix=t.weightPathPrefix,this.weightUrlConverter=t.weightUrlConverter,null!=t.fetchFunc?(j("function"==typeof t.fetchFunc,()=>"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"),this.fetch=t.fetchFunc):this.fetch=eN().platform.fetch,j(null!=e&&e.length>0,()=>"URL path for http must not be null, undefined or empty."),Array.isArray(e)&&j(2===e.length,()=>`URL paths for http must have a length of 2, (actual length is ${e.length}).`),this.path=e,null!=t.requestInit&&null!=t.requestInit.body)throw Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=t.requestInit||{},this.loadOptions=t}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");let t=Object.assign({method:this.DEFAULT_METHOD},this.requestInit);t.body=new FormData;let n=[{paths:["./model.weights.bin"],weights:e.weightSpecs}],r=sh(e,n);if(t.body.append("model.json",new Blob([JSON.stringify(r)],{type:aL}),"model.json"),null!=e.weightData){let n=iJ.join(e.weightData);t.body.append("model.weights.bin",new Blob([n],{type:aM}),"model.weights.bin")}let i=await this.fetch(this.path,t);if(i.ok)return{modelArtifactsInfo:sf(e),responses:[i]};throw Error(`BrowserHTTPRequest.save() failed due to HTTP response status ${i.status}.`)}async loadModelJSON(){let e;let t=await this.fetch(this.path,this.requestInit);if(!t.ok)throw Error(`Request to ${this.path} failed with status code ${t.status}. Please verify this URL points to the model JSON of the model to load.`);try{e=await t.json()}catch(t){let e=`Failed to parse model JSON of response from ${this.path}.`;throw this.path.endsWith(".pb")?e+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":e+=" Please make sure the server is serving valid JSON for this request.",Error(e)}let n=e.modelTopology,r=e.weightsManifest;if(null==n&&null==r)throw Error(`The JSON from HTTP path ${this.path} contains neither model topology or manifest for weights.`);return e}async load(){return this.loadOptions.streamWeights?this.loadStream():sp(await this.loadModelJSON(),e=>this.loadWeights(e))}async loadStream(){let e=await this.loadModelJSON(),t=await this.getWeightUrls(e.weightsManifest),n=sg(e.weightsManifest),r=()=>aP(t,this.loadOptions);return Object.assign(Object.assign({},e),{weightSpecs:n,getWeightStream:r})}async getWeightUrls(e){let[t,n]=aB(Array.isArray(this.path)?this.path[1]:this.path),r=this.weightPathPrefix||t,i=[],s=[];for(let t of e)for(let e of t.paths)null!=this.weightUrlConverter?s.push(this.weightUrlConverter(e)):i.push(r+e+n);return this.weightUrlConverter&&i.push(...await Promise.all(s)),i}async loadWeights(e){let t=await this.getWeightUrls(e);return[sg(e),await aF(t,this.loadOptions)]}}function aB(e){let t=e.lastIndexOf("/"),n=e.lastIndexOf("?");return[e.substring(0,t)+"/",n>t?e.substring(n):""]}function aU(e){return null!=e.match(az.URL_SCHEME_REGEX)}az.URL_SCHEME_REGEX=/^https?:\/\//;let aV=(e,t)=>{if("undefined"==typeof fetch&&(null==t||null==t.fetchFunc));else{let n=!0;if(n=Array.isArray(e)?e.every(e=>aU(e)):aU(e))return aj(e,t)}return null};function aj(e,t){return new az(e,t)}sw.registerSaveRouter(aV),sw.registerLoadRouter(aV);let aG=-2,aW=-1;function aq(e,t,n){let r=e.shape.length;j(r===t.length,()=>`Error in slice${r}D: Length of begin ${t} must match the rank of the array (${r}).`),j(r===n.length,()=>`Error in slice${r}D: Length of size ${n} must match the rank of the array (${r}).`);for(let i=0;i<r;++i)j(t[i]+n[i]<=e.shape[i],()=>`Error in slice${r}D: begin[${i}] + size[${i}] (${t[i]+n[i]}) would overflow input.shape[${i}] (${e.shape[i]})`)}function aH(e){let t=[],n=0;for(;e>0;)1&e&&t.push(n),e/=2,n++;return t}function aK(e,t,n){let r=[];for(let i=0;i<e.length;i++)r[i]=Math.ceil((t[i]-e[i])/n[i]);return r}function aX(e,t,n,r){let i=[...e];for(let e=i.length;e<r.length;e++)i.push(1);for(let e=0;e<n;e++)0===e?i[t]=1:(i.splice(t,0,1),i.pop());return i}function aY(e,t,n){return n<=e?n:n-(t-1)}function aQ(e,t){let n=[];for(let r=0;r<e;r++)n.push(t+r);return n}function aJ(e,t,n,r,i,s,a,o,l){let u=e.length,c=Array(u),h=Array(u),d=Array(u);if(t.length&&n>0){let l=t[0],u=n+1;c=aZ(a,l,u,r,e),h=a0(o,l,u,i,e),d=aX(s,l,u,e)}else for(let t=0;t<u;t++)c[t]=a2(a,r,s,e,t,l),h[t]=a3(o,i,s,e,t,l),d[t]=a1(s,t,l);return{begin:c,end:h,strides:d}}function aZ(e,t,n,r,i){let s=[...i],a=aQ(n,t);for(let i=0;i<s.length;i++)if(a.indexOf(i)>-1)s[i]=0;else{let a=aY(t,n,i),o=r[a];e&1<<a&&(o=0),s[i]=o}return s}function a0(e,t,n,r,i){let s=[...i],a=aQ(n,t);for(let i=0;i<s.length;i++)if(a.indexOf(i)>-1)s[i]=Number.MAX_SAFE_INTEGER;else{let a=aY(t,n,i),o=r[a];e&1<<a&&(o=Number.MAX_SAFE_INTEGER),s[i]=o}for(let e=0;e<s.length;e++){let t=i[e];s[e]<0&&(s[e]+=t),s[e]=z(0,s[e],i[e])}return s}function a1(e,t,n){let r=e[t];return(n&1<<t||null==r)&&(r=1),r}function a2(e,t,n,r,i,s){let a=t[i],o=n[i]||1;(e&1<<i||s&1<<i||null==a)&&(a=o>0?Number.MIN_SAFE_INTEGER:Number.MAX_SAFE_INTEGER);let l=r[i];return a<0&&(a+=l),a=z(0,a,l-1)}function a3(e,t,n,r,i,s){let a=t[i],o=n[i]||1;(e&1<<i||s&1<<i||null==a)&&(a=o>0?Number.MAX_SAFE_INTEGER:Number.MIN_SAFE_INTEGER);let l=r[i];return a<0&&(a+=l),a=o>0?z(0,a,l):z(-1,a,l-1)}function a4(e,t,n){let r=n.length;for(let e=0;e<n.length;e++)if(n[e]>1){r=e;break}for(let i=r+1;i<n.length;i++)if(t[i]>0||n[i]!==e[i])return!1;return!0}function a6(e,t){let n=e.length>0?e[e.length-1]:1;for(let r=0;r<e.length-1;r++)n+=e[r]*t[r];return n}function a5(e,t,n){let r,i;let s=e.shape.length;return(r="number"==typeof t?[t,...Array(s-1).fill(0)]:t.length<s?t.concat(Array(s-t.length).fill(0)):t.slice()).forEach(e=>{j(-1!==e,()=>"slice() does not support negative begin indexing.")}),i=(i=null==n?Array(s).fill(-1):"number"==typeof n?[n,...Array(s-1).fill(-1)]:n.length<s?n.concat(Array(s-n.length).fill(-1)):n).map((t,n)=>t>=0?t:(j(-1===t,()=>`Negative size values should be exactly -1 but got ${t} for the slice() size at index ${n}.`),e.shape[n]-r[n])),[r,i]}function a8(e,t,n,r,i,s,a,o,l){let u;if(null==r?(u=Array(t.length)).fill(1):u=r,null!=a&&(a&a-1)!=0)throw Error("Multiple ellipses in slice is not allowed.");let c=!1,h={dims:u.length,numAddAxisAfterEllipsis:0,begin:t.slice(),end:n.slice(),strides:u.slice(),beginMask:i,endMask:s,ellipsisMask:a,newAxisMask:o,shrinkAxisMask:l};for(let e=0;e<h.dims;e++)c&&(1<<e&o)!=0&&h.numAddAxisAfterEllipsis++,1<<e&a&&(c=!0);!c&&(h.ellipsisMask|=1<<h.dims,h.dims++);let d={dims:e.length,beginMask:0,endMask:0,beginValid:!1,endValid:!1};a7(h,d);let p=!0,f=!0,g=!0,m=[],y=[];for(let t=0;t<e.length;++t){let n;if(0===d.strides[t])throw Error(`strides[${t}] must be non-zero`);let r=!!(d.shrinkAxisMask&1<<t),i=e[t];if(-1===i){m.push(r?1:-1);continue}let s=[d.beginMask&1<<t,d.endMask&1<<t],a=[d.strides[t]>0?0:-1,d.strides[t]>0?i:i-1];if(r&&d.strides[t]<=0)throw Error("only stride 1 allowed on non-range indexing.");g=g&&1===d.strides[t];let o=!!(d.beginMask&1<<t&&d.endMask&1<<t);if(d.beginValid&&d.endValid){if(r){let e=d.begin[t]<0?i+d.begin[t]:d.begin[t];if(d.begin[t]=e,d.end[t]=d.begin[t]+1,e<0||e>=i)throw Error(`slice index ${d.begin[t]} of dimension ${t} out of bounds.`)}else d.begin[t]=a9(d.begin[t],0,d.strides[t],i,s,a),d.end[t]=a9(d.end[t],1,d.strides[t],i,s,a);let e=1===d.strides[t]&&0===d.begin[t]&&d.end[t]===i;p=p&&e,f=f&&(0===t&&1===d.strides[t]||e)}else p=p&&1===d.strides[t]&&o,f=f&&(0===t&&1===d.strides[t]||o);let l=!1;if(d.beginValid&&d.endValid?(n=d.end[t]-d.begin[t],l=!0):r?(n=1,l=!0):o&&i>=0&&(n=d.strides[t]<0?-i:i,l=!0),l){let e;e=0===n||n<0!=d.strides[t]<0?0:Math.trunc(n/d.strides[t])+(n%d.strides[t]!=0?1:0),m.push(e)}else m.push(-1)}for(let e=0;e<d.finalShapeGatherIndices.length;++e){let t=d.finalShapeGatherIndices[e];t>=0?y.push(m[t]):t===aG&&y.push(1)}return{finalShapeSparse:y.filter((e,t)=>d.finalShapeGatherIndices[t]!==aG),finalShape:y,isIdentity:p,sliceDim0:f,isSimpleSlice:g,begin:d.begin,end:d.end,strides:d.strides}}function a7(e,t){t.beginMask=0,t.endMask=0,t.shrinkAxisMask=0;let n=0;t.beginValid=null!=e.begin,t.endValid=null!=e.end,t.begin=Array(t.dims),t.end=Array(t.dims),t.strides=Array(t.dims),t.finalShapeGatherIndices=[],t.finalShapeGatherIndicesSparse=[],t.inputShapeGatherIndicesSparse=Array(t.dims);for(let r=0;r<e.dims;r++)if(1<<r&e.ellipsisMask){let i=Math.min(t.dims-(e.dims-r)+1+e.numAddAxisAfterEllipsis,t.dims);for(;n<i;n++)t.begin[n]=0,t.end[n]=0,t.strides[n]=1,t.beginMask|=1<<n,t.endMask|=1<<n,t.finalShapeGatherIndices.push(n),t.finalShapeGatherIndicesSparse.push(-1),t.inputShapeGatherIndicesSparse[n]=r}else if(1<<r&e.newAxisMask)t.finalShapeGatherIndices.push(aG),t.finalShapeGatherIndicesSparse.push(-1);else{if(n===t.begin.length)throw Error(`Index out of range using input dim ${n}; input has only ${t.dims} dims, ${t.begin.length}.`);null!=e.begin&&(t.begin[n]=e.begin[r]),null!=e.end&&(t.end[n]=e.end[r]),t.strides[n]=e.strides[r],e.beginMask&1<<r&&(t.beginMask|=1<<n),e.endMask&1<<r&&(t.endMask|=1<<n),e.shrinkAxisMask&1<<r?(t.finalShapeGatherIndices.push(aW),t.finalShapeGatherIndicesSparse.push(-1),t.shrinkAxisMask|=1<<n):(t.finalShapeGatherIndices.push(n),t.finalShapeGatherIndicesSparse.push(r)),t.inputShapeGatherIndicesSparse[n]=r,n++}}function a9(e,t,n,r,i,s){if(i[t])return n>0?s[t]:s[t+1&1];{let t=e<0?r+e:e;return t<s[0]?s[0]:t>s[1]?s[1]:t}}let oe=iH({all_:function(e,t=null,n=!1){let r={x:iG(e,"x","all","bool")},i={axis:t,keepDims:n};return iD.runKernel(eV,r,i)}}),ot=iH({any_:function(e,t=null,n=!1){let r={x:iG(e,"x","any","bool")},i={axis:t,keepDims:n};return iD.runKernel(ej,r,i)}}),on=iH({argMax_:function(e,t=0){let n={x:iG(e,"x","argMax")},r={axis:t};return iD.runKernel(eG,n,r)}});function or(e,t,n,r,i="NHWC",s){let a=[...t,e[3]];return oa(e,a,n,s,r,null,null,ow(i))}function oi(e,t,n,r,i,s,a="channelsLast"){let o;let[l,u]=oh(t);if("channelsLast"===a)o=[l,u,e[3],e[3]];else if("channelsFirst"===a)o=[l,u,e[1],e[1]];else throw Error(`Unknown dataFormat ${a}`);return oa(e,o,n,r,i,s,!1,a)}function os(e,t,n,r,i,s,a="NDHWC"){let o,l;let[u,c,h]=od(t);if("NDHWC"===a)l="channelsLast",o=[u,c,h,e[4],e[4]];else if("NCDHW"===a)l="channelsFirst",o=[u,c,h,e[1],e[1]];else throw Error(`Unknown dataFormat ${a}`);return oo(e,o,n,r,i,!1,l,s)}function oa(e,t,n,r,i,s,a=!1,o="channelsLast"){let l,[u,c,h,d]=[-1,-1,-1,-1];if("channelsLast"===o)[u,c,h,d]=e;else if("channelsFirst"===o)[u,d,c,h]=e;else throw Error(`Unknown dataFormat ${o}`);let[p,f,,g]=t,[m,y]=oh(n),[b,v]=oh(r),w=op(p,b),_=op(f,v),{padInfo:x,outHeight:T,outWidth:I}=of(i,c,h,m,y,w,_,s,o),k=a?g*d:g;return"channelsFirst"===o?l=[u,k,T,I]:"channelsLast"===o&&(l=[u,T,I,k]),{batchSize:u,dataFormat:o,inHeight:c,inWidth:h,inChannels:d,outHeight:T,outWidth:I,outChannels:k,padInfo:x,strideHeight:m,strideWidth:y,filterHeight:p,filterWidth:f,effectiveFilterHeight:w,effectiveFilterWidth:_,dilationHeight:b,dilationWidth:v,inShape:e,outShape:l,filterShape:t}}function oo(e,t,n,r,i,s=!1,a="channelsLast",o){let l,[u,c,h,d,p]=[-1,-1,-1,-1,-1];if("channelsLast"===a)[u,c,h,d,p]=e;else if("channelsFirst"===a)[u,p,c,h,d]=e;else throw Error(`Unknown dataFormat ${a}`);let[f,g,m,,y]=t,[b,v,w]=od(n),[_,x,T]=od(r),I=op(f,_),k=op(g,x),S=op(m,T),{padInfo:E,outDepth:C,outHeight:A,outWidth:N}=og(i,c,h,d,b,v,w,I,k,S,o),O=s?y*p:y;return"channelsFirst"===a?l=[u,O,C,A,N]:"channelsLast"===a&&(l=[u,C,A,N,O]),{batchSize:u,dataFormat:a,inDepth:c,inHeight:h,inWidth:d,inChannels:p,outDepth:C,outHeight:A,outWidth:N,outChannels:O,padInfo:E,strideDepth:b,strideHeight:v,strideWidth:w,filterDepth:f,filterHeight:g,filterWidth:m,effectiveFilterDepth:I,effectiveFilterHeight:k,effectiveFilterWidth:S,dilationDepth:_,dilationHeight:x,dilationWidth:T,inShape:e,outShape:l,filterShape:t}}function ol(e,t,n,r,i){null==r&&(r=oc(e,t,n));let s=e[0],a=e[1];return[om((s-t+2*r)/n+1,i),om((a-t+2*r)/n+1,i)]}function ou(e,t,n,r,i,s){null==i&&(i=oc(e,t[0],r[0]));let a=[0,0,0,n];for(let n=0;n<3;n++)e[n]+2*i>=t[n]&&(a[n]=om((e[n]-t[n]+2*i)/r[n]+1,s));return a}function oc(e,t,n,r=1){let i=op(t,r);return Math.floor((e[0]*(n-1)-n+i)/2)}function oh(e){return"number"==typeof e?[e,e,e]:2===e.length?[e[0],e[1],1]:e}function od(e){return"number"==typeof e?[e,e,e]:e}function op(e,t){return t<=1?e:e+(e-1)*(t-1)}function of(e,t,n,r,i,s,a,o,l){let u,c,h;if("number"==typeof e){let i=0===e?"VALID":"NUMBER";u={top:e,bottom:e,left:e,right:e,type:i};let a=ol([t,n],s,r,e,o);c=a[0],h=a[1]}else if("same"===e){let e=Math.max(0,((c=Math.ceil(t/r))-1)*r+s-t),o=Math.max(0,((h=Math.ceil(n/i))-1)*i+a-n),l=Math.floor(e/2),d=e-l,p=Math.floor(o/2),f=o-p;u={top:l,bottom:d,left:p,right:f,type:"SAME"}}else if("valid"===e)u={top:0,bottom:0,left:0,right:0,type:"VALID"},c=Math.ceil((t-s+1)/r),h=Math.ceil((n-a+1)/i);else if("object"==typeof e){let d="channelsLast"===l?e[1][0]:e[2][0],p="channelsLast"===l?e[1][1]:e[2][1],f="channelsLast"===l?e[2][0]:e[3][0],g="channelsLast"===l?e[2][1]:e[3][1],m=0===d&&0===p&&0===f&&0===g?"VALID":"EXPLICIT";u={top:d,bottom:p,left:f,right:g,type:m},c=om((t-s+d+p)/r+1,o),h=om((n-a+f+g)/i+1,o)}else throw Error(`Unknown padding parameter: ${e}`);return{padInfo:u,outHeight:c,outWidth:h}}function og(e,t,n,r,i,s,a,o,l,u,c){let h,d,p,f;if("valid"===e&&(e=0),"number"==typeof e){let g=0===e?"VALID":"NUMBER";h={top:e,bottom:e,left:e,right:e,front:e,back:e,type:g};let m=ou([t,n,r,1],[o,l,u],1,[i,s,a],e,c);d=m[0],p=m[1],f=m[2]}else if("same"===e){let e=((d=Math.ceil(t/i))-1)*i+o-t,c=((p=Math.ceil(n/s))-1)*s+l-n,g=((f=Math.ceil(r/a))-1)*a+u-r,m=Math.floor(e/2),y=e-m,b=Math.floor(c/2),v=c-b,w=Math.floor(g/2),_=g-w;h={top:b,bottom:v,left:w,right:_,front:m,back:y,type:"SAME"}}else throw Error(`Unknown padding parameter: ${e}`);return{padInfo:h,outDepth:d,outHeight:p,outWidth:f}}function om(e,t){if(!t)return Math.trunc(e);switch(t){case"round":return Math.round(e);case"ceil":return Math.ceil(e);case"floor":return Math.floor(e);default:throw Error(`Unknown roundingMode ${t}`)}}function oy(e){let[t,n,r]=oh(e);return 1===t&&1===n&&1===r}function ob(e,t){return oy(e)||oy(t)}function ov(e){return oh(e).every(e=>e>0)}function ow(e){if("NHWC"===e)return"channelsLast";if("NCHW"===e)return"channelsFirst";throw Error(`Unknown dataFormat ${e}`)}function o_(e,t,n){if(null!=n){if("string"==typeof t)throw Error(`Error in ${e}: pad must be an integer when using dimRoundingMode ${n} but got pad ${t}.`);if("number"==typeof t)j(K(t),()=>`Error in ${e}: pad must be an integer when using dimRoundingMode ${n} but got pad ${t}.`);else if("object"==typeof t)t.forEach(t=>{t.forEach(t=>{j(K(t),()=>`Error in ${e}: pad must be an integer when using dimRoundingMode ${n} but got pad ${t}.`)})});else throw Error(`Error in ${e}: Unknown padding parameter: ${t}`)}}let ox=iH({reshape_:function(e,t){let n={x:iG(e,"x","reshape","string_or_numeric")},r={shape:t};return iD.runKernel(nN,n,r)}}),oT=iH({avgPool_:function(e,t,n,r,i){let s=iG(e,"x","avgPool","float32"),a=1;j(ob(n,1),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${n} and dilations '${a}'`);let o=s,l=!1;3===s.rank&&(l=!0,o=ox(s,[1,s.shape[0],s.shape[1],s.shape[2]])),j(4===o.rank,()=>`Error in avgPool: x must be rank 4 but got rank ${o.rank}.`),o_("avgPool",r,i);let u={x:o},c={filterSize:t,strides:n,pad:r,dimRoundingMode:i},h=iD.runKernel(eQ,u,c);return(h=s1(h,s.dtype),l)?ox(h,[h.shape[1],h.shape[2],h.shape[3]]):h}}),oI=iH({avgPool3d_:function(e,t,n,r,i,s="NDHWC"){let a=iG(e,"x","avgPool3d","float32"),o=a,l=!1;4===a.rank&&(l=!0,o=ox(a,[1,a.shape[0],a.shape[1],a.shape[2],a.shape[3]])),j(5===o.rank,()=>`Error in avgPool3d: x must be rank 5 but got rank ${o.rank}.`),j("NDHWC"===s,()=>`Error in avgPool3d: Only NDHWC is currently supported, but got dataFormat of ${s}`),j("number"==typeof n&&n>0||Array.isArray(n)&&n[0]>0&&n[1]>0&&n[2]>0,()=>`Error in avgPool3d: Stride must be > 0, but got '${n}'`),o_("avgPool3d",r,i);let u={x:o},c={filterSize:t,strides:n,pad:r,dimRoundingMode:i,dataFormat:s},h=iD.runKernel(eZ,u,c);return(h=s1(h,o.dtype),l)?ox(h,[h.shape[1],h.shape[2],h.shape[3],h.shape[4]]):h}});function ok(e){return 0===e.rank||1===e.rank?ox(e,[1,1,1,e.size]):2===e.rank?ox(e,[1,1,e.shape[0],e.shape[1]]):3===e.rank?ox(e,[1,e.shape[0],e.shape[1],e.shape[2]]):e}let oS=iH({batchNorm_:function(e,t,n,r,i,s){let a,o;null==s&&(s=.001);let l=iG(e,"x","batchNorm"),u=iG(t,"mean","batchNorm"),c=iG(n,"variance","batchNorm");null!=i&&(a=iG(i,"scale","batchNorm")),null!=r&&(o=iG(r,"offset","batchNorm")),j(u.rank===c.rank,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),j(null==o||u.rank===o.rank,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),j(null==a||u.rank===a.rank,()=>"Batch normalization gradient requires mean and scale to have equal ranks.");let h={x:ok(l),scale:a,offset:o,mean:u,variance:c},d={varianceEpsilon:s};return ox(iD.runKernel(tL,h,d),l.shape)}}),oE=iH({batchNorm2d_:function(e,t,n,r,i,s){let a,o;let l=iG(e,"x","batchNorm"),u=iG(t,"mean","batchNorm"),c=iG(n,"variance","batchNorm");return null!=i&&(a=iG(i,"scale","batchNorm")),null!=r&&(o=iG(r,"offset","batchNorm")),j(2===l.rank,()=>`Error in batchNorm2D: x must be rank 2 but got rank ${l.rank}.`),j(2===u.rank||1===u.rank,()=>`Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank ${u.rank}.`),j(2===c.rank||1===c.rank,()=>`Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank ${c.rank}.`),null!=a&&j(2===a.rank||1===a.rank,()=>`Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank ${a.rank}.`),null!=o&&j(2===o.rank||1===o.rank,()=>`Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank ${o.rank}.`),oS(l,u,c,o,a,s)}}),oC=iH({batchNorm3d_:function(e,t,n,r,i,s){let a,o;let l=iG(e,"x","batchNorm"),u=iG(t,"mean","batchNorm"),c=iG(n,"variance","batchNorm");return null!=i&&(a=iG(i,"scale","batchNorm")),null!=r&&(o=iG(r,"offset","batchNorm")),j(3===l.rank,()=>`Error in batchNorm3D: x must be rank 3 but got rank ${l.rank}.`),j(3===u.rank||1===u.rank,()=>`Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank ${u.rank}.`),j(3===c.rank||1===c.rank,()=>`Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank ${c.rank}.`),null!=a&&j(3===a.rank||1===a.rank,()=>`Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank ${a.rank}.`),null!=o&&j(3===o.rank||1===o.rank,()=>`Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank ${o.rank}.`),oS(l,u,c,o,a,s)}}),oA=iH({batchNorm4d_:function(e,t,n,r,i,s){let a,o;let l=iG(e,"x","batchNorm"),u=iG(t,"mean","batchNorm"),c=iG(n,"variance","batchNorm");return null!=i&&(a=iG(i,"scale","batchNorm")),null!=r&&(o=iG(r,"offset","batchNorm")),j(4===l.rank,()=>`Error in batchNorm4D: x must be rank 4 but got rank ${l.rank}.`),j(4===u.rank||1===u.rank,()=>`Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank ${u.rank}.`),j(4===c.rank||1===c.rank,()=>`Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank ${c.rank}.`),null!=a&&j(4===a.rank||1===a.rank,()=>`Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank ${a.rank}.`),null!=o&&j(4===o.rank||1===o.rank,()=>`Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank ${o.rank}.`),oS(l,u,c,o,a,s)}}),oN=iH({broadcastTo_:function(e,t){let n=iG(e,"broadcastTo","x"),r=n.shape;if(e_(t),t.length<n.rank)throw Error(`broadcastTo(): shape.length=${t.length} < input.rank=${n.rank}.`);if(t.length>n.rank){let e=n.shape.slice();for(;e.length<t.length;)e.unshift(1);n=ox(n,e)}let i=n.shape,s=Array.from(t);for(let e=t.length-1;e>=0;e--)if(i[e]===t[e])s[e]=1;else if(1!==n.shape[e])throw Error(`broadcastTo(): [${r}] cannot be broadcast to [${t}].`);if(0===s.map((e,t)=>e>1?t:-1).filter(e=>e>=0).length)return s2(n);let a={x:n},o={reps:s};return iD.runKernel(ra,a,o)}}),oO=iH({clipByValue_:function(e,t,n){let r=iG(e,"x","clipByValue");if(j(t<=n,()=>`Error in clip: min (${t}) must be less than or equal to max (${n}).`),t===n)return ah(r.shape,t,r.dtype);let i={x:r},s={clipValueMin:t,clipValueMax:n};return iD.runKernel(e9,i,s)}}),o$=iH({concat_:function(e,t=0){j(e.length>=1,()=>"Pass at least one tensor to concat");let n=iW(e,"tensors","concat","string_or_numeric");if("complex64"===n[0].dtype&&n.forEach(e=>{if("complex64"!==e.dtype)throw Error(`Cannot concatenate complex64 tensors with a tensor
          with dtype ${e.dtype}. `)}),1===n.length)return s2(n[0]);let r=n,i={axis:t};return iD.runKernel(tn,r,i)}}),oR=iH({concat1d_:function(e){return o$(e,0)}}),oD=iH({concat2d_:function(e,t){return o$(e,t)}}),oF=iH({concat3d_:function(e,t){return o$(e,t)}}),oP=iH({concat4d_:function(e,t){return o$(e,t)}}),oM=iH({conv2d_:function(e,t,n,r,i="NHWC",s=[1,1],a){let o=iG(e,"x","conv2d","float32"),l=iG(t,"filter","conv2d","float32"),u=o,c=!1;3===o.rank&&(c=!0,u=ox(o,[1,o.shape[0],o.shape[1],o.shape[2]])),j(4===u.rank,()=>`Error in conv2d: input must be rank 4, but got rank ${u.rank}.`),j(4===l.rank,()=>`Error in conv2d: filter must be rank 4, but got rank ${l.rank}.`),o_("conv2d",r,a);let h="NHWC"===i?u.shape[3]:u.shape[1];j(h===l.shape[2],()=>`Error in conv2d: depth of input (${h}) must match input depth for filter ${l.shape[2]}.`),j(ob(n,s),()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${n} and dilations '${s}'`),j(ov(s),()=>"Error in conv2D: Dilated rates should be larger than 0."),j(ov(n),()=>"Error in conv2D: Strides should be larger than 0.");let d={x:u,filter:l},p={strides:n,pad:r,dataFormat:i,dilations:s,dimRoundingMode:a},f=iD.runKernel(tr,d,p);return c?ox(f,[f.shape[1],f.shape[2],f.shape[3]]):f}}),oL=iH({conv1d_:function(e,t,n,r,i="NWC",s=1,a){let o=iG(e,"x","conv1d"),l=iG(t,"filter","conv1d"),u=o,c=!1;2===o.rank&&(c=!0,u=ox(o,[1,o.shape[0],o.shape[1]])),j(3===u.rank,()=>`Error in conv1d: input must be rank 3, but got rank ${u.rank}.`),j(3===l.rank,()=>`Error in conv1d: filter must be rank 3, but got rank ${l.rank}.`),o_("conv1d",r,a),j(u.shape[2]===l.shape[1],()=>`Error in conv1d: depth of input (${u.shape[2]}) must match input depth for filter ${l.shape[1]}.`),j(ob(n,s),()=>`Error in conv1D: Either stride or dilation must be 1. Got stride ${n} and dilation '${s}'`),j(ov(s),()=>"Error in conv1D: Dilated rates should be larger than 0."),j(ov(n),()=>"Error in conv1D: Stride should be larger than 0."),j("NWC"===i,()=>`Error in conv1d: got dataFormat of ${i} but only NWC is currently supported.`);let h=ox(l,[1,l.shape[0],l.shape[1],l.shape[2]]),d=oM(ox(u,[u.shape[0],1,u.shape[1],u.shape[2]]),h,[1,n],r,"NHWC",[1,s],a);return c?ox(d,[d.shape[2],d.shape[3]]):ox(d,[d.shape[0],d.shape[2],d.shape[3]])}}),oz=iH({conv2DBackpropInput_:function(e,t,n,r,i,s="NHWC",a){j(e.length===t.rank,()=>`Length of inShape (${e.length}) and rank of dy (${t.rank}) must match`);let o=e,l=t,u=!1;3===t.rank&&(u=!0,l=ox(t,[1,t.shape[0],t.shape[1],t.shape[2]]),o=[1,e[0],e[1],e[2]]),j(4===o.length,()=>`Error in conv2dDerInput: inShape must be length 4, but got length ${o.length}.`),j(4===l.rank,()=>`Error in conv2dDerInput: dy must be rank 4, but got rank ${l.rank}`),j(4===n.rank,()=>`Error in conv2dDerInput: filter must be rank 4, but got rank ${n.rank}`);let c="NHWC"===s?o[3]:o[1],h="NHWC"===s?l.shape[3]:l.shape[1];j(c===n.shape[2],()=>`Error in conv2dDerInput: depth of input (${c}) must match input depth for filter ${n.shape[2]}.`),j(h===n.shape[3],()=>`Error in conv2dDerInput: depth of output (${h}) must match output depth for filter ${n.shape[3]}.`),o_("conv2dDerInput",i,a);let d={dy:l,filter:n},p={strides:r,pad:i,dataFormat:s,dimRoundingMode:a,inputShape:o},f=iD.runKernel(ts,d,p);return u?ox(f,[f.shape[1],f.shape[2],f.shape[3]]):f}}),oB=iH({conv2dTranspose_:function(e,t,n,r,i,s){return oz(n,iG(e,"x","conv2dTranspose"),iG(t,"filter","conv2dTranspose"),r,i,"NHWC",s)}}),oU=iH({conv3d_:function(e,t,n,r,i="NDHWC",s=[1,1,1]){let a=iG(e,"x","conv3d"),o=iG(t,"filter","conv3d"),l=a,u=!1;4===a.rank&&(u=!0,l=ox(a,[1,a.shape[0],a.shape[1],a.shape[2],a.shape[3]])),j(5===l.rank,()=>`Error in conv3d: input must be rank 5, but got rank ${l.rank}.`),j(5===o.rank,()=>`Error in conv3d: filter must be rank 5, but got rank ${o.rank}.`),j(l.shape[4]===o.shape[3],()=>`Error in conv3d: depth of input (${l.shape[4]}) must match input depth for filter ${o.shape[3]}.`),j(ob(n,s),()=>`Error in conv3D: Either strides or dilations must be 1. Got strides ${n} and dilations '${s}'`),j("NDHWC"===i,()=>`Error in conv3d: got dataFormat of ${i} but only NDHWC is currently supported.`),j(ov(s),()=>"Error in conv3D: Dilated rates should be larger than 0."),j(ov(n),()=>"Error in conv3D: Strides should be larger than 0.");let c={x:l,filter:o},h={strides:n,pad:r,dataFormat:i,dilations:s},d=iD.runKernel(ta,c,h);return u?ox(d,[d.shape[1],d.shape[2],d.shape[3],d.shape[4]]):d}}),oV=iH({conv3DBackpropInput_:function(e,t,n,r,i){j(e.length===t.rank,()=>`Length of inShape (${e.length}) and rank of dy (${t.rank}) must match`);let s=e,a=t,o=!1;4===t.rank&&(o=!0,a=ox(t,[1,t.shape[0],t.shape[1],t.shape[2],t.shape[3]]),s=[1,e[0],e[1],e[2],e[3]]);let l=s[4],u=a.shape[4];j(5===s.length,()=>`Error in conv3dDerInput: inShape must be length 5, but got length ${s.length}.`),j(5===a.rank,()=>`Error in conv3dDerInput: dy must be rank 5, but got rank ${a.rank}`),j(5===n.rank,()=>`Error in conv3dDerInput: filter must be rank 5, but got rank ${n.rank}`),j(l===n.shape[3],()=>`Error in conv3dDerInput: depth of input (${l}) must match input depth for filter ${n.shape[3]}.`),j(u===n.shape[4],()=>`Error in conv3dDerInput: depth of output (${u}) must match output depth for filter ${n.shape[4]}.`);let c={dy:a,filter:n},h={pad:i,strides:r,inputShape:s},d=iD.runKernel(tl,c,h);return o?ox(d,[d.shape[1],d.shape[2],d.shape[3],d.shape[4]]):d}}),oj=iH({conv3dTranspose_:function(e,t,n,r,i){return oV(n,iG(e,"x","conv3dTranspose"),iG(t,"filter","conv3dTranspose"),r,i)}}),oG=iH({denseBincount_:function(e,t,n,r=!1){let i=iG(e,"x","denseBincount"),s=iG(t,"weights","denseBincount");j("int32"===i.dtype,()=>`Error in denseBincount: input dtype must be int32, but got ${i.dtype}`),j(i.rank<=2,()=>`Error in denseBincount: input must be at most rank 2, but got rank ${i.rank}.`),j(n>=0,()=>`size must be non-negative, but got ${n}.`),j(s.size===i.size||0===s.size,()=>`Error in denseBincount: weights must have the same shape as x or 0-length, but got x shape: ${i.shape}, weights shape: ${s.shape}.`);let a={x:i,weights:s},o={size:n,binaryOutput:r};return iD.runKernel(tf,a,o)}}),oW=iH({depthwiseConv2d_:function(e,t,n,r,i="NHWC",s=[1,1],a){let o=iG(e,"x","depthwiseConv2d","float32"),l=iG(t,"filter","depthwiseConv2d","float32"),u=o,c=!1;3===o.rank&&(c=!0,u=ox(o,[1,o.shape[0],o.shape[1],o.shape[2]])),j(4===u.rank,()=>`Error in depthwiseConv2d: input must be rank 4, but got rank ${u.rank}.`),j(4===l.rank,()=>`Error in depthwiseConv2d: filter must be rank 4, but got rank ${l.rank}.`);let h="NHWC"===i?u.shape[3]:u.shape[1];j(h===l.shape[2],()=>`Error in depthwiseConv2d: number of input channels (${h}) must match the inChannels dimension in filter ${l.shape[2]}.`),o_("depthwiseConv2d",r,a);let d={x:u,filter:l},p={strides:n,pad:r,dataFormat:i,dilations:s,dimRoundingMode:a},f=iD.runKernel(tm,d,p);return c?ox(f,[f.shape[1],f.shape[2],f.shape[3]]):f}}),oq=iH({elu_:function(e){let t={x:iG(e,"x","elu","float32")};return iD.runKernel(tS,t)}}),oH=iH({equal_:function(e,t){let n=iG(e,"a","equal","string_or_numeric"),r=iG(t,"b","equal","string_or_numeric");[n,r]=iI(n,r),av(n.shape,r.shape);let i={a:n,b:r};return iD.runKernel(tA,i)}}),oK=iH({erf_:function(e){let t=iG(e,"x","erf");j("int32"===t.dtype||"float32"===t.dtype,()=>"Input dtype must be `int32` or `float32`."),"int32"===t.dtype&&(t=s1(t,"float32"));let n={x:t};return iD.runKernel(tC,n)}}),oX=iH({exp_:function(e){let t={x:iG(e,"x","exp")};return iD.runKernel(tN,t)}}),oY=iH({expandDims_:function(e,t=0){let n=iG(e,"x","expandDims","string_or_numeric");j(t<=n.rank,()=>"Axis must be <= rank of the tensor");let r={input:n},i={dim:t};return iD.runKernel(tO,r,i)}}),oQ=iH({tile_:function(e,t){let n=iG(e,"x","tile","string_or_numeric");j(n.rank===t.length,()=>`Error in transpose: rank of input ${n.rank} must match length of reps ${t}.`);let r={x:n},i={reps:t};return iD.runKernel(ra,r,i)}}),oJ=iH({eye_:function(e,t,n,r="float32"){null==t&&(t=e);let i=s0([e,t],r),s=e<=t?e:t;for(let e=0;e<s;++e)i.set(1,e,e);let a=ox(i.toTensor(),[e,t]);if(null==n)return a;if(1===n.length)return oQ(oY(a,0),[n[0],1,1]);if(2===n.length)return oQ(oY(oY(a,0),0),[n[0],n[1],1,1]);if(3===n.length)return oQ(oY(oY(oY(a,0),0),0),[n[0],n[1],n[2],1,1]);throw Error(`eye() currently supports only 1D and 2D batchShapes, but received ${n.length}D.`)}}),oZ=iH({floor_:function(e){let t={x:iG(e,"x","floor","float32")};return iD.runKernel(tP,t)}}),o0=iH({gather_:function(e,t,n=0,r=0){let i={x:iG(e,"x","gather"),indices:iG(t,"indices","gather","int32")},s={axis:n,batchDims:r};return iD.runKernel(tz,i,s)}}),o1=iH({greater_:function(e,t){let n=iG(e,"a","greater","string_or_numeric"),r=iG(t,"b","greater","string_or_numeric");[n,r]=iI(n,r),av(n.shape,r.shape);let i={a:n,b:r};return iD.runKernel(tU,i)}}),o2=iH({greaterEqual_:function(e,t){let n=iG(e,"a","greaterEqual","string_or_numeric"),r=iG(t,"b","greaterEqual","string_or_numeric");[n,r]=iI(n,r),av(n.shape,r.shape);let i={a:n,b:r};return iD.runKernel(tV,i)}}),o3=iH({leakyRelu_:function(e,t=.2){let n={x:iG(e,"x","leakyRelu")},r={alpha:t};return iD.runKernel(tX,n,r)}}),o4=iH({log_:function(e){let t={x:iG(e,"x","log","float32")};return iD.runKernel(tZ,t)}}),o6=iH({log1p_:function(e){let t={x:iG(e,"x","log1p")};return iD.runKernel(t0,t)}}),o5=iH({max_:function(e,t=null,n=!1){let r={x:iG(e,"x","max")},i={reductionIndices:t,keepDims:n};return iD.runKernel(t8,r,i)}}),o8=iH({sum_:function(e,t=null,n=!1){let r=iG(e,"x","sum");"bool"===r.dtype&&(r=s1(r,"int32"));let i={x:r},s={axis:t,keepDims:n};return iD.runKernel(nQ,i,s)}}),o7=iH({logSoftmax_:function(e,t=-1){let n=iG(e,"logits","logSoftmax");if(-1===t&&(t=n.rank-1),t!==n.rank-1)throw Error(`Log Softmax along a non-last dimension is not yet supported. Logits was rank ${n.rank} and axis was ${t}`);return an((e,n)=>{let r=!0,i=o5(e,t,!0),s=af(e,i),a=af(s1(s,"float32"),o4(o8(oX(s),t,r)));return n([a]),{value:a,gradFunc:(e,n)=>{let[r]=n,i=!0,s=oX(r);return af(e,s8(o8(e,t,i),s))}}})(n)}});function o9(e,t){for(let n=0;n<e.length;++n)if(e[e.length-n-1]!==t-1-n)return!1;return!0}function le(e,t,n){let r=e.length+t.length,i=[],s=0,a=0;for(let o=0;o<r;o++)-1===n.indexOf(o)?i.push(e[s++]):i.push(t[a++]);return i}function lt(e,t){let n=[],r=e.length;for(let i=0;i<r;i++)-1===t.indexOf(i)&&n.push(e[i]);return[n,t.map(t=>e[t])]}function ln(e,t){return le(e,t.map(e=>1),t)}function lr(e,t,n){j(o9(t,n),()=>`${e} supports only inner-most axes for now. Got axes ${t} and rank-${n} input.`)}function li(e,t){if(o9(e,t))return null;let n=[];for(let r=0;r<t;++r)-1===e.indexOf(r)&&n.push(r);return e.forEach(e=>n.push(e)),n}function ls(e){return e.map((e,t)=>[t,e]).sort((e,t)=>e[1]-t[1]).map(e=>e[0])}function la(e,t){let n=[];for(let r=t-e;r<t;++r)n.push(r);return n}let lo=iH({logSumExp_:function(e,t=null,n=!1){let r=iG(e,"x","logSumExp"),i=Z(t,r.shape),s=o5(r,i,!0),a=o4(o8(oX(af(r,s)),i)),o=s4(ox(s,a.shape),a);if(n){let e=ln(o.shape,i);return ox(o,e)}return o}}),ll=iH({logicalAnd_:function(e,t){let n=iG(e,"a","logicalAnd","bool"),r=iG(t,"b","logicalAnd","bool");av(n.shape,r.shape);let i={a:n,b:r};return iD.runKernel(t1,i)}}),lu=iH({matMul_:function(e,t,n=!1,r=!1){let i=iG(e,"a","matMul"),s=iG(t,"b","matMul");[i,s]=iI(i,s);let a={a:i,b:s},o={transposeA:n,transposeB:r};return iD.runKernel(e1,a,o)}}),lc=iH({maxPool_:function(e,t,n,r,i){let s=iG(e,"x","maxPool"),a=1,o=s,l=!1;3===s.rank&&(l=!0,o=ox(s,[1,s.shape[0],s.shape[1],s.shape[2]])),j(4===o.rank,()=>`Error in maxPool: input must be rank 4 but got rank ${o.rank}.`),j(ob(n,a),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${n} and dilations '${a}'`),o_("maxPool",r,i);let u={x:o},c={filterSize:t,strides:n,pad:r,dimRoundingMode:i},h=iD.runKernel(t9,u,c);return l?ox(h,[h.shape[1],h.shape[2],h.shape[3]]):h}}),lh=iH({maxPool3d_:function(e,t=[1,1,1],n,r,i,s="NDHWC"){let a=iG(e,"x","maxPool3d"),o=a,l=!1;4===a.rank&&(l=!0,o=ox(a,[1,a.shape[0],a.shape[1],a.shape[2],a.shape[3]])),j(5===o.rank,()=>`Error in maxPool3d: x must be rank 5 but got rank ${o.rank}.`),j("NDHWC"===s,()=>`Error in maxPool3d: Only NDHWC is currently supported, but got dataFormat of ${s}`),o_("maxPool3d",r,i);let u={x:o},c={filterSize:t,strides:n,pad:r,dimRoundingMode:i,dataFormat:s},h=iD.runKernel(nt,u,c);return l?ox(h,[h.shape[1],h.shape[2],h.shape[3],h.shape[4]]):h}}),ld=iH({mean_:function(e,t=null,n=!1){let r={x:iG(e,"x","mean")},i={axis:t,keepDims:n};return iD.runKernel(ni,r,i)}}),lp=iH({min_:function(e,t=null,n=!1){let r={x:iG(e,"x","min")},i={axis:t,keepDims:n};return iD.runKernel(ns,r,i)}}),lf=iH({minimum_:function(e,t){let n=iG(e,"a","minimum"),r=iG(t,"b","minimum");[n,r]=iI(n,r),"bool"===n.dtype&&(n=s1(n,"int32"),r=s1(r,"int32")),av(n.shape,r.shape);let i={a:n,b:r};return iD.runKernel(na,i)}}),lg=iH({moments_:function(e,t=null,n=!1){let r=Z(t,(e=iG(e,"x","moments")).shape),i=ld(e,r,n),s=i.shape;n||(s=ln(i.shape,r));let a=ld(s9(af(s1(e,"float32"),ox(i,s))),r,n);return{mean:i,variance:a}}}),lm=iH({neg_:function(e){let t={x:iG(e,"x","neg")};return iD.runKernel(nh,t)}}),ly=iH({notEqual_:function(e,t){let n=iG(e,"a","notEqual","string_or_numeric"),r=iG(t,"b","notEqual","string_or_numeric");[n,r]=iI(n,r),av(n.shape,r.shape);let i={a:n,b:r};return iD.runKernel(nd,i)}}),lb=iH({oneHot_:function(e,t,n=1,r=0,i="int32"){if(t<2)throw Error(`Error in oneHot: depth must be >=2, but it is ${t}`);let s={indices:iG(e,"indices","oneHot","int32")},a={dtype:i,depth:t,onValue:n,offValue:r};return iD.runKernel(ny,s,a)}});function lv(e,t="float32"){if(e_(e),"complex64"===t)return iK(lv(e,"float32"),lv(e,"float32"));let n=ev(q(e),t);return iD.makeTensor(n,e,t)}function lw(e,t="float32"){if(e_(e),"complex64"===t)return iK(lw(e,"float32"),lv(e,"float32"));let n=eb(q(e),t);return iD.makeTensor(n,e,t)}let l_=iH({onesLike_:function(e){let t={x:iG(e,"x","onesLike")};return iD.runKernel(nm,t)}}),lx=iH({pad_:function(e,t,n=0){let r=iG(e,"x","pad");if(0===r.rank)throw Error("pad(scalar) is not defined. Pass non-scalar to pad");let i={paddings:t,constantValue:n},s={x:r};return iD.runKernel(nv,s,i)}}),lT=iH({prelu_:function(e,t){let n={x:iG(e,"x","prelu"),alpha:iG(t,"alpha","prelu")};return iD.runKernel(n_,n)}});var lI=n(7391);class lk{constructor(e,t,n,r,i){this.mean=e,this.stdDev=t,this.dtype=n,this.nextVal=NaN,this.truncated=r,this.truncated&&(this.upper=this.mean+2*this.stdDev,this.lower=this.mean-2*this.stdDev);let s=i||Math.random();this.random=lI.alea(s.toString())}nextValue(){let e,t;if(!isNaN(this.nextVal)){let e=this.nextVal;return this.nextVal=NaN,e}let n=!1;for(;!n;){let r,i,s;do s=(r=2*this.random()-1)*r+(i=2*this.random()-1)*i;while(s>=1||0===s);let a=Math.sqrt(-2*Math.log(s)/s);e=this.mean+this.stdDev*r*a,t=this.mean+this.stdDev*i*a,(!this.truncated||this.isValidTruncated(e))&&(n=!0)}return(!this.truncated||this.isValidTruncated(t))&&(this.nextVal=this.convertValue(t)),this.convertValue(e)}convertValue(e){return null==this.dtype||"float32"===this.dtype?e:Math.round(e)}isValidTruncated(e){return e<=this.upper&&e>=this.lower}}class lS{constructor(e=0,t=1,n,r){if(this.canReturnFloat=()=>null==this.dtype||"float32"===this.dtype,this.min=e,this.range=t-e,this.dtype=n,null==r&&(r=Math.random()),"number"==typeof r&&(r=r.toString()),!this.canReturnFloat()&&this.range<=1)throw Error(`The difference between ${e} - ${t} <= 1 and dtype is not float`);this.random=lI.alea(r)}convertValue(e){return this.canReturnFloat()?e:Math.round(e)}nextValue(){return this.convertValue(this.min+this.range*this.random())}}let lE=iH({randomNormal_:function(e,t=0,n=1,r,i){if(e_(e),null!=r&&"bool"===r)throw Error(`Unsupported data type ${r}`);let s=new lk(t,n,r,!1,i),a=s0(e,r);for(let e=0;e<a.values.length;e++)a.values[e]=s.nextValue();return a.toTensor()}}),lC=iH({randomUniform_:function(e,t=0,n=1,r="float32",i){e_(e);let s=s0(e,r),a=new lS(t,n,null,i);for(let e=0;e<s.values.length;e++)s.values[e]=a.nextValue();return s.toTensor()}});function lA(e,t,n=1,r="float32"){if(0===n)throw Error("Cannot have a step of zero");let i={start:e,stop:t,step:n,dtype:r};return iD.runKernel(nS,{},i)}let lN=iH({relu_:function(e){let t={x:iG(e,"x","relu")};return iD.runKernel(nA,t)}}),lO=iH({reverse_:function(e,t){let n={x:iG(e,"x","reverse")},r={dims:t};return iD.runKernel(nP,n,r)}}),l$=iH({selu_:function(e){let t={x:iG(e,"x","selu")};return iD.runKernel(nj,t)}}),lR=iH({separableConv2d_:function(e,t,n,r,i,s=[1,1],a="NHWC"){let o=iG(e,"x","separableConv2d"),l=iG(t,"depthwiseFilter","separableConv2d"),u=iG(n,"pointwiseFilter","separableConv2d"),c=o,h=!1;if(3===o.rank&&(h=!0,c=ox(o,[1,o.shape[0],o.shape[1],o.shape[2]])),"NCHW"===a)throw Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");j(4===c.rank,()=>`Error in separableConv2d: input must be rank 4, but got rank ${c.rank}.`),j(4===l.rank,()=>`Error in separableConv2d: depthwise filter must be rank 4, but got rank ${l.rank}.`),j(4===u.rank,()=>`Error in separableConv2d: pointwise filter must be rank 4, but got rank ${l.rank}.`),j(1===u.shape[0],()=>`Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got ${u.shape[0]}.`),j(1===u.shape[1],()=>`Error in separableConv2d: the second dimension of pointwise filter must be 1, but got ${u.shape[1]}.`);let d=l.shape[2],p=l.shape[3];j(u.shape[2]===d*p,()=>`Error in separableConv2d: the third dimension of pointwise filter must be ${d*p}, but got ${u.shape[2]}.`);let f=oM(oW(c,l,r,i,a,s),u,1,"valid",a);return h?ox(f,[f.shape[1],f.shape[2],f.shape[3]]):f}}),lD=iH({sigmoid_:function(e){let t={x:iG(e,"x","sigmoid","float32")};return iD.runKernel(nK,t)}}),lF=iH({slice_:function(e,t,n){let r=iG(e,"x","slice","string_or_numeric");if(0===r.rank)throw Error("Slicing scalar is not possible");let i={x:r},s={begin:t,size:n};return iD.runKernel(nG,i,s)}}),lP=iH({slice1d_:function(e,t,n){let r=iG(e,"x","slice1d");return j(1===r.rank,()=>`slice1d expects a rank-1 tensor, but got a rank-${r.rank} tensor`),lF(r,[t],[n])}}),lM=iH({slice2d_:function(e,t,n){let r=iG(e,"x","slice2d");return j(2===r.rank,()=>`slice2d expects a rank-2 tensor, but got a rank-${r.rank} tensor`),lF(r,t,n)}}),lL=iH({slice3d_:function(e,t,n){let r=iG(e,"x","slice3d");return j(3===r.rank,()=>`slice3d expects a rank-3 tensor, but got a rank-${r.rank} tensor`),lF(r,t,n)}}),lz=iH({slice4d_:function(e,t,n){let r=iG(e,"x","slice4d");return j(4===r.rank,()=>`slice4d expects a rank-4 tensor, but got a rank-${r.rank} tensor`),lF(r,t,n)}}),lB=iH({softmax_:function(e,t=-1){let n=iG(e,"logits","softmax","float32");if(-1===t&&(t=n.rank-1),t!==n.rank-1)throw Error(`Softmax along a non-last dimension is not yet supported. Logits was rank ${n.rank} and dim was ${t}`);let r={logits:n},i={dim:t};return iD.runKernel(n0,r,i)}}),lU=iH({softplus_:function(e){let t={x:iG(e,"x","softplus")};return iD.runKernel(nX,t)}}),lV=iH({split_:function(e,t,n=0){let r={x:iG(e,"x","split")},i={numOrSizeSplits:t,axis:n};return iD.runKernel(nZ,r,i)}}),lj=iH({squeeze_:function(e,t){let n=iG(e,"x","squeeze","string_or_numeric");return ox(n,ee(n.shape,t).newShape)}}),lG=iH({stack_:function(e,t=0){let n=iW(e,"tensors","stack","string_or_numeric");j(n.length>=1,()=>"Pass at least one tensor to tf.stack"),n.length>0&&j(t<=n[0].rank,()=>"Axis must be <= rank of the tensor");let r=n,i={axis:t};return iD.runKernel(nb,r,i)}}),lW=iH({tanh_:function(e){let t={x:iG(e,"x","tanh","float32")};return iD.runKernel(rs,t)}});function lq(e,t){W(e);let n=iU(e,t);if(1!==n.length)throw Error("tensor1d() requires values to be a flat/TypedArray");return iX(e,null,n,t)}function lH(e,t,n){if(W(e),null!=t&&2!==t.length)throw Error("tensor2d() requires shape to have two numbers");let r=iU(e,n);if(2!==r.length&&1!==r.length)throw Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(1===r.length&&null==t)throw Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return iX(e,t,r,n)}let lK=iH({truncatedNormal_:function(e,t=0,n=1,r,i){if(e_(e),null!=r&&"bool"===r)throw Error("Unsupported data type $ { dtype }");let s=new lk(t,n,r,!0,i),a=s0(e,r);for(let e=0;e<a.values.length;e++)a.values[e]=s.nextValue();return a.toTensor()}}),lX=iH({unstack_:function(e,t=0){let n=iG(e,"x","unstack","string_or_numeric");j(t>=-n.shape.length&&t<n.shape.length,()=>`Axis = ${t} is not in [-${n.shape.length}, ${n.shape.length})`);let r={value:n},i={axis:t};return iD.runKernel(rh,r,i)}});function lY(e,t=!0,n,r){return iD.makeVariable(e,t,n,r)}let lQ=iH({where_:function(e,t,n){let r=iG(t,"a","where"),i=iG(n,"b","where"),s=iG(e,"condition","where","bool"),a=av(av(s.shape,r.shape),i.shape),o={condition:oN(s,a),t:oN(r,a),e:oN(i,a)};return iD.runKernel(nV,o)}}),lJ=iH({imag_:function(e){let t={input:iG(e,"input","imag")};return iD.runKernel(tW,t)}}),lZ=iH({real_:function(e){let t={input:iG(e,"input","real")};return iD.runKernel(nE,t)}}),l0=iH({transpose_:function(e,t,n){let r=iG(e,"x","transpose");if(null==t&&(t=r.shape.map((e,t)=>t).reverse()),j(r.rank===t.length,()=>`Error in transpose: rank of input ${r.rank} must match length of perm ${t}.`),t.forEach(e=>{j(e>=0&&e<r.rank,()=>`All entries in 'perm' must be between 0 and ${r.rank-1} but got ${t}`)}),r.rank<=1)return r.clone();let i={x:r},s={perm:t};return"complex64"===r.dtype?i2(()=>{let e=lZ(r),t=lJ(r);return e=iD.runKernel(ru,{x:e},s),t=iD.runKernel(ru,{x:t},s),n&&(t=lm(t)),iK(e,t)}):iD.runKernel(ru,i,s)}});function l1(e,t){if(null==t)return e.shape.slice();if(H(e.shape,t))return t;if(e.shape.length===t.length){let n=[];for(let r=0;r<e.shape.length;r++)null==t[r]&&null!=e.shape[r]?n.push(e.shape[r]):n.push(t[r]);return n}return t}let l2=iH({dropout_:function(e,t,n,r){let i=iG(e,"x","dropout");if(j("float32"===i.dtype,()=>`x has to be a floating point tensor since it's going to be scaled, but got a ${i.dtype} tensor instead.`),j(t>=0&&t<1,()=>`rate must be a float in the range [0, 1), but got ${t}.`),0===t)return e instanceof im?i.clone():i;let s=l1(i,n),a=1-t;return s8(i,s5(oZ(s4(lC(s,0,1,"float32",r),a)),a))}}),l3=iH({fft_:function(e){j("complex64"===e.dtype,()=>`The dtype for tf.spectral.fft() must be complex64 but got ${e.dtype}.`);let t={input:e};return iD.runKernel(tR,t)}}),l4=iH({rfft_:function(e,t){let n;j("float32"===e.dtype,()=>`The dtype for rfft() must be real value but got ${e.dtype}`);let r=e.shape[e.shape.length-1],i=e.size/r;if(null!=t&&t<r){let i=e.shape.map(e=>0),s=e.shape.map(e=>e);s[e.shape.length-1]=t,n=lF(e,i,s),r=t}else if(null!=t&&t>r){let i=e.shape.map(e=>e);i[e.shape.length-1]=t-r,n=o$([e,lv(i)],e.shape.length-1),r=t}else n=e;let s=ae(n),a=l3(ox(iK(n,s),[i,r])),o=Math.floor(r/2)+1,l=lZ(a),u=lJ(a),c=lV(l,[o,r-o],l.shape.length-1),h=lV(u,[o,r-o],u.shape.length-1),d=n.shape.slice();return d[n.shape.length-1]=o,ox(iK(c[0],h[0]),d)}}),l6=iH({ifft_:function(e){j("complex64"===e.dtype,()=>`The dtype for tf.spectral.ifft() must be complex64 but got ${e.dtype}.`);let t={input:e};return iD.runKernel(tG,t)}}),l5=iH({irfft_:function(e){let t;let n=e.shape[e.shape.length-1],r=e.size/n;if(n<=2)t=l6(ox(e,[r,n]));else{let i=[r,2*(n-1)],s=ox(lZ(e),[r,n]),a=ox(lJ(e),[r,n]),o=lO(lF(s,[0,1],[r,n-2]),1),l=s8(lO(lF(a,[0,1],[r,n-2]),1),ar(-1));t=l6(ox(iK(o$([s,o],1),o$([a,l],1)),[i[0],i[1]]))}if(t=lZ(t),3===e.rank&&0!==e.shape[0]){let n=t,r=e.shape[0];t=ox(t,[r,t.shape[0]/r,t.shape[1]]),n.dispose()}return t}}),l8=iH({conv2DBackpropFilter_:function(e,t,n,r,i,s="NHWC",a){let o=e;3===e.rank&&(o=ox(e,[1,e.shape[0],e.shape[1],e.shape[2]]));let l=t;3===l.rank&&(l=ox(t,[1,t.shape[0],t.shape[1],t.shape[2]])),j(4===o.rank,()=>`Error in conv2dDerFilter: input must be rank 4, but got shape ${o.shape}.`),j(4===l.rank,()=>`Error in conv2dDerFilter: dy must be rank 4, but got shape ${l.shape}.`),j(4===n.length,()=>`Error in conv2dDerFilter: filterShape must be length 4, but got ${n}.`);let u="NHWC"===s?o.shape[3]:o.shape[1],c="NHWC"===s?l.shape[3]:l.shape[1];j(u===n[2],()=>`Error in conv2dDerFilter: depth of input ${u}) must match input depth in filter (${n[2]}.`),j(c===n[3],()=>`Error in conv2dDerFilter: depth of dy (${c}) must match output depth for filter (${n[3]}).`),o_("conv2dDerFilter",i,a);let h={x:o,dy:l},d={strides:r,pad:i,dataFormat:s,dimRoundingMode:a,filterShape:n};return iD.runKernel(ti,h,d)}}),l7=iH({relu6_:function(e){let t={x:iG(e,"x","relu6")};return iD.runKernel(nF,t)}}),l9=iH({step_:function(e,t=0){let n={x:iG(e,"x","step")},r={alpha:t};return iD.runKernel(rf,n,r)}});function ue(e,t,n){if(null==n||"linear"===n)return e;if("relu"===n)return s8(e,l9(t));throw Error(`Cannot compute gradient for fused activation ${n}.`)}function ut(e,t){let n=t,r=ab(e.shape,t.shape);return r.length>0&&(n=o8(n,r)),ox(n,e.shape)}function un(e,t,n,r){if("linear"===t)return e;if("relu"===t)return lN(e);if("elu"===t)return oq(e);if("relu6"===t)return l7(e);if("prelu"===t)return lT(e,n);if("leakyrelu"===t)return o3(e,r);if("sigmoid"===t)return lD(e);throw Error(`Unknown fused activation ${t}.`)}let ur=(e,t)=>!(e>0)||"linear"===t,ui=iH({fusedConv2d_:function({x:e,filter:t,strides:n,pad:r,dataFormat:i="NHWC",dilations:s=[1,1],dimRoundingMode:a,bias:o,activation:l="linear",preluActivationWeights:u,leakyreluAlpha:c}){let h,d;if(l=l||"linear",!1===ur(iD.state.gradientDepth,l)){j("NHWC"===i,()=>`Error in fused conv2d: got dataFormat of ${i} but only NHWC is currently supported for the case of gradient depth is 0 and the activation is not linear.`);let h=oM(e,t,n,r,i,s,a);return null!=o&&(h=s4(h,o)),un(h,l,u,c)}let p=iG(e,"x","conv2d","float32"),f=iG(t,"filter","conv2d","float32"),g=p,m=!1;3===p.rank&&(m=!0,g=ox(p,[1,p.shape[0],p.shape[1],p.shape[2]])),j(4===g.rank,()=>`Error in fused conv2d: input must be rank 4, but got rank ${g.rank}.`),j(4===f.rank,()=>`Error in fused conv2d: filter must be rank 4, but got rank ${f.rank}.`),o_("fused conv2d",r,a);let y="NHWC"===i?g.shape[3]:g.shape[1];j(f.shape[2]===y,()=>`Error in conv2d: depth of input (${y}) must match input depth for filter ${f.shape[2]}.`),j(ob(n,s),()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${n} and dilations '${s}'`);let b=oa(g.shape,f.shape,n,s,r,a);if(null!=o&&(h=iG(o,"bias","fused conv2d"),[h]=iI(h,p),"NHWC"===i?av(b.outShape,h.shape):(j(h.shape.length<=1,()=>`Error in fused conv2d: only supports scalar or 1-D Tensor bias for NCHW format but got the bias of rank-${h.shape.length}.`),j(0===h.shape.length||h.shape[0]===b.outChannels||1===h.shape[0],()=>`Error in fused conv2d: bias shape (${h.shape}) is not compatible with the number of output channels (${b.outChannels})`))),null!=u){let e=u.shape;if(j(e.length<=1||3===e.length,()=>`Error in fused conv2d: only supports scalar, 1-D Tensor or 3-D Tensor PReLU activation weights but got a tensor of rank-${e.length}.`),1===e.length)j(1===e[0]||e[0]===b.outChannels,()=>`Error in fused conv2d: PReLU activation weights (${e}) is not compatible with the number of output channels (${b.outChannels}).`);else if(3===e.length)try{av(e,b.outShape)}catch(t){throw Error(`Error in fused conv2d: PReLU activation weights (${e}) is not compatible with the output shape of the conv2d (${b.outShape}).`)}d=iG(u,"prelu weights","fused conv2d")}let v=(e,t)=>{j("NHWC"===i,()=>`Error in gradient of fused conv2D: got dataFormat of ${i} but only NHWC is currently supported.`);let[a,o,u,c]=t,h=ue(e,u,l);j(oy(s),()=>`Error in gradient of fused conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${s}'`);let d=[oz(o.shape,h,a,n,r),l8(o,h,a.shape,n,r)];if(null!=c){let e=ut(c,h);d.push(e)}return d},w={x:g,filter:f,bias:h,preluActivationWeights:d},_={strides:n,pad:r,dataFormat:i,dilations:s,dimRoundingMode:a,activation:l,leakyreluAlpha:c};return null==o?an((e,t,n)=>{let r=iD.runKernel(rb,w,_);return n([t,e,r]),m&&(r=ox(r,[r.shape[1],r.shape[2],r.shape[3]])),{value:r,gradFunc:v}})(g,f):an((e,t,n,r)=>{let i=iD.runKernel(rb,w,_);return r([t,e,i,n]),m&&(i=ox(i,[i.shape[1],i.shape[2],i.shape[3]])),{value:i,gradFunc:v}})(g,f,h)}}),us=iH({depthwiseConv2dNativeBackpropFilter_:function(e,t,n,r,i,s=[1,1],a){let o=e;3===e.rank&&(o=ox(e,[1,e.shape[0],e.shape[1],e.shape[2]]));let l=t;3===l.rank&&(l=ox(t,[1,t.shape[0],t.shape[1],t.shape[2]]));let u={x:o,dy:l},c={strides:r,pad:i,dimRoundingMode:a,dilations:s,filterShape:n};return iD.runKernel(ty,u,c)}}),ua=iH({depthwiseConv2dNativeBackpropInput_:function(e,t,n,r,i,s=[1,1],a){let o=t,l=!1;3===t.rank&&(l=!0,o=ox(t,[1,t.shape[0],t.shape[1],t.shape[2]]));let u={dy:o,filter:n},c={strides:r,pad:i,dimRoundingMode:a,dilations:s,inputShape:e},h=iD.runKernel(tb,u,c);return l?ox(h,[h.shape[1],h.shape[2],h.shape[3]]):h}}),uo=iH({fusedMatMul_:function({a:e,b:t,transposeA:n=!1,transposeB:r=!1,bias:i,activation:s="linear",preluActivationWeights:a,leakyreluAlpha:o=.2}){let l,u;if(!1===ur(iD.state.gradientDepth,s)){let l=lu(e,t,n,r);return null!=i&&(l=s4(l,i)),un(l,s,a,o)}let c=iG(e,"a","fused matMul"),h=iG(t,"b","fused matMul");[c,h]=iI(c,h);let d=n?c.shape[c.rank-2]:c.shape[c.rank-1],p=r?h.shape[h.rank-1]:h.shape[h.rank-2],f=n?c.shape[c.rank-1]:c.shape[c.rank-2],g=r?h.shape[h.rank-2]:h.shape[h.rank-1],m=c.shape.slice(0,-2),y=h.shape.slice(0,-2),b=q(m),v=q(y);j(d===p,()=>`Error in fused matMul: inner shapes (${d}) and (${p}) of Tensors with shapes ${c.shape} and ${h.shape} and transposeA=${n} and transposeB=${r} must match.`);let w=av(c.shape.slice(0,-2),h.shape.slice(0,-2)).concat([f,g]),_=n?ox(c,[b,d,f]):ox(c,[b,f,d]),x=r?ox(h,[v,g,p]):ox(h,[v,p,g]);null!=i&&(l=iG(i,"bias","fused matMul"),[l]=iI(l,c),av(w,l.shape)),null!=a&&(u=iG(a,"prelu weights","fused matMul"));let T=(e,t)=>{let a,o;let[l,u,c,h]=t,d=ue(ox(e,c.shape),c,s);return(n||r?!n&&r?(a=lu(d,u,!1,!1),o=lu(d,l,!0,!1)):n&&!r?(a=lu(u,d,!1,!0),o=lu(l,d,!1,!1)):(a=lu(u,d,!0,!0),o=lu(d,l,!0,!0)):(a=lu(d,u,!1,!0),o=lu(l,d,!0,!1)),null!=i)?[a,o,ut(h,d)]:[a,o]},I={a:_,b:x,bias:l,preluActivationWeights:u},k={transposeA:n,transposeB:r,activation:s,leakyreluAlpha:o};return null==i?an((e,t,n)=>{let r=iD.runKernel(ry,I,k);return n([e,t,r]),{value:ox(r,w),gradFunc:T}})(_,x):an((e,t,n,r)=>{let i=iD.runKernel(ry,I,k);return r([e,t,i,n]),{value:ox(i,w),gradFunc:T}})(_,x,l)}}),ul=iH({cropAndResize_:function(e,t,n,r,i="bilinear",s=0){let a=iG(e,"image","cropAndResize"),o=iG(t,"boxes","cropAndResize","float32"),l=iG(n,"boxInd","cropAndResize","int32"),u=o.shape[0];j(4===a.rank,()=>`Error in cropAndResize: image must be rank 4,but got rank ${a.rank}.`),j(2===o.rank&&4===o.shape[1],()=>`Error in cropAndResize: boxes must be have size [${u},4] but had shape ${o.shape}.`),j(1===l.rank&&l.shape[0]===u,()=>`Error in cropAndResize: boxInd must be have size [${u}] but had shape ${o.shape}.`),j(2===r.length,()=>`Error in cropAndResize: cropSize must be of length 2, but got length ${r.length}.`),j(r[0]>=1&&r[1]>=1,()=>`cropSize must be atleast [1,1], but was ${r}`),j("bilinear"===i||"nearest"===i,()=>`method must be bilinear or nearest, but was ${i}`);let c={image:a,boxes:o,boxInd:l},h={method:i,extrapolationValue:s,cropSize:r};return iD.runKernel(tp,c,h)}}),uu=iH({flipLeftRight_:function(e){let t=iG(e,"image","flipLeftRight","float32");j(4===t.rank,()=>`Error in flipLeftRight: image must be rank 4,but got rank ${t.rank}.`);let n={image:t};return iD.runKernel(tF,n,{})}}),uc=iH({grayscaleToRGB_:function(e){let t=iG(e,"image","grayscaleToRGB"),n=t.rank-1,r=t.shape[n];j(t.rank>=2,()=>`Error in grayscaleToRGB: images must be at least rank 2, but got rank ${t.rank}.`),j(1===r,()=>`Error in grayscaleToRGB: last dimension of a grayscale image should be size 1, but got size ${r}.`);let i=Array(t.rank);return i.fill(1,0,n),i[n]=3,oQ(t,i)}}),uh=iH({einsum_:function(e,...t){let n=t.map((e,t)=>iG(e,`tensors${t}`,"einsum")),r={equation:e};return iD.runKernel(tk,n,r)}}),ud=iH({rgbToGrayscale_:function(e){let t;let n=iG(e,"image","RGBToGrayscale"),r=n.rank-1,i=n.shape[r];j(n.rank>=2,()=>`Error in RGBToGrayscale: images must be at least rank 2, but got rank ${n.rank}.`),j(3===i,()=>`Error in RGBToGrayscale: last dimension of an RGB image should be size 3, but got size ${i}.`);let s=n.dtype,a=s1(n,"float32"),o=lq([.2989,.587,.114]);switch(n.rank){case 2:t=uh("ij,j->i",a,o);break;case 3:t=uh("ijk,k->ij",a,o);break;case 4:t=uh("ijkl,l->ijk",a,o);break;case 5:t=uh("ijklm,m->ijkl",a,o);break;case 6:t=uh("ijklmn,n->ijklm",a,o);break;default:throw Error("Not a valid tensor rank.")}return s1(t=oY(t,-1),s)}}),up=iH({rotateWithOffset_:function(e,t,n=0,r=.5){let i=iG(e,"image","rotateWithOffset","float32");j(4===i.rank,()=>`Error in rotateWithOffset: image must be rank 4,but got rank ${i.rank}.`);let s={image:i},a={radians:t,fillValue:n,center:r};return iD.runKernel(rm,s,a)}});function uf(e,t,n,r,i,s){null==r&&(r=.5),null==i&&(i=Number.NEGATIVE_INFINITY),null==s&&(s=0);let a=e.shape[0];return n=Math.min(n,a),j(0<=r&&r<=1,()=>`iouThreshold must be in [0, 1], but was '${r}'`),j(2===e.rank,()=>`boxes must be a 2D tensor, but was of rank '${e.rank}'`),j(4===e.shape[1],()=>`boxes must have 4 columns, but 2nd dimension was ${e.shape[1]}`),j(1===t.rank,()=>"scores must be a 1D tensor"),j(t.shape[0]===a,()=>`scores has incompatible shape with boxes. Expected ${a}, but was ${t.shape[0]}`),j(0<=s&&s<=1,()=>`softNmsSigma must be in [0, 1], but was '${s}'`),{maxOutputSize:n,iouThreshold:r,scoreThreshold:i,softNmsSigma:s}}let ug=iH({nonMaxSuppression_:function(e,t,n,r=.5,i=Number.NEGATIVE_INFINITY){let s=iG(e,"boxes","nonMaxSuppression","float32"),a=iG(t,"scores","nonMaxSuppression","float32"),o=uf(s,a,n,r,i),l={maxOutputSize:n=o.maxOutputSize,iouThreshold:r=o.iouThreshold,scoreThreshold:i=o.scoreThreshold};return iD.runKernel(np,{boxes:s,scores:a},l)}});function um(e,t,n){let r=uy(e,t,n),i=r<0?-(r+1):r;e.splice(i,0,t)}function uy(e,t,n){return uv(e,t,n||ub)}function ub(e,t){return e>t?1:e<t?-1:0}function uv(e,t,n){let r=0,i=e.length,s=0,a=!1;for(;r<i;){let o=n(t,e[s=r+(i-r>>>1)]);o>0?r=s+1:(i=s,a=!o)}return a?r:-r-1}function uw(e,t,n,r,i){return uT(e,t,n,r,i,0)}function u_(e,t,n,r,i,s){return uT(e,t,n,r,i,0,!1,s,!0)}function ux(e,t,n,r,i,s){return uT(e,t,n,r,i,s,!0)}function uT(e,t,n,r,i,s,a=!1,o=!1,l=!1){let u=[];for(let e=0;e<t.length;e++)t[e]>i&&u.push({score:t[e],boxIndex:e,suppressBeginIndex:0});u.sort(uS);let c=s>0?-.5/s:0,h=[],d=[];for(;h.length<n&&u.length>0;){let t=u.pop(),{score:n,boxIndex:s,suppressBeginIndex:a}=t;if(n<i)break;let o=!1;for(let n=h.length-1;n>=a;--n){let a=uI(e,s,h[n]);if(a>=r){o=!0;break}if(t.score=t.score*uk(r,c,a),t.score<=i)break}t.suppressBeginIndex=h.length,!o&&(t.score===n?(h.push(s),d.push(t.score)):t.score>i&&um(u,t,uS))}let p=h.length,f=n-p;o&&f>0&&(h.push(...Array(f).fill(0)),d.push(...Array(f).fill(0)));let g={selectedIndices:h};return a&&(g.selectedScores=d),l&&(g.validOutputs=p),g}function uI(e,t,n){let r=e.subarray(4*t,4*t+4),i=e.subarray(4*n,4*n+4),s=Math.min(r[0],r[2]),a=Math.min(r[1],r[3]),o=Math.max(r[0],r[2]),l=Math.max(r[1],r[3]),u=Math.min(i[0],i[2]),c=Math.min(i[1],i[3]),h=Math.max(i[0],i[2]),d=Math.max(i[1],i[3]),p=(o-s)*(l-a),f=(h-u)*(d-c);if(p<=0||f<=0)return 0;let g=Math.max(Math.min(o,h)-Math.max(s,u),0)*Math.max(Math.min(l,d)-Math.max(a,c),0);return g/(p+f-g)}function uk(e,t,n){let r=Math.exp(t*n*n);return n<=e?r:0}function uS(e,t){return e.score-t.score||e.score===t.score&&t.boxIndex-e.boxIndex}let uE=async function(e,t,n,r=.5,i=Number.NEGATIVE_INFINITY){let s=iG(e,"boxes","nonMaxSuppressionAsync"),a=iG(t,"scores","nonMaxSuppressionAsync"),o=uf(s,a,n,r,i);n=o.maxOutputSize,r=o.iouThreshold,i=o.scoreThreshold;let l=await Promise.all([s.data(),a.data()]),{selectedIndices:u}=uw(l[0],l[1],n,r,i);return s!==e&&s.dispose(),a!==t&&a.dispose(),lq(u,"int32")},uC=iH({nonMaxSuppressionWithScore_:function(e,t,n,r=.5,i=Number.NEGATIVE_INFINITY,s=0){let a=iG(e,"boxes","nonMaxSuppression"),o=iG(t,"scores","nonMaxSuppression"),l=uf(a,o,n,r,i,s);n=l.maxOutputSize,r=l.iouThreshold;let u={boxes:a,scores:o},c={maxOutputSize:n,iouThreshold:r,scoreThreshold:i=l.scoreThreshold,softNmsSigma:s=l.softNmsSigma},h=iD.runKernel(ng,u,c);return{selectedIndices:h[0],selectedScores:h[1]}}}),uA=async function(e,t,n,r=.5,i=Number.NEGATIVE_INFINITY,s=0){let a=iG(e,"boxes","nonMaxSuppressionAsync"),o=iG(t,"scores","nonMaxSuppressionAsync"),l=uf(a,o,n,r,i,s);n=l.maxOutputSize,r=l.iouThreshold,i=l.scoreThreshold,s=l.softNmsSigma;let u=await Promise.all([a.data(),o.data()]),{selectedIndices:c,selectedScores:h}=ux(u[0],u[1],n,r,i,s);return a!==e&&a.dispose(),o!==t&&o.dispose(),{selectedIndices:lq(c,"int32"),selectedScores:lq(h)}},uN=iH({nonMaxSuppressionPadded_:function(e,t,n,r=.5,i=Number.NEGATIVE_INFINITY,s=!1){let a=iG(e,"boxes","nonMaxSuppression"),o=iG(t,"scores","nonMaxSuppression"),l=uf(a,o,n,r,i,null),u=l.maxOutputSize,c=l.iouThreshold,h=l.scoreThreshold,d={boxes:a,scores:o},p={maxOutputSize:u,iouThreshold:c,scoreThreshold:h,padToMaxOutputSize:s},f=iD.runKernel(nf,d,p);return{selectedIndices:f[0],validOutputs:f[1]}}}),uO=async function(e,t,n,r=.5,i=Number.NEGATIVE_INFINITY,s=!1){let a=iG(e,"boxes","nonMaxSuppressionAsync"),o=iG(t,"scores","nonMaxSuppressionAsync"),l=uf(a,o,n,r,i,null),u=l.maxOutputSize,c=l.iouThreshold,h=l.scoreThreshold,[d,p]=await Promise.all([a.data(),o.data()]),{selectedIndices:f,validOutputs:g}=u_(d,p,u,c,h,s);return a!==e&&a.dispose(),o!==t&&o.dispose(),{selectedIndices:lq(f,"int32"),validOutputs:ar(g,"int32")}},u$=iH({resizeBilinear_:function(e,t,n=!1,r=!1){let i=iG(e,"images","resizeBilinear");j(3===i.rank||4===i.rank,()=>`Error in resizeBilinear: x must be rank 3 or 4, but got rank ${i.rank}.`),j(2===t.length,()=>`Error in resizeBilinear: new shape must 2D, but got shape ${t}.`),j(!1===r||!1===n,()=>"Error in resizeBilinear: If halfPixelCenters is true, alignCorners must be false.");let s=i,a=!1;3===i.rank&&(a=!0,s=ox(i,[1,i.shape[0],i.shape[1],i.shape[2]]));let[]=t,o={images:s},l={alignCorners:n,halfPixelCenters:r,size:t},u=iD.runKernel(nR,o,l);return a?ox(u,[u.shape[1],u.shape[2],u.shape[3]]):u}}),uR=iH({resizeNearestNeighbor_:function(e,t,n=!1,r=!1){let i=iG(e,"images","resizeNearestNeighbor");j(3===i.rank||4===i.rank,()=>`Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank ${i.rank}.`),j(2===t.length,()=>`Error in resizeNearestNeighbor: new shape must 2D, but got shape ${t}.`),j("float32"===i.dtype||"int32"===i.dtype,()=>"`images` must have `int32` or `float32` as dtype"),j(!1===r||!1===n,()=>"Error in resizeNearestNeighbor: If halfPixelCenters is true, alignCorners must be false.");let s=i,a=!1;3===i.rank&&(a=!0,s=ox(i,[1,i.shape[0],i.shape[1],i.shape[2]]));let[]=t,o={images:s},l={alignCorners:n,halfPixelCenters:r,size:t},u=iD.runKernel(nO,o,l);return a?ox(u,[u.shape[1],u.shape[2],u.shape[3]]):u}}),uD=iH({bincount_:function(e,t,n){let r=iG(e,"x","bincount"),i=iG(t,"weights","bincount");j("int32"===r.dtype,()=>`Error in bincount: input dtype must be int32, but got ${r.dtype}`),j(n>=0,()=>`size must be non-negative, but got ${n}.`),j(i.size===r.size||0===i.size,()=>`Error in bincount: weights must have the same size as input or0-length, but got input shape: ${r.shape}, weights shape: ${i.shape}.`);let s={x:r,weights:i},a={size:n};return iD.runKernel(e3,s,a)}}),uF=iH({lessEqual_:function(e,t){let n=iG(e,"a","lessEqual","string_or_numeric"),r=iG(t,"b","lessEqual","string_or_numeric");[n,r]=iI(n,r),av(n.shape,r.shape);let i={a:n,b:r};return iD.runKernel(tQ,i)}}),uP=iH({round_:function(e){let t={x:iG(e,"x","round")};return iD.runKernel(nM,t)}});function uM(e,t){let n,r,i,s,a,o,l=lq([-1]),u=lq([0]),c=lq([0]);for(let h=0;h<e.size-1;h++){n=lF(e,0,h+1),r=lF(e,h+1),a=s5(o8(n),t),o=s5(o8(r),t),i=s5(o8(s8(n,lA(0,n.size))),o8(n));let d=ah(r.shape,n.size),p=s4(lA(0,r.size),d),f=af(i,s=s5(o8(s8(r,p)),o8(r))),g=af(i,s),m=s8(a,o),y=o1(c=s8(s8(m,f),g),u);u=lQ(y,c,u),l=lQ(y,lq([h]),l)}return l}let uL=iH({threshold_:function(e,t="binary",n=!1,r=.5){let i,s,a,o;let l=iG(e,"image","threshold"),u=.2989,c=.587,h=.114,d=l.shape[0]*l.shape[1],p=s8(lq([r]),255);if(j(3===l.rank,()=>`Error in threshold: image must be rank 3,but got rank ${l.rank}.`),j(3===l.shape[2]||1===l.shape[2],()=>`Error in threshold: image color channel must be equal to 3 or 1but got ${l.shape[2]}.`),j("int32"===l.dtype||"float32"===l.dtype,()=>`Error in dtype: image dtype must be int32 or float32,but got dtype ${l.dtype}.`),j("otsu"===t||"binary"===t,()=>`Method must be binary or otsu, but was ${t}`),3===l.shape[2]){[i,s,a]=lV(l,[1,1,1],-1);let e=s8(i,u),t=s8(s,c),n=s8(a,h);o=s4(s4(e,t),n)}else o=e;return"otsu"===t&&(p=uM(uD(s1(uP(o),"int32"),iY([]),256),d)),s1(s8(n?uF(o,p):o1(o,p),255),"int32")}}),uz=iH({transform_:function(e,t,n="nearest",r="constant",i=0,s){let a=iG(e,"image","transform","float32"),o=iG(t,"transforms","transform","float32");j(4===a.rank,()=>`Error in transform: image must be rank 4,but got rank ${a.rank}.`),j(2===o.rank&&(o.shape[0]===a.shape[0]||1===o.shape[0])&&8===o.shape[1],()=>"Error in transform: Input transform should be batch x 8 or 1 x 8"),j(null==s||2===s.length,()=>`Error in transform: outputShape must be [height, width] or null, but got ${s}.`);let l={image:a,transforms:o},u={interpolation:n,fillMode:r,fillValue:i,outputShape:s};return iD.runKernel(rl,l,u)}}),uB=iH({less_:function(e,t){let n=iG(e,"a","less","string_or_numeric"),r=iG(t,"b","less","string_or_numeric");[n,r]=iI(n,r),av(n.shape,r.shape);let i={a:n,b:r};return iD.runKernel(tY,i)}});function uU(e,t,n=null){if(0===e.rank)return am(e);if(1!==e.rank&&null===n)return uU(ox(e,[-1]),t,n);if(1===e.rank||"number"==typeof n||Array.isArray(n)&&1===n.length){if(1===t)return o8(am(e),n);if(t===1/0)return o5(am(e),n);if(t===-1/0)return lp(am(e),n);if("euclidean"===t||2===t)return s7(o8(ap(am(e),ar(2,"int32")),n));throw Error(`Error in norm: invalid ord value: ${t}`)}if(Array.isArray(n)&&2===n.length){if(1===t)return o5(o8(am(e),n[0]),n[1]-1);if(t===1/0)return o5(o8(am(e),n[1]),n[0]);if(t===-1/0)return lp(o8(am(e),n[1]),n[0]);if("fro"===t||"euclidean"===t)return s7(o8(s9(e),n));throw Error(`Error in norm: invalid ord value: ${t}`)}throw Error(`Error in norm: invalid axis: ${n}`)}let uV=iH({norm_:function(e,t="euclidean",n=null,r=!1){let i=uU(e=iG(e,"x","norm"),t,n),s=i.shape;if(r){let t=Z(n,e.shape);s=ln(i.shape,t)}return ox(i,s)}});function uj(e,t=!1){return iD.tidy(()=>{j(2===e.shape.length,()=>`qr2d() requires a 2D Tensor, but got a ${e.shape.length}D Tensor.`);let n=e.shape[0],r=e.shape[1],i=oJ(n),s=s2(e),a=lH([[1]],[1,1]),o=s2(a),l=n>=r?r:n;for(let e=0;e<l;++e){let t=s,l=o,u=i;[o,s,i]=iD.tidy(()=>{let t=lF(s,[e,e],[n-e,1]),l=uV(t),u=lF(s,[e,e],[1,1]),c=lQ(o1(u,0),lH([[-1]]),lH([[1]])),h=af(u,s8(c,l)),d=s5(t,h);o=1===d.shape[0]?s2(a):o$([a,lF(d,[1,0],[d.shape[0]-1,d.shape[1]])],0);let p=lm(s5(lu(c,h),l)),f=lF(s,[e,0],[n-e,r]),g=s8(p,o),m=l0(o);if(0===e)s=af(f,lu(g,lu(m,f)));else{let t=af(f,lu(g,lu(m,f)));s=o$([lF(s,[0,0],[e,r]),t],0)}let y=l0(g),b=lF(i,[0,e],[n,i.shape[1]-e]);if(0===e)i=af(b,lu(lu(b,o),y));else{let t=af(b,lu(lu(b,o),y));i=o$([lF(i,[0,0],[n,e]),t],1)}return[o,s,i]}),i3([t,l,u])}return!t&&n>r&&(i=lF(i,[0,0],[n,r]),s=lF(s,[0,0],[r,r])),[i,s]})}let uG=iH({qr_:function(e,t=!1){if(j(e.rank>=2,()=>`qr() requires input tensor to have a rank >= 2, but got rank ${e.rank}`),2===e.rank)return uj(e,t);{let n=e.shape.slice(0,e.shape.length-2).reduce((e,t)=>e*t),r=lX(ox(e,[n,e.shape[e.shape.length-2],e.shape[e.shape.length-1]]),0),i=[],s=[];return r.forEach(e=>{let[n,r]=uj(e,t);i.push(n),s.push(r)}),[ox(lG(i,0),e.shape),ox(lG(s,0),e.shape)]}}});!function(e){e[e.NONE=0]="NONE",e[e.MEAN=1]="MEAN",e[e.SUM=2]="SUM",e[e.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"}(v||(v={}));let uW=iH({squaredDifference_:function(e,t){let n=iG(e,"a","squaredDifference"),r=iG(t,"b","squaredDifference");[n,r]=iI(n,r),av(n.shape,r.shape);let i={a:n,b:r},s={};return iD.runKernel(n5,i,s)}}),uq={flipLeftRight:uu,grayscaleToRGB:uc,resizeNearestNeighbor:uR,resizeBilinear:u$,rgbToGrayscale:ud,rotateWithOffset:up,cropAndResize:ul,nonMaxSuppression:ug,nonMaxSuppressionAsync:uE,nonMaxSuppressionWithScore:uC,nonMaxSuppressionWithScoreAsync:uA,nonMaxSuppressionPadded:uN,nonMaxSuppressionPaddedAsync:uO,threshold:uL,transform:uz},uH={qr:uG};class uK{static sgd(e){return new ax(e)}static momentum(e,t,n=!1){return new aT(e,t,n)}static rmsprop(e,t=.9,n=0,r=null,i=!1){return new aI(e,t,n,r,i)}static adam(e=.001,t=.9,n=.999,r=null){return new ag(e,t,n,r)}static adadelta(e=.001,t=.95,n=null){return new ac(e,t,n)}static adamax(e=.002,t=.9,n=.999,r=null,i=0){return new a_(e,t,n,r,i)}static adagrad(e,t=.1){return new ad(e,t)}}let uX=uK,uY="undefined"!=typeof requestAnimationFrame?requestAnimationFrame:"undefined"!=typeof setImmediate?setImmediate:e=>e();function uQ(){return new Promise(e=>uY(()=>e()))}function uJ(e,t){let n=e[0].length;e.forEach((e,t)=>{j(e.length===n,()=>`Error in concat${n}D: rank of tensors[${t}] must be the same as the rank of the rest (${n})`)}),j(t>=0&&t<n,()=>`Error in concat${n}D: axis must be between 0 and ${n-1}.`);let r=e[0];e.forEach((e,i)=>{for(let s=0;s<n;s++)j(s===t||e[s]===r[s],()=>`Error in concat${n}D: Shape of tensors[${i}] (${e}) does not match the shape of the rest (${r}) along the non-concatenated axis ${i}.`)})}function uZ(e,t){let n=e[0].slice();for(let r=1;r<e.length;r++)n[t]+=e[r][t];return n}function u0(e,t,n){let r=[];if(null==n&&null==t)return r;if(null==t)for(;r.length<e+n.length;)r.push(-1);else r=t.slice();if(null==n)return r;if(e+n.length!==r.length)throw Error(`rt input.shape and shape=${t} are incompatible: rt input.rank = ${e+n.length}, but shape.rank = ${r.length}`);for(let i=1;i<n.length;++i){let s=n[i],a=r[r.length-n.length+i],o=r[a];if(s>=0){if(o>=0){if(o!==s)throw Error(`rt input.shape and shape=${t} are incompatible: rt input.shape[${i+e}] = ${s} but shape[${i+e}] = ${o}`)}else r[a]=s}}return r}function u1(e){let t={FIRST_DIM_SIZE:w.FIRST_DIM_SIZE,VALUE_ROWIDS:w.VALUE_ROWIDS,ROW_LENGTHS:w.ROW_LENGTHS,ROW_SPLITS:w.ROW_SPLITS,ROW_LIMITS:w.ROW_LIMITS,ROW_STARTS:w.ROW_STARTS},n=[];for(let r of e)if(r in t)n.push(t[r]);else break;return n}function u2(e){return 0===e.length?0:e[0]===w.FIRST_DIM_SIZE?e.length-1:e.length}function u3(e,t){if(null==e||null==t)return;let n=e.length,r=t.length;if(n>=r)throw Error(`defaultValue.shape=${e} and ragged tensor flatValues.shape=${t}, are incompatible: defaultValue.rank = ${n} must be less than ragged tensor input flatValues.rank = ${r})`);for(let i=0;i<Math.min(n,r-1);++i){let n=e[i],r=t[i+1];if(n>=0&&r>=0&&1!==n&&n!==r)throw Error(`defaultValue.shape=${e}, and ragged tensor input flatValues.shape=${t} are incompatible: defaultValue.shape[${i-e.length}] = ${n} but ragged tensor input.flatValues.shape[${i-e.length}] = ${r}`)}}!function(e){e[e.FIRST_DIM_SIZE=0]="FIRST_DIM_SIZE",e[e.VALUE_ROWIDS=1]="VALUE_ROWIDS",e[e.ROW_LENGTHS=2]="ROW_LENGTHS",e[e.ROW_SPLITS=3]="ROW_SPLITS",e[e.ROW_LIMITS=4]="ROW_LIMITS",e[e.ROW_STARTS=5]="ROW_STARTS"}(w||(w={}));let u4=30;function u6(e){return e<=u4?e:ep(e,Math.floor(Math.sqrt(e)))}function u5(e,t,n){return[n*("number"==typeof e?e:e[0]),t*("number"==typeof e?e:e[1])]}function u8(e,t,n,r=!0){let i=[];if(r)(i=i.concat(t.slice(0))).push(e[0]/n),i=i.concat(e.slice(1));else{i=i.concat(e[0]);let n=t.length;for(let r=0;r<n;++r)i=i.concat([e[r+1]/t[r],t[r]]);i=i.concat(e.slice(n+1))}return i}function u7(e,t,n=!0){let r=[];if(n){r.push(t);for(let n=t+1;n<e;++n)n<=2*t?(r.push(n),r.push(n-(t+1))):r.push(n)}else{let n=[],i=[];for(let r=1;r<e;++r)r>=2*t+1||r%2==1?i.push(r):n.push(r);r.push(...n),r.push(0),r.push(...i)}return r}function u9(e,t,n,r=!0){let i=[];r?i.push(e[0]/n):i.push(e[0]*n);for(let n=1;n<e.length;++n)n<=t.length?r?i.push(t[n-1]*e[n]):i.push(e[n]/t[n-1]):i.push(e[n]);return i}function ce(e,t){let n=[0];for(let r=0;r<t;++r)n.push(e[r][0]);return n}function ct(e,t,n){let r=e.slice(0,1);for(let i=0;i<n;++i)r.push(e[i+1]-t[i][0]-t[i][1]);return r}function cn(e,t){let n=e.shape.length,r=t.shape.length;if(n<1)throw Error(`tf.gatherND() expects the input to be rank 1 or higher, but the rank was ${n}.`);if(r<1)throw Error(`tf.gatherND() expects the indices to be rank 1 or higher, but the rank was ${r}.`);if("int32"!==t.dtype)throw Error(`tf.gatherND() expects the indices to be int32 type, but the dtype was ${t.dtype}.`);if(t.shape[r-1]>n)throw Error(`index innermost dimension length must be <= tensor rank; saw: ${t.shape[r-1]} vs. ${n}`);if(0===q(e.shape))throw Error(`Requested more than 0 entries, but input is empty. Input shape: ${e.shape}.`);let i=t.shape,s=i[i.length-1],a=1;for(let e=0;e<i.length-1;++e)a*=i[e];let o=e.shape,l=i.slice();l.pop();let u=1;for(let e=s;e<n;++e)u*=o[e],l.push(o[e]);let c=[...ef(e.shape).map(e=>e/u),1].slice(0,s);return[l,a,u,c]}function cr(e,t,n){let r=t.rank>1?t.shape[t.rank-1]:1,i=t.rank>1?t.rank-1:1,s=`Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: ${n.shape}, indices.shape: ${t.shape}, shape: ${e}, sliceDim: ${r}, and batchDim: ${i}.`;if(n.rank<i)throw Error(s+` update.rank < ${i}. `);if(e.length<r+(n.rank-i))throw Error(s+` Output shape length < ${r+(n.rank-i)}`);if(n.rank!==i+e.length-r)throw Error(s+` update.rank != ${i+e.length-r}`);for(let e=0;e<i;++e)if(n.shape[e]!==t.shape[e])throw Error(s+` updates.shape[${e}] (${n.shape[e]}) != indices.shape[${e}] (${t.shape[e]}).`);for(let t=0;t<n.rank-i;++t)if(n.shape[t+i]!==e[t+r])throw Error(s+` updates.shape[${t+i}] (${n.shape[t+i]}) != shape[${t+i}] (${e[t+i]})`)}function ci(e,t,n){if(t.rank<1)throw Error(`tf.scatterND() expects the indices to be rank 1 or higher, but the rank was ${t.rank}.`);if(e.rank<1)throw Error(`tf.scatterND() expects the updates to be rank 1 or higher, but the rank was ${e.rank}.`);if("int32"!==t.dtype)throw Error(`The dtype of 'indices' should be int32, but got dtype: ${t.dtype}`);if(n.length<1)throw Error(`Output rank must be greater or equal to 1, but got shape: ${n}`);if(0===n.length){if(0===t.size)throw Error(`Indices specified for empty output. indices shape: ${t.shape}`);if(0===e.size)throw Error(`Updates specified for empty output. updates shape: ${e.shape}`)}cr(n,t,e)}function cs(e,t,n){let r=t.shape.length,i=r>1?t.shape[r-1]:1,s=n.length,a=1;for(let e=i;e<s;++e)a*=n[e];let o=i<1?1:i,l=q(t.shape)/o,u=[...ef(n.slice(0,i)),1];return{sliceRank:i,numUpdates:l,sliceSize:a,strides:u,outputSize:q(n)}}let ca=1.7580993408473768,co=1.0507009873554805,cl=.3275911,cu=.254829592,cc=-.284496736,ch=1.421413741,cd=-1.453152027,cp=1.061405429;function cf(e,t){if(e.length!==t.length)throw Error(`Cannot merge real and imag arrays of different lengths. real:${e.length}, imag: ${t.length}.`);let n=new Float32Array(2*e.length);for(let r=0;r<n.length;r+=2)n[r]=e[r/2],n[r+1]=t[r/2];return n}function cg(e){let t=new Float32Array(e.length/2),n=new Float32Array(e.length/2);for(let r=0;r<e.length;r+=2)t[r/2]=e[r],n[r/2]=e[r+1];return{real:t,imag:n}}function cm(e){let t=Math.ceil(e.length/4),n=new Float32Array(t),r=new Float32Array(t);for(let t=0;t<e.length;t+=4)n[Math.floor(t/4)]=e[t],r[Math.floor(t/4)]=e[t+1];return{real:n,imag:r}}function cy(e){let t=Math.floor(e.length/4),n=new Float32Array(t),r=new Float32Array(t);for(let t=2;t<e.length;t+=4)n[Math.floor(t/4)]=e[t],r[Math.floor(t/4)]=e[t+1];return{real:n,imag:r}}function cb(e,t){return{real:e[2*t],imag:e[2*t+1]}}function cv(e,t,n,r){e[2*r]=t,e[2*r+1]=n}function cw(e,t){let n=new Float32Array(e/2),r=new Float32Array(e/2);for(let i=0;i<Math.ceil(e/2);i++){let s=(t?2:-2)*Math.PI*(i/e);n[i]=Math.cos(s),r[i]=Math.sin(s)}return{real:n,imag:r}}function c_(e,t,n){let r=(n?2:-2)*Math.PI*(e/t);return{real:Math.cos(r),imag:Math.sin(r)}}let cx="->",cT=/->/g,cI=",",ck="...";function cS(e,t){let n=((e=e.replace(/\s/g,"")).length-e.replace(cT,"").length)/cx.length;if(n<1)throw Error("Equations without an arrow are not supported.");if(n>1)throw Error(`Equation must contain exactly one arrow ("${cx}").`);let[r,i]=e.split(cx);j(-1===r.indexOf(ck),()=>`The ellipsis notation ("${ck}") is not supported yet.`);let s=r.split(cI),a=s.length;if(t!==a)throw Error(`Expected ${a} input tensors, received ${t}`);if(a>2)throw Error("Support for more than 2 input tensors is not implemented yet.");let o=[];for(let e=0;e<i.length;++e){let t=i[e];if(!s.some(e=>-1!==e.indexOf(t)))throw Error(`Output subscripts contain the label ${t} not present in the input subscripts.`);-1===o.indexOf(t)&&o.push(t)}for(let e=0;e<r.length;++e){let t=r[e];-1===o.indexOf(t)&&t!==cI&&o.push(t)}let l=Array(s.length);for(let e=0;e<a;++e){if(new Set(s[e].split("")).size!==s[e].length)throw Error(`Found duplicate axes in input component ${s[e]}. Support for duplicate axes in input is not implemented yet.`);l[e]=[];for(let t=0;t<s[e].length;++t)l[e].push(o.indexOf(s[e][t]))}let u=o.length,c=i.length,h=[];for(let e=c;e<u;++e)h.push(e);return{allDims:o,summedDims:h,idDims:l}}function cE(e,t){let n=Array(e);n.fill(-1);for(let e=0;e<t.length;++e)n[t[e]]=e;let r=[];for(let t=0;t<e;++t)-1===n[t]&&r.push(t);return{permutationIndices:n=n.filter(e=>-1!==e),expandDims:r}}function cC(e,t,n){let r=Array(e);for(let e=0;e<n.length;++e){let i=n[e].shape;for(let n=0;n<t[e].length;++n)void 0===r[t[e][n]]?r[t[e][n]]=i[n]:j(r[t[e][n]]===i[n],()=>`Expected dimension ${r[t[e][n]]} at axis ${n} of input shaped ${JSON.stringify(i)}, but got dimension ${i[n]}`)}}function cA(e,t){let n=e,r=[],i=0;0===e.length&&n.push(-1),i=e.length+1;for(let e=0;e<i;++e)r.push([]);let s=[];for(let e=0;e<n.length;++e)for(let i of cO(t,n[e]))-1===s.indexOf(i)&&(r[e].push(i),s.push(i));return{path:n,steps:r}}function cN(e){return e.every((e,t)=>e===t)}function cO(e,t){let n=[];for(let r=0;r<e.length;++r)(0===e[r].length||-1!==e[r].indexOf(t)||-1===t)&&n.push(r);return n}function c$(e,t,n=0){let r=[];if("number"==typeof t)j(e.shape[n]%t==0,()=>"Number of splits must evenly divide the axis."),r=Array(t).fill(e.shape[n]/t);else{j(1>=t.reduce((e,t)=>(-1===t&&(e+=1),e),0),()=>"There should be only one negative value in split array.");let i=t.indexOf(-1);if(-1!==i){let r=t.reduce((e,t)=>t>0?e+t:e);t[i]=e.shape[n]-r}j(e.shape[n]===t.reduce((e,t)=>e+t),()=>"The sum of sizes must match the size of the axis dimension."),r=t}return r}function cR(e){return`Received SparseTensor with denseShape[0] = 0 but
  indices.shape[0] = ${e}`}function cD(e,t){return`indices(${e}, 0) is invalid: ${t} < 0`}function cF(e,t,n){return`indices(${e}, 0) is invalid: ${t} >= ${n}`}function cP(e,t){return`only one output dimension may be -1, not both ${e} and ${t}`}function cM(e,t){return`size ${e} must be non-negative, not ${t}`}function cL(){return"reshape cannot infer the missing input size for an empty tensor unless all specified input sizes are non-zero"}function cz(e,t){let n=q(e),r=q(t);return`Input to reshape is a SparseTensor with ${n}
  dense values, but the requested shape requires a multiple of ${r}. inputShape=${e} outputShape= ${t}`}function cB(e,t){let n=q(e),r=q(t);return`Input to reshape is a tensor with ${n} dense values, but the requested shape has ${r}. inputShape=${e} outputShape=${t}`}function cU(){return"segment ids must be >= 0"}function cV(){return"segment ids are not increasing"}function cj(e,t){return`Segment id ${e} out of range [0, ${t}), possibly because segmentIds input is not sorted.`}function cG(e,t,n){return`Bad: indices[${e}] == ${t} out of range [0, ${n})`}function cW(e,t){let n,r=!1;for(e<=u4?(n=e,r=!0):n=ep(e,Math.floor(Math.sqrt(e)));!r;)n>t||n===e?r=!0:n=ep(e,n+1);return n}function cq(e,t,n){let r=[],i=e.length;for(let s=0;s<i;s++)s!==t?r.push(e[s]):r.push(n);return r}function cH(e,t,n,r){let i=t.shape.length,s=e.shape.length;if(0!==r&&(r<-i||r>i))throw Error(`Expect batchDims in the range of [-${i}, ${i}], but got ${r}`);if(r<0&&(r+=i),r>s)throw Error(`batchDims (${r}) must be less than rank(x) (
    ${s}).`);if(n<r)throw Error(`batchDims (${r}) must be less than or equal to axis (${n}).`);for(let n=0;n<r;++n)if(e.shape[n]!==t.shape[n])throw Error(`x.shape[${n}]: ${e.shape[n]} should be equal to indices.shape[${n}]: ${t.shape[n]}.`);let a=e.shape[n],o=[],l=1,u=1,c=1;for(let t=0;t<r;++t)o.push(e.shape[t]),l*=e.shape[t];for(let t=r;t<n;t++)o.push(e.shape[t]),u*=e.shape[t];for(let e=r;e<i;e++)o.push(t.shape[e]);for(let t=n+1;t<s;t++)o.push(e.shape[t]),c*=e.shape[t];return{batchSize:l,sliceSize:c,outerSize:u,dimSize:a,outputShape:o}}function cK(e){try{return e.map(e=>r0(e))}catch(e){throw Error(`Failed to decode encoded string bytes into utf-8, error: ${e}`)}}function cX(e){return e.map(e=>rZ(e))}function cY(e,t){let n=[];for(let e=0;e<t.length;e++)t[e]&&n.push(e);let r=s0(e,"int32"),i=s0([n.length,e.length],"int32");for(let t=0;t<n.length;t++){let s=r.indexToLoc(n[t]),a=t*e.length;i.values.set(s,a)}return i.toTensor()}aS();let cQ={kernelName:eM,inputsToSave:["x"],gradFunc:(e,t)=>{let[n]=t;return{x:()=>s8(e,l9(s1(n,"float32"),-1))}}},cJ={kernelName:eL,inputsToSave:["x"],gradFunc:(e,t)=>{let[n]=t;return{x:()=>{let t=s9(s1(n,"float32"));return lm(s5(e,s7(af(ar(1),t))))}}}},cZ={kernelName:ez,inputsToSave:["x"],gradFunc:(e,t)=>{let[n]=t;return{x:()=>s5(e,s7(af(s9(s1(n,"float32")),1)))}}},c0={kernelName:eB,inputsToSave:["a","b"],gradFunc:(e,t)=>{let[n,r]=t,i=av(n.shape,r.shape);return{a:()=>{let t=e,r=ab(n.shape,i);return r.length>0&&(t=o8(t,r)),ox(t,n.shape)},b:()=>{let t=e,n=ab(r.shape,i);return n.length>0&&(t=o8(t,n)),ox(t,r.shape)}}}},c1={kernelName:eU,saveAllInputs:!0,gradFunc:(e,t)=>{let n={};return t.forEach((t,r)=>{n[r]=()=>e.clone()}),n}},c2={kernelName:eG,inputsToSave:["x"],gradFunc:(e,t)=>{let[n]=t;return{x:()=>ae(n)}}},c3={kernelName:eW,inputsToSave:["x"],gradFunc:(e,t)=>{let[n]=t;return{x:()=>ae(n)}}},c4={kernelName:eq,inputsToSave:["x"],gradFunc:(e,t)=>{let[n]=t;return{x:()=>s5(e,s7(af(ar(1),s9(s1(n,"float32")))))}}},c6={kernelName:eH,inputsToSave:["x"],gradFunc:(e,t)=>{let[n]=t;return{x:()=>s5(e,s7(s4(ar(1),s9(s1(n,"float32")))))}}},c5={kernelName:eY,inputsToSave:["a","b"],gradFunc:(e,t)=>{let[n,r]=t,i=av(n.shape,r.shape);return{a:()=>{let t=s4(s9(n),s9(r)),s=s8(e,s5(r,t)),a=ab(n.shape,i);return a.length>0&&(s=o8(s,a)),ox(s,n.shape)},b:()=>{let t=s4(s9(n),s9(r)),s=lm(s8(e,s5(n,t))),a=ab(r.shape,i);return a.length>0&&(s=o8(s,a)),ox(s,r.shape)}}}},c8={kernelName:eK,inputsToSave:["x"],gradFunc:(e,t)=>{let[n]=t;return{x:()=>s5(e,s4(s9(s1(n,"float32")),1))}}},c7={kernelName:eX,inputsToSave:["x"],gradFunc:(e,t)=>{let[n]=t;return{x:()=>s5(e,af(ar(1),s9(s1(n,"float32"))))}}},c9=iH({avgPool3dGrad_:function(e,t,n,r,i,s){let a=iG(e,"dy","avgPool3dGrad"),o=iG(t,"input","avgPool3dGrad"),l=a,u=o,c=!1;4===o.rank&&(c=!0,l=ox(a,[1,a.shape[0],a.shape[1],a.shape[2],a.shape[3]]),u=ox(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),j(5===l.rank,()=>`Error in avgPool3dGrad: dy must be rank 5 but got rank ${l.rank}.`),j(5===u.rank,()=>`Error in avgPool3dGrad: input must be rank 5 but got rank ${u.rank}.`),o_("avgPool3dGrad",i,s);let h={dy:l,input:u},d={filterSize:n,strides:r,pad:i,dimRoundingMode:s},p=iD.runKernel(e0,h,d);return c?ox(p,[p.shape[1],p.shape[2],p.shape[3],p.shape[4]]):p}}),he={kernelName:eZ,inputsToSave:["x"],gradFunc:(e,t,n)=>{let[r]=t,{filterSize:i,strides:s,pad:a,dimRoundingMode:o}=n;return{x:()=>c9(e,r,i,s,a,o)}}},ht=iH({avgPoolGrad_:function(e,t,n,r,i){let s=iG(e,"dy","avgPoolGrad"),a=iG(t,"input","avgPoolGrad");j(a.rank===s.rank,()=>`Rank of input (${a.rank}) does not match rank of dy (${s.rank})`);let o=a,l=s,u=!1;3===a.rank&&(u=!0,o=ox(a,[1,a.shape[0],a.shape[1],a.shape[2]]),l=ox(s,[1,s.shape[0],s.shape[1],s.shape[2]])),j(4===l.rank,()=>`Error in avgPoolGrad: dy must be rank 4 but got rank ${l.rank}.`),j(4===o.rank,()=>`Error in avgPoolGrad: input must be rank 4 but got rank ${o.rank}.`);let c={dy:l,input:o},h={filterSize:n,strides:r,pad:i},d=iD.runKernel(eJ,c,h);return u?ox(d,[d.shape[1],d.shape[2],d.shape[3]]):d}}),hn={kernelName:eQ,inputsToSave:["x"],gradFunc:(e,t,n)=>{let[r]=t,{filterSize:i,strides:s,pad:a}=n;return{x:()=>ht(e,r,i,s,a)}}},hr={kernelName:e1,inputsToSave:["a","b"],gradFunc:(e,t,n)=>{let[r,i]=t,{transposeA:s,transposeB:a}=n;return s||a?!s&&a?{a:()=>lu(e,i,!1,!1),b:()=>lu(e,r,!0,!1)}:s&&!a?{a:()=>lu(i,e,!1,!0),b:()=>lu(r,e,!1,!1)}:{a:()=>lu(i,e,!0,!0),b:()=>lu(e,r,!0,!0)}:{a:()=>lu(e,i,!1,!0),b:()=>lu(r,e,!0,!1)}}},hi=iH({spaceToBatchND_:function(e,t,n){let r=iG(e,"x","spaceToBatchND");j(r.rank>=1+t.length,()=>`input rank ${r.rank} should be > than [blockShape] ${t.length}`),j(n.length===t.length,()=>`paddings.shape[0] ${n.length} must be equal to [blockShape] ${t.length}`),j(r.shape.reduce((e,r,i)=>i>0&&i<=t.length?e&&(r+n[i-1][0]+n[i-1][1])%t[i-1]==0:e,!0),()=>`input spatial dimensions ${r.shape.slice(1)} with paddings ${n.toString()} must be divisible by blockShapes ${t.toString()}`);let i={x:r},s={blockShape:t,paddings:n};return iD.runKernel(nJ,i,s)}}),hs={kernelName:e2,gradFunc:(e,t,n)=>{let{blockShape:r,crops:i}=n;return{x:()=>hi(e,r,i)}}},ha={kernelName:e6,gradFunc:(e,t,n)=>{let r=n,i=r.inputShape,s=r.shape,a=Array.from(s);for(let e=i.length-1;e>=0;e--)if(i[e]===s[e])a[e]=1;else if(1!==i[e])throw Error(`broadcastTo(): [${i}] cannot be broadcast to [${s}].`);let o=[];for(let e=0;e<a.length;e++)a[e]>1&&o.push(e);return{x:()=>o8(e,o,!0)}}},ho={kernelName:e8,gradFunc:e=>({x:()=>e.clone()})},hl={kernelName:e7,gradFunc:e=>({x:()=>ae(e)})},hu={kernelName:e9,inputsToSave:["x"],gradFunc:(e,t,n)=>{let[r]=t,{clipValueMin:i,clipValueMax:s}=n;return{x:()=>lQ(ll(o2(r,i),uF(r,s)),e,ae(e))}}},hc={kernelName:tt,inputsToSave:["x"],gradFunc:cQ.gradFunc},hh={kernelName:tn,saveAllInputs:!0,gradFunc:(e,t,n)=>{let r=t.map(e=>e.shape),{axis:i}=n,s=Z(i,t[0].shape)[0];return lV(e,r.map(e=>e[s]),s).map(e=>()=>e)}},hd={kernelName:tr,inputsToSave:["x","filter"],gradFunc:(e,t,n)=>{let[r,i]=t,{dilations:s,strides:a,pad:o,dataFormat:l}=n;return j(oy(s),()=>`Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${s}'`),{x:()=>oz(r.shape,e,i,a,o,l),filter:()=>l8(r,e,i.shape,a,o,l)}}},hp={kernelName:ts,inputsToSave:["dy","filter"],gradFunc:(e,t,n)=>{let[r,i]=t,{strides:s,pad:a,dataFormat:o,dimRoundingMode:l}=n;return{dy:()=>oM(e,i,s,a,o,1,l),filter:()=>l8(e,r,i.shape,s,a,o,l)}}},hf=iH({conv3DBackpropFilter_:function(e,t,n,r,i){let s=e;4===e.rank&&(s=ox(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]]));let a=t;4===a.rank&&(a=ox(t,[1,t.shape[0],t.shape[1],t.shape[2],t.shape[3]])),j(5===s.rank,()=>`Error in conv3dDerFilter: input must be rank 5, but got shape ${s.shape}.`),j(5===a.rank,()=>`Error in conv3dDerFilter: dy must be rank 5, but got shape ${a.shape}.`),j(5===n.length,()=>`Error in conv3dDerFilter: filterShape must be length 5, but got ${n}.`),j(s.shape[4]===n[3],()=>`Error in conv3dDerFilter: depth of input ${s.shape[4]}) must match input depth in filter (${n[3]}.`),j(a.shape[4]===n[4],()=>`Error in conv3dDerFilter: depth of dy (${a.shape[4]}) must match output depth for filter (${n[4]}).`);let o={x:s,dy:a},l={strides:r,pad:i,filterShape:n};return iD.runKernel(to,o,l)}}),hg={kernelName:ta,inputsToSave:["x","filter"],gradFunc:(e,t,n)=>{let{dilations:r,strides:i,pad:s}=n;j(oy(r),()=>`Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${r}'`);let[a,o]=t;return{x:()=>oV(a.shape,e,o,i,s),filter:()=>hf(a,e,o.shape,i,s)}}},hm=iH({sin_:function(e){let t={x:iG(e,"x","sin","float32")};return iD.runKernel(nW,t)}}),hy={kernelName:tu,inputsToSave:["x"],gradFunc:(e,t)=>{let[n]=t;return{x:()=>s8(lm(hm(s1(n,"float32"))),e)}}},hb=iH({sinh_:function(e){let t={x:iG(e,"x","sinh")};return iD.runKernel(nq,t)}}),hv={kernelName:tc,inputsToSave:["x"],gradFunc:(e,t)=>{let[n]=t;return{x:()=>s8(hb(s1(n,"float32")),e)}}},hw=iH({cumsum_:function(e,t=0,n=!1,r=!1){let i={x:iG(e,"x","cumsum")},s={axis:t,exclusive:n,reverse:r};return iD.runKernel(td,i,s)}}),h_={kernelName:td,inputsToSave:["x"],gradFunc:(e,t,n)=>{let[r]=t,{axis:i,exclusive:s,reverse:a}=n;return{x:()=>{let t=li([i],r.rank),n=hw(e,i,s,!a);return null!=t&&(n=l0(n,t)),n}}}},hx={kernelName:tm,inputsToSave:["x","filter"],gradFunc:(e,t,n)=>{let{dilations:r,strides:i,pad:s,dimRoundingMode:a}=n,o=null==r?[1,1]:r;j(oy(o),()=>`Error in gradient of depthwiseConv2dNative: dilation rates greater than 1 are not yet supported. Got dilations '${o}'`);let[l,u]=t;return j(4===l.rank,()=>`Error in gradient of depthwiseConv2dNative: input must be rank 4, but got rank ${l.rank}.`),j(4===u.rank,()=>`Error in gradient of depthwiseConv2dNative: filter must be rank 4, but got rank ${u.rank}.`),j(l.shape[3]===u.shape[2],()=>`Error in gradient of depthwiseConv2d: number of input channels (${l.shape[3]}) must match the inChannels dimension in filter ${u.shape[2]}.`),j(ob(i,o),()=>`Error in gradient of depthwiseConv2d: Either strides or dilations must be  1. Got strides ${i} and dilations '${o}'.`),o_("depthwiseConv2d",s,a),{x:()=>ua(l.shape,e,u,i,s,o,a),filter:()=>us(l,e,u.shape,i,s,o,a)}}},hT={kernelName:tw,inputsToSave:["x","filter"],gradFunc:(e,t,n)=>{let[r,i]=t,s={x:r,filter:i,dy:e},a={x:r,filter:i,dy:e};return{x:()=>iD.runKernel(t_,s,n),filter:()=>iD.runKernel(tx,a,n)}}},hI={kernelName:tS,outputsToSave:[!0],gradFunc:(e,t)=>{let[n]=t,r={dy:e,y:n};return{x:()=>iD.runKernel(tE,r)}}},hk={kernelName:tC,inputsToSave:["x"],gradFunc:(e,t)=>{let[n]=t,r=s8(oX(lm(s9(n))),2/Math.sqrt(Math.PI));return{x:()=>s8(e,r)}}},hS={kernelName:tN,outputsToSave:[!0],gradFunc:(e,t)=>{let[n]=t;return{x:()=>s8(e,n)}}},hE={kernelName:tO,inputsToSave:["input"],gradFunc:(e,t)=>{let[n]=t;return{input:()=>ox(e,n.shape)}}},hC={kernelName:t$,inputsToSave:["x"],gradFunc:(e,t)=>{let[n]=t;return{x:()=>s8(e,oX(n))}}},hA={kernelName:tP,gradFunc:e=>({x:()=>ae(e)})},hN={kernelName:tM,inputsToSave:["a","b"],gradFunc:(e,t)=>{let[n,r]=t,i=av(n.shape,r.shape);return{a:()=>{let t=s5(e,s1(r,"float32")),s=ab(n.shape,i);return s.length>0?ox(o8(t,s),n.shape):t},b:()=>{let t=s8(e,s1(n,"float32")),s=ab(r.shape,i);return s.length>0&&(t=ox(o8(t,s),r.shape)),lm(s5(t,s1(s9(r),"float32")))}}}},hO=iH({rsqrt_:function(e){let t={x:iG(e,"x","rsqrt","float32")};return iD.runKernel(nL,t)}}),h$={kernelName:tL,inputsToSave:["x","mean","variance","scale"],gradFunc:(e,t,n)=>{let{varianceEpsilon:r}=n,[i,s,a,o]=t,l=null==o?ar(1):o,u=ab(s.shape,i.shape),c=[];if(1===s.rank){for(let e=0;e<i.shape.length-1;++e)c.push(i.shape[e]);c.push(1)}let h=af(i,s),d=s8(e,l),p=hO(s4(a,ar(r))),f=s8(s8(s8(p,p),p),ar(-.5));return{x:()=>1===s.rank?ox(s8(s8(e,oQ(ox(p,[1,1,1,s.shape[0]]),c)),l),i.shape):ox(s8(s8(e,p),l),i.shape),mean:()=>{let e=s8(s8(p,ar(-1)),d);return 1===s.rank&&(e=o8(e,u)),ox(e,s.shape)},variance:()=>{let e=s8(s8(f,h),d);return 1===s.rank&&(e=o8(e,u)),ox(e,s.shape)},scale:()=>{let t=s8(h,p),n=s8(e,t);return 1===s.rank&&(n=o8(n,u)),ox(n,s.shape)},offset:()=>{let t=e;return 1===s.rank&&(t=o8(t,u)),ox(t,s.shape)}}}},hR=iH({unsortedSegmentSum_:function(e,t,n){let r=iG(e,"x","unsortedSegmentSum"),i=iG(t,"segmentIds","unsortedSegmentSum","int32");j(K(n),()=>"numSegments must be of dtype int");let s={x:r,segmentIds:i},a={numSegments:n};return iD.runKernel(rd,s,a)}}),hD={kernelName:tz,inputsToSave:["x","indices"],gradFunc:(e,t,n)=>{let[r,i]=t,{axis:s,batchDims:a}=n,o=Z(s,r.shape)[0],l=(e,t,n)=>()=>{let r=e.shape,i=t.size,a=r.slice(0,o),l=a.length,u=r.slice(s,r.length).slice(1),c=u.length,h=hF(0,l),d=hF(l+1,l+1+c),p=ox(n,hP([a,[i],u])),f=ox(t,[i]),g=hP([[l],h,d]),m=hR(l0(p,g),f,e.shape[o]);return l0(m,ls(g))};if(1!==a)return{x:l(r,i,e),indices:()=>i};{let t=r.shape[0],n=r.split(t,0);return{x:()=>lG(n.map((t,n)=>l(t,i.slice(n,1),e.slice(n,1))())).reshape(r.shape),indices:()=>i}}}};function hF(e,t){let n=[];for(let r=e;r<t;++r)n.push(r);return n}function hP(e){let t=[];for(let n=0;n<e.length;++n)for(let r=0;r<e[n].length;++r)t.push(e[n][r]);return t}let hM={kernelName:tV,inputsToSave:["a","b"],gradFunc:(e,t)=>{let[n,r]=t;return{a:()=>ae(n),b:()=>ae(r)}}},hL={kernelName:tj,gradFunc:e=>({x:()=>s1(e,"float32")})},hz={kernelName:tq,gradFunc:e=>({x:()=>ae(e)})},hB={kernelName:tH,gradFunc:e=>({x:()=>ae(e)})},hU={kernelName:tK,gradFunc:e=>({x:()=>ae(e)})},hV={kernelName:tX,inputsToSave:["x"],gradFunc:(e,t,n)=>{let[r]=t,{alpha:i}=n,s=o1(r,0);return{x:()=>lQ(s,e,s8(e,i))}}},hj={kernelName:t0,inputsToSave:["x"],gradFunc:(e,t)=>{let[n]=t;return{x:()=>s5(e,s4(n,1))}}},hG={kernelName:tZ,inputsToSave:["x"],gradFunc:(e,t)=>{let[n]=t;return{x:()=>s5(e,s1(n,"float32"))}}},hW={kernelName:t4,inputsToSave:[],outputsToSave:[!0],gradFunc:(e,t,n)=>{let[r]=t,{axis:i}=n;return{logits:()=>{let t=!0,n=oX(r);return af(e,s8(o8(e,i,t),n))}}}},hq=iH({localResponseNormalizationBackprop_:function(e,t,n,r=5,i=1,s=1,a=.5){let o={x:e,y:t,dy:n},l={depthRadius:r,bias:i,alpha:s,beta:a};return iD.runKernel(t5,o,l)}}),hH={kernelName:t6,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(e,t,n)=>{let[r,i]=t,{depthRadius:s,bias:a,alpha:o,beta:l}=n;return{x:()=>hq(r,i,e,s,a,o,l)}}};function hK(e,t,n,r){return t.rank<n.rank&&(t=ox(t,ln(t.shape,r))),e.rank<n.rank&&(e=ox(e,ln(e.shape,r))),{x:()=>s8(e,s1(oH(n,t),e.dtype))}}let hX={kernelName:t8,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(e,t,n)=>{let{reductionIndices:r}=n,i=t[0],s=t[1],a=Z(r,i.shape),o=hK(e,s,i,a);return{x:()=>o.x()}}},hY={kernelName:t7,inputsToSave:["a","b"],gradFunc:(e,t)=>{let[n,r]=t;return{a:()=>s8(e,s1(o2(n,r),"float32")),b:()=>s8(e,s1(uB(n,r),"float32"))}}},hQ=iH({maxPool3dGrad_:function(e,t,n,r,i,s,a){let o=iG(e,"dy","maxPool3dGrad"),l=iG(t,"input","maxPool3dGrad"),u=iG(n,"output","maxPool3dGrad"),c=o,h=l,d=u,p=!1;4===l.rank&&(p=!0,c=ox(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]]),h=ox(l,[1,l.shape[0],l.shape[1],l.shape[2],l.shape[3]]),d=ox(u,[1,u.shape[0],u.shape[1],u.shape[2],u.shape[3]])),j(5===c.rank,()=>`Error in maxPool3dGrad: dy must be rank 5 but got rank ${c.rank}.`),j(5===h.rank,()=>`Error in maxPool3dGrad: input must be rank 5 but got rank ${h.rank}.`),j(5===d.rank,()=>`Error in maxPool3dGrad: output must be rank 5 but got rank ${d.rank}.`),o_("maxPool3dGrad",s,a);let f={dy:c,input:h,output:d},g={filterSize:r,strides:i,pad:s,dimRoundingMode:a},m=iD.runKernel(nn,f,g);return p?ox(m,[m.shape[1],m.shape[2],m.shape[3],m.shape[4]]):m}}),hJ={kernelName:nt,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(e,t,n)=>{let[r,i]=t,{filterSize:s,strides:a,pad:o,dimRoundingMode:l}=n;return{x:()=>hQ(e,r,i,s,a,o,l)}}},hZ=iH({maxPoolGrad_:function(e,t,n,r,i,s,a){let o=iG(e,"dy","maxPoolGrad"),l=iG(t,"input","maxPoolGrad"),u=iG(n,"output","maxPoolGrad");j(l.rank===o.rank,()=>`Rank of input (${l.rank}) does not match rank of dy (${o.rank})`),j(4===o.rank,()=>`Error in maxPoolGrad: dy must be rank 4 but got rank ${o.rank}.`),j(4===l.rank,()=>`Error in maxPoolGrad: input must be rank 4 but got rank ${l.rank}.`),o_("maxPoolGrad",s,a);let c={dy:o,input:l,output:u},h={filterSize:r,strides:i,pad:s,dimRoundingMode:a};return iD.runKernel(ne,c,h)}}),h0={kernelName:t9,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(e,t,n)=>{let[r,i]=t,{filterSize:s,strides:a,pad:o}=n;return{x:()=>hZ(e,r,i,s,a,o)}}},h1={kernelName:ni,inputsToSave:["x"],gradFunc:(e,t,n)=>{let[r]=t,{axis:i}=n,s=Z(i,r.shape),a=q(lt(r.shape,s)[1]);return{x:()=>{let t=r.shape.slice();return s.forEach(e=>{t[e]=1}),s5(s8(ox(e,t),lw(r.shape,"float32")),a)}}}},h2={kernelName:ns,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(e,t,n)=>{let{axis:r}=n,[i,s]=t,a=Z(r,i.shape),o=hK(e,s,i,a);return{x:()=>o.x()}}},h3={kernelName:na,inputsToSave:["a","b"],gradFunc:(e,t)=>{let[n,r]=t;return{a:()=>s8(e,s1(uF(n,r),"float32")),b:()=>s8(e,s1(o1(n,r),"float32"))}}},h4={kernelName:no,inputsToSave:["x"],gradFunc:(e,t,n)=>{let r=t[0],{paddings:i}=n,s=i.map(e=>e[0]);return{x:()=>lF(e,s,r.shape)}}},h6={kernelName:nl,inputsToSave:["a","b"],gradFunc:(e,t)=>{let[n,r]=t,i=av(n.shape,r.shape);return{a:()=>{let t=ab(n.shape,i);return t.length>0?ox(o8(e,t),n.shape):e},b:()=>{let t=s8(e,lm(oZ(s5(n,r)))),s=ab(r.shape,i);return s.length>0?ox(o8(t,s),r.shape):t}}}},h5={kernelName:nc,inputsToSave:["a","b"],gradFunc:(e,t)=>{let[n,r]=t,i=av(n.shape,r.shape);return{a:()=>{let t=s8(e,s1(r,"float32")),s=ab(n.shape,i);return s.length>0?ox(o8(t,s),n.shape):t},b:()=>{let t=s8(e,s1(n,"float32")),s=ab(r.shape,i);return s.length>0?ox(o8(t,s),r.shape):t}}}},h8={kernelName:nh,gradFunc:e=>({x:()=>lm(e)})},h7={kernelName:ny,inputsToSave:["indices"],gradFunc:(e,t)=>{let n=t[0];return{indices:()=>lv(n.shape,"float32")}}},h9={kernelName:nm,gradFunc:e=>({x:()=>ae(e)})},de={kernelName:nb,saveAllInputs:!0,gradFunc:(e,t,n)=>{let{axis:r}=n;return lX(e,r).map(e=>()=>e)}},dt={kernelName:nv,inputsToSave:["x"],gradFunc:(e,t,n)=>{let r=t[0],{paddings:i}=n,s=i.map(e=>e[0]);return{x:()=>lF(e,s,r.shape)}}},dn={kernelName:nw,inputsToSave:["a","b"],outputsToSave:[!0],gradFunc:(e,t)=>{let[n,r,i]=t,s=n,a=r,o=av(s.shape,a.shape);return{a:()=>{let t=s1(a,"float32"),n=s8(e,s8(t,ap(s,af(t,ar(1))))),r=ab(s.shape,o);return r.length>0&&(n=o8(n,r)),ox(n,s.shape)},b:()=>{let t=s8(e,s8(i,lQ(o1(s,0),o4(s),ae(s)))),n=ab(a.shape,o);return n.length>0&&(t=o8(t,n)),ox(t,a.shape)}}}},dr={kernelName:n_,inputsToSave:["x","alpha"],gradFunc:(e,t)=>{let[n,r]=t,i=o1(n,0);return{x:()=>lQ(i,e,s8(e,r)),alpha:()=>{let t=lQ(i,ae(e),s8(e,n)),s=ab(r.shape,e.shape);return s.length>0&&(t=o8(t,s)),ox(t,r.shape)}}}},di=iH({cumprod_:function(e,t=0,n=!1,r=!1){let i={x:iG(e,"x","cumprod")},s={axis:t,exclusive:n,reverse:r};return iD.runKernel(th,i,s)}});function ds(e,t,n){let r=e.shape.slice();r[n]=1;let i=ox(t,r),s=s8(di(e,n,!0,!1),di(e,n,!0,!0));return s8(i,s)}function da(e,t,n){let r=e.shape.length,i=r-n.length,s=li(n,r),a=e;null!=s&&(a=l0(e,s));let o=a.shape.slice(),l=o.splice(r-n.length,n.length).reduce((e,t)=>e*t,1);o.push(l);let u=ds(a.reshape(o),t,i);return u=u.reshape(a.shape),null!=s&&(u=l0(u,ls(s))),u}let dl={kernelName:nx,inputsToSave:["x"],gradFunc:(e,t,n)=>{let[r]=t,{axis:i}=n,s=[];return s=null==i?r.shape.map((e,t)=>t):"number"==typeof i?[i]:i,{x:()=>da(r,e,s)}}},du={kernelName:tI,inputsToSave:["a","b"],gradFunc:(e,t)=>{let[n,r]=t,i=av(n.shape,r.shape);return{a:()=>{let t=s5(e,s1(r,"float32")),s=ab(n.shape,i);return s.length>0?ox(o8(t,s),n.shape):t},b:()=>{let t=s8(e,s1(n,"float32")),s=ab(r.shape,i);return s.length>0&&(t=ox(o8(t,s),r.shape)),lm(s5(t,s1(s9(r),"float32")))}}}},dc={kernelName:nC,inputsToSave:["x"],gradFunc:(e,t)=>{let[n]=t;return{x:()=>s5(e,lm(s9(n)))}}},dh={kernelName:nF,inputsToSave:["x"],gradFunc:(e,t)=>{let[n]=t,r=s8(uF(n,6),l9(n));return{x:()=>s8(e,s1(r,"float32"))}}},dd={kernelName:nA,inputsToSave:["x"],gradFunc:(e,t)=>{let[n]=t;return{x:()=>s8(e,s1(l9(n),"float32"))}}},dp={kernelName:nN,inputsToSave:["x"],gradFunc:(e,t)=>{let[n]=t;return{x:()=>ox(e,n.shape)}}},df={kernelName:nR,inputsToSave:["images"],gradFunc:(e,t,n)=>{let[r]=t,i={dy:e,images:r};return{images:()=>iD.runKernel(nD,i,n)}}},dg={kernelName:nO,inputsToSave:["images"],gradFunc:(e,t,n)=>{let[r]=t,i={dy:e,images:r};return{images:()=>iD.runKernel(n$,i,n)}}},dm={kernelName:nP,gradFunc:(e,t,n)=>{let{dims:r}=n,i=Z(r,e.shape);return{x:()=>lO(e,i)}}},dy={kernelName:nM,gradFunc:e=>({x:()=>ae(e)})},db={kernelName:nL,inputsToSave:["x"],gradFunc:(e,t)=>{let[n]=t;return{x:()=>lm(s5(e,s8(ap(n,1.5),2)))}}},dv=iH({logicalNot_:function(e){let t={x:iG(e,"x","logicalNot","bool")};return iD.runKernel(t2,t)}}),dw={kernelName:nV,inputsToSave:["condition"],gradFunc:(e,t)=>{let[n]=t;return{condition:()=>s1(ae(n),"float32"),t:()=>s8(e,s1(n,e.dtype)),e:()=>s8(e,s1(dv(n),e.dtype))}}},d_={kernelName:nj,inputsToSave:["x"],gradFunc:(e,t)=>{let[n]=t;return{x:()=>{let t=o1(n,ar(0)),r=ar(ca);return lQ(t,s8(e,ar(co)),s8(s8(e,r),oX(s1(n,"float32"))))}}}},dx={kernelName:nK,outputsToSave:[!0],gradFunc:(e,t)=>{let[n]=t;return{x:()=>s8(e,s8(n,af(ar(1),n)))}}},dT={kernelName:nH,gradFunc:e=>({x:()=>ae(e)})},dI=iH({cos_:function(e){let t={x:iG(e,"x","cos","float32")};return iD.runKernel(tu,t)}}),dk={kernelName:nW,inputsToSave:["x"],gradFunc:(e,t)=>{let[n]=t;return{x:()=>s8(dI(s1(n,"float32")),e)}}},dS=iH({cosh_:function(e){let t={x:iG(e,"x","cosh","float32")};return iD.runKernel(tc,t)}}),dE={kernelName:nq,inputsToSave:["x"],gradFunc:(e,t)=>{let[n]=t;return{x:()=>s8(dS(s1(n,"float32")),e)}}},dC={kernelName:nG,inputsToSave:["x"],gradFunc:(e,t,n)=>{let[r]=t,{begin:i,size:s}=n,a=r.shape,[o,l]=a5(r,i,s),u=[];for(let t=0;t<e.rank;t++)u.push([o[t],a[t]-o[t]-l[t]]);return{x:()=>lx(e,u)}}},dA={kernelName:n0,outputsToSave:[!0],gradFunc:(e,t,n)=>{let[r]=t,{dim:i}=n,s=!0,a=s8(e,r);return{logits:()=>af(a,s8(o8(a,[i],s),r))}}},dN={kernelName:nX,inputsToSave:["x"],gradFunc:(e,t)=>{let[n]=t;return{x:()=>s8(e,lD(n))}}},dO=iH({batchToSpaceND_:function(e,t,n){let r=iG(e,"x","batchToSpaceND"),i=t.reduce((e,t)=>e*t);j(r.rank>=1+t.length,()=>`input rank is ${r.rank} but should be > than blockShape.length ${t.length}`),j(n.length===t.length,()=>`crops.length is ${n.length} but should be equal to blockShape.length  ${t.length}`),j(r.shape[0]%i==0,()=>`input tensor batch is ${r.shape[0]} but is not divisible by the product of the elements of blockShape ${t.join(" * ")} === ${i}`);let s={x:r},a={blockShape:t,crops:n};return iD.runKernel(e2,s,a)}}),d$={kernelName:nJ,gradFunc:(e,t,n)=>{let{blockShape:r,paddings:i}=n;return{x:()=>dO(e,r,i)}}},dR={kernelName:nZ,gradFunc:(e,t,n)=>{let{axis:r}=n;return{x:()=>o$(e,r)}}};function dD(e,t){let n=o0(e,aw(t,ae(t))),r=o2(t,ar(0,"int32")),i=n.rank-r.rank;for(let e=0;e<i;++e)r=oY(r,e+1);r=ll(r,lw(n.shape,"bool"));let s=ae(n);return lQ(r,n,s)}for(let e of[cQ,cJ,cZ,c0,c1,c2,c3,c4,c6,c5,c8,c7,he,hn,hr,hs,ha,ho,hl,hu,hc,hh,hp,hd,hg,hy,hv,h_,hx,hT,du,hI,hk,hS,hE,hC,hN,hA,h$,hD,hM,hL,hz,hB,hU,hV,hj,hG,hW,hH,hX,hX,hY,hJ,h0,h1,h2,h3,h4,h6,h5,h8,h7,h9,de,dt,dt,dn,dr,dl,dc,dh,dd,dp,df,dg,dm,dy,db,dw,d_,dx,dT,dk,dE,dC,dA,dN,d$,d$,dR,dR,{kernelName:nY,inputsToSave:["x"],gradFunc:(e,t)=>{let[n]=t;return{x:()=>s5(e,s8(s7(s1(n,"float32")),2))}}},{kernelName:n5,inputsToSave:["a","b"],gradFunc:(e,t)=>{let[n,r]=t,i=ar(2);return{a:()=>s8(e,s8(i,af(n,r))),b:()=>s8(e,s8(i,af(r,n)))}}},{kernelName:n8,inputsToSave:["x"],gradFunc:(e,t)=>{let[n]=t;return{x:()=>s8(e,s8(s1(n,"float32"),2))}}},{kernelName:rf,gradFunc:e=>({x:()=>ae(e)})},{kernelName:rr,inputsToSave:["a","b"],gradFunc:(e,t)=>{let[n,r]=t,i=av(n.shape,r.shape);return{a:()=>{let t=e,r=ab(n.shape,i);return r.length>0&&(t=o8(t,r)),ox(t,n.shape)},b:()=>{let t=e,n=ab(r.shape,i);return n.length>0&&(t=o8(t,n)),ox(lm(t),r.shape)}}}},{kernelName:nQ,inputsToSave:["x"],gradFunc:(e,t,n)=>{let[r]=t,i=r.shape.slice(),{axis:s}=n;Z(s,r.shape).forEach(e=>{i[e]=1});let a=s8(ox(e,i),lw(r.shape,"float32"));return{x:()=>a}}},{kernelName:ri,inputsToSave:["x"],gradFunc:(e,t)=>{let[n]=t;return{x:()=>s5(e,s9(dI(n)))}}},{kernelName:rs,outputsToSave:[!0],gradFunc:(e,t)=>{let[n]=t;return{x:()=>s8(af(ar(1),s9(n)),e)}}},{kernelName:ra,inputsToSave:["x"],gradFunc:(e,t,n)=>{let[r]=t,{reps:i}=n;return{x:()=>{let t=ae(r);if(1===r.rank)for(let n=0;n<i[0];++n)t=s4(t,lF(e,[n*r.shape[0]],[r.shape[0]]));else if(2===r.rank)for(let n=0;n<i[0];++n)for(let s=0;s<i[1];++s)t=s4(t,lF(e,[n*r.shape[0],s*r.shape[1]],[r.shape[0],r.shape[1]]));else if(3===r.rank)for(let n=0;n<i[0];++n)for(let s=0;s<i[1];++s)for(let a=0;a<i[2];++a)t=s4(t,lF(e,[n*r.shape[0],s*r.shape[1],a*r.shape[2]],[r.shape[0],r.shape[1],r.shape[2]]));else if(4===r.rank)for(let n=0;n<i[0];++n)for(let s=0;s<i[1];++s)for(let a=0;a<i[2];++a)for(let o=0;o<i[3];++o)t=s4(t,lF(e,[n*r.shape[0],s*r.shape[1],a*r.shape[2],o*r.shape[3]],[r.shape[0],r.shape[1],r.shape[2],r.shape[3]]));else throw Error(`Gradient for tile operation is not implemented for rank-${r.rank} tensors yet.`);return t}}}},{kernelName:ru,gradFunc:(e,t,n)=>{let{perm:r}=n,i=ls(r);return{x:()=>l0(e,i)}}},{kernelName:rh,gradFunc:(e,t,n)=>{let{axis:r}=n;return{value:()=>lG(e,r)}}},{kernelName:rd,inputsToSave:["segmentIds"],gradFunc:(e,t)=>{let[n]=t;return{x:()=>dD(e,n)}}},{kernelName:rp,gradFunc:e=>({x:()=>ae(e)})}])rC(e);iy().prototype.abs=function(){return this.throwIfDisposed(),am(this)};let dF=iH({acos_:function(e){let t={x:iG(e,"x","acos")};return iD.runKernel(eL,t)}});iy().prototype.acos=function(){return this.throwIfDisposed(),dF(this)};let dP=iH({acosh_:function(e){let t={x:iG(e,"x","acosh")};return iD.runKernel(ez,t)}});iy().prototype.acosh=function(){return this.throwIfDisposed(),dP(this)},iy().prototype.add=function(e){return this.throwIfDisposed(),s4(this,e)},iy().prototype.all=function(e,t){return this.throwIfDisposed(),oe(this,e,t)},iy().prototype.any=function(e,t){return this.throwIfDisposed(),ot(this,e,t)},iy().prototype.argMax=function(e){return this.throwIfDisposed(),on(this,e)};let dM=iH({argMin_:function(e,t=0){let n={x:iG(e,"x","argMin")},r={axis:t};return iD.runKernel(eW,n,r)}});iy().prototype.argMin=function(e){return this.throwIfDisposed(),dM(this,e)},iy().prototype.asScalar=function(){return this.throwIfDisposed(),j(1===this.size,()=>"The array must have only 1 element."),ox(this,[])},iy().prototype.asType=function(e){return this.throwIfDisposed(),s1(this,e)},iy().prototype.as1D=function(){return this.throwIfDisposed(),ox(this,[this.size])},iy().prototype.as2D=function(e,t){return this.throwIfDisposed(),ox(this,[e,t])},iy().prototype.as3D=function(e,t,n){return this.throwIfDisposed(),ox(this,[e,t,n])},iy().prototype.as4D=function(e,t,n,r){return this.throwIfDisposed(),ox(this,[e,t,n,r])},iy().prototype.as5D=function(e,t,n,r,i){return this.throwIfDisposed(),ox(this,[e,t,n,r,i])};let dL=iH({asin_:function(e){let t={x:iG(e,"x","asin")};return iD.runKernel(eq,t)}});iy().prototype.asin=function(){return this.throwIfDisposed(),dL(this)};let dz=iH({asinh_:function(e){let t={x:iG(e,"x","asinh")};return iD.runKernel(eH,t)}});iy().prototype.asinh=function(){return this.throwIfDisposed(),dz(this)};let dB=iH({atan_:function(e){let t={x:iG(e,"x","atan")};return iD.runKernel(eK,t)}});iy().prototype.atan=function(){return this.throwIfDisposed(),dB(this)};let dU=iH({atan2_:function(e,t){let n=iG(e,"a","atan2"),r=iG(t,"b","atan2");[n,r]=iI(n,r);let i={a:n,b:r};return iD.runKernel(eY,i)}});iy().prototype.atan2=function(e){return this.throwIfDisposed(),dU(this,e)};let dV=iH({atanh_:function(e){let t={x:iG(e,"x","atanh")};return iD.runKernel(eX,t)}});iy().prototype.atanh=function(){return this.throwIfDisposed(),dV(this)},iy().prototype.avgPool=function(e,t,n,r){return this.throwIfDisposed(),oT(this,e,t,n,r)},iy().prototype.batchToSpaceND=function(e,t){return this.throwIfDisposed(),dO(this,e,t)},iy().prototype.batchNorm=function(e,t,n,r,i){return this.throwIfDisposed(),oS(this,e,t,n,r,i)},iy().prototype.broadcastTo=function(e){return this.throwIfDisposed(),oN(this,e)},iy().prototype.cast=function(e){return this.throwIfDisposed(),s1(this,e)};let dj=iH({ceil_:function(e){let t={x:iG(e,"x","ceil","float32")};return iD.runKernel(e7,t)}});iy().prototype.ceil=function(){return this.throwIfDisposed(),dj(this)},iy().prototype.clipByValue=function(e,t){return this.throwIfDisposed(),oO(this,e,t)},iy().prototype.concat=function(e,t){return this.throwIfDisposed(),e instanceof im&&(e=[e]),o$([this,...e],t)},iy().prototype.conv1d=function(e,t,n,r,i,s){return this.throwIfDisposed(),oL(this,e,t,n,r,i,s)},iy().prototype.conv2dTranspose=function(e,t,n,r,i){return this.throwIfDisposed(),oB(this,e,t,n,r,i)},iy().prototype.conv2d=function(e,t,n,r,i,s){return this.throwIfDisposed(),oM(this,e,t,n,r,i,s)},iy().prototype.cos=function(){return this.throwIfDisposed(),dI(this)},iy().prototype.cosh=function(){return this.throwIfDisposed(),dS(this)},iy().prototype.cumprod=function(e,t,n){return this.throwIfDisposed(),di(this,e,t,n)},iy().prototype.cumsum=function(e,t,n){return this.throwIfDisposed(),hw(this,e,t,n)};let dG=iH({depthToSpace_:function(e,t,n="NHWC"){let r=iG(e,"x","depthToSpace","float32"),i="NHWC"===n?r.shape[1]:r.shape[2],s="NHWC"===n?r.shape[2]:r.shape[3],a="NHWC"===n?r.shape[3]:r.shape[1];j(t>1,()=>`blockSize should be > 1 for depthToSpace, but was: ${t}`),j(i*t>=0,()=>`Negative dimension size caused by overflow when multiplying
    ${i} and ${t}  for depthToSpace with input shape
    ${r.shape}`),j(s*t>=0,()=>`Negative dimension size caused by overflow when multiplying
    ${s} and ${t} for depthToSpace with input shape
        ${r.shape}`),j(a%(t*t)==0,()=>`Dimension size must be evenly divisible by ${t*t} but is ${a} for depthToSpace with input shape ${r.shape}`);let o={x:r},l={blockSize:t,dataFormat:n};return iD.runKernel(tg,o,l)}});iy().prototype.depthToSpace=function(e,t){return this.throwIfDisposed(),dG(this,e,t)},iy().prototype.depthwiseConv2d=function(e,t,n,r,i,s){return this.throwIfDisposed(),oW(this,e,t,n,r,i,s)};let dW=iH({dilation2d_:function(e,t,n,r,i=[1,1],s="NHWC"){let a=iG(e,"x","dilation2d"),o=iG(t,"filter","dilation2d");j(3===a.rank||4===a.rank,()=>`Error in dilation2d: input must be rank 3 or 4, but got rank ${a.rank}.`),j(3===o.rank,()=>`Error in dilation2d: filter must be rank 3, but got rank ${o.rank}.`),j("NHWC"===s,()=>`Error in dilation2d: Only NHWC is currently supported, but got dataFormat of ${s}`);let l=a,u=!1;3===a.rank&&(l=ox(a,[1,a.shape[0],a.shape[1],a.shape[2]]),u=!0),j(l.shape[3]===o.shape[2],()=>`Error in dilation2d:  input and filter must have the same depth: ${l.shape[3]} vs ${o.shape[2]}`);let c={x:l,filter:o},h={strides:n,pad:r,dilations:i},d=iD.runKernel(tw,c,h);return u?ox(d,[d.shape[1],d.shape[2],d.shape[3]]):d}});iy().prototype.dilation2d=function(e,t,n,r,i){return this.throwIfDisposed(),dW(this,e,t,n,r,i)};let dq=iH({divNoNan_:function(e,t){let n=iG(e,"a","div"),r=iG(t,"b","div");[n,r]=iI(n,r);let i=s5(n,r),s=ae(i);return lQ(oH(r,s),s,i)}});iy().prototype.divNoNan=function(e){return this.throwIfDisposed(),dq(this,e)},iy().prototype.div=function(e){return this.throwIfDisposed(),s5(this,e)};let dH=iH({dot_:function(e,t){let n=iG(e,"t1","dot"),r=iG(t,"t2","dot");j((1===n.rank||2===n.rank)&&(1===r.rank||2===r.rank),()=>`Error in dot: inputs must all be rank 1 or 2, but got ranks ${n.rank} and ${r.rank}.`);let i=1===n.rank?n.size:n.shape[1],s=1===r.rank?r.size:r.shape[0];if(j(i===s,()=>`Error in dot: inner dimensions of inputs must match, but got ${i} and ${s}.`),1===n.rank&&1===r.rank){let e=lu(ox(n,[1,-1]),ox(r,[-1,1]));return ox(e,[])}if(1===n.rank&&2===r.rank){let e=lu(ox(n,[1,-1]),ox(r,[r.shape[0],r.shape[1]]));return ox(e,[e.size])}if(2!==n.rank||1!==r.rank)return lu(n,ox(r,[r.shape[0],r.shape[1]]));{let e=lu(n,ox(r,[-1,1]));return ox(e,[e.size])}}});iy().prototype.dot=function(e){return this.throwIfDisposed(),dH(this,e)},iy().prototype.elu=function(){return this.throwIfDisposed(),oq(this)},iy().prototype.equal=function(e){return this.throwIfDisposed(),oH(this,e)},iy().prototype.erf=function(){return this.throwIfDisposed(),oK(this)};let dK=iH({euclideanNorm_:function(e,t=null,n=!1){return uV(e,"euclidean",t,n)}});iy().prototype.euclideanNorm=function(e,t){return this.throwIfDisposed(),dK(this,e,t)},iy().prototype.exp=function(){return this.throwIfDisposed(),oX(this)},iy().prototype.expandDims=function(e){return this.throwIfDisposed(),oY(this,e)};let dX=iH({expm1_:function(e){let t={x:iG(e,"x","expm1")};return iD.runKernel(t$,t)}});iy().prototype.expm1=function(){return this.throwIfDisposed(),dX(this)},iy().prototype.fft=function(){return this.throwIfDisposed(),l3(this)},iy().prototype.flatten=function(){return this.throwIfDisposed(),ox(this,[this.size])},iy().prototype.floor=function(){return this.throwIfDisposed(),oZ(this)},iy().prototype.floorDiv=function(e){return this.throwIfDisposed(),s6(this,e)},iy().prototype.gather=function(e,t,n){return this.throwIfDisposed(),o0(this,e,t,n)},iy().prototype.greaterEqual=function(e){return this.throwIfDisposed(),o2(this,e)},iy().prototype.greater=function(e){return this.throwIfDisposed(),o1(this,e)},iy().prototype.ifft=function(){return this.throwIfDisposed(),l6(this)},iy().prototype.irfft=function(){return this.throwIfDisposed(),l5(this)};let dY=iH({isFinite_:function(e){let t={x:iG(e,"x","isFinite")};return iD.runKernel(tq,t)}});iy().prototype.isFinite=function(){return this.throwIfDisposed(),dY(this)};let dQ=iH({isInf_:function(e){let t={x:iG(e,"x","isInf")};return iD.runKernel(tH,t)}});iy().prototype.isInf=function(){return this.throwIfDisposed(),dQ(this)};let dJ=iH({isNaN_:function(e){let t={x:iG(e,"x","isNaN")};return iD.runKernel(tK,t)}});iy().prototype.isNaN=function(){return this.throwIfDisposed(),dJ(this)},iy().prototype.leakyRelu=function(e){return this.throwIfDisposed(),o3(this,e)},iy().prototype.lessEqual=function(e){return this.throwIfDisposed(),uF(this,e)},iy().prototype.less=function(e){return this.throwIfDisposed(),uB(this,e)};let dZ=iH({localResponseNormalization_:function(e,t=5,n=1,r=1,i=.5){let s=iG(e,"x","localResponseNormalization");j(4===s.rank||3===s.rank,()=>`Error in localResponseNormalization: x must be rank 3 or 4 but got
               rank ${s.rank}.`),j(K(t),()=>`Error in localResponseNormalization: depthRadius must be an integer but got depthRadius ${t}.`);let a=s,o=!1;3===s.rank&&(o=!0,a=ox(s,[1,s.shape[0],s.shape[1],s.shape[2]]));let l={x:a},u={depthRadius:t,bias:n,alpha:r,beta:i},c=iD.runKernel(t6,l,u);return o?ox(c,[c.shape[1],c.shape[2],c.shape[3]]):c}});iy().prototype.localResponseNormalization=function(e,t,n,r){return this.throwIfDisposed(),dZ(this,e,t,n,r)};let d0=iH({logSigmoid_:function(e){let t=iG(e,"x","logSigmoid");return an(e=>({value:lm(lU(lm(e))),gradFunc:t=>s8(t,lD(lm(e)))}))(t)}});iy().prototype.logSigmoid=function(){return this.throwIfDisposed(),d0(this)},iy().prototype.logSoftmax=function(e){return this.throwIfDisposed(),o7(this,e)},iy().prototype.logSumExp=function(e,t){return this.throwIfDisposed(),lo(this,e,t)},iy().prototype.log=function(){return this.throwIfDisposed(),o4(this)},iy().prototype.log1p=function(){return this.throwIfDisposed(),o6(this)},iy().prototype.logicalAnd=function(e){return this.throwIfDisposed(),ll(this,e)},iy().prototype.logicalNot=function(){return this.throwIfDisposed(),dv(this)};let d1=iH({logicalOr_:function(e,t){let n=iG(e,"a","logicalOr","bool"),r=iG(t,"b","logicalOr","bool");av(n.shape,r.shape);let i={a:n,b:r};return iD.runKernel(t3,i)}});iy().prototype.logicalOr=function(e){return this.throwIfDisposed(),d1(this,e)};let d2=iH({logicalXor_:function(e,t){let n=iG(e,"a","logicalXor","bool"),r=iG(t,"b","logicalXor","bool");return av(n.shape,r.shape),ll(d1(e,t),dv(ll(e,t)))}});iy().prototype.logicalXor=function(e){return this.throwIfDisposed(),d2(this,e)},iy().prototype.matMul=function(e,t,n){return this.throwIfDisposed(),lu(this,e,t,n)},iy().prototype.maxPool=function(e,t,n,r){return this.throwIfDisposed(),lc(this,e,t,n,r)},iy().prototype.max=function(e,t){return this.throwIfDisposed(),o5(this,e,t)},iy().prototype.maximum=function(e){return this.throwIfDisposed(),aw(this,e)},iy().prototype.mean=function(e,t){return this.throwIfDisposed(),ld(this,e,t)},iy().prototype.min=function(e,t){return this.throwIfDisposed(),lp(this,e,t)},iy().prototype.minimum=function(e){return this.throwIfDisposed(),lf(this,e)};let d3=iH({mirrorPad_:function(e,t,n){j("reflect"===n||"symmetric"===n,()=>`Invalid mode. Mode must be either reflect or symmetric. Got ${n}.`);let r=iG(e,"x","mirrorPad");if(0===r.rank)throw Error("mirrorPad(scalar) is not defined. Pass non-scalar to mirrorPad");j(t.length===r.rank,()=>`Padding doesn't match input. Must be ${r.rank}. Got ${t.length}.`);let i="reflect"===n?1:0;for(let e=0;e<r.rank;e++)j(2===t[e].length,()=>"Invalid number of paddings. Must be length of 2 each."),j(t[e][0]>=0&&t[e][0]<=r.shape[e]-i&&t[e][1]>=0&&t[e][1]<=r.shape[e]-i,()=>`Padding in dimension ${e} cannot be greater than or equal to ${r.shape[e]-i} or less than 0 for input of shape ${r.shape}`);let s={paddings:t,mode:n},a={x:r};return iD.runKernel(no,a,s)}});iy().prototype.mirrorPad=function(e,t){return this.throwIfDisposed(),d3(this,e,t)};let d4=iH({mod_:function(e,t){let n=iG(e,"a","mod"),r=iG(t,"b","mod");[n,r]=iI(n,r);let i={a:n,b:r};return iD.runKernel(nl,i)}});function d6(e,t,n){let r=n.map(e=>e[0]),i=n.map(e=>e[1]),s=e.concat(r,i),a=t.map((e,t)=>(e-s[t]%e)%e),o=i.map((e,t)=>e+a[t]);return[t.map((e,t)=>[r[t],o[t]]),t.map((e,t)=>[0,a[t]])]}function d5(e,t){let n=e.map((e,n)=>e+(e-1)*(t[n]-1)).map(e=>e-1),r=n.map(e=>Math.floor(e/2)),i=n.map((e,t)=>e-r[t]);return n.map((e,t)=>[r[t],i[t]])}iy().prototype.mod=function(e){return this.throwIfDisposed(),d4(this,e)},iy().prototype.mul=function(e){return this.throwIfDisposed(),s8(this,e)},iy().prototype.neg=function(){return this.throwIfDisposed(),lm(this)},iy().prototype.norm=function(e,t,n){return this.throwIfDisposed(),uV(this,e,t,n)},iy().prototype.notEqual=function(e){return this.throwIfDisposed(),ly(this,e)},iy().prototype.oneHot=function(e,t=1,n=0){return this.throwIfDisposed(),lb(this,e,t,n)},iy().prototype.onesLike=function(){return this.throwIfDisposed(),l_(this)},iy().prototype.pad=function(e,t){return this.throwIfDisposed(),lx(this,e,t)};let d8=iH({pool_:function(e,t,n,r,i,s,a){let o;null==i&&(i=[1,1]),null==s&&(s=1),0===r&&(r="valid");let l=iG(e,"x","maxPool"),u=l,c=!1;3===l.rank&&(c=!0,u=ox(l,[1,l.shape[0],l.shape[1],l.shape[2]])),j(ob(s,i),()=>`Error in pool: Either strides or dilations must be 1. Got strides ${s} and dilations '${i}'`);let h=oi(u.shape,t,s,i,r),d=[h.dilationHeight,h.dilationWidth];o="same"===r?d5([h.filterHeight,h.filterWidth],d):[[0,0],[0,0]];let p=1===d[0]&&1===d[1],[f,g]=d6([h.inHeight,h.inWidth],d,o),m=p?r:"valid",y=p?u:hi(u,d,f),b=("avg"===n?()=>oT(y,t,s,m,a):()=>lc(y,t,s,m,a))(),v=p?b:dO(b,d,g);return c?ox(v,[v.shape[1],v.shape[2],v.shape[3]]):v}});iy().prototype.pool=function(e,t,n,r,i,s){return this.throwIfDisposed(),d8(this,e,t,n,r,i,s)},iy().prototype.pow=function(e){return this.throwIfDisposed(),ap(this,e)},iy().prototype.prelu=function(e){return this.throwIfDisposed(),lT(this,e)};let d7=iH({prod_:function(e,t=null,n=!1){let r=iG(e,"x","prod");"bool"===r.dtype&&(r=s1(r,"int32"));let i={x:r},s={axis:t,keepDims:n};return iD.runKernel(nx,i,s)}});iy().prototype.prod=function(e,t){return this.throwIfDisposed(),d7(this,e,t)};let d9=iH({reciprocal_:function(e){let t={x:iG(e,"x","reciprocal")};return iD.runKernel(nC,t)}});iy().prototype.reciprocal=function(){return this.throwIfDisposed(),d9(this)},iy().prototype.relu=function(){return this.throwIfDisposed(),lN(this)},iy().prototype.relu6=function(){return this.throwIfDisposed(),l7(this)},iy().prototype.reshapeAs=function(e){return this.throwIfDisposed(),ox(this,e.shape)},iy().prototype.reshape=function(e){return this.throwIfDisposed(),ox(this,e)},iy().prototype.resizeBilinear=function(e,t,n){return this.throwIfDisposed(),u$(this,e,t,n)},iy().prototype.resizeNearestNeighbor=function(e,t,n){return this.throwIfDisposed(),uR(this,e,t,n)},iy().prototype.reverse=function(e){return this.throwIfDisposed(),lO(this,e)},iy().prototype.rfft=function(){return this.throwIfDisposed(),l4(this)},iy().prototype.round=function(){return this.throwIfDisposed(),uP(this)},iy().prototype.rsqrt=function(){return this.throwIfDisposed(),hO(this)},iy().prototype.selu=function(){return this.throwIfDisposed(),l$(this)},iy().prototype.separableConv2d=function(e,t,n,r,i,s){return this.throwIfDisposed(),lR(this,e,t,n,r,i,s)},iy().prototype.sigmoid=function(){return this.throwIfDisposed(),lD(this)};let pe=iH({sign_:function(e){let t={x:iG(e,"x","sign")};return iD.runKernel(nH,t)}});iy().prototype.sign=function(){return this.throwIfDisposed(),pe(this)},iy().prototype.sin=function(){return this.throwIfDisposed(),hm(this)},iy().prototype.sinh=function(){return this.throwIfDisposed(),hb(this)},iy().prototype.slice=function(e,t){return this.throwIfDisposed(),lF(this,e,t)},iy().prototype.softmax=function(e){return this.throwIfDisposed(),lB(this,e)},iy().prototype.softplus=function(){return this.throwIfDisposed(),lU(this)},iy().prototype.spaceToBatchND=function(e,t){return this.throwIfDisposed(),hi(this,e,t)},iy().prototype.split=function(e,t){return this.throwIfDisposed(),lV(this,e,t)},iy().prototype.sqrt=function(){return this.throwIfDisposed(),s7(this)},iy().prototype.square=function(){return this.throwIfDisposed(),s9(this)},iy().prototype.squaredDifference=function(e){return this.throwIfDisposed(),uW(this,e)},iy().prototype.squeeze=function(e){return this.throwIfDisposed(),lj(this,e)},iy().prototype.stack=function(e,t){return this.throwIfDisposed(),lG(e instanceof im?[this,e]:[this,...e],t)},iy().prototype.step=function(e){return this.throwIfDisposed(),l9(this,e)};let pt=iH({stridedSlice_:function(e,t,n,r,i=0,s=0,a=0,o=0,l=0){let u={x:iG(e,"x","stridedSlice","string_or_numeric")},c={begin:t,end:n,strides:r,beginMask:i,endMask:s,ellipsisMask:a,newAxisMask:o,shrinkAxisMask:l};return iD.runKernel(n9,u,c)}});iy().prototype.stridedSlice=function(e,t,n,r,i,s,a,o){return this.throwIfDisposed(),pt(this,e,t,n,r,i,s,a,o)},iy().prototype.sub=function(e){return this.throwIfDisposed(),af(this,e)},iy().prototype.sum=function(e,t){return this.throwIfDisposed(),o8(this,e,t)};let pn=iH({tan_:function(e){let t={x:iG(e,"x","tan","float32")};return iD.runKernel(ri,t)}});iy().prototype.tan=function(){return this.throwIfDisposed(),pn(this)},iy().prototype.tanh=function(){return this.throwIfDisposed(),lW(this)},iy().prototype.tile=function(e){return this.throwIfDisposed(),oQ(this,e)},iy().prototype.toBool=function(){return this.throwIfDisposed(),s1(this,"bool")},iy().prototype.toFloat=function(){return this.throwIfDisposed(),s1(this,"float32")},iy().prototype.toInt=function(){return this.throwIfDisposed(),s1(this,"int32")};let pr=iH({topk_:function(e,t=1,n=!0){let r=iG(e,"x","topk");if(0===r.rank)throw Error("topk() expects the input to be of rank 1 or higher");let i=r.shape[r.shape.length-1];if(t<0)throw Error(`'k' passed to topk() must be >= 0 but got ${t}`);if(t>i)throw Error(`'k' passed to topk() must be <= the last dimension (${i}) but got ${t}`);let s={x:r},a={k:t,sorted:n},[o,l]=iD.runKernel(ro,s,a);return{values:o,indices:l}}});iy().prototype.topk=function(e,t){return this.throwIfDisposed(),pr(this,e,t)},iy().prototype.transpose=function(e){return this.throwIfDisposed(),l0(this,e)};let pi=iH({unique_:function(e,t=0){let n=iG(e,"x","unique","string_or_numeric");j(n.rank>0,()=>"The input tensor must be at least 1D");let r={x:n},i={axis:t},[s,a]=iD.runKernel(rc,r,i);return{values:s,indices:a}}});iy().prototype.unique=function(e){return this.throwIfDisposed(),pi(this,e)},iy().prototype.unsortedSegmentSum=function(e,t){return this.throwIfDisposed(),hR(this,e,t)},iy().prototype.unstack=function(e){return this.throwIfDisposed(),lX(this,e)},iy().prototype.where=function(e,t){return this.throwIfDisposed(),lQ(e,this,t)},iy().prototype.zerosLike=function(){return this.throwIfDisposed(),ae(this)};class ps extends Error{constructor(e){super(e),Object.setPrototypeOf(this,ps.prototype)}}class pa extends Error{constructor(e){super(e),Object.setPrototypeOf(this,pa.prototype)}}class po extends Error{constructor(e){super(e),Object.setPrototypeOf(this,po.prototype)}}class pl extends Error{constructor(e){super(e),Object.setPrototypeOf(this,pl.prototype)}}class pu extends Error{constructor(e){super(e),Object.setPrototypeOf(this,pu.prototype)}}class pc{constructor(e){this.maxEntries=e||100,this.cache=new Map}get(e){let t;return this.cache.has(e)&&(t=this.cache.get(e),this.cache.delete(e),this.cache.set(e,t)),t}put(e,t){if(this.cache.has(e))this.cache.delete(e);else if(this.cache.size>=this.maxEntries){let e=this.cache.keys().next().value;this.cache.delete(e)}this.cache.set(e,t)}getMaxEntries(){return this.maxEntries}setMaxEntries(e){if(e<0)throw Error(`The maxEntries of LRU caches must be at least 0, but got ${e}.`);if(this.maxEntries>e)for(let t=0;t<this.maxEntries-e;t++){let e=this.cache.keys().next().value;this.cache.delete(e)}this.maxEntries=e}}function ph(e,t){if(Array.isArray(e)){let n=[];for(let r=0;r<t;r++)n=n.concat(e);return n}{let n=Array(t);return n.fill(e),n}}function pd(e,t){if(!e)throw new pu(t)}function pp(e,t){let n=0;for(let r of e)r===t&&n++;return n}function pf(e){return 1===e.length?e[0]:e}function pg(e){return Array.isArray(e)?e:[e]}function pm(e){let t=e.replace(/(.)([A-Z][a-z0-9]+)/g,"$1_$2").replace(/([a-z])([A-Z])/g,"$1_$2").toLowerCase();return"_"!==t[0]?t:"private"+t}function py(e){return e.length<=1||-1===e.indexOf("_")?e:e.replace(/[_]+(\w|$)/g,(e,t)=>t.toUpperCase())}let pb={};function pv(e){if(null==e)return null;let t={};return t.className=e.getClassName(),t.config=e.getConfig(),t}function pw(e){if(null!=e&&"object"==typeof e){if(Array.isArray(e))e.forEach(e=>pw(e));else for(let t of Object.keys(e)){let n=e[t];null!=n&&"object"==typeof n&&(Array.isArray(n)||"ndarray"!==n.type||"number"!=typeof n.value?pw(n):e[t]=n.value)}}}function p_(e,t={},n={},r="object",i=!1){if("string"==typeof e){let i;let s=e;if(s in n)i=n[s];else if(s in pb)i=pb[s];else if(null==(i=t[s]))throw new po(`Unknown ${r}: ${e}. This may be due to one of the following reasons:
1. The ${r} is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.
2. The custom ${r} is defined in JavaScript, but is not registered properly with tf.serialization.registerClass().`);return i}{let s,a;let o=e;if(null==o.className||null==o.config)throw new po(`${r}: Improper config format: ${JSON.stringify(o)}.
'className' and 'config' must set.`);let l=o.className;if(l in n?[s,a]=n[l]:l in pb?[s,a]=pb.className:l in t&&([s,a]=t[l]),null==s)throw new po(`Unknown ${r}: ${l}. This may be due to one of the following reasons:
1. The ${r} is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.
2. The custom ${r} is defined in JavaScript, but is not registered properly with tf.serialization.registerClass().`);if(null!=a){let e={};for(let t of Object.keys(pb))e[t]=pb[t];for(let t of Object.keys(n))e[t]=n[t];o.config.customObjects=e;let t=Object.assign({},pb);for(let e of Object.keys(n))pb[e]=n[e];pw(o.config);let r=a(s,o.config,n,i);return pb=Object.assign({},t),r}{let e=Object.assign({},pb);for(let e of Object.keys(n))pb[e]=n[e];let t=new s(o.config);return pb=Object.assign({},e),t}}}function px(e,t){return e<t?-1:e>t?1:0}function pT(e,t){return -1*px(e,t)}function pI(e){if(null==e)return e;let t=[];for(let n of e)-1===t.indexOf(n)&&t.push(n);return t}function pk(e){if(null==e)throw new po(`Invalid value in obj: ${JSON.stringify(e)}`);for(let t in e)if(e.hasOwnProperty(t))return!1;return!0}function pS(e,t,n){if(null!=n&&0>e.indexOf(n))throw new po(`${n} is not a valid ${t}.  Valid values are ${e} or null/undefined.`)}function pE(e,t,n=0,r=1/0){return pd(n>=0),pd(r>=n),Array.isArray(e)&&e.length>=n&&e.length<=r&&e.every(e=>typeof e===t)}function pC(e,t){Array.isArray(e)?(j(e.length>0,()=>`${t} is unexpectedly an empty array.`),e.forEach((e,n)=>pC(e,`element ${n+1} of ${t}`))):j(Number.isInteger(e)&&e>0,()=>`Expected ${t} to be a positive integer, but got ${pA(e)}.`)}function pA(e){return null===e?"null":Array.isArray(e)?"["+e.map(e=>pA(e)).join(",")+"]":"string"==typeof e?`"${e}"`:`${e}`}function pN(e,t,n){let r,i=null!=n?n():rJ();return(...s)=>{let a=null!=n?n():rJ();return a-i<t?r:(i=a,r=e(...s))}}function pO(e){return"relu"===e?"relu":"linear"===e?"linear":"elu"===e?"elu":null}let p$=0;function pR(){return p$++}let pD={};function pF(e=""){return e in pD||(pD[e]=0),pD[e]+=1,e+pD[e].toString()}let pP=["channelsFirst","channelsLast"],pM=["nearest","bilinear"],pL=["valid","same","causal"],pz=["max","avg"],pB=["sum","mul","concat","ave"],pU=new Map;function pV(e){pS(pP,"DataFormat",e)}function pj(e){pS(pM,"InterpolationFormat",e)}function pG(e){pS(pL,"PaddingMode",e)}function pW(e){pS(pz,"PoolMode",e)}let pq=[],pH="/";function pK(e,t){pq.push(e);try{let e=t();return pq.pop(),e}catch(e){throw pq.pop(),e}}function pX(){return 0===pq.length?"":pq.join(pH)+pH}function pY(e){if(!pZ(e))throw Error("Not a valid tensor name: '"+e+"'");return pX()+e}function pQ(e){if(!pZ(e))throw Error("Not a valid tensor name: '"+e+"'");pU.has(e)||pU.set(e,0);let t=pU.get(e);if(pU.set(e,pU.get(e)+1),!(t>0))return e;{let n=`${e}_${t}`;return pU.set(n,1),n}}let pJ=new RegExp(/^[A-Za-z0-9][-A-Za-z0-9\._\/]*$/);function pZ(e){return!!e.match(pJ)}function p0(e){return e===parseInt(e.toString(),10)}function p1(e,t,n){null==t&&(t=0),null==n&&(n=e.length);let r=1;for(let i=t;i<n;++i)r*=e[i];return r}function p2(e){if(0===e.length)return Number.NaN;let t=Number.POSITIVE_INFINITY;for(let n=0;n<e.length;n++){let r=e[n];r<t&&(t=r)}return t}function p3(e){if(0===e.length)return Number.NaN;let t=Number.NEGATIVE_INFINITY;for(let n=0;n<e.length;n++){let r=e[n];r>t&&(t=r)}return t}function p4(e,t){if(t<e)throw new po(`end (${t}) < begin (${e}) is forbidden.`);let n=[];for(let r=e;r<t;++r)n.push(r);return n}function p6(){return null==a&&(a=i9().epsilon()),a}function p5(){return"channelsLast"}function p8(e,t){return s1(e,t)}function p7(e,t=-1){let n=e.shape.slice();return t<0&&(t=n.length+t+1),n.splice(t,0,1),ox(e,n)}function p9(e,t){return i2(()=>{if(2!==e.shape.length)throw new po(`repeat() expects a rank-2 tensor, but received a rank-${e.shape.length} tensor.`);return fo(p7(e,1),[1,t,1])})}function fe(e){let t=[p1(e.shape)];return ox(e,t)}function ft(e){if(e.rank<=1)throw new po(`batchFlatten requires a minimum rank of 2. Got rank: ${e.rank}.`);let t=[e.shape[0],p1(e.shape,1)];return ox(e,t)}function fn(e,t,n){return i2(()=>{switch(e.rank){case 1:return lP(e,t,n);case 2:return lM(e,[t,0],[n,e.shape[1]]);case 3:return lL(e,[t,0,0],[n,e.shape[1],e.shape[2]]);case 4:return lz(e,[t,0,0,0],[n,e.shape[1],e.shape[2],e.shape[3]]);case 5:return lF(e,[t,0,0,0,0],[n,e.shape[1],e.shape[2],e.shape[3],e.shape[4]]);case 6:return lF(e,[t,0,0,0,0,0],[n,e.shape[1],e.shape[2],e.shape[3],e.shape[4],e.shape[5]]);default:throw new po(`sliceAlongFirstAxis() received an unsupported tensor rank: ${e.rank}`)}})}function fr(e,t,n){return i2(()=>{switch(e.rank){case 1:return lP(e,t,n);case 2:return lM(e,[0,t],[e.shape[0],n]);case 3:return lL(e,[0,0,t],[e.shape[0],e.shape[1],n]);case 4:return lz(e,[0,0,0,t],[e.shape[0],e.shape[1],e.shape[2],n]);default:throw new po(`sliceAlongLastAxis() received an unsupported tensor rank: ${e.rank}`)}})}function fi(e,t,n,r){return i2(()=>{switch(e.rank){case 1:return lP(e,t,n);case 2:switch(r){case 1:return fn(e,t,n);case 2:return fr(e,t,n);default:throw new po(`The axis is not within the rank of the tensor ${r}`)}case 3:switch(r){case 1:return fn(e,t,n);case 2:return lL(e,[0,t,0],[e.shape[0],n,e.shape[2]]);case 3:return fr(e,t,n);default:throw new po(`The axis is not within the rank of the tensor ${r}`)}case 4:switch(r){case 1:return fn(e,t,n);case 2:return lz(e,[0,t,0,0],[e.shape[0],n,e.shape[2],e.shape[3]]);case 3:return lz(e,[0,0,t,0],[e.shape[0],e.shape[1],n,e.shape[3]]);case 4:return fr(e,t,n);default:throw new po(`The axis is not within the rank of the tensor ${r}`)}default:throw new po(`sliceAlongLastAxis() received an unsupported tensor rank: ${e.rank}`)}})}function fs(e,t=-1){let n;return t<0&&(t=0!==(n=e[0].rank)?n:0),t===e[0].rank&&(t=-1),o$(e,t)}function fa(e,t){switch(e.rank){case 1:return oR([e,t]);case 2:return oD([e,t],0);case 3:return oF([e,t],0);case 4:return oP([e,t],0);default:throw new po(`concatAlongFirstAxis() received an unsupported tensor rank: ${e.rank}`)}}function fo(e,t){if(Array.isArray(t)||(t=[t]),e.rank!==t.length)throw new po(`The length of input n (${t.length}) does not match the number of dimensions in input x (${e.rank})`);return oQ(e,t)}function fl(e,t=0,n=1,r,i){return lE(e,t,n,r,i)}function fu(e,t,n,r){if(e.rank<2||t.rank<2)throw new pl(`dot requires both inputs to be rank >= 2 but got x shape = ${e.shape} and y shape = ${t.shape}`);if(t.rank>=3&&e.shape.slice(-1)[0]!==t.shape.slice(-2)[0])throw new pl(`If rank y >= 3, then the second last dim of y must equal the last dim of x but got x shape = ${e.shape} and  y shape = ${t.shape}`);if(2===e.rank&&2===t.rank)return uo({a:e,b:t,transposeA:!1,transposeB:!1,bias:r?fd(e.rank,r,p5()):null,activation:n});{let i=e.shape.slice();e=ox(e,[-1,i.pop()]);let s=t.shape.slice(),a=s.pop(),o=s.pop(),l=[...s,a],u=Array.from({length:t.rank},(e,n)=>0===n?t.rank-2:n<=t.rank-2?n-1:n);t=ox(l0(t,u),[o,-1]);let c=[...i,...l];return ox(uo({a:e,b:t,transposeA:!1,transposeB:!1,bias:r?fd(e.rank,r,p5()):null,activation:n}),c)}}function fc(e,t,n){return i2(()=>o0(e,t=Array.isArray(t)?lq(t,"int32"):s1(t,"int32"),n))}function fh(e){return s8(e,e)}function fd(e,t,n){let r=t.shape;if(1!==t.rank&&t.rank!==e)throw new po(`Unexpected bias dimensions: ${t.rank}; expected it to be 1 or ${e}`);if(5===e){if("channelsFirst"===n)return 1===r.length?ox(t,[1,r[0],1,1,1]):ox(t,[1,r[3],r[0],r[1],r[2]]);if("channelsLast"===n)return 1===r.length?ox(t,[1,1,1,1,r[0]]):ox(t,[1].concat(r))}else if(4===e){if("channelsFirst"===n)return 1===r.length?ox(t,[1,r[0],1,1]):ox(t,[1,r[2],r[0],r[1]]);if("channelsLast"===n)return 1===r.length?ox(t,[1,1,1,r[0]]):ox(t,[1].concat(r))}else if(3===e){if("channelsFirst"===n)return 1===r.length?ox(t,[1,r[0],1]):ox(t,[1,r[1],r[0]]);if("channelsLast"===n)return 1===r.length?ox(t,[1,1,r[0]]):ox(t,[1].concat(r))}else if(e<3)return t;throw new po(`Unsupported input rank by biasAdd: ${t.rank}`)}function fp(e,t,n){return i2(()=>(null==n&&(n=p5()),pV(n),s4(e,fd(e.rank,t,n))))}function ff(e,t=1){if(1!==t)throw new pl(`Support for alpha values other than 1 (${t}) is not implemented yet.`);return oq(e)}function fg(e){return i2(()=>s5(e,s4(am(e),1)))}function fm(e,t,n,r){return i2(()=>l2(e,t,n,r))}function fy(e){return i2(()=>oO(s4(.5,s8(.2,e)),0,1))}function fb(e,t,n=!1){return n?e():t()}let fv=["fanIn","fanOut","fanAvg"],fw=["normal","uniform","truncatedNormal"];function f_(e){pS(fv,"FanMode",e)}function fx(e){pS(fw,"Distribution",e)}class fT extends aa{fromConfigUsesCustomObjects(){return!1}getConfig(){return{}}}class fI extends fT{apply(e,t){return lv(e,t)}}fI.className="Zeros",al(fI);class fk extends fT{apply(e,t){return lw(e,t)}}fk.className="Ones",al(fk);class fS extends fT{constructor(e){if(super(),"object"!=typeof e)throw new po(`Expected argument of type ConstantConfig but got ${e}`);if(void 0===e.value)throw new po(`config must have value set but got ${e}`);this.value=e.value}apply(e,t){return i2(()=>s8(ar(this.value),lw(e,t)))}getConfig(){return{value:this.value}}}fS.className="Constant",al(fS);class fE extends fT{constructor(e){super(),this.DEFAULT_MINVAL=-.05,this.DEFAULT_MAXVAL=.05,this.minval=e.minval||this.DEFAULT_MINVAL,this.maxval=e.maxval||this.DEFAULT_MAXVAL,this.seed=e.seed}apply(e,t){return lC(e,this.minval,this.maxval,t,this.seed)}getConfig(){return{minval:this.minval,maxval:this.maxval,seed:this.seed}}}fE.className="RandomUniform",al(fE);class fC extends fT{constructor(e){super(),this.DEFAULT_MEAN=0,this.DEFAULT_STDDEV=.05,this.mean=e.mean||this.DEFAULT_MEAN,this.stddev=e.stddev||this.DEFAULT_STDDEV,this.seed=e.seed}apply(e,t){if("float32"!==(t=t||"float32")&&"int32"!==t)throw new pl(`randomNormal does not support dType ${t}.`);return fl(e,this.mean,this.stddev,t,this.seed)}getConfig(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}fC.className="RandomNormal",al(fC);class fA extends fT{constructor(e){super(),this.DEFAULT_MEAN=0,this.DEFAULT_STDDEV=.05,this.mean=e.mean||this.DEFAULT_MEAN,this.stddev=e.stddev||this.DEFAULT_STDDEV,this.seed=e.seed}apply(e,t){if("float32"!==(t=t||"float32")&&"int32"!==t)throw new pl(`truncatedNormal does not support dType ${t}.`);return lK(e,this.mean,this.stddev,t,this.seed)}getConfig(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}fA.className="TruncatedNormal",al(fA);class fN extends fT{constructor(e){super(),this.gain=null!=e.gain?e.gain:1}apply(e,t){return i2(()=>{if(2===e.length&&e[0]===e[1])return s8(this.gain,oJ(e[0]));throw new po("Identity matrix initializer can only be used for 2D square matrices.")})}getConfig(){return{gain:this.gain}}}function fO(e,t="channelsLast"){let n,r;if(pV(t),2===e.length)n=e[0],r=e[1];else if(-1!==[3,4,5].indexOf(e.length)){if("channelsFirst"===t){let t=p1(e,2);n=e[1]*t,r=e[0]*t}else if("channelsLast"===t){let t=p1(e,0,e.length-2);n=e[e.length-2]*t,r=e[e.length-1]*t}}else{let t=p1(e);n=Math.sqrt(t),r=Math.sqrt(t)}return[n,r]}fN.className="Identity",al(fN);class f$ extends fT{constructor(e){if(super(),e.scale<0)throw new po(`scale must be a positive float. Got: ${e.scale}`);this.scale=null==e.scale?1:e.scale,this.mode=null==e.mode?"fanIn":e.mode,f_(this.mode),this.distribution=null==e.distribution?"normal":e.distribution,fx(this.distribution),this.seed=e.seed}apply(e,t){let n=fO(e),r=n[0],i=n[1],s=this.scale;if("fanIn"===this.mode?s/=Math.max(1,r):"fanOut"===this.mode?s/=Math.max(1,i):s/=Math.max(1,(r+i)/2),"normal"===this.distribution){let n=Math.sqrt(s);if("float32"!==(t=t||"float32")&&"int32"!==t)throw new pl(`${this.getClassName()} does not support dType ${t}.`);return lK(e,0,n,t,this.seed)}{let n=Math.sqrt(3*s);return lC(e,-n,n,t,this.seed)}}getConfig(){return{scale:this.scale,mode:this.mode,distribution:this.distribution,seed:this.seed}}}f$.className="VarianceScaling",al(f$);class fR extends f${constructor(e){super({scale:1,mode:"fanAvg",distribution:"uniform",seed:null==e?null:e.seed})}getClassName(){return f$.className}}fR.className="GlorotUniform",al(fR);class fD extends f${constructor(e){super({scale:1,mode:"fanAvg",distribution:"normal",seed:null==e?null:e.seed})}getClassName(){return f$.className}}fD.className="GlorotNormal",al(fD);class fF extends f${constructor(e){super({scale:2,mode:"fanIn",distribution:"normal",seed:null==e?null:e.seed})}getClassName(){return f$.className}}fF.className="HeNormal",al(fF);class fP extends f${constructor(e){super({scale:2,mode:"fanIn",distribution:"uniform",seed:null==e?null:e.seed})}getClassName(){return f$.className}}fP.className="HeUniform",al(fP);class fM extends f${constructor(e){super({scale:1,mode:"fanIn",distribution:"normal",seed:null==e?null:e.seed})}getClassName(){return f$.className}}fM.className="LeCunNormal",al(fM);class fL extends f${constructor(e){super({scale:1,mode:"fanIn",distribution:"uniform",seed:null==e?null:e.seed})}getClassName(){return f$.className}}fL.className="LeCunUniform",al(fL);class fz extends fT{constructor(e){super(),this.DEFAULT_GAIN=1,this.ELEMENTS_WARN_SLOW=2e3,this.gain=null==e.gain?this.DEFAULT_GAIN:e.gain,this.seed=e.seed}apply(e,t){return i2(()=>{if(e.length<2)throw new pl("Shape must be at least 2D.");if("int32"!==t&&"float32"!==t&&void 0!==t)throw TypeError(`Unsupported data type ${t}.`);let n=q(e.slice(0,-1)),r=e[e.length-1],i=n*r;i>this.ELEMENTS_WARN_SLOW&&console.warn(`Orthogonal initializer is being called on a matrix with more than ${this.ELEMENTS_WARN_SLOW} (${i}) elements: Slowness may result.`);let s=fl([Math.max(r,n),Math.min(r,n)],0,1,t,this.seed),a=uH.qr(s,!1),o=a[0];return o=s8(o,a[1].flatten().stridedSlice([0],[Math.min(r,n)*Math.min(r,n)],[Math.min(r,n)+1]).sign()),n<r&&(o=o.transpose()),s8(ar(this.gain),o.reshape(e))})}getConfig(){return{gain:this.gain,seed:this.seed}}}fz.className="Orthogonal",al(fz);let fB={constant:"Constant",glorotNormal:"GlorotNormal",glorotUniform:"GlorotUniform",heNormal:"HeNormal",heUniform:"HeUniform",identity:"Identity",leCunNormal:"LeCunNormal",leCunUniform:"LeCunUniform",ones:"Ones",orthogonal:"Orthogonal",randomNormal:"RandomNormal",randomUniform:"RandomUniform",truncatedNormal:"TruncatedNormal",varianceScaling:"VarianceScaling",zeros:"Zeros"};function fU(e,t={}){return p_(e,ao.getMap().classNameMap,t,"initializer")}function fV(e){return pv(e)}function fj(e){if("string"==typeof e){let t=e in fB?fB[e]:e;if("GlorotNormal"===t)return new fD;if("GlorotUniform"===t)return new fR;{if("HeNormal"===t)return new fF;if("HeUniform"===t)return new fP;if("LeCunNormal"===t)return new fM;if("LeCunUniform"===t)return new fL;let e={};return e.className=t,e.config={},fU(e)}}return e instanceof fT?e:fU(e)}function fG(e){return Array.isArray(e)&&Array.isArray(e[0])}function fW(e){return 0===e.length?[]:Array.isArray(e[0])?e:[e]}function fq(e){let t;if(Array.isArray(e)){if(1!==e.length)throw new po(`Expected Tensor length to be 1; got ${e.length}`);t=e[0]}else t=e;return t}function fH(e){if(!(Array.isArray(e)&&Array.isArray(e[0])))return e;if(1===e.length)return e[0];throw new po(`Expected exactly 1 Shape; got ${e.length}`)}function fK(e){let t=0;for(let n of e)0===n.shape.length?t+=1:t+=n.shape.reduce((e,t)=>e*t);return t}let fX="Variable";class fY{constructor(e,t="float32",n=fX,r=!0,i=null){this.dtype=null==t?"float32":t,this.shape=e.shape,this.id=pR(),n=null==n?fX:n,this.originalName=pY(n),this.name=pQ(this.originalName),this.trainable_=r,this.constraint=i,this.val=lY(e,this.trainable_,this.name,this.dtype)}read(){return this.assertNotDisposed(),this.val}write(e){return this.assertNotDisposed(),fQ(this.val,e),this.val.id!==e.id&&(this.val.assign(e),null!=this.constraint&&this.val.assign(this.constraint.apply(this.val))),this}dispose(){this.assertNotDisposed(),this.val.dispose()}assertNotDisposed(){if(this.val.isDisposed)throw Error(`LayersVariable ${this.name} is already disposed.`)}get trainable(){return this.trainable_}set trainable(e){this.trainable_=e,this.val.trainable=e}}function fQ(e,t){if(e.shape.toString()!==t.shape.toString())throw Error("Shape mismatch: "+JSON.stringify(e.shape)+" vs. "+JSON.stringify(t.shape))}function fJ(e){return e.map(e=>e.read())}function fZ(e){e.forEach(e=>{e[0].write(e[1])})}class f0{constructor(e){this.dtype=e.dtype,this.shape=e.shape,null!=e.shape?this.ndim=e.shape.length:this.ndim=e.ndim,this.maxNDim=e.maxNDim,this.minNDim=e.minNDim,this.axes=e.axes||{}}}class f1{constructor(e,t,n,r,i,s,a){this.dtype=e,this.shape=t,this.sourceLayer=n,this.inputs=r,this.callArgs=i,this.outputTensorIndex=a,this.id=pR(),null!=s&&(this.originalName=pY(s),this.name=pQ(this.originalName)),this.rank=t.length}}let f2=0;class f3{constructor(e,t){for(let n of(this.callArgs=t,this.id=f2++,this.outboundLayer=e.outboundLayer,this.inboundLayers=e.inboundLayers,this.nodeIndices=e.nodeIndices,this.tensorIndices=e.tensorIndices,this.inputTensors=e.inputTensors,this.outputTensors=e.outputTensors,this.inputMasks=e.inputMasks,this.outputMasks=e.outputMasks,this.inputShapes=e.inputShapes,this.outputShapes=e.outputShapes,e.inboundLayers))null!=n&&n.outboundNodes.push(this);e.outboundLayer.inboundNodes.push(this)}getConfig(){let e=[];for(let t of this.inboundLayers)null!=t?e.push(t.name):e.push(null);return{outboundLayer:this.outboundLayer?this.outboundLayer.name:null,inboundLayers:e,nodeIndices:this.nodeIndices,tensorIndices:this.tensorIndices}}}let f4=0;class f6 extends aa{constructor(e={}){super(),this._callHook=null,this._addedWeightNames=[],this._stateful=!1,this.id=f4++,this.activityRegularizer=null,this.inputSpec=null,this.supportsMasking=!1,this._trainableWeights=[],this._nonTrainableWeights=[],this._losses=[],this._updates=[],this._built=!1,this.inboundNodes=[],this.outboundNodes=[];let t=e.name;if(!t){let e=this.getClassName();t=pm(e)+"_"+pF(e)}if(this.name=t,this.trainable_=null==e.trainable||e.trainable,null!=e.inputShape||null!=e.batchInputShape){let t;if(null!=e.batchInputShape)t=e.batchInputShape;else if(null!=e.inputShape){let n=null;null!=e.batchSize&&(n=e.batchSize),t=[n].concat(e.inputShape)}this.batchInputShape=t;let n=e.dtype;null==n&&(n=e.inputDType),null==n&&(n="float32"),this.dtype=n}null!=e.weights?this.initialWeights=e.weights:this.initialWeights=null,this._refCount=null,this.fastWeightInitDuringBuild=!1}static nodeKey(e,t){return e.name+"_ib-"+t.toString()}getNodeAtIndex(e,t){if(0===this.inboundNodes.length)throw new pa(`The layer has never been called and thus has no defined ${t}.`);if(this.inboundNodes.length<=e)throw new po(`Asked to get ${t} at node ${e}, but the layer has only ${this.inboundNodes.length} inbound nodes.`);return this.inboundNodes[e]}getInputAt(e){return pf(this.getNodeAtIndex(e,"input").inputTensors)}getOutputAt(e){return pf(this.getNodeAtIndex(e,"output").outputTensors)}get input(){if(this.inboundNodes.length>1)throw new ps(`Layer ${this.name} has multiple inbound nodes, hence the notion of "layer input" is ill-defined. Use \`getInputAt(nodeIndex)\` instead.`);if(0===this.inboundNodes.length)throw new ps(`Layer ${this.name} is not connected, no input to return.`);return pf(this.getNodeAtIndex(0,"input").inputTensors)}get output(){if(0===this.inboundNodes.length)throw new ps(`Layer ${this.name} has no inbound nodes.`);if(this.inboundNodes.length>1)throw new ps(`Layer ${this.name} has multiple inbound nodes, hence the notion of "layer output" is ill-defined. Use \`getOutputAt(nodeIndex)\` instead.`);return pf(this.getNodeAtIndex(0,"output").outputTensors)}get losses(){return this._losses}calculateLosses(){return this.losses.map(e=>e())}get updates(){return this._updates}get built(){return this._built}set built(e){this._built=e}get trainable(){return this.trainable_}set trainable(e){this._trainableWeights.forEach(t=>t.trainable=e),this.trainable_=e}get trainableWeights(){return this.trainable_?this._trainableWeights.filter(e=>e.trainable):[]}set trainableWeights(e){this._trainableWeights=e}get nonTrainableWeights(){return this.trainable?this._trainableWeights.filter(e=>!e.trainable).concat(this._nonTrainableWeights):this._trainableWeights.concat(this._nonTrainableWeights)}set nonTrainableWeights(e){this._nonTrainableWeights=e}get weights(){return this.trainableWeights.concat(this.nonTrainableWeights)}get stateful(){return this._stateful}resetStates(){if(!this.stateful)throw Error("Cannot call the resetStates() method of a non-stateful Layer object.")}assertInputCompatibility(e){let t=pg(e);if(null==this.inputSpec||0===this.inputSpec.length)return;let n=pg(this.inputSpec);if(t.length!==n.length)throw new po(`Layer ${this.name} expects ${n.length} inputs, but it received ${t.length} input tensors. Input received: ${e}`);for(let e=0;e<t.length;e++){let r=t[e],i=n[e];if(null==i)continue;let s=r.rank;if(null!=i.ndim&&s!==i.ndim)throw new po(`Input ${e} is incompatible with layer ${this.name}: expected ndim=${i.ndim}, found ndim=${s}`);if(null!=i.maxNDim&&s>i.maxNDim)throw new po(`Input ${e} is incompatible with layer ${this.name}: expected max_ndim=${i.maxNDim}, found ndim=${s}`);if(null!=i.minNDim&&s<i.minNDim)throw new po(`Input ${e} is incompatible with layer ${this.name}: expected min_ndim=${i.minNDim}, found ndim=${s}.`);if(null!=i.dtype&&r.dtype!==i.dtype)throw new po(`Input ${e} is incompatible with layer ${this.name} : expected dtype=${i.dtype}, found dtype=${r.dtype}.`);if(i.axes){let t=r.shape;for(let n in i.axes){let r=Number(n),s=i.axes[n],a=r>=0?t[r]:t[t.length+r];if(null!=s&&-1===[s,null].indexOf(a))throw new po(`Input ${e} is incompatible with layer ${this.name}: expected axis ${r} of input shape to have value ${s} but got shape ${t}.`)}}if(null!=i.shape)for(let t=0;t<i.shape.length;++t){let n=i.shape[t],s=r.shape[t];if(null!=n&&null!=s&&n!==s)throw new po(`Input ${e} is incompatible with layer ${this.name}: expected shape=${i.shape}, found shape=${r.shape}.`)}}}call(e,t){return e}invokeCallHook(e,t){null!=this._callHook&&this._callHook(e,t)}setCallHook(e){this._callHook=e}clearCallHook(){this._callHook=null}apply(e,t){t=t||{},this.assertNotDisposed();let n=pg(e),r=f9(e),i=ge(e);if(r===i)throw new po("Arguments to apply() must be all SymbolicTensors or all Tensors");return pK(this.name,()=>{if(!this.built){this.assertInputCompatibility(e);let t=[];for(let n of pg(e))t.push(n.shape);this.build(pf(t)),this.built=!0,this.initialWeights&&this.setWeights(this.initialWeights),null===this._refCount&&i&&(this._refCount=1)}if(this.assertInputCompatibility(e),i){let r=this.call(e,t);this.supportsMasking&&this.setMaskMetadata(e,r);let i=pg(r),s=[];for(let e of i)-1!==n.indexOf(e)&&(e=e.clone()),s.push(e);if(r=pf(s),null!=this.activityRegularizer)throw new pl("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return r}{let n;let r=f5(e),i=this.computeOutputShape(r),s=f8(e);if(this.warnOnIncompatibleInputShape(Array.isArray(e)?r[0]:r),n=null!=i&&i.length>0&&Array.isArray(i[0])?i.map((n,r)=>new f1(s,n,this,pg(e),t,this.name,r)):new f1(s,i,this,pg(e),t,this.name),this.addInboundNode(e,n,null,null,r,i,t),this._refCount++,null!=this.activityRegularizer)throw new pl("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return n}})}warnOnIncompatibleInputShape(e){if(null!=this.batchInputShape){if(e.length!==this.batchInputShape.length)console.warn(`The rank of the input tensor provided (shape: ${JSON.stringify(e)}) does not match that of the batchInputShape (${JSON.stringify(this.batchInputShape)}) of the layer ${this.name}`);else{let t=!1;this.batchInputShape.forEach((n,r)=>{null!=n&&null!=e[r]&&e[r]!==n&&(t=!0)}),t&&console.warn(`The shape of the input tensor (${JSON.stringify(e)}) does not match the expectation of layer ${this.name}: ${JSON.stringify(this.batchInputShape)}`)}}}get outputShape(){if(null==this.inboundNodes||0===this.inboundNodes.length)throw new ps(`The layer ${this.name} has never been called and thus has no defined output shape.`);let e=[];for(let t of this.inboundNodes){let n=JSON.stringify(t.outputShapes);-1===e.indexOf(n)&&e.push(n)}if(1===e.length){let e=this.inboundNodes[0].outputShapes;return Array.isArray(e)&&Array.isArray(e[0])&&1===e.length?e[0]:e}throw new ps(`The layer ${this.name} has multiple inbound nodes with different output shapes. Hence the notion of "output shape" is ill-defined for the layer.`)}countParams(){if(!this.built)throw new pa(`You tried to call countParams() on ${this.name}, but the layer is not built yet. Build it first by calling build(batchInputShape).`);return fK(this.weights)}build(e){this.built=!0}getWeights(e=!1){return fJ(e?this.trainableWeights:this.weights)}setWeights(e){i2(()=>{let t=this.weights;if(t.length!==e.length)throw new po(`You called setWeights(weights) on layer "${this.name}" with a weight list of length ${e.length}, but the layer was expecting ${t.length} weights. Provided weights: ${e}...`);if(0===t.length)return;let n=[],r=fJ(t);for(let i=0;i<r.length;++i){let s=r[i],a=t[i],o=e[i];if(!H(s.shape,o.shape))throw new po(`Layer weight shape ${s.shape} not compatible with provided weight shape ${o.shape}`);n.push([a,o])}fZ(n)})}addWeight(e,t,n,r,i,s,a,o){if(-1!==this._addedWeightNames.indexOf(e))throw new po(`Duplicate weight name ${e} for layer ${this.name}`);this._addedWeightNames.push(e),null==n&&(n="float32"),this.fastWeightInitDuringBuild&&(r=null!=o?o():fj("zeros"));let l=r.apply(t,n),u=new fY(l,n,e,s,a);return l.dispose(),null!=i&&this.addLoss(()=>i.apply(u.read())),null==s&&(s=!0),s?this._trainableWeights.push(u):this._nonTrainableWeights.push(u),u}setFastWeightInitDuringBuild(e){this.fastWeightInitDuringBuild=e}addLoss(e){null==e||Array.isArray(e)&&0===e.length||(e=pg(e),void 0!==this._losses&&null!==this._losses&&this.losses.push(...e))}computeOutputShape(e){return e}computeMask(e,t){if(!this.supportsMasking){if(null!=t){if(Array.isArray(t))t.forEach(e=>{if(null!=e)throw TypeError(`Layer ${this.name} does not support masking, but was passed an inputMask.`)});else throw TypeError(`Layer ${this.name} does not support masking, but was passed an inputMask.`)}return null}return t}setMaskMetadata(e,t,n){if(!this.supportsMasking)return;let r=this.computeMask(e,n),i=pg(t),s=pg(r);if(i.length!==s.length)throw Error(`${this.name} outputs ${i.length} tensors but ${i.length} masks for those tensors`);for(let e=0;e<i.length;e++)i[e].kerasMask=s[e]}addInboundNode(e,t,n,r,i,s,a=null){let o=pg(e);t=pg(t),n=pg(n),r=pg(r),i=fW(i),s=fW(s);let l=[],u=[],c=[];for(let e of o)l.push(e.sourceLayer),u.push(e.nodeIndex),c.push(e.tensorIndex);new f3({outboundLayer:this,inboundLayers:l,nodeIndices:u,tensorIndices:c,inputTensors:o,outputTensors:t,inputMasks:n,outputMasks:r,inputShapes:i,outputShapes:s},a);for(let e=0;e<t.length;e++)t[e].sourceLayer=this,t[e].nodeIndex=this.inboundNodes.length-1,t[e].tensorIndex=e}getConfig(){let e={name:this.name,trainable:this.trainable};return null!=this.batchInputShape&&(e.batchInputShape=this.batchInputShape),null!=this.dtype&&(e.dtype=this.dtype),e}disposeWeights(){return this.weights.forEach(e=>e.dispose()),this.weights.length}assertNotDisposed(){if(0===this._refCount)throw Error(`Layer '${this.name}' is already disposed.`)}dispose(){if(!this.built)throw Error(`Cannot dispose Layer ${this.name} because it has not been built yet.`);if(null===this._refCount)throw Error(`Cannot dispose Layer ${this.name} because it has not been used yet.`);this.assertNotDisposed();let e=0;return 0==--this._refCount&&(e=this.disposeWeights()),{refCountAfterDispose:this._refCount,numDisposedVariables:e}}}function f5(e){e=pg(e);let t=[];for(let n of e)t.push(n.shape);return pf(t)}function f8(e){return"float32"}function f7(e,t,n){if((null==t||null!=n&&n>0)&&(t=e.sourceLayer,n=e.nodeIndex),0===t.inboundNodes.length)return[e];{let e=t.inboundNodes[n];if(0===e.inboundLayers.length)return e.inputTensors;{let t=[];for(let n=0;n<e.inboundLayers.length;n++)for(let r of f7(e.inputTensors[n],e.inboundLayers[n],e.nodeIndices[n]))-1===t.indexOf(r)&&t.push(r);return t}}}function f9(e){let t=!0;for(let n of pg(e))if(!(n instanceof f1)){t=!1;break}return t}function ge(e){let t=!0;for(let n of pg(e))if(n instanceof f1){t=!1;break}return t}class gt extends f6{constructor(e){if(super({dtype:e.dtype,name:null!=e.name?e.name:pF("input").toString()}),null==e.batchSize&&(e.batchSize=null),null==e.sparse&&(e.sparse=!1),this.trainable=!1,this.built=!0,this.sparse=e.sparse,null!=e.inputShape&&null!=e.batchInputShape)throw new po("Only provide the inputShape OR batchInputShape argument to inputLayer, not both at the same time.");let t=e.batchInputShape;if(null==t){if(null==e.inputShape)throw new po("An InputLayer should be passed either a `batchInputShape` or an `inputShape`.");t=[e.batchSize].concat(e.inputShape)}else if(null!=e.batchSize)throw new po("Cannot specify batchSize if batchInputShape is specified when creating an InputLayer.");let n=e.dtype||"float32";this.batchInputShape=t,this.dtype=n,this.inputSpec=[{shape:t}];let r=new f1(this.dtype,this.batchInputShape,this,[],{},this.name);r.nodeIndex=0,r.tensorIndex=0,new f3({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:[r],outputTensors:[r],inputMasks:[null],outputMasks:[null],inputShapes:[t],outputShapes:[t]})}apply(e,t){throw new po(`Cannot pass any input to an InputLayer's apply() method. InputLayer name: ${this.name}`)}dispose(){return{refCountAfterDispose:this._refCount,numDisposedVariables:0}}getConfig(){return{batchInputShape:this.batchInputShape,dtype:this.dtype,sparse:this.sparse,name:this.name}}}function gn(e){if(null==e.batchShape&&null==e.shape)throw Error("Please provide to Input either a `shape` or a `batchShape` argument. Note that `shape` does not include the batch dimension.");if(null!=e.batchShape&&null!=e.shape)throw new po("Please provide either a `shape` or `batchShape` argument to Input, but not both.");let t=e.batchShape;null!=e.shape&&null==t&&(t=[null].concat(e.shape));let n=e.dtype;return null==n&&(n="float32"),new gt({batchInputShape:t,name:e.name,dtype:n,sparse:e.sparse}).inboundNodes[0].outputTensors[0]}function gr(e,t){if(null==e.dtype||e.dtype===t.dtype)return t;try{return s1(t,e.dtype)}catch(n){throw new po(`The dtype of the feed (${t.dtype}) can not be cast to the dtype of the key '${e.name}' (${e.dtype}).`)}}gt.className="InputLayer",al(gt);class gi{constructor(e){if(this.id2Value={},this.id2Mask={},this.name2Id={},e instanceof gi)for(let t in e.id2Value)this.id2Value[t]=e.id2Value[t],t in e.id2Mask&&(this.id2Mask[t]=e.id2Mask[t]);else{if(null==e)return;for(let t of e)this.add(t.key,t.value)}}add(e,t,n){if(null==this.id2Value[e.id])this.id2Value[e.id]=gr(e,t),this.name2Id[e.name]=e.id,null!=n&&(this.id2Mask[e.id]=n);else throw new po(`Duplicate key: name=${e.name}, id=${e.id}`);return this}addFeed(e){this.add(e.key,e.value)}hasKey(e){return null!=this.id2Value[e.id]}names(){return Object.keys(this.name2Id)}getValue(e){if(e instanceof f1){if(null!=this.id2Value[e.id])return this.id2Value[e.id];throw new po(`Nonexistent key: ${e.name}`)}{let t=this.name2Id[e];if(null==t)throw new po(`Feed dict has no SymbolicTensor name: ${e}`);return this.id2Value[t]}}getMask(e){if(e instanceof f1){if(null!=this.id2Value[e.id])return this.id2Mask[e.id];throw new po(`Nonexistent key: ${e.name}`)}{let t=this.name2Id[e];if(null==t)throw new po(`Feed dict has no SymbolicTensor name: ${e}`);return this.id2Mask[t]}}disposeMasks(){null!=this.id2Mask&&i3(this.id2Mask)}}let gs=new pc,ga=new pc;function go(e){null!=gs&&gs.setMaxEntries(e),null!=ga&&ga.setMaxEntries(e)}function gl(e,t,n,r){let i;let s=null!=n&&n.training,a=Array.isArray(e),o=a?e:[e],l=o.map(e=>e.name),u=[],c=t.names();for(let e of l)-1!==c.indexOf(e)?u.push(t.getValue(e)):u.push(null);null!=r&&(r.maxNumTensors=-1/0,r.minNumTensors=1/0);let h=l.join(",")+"|"+t.names().sort().join(","),d=gs.get(h);if(null==d){let e=gu(o,t);d=e.sorted,i=e.recipientCounts,gs.put(h,d),ga.put(h,i)}i={},s||Object.assign(i,ga.get(h));let p=new gi(t);for(let e=0;e<d.length;++e){if(null!=r){let e=i1().numTensors;e>r.maxNumTensors&&(r.maxNumTensors=e),e<r.minNumTensors&&(r.minNumTensors=e)}let a=d[e],o=a.sourceLayer;if(o instanceof gt)continue;let c=[],h=[],f=[],g=!1;for(let e of a.inputs){let n=p.getValue(e),r=p.getMask(e);c.push(n),h.push(r),null!=r&&(g=!0),s||(i[e.name]--,0!==i[e.name]||t.hasKey(e)||-1!==l.indexOf(e.name)||n.isDisposed||!0===e.sourceLayer.stateful||f.push(n))}g&&((n=n||{}).mask=h[0]);let m=pg(o.apply(c,n)),y=null;o.supportsMasking&&(y=o.computeMask(c,h));let b=gd(a),v=Array.isArray(b)?b:[b];for(let e=0;e<v.length;++e){p.hasKey(v[e])||p.add(v[e],m[e],Array.isArray(y)?y[0]:y);let t=l.indexOf(v[e].name);-1!==t&&(u[t]=m[e])}s||i3(f)}return p.disposeMasks(),a?u:u[0]}function gu(e,t){j(null!=e&&e.length>0,()=>"Expected at least one fetch, got none");let n=[],r={};if(1===e.length){let i=gh(e[0],t);n=i.sorted,r=i.recipientMap}else{let i=new Set;for(let s of e){let{sorted:e,recipientMap:a}=gh(s,t);for(let t of e)i.has(t.name)||(n.push(t),i.add(t.name));for(let e in a)null==r[e]&&(r[e]=new Set),a[e].forEach(t=>r[e].add(t))}}return{sorted:n,recipientCounts:gc(r)}}function gc(e){let t={};for(let n in e)t[n]=e[n].size;return t}function gh(e,t){let n=new Set,r=[],i={};for(let e of t.names())n.add(e);let s=[],a=[];for(s.push(e);s.length>0;){let e=s[s.length-1];if(n.has(e.name)){s.pop();continue}let t=a[a.length-1]===s.length-1;if(0===e.inputs.length||t)s.pop(),r.push(e),n.add(e.name),t&&a.pop();else for(let t of(a.push(s.length-1),e.inputs))null==i[t.name]&&(i[t.name]=new Set),i[t.name].add(e.name),n.has(t.name)||s.push(t)}return{sorted:r,recipientMap:i}}function gd(e){let t;if(1===e.sourceLayer.inboundNodes.length)t=e.sourceLayer.output;else{let n=null;for(let t=0;t<e.sourceLayer.inboundNodes.length;++t)for(let r of e.sourceLayer.inboundNodes[t].outputTensors)if(r.id===e.id){n=t;break}t=e.sourceLayer.getOutputAt(n)}return t}function gp(e,t){return i2(()=>s7(o8(s8(e,e),t,!0)))}eN().registerFlag("TOPOLOGICAL_SORT_CACHE_MAX_ENTRIES",()=>100,go);class gf extends aa{getConfig(){return{}}}class gg extends gf{constructor(e){super(),this.defaultMaxValue=2,this.defaultAxis=0,this.maxValue=null!=e.maxValue?e.maxValue:this.defaultMaxValue,this.axis=null!=e.axis?e.axis:this.defaultAxis}apply(e){return i2(()=>{let t=gp(e,this.axis);return s8(e,s5(oO(t,0,this.maxValue),s4(p6(),t)))})}getConfig(){return{maxValue:this.maxValue,axis:this.axis}}}gg.className="MaxNorm",al(gg);class gm extends gf{constructor(e){super(),this.defaultAxis=0,this.axis=null!=e.axis?e.axis:this.defaultAxis}apply(e){return i2(()=>s5(e,s4(p6(),gp(e,this.axis))))}getConfig(){return{axis:this.axis}}}gm.className="UnitNorm",al(gm);class gy extends gf{apply(e){return lN(e)}}gy.className="NonNeg",al(gy);class gb extends gf{constructor(e){super(),this.defaultMinValue=0,this.defaultMaxValue=1,this.defaultRate=1,this.defaultAxis=0,this.minValue=null!=e.minValue?e.minValue:this.defaultMinValue,this.maxValue=null!=e.maxValue?e.maxValue:this.defaultMaxValue,this.rate=null!=e.rate?e.rate:this.defaultRate,this.axis=null!=e.axis?e.axis:this.defaultAxis}apply(e){return i2(()=>{let t=gp(e,this.axis),n=s4(s8(this.rate,oO(t,this.minValue,this.maxValue)),s8(1-this.rate,t));return s8(e,s5(n,s4(p6(),t)))})}getConfig(){return{minValue:this.minValue,maxValue:this.maxValue,rate:this.rate,axis:this.axis}}}gb.className="MinMaxNorm",al(gb);let gv={maxNorm:"MaxNorm",minMaxNorm:"MinMaxNorm",nonNeg:"NonNeg",unitNorm:"UnitNorm"};function gw(e){return pv(e)}function g_(e,t={}){return p_(e,ao.getMap().classNameMap,t,"constraint")}function gx(e){return null==e?null:"string"==typeof e?g_({className:e in gv?gv[e]:e,config:{}}):e instanceof gf?e:g_(e)}async function gT(e){if(null==e)return;let t=[],n=[],r=[];for(let i in e){let s=e[i];if("number"!=typeof s){let e=s;t.push(e.data()),n.push(i),r.push(e)}}if(t.length>0){let i=await Promise.all(t);for(let t=0;t<i.length;++t)e[n[t]]=i[t][0];i3(r)}}function gI(e){if(null!=e)for(let t in e){let n=e[t];"number"!=typeof n&&n.dispose()}}!function(e){e[e.SILENT=0]="SILENT",e[e.VERBOSE=1]="VERBOSE"}(_||(_={}));let gk=125;class gS{constructor(){this.validationData=null}setParams(e){this.params=e}async onEpochBegin(e,t){}async onEpochEnd(e,t){}async onBatchBegin(e,t){}async onBatchEnd(e,t){}async onTrainBegin(e){}async onTrainEnd(e){}setModel(e){}}class gE{constructor(e,t=10){null==e&&(e=[]),this.callbacks=e,this.queueLength=t}append(e){this.callbacks.push(e)}setParams(e){for(let t of this.callbacks)t.setParams(e)}setModel(e){for(let t of this.callbacks)t.setModel(e)}async onEpochBegin(e,t){for(let n of(null==t&&(t={}),this.callbacks))await n.onEpochBegin(e,t)}async onEpochEnd(e,t){for(let n of(null==t&&(t={}),this.callbacks))await n.onEpochEnd(e,t)}async onBatchBegin(e,t){for(let n of(null==t&&(t={}),this.callbacks))await n.onBatchBegin(e,t)}async onBatchEnd(e,t){for(let n of(null==t&&(t={}),this.callbacks))await n.onBatchEnd(e,t)}async onTrainBegin(e){for(let t of(null==e&&(e={}),this.callbacks))await t.onTrainBegin(e)}async onTrainEnd(e){for(let t of(null==e&&(e={}),this.callbacks))await t.onTrainEnd(e)}}class gC extends gS{constructor(){super()}async onEpochBegin(e){this.seen=0,this.totals={}}async onBatchEnd(e,t){null==t&&(t={});let n=null==t.size?0:t.size;for(let e in this.seen+=n,t){let r=t[e];if("number"==typeof r)this.totals.hasOwnProperty(e)||(this.totals[e]=0),this.totals[e]=this.totals[e]+r*n;else{let t;e in this.totals?t=this.totals[e]:this.totals[e]=0;let i=i2(()=>s4(this.totals[e],s8(r,n)));this.totals[e]=i,null!=t&&t.dispose()}}}async onEpochEnd(e,t){if(null!=t)for(let e of this.params.metrics)null!=this.totals[e]&&("number"==typeof this.totals[e]?t[e]=this.totals[e]/this.seen:i2(()=>{let n=s8(s5(1,this.seen),this.totals[e]);t[e]=n,this.totals[e].dispose(),i4(t[e])}))}}class gA extends gS{async onTrainBegin(e){this.epoch=[],this.history={}}async onEpochEnd(e,t){for(let n in null==t&&(t={}),this.epoch.push(e),t)null==this.history[n]&&(this.history[n]=[]),this.history[n].push(t[n])}async syncData(){let e=[],t=[],n=[];for(let r in this.history){let i=this.history[r];for(let s=0;s<i.length;++s)if("number"!=typeof i[s]){let a=i[s];e.push(a.data()),t.push(r),n.push(s)}}let r=await Promise.all(e);for(let e=0;e<r.length;++e)this.history[t[e]][n[e]].dispose(),this.history[t[e]][n[e]]=r[e][0]}}class gN extends gS{constructor(e,t){if(super(),this.currentEpoch=0,this.nowFunc=e.nowFunc,this.nextFrameFunc=e.nextFrameFunc||uQ,this.yieldEvery=t||"auto","auto"===this.yieldEvery&&(this.yieldEvery=gk),"never"===this.yieldEvery&&null!=e.onYield)throw Error("yieldEvery is `never` but you provided an `onYield` callback. Either change `yieldEvery` or remove the callback");ec(this.yieldEvery)&&(this.maybeWait=pN(this.maybeWait.bind(this),this.yieldEvery,this.nowFunc)),this.trainBegin=e.onTrainBegin,this.trainEnd=e.onTrainEnd,this.epochBegin=e.onEpochBegin,this.epochEnd=e.onEpochEnd,this.batchBegin=e.onBatchBegin,this.batchEnd=e.onBatchEnd,this.yield=e.onYield}async maybeWait(e,t,n){let r=[];null!=this.yield&&(await gT(n),r.push(this.yield(e,t,n))),r.push(this.nextFrameFunc()),await Promise.all(r)}async onEpochBegin(e,t){this.currentEpoch=e,null!=this.epochBegin&&(await gT(t),await this.epochBegin(e,t))}async onEpochEnd(e,t){let n=[];null!=this.epochEnd&&(await gT(t),n.push(this.epochEnd(e,t))),"epoch"===this.yieldEvery&&n.push(this.nextFrameFunc()),await Promise.all(n)}async onBatchBegin(e,t){null!=this.batchBegin&&(await gT(t),await this.batchBegin(e,t))}async onBatchEnd(e,t){let n=[];null!=this.batchEnd&&(await gT(t),n.push(this.batchEnd(e,t))),"batch"===this.yieldEvery?n.push(this.nextFrameFunc()):ec(this.yieldEvery)&&n.push(this.maybeWait(this.currentEpoch,e,t)),await Promise.all(n)}async onTrainBegin(e){null!=this.trainBegin&&(await gT(e),await this.trainBegin(e))}async onTrainEnd(e){null!=this.trainEnd&&(await gT(e),await this.trainEnd(e))}}function gO(e,t){return(null==e&&(e={}),e instanceof gS)?[e]:Array.isArray(e)&&e[0]instanceof gS?e:pg(e).map(e=>new gN(e,t))}class g${constructor(){}static registerCallbackConstructor(e,t){j(e>=0&&Number.isInteger(e),()=>`Verbosity level is expected to be an integer >= 0, but got ${e}`),g$.checkForDuplicate(t),null==g$.constructors[e]&&(g$.constructors[e]=[]),g$.constructors[e].push(t)}static checkForDuplicate(e){for(let t in g$.constructors)g$.constructors[+t].forEach(t=>{if(t===e)throw new po("Duplicate callback constructor.")})}static clear(){g$.constructors={}}static createCallbacks(e){let t=[];for(let n in g$.constructors){let r=+n;e>=r&&t.push(...g$.constructors[r])}return t.map(e=>new e)}}function gR(e,t,n,r,i,s,a,o,l){let u=new gA,c=[new gC,...g$.createCallbacks(t)];null!=e&&c.push(...e),c.push(u);let h=new gE(c);return h.setParams({epochs:n,initialEpoch:r,samples:i,steps:s,batchSize:a,verbose:t,doValidation:o,metrics:l}),{callbackList:h,history:u}}function gD(e,t={},n=!1){return p_(e,ao.getMap().classNameMap,t,"layer",n)}function gF(e,t){return i2(()=>{"float32"!==e.dtype&&(e=s1(e,"float32"));let n=o8(fh(e),t,!0),r=ah(n.shape,p6()),i=s7(aw(n,r));return s5(e,i)})}function gP(e,t){return i2(()=>ld(fh(af(t,e)),-1))}function gM(e,t){return i2(()=>ld(am(af(t,e)),-1))}function gL(e,t){return i2(()=>{let n=af(e,t),r=oO(am(e),p6(),Number.MAX_VALUE);return s8(100,ld(am(s5(n,r)),-1))})}function gz(e,t,n=!1){return i2(()=>{if(n)t=lB(t);else{let e=o8(t,t.shape.length-1,!0);t=s5(t,e)}return t=oO(t,p6(),1-p6()),lm(o8(s8(s1(e,"float32"),o4(t)),t.shape.length-1))})}function gB(e,t,n=!1){return i2(()=>{let r=s1(oZ(fe(e)),"int32"),i=(t=oO(t,p6(),1-p6())).shape;return gz(ox(lb(r,i[i.length-1]),i),t,n)})}function gU(e,t){if(!H(e.shape,t.shape))throw new po(`logits and labels must have the same shape, but got shapes ${JSON.stringify(e.shape)} and ${JSON.stringify(t.shape)}`);return i2(()=>{let n=lN(t),r=lm(am(t));return s4(af(n,s8(t,e)),o6(oX(r)))})}function gV(e,t){return i2(()=>{let n;return ld(gU(e,n=o4(s5(n=oO(t,p6(),1-p6()),af(1,n)))),-1)})}function gj(e,t){return i2(()=>lm(o8(s8(gF(e,-1),gF(t,-1)),-1)))}g$.constructors={};let gG={meanSquaredError:gP,meanAbsoluteError:gM,meanAbsolutePercentageError:gL,meanSquaredLogarithmicError:function(e,t){return i2(()=>ld(fh(af(o4(s4(1,oO(t,p6(),Number.MAX_VALUE))),o4(s4(1,oO(e,p6(),Number.MAX_VALUE))))),-1))},squaredHinge:function(e,t){return i2(()=>ld(fh(aw(0,af(1,s8(e,t)))),-1))},hinge:function(e,t){return i2(()=>ld(aw(0,af(1,s8(e,t))),-1))},categoricalHinge:function(e,t){return i2(()=>{let n=o8(s8(e,t),-1),r=o5(s8(af(1,e),t),-1);return aw(0,s4(1,af(r,n)))})},logcosh:function(e,t){return i2(()=>{let n=Math.log(2),r=af(t,e);return ld(af(s4(r,lU(s8(-2,r))),n),-1)})},categoricalCrossentropy:gz,sparseCategoricalCrossentropy:gB,binaryCrossentropy:gV,kullbackLeiblerDivergence:function(e,t){return i2(()=>{let n=oO(e,p6(),1);return o8(s8(e,o4(s5(n,oO(t,p6(),1)))),-1)})},poisson:function(e,t){return i2(()=>{let n=o4(s4(p6(),t));return ld(af(t,s8(e,n)),-1)})},cosineProximity:gj};function gW(e){if("string"!=typeof e)return e;{if(e in gG)return gG[e];let t=`Unknown loss ${e}`;throw e.toLowerCase().includes("softmaxcrossentropy")&&(t=`Unknown loss ${e}. Use "categoricalCrossentropy" as the string name for tf.losses.softmaxCrossEntropy`),new po(t)}}function gq(e,t){return i2(()=>{let n=s8(.5,l_(t)),r=p8(o1(t,n),e.dtype);return ld(oH(e,r),-1)})}function gH(e,t){return i2(()=>p8(oH(on(e,-1),on(t,-1)),"float32"))}function gK(e,t){return i2(()=>s1(o8(ll(oH(e,1),oH(t,1))),"float32"))}function gX(e,t){return i2(()=>s1(o8(ll(oH(e,0),oH(t,1))),"float32"))}function gY(e,t){return gV(e,t)}function gQ(e,t){return e.rank===t.rank&&(e=lj(e,[e.rank-1])),(t=on(t,-1)).dtype!==e.dtype&&(t=s1(t,e.dtype)),s1(oH(e,t),"float32")}let gJ=gz,gZ=gB,g0={binaryAccuracy:gq,categoricalAccuracy:gH,precision:function(e,t){return i2(()=>{let n=gK(e,t),r=s4(n,gX(e,t));return s1(lQ(o1(r,0),s5(n,r),0),"float32")})},categoricalCrossentropy:gJ,sparseCategoricalCrossentropy:gZ,mse:gP,MSE:gP,mae:gM,MAE:gM,mape:gL,MAPE:gL,cosine:gj};function g1(e){if("string"==typeof e&&e in g0)return g0[e];if("string"!=typeof e&&null!=e)return e;throw new po(`Unknown metric ${e}`)}function g2(e){if(pd(null!==e,`Unknown LossOrMetricFn ${e}`),"string"==typeof e)return e;{let t;for(let n of Object.keys(gG))if(gG[n]===e){t=n;break}if(void 0!==t)return t;for(let n of Object.keys(g0))if(g0[n]===e){t=n;break}return void 0!==t?t:e.name}}function g3(e){let t={Adagrad:()=>uX.adagrad(.01),Adadelta:()=>uX.adadelta(1,.95,p6()),Adam:()=>uX.adam(.001,.9,.999,p6()),Adamax:()=>uX.adamax(.002,.9,.999,p6(),0),RMSProp:()=>uX.rmsprop(.001,.9,0,p6()),SGD:()=>uX.sgd(.01)};if(t.adagrad=t.Adagrad,t.adadelta=t.Adadelta,t.adam=t.Adam,t.adamax=t.Adamax,t.rmsprop=t.RMSProp,t.sgd=t.SGD,e in t)return t[e]();throw new po(`Unknown Optimizer ${e}`)}let g4=1048576;function g6(e,t,n=!1){if(null==e||"object"!=typeof e||Object.getPrototypeOf(e)!==Object.prototype||!g5(e))throw Error("User-defined metadata is expected to be a JSON object, but is not.");if(n){let n=JSON.stringify(e);n.length>g4&&console.warn(`User-defined metadata of model "${t}" is too large in size (length=${n.length} when serialized). It is not recommended to store such large objects in user-defined metadata. Please make sure its serialized length is <= ${g4}.`)}}function g5(e){if(null===e)return!0;if("object"==typeof e){if(Object.getPrototypeOf(e)===Object.prototype){for(let t of Object.keys(e))if("string"!=typeof t||!g5(e[t]))return!1;return!0}if(!Array.isArray(e))return!1;for(let t of e)if(!g5(t))return!1;return!0}{let t=typeof e;return"string"===t||"number"===t||"boolean"===t}}function g8(e,t,n,r=console.log){let i;let s=g9(e),a=["Layer (type)","Input Shape","Output shape","Param #"];if(s?(t=t||90,n=n||[.32,.61,.89,1]):(t=t||115,n=n||[.24,.48,.7,.8,1]),n[n.length-1]<=1&&(n=n.map(e=>Math.floor(t*e))),!s)for(let t in a.push("Receives inputs"),i=[],e.nodesByDepth)i.push(...e.nodesByDepth[t]);r("_".repeat(t)),me(a,n,r),r("=".repeat(t));let o=e.layers;for(let e=0;e<o.length;++e)s?mt(o[e],n,r):mn(o[e],n,i,r),r((e===o.length-1?"=":"_").repeat(t));e.checkTrainableWeightsConsistency();let l=g7(e),u=fK(e.nonTrainableWeights);r(`Total params: ${l+u}`),r(`Trainable params: ${l}`),r(`Non-trainable params: ${u}`),r("_".repeat(t))}function g7(e){return null!=e.collectedTrainableWeights?fK(e.collectedTrainableWeights):fK(e.trainableWeights)}function g9(e){let t=!0,n=[],r=[];for(let t in e.nodesByDepth)n.push(e.nodesByDepth[t]);for(let e of n){if(e.length>1||1===e.length&&e[0].inboundLayers.length>1){t=!1;break}r.push(...e)}if(t)for(let n of e.layers){let e=!1;for(let i of n.inboundNodes)if(-1!==r.indexOf(i)){if(e){t=!1;break}e=!0}if(!t)break}return t}function me(e,t,n=console.log){let r="";for(let n=0;n<e.length;++n)n>0&&(r=r.slice(0,r.length-1)+" "),r+=e[n],r=r.slice(0,t[n]),r+=" ".repeat(t[n]-r.length);n(r)}function mt(e,t,n){let r,i;try{i=e.inboundNodes.map(e=>JSON.stringify(e.inputShapes)).join(",")}catch(e){i="multiple"}try{r=JSON.stringify(e.outputShape)}catch(e){r="multiple"}let s=e.name,a=e.getClassName();me([`${s} (${a})`,i,r,e.countParams().toString()],t,n)}function mn(e,t,n,r){let i,s;try{s=e.inboundNodes.map(e=>JSON.stringify(e.inputShapes)).join(",")}catch(e){s="multiple"}try{i=JSON.stringify(e.outputShape)}catch(e){i="multiple"}let a=[];for(let t of e.inboundNodes)if(null==n||!(n.length>0)||-1!==n.indexOf(t))for(let e=0;e<t.inboundLayers.length;++e){let n=t.inboundLayers[e].name,r=t.nodeIndices[e],i=t.tensorIndices[e];a.push(`${n}[${r}][${i}]`)}let o=e.name,l=e.getClassName(),u=0===a.length?"":a[0];me([`${o} (${l})`,s,i,e.countParams().toString(),u],t,r);for(let e=1;e<a.length;++e)me(["","","","",a[e]],t,r)}function mr(e,t,n){return("inboundNodes"===e||"outputLayers"===e||"inputLayers"===e)&&0===t&&"string"==typeof n}function mi(e,t){if(null===e)return null;if("string"==typeof e)return py(e);if("number"==typeof e||"boolean"==typeof e)return e;if(e instanceof Array){let n=[],r=e.length;for(let i=0;i<r;++i){let r=e[i];mr(t,i,r)?n.push(r):n.push(mi(r,t))}return n}{let t={};for(let n of Object.keys(e)){let r=e[n];if("name"===n&&"string"==typeof r)t[n]=r;else{let e=py(n);t[e]=mi(r,e)}}return t}}function ms(e,t){if(null==e)return null;if("string"==typeof e)return pm(e);if("number"==typeof e||"boolean"==typeof e)return e;if(e instanceof Array){let n=[],r=e.length;for(let i=0;i<r;++i){let r=e[i];mr(t,i,r)?n.push(r):n.push(ms(r,t))}return n}{let t={};for(let n of Object.keys(e)){let r=e[n],i=pm(n);("name"===n||"className"===n)&&"string"==typeof r?t[i]=r:t[i]=ms(r,n)}return t}}let ma="4.22.0",mo=e=>{let t=Object.keys(e);if(0===t.length)return!1;let n=t[0].split("/");return!isNaN(parseInt(n[n.length-1],10))};class ml extends f6{constructor(e){if(super({}),this.containerNodes=new Set,this.name=e.name,null==this.name){let e=this.getClassName().toLowerCase();this.name=pF(e)}if(this.supportsMasking=!1,this.trainable_=!0,Array.isArray(e.inputs)?this.inputs=e.inputs.slice():this.inputs=[e.inputs],Array.isArray(e.outputs)?this.outputs=e.outputs.slice():this.outputs=[e.outputs],pI(this.inputs).length!==this.inputs.length)throw new po(`The list of inputs passed to the model is redundant. All inputs should only appear once. Found: ${this.inputs.map(e=>e.name)}`);for(let e of(pI(this.outputs).length!==this.outputs.length&&console.warn(`The list of outputs passed to the model is redundant. All outputs should only appear once. Found: ${this.outputs.map(e=>e.name)}`),this.inputLayers=[],this.inputLayersNodeIndices=[],this.inputLayersTensorIndices=[],this.outputLayers=[],this.outputLayersNodeIndices=[],this.outputLayersTensorIndices=[],this.layers=[],this.internalContainerRefs=[],this.outputs)){let t=e.sourceLayer,n=e.nodeIndex,r=e.tensorIndex;this.outputLayers.push(t),this.outputLayersNodeIndices.push(n),this.outputLayersTensorIndices.push(r)}for(let e of this.inputs){let t=e.sourceLayer,n=e.nodeIndex,r=e.tensorIndex;pd(0===n,"input layer has >1 nodes"),pd(0===r,"input layer has >1 tensors"),this.inputLayers.push(t),this.inputLayersNodeIndices.push(n),this.inputLayersTensorIndices.push(r)}this.inputNames=[],this.outputNames=[],this.feedInputShapes=[],this.feedInputNames=[],this.feedOutputNames=[];for(let t=0;t<this.inputLayers.length;t++){let n=this.inputLayers[t];if(!(n instanceof gt))throw TypeError(`Input layers to a LayersModel must be InputLayer objects. Received inputs: ${e.inputs}. Input ${t} (0-based) originates from layer type ${n.getClassName()}.`);this.inputNames.push(n.name),this.feedInputShapes.push(n.batchInputShape),this.feedInputNames.push(n.name)}for(let e of this.outputLayers)this.outputNames.push(e.name);this.internalInputShapes=this.inputs.map(e=>e.shape),this.internalOutputShapes=this.outputs.map(e=>e.shape);let t={},n={},r={},i={},s={},a=[],o=(e,t,n,r,i,l)=>{(null==r||null==i||null==l)&&(r=e.sourceLayer,i=e.nodeIndex,l=e.tensorIndex);let u=r.inboundNodes[i];if(-1!==n.indexOf(u))throw new pa(`The tensor ${e.name} at layer "${r.name}" is part of a cycle.`);if(-1!==t.indexOf(u))return;this.containerNodes.add(ml.nodeKey(r,i)),r.id in s||(s[r.id]=Object.keys(s).length),-1===n.indexOf(u)&&n.push(u);let c=u.inboundLayers.length;for(let e=0;e<c;e++){let r=u.inputTensors[e];o(r,t,n,u.inboundLayers[e],u.nodeIndices[e],u.tensorIndices[e])}for(t.push(u);n.indexOf(u)>=0;)n.splice(n.indexOf(u),1);a.push(u)},l=[],u=[];for(let e of this.outputs)o(e,l,u);for(let e of a.slice().reverse()){n[e.id]=e,e.id in t||(t[e.id]=0);let s=t[e.id];s=Math.max(s,null==r[e.outboundLayer.id]?0:r[e.outboundLayer.id]),r[e.outboundLayer.id]=s,i[e.outboundLayer.id]=e.outboundLayer,t[e.id]=s;for(let r=0;r<e.inboundLayers.length;r++){let i=e.inboundLayers[r],a=e.nodeIndices[r],o=i.inboundNodes[a],l=null==t[o.id]?0:t[o.id];t[o.id]=Math.max(s+1,l),n[o.id]=o}}let c={};for(let e in t){let r=t[e];r in c||(c[r]=[]),c[r].push(n[e])}let h={};for(let e in r){let t=r[e];t in h||(h[t]=[]),h[t].push(i[e])}let d=Object.keys(h).map(e=>parseInt(e,10)).sort(pT);for(let e of(this.layers=[],d)){let t=h[e];for(let e of(t.sort((e,t)=>{let n=s[e.id],r=s[t.id];return n<r?-1:n>r?1:0}),t))e instanceof ml&&this.internalContainerRefs.push(e),this.layers.push(e)}this.layersByDepth=h,d=Object.keys(c).map(e=>parseInt(e,10)).sort(pT);let p=this.inputs.slice(),f=[];for(let e of d)for(let t of c[e]){let e=t.outboundLayer;if(null!=e){for(let n of t.inputTensors)if(-1===p.indexOf(n))throw new pa(`Graph disconnected: cannot obtain value for tensor ${n} at layer "${e.name}". The following previous layers were accessed without issue: ${f}`);for(let e of t.outputTensors)p.push(e);f.push(e.name)}}this.nodesByDepth=c;let g=this.layers.map(e=>e.name);for(let e of g){let t=g.filter(t=>t===e).length;if(1!==t)throw new pa(`The name "${e}" is used ${t} times in the model. All layer names should be unique. Layer names: `+JSON.stringify(g))}this.outboundNodes=[],this.inboundNodes=[],new f3({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:this.inputs.map(e=>null),outputMasks:this.outputs.map(e=>null),inputShapes:this.inputs.map(e=>e.shape),outputShapes:this.outputs.map(e=>e.shape)}),this.built=!0,this._refCount=1}assertNotDisposed(){if(0===this._refCount)throw Error(`Container '${this.name}' is already disposed.`)}dispose(){this.assertNotDisposed();let e={refCountAfterDispose:null,numDisposedVariables:0};if(0==--this._refCount){for(let t of this.layers)e.numDisposedVariables+=t.dispose().numDisposedVariables;for(let t of this.internalContainerRefs)e.numDisposedVariables+=t.dispose().numDisposedVariables}return e.refCountAfterDispose=this._refCount,e}get trainable(){return this.trainable_}set trainable(e){this.layers.forEach(t=>{t._trainableWeights.forEach(t=>t.trainable=e)}),this.trainable_=e}get trainableWeights(){if(this._trainableWeights.length>0)throw new po("Container instance unexpectedly contains _trainableWeights.The trainable weights of a Container are a union of the trainable weights of its consituent Layers. Its own _trainableWeights must remain an empty Array.");if(!this.trainable)return[];let e=[];for(let t of this.layers)e=e.concat(t.trainableWeights);return e}get nonTrainableWeights(){let e=[];for(let t of this.layers)e.push(...t.nonTrainableWeights);if(!this.trainable){let t=[];for(let e of this.layers)t.push(...e.trainableWeights);return t.concat(e)}return e}get weights(){return this.trainableWeights.concat(this.nonTrainableWeights)}loadWeights(e,t=!0){let n={},r=0,i=mo(e);for(let t of(i&&this.parseWeights(e),this.layers))for(let[e,s]of t.weights.entries()){let t=i?`${s.name.split("/").slice(0,-1).join("/")+"/"}${e}`:s.originalName;if(null!=n[t])throw new po(`Duplicate weight name: ${t}`);n[t]=s,r++}let s=[];for(let r in e){let i=r;if(null==n[r]){let e=r.split("/");i=e.slice(0,-2).concat([e[e.length-1]]).join("/")}if(null!=n[i])s.push([n[i],e[r]]);else if(t)throw new po(`Provided weight data has no target variable: ${r}`);delete n[i]}if(t){let e=[];for(let t in n)e.push(t);if(e.length>0)throw new po(`${e.length} of ${r} weights are not set: ${e}`)}fZ(s)}parseWeights(e){for(let t in Object.keys(e)){let n=t.split("/"),r=["vars","layer_checkpoint_dependencies"],i=n.map(e=>e.startsWith("_")?e.slice(1):e).filter(e=>!r.includes(e)).join("/");i!==t&&(e[i]=e[t],delete e[t])}}updatedConfig(){let e=this.getConfig(),t={};return t.className=this.getClassName(),t.config=e,t.kerasVersion=`tfjs-layers ${ma}`,t.backend="TensorFlow.js",t}toJSON(e,t=!0){let n=ms(this.updatedConfig());return t?JSON.stringify(n):n}call(e,t){return i2(()=>{e=pg(e);let n=new gi;for(let t=0;t<this.inputs.length;++t)n.add(this.inputs[t],e[t]);return gl(this.outputs,n,t)})}computeMask(e,t){return i2(()=>{let n;return e=pg(e),n=null==t?ph(null,e.length):pg(t),this.runInternalGraph(e,n)[1]})}computeOutputShape(e){let t=fW(e);if(t.length!==this.inputLayers.length)throw new po(`Invalid inputShape argument ${e}: model has ${this.inputLayers.length} tensor inputs.`);let n={};for(let e=0;e<t.length;e++){let r=this.inputLayers[e],i=t[e];n[r.name+"_0_0"]=i}let r=Object.keys(this.nodesByDepth).map(e=>parseInt(e,10)).sort(pT);if(r.length>1)for(let e of r)for(let t of this.nodesByDepth[e]){let e=t.outboundLayer;if(-1!==this.inputLayers.map(e=>e.id).indexOf(e.id))continue;let r=[];for(let e=0;e<t.inboundLayers.length;e++){let i=t.inboundLayers[e],s=t.nodeIndices[e],a=t.tensorIndices[e],o=n[`${i.name}_${s}_${a}`];r.push(o)}let i=fW(e.computeOutputShape(pf(r))),s=e.inboundNodes.indexOf(t);for(let t=0;t<i.length;t++)n[`${e.name}_${s}_${t}`]=i[t]}let i=[],s=[];for(let e=0;e<this.outputLayers.length;e++){let t=this.outputLayers[e],n=this.outputLayersNodeIndices[e],r=this.outputLayersTensorIndices[e],i=`${t.name}_${n}_${r}`;s.push(i)}for(let e=0;e<s.length;e++){let t=s[e];pd(t in n),i.push(n[t])}return pf(i)}runInternalGraph(e,t){null==t&&(t=ph(null,e.length));let n={};for(let r=0;r<this.inputs.length;++r){let i=this.inputs[r],s=e[r],a=t[r];n[i.id]=[s,a]}for(let e of Object.keys(this.nodesByDepth).map(e=>parseInt(e,10)).sort(pT))for(let t of this.nodesByDepth[e]){let e=t.outboundLayer,r=t.inputTensors,i=t.outputTensors,s=[];for(let e of r)e.id in n&&s.push(n[e.id]);if(s.length===r.length){let r,a,o,l,u={};if(null!=t.callArgs&&(u=t.callArgs),1===s.length){let[t,n]=s[0];null==u.mask&&(u.mask=n),o=pg(e.call(t,u)),l=pg(e.computeMask(t,n)),r=[t],a=[n]}else r=s.map(e=>e[0]),a=s.map(e=>e[1]),null==u.mask&&(u.mask=a),o=pg(e.call(r,u)),l=pg(e.computeMask(r,a));if(e.activityRegularizer)throw new pl("LayersModel invocation with concrete Tensor value(s) in the presence of activity regularizer(s) is not supported yet.");for(let e=0;e<i.length;++e){let t=i[e],r=o[e],s=l[e];n[t.id]=[r,s]}}}let r=[],i=[],s=[];for(let e of this.outputs){pd(e.id in n,`Could not compute output ${e.name} : ${e.id}`);let[t,a]=n[e.id];s.push(t.shape),r.push(t),i.push(a)}return[r,i,s]}buildNodeConversionMap(e){let t;let n={};for(let e of this.layers){t=e instanceof ml?1:0;for(let r=0;r<e.inboundNodes.length;r++){let i=ml.nodeKey(e,r);this.containerNodes.has(i)&&(n[i]=t,t+=1)}}return n}getLayer(e,t){if(null!=t)return this.findLayer(t);if(null==e)throw new po("Provide either a layer name or layer index");if("number"==typeof e)return this.findLayer(e);for(let t of this.layers)if(t.name===e)return t;throw new po(`No such layer: ${e}`)}findLayer(e){if(!(this.layers.length<=e))return this.layers[e];throw new po(`Was asked to retrieve layer at index ${e}, but model only has ${this.layers.length} layer(s).`)}calculateLosses(){return i2(()=>{let e=[];for(let t of this.layers)for(let n=0;n<t.inboundNodes.length;++n){let r=ml.nodeKey(t,n);this.containerNodes.has(r)&&e.push(...t.calculateLosses())}return e})}getConfig(){let e={name:this.name},t=this.buildNodeConversionMap(this.layers),n=[];for(let e of this.layers){let r=e.getClassName(),i=e.getConfig(),s=[];for(let n=0;n<e.inboundNodes.length;n++){let r=e.inboundNodes[n],i=ml.nodeKey(e,n),a={};if(this.containerNodes.has(i)){if(r.callArgs)try{JSON.stringify(r.callArgs),a=r.callArgs}catch(t){console.warn(`Layer ${e.name} was passed non-serializable keyword arguments: ${r.callArgs}. They will not be included in the serialized model (and thus will be missing at deserialization time).`),a={}}if(r.inboundLayers.length>0){let e=[];for(let n=0;n<r.inboundLayers.length;n++){let i=r.inboundLayers[n],s=r.nodeIndices[n],o=r.tensorIndices[n],l=t[ml.nodeKey(i,s)];null==l&&(l=0),e.push([i.name,l,o,a])}s.push(e)}}}let a={};a.name=e.name,a.className=r,a.config=i,a.inboundNodes=s,n.push(a)}e.layers=n;let r=[];for(let e=0;e<this.inputLayers.length;e++){let n=this.inputLayers[e],i=this.inputLayersNodeIndices[e],s=ml.nodeKey(n,i);if(!this.containerNodes.has(s))continue;let a=t[s];null==a&&(a=0);let o=this.inputLayersTensorIndices[e];r.push([n.name,a,o])}e.inputLayers=r;let i=[];for(let e=0;e<this.outputLayers.length;e++){let n=this.outputLayers[e],r=this.outputLayersNodeIndices[e],s=ml.nodeKey(n,r);if(!this.containerNodes.has(s))continue;let a=t[s];null==a&&(a=0);let o=this.outputLayersTensorIndices[e];i.push([n.name,a,o])}return e.outputLayers=i,e}static fromConfig(e,t,n={},r=!1){let i={},s={};function a(e,t){e.name in s?s[e.name].push(t):s[e.name]=[t]}function o(e,t){let n;let r=[];for(let s of t){let o=s[0],l=s[1],u=s[2];if(n=null==s[3]?{}:s[3],!(o in i)){a(e,t);return}let c=i[o];if(c.inboundNodes.length<=l){a(e,t);return}let h=c.inboundNodes[l];r.push(h.outputTensors[u])}r.length>0&&e.apply(pf(r),n)}function l(e){let n=e.name,s=gD(e,null!=t.customObjects?t.customObjects:{});s.setFastWeightInitDuringBuild(r),i[n]=s,e.inboundNodes.forEach(e=>{if(!(e instanceof Array))throw new po(`Corrupted configuration, expected array for nodeData: ${e}`);a(s,e)})}let u=t.name,c=t.layers;for(let e of c)l(e);for(;!pk(s);)for(let e of c){let t=i[e.name];if(t.name in s){let e=s[t.name];for(let n of(delete s[t.name],e))o(t,n)}}let h=[],d=[];for(let e of t.inputLayers){let t=e[0],n=e[1],r=e[2];pd(t in i);let s=i[t].inboundNodes[n].outputTensors;h.push(s[r])}for(let e of t.outputLayers){let t=e[0],n=e[1],r=e[2];pd(t in i);let s=i[t].inboundNodes[n].outputTensors;d.push(s[r])}return new e({inputs:h,outputs:d,name:u})}get stateful(){if(this._stateful)throw new po("Container instance unexpectedly has _stateful = true. The statefulness of a Container is determined by the Layers it contains. Its _stateful property must remain the default false.");for(let e of this.layers)if(e.stateful)return!0;return!1}resetStates(){i2(()=>{this.layers.forEach(e=>{e.stateful&&e.resetStates()})})}}function mu(e,t,n){let r=t.length;if(null==e||Array.isArray(e)&&0===e.length)return t.map(e=>null);if(1===r)return Array.isArray(e)&&1===e.length?e:"object"==typeof e&&t[0]in e?[e[t[0]]]:[e];if(Array.isArray(e)){if(e.length!==r)throw Error(`Provided ${n} is an array of ${e.length} element(s), but the model has ${r} outputs. Make sure a set of weights is provided for each model output.`);return e}if("object"==typeof e&&Object.keys(e).length>0&&"object"==typeof e[Object.keys(e)[0]]){let n=[];return t.forEach(t=>{t in e?n.push(e[t]):n.push(null)}),n}throw Error(`The model has multiple (${r}) outputs, so ${n} must be either an array with ${r} elements or an object with ${t} keys. Provided ${n} not understood: ${JSON.stringify(e)}`)}function mc(e,t){return mu(e,t,"classWeight")}async function mh(e,t,n,r){if(null!=t||null!=r)throw Error("Support sampleWeight is not implemented yet");if(null==n)return null;{let t=i2(()=>{if(1===e.shape.length)return s2(e);if(2===e.shape.length){if(e.shape[1]>1)return on(e,1);if(1===e.shape[1])return ox(e,[e.shape[0]]);throw Error(`Encountered unexpected last-dimension size (${e.shape[1]}) during handling of class weights. The size is expected to be >= 1.`)}throw Error(`Unexpected rank of target (y) tensor (${e.rank}) during handling of class weights. The rank is expected to be 1 or 2.`)}),r=Array.from(await t.data());i3(t);let i=[];return r.forEach(e=>{if(null==n[e])throw Error(`classWeight must contain all classes in the training data. The class ${e} exists in the data but not in classWeight`);i.push(n[e])}),lq(i,"float32")}}function md(e,t){return s8(e,t)}let mp=32;function mf(e,t){let n,r;let i=t;n=i.xs,r=i.ys,j(null!=n&&null!=r,()=>`A Dataset iterator for fitDataset() is expected to generate objects of the form \`{xs: xVal, ys: yVal}\`, where the two values may be \`tf.Tensor\`, an array of Tensors, or a map of string to Tensor.  The provided Dataset instead generates ${t}`);let s=mg("input",e.inputNames,n),a=mg("output",e.outputNames,r),o=s[0].shape[0];j(s.length===e.inputs.length,()=>`LayersModel has ${e.inputs.length} inputs, but the dataset provides ${s.length} inputs.  (Expected input keys: ${JSON.stringify(e.inputNames)})`),j(a.length===e.outputs.length,()=>`LayersModel has ${e.outputs.length} outputs, but the dataset provides ${a.length} outputs.  (Expected output keys: ${JSON.stringify(e.outputNames)})`);for(let t=0;t<s.length;t++)j(s[t].shape[0]===o,()=>`Batch size mismatch: input ${e.inputNames[t]} has ${s[t].shape[0]}; expected  ${o} based on input ${e.inputNames[0]}.`);for(let t=0;t<a.length;t++)j(a[t].shape[0]===o,()=>`Batch size mismatch: output ${e.outputNames[t]} has ${a[t].shape[0]}; expected  ${o} based on input ${e.inputNames[0]}.`);return{xs:s,ys:a}}function mg(e,t,n){if(n instanceof im)return[n];if(Array.isArray(n))return j(n.length===t.length,()=>`Received an array of ${n.length} Tensors, but expected ${t.length} to match the ${e} keys ${t}.`),n;{let r=[];for(let i of t){if(null==n[i])throw new po(`The feature data generated by the dataset lacks the required ${e} key '${i}'.`);r.push(n[i])}return r}}function mm(e){if(3===e.length)throw new pl("Validation with sample weights is not implemented yet.");return{xs:e[0],ys:e[1]}}async function my(e,t,n){let r=null!=n.batchesPerEpoch;if(j(null!=e.optimizer,()=>"You must compile a model before training/testing. Use LayersModel.compile(modelCompileConfig)."),j(null!=n,()=>"For fitDataset(), the 2nd argument (config) is required, but it is not provided in this call."),j(null!=n.epochs&&n.epochs>0&&Number.isInteger(n.epochs),()=>`For fitDataset(), config.epochs is expected to be a positive integer, but got ${n.epochs}`),j(!r||n.batchesPerEpoch>0&&Number.isInteger(n.batchesPerEpoch),()=>`For fitDataset(), config.batchesPerEpoch is expected to be a positive integer if specified, but got ${n.batchesPerEpoch}`),j(null==n.validationSplit,()=>"`validationSplit` is not supported by `fitDataset()`. Use validationData instead."),e.isTraining)throw Error("Cannot start training because another fit() call is ongoing.");e.isTraining=!0;try{let i,s,a;let o=null!=n.validationData;if(o){if(mv(n.validationData))j(null==n.validationBatches||n.validationBatches>0&&Number.isInteger(n.validationBatches),()=>`For fitDataset() with dataset-based validation, config.validationBatches is expected not to be provided, or to be a positive integer, but got ${n.validationBatches}`);else{let e=mm(n.validationData);i=e.xs,s=e.ys}}let l=e.makeTrainFunction(),u=e.getDedupedMetricsNames();a=o?u.slice().concat(u.map(e=>"val_"+e)):u.slice();let c=gO(n.callbacks,n.yieldEvery),h=null==n.verbose?1:n.verbose,{callbackList:d,history:p}=gR(c,h,n.epochs,null,null,mb(t,n),null,o,a);d.setModel(e),e.history=p,await d.onTrainBegin(),e.stopTraining_=!1;let f=null==n.initialEpoch?0:n.initialEpoch,g=await t.iterator();for(;f<n.epochs;){let a={};await d.onEpochBegin(f);let c=0,h=0;for(r||(g=await t.iterator());!r||c<n.batchesPerEpoch;){let t=await g.next();if(r&&t.done){console.warn(`You provided \`batchesPerEpoch\` as ${n.batchesPerEpoch}, but your dataset iterator ran out of data after ${c} batches; interrupting training. Make sure that your dataset can generate at least \`batchesPerEpoch * epochs\` batches (in this case, ${n.batchesPerEpoch*n.epochs} batches). You may need to use the repeat() function when building your dataset.`);break}if(null!=t.value){let{xs:r,ys:i}=mf(e,t.value),s={};s.batch=h,s.size=r[0].shape[0],await d.onBatchBegin(h,s);let a=[];if(null!=n.classWeight){let t=mc(n.classWeight,e.outputNames);for(let e=0;e<t.length;++e)a.push(await mh(i[e],null,t[e]))}let o=r.concat(i).concat(a),p=l(o);i3(o);for(let e=0;e<u.length;++e){let t=u[e],n=p[e];s[t]=n,i4(n)}await d.onBatchEnd(h,s),gI(s),h++,c++}if(r?c>=n.batchesPerEpoch:t.done){if(o){let t;t=mv(n.validationData)?pg(await e.evaluateDataset(n.validationData,{batches:n.validationBatches})):pg(e.evaluate(i,s,{batchSize:null==n.validationBatchSize?mp:n.validationBatchSize,verbose:0}));for(let n=0;n<e.metricsNames.length;++n)a[`val_${e.metricsNames[n]}`]=t[n]}break}if(e.stopTraining_)break}if(await d.onEpochEnd(f,a),f++,e.stopTraining_)break}return await d.onTrainEnd(),await e.history.syncData(),e.history}finally{e.isTraining=!1}}function mb(e,t){let n=null;return null!=t.batchesPerEpoch?n=t.batchesPerEpoch:Number.isFinite(e.size)&&(n=e.size),n}function mv(e){return"function"==typeof e.iterator}function mw(e){return"function"==typeof e.next}async function m_(e,t,n){let r=null!=(n=n||{}).batches,i=e.testFunction,s=[];if(n.verbose>0)throw new pl("Verbose mode is not implemented yet.");j(!r||n.batches>0&&Number.isInteger(n.batches),()=>`Test loop expects \`batches\` to be a positive integer, but received ${JSON.stringify(n.batches)}`);let a=mw(t)?t:await t.iterator(),o=0,l=0;for(;!r||l<n.batches;){let t=await a.next();if(s=i2(()=>{if(t.value){let{xs:n,ys:r}=mf(e,t.value),a=n.concat(r),u=i2(()=>i(a));if(i3(a),0===l)for(let e=0;e<u.length;++e)s.push(ar(0));let c=a[0].shape[0];for(let e=0;e<u.length;++e){let t=u[e],n=s[e];s[e]=i2(()=>s4(s[e],s8(c,t))),l>0&&i3(n)}i3(u),o+=c,++l}return s}),t.done){r&&console.warn(`Your dataset iterator ran out of data during evaluateDataset(). Interrupting evalution. Make sure that your dataset can generate at least \`batches\` batches (in this case, ${n.batches} batches). You may need to use the repeat() function when building your dataset.`);break}}for(let e=0;e<s.length;++e){let t=s[e];s[e]=s5(s[e],o),i3(t)}return pf(s)}function mx(e){j(e>0&&Number.isInteger(e),()=>`batchSize is required to be a positive integer, but got ${e}`)}function mT(e,t,n){return null==e?[null]:Array.isArray(e)?e.map(e=>fn(e,t,n-t)):fn(e,t,n-t)}function mI(e,t){return i2(()=>null==e?null:Array.isArray(e)?e.map(e=>mI(e,t)):fc(e,"int32"===t.dtype?t:s1(t,"int32")))}function mk(e,t){let n=[],r=0,i=null;for(;r<e;)(i=r+t)>=e&&(i=e),n.push([r,i]),r=i;return n}function mS(e){let t=[];e instanceof im&&(e=[e]);for(let n=0;n<e.length;++n){let r=e[n];if(1===r.rank)t.push(p7(r,1));else if(0===r.rank)throw Error("Expected tensor to be at least 1D, but received a 0D tensor (scalar).");else t.push(r)}return t}function mE(e,t){if(null==e)return;let n=[];if(t instanceof im)n.push(t.id);else if(Array.isArray(t))t.forEach(e=>n.push(e.id));else if(null!=t)for(let e in t){let r=t[e];n.push(r.id)}let r=[];if(e instanceof im)-1===n.indexOf(e.id)&&r.push(e);else if(Array.isArray(e))e.forEach(e=>{-1===n.indexOf(e.id)&&r.push(e)});else if(null!=e)for(let t in e){let i=e[t];-1===n.indexOf(i.id)&&r.push(i)}r.forEach(e=>{e.isDisposed||e.dispose()})}function mC(e){return e instanceof im}function mA(e){return Array.isArray(e)}function mN(e){return!mC(e)&&!mA(e)}function mO(e,t,n,r=!0,i=""){let s;if(null==t||0===t.length){if(null!=e){let t=!1;if(mA(e)&&e.length>0)t=!0;else if(mN(e)){for(let n in e)if(e.hasOwnProperty(n)){t=!0;break}}else t=!0;if(t)throw new po(`Error when checking model ${i} expected no data, but got ${e}`)}return[]}if(null==e)return t.map(e=>null);if(mN(e))for(let n of(s=[],t)){if(null==e[n])throw new po(`No data provided for "${n}". Need data for each key in: ${t}`);s.push(e[n])}else if(mA(e)){if(e.length!==t.length)throw new po(`Error when checking model ${i}: the Array of Tensors that you are passing to your model is not the size the model expected. Expected to see ${t.length} Tensor(s), but instead got the following list of Tensor(s): ${e}`);s=e}else{if(t.length>1)throw new po(`The model ${i} expects ${t.length} Tensor(s), but only received one Tensor. Found: Tensor with shape ${e.shape}`);s=[e]}if(s=mS(s),null!=n)for(let e=0;e<t.length;++e){if(null==n[e])continue;let a=s[e];if(a.shape.length!==n[e].length)throw new po(`Error when checking ${i}: expected ${t[e]} to have ${n[e].length} dimension(s). but got array with shape ${a.shape}`);for(let t=0;t<n[e].length;++t){if(0===t&&!r)continue;let s=a.shape[t],o=n[e][t];if(null!=o&&o>=0&&s!==o)throw new po(`${i} expected a batch of elements where each example has shape [${n[e].slice(1,n[e].length)}] (i.e.,tensor shape [*,${n[e].slice(1,n[e].length)}]) but the ${i} received an input with ${a.shape[0]} examples, each with shape [${a.shape.slice(1,a.shape.length)}] (tensor shape [${a.shape}])`)}}return s}function m$(e,t,n){let r=pI(e.map(e=>e.shape[0]));r.sort();let i=pI(t.map(e=>e.shape[0]));if(i.sort(),r.length>1)throw new po(`All input Tensors (x) should have the same number of samples. Got array shapes: ${JSON.stringify(e.map(e=>e.shape))}`);if(i.length>1)throw new po(`All target Tensors (y) should have the same number of samples. Got array shapes: ${JSON.stringify(t.map(e=>e.shape))}`);if(r.length>0&&i.length>0&&!H(r,i))throw new po(`Input Tensors should have the same number of samples as target Tensors. Found ${r[0]} input sample(s) and ${i[0]} target sample(s).`)}function mR(e,t,n){let r=[gP,gV,gz];for(let i=0;i<e.length;++i){let s=e[i],a=t[i],o=n[i];if(null!=a){if(a===gz&&1===s.shape[s.shape.length-1])throw new po(`You are passing a target array of shape ${s.shape} while using a loss 'categorical_crossentropy'. 'categorical_crossentropy'expects targets to be binary matrices (1s and 0s) of shape [samples, classes].`);if(-1!==r.indexOf(a)){let e=s.shape.slice(1),t=o.slice(1);for(let n=0;n<e.length;++n){let r=e[n],i=t[n];if(null!=i&&r!==i)throw new po(`A target Tensor with shape ${s.shape} was passed for an output of shape ${o}, while using a loss function that expects targets to have the same shape as the output.`)}}}}}function mD(e,t,n,r=!0,i=""){let s;if(Array.isArray(e)){if(e.length!==t.length)throw new po(`Error when checking model ${i}: the Array of Tensors that you are passing to your model is not the size the the model expected. Expected to see ${t.length} Tensor(s), but instead got ${e.length} Tensors(s).`);s=e}else{if(t.length>1)throw new po(`The model expects ${t.length} ${i} Tensors, but only received one Tensor. Found: array with shape ${JSON.stringify(e.shape)}.`);s=[e]}if(null!=n)for(let e=0;e<t.length;++e){if(null==n[e])continue;let a=s[e];if(a.shape.length!==n[e].length)throw new po(`Error when checking ${i}: expected ${t[e]} to have ${n[e].length} dimension(s), but got array with shape ${JSON.stringify(a.shape)}`);for(let s=0;s<n[e].length;++s){if(0===s&&!r)continue;let o=a.shape[s],l=n[e][s];if(null!=l&&l!==o)throw new po(`Error when checking ${i}: expected ${t[e]} to have shape ${JSON.stringify(n[e])} but got array with shape ${JSON.stringify(a.shape)}.`)}}}function mF(e,t){let n;if(null==e||Array.isArray(e)&&0===e.length)return t.map(e=>[]);if("string"==typeof e||"function"==typeof e)n=[e];else if(Array.isArray(e)||"object"==typeof e)n=e;else throw TypeError(`Type of metrics argument not understood. Expected an string,function, Array, or Object, found: ${e}`);if(Array.isArray(n))return t.map(e=>n);{let e=[];for(let r of t){let t=n.hasOwnProperty(r)?n[r]:[];Array.isArray(t)||(t=[t]),e.push(t)}return e}}let mP="layers-model";class mM extends ml{constructor(e){super(e),this.isTraining=!1}summary(e,t,n=console.log){if(!this.built)throw new po("This model has never been called, thus its weights have not been created yet. So no summary can be displayed. Build the model first (e.g., by calling it on some test data).");g8(this,e,t,n)}compile(e){if(null==e.loss&&(e.loss=[]),this.loss=e.loss,"string"==typeof e.optimizer)this.optimizer_=g3(e.optimizer),this.isOptimizerOwned=!0;else{if(!(e.optimizer instanceof au))throw new po("User-defined optimizer must be an instance of tf.Optimizer.");this.optimizer_=e.optimizer,this.isOptimizerOwned=!1}let t=[];if(Array.isArray(e.loss)||"string"==typeof e.loss||"function"==typeof e.loss){if(Array.isArray(e.loss)){if(e.loss.length!==this.outputs.length)throw new po(`When passing an Array as loss, it should have one entry per model output. The model has ${this.outputs.length} output(s), but you passed loss=${e.loss}.`);t=e.loss.map(e=>gW(e))}else{let n=gW(e.loss);this.outputs.forEach(e=>{t.push(n)})}}else{for(let t in e.loss=e.loss,e.loss)if(-1===this.outputNames.indexOf(t))throw new po(`Unknown entry in loss dictionary: "${t}". Only expected the following keys: ${this.outputNames}`);for(let n of this.outputNames)null==e.loss[n]&&console.warn(`Output "${n}" is missing from loss dictionary. We assume this was done on purpose, and we will not be expecting data to be passed to ${n} during training`),t.push(gW(e.loss[n]))}this.lossFunctions=t,this.feedOutputNames=[],this.feedOutputShapes=[],this.feedLossFns=[];for(let e=0;e<this.outputs.length;++e){let t=this.internalOutputShapes[e],n=this.outputNames[e];this.feedOutputNames.push(n),this.feedOutputShapes.push(t),this.feedLossFns.push(this.lossFunctions[e])}let n=[];this.metrics=e.metrics,this.metricsNames=["loss"],this.metricsTensors=[],pK("loss",()=>{for(let e=0;e<this.outputs.length;++e){if(-1!==n.indexOf(e))continue;let t=this.lossFunctions[e];this.outputs.length>1&&(this.metricsTensors.push([t,e]),this.metricsNames.push(this.outputNames[e]+"_loss"))}});let r=mF(e.metrics,this.outputNames),i=(e,t,n)=>{this.outputNames.length>1&&(t=this.outputNames[e]+"_"+t),this.metricsNames.push(t),this.metricsTensors.push([n,e])};pK("metric",()=>{for(let e=0;e<this.outputs.length;++e)-1===n.indexOf(e)&&(t=>{let n,r,s;let a="";for(let o of t){let t;if("string"==typeof o&&-1!==["accuracy","acc","crossentropy","ce"].indexOf(o)){let t;let i=this.internalOutputShapes[e];1===i[i.length-1]||this.lossFunctions[e]===gV?-1!==["accuracy","acc"].indexOf(o)?r=gq:-1!==["crossentropy","ce"].indexOf(o)&&(r=gY):this.lossFunctions[e]===gB?-1!==["accuracy","acc"].indexOf(o)?r=gQ:-1!==["crossentropy","ce"].indexOf(o)&&(r=gZ):-1!==["accuracy","acc"].indexOf(o)?r=gH:-1!==["crossentropy","ce"].indexOf(o)&&(r=gJ),-1!==["accuracy","acc"].indexOf(o)?t="acc":-1!==["crossentropy","ce"].indexOf(o)&&(t="ce"),s=r,n=a+t}else s=g1(o),n=a+g2(o);pK(n,()=>{t=s}),i(e,n,t)}})(r[e])}),this.collectedTrainableWeights=this.trainableWeights}checkTrainableWeightsConsistency(){null!=this.collectedTrainableWeights&&this.trainableWeights.length!==this.collectedTrainableWeights.length&&console.warn("Discrepancy between trainableweights and collected trainable weights. Did you set `model.trainable` without calling `model.compile()` afterwards?")}evaluate(e,t,n={}){let r=null==n.batchSize?32:n.batchSize;mx(r);let i=!0,s=this.standardizeUserDataXY(e,t,i,r);try{let e=s[0].concat(s[1]);this.makeTestFunction();let t=this.testFunction,i=this.testLoop(t,e,r,n.verbose,n.steps);return pf(i)}finally{mE(s[0],e),mE(s[1],t)}}async evaluateDataset(e,t){return this.makeTestFunction(),m_(this,e,t)}checkNumSamples(e,t,n,r="steps"){let i;if(null!=n){if(i=null,null!=t)throw new po(`If ${r} is set, batchSize must be null or undefined.Got batchSize = ${t}`)}else if(null!=e)i=Array.isArray(e)?e[0].shape[0]:e.shape[0];else throw new po(`Either the input data should have a defined shape, or ${r} shoud be specified.`);return i}execute(e,t){if(Array.isArray(t)&&0===t.length)throw new po("`outputs` is an empty Array, which is not allowed.");let n=Array.isArray(t),r=n?t:[t],i=this.retrieveSymbolicTensors(r),s=new gi;if(e instanceof im&&(e=[e]),Array.isArray(e)){if(e.length!==this.inputs.length)throw new po(`The number of inputs provided (${e.length}) does not match the number of inputs of this model (${this.inputs.length}).`);for(let t=0;t<this.inputs.length;++t)s.add(this.inputs[t],e[t])}else for(let t of this.inputs){let n=e[t.name];if(null==n)throw new po(`No value is provided for the model's input ${t.name}`);s.add(t,n)}let a=gl(i,s);return n?a:a[0]}retrieveSymbolicTensors(e){let t=ph(null,e.length),n=e.length;for(let r of this.layers){let i=Array.isArray(r.output)?r.output:[r.output],s=i.map(e=>e.name);for(let r=0;r<e.length;++r){let a=s.indexOf(e[r]);if(-1!==a&&(t[r]=i[a],n--),0===n)break}if(0===n)break}if(n>0){let n=[];throw t.forEach((t,r)=>{null==t&&n.push(e[r])}),new po(`Cannot find SymbolicTensors for output name(s): ${JSON.stringify(n)}`)}return t}predictLoop(e,t=32,n=!1){return i2(()=>{let r=this.checkNumSamples(e);if(n)throw new pl("Verbose predictLoop() is not implemented yet.");let i=mk(r,t),s=this.outputs.map(e=>[]);for(let t=0;t<i.length;++t)i2(()=>{let n=mT(e,i[t][0],i[t][1]),r=[];if(Array.isArray(n))for(let e=0;e<n.length;++e)r.push({key:this.inputs[e],value:n[e]});else r.push({key:this.inputs[0],value:n});let s=new gi(r);return gl(this.outputs,s)}).forEach((e,t)=>s[t].push(e));return pf(s.map(e=>o$(e,0)))})}predict(e,t={}){let n=mS(e);mD(n,this.inputNames,this.feedInputShapes,!1);try{let e=null==t.batchSize?32:t.batchSize;return mx(e),this.predictLoop(n,e)}finally{mE(n,e)}}predictOnBatch(e){mD(e,this.inputNames,this.feedInputShapes,!0);let t=(Array.isArray(e)?e[0]:e).shape[0];return this.predictLoop(e,t)}standardizeUserDataXY(e,t,n=!0,r){if(null==this.optimizer_)throw new pa("You must compile a model before training/testing. Use LayersModel.compile(modelCompileArgs).");let i=[];for(let e=0;e<this.feedOutputShapes.length;++e){let t=this.feedOutputShapes[e];this.feedLossFns[e]===gB?i.push(t.slice(0,t.length-1).concat([1])):i.push(t)}if(e=mO(e,this.feedInputNames,this.feedInputShapes,!1,"input"),t=mO(t,this.feedOutputNames,i,!1,"target"),m$(e,t,null),mR(t,this.feedLossFns,this.feedOutputShapes),this.stateful&&null!=r&&r>0&&e[0].shape[0]%r!=0)throw new po(`In a stateful network, you should only pass inputs with a number of samples that is divisible by the batch size ${r}. Found: ${e[0].shape[0]} sample(s).`);return[e,t]}async standardizeUserData(e,t,n,r,i=!0,s){let[a,o]=this.standardizeUserDataXY(e,t,i,s);if(null!=n)throw Error("sample weight is not supported yet.");let l=null;if(null!=r){let e=mc(r,this.outputNames);l=[];for(let t=0;t<e.length;++t)l.push(await mh(o[t],null,e[t]))}return[a,o,l]}testLoop(e,t,n,r=0,i){return i2(()=>{let s=this.checkNumSamples(t,n,i,"steps"),a=[];if(r>0)throw new pl("Verbose mode is not implemented yet.");if(null!=i)throw new pl("steps mode in testLoop() is not implemented yet");{let r=mk(s,n),i=lq(p4(0,s));for(let n=0;n<r.length;++n){let s=r[n][0],o=r[n][1],l=e(mI(t,fn(i,s,o-s)));if(0===n)for(let e=0;e<l.length;++e)a.push(ar(0));for(let e=0;e<l.length;++e){let t=l[e];a[e]=s4(a[e],s8(o-s,t))}}for(let e=0;e<a.length;++e)a[e]=s5(a[e],s)}return a})}getDedupedMetricsNames(){let e=this.metricsNames,t=[];for(let n=0;n<e.length;++n){let r=e[n],i=r;if(pp(e,r)>1){let t=pp(e.slice(0,n),r);i+=`_${t}`}t.push(i)}return t}makeTrainFunction(){return e=>{let t=[],n=e.slice(0,this.inputs.length),r=e.slice(this.inputs.length,this.inputs.length+this.outputs.length),i=e.slice(this.inputs.length+this.outputs.length,this.inputs.length+2*this.outputs.length),s=[],a=()=>{let e;let a=[];for(let e=0;e<this.inputs.length;++e)a.push({key:this.inputs[e],value:n[e]});let o=new gi(a),l=gl(this.outputs,o,{training:!0});for(let n=0;n<this.lossFunctions.length;++n){let s=(0,this.lossFunctions[n])(r[n],l[n]);null!=i[n]&&(s=md(s,i[n]));let a=ld(s);t.push(a),e=0===n?s:s4(e,s)}for(let e=0;e<this.metricsTensors.length;++e){let n;if(this.outputs.length>1&&e<this.outputs.length)n=t[e];else{let t=this.metricsTensors[e][0],i=this.metricsTensors[e][1];n=ld(t(r[i],l[i]))}i4(n),s.push(n)}return e=ld(e),this.calculateLosses().forEach(t=>{e=s4(e,t)}),e},o=this.collectedTrainableWeights.map(e=>e.read()),l=!0;return[this.optimizer_.minimize(a,l,o)].concat(s)}}makeTestFunction(){this.testFunction=e=>i2(()=>{let t;let n=[],r=e.slice(0,this.inputs.length),i=e.slice(this.inputs.length,this.inputs.length+this.outputs.length),s=[];for(let e=0;e<this.inputs.length;++e)s.push({key:this.inputs[e],value:r[e]});let a=new gi(s),o=gl(this.outputs,a);for(let e=0;e<this.lossFunctions.length;++e){let r=ld((0,this.lossFunctions[e])(i[e],o[e]));t=0===e?r:s4(t,r),n.push(t)}for(let e=0;e<this.metricsTensors.length;++e){let t=this.metricsTensors[e][0],r=this.metricsTensors[e][1],s=ld(t(i[r],o[r]));n.push(s)}return n})}async fit(e,t,n={}){let r,i,s,a,o,l,u,c,h;if(this.isTraining)throw Error("Cannot start training because another fit() call is ongoing.");this.isTraining=!0;try{let d,p,f;let g=null==n.batchSize?32:n.batchSize;mx(g);let m=!1,y=await this.standardizeUserData(e,t,n.sampleWeight,n.classWeight,m,g);r=y[0],i=y[1],h=y[2];let b=!1;if(null!=n.validationData&&n.validationData.length>0){if(b=!0,2===n.validationData.length)o=n.validationData[0],l=n.validationData[1];else if(3===n.validationData.length)throw new pl("validationData including sample weights is not supported yet.");else throw new po(`When passing validation data, it must contain 2 (valX, valY) or 3 (valX, valY, valSampleWeight) items; ${n.validationData} is invalid.`);let e=!0,t=await this.standardizeUserData(o,l,null,null,e,g);u=t[0],c=t[1],d=u.concat(c)}else if(null!=n.validationSplit&&n.validationSplit>0&&n.validationSplit<1){b=!0;let e=Math.floor(r[0].shape[0]*(1-n.validationSplit)),t=r[0].shape[0];u=mT(r,e,t),s=r,r=mT(r,0,e),c=mT(i,e,t),a=i,i=mT(i,0,e),d=u.concat(c)}else null!=n.validationSteps&&(b=!0);let v=r.concat(i).concat(h);this.checkTrainableWeightsConsistency();let w=this.makeTrainFunction(),_=this.getDedupedMetricsNames();b?(this.makeTestFunction(),p=this.testFunction,f=_.slice().concat(_.map(e=>"val_"+e))):(p=null,d=[],f=_.slice());let x=gO(n.callbacks,n.yieldEvery);return await this.fitLoop(w,v,_,g,n.epochs,n.verbose,x,p,d,n.shuffle,f,n.initialEpoch,null,null)}finally{this.isTraining=!1,mE(r,e),mE(i,t),mE(s,e),mE(a,t),mE(u,o),mE(c,l),null!=h&&i3(h)}}async fitLoop(e,t,n,r,i,s,a,o,l,u,c,h,d,p){let f;null==r&&(r=32),null==i&&(i=1),null==u&&(u=!0),null==h&&(h=0);let g=!1;if(null!=o&&null!=l&&(g=!0),null!=p&&(g=!0,null==d))throw new po("Can only use `validationSteps` when doing step-wise training, i.e., `stepsPerEpoch` must be set.");let m=this.checkNumSamples(t,r,d,"steps_per_epoch");null!=m&&(f=p4(0,m)),null==s&&(s=1);let{callbackList:y,history:b}=gR(a,s,i,h,m,d,r,g,c);y.setModel(this),this.history=b,await y.onTrainBegin(),this.stopTraining_=!1;for(let s=h;s<i;++s){await y.onEpochBegin(s);let i={};if(null!=d)throw new pl("stepsPerEpoch mode is not implemented yet.");{if("batch"===u)throw new pl("batch shuffling is not implemneted yet");u&&L(f);let s=lq(f),a=mk(m,r);for(let u=0;u<a.length;++u){let c={};if(await y.onBatchBegin(u,c),i2(()=>{let h=a[u][0],d=a[u][1],p=fn(s,h,d-h);c.batch=u,c.size=d-h;let f=e(mI(t,p));for(let e=0;e<n.length;++e){let t=n[e],r=f[e];c[t]=r,i4(r)}if(u===a.length-1&&g){let e=this.testLoop(o,l,r);for(let t=0;t<n.length;++t){let r=n[t],s=e[t];i4(s),i["val_"+r]=s}}}),await y.onBatchEnd(u,c),gI(c),this.stopTraining_)break}s.dispose()}if(await y.onEpochEnd(s,i),this.stopTraining_)break}return await y.onTrainEnd(),await this.history.syncData(),this.history}async fitDataset(e,t){return my(this,e,t)}async trainOnBatch(e,t){let n=await this.standardizeUserData(e,t),r=n[0],i=n[1],s=this.makeTrainFunction()(r.concat(i)),a=[];for(let e of s){let t=await e.data();a.push(t[0])}return i3(s),mE(n[0],e),mE(n[1],t),pf(a)}getNamedWeights(e){let t=[],n=null!=e&&e.trainableOnly,r=n?this.trainableWeights:this.weights,i=this.getWeights(n);for(let e=0;e<r.length;++e)(!n||r[e].trainable)&&t.push({name:r[e].originalName,tensor:i[e]});return t}set stopTraining(e){this.stopTraining_=e}get stopTraining(){return this.stopTraining_}get optimizer(){return this.optimizer_}set optimizer(e){this.optimizer_!==e&&(this.optimizer_=e,this.isOptimizerOwned=!1)}dispose(){let e=super.dispose();if(0===e.refCountAfterDispose&&null!=this.optimizer&&this.isOptimizerOwned){let t=i1().numTensors;this.optimizer_.dispose(),e.numDisposedVariables+=t-i1().numTensors}return e}getLossIdentifiers(){let e;if("string"==typeof this.loss)e=pm(this.loss);else if(Array.isArray(this.loss)){for(let e of this.loss)if("string"!=typeof e)throw Error("Serialization of non-string loss is not supported.");e=this.loss.map(e=>pm(e))}else{let t=Object.keys(this.loss);e={};let n=this.loss;for(let r of t)if("string"==typeof n[r])e[r]=pm(n[r]);else throw Error("Serialization of non-string loss is not supported.")}return e}getMetricIdentifiers(){if("string"==typeof this.metrics||"function"==typeof this.metrics)return[pm(g2(this.metrics))];if(Array.isArray(this.metrics))return this.metrics.map(e=>pm(g2(e)));{let e={};for(let t in this.metrics)e[t]=pm(g2(this.metrics[t]));return e}}getTrainingConfig(){return{loss:this.getLossIdentifiers(),metrics:this.getMetricIdentifiers(),optimizer_config:{class_name:this.optimizer.getClassName(),config:this.optimizer.getConfig()}}}loadTrainingConfig(e){let t,n;if(null!=e.weighted_metrics)throw Error("Loading weight_metrics is not supported yet.");if(null!=e.loss_weights)throw Error("Loading loss_weights is not supported yet.");if(null!=e.sample_weight_mode)throw Error("Loading sample_weight_mode is not supported yet.");let r=gD(mi(e.optimizer_config));if("string"==typeof e.loss)t=py(e.loss);else if(Array.isArray(e.loss))t=e.loss.map(e=>py(e));else if(null!=e.loss)for(let n in t={},e.loss)t[n]=py(e.loss[n]);if(Array.isArray(e.metrics))n=e.metrics.map(e=>py(e));else if(null!=e.metrics)for(let t in n={},e.metrics)n[t]=py(e.metrics[t]);this.compile({loss:t,metrics:n,optimizer:r})}async save(e,t){if("string"==typeof e){let t=s_(e);if(0===t.length)throw new po(`Cannot find any save handlers for URL '${e}'`);if(t.length>1)throw new po(`Found more than one (${t.length}) save handlers for URL '${e}'`);e=t[0]}if(null==e.save)throw new po("LayersModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");let n=await sn(this.getNamedWeights(t)),r=!1,i=null,s={modelTopology:this.toJSON(i,r),format:mP,generatedBy:`TensorFlow.js tfjs-layers v${ma}`,convertedBy:null};if(null!=t&&t.includeOptimizer&&null!=this.optimizer){s.trainingConfig=this.getTrainingConfig();let e="optimizer",{data:t,specs:r}=await sn(await this.optimizer.getWeights(),e);n.specs.push(...r),n.data=sc([n.data,t])}if(null!=this.userDefinedMetadata){let e=!0;g6(this.userDefinedMetadata,this.name,e),s.userDefinedMetadata=this.userDefinedMetadata}return s.weightData=n.data,s.weightSpecs=n.specs,e.save(s)}setUserDefinedMetadata(e){g6(e,this.name),this.userDefinedMetadata=e}getUserDefinedMetadata(){return this.userDefinedMetadata}}mM.className="Model",al(mM);class mL extends mM{}mL.className="Functional",al(mL);class mz extends mM{constructor(e){if(super({inputs:[],outputs:[]}),e=e||{},this.trainable=!0,this.built=!1,this.name=null!=e.name?e.name:pF("sequential_"),null!=e.layers)for(let t of e.layers)this.add(t)}checkShape(e){if(e.inboundNodes[0].outputTensors[0].shape.some(e=>e<0))throw new po(`Negative dimension size caused by adding layer ${e.name} with input shape [${e.inboundNodes[0].inputTensors[0].shape}]`)}add(e){let t;let n=e instanceof mz||e instanceof mM;if(n){if(1!==(t=e).outputs.length)throw new po("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");if(1!==t.inputs.length)throw new po("All layers in a Sequential model should have a single input tensor. For multi-input layers, use the functional API.")}if(0===this.outputs.length){if(0===e.inboundNodes.length){if(null==e.batchInputShape)throw new po("The first layer in a Sequential model must get an `inputShape` or `batchInputShape` argument.");let t=gn({batchShape:e.batchInputShape,dtype:e.dtype,name:e.name+"_input"});e.apply(t)}if(n)this.outputs=t.outputs,this.inputs=t.inputs;else{if(1!==e.inboundNodes.length)throw new po(`A layer added to a Sequential model must not already be connected somewhere else. LayersModel received layer ${e.name} which has ${e.inboundNodes.length} pre-existing inbound connections.`);if(1!==e.inboundNodes[0].outputTensors.length)throw new po("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(e),this.outputs=[e.inboundNodes[0].outputTensors[0]],this.inputs=f7(this.outputs[0])}this.inboundNodes=[],new f3({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:ph(null,this.inputs.length),outputMasks:[null],inputShapes:this.inputs.map(e=>e.shape),outputShapes:this.outputs[0].shape})}else{let t=e.apply(this.outputs[0]);if(Array.isArray(t))throw TypeError("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(e),this.outputs=[t],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}this.layers.push(e),this.built=!1}pop(){if(0===this.layers.length)throw TypeError("There are no layers in the model.");if(this.layers.pop(),0===this.layers.length)this.outputs=[],this.inboundNodes=[],this.outboundNodes=[];else{let e=this.layers.length-1;this.layers[e].outboundNodes=[],this.outputs=[this.layers[e].output],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}}call(e,t){return null==this.model&&this.build(),this.model.call(e,t)}build(e){if(fH(e),0===this.inputs.length||0===this.outputs.length)throw TypeError("Sequential model cannot be built: model is empty. Add some layers first.");this.model=new mM({inputs:this.inputs,outputs:this.outputs[0],name:this.name+"_model"}),this.model.trainable=this.trainable,this.supportsMasking=this.model.supportsMasking,this.inputLayers=this.model.inputLayers,this.inputLayersNodeIndices=this.model.inputLayersNodeIndices,this.inputLayersTensorIndices=this.model.inputLayersTensorIndices,this.outputLayers=this.model.outputLayers,this.outputLayersNodeIndices=this.model.outputLayersNodeIndices,this.outputLayersTensorIndices=this.model.outputLayersTensorIndices,this.nodesByDepth=this.model.nodesByDepth,this.containerNodes=this.model.containerNodes,this.outputNames=this.model.outputNames,this.inputNames=this.model.inputNames,this.built=!0}countParams(){return this.built||this.build(),super.countParams()}summary(e,t,n=console.log){this.built||this.build(),super.summary(e,t,n)}setWeights(e){null==this.model&&this.build(),this.model.setWeights(e)}evaluate(e,t,n={}){if(!this.built)throw new pa("The model needs to be compiled before being used.");return this.model.evaluate(e,t,n)}async evaluateDataset(e,t){if(!this.built)throw new pa("The model needs to be compiled before being used.");return this.model.evaluateDataset(e,t)}predict(e,t={}){return null==this.model&&this.build(),this.model.predict(e,t)}predictOnBatch(e){return null==this.model&&this.build(),this.model.predictOnBatch(e)}compile(e){this.build(),this.model.compile(e),this.optimizer_=this.model.optimizer,this.isOptimizerOwned=this.model.isOptimizerOwned,this.loss=this.model.loss,this.metrics=this.model.metrics,this.metricsTensors=this.model.metricsTensors,this.metricsNames=this.model.metricsNames}get optimizer(){return null==this.model?void 0:this.model.optimizer}set optimizer(e){this.model.optimizer=e}async fit(e,t,n={}){if(!this.built)throw new pa("The model needs to be compiled before being used.");return this.model.fit(e,t,n)}async fitDataset(e,t){if(!this.built)throw new pa("The model needs to be compiled before being used.");return this.model.fitDataset(e,t)}async trainOnBatch(e,t){return this.model.trainOnBatch(e,t)}static fromConfig(e,t,n={},r=!1){let i;let s={};if(t instanceof Array){if(!(null!=t[0].className)||"Merge"===t[0].className)throw new po("Legacy serialization format not supported yet.");i=t}else j(null!=t.layers,()=>"When the config data for a Sequential model is not an Array, it must be an Object that contains the 'layers' field."),i=t.layers,delete t.layers,s=t;let a=new e(s);if(!(a instanceof mz))throw new pl(`Sequential.fromConfig called on non-Sequential input: ${a}`);for(let e of i){let t=gD(e,void 0,r);r&&t.setFastWeightInitDuringBuild(!0),a.add(t)}return a}set stopTraining(e){if(null==this.model)throw new po("Cannot set the stopTraining property of a sequential model before it is compiled.");this.model.stopTraining=e}get stopTraining(){if(null==this.model)throw new po("Cannot get the stopTraining property of a sequential model before it is compiled.");return this.model.stopTraining}getConfig(){let e=[];for(let t of this.layers){let n={};n.className=t.getClassName(),n.config=t.getConfig(),e.push(n)}return{name:this.name,layers:e}}}mz.className="Sequential",al(mz);class mB extends aa{getConfig(){return{}}}class mU extends mB{apply(e,t=1){return ff(e,t)}}mU.className="elu",al(mU);class mV extends mB{apply(e){return l$(e)}}mV.className="selu",al(mV);class mj extends mB{apply(e){return lN(e)}}mj.className="relu",al(mj);class mG extends mB{apply(e){return i2(()=>lf(6,lN(e)))}}mG.className="relu6",al(mG);class mW extends mB{apply(e){return e}}mW.className="linear",al(mW);class mq extends mB{apply(e){return lD(e)}}mq.className="sigmoid",al(mq);class mH extends mB{apply(e){return fy(e)}}mH.className="hardSigmoid",al(mH);class mK extends mB{apply(e){return lU(e)}}mK.className="softplus",al(mK);class mX extends mB{apply(e){return fg(e)}}mX.className="softsign",al(mX);class mY extends mB{apply(e){return lW(e)}}mY.className="tanh",al(mY);class mQ extends mB{apply(e,t=-1){return lB(e,t)}}mQ.className="softmax",al(mQ);class mJ extends mB{apply(e,t=-1){return o7(e,t)}}mJ.className="logSoftmax",al(mJ);class mZ extends mB{apply(e){return i2(()=>i2(()=>{let t=s8(.5,s4(1,oK(s5(e,Math.sqrt(2)))));return s8(e,t)}))}}mZ.className="gelu",al(mZ);class m0 extends mB{apply(e){return i2(()=>s8(.5,s8(e,s4(1,lW(s8(s7(s5(2,Math.PI)),s4(e,s8(.044715,ap(e,3)))))))))}}m0.className="gelu_new",al(m0);class m1 extends mB{apply(e){return i2(()=>s8(e,lW(lU(e))))}}m1.className="mish",al(m1);class m2 extends mB{apply(e,t=1){return i2(()=>s8(lD(s8(e,t)),e))}}function m3(e){return e.getClassName()}function m4(e,t={}){return p_(e,ao.getMap().classNameMap,t,"activation")}function m6(e){if(null==e){let e={};return e.className="linear",e.config={},m4(e)}if("string"==typeof e){let t={};return t.className=e,t.config={},m4(t)}return e instanceof mB?e:m4(e)}function m5(e){if(null!=e&&"object"!=typeof e)throw Error(`Argument to L1L2 regularizer's constructor is expected to be an object, but received: ${e}`)}m2.className="swish",al(m2);class m8 extends aa{}class m7 extends m8{constructor(e){super(),m5(e),this.l1=null==e||null==e.l1?.01:e.l1,this.l2=null==e||null==e.l2?.01:e.l2,this.hasL1=0!==this.l1,this.hasL2=0!==this.l2}apply(e){return i2(()=>{let t=lv([1]);return this.hasL1&&(t=s4(t,o8(s8(this.l1,am(e))))),this.hasL2&&(t=s4(t,o8(s8(this.l2,fh(e))))),ox(t,[])})}getConfig(){return{l1:this.l1,l2:this.l2}}static fromConfig(e,t){return new e({l1:t.l1,l2:t.l2})}}m7.className="L1L2",al(m7);let m9={l1l2:"L1L2"};function ye(e){return pv(e)}function yt(e,t={}){return p_(e,ao.getMap().classNameMap,t,"regularizer")}function yn(e){return null==e?null:"string"==typeof e?yt({className:e in m9?m9[e]:e,config:{}}):e instanceof m8?e:yt(e)}class yr extends f6{constructor(e){super(null==e?{}:e),this.supportsMasking=!0,null!=e&&(this.maxValue=e.maxValue)}call(e,t){let n=lN(e=fq(e));return null!=this.maxValue&&(n=oO(n,0,this.maxValue)),n}computeOutputShape(e){return e}getConfig(){let e={maxValue:this.maxValue};return Object.assign(e,super.getConfig()),e}}yr.className="ReLU",al(yr);class yi extends f6{constructor(e){super(null==e?{}:e),this.DEFAULT_ALPHA=.3,null==e&&(e={}),this.alpha=null==e.alpha?this.DEFAULT_ALPHA:e.alpha}call(e,t){return o3(fq(e),this.alpha)}computeOutputShape(e){return e}getConfig(){let e={alpha:this.alpha};return Object.assign(e,super.getConfig()),e}}yi.className="LeakyReLU",al(yi);class ys extends f6{constructor(e){if(super(null==e?{}:e),this.DEFAULT_ALPHA_INITIALIZER="zeros",null==e&&(e={}),this.supportsMasking=!0,this.alphaInitializer=fj(e.alphaInitializer||this.DEFAULT_ALPHA_INITIALIZER),this.alphaRegularizer=yn(e.alphaRegularizer),this.alphaConstraint=gx(e.alphaConstraint),null==e.sharedAxes)this.sharedAxes=null;else if(Array.isArray(e.sharedAxes))this.sharedAxes=e.sharedAxes;else if("number"==typeof e.sharedAxes)this.sharedAxes=[e.sharedAxes];else throw new po(`Expected sharedAxes to be a number or an array of numbers, but got ${e.sharedAxes}`)}build(e){let t=(e=fH(e)).slice(1);if(null!=this.sharedAxes)for(let e of this.sharedAxes)t[e-1]=1;this.alpha=this.addWeight("alpha",t,"float32",this.alphaInitializer,this.alphaRegularizer,!0,this.alphaConstraint);let n={};if(null!=this.sharedAxes)for(let t=1;t<e.length;++t)n[t]=e[t];this.inputSpec=[new f0({ndim:e.length,axes:n})],this.built=!0}call(e,t){return lT(e=fq(e),this.alpha.read())}getConfig(){let e={alphaInitializer:fV(this.alphaInitializer),alphaRegularizer:ye(this.alphaRegularizer),alphaConstraint:gw(this.alphaConstraint),sharedAxes:this.sharedAxes};return Object.assign(e,super.getConfig()),e}}ys.className="PReLU",al(ys);class ya extends f6{constructor(e){if(super(null==e?{}:e),this.DEFAULT_ALPHA=1,null==e&&(e={}),null!=e.alpha&&e.alpha!==this.DEFAULT_ALPHA)throw new pl(`Non-default alpha value (${e.alpha}) is not supported by the ELU layer yet.`);this.alpha=null==e.alpha?this.DEFAULT_ALPHA:e.alpha}call(e,t){return oq(fq(e))}computeOutputShape(e){return e}getConfig(){let e={alpha:this.alpha};return Object.assign(e,super.getConfig()),e}}ya.className="ELU",al(ya);class yo extends f6{constructor(e){super(null==e?{}:e),this.DEFAULT_THETA=1,null==e&&(e={}),this.theta=null==e.theta?this.DEFAULT_THETA:e.theta}call(e,t){let n=fq(e);return s8(n,s1(o1(n,this.theta),"float32"))}computeOutputShape(e){return e}getConfig(){let e={theta:this.theta};return Object.assign(e,super.getConfig()),e}}yo.className="ThresholdedReLU",al(yo);class yl extends f6{constructor(e){super(null==e?{}:e),this.DEFAULT_AXIS=1,null==e&&(e={}),this.softmax=new mQ().apply,this.axis=null==e.axis?this.DEFAULT_AXIS:e.axis}call(e,t){return i2(()=>{let n=fq(e),r=t.mask;if(null!=r){let e=s8(af(lw(n.shape),s1(r,n.dtype)),ar(-1e9));n=s4(n,e)}return this.axis instanceof Array?this.axis.length>1?oX(af(n,lo(n,this.axis,!0))):this.softmax(n,this.axis[0]):this.softmax(n,this.axis)})}computeOutputShape(e){return e}getConfig(){let e={axis:this.axis};return Object.assign(e,super.getConfig()),e}}function yu(e,t,n){if("number"==typeof e)return ph(e,t);if(e.length!==t)throw new po(`The ${n} argument must be an integer or tuple of ${t} integers. Received: ${e.length} elements.`);for(let r=0;r<t;++r){let i=e[r];if(!p0(i))throw new po(`The ${n} argument must be an integer or tuple of ${t} integers. Received: ${JSON.stringify(e)} including a non-integer number ${i}`)}return e}function yc(e,t,n,r,i=1){let s;if(null==e)return e;let a=t+(t-1)*(i-1);return Math.floor(((s="same"===n?e:e-a+1)+r-1)/r)}function yh(e,t,n,r){if(null==e)return null;if("valid"===r)e=e*t+p3([n-t,0]);else if("same"===r)e*=t;else throw new po(`Unsupport padding mode: ${r}.`);return e}function yd(e,t){return i2(()=>(pV(t),"channelsFirst"===t)?l0(e,[0,2,3,1]):e)}function yp(e,t){return i2(()=>(pV(t),"channelsFirst"===t)?l0(e,[0,2,3,4,1]):e)}function yf(e,t,n,r=1,i="valid",s,a=1){return i2(()=>{if(null==s&&(s=p5()),pV(s),3!==e.shape.length)throw new po(`The input of a conv1dWithBias operation should be 3, but is ${e.shape.length} instead.`);if(3!==t.shape.length)throw new po(`The kernel for a conv1dWithBias operation should be 3, but is ${t.shape.length} instead`);if(null!=n&&1!==n.shape.length)throw new po(`The bias for a conv1dWithBias operation should be 1, but is ${n.shape.length} instead`);if("channelsFirst"===s&&(e=l0(e,[0,2,1])),"causal"===i)throw new pl("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");let o=oL(e,t,r,"same"===i?"same":"valid","NWC",a);return null!=n&&(o=fp(o,n)),o})}function yg(e,t,n,r=[1,1],i="valid",s,a,o=null){return i2(()=>{if(null==s&&(s=p5()),pV(s),3!==e.rank&&4!==e.rank)throw new po(`conv2dWithBiasActivation expects input to be of rank 3 or 4, but received ${e.rank}.`);if(3!==t.rank&&4!==t.rank)throw new po(`conv2dWithBiasActivation expects kernel to be of rank 3 or 4, but received ${e.rank}.`);let l=yd(e,s);if("causal"===i)throw new pl("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");return l=ui({x:l,filter:t,strides:r,pad:"same"===i?"same":"valid",dilations:a,dataFormat:"NHWC",bias:n,activation:o}),"channelsFirst"===s&&(l=l0(l,[0,3,1,2])),l})}function ym(e,t,n,r=[1,1,1],i="valid",s,a){return i2(()=>{if(null==s&&(s=p5()),pV(s),4!==e.rank&&5!==e.rank)throw new po(`conv3dWithBias expects input to be of rank 4 or 5, but received ${e.rank}.`);if(4!==t.rank&&5!==t.rank)throw new po(`conv3dWithBias expects kernel to be of rank 4 or 5, but received ${e.rank}.`);let o=yp(e,s);if("causal"===i)throw new pl("The support for CAUSAL padding mode in conv3dWithBias is not implemented yet.");return o=oU(o,t,r,"same"===i?"same":"valid","NDHWC",a),null!=n&&(o=fp(o,n)),"channelsFirst"===s&&(o=l0(o,[0,4,1,2,3])),o})}yl.className="Softmax",al(yl);class yy extends f6{constructor(e,t){if(super(t),this.bias=null,this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_BIAS_INITIALIZER="zeros",yy.verifyArgs(t),this.rank=e,pC(this.rank,"rank"),1!==this.rank&&2!==this.rank&&3!==this.rank)throw new pl(`Convolution layer for rank other than 1, 2, or 3 (${this.rank}) is not implemented yet.`);if(this.kernelSize=yu(t.kernelSize,e,"kernelSize"),this.strides=yu(null==t.strides?1:t.strides,e,"strides"),this.padding=null==t.padding?"valid":t.padding,pG(this.padding),this.dataFormat=null==t.dataFormat?"channelsLast":t.dataFormat,pV(this.dataFormat),this.activation=m6(t.activation),this.useBias=null==t.useBias||t.useBias,this.biasInitializer=fj(t.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.biasConstraint=gx(t.biasConstraint),this.biasRegularizer=yn(t.biasRegularizer),this.activityRegularizer=yn(t.activityRegularizer),this.dilationRate=yu(null==t.dilationRate?1:t.dilationRate,e,"dilationRate"),1===this.rank&&Array.isArray(this.dilationRate)&&1!==this.dilationRate.length)throw new po(`dilationRate must be a number or an array of a single number for 1D convolution, but received ${JSON.stringify(this.dilationRate)}`);if(2===this.rank){if("number"==typeof this.dilationRate)this.dilationRate=[this.dilationRate,this.dilationRate];else if(2!==this.dilationRate.length)throw new po(`dilationRate must be a number or array of two numbers for 2D convolution, but received ${JSON.stringify(this.dilationRate)}`)}else if(3===this.rank){if("number"==typeof this.dilationRate)this.dilationRate=[this.dilationRate,this.dilationRate,this.dilationRate];else if(3!==this.dilationRate.length)throw new po(`dilationRate must be a number or array of three numbers for 3D convolution, but received ${JSON.stringify(this.dilationRate)}`)}}static verifyArgs(e){if(pd("kernelSize"in e,"required key 'kernelSize' not in config"),"number"!=typeof e.kernelSize&&!pE(e.kernelSize,"number",1,3))throw new po(`BaseConv expects config.kernelSize to be number or number[] with length 1, 2, or 3, but received ${JSON.stringify(e.kernelSize)}.`)}getConfig(){let e={kernelSize:this.kernelSize,strides:this.strides,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,activation:m3(this.activation),useBias:this.useBias,biasInitializer:fV(this.biasInitializer),biasRegularizer:ye(this.biasRegularizer),activityRegularizer:ye(this.activityRegularizer),biasConstraint:gw(this.biasConstraint)};return Object.assign(e,super.getConfig()),e}}class yb extends yy{constructor(e,t){super(e,t),this.kernel=null,yb.verifyArgs(t),this.filters=t.filters,pC(this.filters,"filters"),this.kernelInitializer=fj(t.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.kernelConstraint=gx(t.kernelConstraint),this.kernelRegularizer=yn(t.kernelRegularizer)}build(e){e=fH(e);let t="channelsFirst"===this.dataFormat?1:e.length-1;if(null==e[t])throw new po(`The channel dimension of the input should be defined. Found ${e[t]}`);let n=e[t],r=this.kernelSize.concat([n,this.filters]);this.kernel=this.addWeight("kernel",r,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[{ndim:this.rank+2,axes:{[t]:n}}],this.built=!0}call(e,t){return i2(()=>{let t;e=fq(e);let n=null==this.bias?null:this.bias.read(),r=pO(this.activation.getClassName());if(null!=r&&2===this.rank)t=yg(e,this.kernel.read(),n,this.strides,this.padding,this.dataFormat,this.dilationRate,r);else{if(1===this.rank)t=yf(e,this.kernel.read(),n,this.strides[0],this.padding,this.dataFormat,this.dilationRate[0]);else if(2===this.rank)t=yg(e,this.kernel.read(),n,this.strides,this.padding,this.dataFormat,this.dilationRate);else if(3===this.rank)t=ym(e,this.kernel.read(),n,this.strides,this.padding,this.dataFormat,this.dilationRate);else throw new pl("convolutions greater than 3D are not implemented yet.");null!=this.activation&&(t=this.activation.apply(t))}return t})}computeOutputShape(e){e=fH(e);let t=[],n="channelsLast"===this.dataFormat?e.slice(1,e.length-1):e.slice(2);for(let e=0;e<n.length;++e){let r=yc(n[e],this.kernelSize[e],this.padding,this.strides[e],"number"==typeof this.dilationRate?this.dilationRate:this.dilationRate[e]);t.push(r)}let r=[e[0]];return"channelsLast"===this.dataFormat?(r=r.concat(t)).push(this.filters):(r.push(this.filters),r=r.concat(t)),r}getConfig(){let e={filters:this.filters,kernelInitializer:fV(this.kernelInitializer),kernelRegularizer:ye(this.kernelRegularizer),kernelConstraint:gw(this.kernelConstraint)};return Object.assign(e,super.getConfig()),e}static verifyArgs(e){if(!("filters"in e)||"number"!=typeof e.filters||e.filters<1)throw new po(`Convolution layer expected config.filters to be a 'number' > 0 but got ${JSON.stringify(e.filters)}`)}}class yv extends yb{constructor(e){super(2,e),yv.verifyArgs(e)}getConfig(){let e=super.getConfig();return delete e.rank,e}static verifyArgs(e){if("number"!=typeof e.kernelSize&&!pE(e.kernelSize,"number",1,2))throw new po(`Conv2D expects config.kernelSize to be number or number[] with length 1 or 2, but received ${JSON.stringify(e.kernelSize)}.`)}}yv.className="Conv2D",al(yv);class yw extends yb{constructor(e){super(3,e),yw.verifyArgs(e)}getConfig(){let e=super.getConfig();return delete e.rank,e}static verifyArgs(e){if("number"!=typeof e.kernelSize&&!(Array.isArray(e.kernelSize)&&(1===e.kernelSize.length||3===e.kernelSize.length)))throw new po(`Conv3D expects config.kernelSize to be number or [number, number, number], but received ${JSON.stringify(e.kernelSize)}.`)}}yw.className="Conv3D",al(yw);class y_ extends yv{constructor(e){if(super(e),this.inputSpec=[new f0({ndim:4})],"same"!==this.padding&&"valid"!==this.padding)throw new po(`Conv2DTranspose currently supports only padding modes 'same' and 'valid', but received padding mode ${this.padding}`)}build(e){if(4!==(e=fH(e)).length)throw new po("Input should have rank 4; Received input shape: "+JSON.stringify(e));let t="channelsFirst"===this.dataFormat?1:e.length-1;if(null==e[t])throw new po("The channel dimension of the inputs should be defined. Found `None`.");let n=e[t],r=this.kernelSize.concat([this.filters,n]);this.kernel=this.addWeight("kernel",r,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new f0({ndim:4,axes:{[t]:n}})],this.built=!0}call(e,t){return i2(()=>{let t,n,r=fq(e);if(4!==r.shape.length)throw new po(`Conv2DTranspose.call() expects input tensor to be rank-4, but received a tensor of rank-${r.shape.length}`);let i=r.shape,s=i[0];"channelsFirst"===this.dataFormat?(t=2,n=3):(t=1,n=2);let a=i[t],o=i[n],l=this.kernelSize[0],u=this.kernelSize[1],c=this.strides[0],h=this.strides[1],d=[s,yh(a,c,l,this.padding),yh(o,h,u,this.padding),this.filters];"channelsLast"!==this.dataFormat&&(r=l0(r,[0,2,3,1]));let p=oB(r,this.kernel.read(),d,this.strides,this.padding);return"channelsLast"!==this.dataFormat&&(p=l0(p,[0,3,1,2])),null!=this.bias&&(p=fp(p,this.bias.read(),this.dataFormat)),null!=this.activation&&(p=this.activation.apply(p)),p})}computeOutputShape(e){let t,n,r;let i=(e=fH(e)).slice();"channelsFirst"===this.dataFormat?(t=1,n=2,r=3):(t=3,n=1,r=2);let s=this.kernelSize[0],a=this.kernelSize[1],o=this.strides[0],l=this.strides[1];return i[t]=this.filters,i[n]=yh(i[n],o,s,this.padding),i[r]=yh(i[r],l,a,this.padding),i}getConfig(){let e=super.getConfig();return delete e.dilationRate,e}}y_.className="Conv2DTranspose",al(y_);class yx extends yw{constructor(e){if(super(e),this.inputSpec=[new f0({ndim:5})],"same"!==this.padding&&"valid"!==this.padding)throw new po(`Conv3DTranspose currently supports only padding modes 'same' and 'valid', but received padding mode ${this.padding}`)}build(e){if(5!==(e=fH(e)).length)throw new po("Input should have rank 5; Received input shape: "+JSON.stringify(e));let t="channelsFirst"===this.dataFormat?1:e.length-1;if(null==e[t])throw new po("The channel dimension of the inputs should be defined. Found `None`.");let n=e[t],r=this.kernelSize.concat([this.filters,n]);this.kernel=this.addWeight("kernel",r,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new f0({ndim:5,axes:{[t]:n}})],this.built=!0}call(e,t){return i2(()=>{let t,n,r,i=fq(e);if(5!==i.shape.length)throw new po(`Conv3DTranspose.call() expects input tensor to be rank-4, but received a tensor of rank-${i.shape.length}`);let s=i.shape,a=s[0];"channelsFirst"===this.dataFormat?(r=2,t=3,n=4):(r=1,t=2,n=3);let o=s[r],l=s[t],u=s[n],c=this.kernelSize[0],h=this.kernelSize[1],d=this.kernelSize[2],p=this.strides[0],f=this.strides[1],g=this.strides[2],m=[a,yh(o,p,c,this.padding),yh(l,f,h,this.padding),yh(u,g,d,this.padding),this.filters];"channelsLast"!==this.dataFormat&&(i=l0(i,[0,2,3,4,1]));let y=oj(i,this.kernel.read(),m,this.strides,this.padding);return"channelsLast"!==this.dataFormat&&(y=l0(y,[0,4,1,2,3])),null!==this.bias&&(y=fp(y,this.bias.read(),this.dataFormat)),null!==this.activation&&(y=this.activation.apply(y)),y})}computeOutputShape(e){let t,n,r,i;let s=(e=fH(e)).slice();"channelsFirst"===this.dataFormat?(t=1,n=2,r=3,i=4):(t=4,n=1,r=2,i=3);let a=this.kernelSize[0],o=this.kernelSize[1],l=this.kernelSize[2],u=this.strides[0],c=this.strides[1],h=this.strides[2];return s[t]=this.filters,s[n]=yh(s[n],u,a,this.padding),s[r]=yh(s[r],c,o,this.padding),s[i]=yh(s[i],h,l,this.padding),s}getConfig(){let e=super.getConfig();return delete e.dilationRate,e}}yx.className="Conv3DTranspose",al(yx);class yT extends yb{constructor(e,t){if(super(e,t),this.DEFAULT_DEPTHWISE_INITIALIZER="glorotUniform",this.DEFAULT_POINTWISE_INITIALIZER="glorotUniform",this.depthwiseKernel=null,this.pointwiseKernel=null,null==t.filters)throw new po("The `filters` configuration field is required by SeparableConv, but is unspecified.");if(null!=t.kernelInitializer||null!=t.kernelRegularizer||null!=t.kernelConstraint)throw new po("Fields kernelInitializer, kernelRegularizer and kernelConstraint are invalid for SeparableConv2D. Use depthwiseInitializer, depthwiseRegularizer, depthwiseConstraint, pointwiseInitializer, pointwiseRegularizer and pointwiseConstraint instead.");if(null!=t.padding&&"same"!==t.padding&&"valid"!==t.padding)throw new po(`SeparableConv${this.rank}D supports only padding modes: 'same' and 'valid', but received ${JSON.stringify(t.padding)}`);this.depthMultiplier=null==t.depthMultiplier?1:t.depthMultiplier,this.depthwiseInitializer=fj(t.depthwiseInitializer||this.DEFAULT_DEPTHWISE_INITIALIZER),this.depthwiseRegularizer=yn(t.depthwiseRegularizer),this.depthwiseConstraint=gx(t.depthwiseConstraint),this.pointwiseInitializer=fj(t.depthwiseInitializer||this.DEFAULT_POINTWISE_INITIALIZER),this.pointwiseRegularizer=yn(t.pointwiseRegularizer),this.pointwiseConstraint=gx(t.pointwiseConstraint)}build(e){if((e=fH(e)).length<this.rank+2)throw new po(`Inputs to SeparableConv${this.rank}D should have rank ${this.rank+2}, but received input shape: ${JSON.stringify(e)}`);let t="channelsFirst"===this.dataFormat?1:e.length-1;if(null==e[t]||e[t]<0)throw new po(`The channel dimension of the inputs should be defined, but found ${JSON.stringify(e[t])}`);let n=e[t],r=this.kernelSize.concat([n,this.depthMultiplier]),i=[];for(let e=0;e<this.rank;++e)i.push(1);i.push(n*this.depthMultiplier,this.filters);let s=!0;this.depthwiseKernel=this.addWeight("depthwise_kernel",r,"float32",this.depthwiseInitializer,this.depthwiseRegularizer,s,this.depthwiseConstraint),this.pointwiseKernel=this.addWeight("pointwise_kernel",i,"float32",this.pointwiseInitializer,this.pointwiseRegularizer,s,this.pointwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,s,this.biasConstraint):this.bias=null,this.inputSpec=[new f0({ndim:this.rank+2,axes:{[t]:n}})],this.built=!0}call(e,t){return i2(()=>{let t;if(e=fq(e),1===this.rank)throw new pl("1D separable convolution is not implemented yet.");return 2===this.rank&&("channelsFirst"===this.dataFormat&&(e=l0(e,[0,2,3,1])),t=lR(e,this.depthwiseKernel.read(),this.pointwiseKernel.read(),this.strides,this.padding,this.dilationRate,"NHWC")),this.useBias&&(t=fp(t,this.bias.read(),this.dataFormat)),null!=this.activation&&(t=this.activation.apply(t)),"channelsFirst"===this.dataFormat&&(t=l0(t,[0,3,1,2])),t})}getConfig(){let e=super.getConfig();return delete e.rank,delete e.kernelInitializer,delete e.kernelRegularizer,delete e.kernelConstraint,e.depthwiseInitializer=fV(this.depthwiseInitializer),e.pointwiseInitializer=fV(this.pointwiseInitializer),e.depthwiseRegularizer=ye(this.depthwiseRegularizer),e.pointwiseRegularizer=ye(this.pointwiseRegularizer),e.depthwiseConstraint=gw(this.depthwiseConstraint),e.pointwiseConstraint=gw(this.pointwiseConstraint),e}}yT.className="SeparableConv";class yI extends yT{constructor(e){super(2,e)}}yI.className="SeparableConv2D",al(yI);class yk extends yb{constructor(e){super(1,e),yk.verifyArgs(e),this.inputSpec=[{ndim:3}]}getConfig(){let e=super.getConfig();return delete e.rank,delete e.dataFormat,e}static verifyArgs(e){if("number"!=typeof e.kernelSize&&!pE(e.kernelSize,"number",1,1))throw new po(`Conv1D expects config.kernelSize to be number or number[] with length 1, but received ${JSON.stringify(e.kernelSize)}.`)}}yk.className="Conv1D",al(yk);class yS extends f6{constructor(e){super(e),"number"==typeof e.cropping?this.cropping=[[e.cropping,e.cropping],[e.cropping,e.cropping]]:"number"==typeof e.cropping[0]?this.cropping=[[e.cropping[0],e.cropping[0]],[e.cropping[1],e.cropping[1]]]:this.cropping=e.cropping,this.dataFormat=void 0===e.dataFormat?"channelsLast":e.dataFormat,this.inputSpec=[{ndim:4}]}computeOutputShape(e){return"channelsFirst"===this.dataFormat?[e[0],e[1],e[2]-this.cropping[0][0]-this.cropping[0][1],e[3]-this.cropping[1][0]-this.cropping[1][1]]:[e[0],e[1]-this.cropping[0][0]-this.cropping[0][1],e[2]-this.cropping[1][0]-this.cropping[1][1],e[3]]}call(e,t){return i2(()=>{if(e=fq(e),"channelsLast"===this.dataFormat){let t=fi(e,this.cropping[0][0],e.shape[1]-this.cropping[0][0]-this.cropping[0][1],2);return fi(t,this.cropping[1][0],e.shape[2]-this.cropping[1][1]-this.cropping[1][0],3)}{let t=fi(e,this.cropping[0][0],e.shape[2]-this.cropping[0][0]-this.cropping[0][1],3);return fi(t,this.cropping[1][0],e.shape[3]-this.cropping[1][1]-this.cropping[1][0],4)}})}getConfig(){let e={cropping:this.cropping,dataFormat:this.dataFormat};return Object.assign(e,super.getConfig()),e}}yS.className="Cropping2D",al(yS);class yE extends f6{constructor(e){super(e),this.DEFAULT_SIZE=[2,2],this.inputSpec=[{ndim:4}],this.size=null==e.size?this.DEFAULT_SIZE:e.size,this.dataFormat=null==e.dataFormat?"channelsLast":e.dataFormat,pV(this.dataFormat),this.interpolation=null==e.interpolation?"nearest":e.interpolation,pj(this.interpolation)}computeOutputShape(e){if("channelsFirst"===this.dataFormat){let t=null==e[2]?null:this.size[0]*e[2],n=null==e[3]?null:this.size[1]*e[3];return[e[0],e[1],t,n]}{let t=null==e[1]?null:this.size[0]*e[1],n=null==e[2]?null:this.size[1]*e[2];return[e[0],t,n,e[3]]}}call(e,t){return i2(()=>{let t=fq(e),n=t.shape;if("channelsFirst"===this.dataFormat){t=l0(t,[0,2,3,1]);let e=this.size[0]*n[2],r=this.size[1]*n[3];return l0("nearest"===this.interpolation?uq.resizeNearestNeighbor(t,[e,r]):uq.resizeBilinear(t,[e,r]),[0,3,1,2])}{let e=this.size[0]*n[1],r=this.size[1]*n[2];return"nearest"===this.interpolation?uq.resizeNearestNeighbor(t,[e,r]):uq.resizeBilinear(t,[e,r])}})}getConfig(){let e={size:this.size,dataFormat:this.dataFormat,interpolation:this.interpolation};return Object.assign(e,super.getConfig()),e}}function yC(e,t,n=[1,1],r="valid",i,s){return i2(()=>{null==i&&(i=p5()),pV(i);let a=yd(e,i);if(4!==e.rank)throw new po(`Input for depthwiseConv2d is required to be 4-D, but is instead ${e.rank}-D`);if(4!==t.rank)throw new po(`depthwiseKernel is required to be 4-D, but is instead ${t.rank}-D`);return a=oW(a,t,n,"same"===r?"same":"valid","NHWC",s),"channelsFirst"===i&&(a=l0(a,[0,3,1,2])),a})}yE.className="UpSampling2D",al(yE);class yA extends yy{constructor(e){super(2,e),this.depthwiseKernel=null,this.depthMultiplier=null==e.depthMultiplier?1:e.depthMultiplier,this.depthwiseInitializer=fj(e.depthwiseInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.depthwiseConstraint=gx(e.depthwiseConstraint),this.depthwiseRegularizer=yn(e.depthwiseRegularizer)}build(e){if((e=fH(e)).length<4)throw new po(`Inputs to DepthwiseConv2D should have rank 4. Received input shape: ${JSON.stringify(e)}.`);let t="channelsFirst"===this.dataFormat?1:3;if(null==e[t]||e[t]<0)throw new po(`The channel dimension of the inputs to DepthwiseConv2D should be defined, but is not (${e[t]}).`);let n=e[t],r=[this.kernelSize[0],this.kernelSize[1],n,this.depthMultiplier];this.depthwiseKernel=this.addWeight("depthwise_kernel",r,null,this.depthwiseInitializer,this.depthwiseRegularizer,!0,this.depthwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[n*this.depthMultiplier],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(e,t){return i2(()=>{let t=yC(e=fq(e),this.depthwiseKernel.read(),this.strides,this.padding,this.dataFormat,null);return this.useBias&&(t=fp(t,this.bias.read(),this.dataFormat)),null!=this.activation&&(t=this.activation.apply(t)),t})}computeOutputShape(e){e=fH(e);let t="channelsFirst"===this.dataFormat?e[2]:e[1],n="channelsFirst"===this.dataFormat?e[3]:e[2],r="channelsFirst"===this.dataFormat?e[1]*this.depthMultiplier:e[3]*this.depthMultiplier,i=yc(t,this.kernelSize[0],this.padding,this.strides[0]),s=yc(n,this.kernelSize[1],this.padding,this.strides[1]);return"channelsFirst"===this.dataFormat?[e[0],r,i,s]:[e[0],i,s,r]}getConfig(){let e=super.getConfig();return e.depthMultiplier=this.depthMultiplier,e.depthwiseInitializer=fV(this.depthwiseInitializer),e.depthwiseRegularizer=ye(this.depthwiseRegularizer),e.depthwiseConstraint=gw(this.depthwiseRegularizer),e}}function yN(e,t,n,r){if(Array.isArray(e)){if(null!=t||null!=n)throw new po("When inputs is an array, neither initialState or constants should be provided");null!=r&&(n=e.slice(e.length-r,e.length),e=e.slice(0,e.length-r)),e.length>1&&(t=e.slice(1,e.length)),e=e[0]}function i(e){return null==e||Array.isArray(e)?e:[e]}return{inputs:e,initialState:t=i(t),constants:n=i(n)}}function yO(e,t,n,r=!1,i,s,a=!1,o=!1){return i2(()=>{let l,u,c;let h=t.shape.length;if(h<3)throw new po(`Input should be at least 3D, but is ${h}D.`);let d=[1,0].concat(p4(2,h));if(t=l0(t,d),null!=s)throw new pl("The rnn() functoin of the deeplearn.js backend does not support constants yet.");a&&console.warn("Backend rnn(): the unroll = true option is not applicable to the imperative deeplearn.js backend."),null!=i&&((i=s1(s1(i,"bool"),"float32")).rank===h-1&&(i=oY(i,-1)),i=l0(i,d)),r&&(t=lO(t,0),null!=i&&(i=lO(i,0)));let p=[],f=n,g=t.shape[0],m=lX(t);null!=i&&(u=lX(i));for(let t=0;t<g;++t){let n=m[t],r=i2(()=>e(n,f));if(null==i)l=r[0],f=r[1];else{let e=i2(()=>{let e=u[t],n=af(l_(e),e);return{output:s4(s8(r[0],e),s8(f[0],n)),newStates:f.map((t,i)=>s4(s8(r[1][i],e),s8(t,n)))}});l=e.output,f=e.newStates}o&&p.push(l)}return o&&(c=lG(p,1)),[l,c,f]})}yA.className="DepthwiseConv2D",al(yA);class y$ extends f6{constructor(e){let t;if(super(e),null==e.cell)throw new po("cell property is missing for the constructor of RNN.");if(null==(t=Array.isArray(e.cell)?new yB({cells:e.cell}):e.cell).stateSize)throw new po("The RNN cell should have an attribute `stateSize` (tuple of integers, one integer per RNN state).");this.cell=t,this.returnSequences=null!=e.returnSequences&&e.returnSequences,this.returnState=null!=e.returnState&&e.returnState,this.goBackwards=null!=e.goBackwards&&e.goBackwards,this._stateful=null!=e.stateful&&e.stateful,this.unroll=null!=e.unroll&&e.unroll,this.supportsMasking=!0,this.inputSpec=[new f0({ndim:3})],this.stateSpec=null,this.states_=null,this.numConstants=null,this.keptStates=[]}getStates(){return null==this.states_?p4(0,Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1).map(e=>null):this.states_}setStates(e){this.states_=e}computeOutputShape(e){let t;fG(e)&&(e=e[0]);let n=this.cell.stateSize;Array.isArray(n)||(n=[n]);let r=n[0];if(t=this.returnSequences?[e[0],e[1],r]:[e[0],r],!this.returnState)return t;{let r=[];for(let t of n)r.push([e[0],t]);return[t].concat(r)}}computeMask(e,t){return i2(()=>{Array.isArray(t)&&(t=t[0]);let e=this.returnSequences?t:null;return this.returnState?[e].concat(this.states.map(e=>null)):e})}get states(){if(null!=this.states_)return this.states_;{let e=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1,t=[];for(let n=0;n<e;++n)t.push(null);return t}}set states(e){this.states_=e}build(e){let t;let n=null;if(null!=this.numConstants)throw new pl("Constants support is not implemented in RNN yet.");fG(e)&&(e=e[0]);let r=this.stateful?e[0]:null,i=e.slice(2);this.inputSpec[0]=new f0({shape:[r,null,...i]});let s=[e[0]].concat(e.slice(2));if(null!=n)throw new pl("Constants support is not implemented in RNN yet.");if(this.cell.build(s),t=Array.isArray(this.cell.stateSize)?this.cell.stateSize:[this.cell.stateSize],null!=this.stateSpec){if(!H(this.stateSpec.map(e=>e.shape[e.shape.length-1]),t))throw new po(`An initialState was passed that is not compatible with cell.stateSize. Received stateSpec=${this.stateSpec}; However cell.stateSize is ${this.cell.stateSize}`)}else this.stateSpec=t.map(e=>new f0({shape:[null,e]}));this.stateful&&this.resetStates()}resetStates(e,t=!1){i2(()=>{if(!this.stateful)throw new ps("Cannot call resetStates() on an RNN Layer that is not stateful.");let n=this.inputSpec[0].shape[0];if(null==n)throw new po("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(null==this.states_)Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(e=>lv([n,e])):this.states_=[lv([n,this.cell.stateSize])];else if(null==e)i3(this.states_),null!=this.keptStates&&(i3(this.keptStates),this.keptStates=[]),Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(e=>lv([n,e])):this.states_[0]=lv([n,this.cell.stateSize]);else{if(Array.isArray(e)||(e=[e]),e.length!==this.states_.length)throw new po(`Layer ${this.name} expects ${this.states_.length} state(s), but it received ${e.length} state value(s). Input received: ${e}`);!0===t?this.keptStates.push(this.states_.slice()):i3(this.states_);for(let t=0;t<this.states_.length;++t){let r=e[t],i=[n,Array.isArray(this.cell.stateSize)?this.cell.stateSize[t]:this.cell.stateSize];if(!H(r.shape,i))throw new po(`State ${t} is incompatible with layer ${this.name}: expected shape=${i}, received shape=${r.shape}`);this.states_[t]=r}}this.states_=this.states_.map(e=>i4(e.clone()))})}apply(e,t){let n=null==t?null:t.initialState,r=null==t?null:t.constants;null==t&&(t={});let i=yN(e,n,r,this.numConstants);e=i.inputs,n=i.initialState,r=i.constants;let s=[],a=[];if(null!=n){for(let e of(t.initialState=n,s=s.concat(n),this.stateSpec=[],n))this.stateSpec.push(new f0({shape:e.shape}));a=a.concat(this.stateSpec)}if(null!=r&&(t.constants=r,s=s.concat(r),this.numConstants=r.length),!(s[0]instanceof f1))return super.apply(e,t);{let n=[e].concat(s),r=this.inputSpec.concat(a),i=this.inputSpec;this.inputSpec=r;let o=super.apply(n,t);return this.inputSpec=i,o}}call(e,t){return i2(()=>{let n=null==t?null:t.mask,r=null==t?null:t.training,i=null==t?null:t.initialState;e=fq(e),null==i&&(i=this.stateful?this.states_:this.getInitialState(e));let s=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1;if(i.length!==s)throw new po(`RNN Layer has ${s} state(s) but was passed ${i.length} initial state(s).`);this.unroll&&console.warn("Ignoring unroll = true for RNN layer, due to imperative backend.");let a={training:r},o=yO((e,t)=>{let n=this.cell.call([e].concat(t),a);return[n[0],n.slice(1)]},e,i,this.goBackwards,n,null,this.unroll,this.returnSequences),l=o[0],u=o[1],c=o[2];this.stateful&&this.resetStates(c,r);let h=this.returnSequences?u:l;return this.returnState?[h].concat(c):h})}getInitialState(e){return i2(()=>{let t=lv(e.shape);return(t=p7(t=o8(t,[1,2])),Array.isArray(this.cell.stateSize))?this.cell.stateSize.map(e=>e>1?fo(t,[1,e]):t):this.cell.stateSize>1?[fo(t,[1,this.cell.stateSize])]:[t]})}get trainableWeights(){return this.trainable?this.cell.trainableWeights:[]}get nonTrainableWeights(){return this.trainable?this.cell.nonTrainableWeights:this.cell.weights}setFastWeightInitDuringBuild(e){super.setFastWeightInitDuringBuild(e),null!=this.cell&&this.cell.setFastWeightInitDuringBuild(e)}getConfig(){let e=super.getConfig(),t={returnSequences:this.returnSequences,returnState:this.returnState,goBackwards:this.goBackwards,stateful:this.stateful,unroll:this.unroll};null!=this.numConstants&&(t.numConstants=this.numConstants);let n=this.cell.getConfig();return this.getClassName()===y$.className&&(t.cell={className:this.cell.getClassName(),config:n}),Object.assign(Object.assign(Object.assign({},n),e),t)}static fromConfig(e,t,n={}){let r=gD(t.cell,n);return new e(Object.assign(t,{cell:r}))}}y$.className="RNN",al(y$);class yR extends f6{}class yD extends yR{constructor(e){super(e),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",this.units=e.units,pC(this.units,"units"),this.activation=m6(null==e.activation?this.DEFAULT_ACTIVATION:e.activation),this.useBias=null==e.useBias||e.useBias,this.kernelInitializer=fj(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=fj(e.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=fj(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelRegularizer=yn(e.kernelRegularizer),this.recurrentRegularizer=yn(e.recurrentRegularizer),this.biasRegularizer=yn(e.biasRegularizer),this.kernelConstraint=gx(e.kernelConstraint),this.recurrentConstraint=gx(e.recurrentConstraint),this.biasConstraint=gx(e.biasConstraint),this.dropout=p2([1,p3([0,null==e.dropout?0:e.dropout])]),this.recurrentDropout=p2([1,p3([0,null==e.recurrentDropout?0:e.recurrentDropout])]),this.dropoutFunc=e.dropoutFunc,this.stateSize=this.units,this.dropoutMask=null,this.recurrentDropoutMask=null}build(e){e=fH(e),this.kernel=this.addWeight("kernel",[e[e.length-1],this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(e,t){return i2(()=>{let n;if(2!==e.length)throw new po(`SimpleRNNCell expects 2 input Tensors, got ${e.length}.`);let r=e[1];e=e[0];let i=null!=t.training&&t.training;0<this.dropout&&this.dropout<1&&null==this.dropoutMask&&(this.dropoutMask=yU({ones:()=>l_(e),rate:this.dropout,training:i,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&null==this.recurrentDropoutMask&&(this.recurrentDropoutMask=yU({ones:()=>l_(r),rate:this.recurrentDropout,training:i,dropoutFunc:this.dropoutFunc}));let s=this.dropoutMask,a=this.recurrentDropoutMask;n=null!=s?fu(s8(e,s),this.kernel.read()):fu(e,this.kernel.read()),null!=this.bias&&(n=fp(n,this.bias.read())),null!=a&&(r=s8(r,a));let o=s4(n,fu(r,this.recurrentKernel.read()));return null!=this.activation&&(o=this.activation.apply(o)),[o,o]})}getConfig(){let e=super.getConfig(),t={units:this.units,activation:m3(this.activation),useBias:this.useBias,kernelInitializer:fV(this.kernelInitializer),recurrentInitializer:fV(this.recurrentInitializer),biasInitializer:fV(this.biasInitializer),kernelRegularizer:ye(this.kernelRegularizer),recurrentRegularizer:ye(this.recurrentRegularizer),biasRegularizer:ye(this.biasRegularizer),activityRegularizer:ye(this.activityRegularizer),kernelConstraint:gw(this.kernelConstraint),recurrentConstraint:gw(this.recurrentConstraint),biasConstraint:gw(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout};return Object.assign(Object.assign({},e),t)}}yD.className="SimpleRNNCell",al(yD);class yF extends y${constructor(e){e.cell=new yD(e),super(e)}call(e,t){return i2(()=>{null!=this.cell.dropoutMask&&(i3(this.cell.dropoutMask),this.cell.dropoutMask=null),null!=this.cell.recurrentDropoutMask&&(i3(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);let n=null==t?null:t.mask,r=null==t?null:t.training,i=null==t?null:t.initialState;return super.call(e,{mask:n,training:r,initialState:i})})}static fromConfig(e,t){return new e(t)}}yF.className="SimpleRNN",al(yF);class yP extends yR{constructor(e){if(super(e),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",e.resetAfter)throw new po("GRUCell does not support reset_after parameter set to true.");this.units=e.units,pC(this.units,"units"),this.activation=m6(void 0===e.activation?this.DEFAULT_ACTIVATION:e.activation),this.recurrentActivation=m6(void 0===e.recurrentActivation?this.DEFAULT_RECURRENT_ACTIVATION:e.recurrentActivation),this.useBias=null==e.useBias||e.useBias,this.kernelInitializer=fj(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=fj(e.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=fj(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelRegularizer=yn(e.kernelRegularizer),this.recurrentRegularizer=yn(e.recurrentRegularizer),this.biasRegularizer=yn(e.biasRegularizer),this.kernelConstraint=gx(e.kernelConstraint),this.recurrentConstraint=gx(e.recurrentConstraint),this.biasConstraint=gx(e.biasConstraint),this.dropout=p2([1,p3([0,null==e.dropout?0:e.dropout])]),this.recurrentDropout=p2([1,p3([0,null==e.recurrentDropout?0:e.recurrentDropout])]),this.dropoutFunc=e.dropoutFunc,this.implementation=e.implementation,this.stateSize=this.units,this.dropoutMask=null,this.recurrentDropoutMask=null}build(e){let t=(e=fH(e))[e.length-1];this.kernel=this.addWeight("kernel",[t,3*this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,3*this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[3*this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(e,t){return i2(()=>{let n,r;if(2!==e.length)throw new po(`GRUCell expects 2 input Tensors (inputs, h, c), got ${e.length}.`);let i=null!=t.training&&t.training,s=e[1];e=e[0],0<this.dropout&&this.dropout<1&&null==this.dropoutMask&&(this.dropoutMask=yU({ones:()=>l_(e),rate:this.dropout,training:i,count:3,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&null==this.recurrentDropoutMask&&(this.recurrentDropoutMask=yU({ones:()=>l_(s),rate:this.recurrentDropout,training:i,count:3,dropoutFunc:this.dropoutFunc}));let a=this.dropoutMask,o=this.recurrentDropoutMask;0<this.dropout&&this.dropout<1&&(e=s8(e,a[0]));let l=fu(e,this.kernel.read());this.useBias&&(l=fp(l,this.bias.read())),0<this.recurrentDropout&&this.recurrentDropout<1&&(s=s8(s,o[0]));let u=this.recurrentKernel.read(),[c,h]=lV(u,[2*this.units,this.units],u.rank-1),d=fu(s,c),[p,f,g]=lV(l,3,l.rank-1),[m,y]=lV(d,2,d.rank-1);n=this.recurrentActivation.apply(s4(p,m));let b=fu(s8(this.recurrentActivation.apply(s4(f,y)),s),h);r=this.activation.apply(s4(g,b));let v=s4(s8(n,s),s8(s4(1,lm(n)),r));return[v,v]})}getConfig(){let e=super.getConfig(),t={units:this.units,activation:m3(this.activation),recurrentActivation:m3(this.recurrentActivation),useBias:this.useBias,kernelInitializer:fV(this.kernelInitializer),recurrentInitializer:fV(this.recurrentInitializer),biasInitializer:fV(this.biasInitializer),kernelRegularizer:ye(this.kernelRegularizer),recurrentRegularizer:ye(this.recurrentRegularizer),biasRegularizer:ye(this.biasRegularizer),activityRegularizer:ye(this.activityRegularizer),kernelConstraint:gw(this.kernelConstraint),recurrentConstraint:gw(this.recurrentConstraint),biasConstraint:gw(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation,resetAfter:!1};return Object.assign(Object.assign({},e),t)}}yP.className="GRUCell",al(yP);class yM extends y${constructor(e){0===e.implementation&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),e.cell=new yP(e),super(e)}call(e,t){return i2(()=>{null!=this.cell.dropoutMask&&(i3(this.cell.dropoutMask),this.cell.dropoutMask=null),null!=this.cell.recurrentDropoutMask&&(i3(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);let n=null==t?null:t.mask,r=null==t?null:t.training,i=null==t?null:t.initialState;return super.call(e,{mask:n,training:r,initialState:i})})}static fromConfig(e,t){return 0===t.implmentation&&(t.implementation=1),new e(t)}}yM.className="GRU",al(yM);class yL extends yR{constructor(e){super(e),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",this.units=e.units,pC(this.units,"units"),this.activation=m6(void 0===e.activation?this.DEFAULT_ACTIVATION:e.activation),this.recurrentActivation=m6(void 0===e.recurrentActivation?this.DEFAULT_RECURRENT_ACTIVATION:e.recurrentActivation),this.useBias=null==e.useBias||e.useBias,this.kernelInitializer=fj(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=fj(e.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=fj(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.unitForgetBias=e.unitForgetBias,this.kernelRegularizer=yn(e.kernelRegularizer),this.recurrentRegularizer=yn(e.recurrentRegularizer),this.biasRegularizer=yn(e.biasRegularizer),this.kernelConstraint=gx(e.kernelConstraint),this.recurrentConstraint=gx(e.recurrentConstraint),this.biasConstraint=gx(e.biasConstraint),this.dropout=p2([1,p3([0,null==e.dropout?0:e.dropout])]),this.recurrentDropout=p2([1,p3([0,null==e.recurrentDropout?0:e.recurrentDropout])]),this.dropoutFunc=e.dropoutFunc,this.implementation=e.implementation,this.stateSize=[this.units,this.units],this.dropoutMask=null,this.recurrentDropoutMask=null}build(e){var t;let n;let r=(e=fH(e))[e.length-1];if(this.kernel=this.addWeight("kernel",[r,4*this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,4*this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias){if(this.unitForgetBias){let e=this.biasInitializer,r=this.units;n=new((t=class extends fT{apply(t,n){let i=e.apply([r]),s=new fk().apply([r]),a=e.apply([2*r]);return fa(fa(i,s),a)}}).className="CustomInit",t)}else n=this.biasInitializer;this.bias=this.addWeight("bias",[4*this.units],null,n,this.biasRegularizer,!0,this.biasConstraint)}else this.bias=null;this.built=!0}call(e,t){return i2(()=>{let n,r;let i=null!=t.training&&t.training;if(3!==e.length)throw new po(`LSTMCell expects 3 input Tensors (inputs, h, c), got ${e.length}.`);let s=e[1],a=e[2];e=e[0],0<this.dropout&&this.dropout<1&&null==this.dropoutMask&&(this.dropoutMask=yU({ones:()=>l_(e),rate:this.dropout,training:i,count:4,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&null==this.recurrentDropoutMask&&(this.recurrentDropoutMask=yU({ones:()=>l_(s),rate:this.recurrentDropout,training:i,count:4,dropoutFunc:this.dropoutFunc}));let o=this.dropoutMask,l=this.recurrentDropoutMask;0<this.dropout&&this.dropout<1&&(e=s8(e,o[0]));let u=fu(e,this.kernel.read());0<this.recurrentDropout&&this.recurrentDropout<1&&(s=s8(s,l[0])),u=s4(u,fu(s,this.recurrentKernel.read())),this.useBias&&(u=fp(u,this.bias.read()));let[c,h,d,p]=lV(u,4,u.rank-1);n=this.recurrentActivation.apply(c),r=s4(s8(this.recurrentActivation.apply(h),a),s8(n,this.activation.apply(d)));let f=s8(this.recurrentActivation.apply(p),this.activation.apply(r));return[f,f,r]})}getConfig(){let e=super.getConfig(),t={units:this.units,activation:m3(this.activation),recurrentActivation:m3(this.recurrentActivation),useBias:this.useBias,kernelInitializer:fV(this.kernelInitializer),recurrentInitializer:fV(this.recurrentInitializer),biasInitializer:fV(this.biasInitializer),unitForgetBias:this.unitForgetBias,kernelRegularizer:ye(this.kernelRegularizer),recurrentRegularizer:ye(this.recurrentRegularizer),biasRegularizer:ye(this.biasRegularizer),activityRegularizer:ye(this.activityRegularizer),kernelConstraint:gw(this.kernelConstraint),recurrentConstraint:gw(this.recurrentConstraint),biasConstraint:gw(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation};return Object.assign(Object.assign({},e),t)}}yL.className="LSTMCell",al(yL);class yz extends y${constructor(e){0===e.implementation&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),e.cell=new yL(e),super(e)}call(e,t){return i2(()=>{null!=this.cell.dropoutMask&&(i3(this.cell.dropoutMask),this.cell.dropoutMask=null),null!=this.cell.recurrentDropoutMask&&(i3(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);let n=null==t?null:t.mask,r=null==t?null:t.training,i=null==t?null:t.initialState;return super.call(e,{mask:n,training:r,initialState:i})})}static fromConfig(e,t){return 0===t.implmentation&&(t.implementation=1),new e(t)}}yz.className="LSTM",al(yz);class yB extends yR{constructor(e){super(e),this.cells=e.cells}get stateSize(){let e=[];for(let t of this.cells.slice().reverse())Array.isArray(t.stateSize)?e.push(...t.stateSize):e.push(t.stateSize);return e}call(e,t){return i2(()=>{let n;let r=e.slice(1),i=[];for(let e of this.cells.slice().reverse())Array.isArray(e.stateSize)?i.push(r.splice(0,e.stateSize.length)):i.push(r.splice(0,1));i.reverse();let s=[];for(let a=0;a<this.cells.length;++a){let o=this.cells[a];r=i[a],n=0===a?[e[0]].concat(r):[n[0]].concat(r),n=o.call(n,t),s.push(n.slice(1))}for(let e of(r=[],s.slice().reverse()))r.push(...e);return[n[0]].concat(r)})}build(e){let t;fG(e)&&(e=e[0]),this.cells.forEach((n,r)=>{pK(`RNNCell_${r}`,()=>{n.build(e),t=Array.isArray(n.stateSize)?n.stateSize[0]:n.stateSize,e=[e[0],t]})}),this.built=!0}getConfig(){let e=super.getConfig(),t=e=>({className:e.getClassName(),config:e.getConfig()}),n={cells:this.cells.map(t)};return Object.assign(Object.assign({},e),n)}static fromConfig(e,t,n={}){let r=[];for(let e of t.cells)r.push(gD(e,n));return new e({cells:r})}get trainableWeights(){if(!this.trainable)return[];let e=[];for(let t of this.cells)e.push(...t.trainableWeights);return e}get nonTrainableWeights(){let e=[];for(let t of this.cells)e.push(...t.nonTrainableWeights);if(!this.trainable){let t=[];for(let e of this.cells)t.push(...e.trainableWeights);return t.concat(e)}return e}getWeights(){let e=[];for(let t of this.cells)e.push(...t.weights);return fJ(e)}setWeights(e){let t=[];for(let n of this.cells){let r=n.weights.length,i=e.splice(r);for(let e=0;e<n.weights.length;++e)t.push([n.weights[e],i[e]])}fZ(t)}}function yU(e){let{ones:t,rate:n,training:r=!1,count:i=1,dropoutFunc:s}=e,a=()=>null!=s?s(t(),n):fm(t(),n),o=()=>fb(a,t,r);return!i||i<=1?i4(o().clone()):Array(i).fill(void 0).map(o).map(e=>i4(e.clone()))}yB.className="StackedRNNCells",al(yB);var yV=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&0>t.indexOf(r)&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var i=0,r=Object.getOwnPropertySymbols(e);i<r.length;i++)0>t.indexOf(r[i])&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]]);return n};class yj extends y${constructor(e){if(e.unroll)throw new pl("Unrolling is not possible with convolutional RNNs.");if(Array.isArray(e.cell))throw new pl("It is not possible at the moment to stack convolutional cells.");super(e),this.inputSpec=[new f0({ndim:5})]}call(e,t){return i2(()=>{if(null!=this.cell.dropoutMask&&(i3(this.cell.dropoutMask),this.cell.dropoutMask=null),null!=this.cell.recurrentDropoutMask&&(i3(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null),t&&t.constants)throw new po("ConvRNN2D cell does not support constants");let n=null==t?null:t.mask,r=null==t?null:t.training,i=null==t?null:t.initialState;return super.call(e,{mask:n,training:r,initialState:i})})}computeOutputShape(e){let t=this.computeSingleOutputShape(e);return this.returnSequences||(t=[t[0],...t.slice(2)]),this.returnState&&(t=[t,...[,,].fill([e[0],...t.slice(-3)])]),t}getInitialState(e){return i2(()=>{let{stateSize:t}=this.cell,n=e.shape,r=this.computeSingleOutputShape(n),i=lv([r[0],...r.slice(2)]);return Array.isArray(t)?Array(t.length).fill(i):[i]})}resetStates(e,t=!1){i2(()=>{if(!this.stateful)throw new ps("Cannot call resetStates() on an RNN Layer that is not stateful.");let n=this.inputSpec[0].shape,r=this.computeSingleOutputShape(n),i=[r[0],...r.slice(2)];if(null==n[0])throw new po("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(null==this.getStates())Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(()=>lv(i)):this.states_=[lv(i)];else if(null==e)i3(this.states_),null!=this.keptStates&&(i3(this.keptStates),this.keptStates=[]),Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(()=>lv(i)):this.states_[0]=lv(i);else{if(Array.isArray(e)||(e=[e]),e.length!==this.states_.length)throw new po(`Layer ${this.name} expects ${this.states_.length} state(s), but it received ${e.length} state value(s). Input received: ${e}`);t?this.keptStates.push(this.states_.slice()):i3(this.states_);for(let t=0;t<this.states_.length;++t){let n=e[t],r=i;if(!H(n.shape,r))throw new po(`State ${t} is incompatible with layer ${this.name}: expected shape=${r}, received shape=${n.shape}`);this.states_[t]=n}}this.states_=this.states_.map(e=>i4(e.clone()))})}computeSingleOutputShape(e){let{dataFormat:t,filters:n,kernelSize:r,padding:i,strides:s,dilationRate:a}=this.cell,o="channelsFirst"===t,l=e[o?3:2],u=e[o?4:3],c=yc(l,r[0],i,s[0],a[0]),h=yc(u,r[1],i,s[1],a[1]);return[...e.slice(0,2),...o?[n,c,h]:[c,h,n]]}}yj.className="ConvRNN2D";class yG extends yL{constructor(e){let{filters:t,kernelSize:n,strides:r,padding:i,dataFormat:s,dilationRate:a}=e;super(Object.assign(Object.assign({},e),{units:t})),this.filters=t,pC(this.filters,"filters"),this.kernelSize=yu(n,2,"kernelSize"),this.kernelSize.forEach(e=>pC(e,"kernelSize")),this.strides=yu(r||1,2,"strides"),this.strides.forEach(e=>pC(e,"strides")),this.padding=i||"valid",pG(this.padding),this.dataFormat=s||"channelsLast",pV(this.dataFormat),this.dilationRate=yu(a||1,2,"dilationRate"),this.dilationRate.forEach(e=>pC(e,"dilationRate"))}build(e){var t;e=fH(e);let n="channelsFirst"===this.dataFormat?1:e.length-1;if(null==e[n])throw new po(`The channel dimension of the input should be defined. Found ${e[n]}`);let r=e[n],i=4,s=this.kernelSize.concat([r,this.filters*i]);this.kernel=this.addWeight("kernel",s,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint);let a=this.kernelSize.concat([this.filters,this.filters*i]);if(this.recurrentKernel=this.addWeight("recurrent_kernel",a,null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias){let e;if(this.unitForgetBias){let n=this.biasInitializer,r=this.filters;e=new((t=class extends fT{apply(e,t){return fs([n.apply([r]),lw([r]),n.apply([2*r])])}}).className="CustomInit",t)}else e=this.biasInitializer;this.bias=this.addWeight("bias",[this.filters*i],null,e,this.biasRegularizer,!0,this.biasConstraint)}this.built=!0}call(e,t){return i2(()=>{if(3!==e.length)throw new po(`ConvLSTM2DCell expects 3 input Tensors (inputs, h, c), got ${e.length}.`);let n=t.training||!1,r=e[0],i=e[1],s=e[2],a=4;0<this.dropout&&this.dropout<1&&null==this.dropoutMask&&(this.dropoutMask=yU({ones:()=>l_(r),rate:this.dropout,training:n,count:a,dropoutFunc:this.dropoutFunc}));let o=this.dropoutMask,l=(e,t,n)=>t&&t[n]?s8(t[n],e):e,u=l(r,o,0),c=l(r,o,1),h=l(r,o,2),d=l(r,o,3);0<this.recurrentDropout&&this.recurrentDropout<1&&null==this.recurrentDropoutMask&&(this.recurrentDropoutMask=yU({ones:()=>l_(i),rate:this.recurrentDropout,training:n,count:a,dropoutFunc:this.dropoutFunc}));let p=this.recurrentDropoutMask,f=l(i,p,0),g=l(i,p,1),m=l(i,p,2),y=l(i,p,3),b=3,[v,w,_,x]=lV(this.kernel.read(),a,b),[T,I,k,S]=this.useBias?lV(this.bias.read(),a):[null,null,null,null];u=this.inputConv(u,v,T,this.padding),c=this.inputConv(c,w,I,this.padding),h=this.inputConv(h,_,k,this.padding),d=this.inputConv(d,x,S,this.padding);let[E,C,A,N]=lV(this.recurrentKernel.read(),a,b);f=this.recurrentConv(f,E),g=this.recurrentConv(g,C),m=this.recurrentConv(m,A),y=this.recurrentConv(y,N);let O=this.recurrentActivation.apply(s4(u,f)),$=this.recurrentActivation.apply(s4(c,g)),R=s4(s8($,s),s8(O,this.activation.apply(s4(h,m)))),D=s8(this.recurrentActivation.apply(s4(d,y)),this.activation.apply(R));return[D,D,R]})}getConfig(){let e=super.getConfig(),{units:t}=e,n=yV(e,["units"]),r={filters:this.filters,kernelSize:this.kernelSize,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,strides:this.strides};return Object.assign(Object.assign({},n),r)}inputConv(e,t,n,r){let i=oM(e,t,this.strides,r||"valid","channelsFirst"===this.dataFormat?"NCHW":"NHWC",this.dilationRate);return n?fp(i,n,this.dataFormat):i}recurrentConv(e,t){return oM(e,t,1,"same","channelsFirst"===this.dataFormat?"NCHW":"NHWC")}}yG.className="ConvLSTM2DCell",al(yG);class yW extends yj{constructor(e){super(Object.assign(Object.assign({},e),{cell:new yG(e)}))}static fromConfig(e,t){return new e(t)}}yW.className="ConvLSTM2D",al(yW);class yq extends f6{constructor(e){super(e),this.rate=Math.max(Math.min(e.rate,1),0),this.noiseShape=e.noiseShape,this.seed=e.seed,this.supportsMasking=!0}getNoiseShape(e){if(null==this.noiseShape)return this.noiseShape;let t=e.shape,n=[];for(let e=0;e<this.noiseShape.length;++e)n.push(null==this.noiseShape[e]?t[e]:this.noiseShape[e]);return n}call(e,t){return i2(()=>{this.invokeCallHook(e,t);let n=fq(e);if(0<this.rate&&this.rate<1){let e=null!=t.training&&t.training,r=this.getNoiseShape(n);return fb(()=>fm(n,this.rate,r,this.seed),()=>n,e)}return e})}getConfig(){let e={rate:this.rate,noiseShape:this.noiseShape,seed:this.seed};return Object.assign(e,super.getConfig()),e}dispose(){return super.dispose()}}yq.className="Dropout",al(yq);class yH extends yq{constructor(e){super(e),this.inputSpec=[{ndim:3}]}getNoiseShape(e){let t=e.shape;return[t[0],1,t[2]]}}yH.className="SpatialDropout1D",al(yH);class yK extends f6{constructor(e){if(super(e),this.activation=null,this.useBias=!0,this.kernel=null,this.bias=null,this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_BIAS_INITIALIZER="zeros",null==e.batchInputShape&&null==e.inputShape&&null!=e.inputDim){let t=null;null!=e.batchSize&&(t=e.batchSize),this.batchInputShape=[t,e.inputDim]}this.units=e.units,pC(this.units,"units"),this.activation=m6(e.activation),null!=e.useBias&&(this.useBias=e.useBias),this.kernelInitializer=fj(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.biasInitializer=fj(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelConstraint=gx(e.kernelConstraint),this.biasConstraint=gx(e.biasConstraint),this.kernelRegularizer=yn(e.kernelRegularizer),this.biasRegularizer=yn(e.biasRegularizer),this.activityRegularizer=yn(e.activityRegularizer),this.supportsMasking=!0,this.inputSpec=[{minNDim:2}]}build(e){let t=(e=fH(e))[e.length-1];null==this.kernel&&(this.kernel=this.addWeight("kernel",[t,this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint))),this.inputSpec=[{minNDim:2,axes:{[-1]:t}}],this.built=!0}computeOutputShape(e){let t=(e=fH(e)).slice();return t[t.length-1]=this.units,t}call(e,t){return i2(()=>{let n;this.invokeCallHook(e,t);let r=fq(e),i=pO(this.activation.getClassName());return null!=i?n=fu(r,this.kernel.read(),i,this.bias?this.bias.read():null):(n=fu(r,this.kernel.read()),null!=this.bias&&(n=fp(n,this.bias.read())),null!=this.activation&&(n=this.activation.apply(n))),n})}getConfig(){let e={units:this.units,activation:m3(this.activation),useBias:this.useBias,kernelInitializer:fV(this.kernelInitializer),biasInitializer:fV(this.biasInitializer),kernelRegularizer:ye(this.kernelRegularizer),biasRegularizer:ye(this.biasRegularizer),activityRegularizer:ye(this.activityRegularizer),kernelConstraint:gw(this.kernelConstraint),biasConstraint:gw(this.biasConstraint)};return Object.assign(e,super.getConfig()),e}}yK.className="Dense",al(yK);class yX extends f6{constructor(e){super(e=e||{}),this.inputSpec=[{minNDim:3}],this.dataFormat=e.dataFormat}computeOutputShape(e){for(let t of(e=fH(e)).slice(1))if(null==t)throw new po(`The shape of the input to "Flatten" is not fully defined (got ${e.slice(1)}). Make sure to pass a complete "input_shape" or "batch_input_shape" argument to the first layer in your model.`);return[e[0],p1(e,1)]}call(e,t){return i2(()=>{this.invokeCallHook(e,t);let n=fq(e);if("channelsFirst"===this.dataFormat&&n.rank>1){let e=[0];for(let t=2;t<n.rank;++t)e.push(t);e.push(1),n=l0(n,e)}return ft(n)})}getConfig(){let e={};return null!=this.dataFormat&&(e.dataFormat=this.dataFormat),Object.assign(e,super.getConfig()),e}}yX.className="Flatten",al(yX);class yY extends f6{constructor(e){super(e),this.supportsMasking=!0,this.activation=m6(e.activation)}call(e,t){return i2(()=>{this.invokeCallHook(e,t);let n=fq(e);return this.activation.apply(n)})}getConfig(){let e={activation:m3(this.activation)};return Object.assign(e,super.getConfig()),e}}yY.className="Activation",al(yY);class yQ extends f6{constructor(e){super(e),this.n=e.n,this.inputSpec=[{ndim:2}]}computeOutputShape(e){return[e[0],this.n,e[1]]}call(e,t){return i2(()=>p9(e=fq(e),this.n))}getConfig(){let e={n:this.n};return Object.assign(e,super.getConfig()),e}}yQ.className="RepeatVector",al(yQ);class yJ extends f6{constructor(e){super(e),this.targetShape=e.targetShape;for(let e=0;e<this.targetShape.length;++e)this.isUnknown(this.targetShape[e])&&(this.targetShape[e]=null)}isUnknown(e){return e<0||null==e}fixUnknownDimension(e,t){let n="Total size of new array must be unchanged.",r=t.slice(),i=1,s=null;for(let e=0;e<r.length;++e){let t=r[e];if(this.isUnknown(t)){if(null===s)s=e;else throw new po("Can only specifiy one unknown dimension.")}else i*=t}let a=p1(e);if(null!==s){if(0===i||a%i!=0)throw new po(n);r[s]=a/i}else if(a!==i)throw new po(n);return r}computeOutputShape(e){let t=!1;for(let n=0;n<e.length;++n)if(this.isUnknown(e[n])){t=!0;break}return t?e.slice(0,1).concat(this.targetShape):e.slice(0,1).concat(this.fixUnknownDimension(e.slice(1),this.targetShape))}call(e,t){return i2(()=>{this.invokeCallHook(e,t);let n=fq(e),r=n.shape;return ox(n,r.slice(0,1).concat(this.fixUnknownDimension(r.slice(1),this.targetShape)))})}getConfig(){let e={targetShape:this.targetShape};return Object.assign(e,super.getConfig()),e}}yJ.className="Reshape",al(yJ);class yZ extends f6{constructor(e){if(super(e),null==e.dims)throw Error("Required configuration field `dims` is missing during Permute constructor call.");if(!Array.isArray(e.dims))throw Error(`Permute constructor requires \`dims\` to be an Array, but received ${e.dims} instead.`);let t=p4(1,e.dims.length+1);if(!H(e.dims.slice().sort(),t))throw Error("Invalid permutation `dims`: "+JSON.stringify(e.dims)+" `dims` must contain consecutive integers starting from 1.");this.dims=e.dims,this.dimsIncludingBatch=[0].concat(this.dims),this.inputSpec=[new f0({ndim:this.dims.length+1})]}computeOutputShape(e){let t=(e=fH(e)).slice();return this.dims.forEach((n,r)=>{t[r+1]=e[n]}),t}call(e,t){return l0(fq(e),this.dimsIncludingBatch)}getConfig(){let e={dims:this.dims};return Object.assign(e,super.getConfig()),e}}yZ.className="Permute",al(yZ);class y0 extends f6{constructor(e){super(null==e?{}:e),this.supportsMasking=!0,null!=e?this.maskValue=null==e.maskValue?0:e.maskValue:this.maskValue=0}computeOutputShape(e){return e}getConfig(){let e=super.getConfig(),t={maskValue:this.maskValue};return Object.assign(t,e),t}computeMask(e,t){let n=fq(e),r=-1;return ot(ly(n,this.maskValue),r)}call(e,t){return i2(()=>{this.invokeCallHook(e,t);let n=fq(e),r=-1,i=!0,s=ot(ly(n,this.maskValue),r,i);return s8(n,s1(s,n.dtype))})}}y0.className="Masking",al(y0);class y1 extends f6{constructor(e){if(super(e),this.embeddings=null,this.DEFAULT_EMBEDDINGS_INITIALIZER="randomUniform",null==e.batchInputShape&&null==e.inputShape){let t=null;null!=e.batchSize&&(t=e.batchSize),null==e.inputLength?this.batchInputShape=[t,null]:this.batchInputShape=[t].concat(pg(e.inputLength))}this.inputDim=e.inputDim,pC(this.inputDim,"inputDim"),this.outputDim=e.outputDim,pC(this.outputDim,"outputDim"),this.embeddingsInitializer=fj(e.embeddingsInitializer||this.DEFAULT_EMBEDDINGS_INITIALIZER),this.embeddingsRegularizer=yn(e.embeddingsRegularizer),this.activityRegularizer=yn(e.activityRegularizer),this.embeddingsConstraint=gx(e.embeddingsConstraint),this.maskZero=e.maskZero,this.supportsMasking=e.maskZero,this.inputLength=e.inputLength}build(e){this.embeddings=this.addWeight("embeddings",[this.inputDim,this.outputDim],this.dtype,this.embeddingsInitializer,this.embeddingsRegularizer,!0,this.embeddingsConstraint),this.built=!0}warnOnIncompatibleInputShape(e){}computeMask(e,t){return i2(()=>this.maskZero?ly(e=fq(e),ae(e)):null)}computeOutputShape(e){if(e=fH(e),null==this.inputLength)return[...e,this.outputDim];let t=pg(this.inputLength);if(t.length!==e.length-1)throw new po(`"inputLength" is ${this.inputLength}, but received input shape has shape ${e}`);{let n=0;for(let r=0;r<t.length;++r){let i=t[r],s=e[r+1];if(null!=i&&null!=s&&i!==s)throw new po(`"inputLength" is ${this.inputLength}, but received input shape has shape ${e}`);null==i&&(t[n]=s),n++}}return[e[0],...t,this.outputDim]}call(e,t){return i2(()=>{this.invokeCallHook(e,t);let n=fq(e);"int32"!==n.dtype&&(n=p8(n,"int32"));let r=fc(this.embeddings.read(),ox(n,[n.size]));return ox(r,fH(this.computeOutputShape(n.shape)))})}getConfig(){let e={inputDim:this.inputDim,outputDim:this.outputDim,embeddingsInitializer:fV(this.embeddingsInitializer),embeddingsRegularizer:ye(this.embeddingsRegularizer),activityRegularizer:ye(this.activityRegularizer),embeddingsConstraint:gw(this.embeddingsConstraint),maskZero:this.maskZero,inputLength:this.inputLength};return Object.assign(e,super.getConfig()),e}}y1.className="Embedding",al(y1);class y2 extends f6{constructor(e){super(e||{}),this.supportsMasking=!0}mergeFunction(e){throw new pl}computeElementwiseOpOutputShape(e,t){if(null==e||null==t)return null;if(e.length<t.length)return this.computeElementwiseOpOutputShape(t,e);if(0===t.length)return e;let n=e.slice(0,e.length-t.length);for(let r=0;r<t.length;++r){let i=e[e.length-t.length+r],s=t[r];if(null==i||null==s||i<0||s<0)n.push(null);else if(1===i)n.push(s);else if(1===s)n.push(i);else{if(i!==s)throw new po("Operands could not be broadcast together with shapes "+JSON.stringify(e)+" "+JSON.stringify(t));n.push(i)}}return n}build(e){if(Array.isArray(e)&&!Array.isArray(e[0])&&(e=[fH(e)]),e.length<2)throw new po(`A merge layer should be called on an Array of at least 2 inputs. Got ${e.length} input(s).`);let t=[];for(let n of e)null!=n&&null!==n[0]&&t.push(n[0]);if((t=pI(t)).length>1)throw new po(`Can not merge tensors with different batch sizes. Got tensors with shapes: ${JSON.stringify(e)}.`);let n=null==e[0]?null:e[0].slice(1);for(let t=1;t<e.length;++t){let r=null==e[t]?null:e[t].slice(1);n=this.computeElementwiseOpOutputShape(n,r)}let r=e.map(e=>e.length);-1===e.indexOf(null)&&1===pI(r).length?this.reshapeRequired=!1:this.reshapeRequired=!0}call(e,t){return i2(()=>{if(!this.reshapeRequired)return this.mergeFunction(e);{let t=[],n=e.map(e=>e.rank);if(-1===n.indexOf(null)){let r=p3(n);for(let n of e){let e=n.rank;for(let t=0;t<r-e;++t)n=p7(n,1);t.push(n)}return this.mergeFunction(t)}{let n=!1;for(let r of e){let e=r.rank;if(null==e){let e=r.shape,i=e[0],s=e.slice(1).concat([i]),a=ox(r,[i].concat(p1(e.slice(1))));a=ox(a=l0(a,[1,0]),s),t.push(a),n=!0}else if(e>1){let i=p4(1,e).concat([0]);t.push(l0(r,i)),n=!0}else t.push(r)}let r=this.mergeFunction(t),i=r.rank;if(n){if(null==i){let e=r.shape,t=e.length,n=e[t-1],i=[n].concat(e.slice(0,e.length-1));r=ox(l0(ox(r,[-1,n]),[1,0]),i)}else i>1&&(r=l0(r,[i-1].concat(p4(0,i-1))))}return r}}})}computeOutputShape(e){let t;t=null==e[0]?null:e[0].slice(1);for(let n=1;n<e.length;++n){let r=null==e[n]?null:e[n].slice(1);t=this.computeElementwiseOpOutputShape(t,r)}let n=[];for(let t of e)null!=t&&null!==t[0]&&n.push(t[0]);return 1===(n=pI(n)).length?n.concat(t):[null].concat(t)}computeMask(e,t){return i2(()=>{if(null==t)return null;if(!Array.isArray(t))throw new po("`mask` should be an Array");if(!Array.isArray(e))throw new po("`inputs` should be an Array");if(t.length!==e.length)throw new po(`The Array 'inputs' and 'mask' are expected to have the same length, but have different lengths (${e.length} vs ${t.length})`);if(t.every(e=>null==e))return null;let n=(t=t.map(e=>null==e?e:oY(e,0)))[0];for(let e=1;e<t.length-1;++e)n=ll(n,t[e]);return n})}}class y3 extends y2{constructor(e){super(e)}mergeFunction(e){return i2(()=>{let t=e[0].clone();for(let n=1;n<e.length;++n)t=s4(t,e[n]);return t})}}y3.className="Add",al(y3);class y4 extends y2{constructor(e){super(e)}mergeFunction(e){return i2(()=>{let t=e[0].clone();for(let n=1;n<e.length;++n)t=s8(t,e[n]);return t})}}y4.className="Multiply",al(y4);class y6 extends y2{constructor(e){super(e)}mergeFunction(e){return i2(()=>{let t=e[0].clone();for(let n=1;n<e.length;++n)t=s4(t,e[n]);return s8(1/e.length,t)})}}y6.className="Average",al(y6);class y5 extends y2{constructor(e){super(e)}mergeFunction(e){return i2(()=>{let t=e[0];for(let n=1;n<e.length;++n)t=aw(t,e[n]);return t})}}y5.className="Maximum",al(y5);class y8 extends y2{constructor(e){super(e)}mergeFunction(e){return i2(()=>{let t=e[0];for(let n=1;n<e.length;++n)t=lf(t,e[n]);return t})}}y8.className="Minimum",al(y8);class y7 extends y2{constructor(e){super(e),this.DEFAULT_AXIS=-1,null==e&&(e={}),this.axis=null==e.axis?this.DEFAULT_AXIS:e.axis,this.supportsMasking=!0,this.reshapeRequired=!1}build(e){if(!(Array.isArray(e)&&Array.isArray(e[0]))||1===e.length)throw new po("A `Concatenate` layer should be called on a list of at least 2 inputs");let t=!0;for(let n of e)if(null!=n){t=!1;break}if(t)return;let n=[];for(let t=0;t<e.length;++t){let r=e[t].slice();r.splice(this.axis,1);let i=!1;for(let e of n)if(H(e,r)){i=!0;break}i||n.push(r)}if(n.length>1)throw new po("A `Concatenate` layer requires inputs with matching shapes except for the concat axis. Got input shapes: "+JSON.stringify(e))}mergeFunction(e){return i2(()=>fs(e,this.axis))}computeOutputShape(e){if(!(Array.isArray(e)&&Array.isArray(e[0])))throw new po("A `Concatenate` layer should be called on a list of inputs.");let t=e,n=t[0].slice(),r=this.axis<0?n.length+this.axis:this.axis;for(let e of t.slice(1)){if(null==n[r]||null==e[r]){n[r]=null;break}n[r]+=e[r]}return n}computeMask(e,t){if(null==t)return null;if(!Array.isArray(t))throw new po("`mask` should be an array for Concatenate");if(!Array.isArray(e))throw new po("`inputs` should be an array for Concatenate");if(t.length!==e.length)throw new po(`Mismatch in the length of mask (${t.length}) and the legnth of inputs (${e.length})`);return i2(()=>{let n=!0;if(t.forEach(e=>{if(null!=e){n=!1;return}}),n)return null;let r=[];for(let n=0;n<e.length;++n)null==t[n]?r.push(s1(l_(e[n]),"bool")):t[n].rank<e[n].rank?r.push(oY(t[n],-1)):r.push(t[n]);return oe(o$(r,this.axis),-1,!1)})}getConfig(){let e={axis:this.axis};return Object.assign(e,super.getConfig()),e}}function y9(e,t){for(;e<0;)e+=t;return e}function be(e,t,n){if(e.shape.length>3||t.shape.length>3)throw new pl("batchDot is not implemented for tensors of 4D or higher rank yet");if(j(e.shape.length>=2,()=>`batchDot requires the rank of x to be >= 2, but got ${e.shape.length}`),j(e.shape.length>=2,()=>`batchDot requires the rank of y to be >= 2, but got ${t.shape.length}`),"number"==typeof n&&(n=[n,n]),"complex64"===e.dtype||"complex64"===t.dtype)throw new pl("batchDot is not implemented for complex64-type Tensors yet.");let r=e.shape.length,i=t.shape.length;null==n&&(n=[r-1,i-2]);let s=n;return i2(()=>{let n,a;if(r>i){n=r-i;let e=[];for(let t=0;t<n;++t)e.push(1);t=ox(t,t.shape.concat(e))}else if(i>r){n=i-r;let t=[];for(let e=0;e<n;++e)t.push(1);e=ox(e,e.shape.concat(t))}else n=0;if(2===e.shape.length&&2===t.shape.length)a=s[0]===s[1]?o8(s8(e,t),s[0]):o8(s8(l0(e,[1,0]),t),s[1]);else{let n=s[0]!==e.shape.length-1,r=s[1]===t.shape.length-1;a=lu(e,t,n,r)}if(n>0){let e;e=r>i?r+i-3:r-1;let t=[];for(let r=e;r<e+n;++r)t.push(r);a=lj(a,t)}return 1===a.shape.length&&(a=oY(a,1)),a})}y7.className="Concatenate",al(y7);class bt extends y2{constructor(e){super(e),this.axes=e.axes,this.normalize=null!=e.normalize&&e.normalize,this.supportsMasking=!0,this.reshapeRequired=!1}build(e){j(Array.isArray(e)&&2===e.length&&Array.isArray(e[0])&&Array.isArray(e[1]),()=>"A `Dot` layer should be called on a list of exactly 2 inputs.");let t=e[0],n=e[1];if(t.length>3||n.length>3)throw new pl("Dot layer does not support tensors of 4D or higher rank yet.");let r=this.interpretAxes(t,n);if(t[r[0]]!==n[r[1]])throw new po(`Dimension incompatibility: ${t[r[0]]} !== ${n[r[1]]}`)}mergeFunction(e){let t;if(2!==e.length)throw new po(`A \`Dot\` layer must be called on exactly 2 inputs, but received ${e.length} input(s).`);let n=e[0],r=e[1];return t=Array.isArray(this.axes)?this.axes.map((t,n)=>y9(t,e[n].shape.length)):[y9(this.axes,n.shape.length),y9(this.axes,r.shape.length)],this.normalize&&(n=gF(n,t[0]),r=gF(r,t[1])),be(n,r,t)}interpretAxes(e,t){return Array.isArray(this.axes)?this.axes:[y9(this.axes,e.length),y9(this.axes,t.length)]}computeOutputShape(e){j(Array.isArray(e)&&2===e.length&&Array.isArray(e[0])&&Array.isArray(e[1]),()=>"A `Dot` layer should be called on a list of exactly 2 inputs.");let t=e[0].slice(),n=e[1].slice();if(t.length>3||n.length>3)throw new pl("Dot layer does not support tensors of 4D or higher rank yet.");let r=this.interpretAxes(t,n);t.splice(r[0],1),n.splice(r[1],1),n.splice(0,1);let i=t.concat(n);return 1===i.length&&i.push(1),i}computeMask(e,t){return null}getConfig(){let e={axes:this.axes,normalize:this.normalize};return Object.assign(e,super.getConfig()),e}}bt.className="Dot",al(bt);class bn extends f6{constructor(e){super(e),this.supportsMasking=!0,this.stddev=e.stddev}computeOutputShape(e){return e}getConfig(){let e=super.getConfig(),t={stddev:this.stddev};return Object.assign(t,e),t}call(e,t){return i2(()=>{this.invokeCallHook(e,t);let n=fq(e);return fb(()=>s4(fl(n.shape,0,this.stddev),n),()=>n,t.training||!1)})}}bn.className="GaussianNoise",al(bn);class br extends f6{constructor(e){super(e),this.supportsMasking=!0,this.rate=e.rate}computeOutputShape(e){return e}getConfig(){let e=super.getConfig(),t={rate:this.rate};return Object.assign(t,e),t}call(e,t){return i2(()=>{this.invokeCallHook(e,t);let n=fq(e);return this.rate>0&&this.rate<1?fb(()=>{let e=Math.sqrt(this.rate/(1-this.rate));return s8(n,fl(n.shape,1,e))},()=>n,t.training||!1):n})}}br.className="GaussianDropout",al(br);class bi extends f6{constructor(e){super(e),this.supportsMasking=!0,this.rate=e.rate,this.noiseShape=e.noiseShape}_getNoiseShape(e){return this.noiseShape||fq(e).shape}computeOutputShape(e){return e}getConfig(){let e=super.getConfig(),t={rate:this.rate};return Object.assign(t,e),t}call(e,t){return i2(()=>{if(this.rate<1&&this.rate>0){let n=this._getNoiseShape(e);return fb(()=>{let t=fq(e),r=-1.7580993408473766,i=o2(lC(n),this.rate);i=p8(i,"float32");let s=((1-this.rate)*(1+this.rate*r**2))**-.5,a=-s*r*this.rate,o=s4(s8(t,i),s8(s4(i,-1),r));return s4(s8(o,s),a)},()=>fq(e),t.training||!1)}return e})}}function bs(e,t,n,r,i,s=.001){let a;if(2===e.rank)a=oE(e,t,n,r,i,s);else if(3===e.rank)a=oC(e,t,n,r,i,s);else if(4===e.rank)a=oA(e,t,n,r,i,s);else throw new pl(`batchNormalization is not implemented for array of rank ${e.rank} yet`);return a}function ba(e,t,n,r,i=.001){return i2(()=>{let s=lg(e,r),a=s.mean,o=s.variance;return[bs(e,a,o,n,t,i),a,o]})}function bo(e,t,n,r,i=.001){return i2(()=>{let s=lg(e,r),a=s.mean,o=s.variance,l=[];for(let t of p4(0,e.rank))-1!==r.indexOf(t)?l.push(1):l.push(e.shape[t]);let u=ox(a,l),c=ox(o,l),h=null==t?null:ox(t,l);return[bs(e,u,c,null==n?null:ox(n,l),h,i),a,o]})}function bl(e,t,n,r,i=.001){return H(r.slice().sort(),p4(0,e.rank-1))?ba(e,t,n,r,i):bo(e,t,n,r,i)}bi.className="AlphaDropout",al(bi);class bu extends f6{constructor(e){null==e&&(e={}),super(e),this.supportsMasking=!0,this.axis=null==e.axis?-1:e.axis,this.momentum=null==e.momentum?.99:e.momentum,this.epsilon=null==e.epsilon?.001:e.epsilon,this.center=null==e.center||e.center,this.scale=null==e.scale||e.scale,this.betaInitializer=fj(e.betaInitializer||"zeros"),this.gammaInitializer=fj(e.gammaInitializer||"ones"),this.movingMeanInitializer=fj(e.movingMeanInitializer||"zeros"),this.movingVarianceInitializer=fj(e.movingVarianceInitializer||"ones"),this.betaConstraint=gx(e.betaConstraint),this.gammaConstraint=gx(e.gammaConstraint),this.betaRegularizer=yn(e.betaRegularizer),this.gammaRegularizer=yn(e.gammaRegularizer)}build(e){e=fH(e);let t=this.axis>=0?this.axis:this.axis+e.length,n=e[t];if(null==n)throw new po(`Axis ${t} of input tensor should have a defined dimension but the layer received an input with shape ${JSON.stringify(e)}.`);this.inputSpec=[new f0({ndim:e.length,axes:{[t]:n}})];let r=[n];this.scale&&(this.gamma=this.addWeight("gamma",r,null,this.gammaInitializer,this.gammaRegularizer,!0,this.gammaConstraint)),this.center&&(this.beta=this.addWeight("beta",r,null,this.betaInitializer,this.betaRegularizer,!0,this.betaConstraint)),this.movingMean=this.addWeight("moving_mean",r,null,this.movingMeanInitializer,null,!1),this.movingVariance=this.addWeight("moving_variance",r,null,this.movingVarianceInitializer,null,!1),this.built=!0}call(e,t){return i2(()=>{let n=null!=t.training&&t.training,r=fq(e),i=r.shape,s=i.length,a=p4(0,s),o=this.axis>=0?this.axis:this.axis+s;a.splice(o,1);let l=ph(1,s);l[o]=i[o];let u=a.slice();u.sort();let c=!H(u,p4(0,s).slice(0,s-1)),h=()=>{if(!c)return bs(r,this.movingMean.read(),this.movingVariance.read(),null==this.beta?null:this.beta.read(),null==this.gamma?null:this.gamma.read(),this.epsilon);{let e=ox(this.movingMean.read(),l);return bs(r,e,ox(this.movingVariance.read(),l),this.center?ox(this.beta.read(),l):null,this.scale?ox(this.gamma.read(),l):null,this.epsilon)}};if(!n)return h();let[d,p,f]=bl(r,this.gamma.read(),this.beta.read(),a,this.epsilon),g=(e,t,n)=>{i2(()=>{let r=1-n,i=e.read(),s=s8(af(i,t),r);e.write(af(i,s))})};return(()=>{g(this.movingMean,p,this.momentum),g(this.movingVariance,f,this.momentum)})(),d})}getConfig(){let e={axis:this.axis,momentum:this.momentum,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:fV(this.betaInitializer),gammaInitializer:fV(this.gammaInitializer),movingMeanInitializer:fV(this.movingMeanInitializer),movingVarianceInitializer:fV(this.movingVarianceInitializer),betaRegularizer:ye(this.betaRegularizer),gammaRegularizer:ye(this.gammaRegularizer),betaConstraint:gw(this.betaConstraint),gammaConstraint:gw(this.gammaConstraint)};return Object.assign(e,super.getConfig()),e}}bu.className="BatchNormalization",al(bu);class bc extends f6{constructor(e){if(null==e&&(e={}),super(e),this.axis=null==e.axis?-1:e.axis,"number"==typeof this.axis){if(!Number.isInteger(this.axis))throw Error(`Expected axis to be an integer, but received ${this.axis}`)}else if(Array.isArray(this.axis)){for(let e of this.axis)if(!Number.isInteger(e))throw Error(`Expected axis to be an array of integers, but received ${JSON.stringify(this.axis)}`)}else throw Error(`Expected axis to be an integer or an array of integers, but received ${JSON.stringify(this.axis)}`);this.epsilon=null==e.epsilon?.001:e.epsilon,this.center=null==e.center||e.center,this.scale=null==e.scale||e.scale,this.betaInitializer=fj(e.betaInitializer||"zeros"),this.gammaInitializer=fj(e.gammaInitializer||"ones"),this.betaRegularizer=yn(e.betaRegularizer),this.gammaRegularizer=yn(e.gammaRegularizer),this.supportsMasking=!0}build(e){let t=(e=fH(e)).length;"number"==typeof this.axis&&(this.axis=[this.axis]);for(let e=0;e<this.axis.length;++e)this.axis[e]<0&&(this.axis[e]+=t);for(let e of this.axis)if(e<0||e>=t)throw Error(`Invalid axis: ${e}`);if(this.axis.length!==pI(this.axis).length)throw Error(`Found duplicate axes in: ${this.axis}`);let n=this.axis.map(t=>e[t]),r=!0;this.scale?this.gamma=this.addWeight("gamma",n,"float32",this.gammaInitializer,this.gammaRegularizer,r):this.gamma=null,this.center?this.beta=this.addWeight("beta",n,"float32",this.betaInitializer,this.betaRegularizer,r):this.beta=null,this.built=!0}call(e,t){let n=fq(e),r=n.shape,i=r.length;return i2(()=>{let e=!0,{mean:t,variance:s}=lg(n,this.axis,e),a=ph(1,i);for(let e of this.axis)a[e]=r[e];let o=e=>null!=e&&e.shape.length!==i?ox(e,a):e,l=this.scale?o(this.gamma.read()):null,u=this.center?o(this.beta.read()):null,c=[],h=[];for(let e=0;e<i;++e)-1!==this.axis.indexOf(e)?(c.push(r[e]),h.push(1)):(c.push(1),h.push(r[e]));return t=oQ(t,c),s=oQ(s,c),null!=l&&(l=oQ(l,h)),null!=u&&(u=oQ(u,h)),bs(n,t,s,u,l,this.epsilon)})}getConfig(){let e={axis:this.axis,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:fV(this.betaInitializer),gammaInitializer:fV(this.gammaInitializer),betaRegularizer:ye(this.betaRegularizer),gammaRegularizer:ye(this.gammaRegularizer)};return Object.assign(e,super.getConfig()),e}}function bh(e,t,n){return i2(()=>{let r;if(4!==e.rank)throw new po(`temporalPadding expects input tensor to be 4-D, but received a ${e.rank}-D tensor.`);if(null==t&&(t=[[1,1],[1,1]]),2!==t.length||2!==t[0].length||2!==t[1].length)throw new po("spatial2dPadding expects `padding` to be an Array of two Arrays, each of which is an Array of two integers.");if(null==n&&(n=p5()),"channelsLast"!==n&&"channelsFirst"!==n)throw new po(`Unknown data format: ${n}. Supported data formats are 'channelsLast' and 'channelsFirst.`);return lx(e,r="channelsFirst"===n?[[0,0],[0,0],t[0],t[1]]:[[0,0],t[0],t[1],[0,0]])})}bc.className="LayerNormalization",al(bc);class bd extends f6{constructor(e){if(null==e&&(e={}),super(e),this.dataFormat=null==e.dataFormat?p5():e.dataFormat,null==e.padding)this.padding=[[1,1],[1,1]];else if("number"==typeof e.padding)this.padding=[[e.padding,e.padding],[e.padding,e.padding]];else{let t,n;if(e.padding=e.padding,2!==e.padding.length)throw new po(`ZeroPadding2D expects padding to be a length-2 array, but received a length-${e.padding.length} array.`);if("number"==typeof e.padding[0])t=[e.padding[0],e.padding[0]],n=[e.padding[1],e.padding[1]];else{if(e.padding=e.padding,2!==e.padding[0].length)throw new po(`ZeroPadding2D expects height padding to be a length-2 array, but received a length-${e.padding[0].length} array.`);if(t=e.padding[0],2!==e.padding[1].length)throw new po(`ZeroPadding2D expects width padding to be a length-2 array, but received a length-${e.padding[1].length} array.`);n=e.padding[1]}this.padding=[t,n]}this.inputSpec=[new f0({ndim:4})]}computeOutputShape(e){let t,n;return(e=fH(e),"channelsFirst"===this.dataFormat)?(t=null!=e[2]&&e[2]>=0?e[2]+this.padding[0][0]+this.padding[0][1]:null,n=null!=e[3]&&e[3]>=0?e[3]+this.padding[1][0]+this.padding[1][1]:null,[e[0],e[1],t,n]):(t=null!=e[1]&&e[1]>=0?e[1]+this.padding[0][0]+this.padding[0][1]:null,n=null!=e[2]&&e[2]>=0?e[2]+this.padding[1][0]+this.padding[1][1]:null,[e[0],t,n,e[3]])}call(e,t){return i2(()=>bh(fq(e),this.padding,this.dataFormat))}getConfig(){let e={padding:this.padding,dataFormat:this.dataFormat};return Object.assign(e,super.getConfig()),e}}function bp(e,t,n,r,i,s){return i2(()=>{let a;pV(i),pW(s),pG(r),null==n&&(n=[1,1]),null==r&&(r="valid"),null==i&&(i=p5()),null==s&&(s="max"),e=yd(e,i);let o="same"===r?"same":"valid";return a="max"===s?lc(e,t,n,o):oT(e,t,n,o),"channelsFirst"===i&&(a=l0(a,[0,3,1,2])),a})}function bf(e,t,n,r,i,s){return i2(()=>{let a;pV(i),pW(s),pG(r),null==n&&(n=[1,1,1]),null==r&&(r="valid"),null==i&&(i=p5()),null==s&&(s="max"),e=yp(e,i);let o="same"===r?"same":"valid";return a="max"===s?lh(e,t,n,o):oI(e,t,n,o),"channelsFirst"===i&&(a=l0(a,[0,4,1,2,3])),a})}bd.className="ZeroPadding2D",al(bd);class bg extends f6{constructor(e){if(null==e.poolSize&&(e.poolSize=2),super(e),"number"==typeof e.poolSize)this.poolSize=[e.poolSize];else if(Array.isArray(e.poolSize)&&1===e.poolSize.length&&"number"==typeof e.poolSize[0])this.poolSize=e.poolSize;else throw new po(`poolSize for 1D convolutional layer must be a number or an Array of a single number, but received ${JSON.stringify(e.poolSize)}`);if(pC(this.poolSize,"poolSize"),null==e.strides)this.strides=this.poolSize;else if("number"==typeof e.strides)this.strides=[e.strides];else if(Array.isArray(e.strides)&&1===e.strides.length&&"number"==typeof e.strides[0])this.strides=e.strides;else throw new po(`strides for 1D convolutional layer must be a number or an Array of a single number, but received ${JSON.stringify(e.strides)}`);pC(this.strides,"strides"),this.padding=null==e.padding?"valid":e.padding,pG(this.padding),this.inputSpec=[new f0({ndim:3})]}computeOutputShape(e){let t=yc((e=fH(e))[1],this.poolSize[0],this.padding,this.strides[0]);return[e[0],t,e[2]]}call(e,t){return i2(()=>(this.invokeCallHook(e,t),e=p7(fq(e),2),lj(this.poolingFunction(fq(e),[this.poolSize[0],1],[this.strides[0],1],this.padding,"channelsLast"),[2])))}getConfig(){let e={poolSize:this.poolSize,padding:this.padding,strides:this.strides};return Object.assign(e,super.getConfig()),e}}class bm extends bg{constructor(e){super(e)}poolingFunction(e,t,n,r,i){return pV(i),pG(r),bp(e,t,n,r,i,"max")}}bm.className="MaxPooling1D",al(bm);class by extends bg{constructor(e){super(e)}poolingFunction(e,t,n,r,i){return pV(i),pG(r),bp(e,t,n,r,i,"avg")}}by.className="AveragePooling1D",al(by);class bb extends f6{constructor(e){if(null==e.poolSize&&(e.poolSize=[2,2]),super(e),this.poolSize=Array.isArray(e.poolSize)?e.poolSize:[e.poolSize,e.poolSize],null==e.strides)this.strides=this.poolSize;else if(Array.isArray(e.strides)){if(2!==e.strides.length)throw new po(`If the strides property of a 2D pooling layer is an Array, it is expected to have a length of 2, but received length ${e.strides.length}.`);this.strides=e.strides}else this.strides=[e.strides,e.strides];pC(this.poolSize,"poolSize"),pC(this.strides,"strides"),this.padding=null==e.padding?"valid":e.padding,this.dataFormat=null==e.dataFormat?"channelsLast":e.dataFormat,pV(this.dataFormat),pG(this.padding),this.inputSpec=[new f0({ndim:4})]}computeOutputShape(e){e=fH(e);let t="channelsFirst"===this.dataFormat?e[2]:e[1],n="channelsFirst"===this.dataFormat?e[3]:e[2];return(t=yc(t,this.poolSize[0],this.padding,this.strides[0]),n=yc(n,this.poolSize[1],this.padding,this.strides[1]),"channelsFirst"===this.dataFormat)?[e[0],e[1],t,n]:[e[0],t,n,e[3]]}call(e,t){return i2(()=>(this.invokeCallHook(e,t),this.poolingFunction(fq(e),this.poolSize,this.strides,this.padding,this.dataFormat)))}getConfig(){let e={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat};return Object.assign(e,super.getConfig()),e}}class bv extends bb{constructor(e){super(e)}poolingFunction(e,t,n,r,i){return pV(i),pG(r),bp(e,t,n,r,i,"max")}}bv.className="MaxPooling2D",al(bv);class bw extends bb{constructor(e){super(e)}poolingFunction(e,t,n,r,i){return pV(i),pG(r),bp(e,t,n,r,i,"avg")}}bw.className="AveragePooling2D",al(bw);class b_ extends f6{constructor(e){if(null==e.poolSize&&(e.poolSize=[2,2,2]),super(e),this.poolSize=Array.isArray(e.poolSize)?e.poolSize:[e.poolSize,e.poolSize,e.poolSize],null==e.strides)this.strides=this.poolSize;else if(Array.isArray(e.strides)){if(3!==e.strides.length)throw new po(`If the strides property of a 3D pooling layer is an Array, it is expected to have a length of 3, but received length ${e.strides.length}.`);this.strides=e.strides}else this.strides=[e.strides,e.strides,e.strides];pC(this.poolSize,"poolSize"),pC(this.strides,"strides"),this.padding=null==e.padding?"valid":e.padding,this.dataFormat=null==e.dataFormat?"channelsLast":e.dataFormat,pV(this.dataFormat),pG(this.padding),this.inputSpec=[new f0({ndim:5})]}computeOutputShape(e){e=fH(e);let t="channelsFirst"===this.dataFormat?e[2]:e[1],n="channelsFirst"===this.dataFormat?e[3]:e[2],r="channelsFirst"===this.dataFormat?e[4]:e[3];return(t=yc(t,this.poolSize[0],this.padding,this.strides[0]),n=yc(n,this.poolSize[1],this.padding,this.strides[1]),r=yc(r,this.poolSize[2],this.padding,this.strides[2]),"channelsFirst"===this.dataFormat)?[e[0],e[1],t,n,r]:[e[0],t,n,r,e[4]]}call(e,t){return i2(()=>(this.invokeCallHook(e,t),this.poolingFunction(fq(e),this.poolSize,this.strides,this.padding,this.dataFormat)))}getConfig(){let e={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat};return Object.assign(e,super.getConfig()),e}}class bx extends b_{constructor(e){super(e)}poolingFunction(e,t,n,r,i){return pV(i),pG(r),bf(e,t,n,r,i,"max")}}bx.className="MaxPooling3D",al(bx);class bT extends b_{constructor(e){super(e)}poolingFunction(e,t,n,r,i){return pV(i),pG(r),bf(e,t,n,r,i,"avg")}}bT.className="AveragePooling3D",al(bT);class bI extends f6{constructor(e){super(e),this.inputSpec=[new f0({ndim:3})]}computeOutputShape(e){return[e[0],e[2]]}call(e,t){throw new pl}}class bk extends bI{constructor(e){super(e||{})}call(e,t){return i2(()=>ld(fq(e),1))}}bk.className="GlobalAveragePooling1D",al(bk);class bS extends bI{constructor(e){super(e||{})}call(e,t){return i2(()=>o5(fq(e),1))}}bS.className="GlobalMaxPooling1D",al(bS);class bE extends f6{constructor(e){super(e),this.dataFormat=null==e.dataFormat?"channelsLast":e.dataFormat,pV(this.dataFormat),this.inputSpec=[new f0({ndim:4})]}computeOutputShape(e){return"channelsLast"===this.dataFormat?[e[0],e[3]]:[e[0],e[1]]}call(e,t){throw new pl}getConfig(){let e={dataFormat:this.dataFormat};return Object.assign(e,super.getConfig()),e}}class bC extends bE{call(e,t){return i2(()=>{let t=fq(e);return"channelsLast"===this.dataFormat?ld(t,[1,2]):ld(t,[2,3])})}}bC.className="GlobalAveragePooling2D",al(bC);class bA extends bE{call(e,t){return i2(()=>{let t=fq(e);return"channelsLast"===this.dataFormat?o5(t,[1,2]):o5(t,[2,3])})}}bA.className="GlobalMaxPooling2D",al(bA);class bN extends f6{constructor(e){super(e),this.layer=e.layer}build(e){this.built=!0}get trainable(){return null!=this.layer&&this.layer.trainable}set trainable(e){null!=this.layer&&(this.layer.trainable=e)}get trainableWeights(){return this.layer.trainableWeights}get nonTrainableWeights(){return this.layer.nonTrainableWeights}get updates(){return this.layer._updates}get losses(){return this.layer.losses}getWeights(){return this.layer.getWeights()}setWeights(e){this.layer.setWeights(e)}getConfig(){let e={layer:{className:this.layer.getClassName(),config:this.layer.getConfig()}};return Object.assign(e,super.getConfig()),e}setFastWeightInitDuringBuild(e){super.setFastWeightInitDuringBuild(e),null!=this.layer&&this.layer.setFastWeightInitDuringBuild(e)}static fromConfig(e,t,n={}){let r=gD(t.layer,n);delete t.layer;let i={layer:r};return Object.assign(i,t),new e(i)}}class bO extends bN{constructor(e){super(e),this.supportsMasking=!0}build(e){if((e=fH(e)).length<3)throw new po(`TimeDistributed layer expects an input shape >= 3D, but received input shape ${JSON.stringify(e)}`);this.inputSpec=[{shape:e}];let t=[e[0]].concat(e.slice(2));this.layer.built||(this.layer.build(t),this.layer.built=!0),super.build(e)}computeOutputShape(e){let t=[(e=fH(e))[0]].concat(e.slice(2)),n=this.layer.computeOutputShape(t),r=e[1];return[n[0],r].concat(n.slice(1))}call(e,t){return i2(()=>yO((e,n)=>[fq(this.layer.call(e,t)),[]],e=fq(e),[],!1,null,null,!1,!0)[1])}}function b$(e){pS(pB,"BidirectionalMergeMode",e)}bO.className="TimeDistributed",al(bO);let bR="concat";class bD extends bN{constructor(e){super(e);let t=e.layer.getConfig(),n={};n.className=e.layer.getClassName(),n.config=t,this.forwardLayer=gD(n),t.goBackwards=!0!==t.goBackwards;let r={};if(r.className=e.layer.getClassName(),r.config=t,this.backwardLayer=gD(r),this.forwardLayer.name="forward_"+this.forwardLayer.name,this.backwardLayer.name="backward_"+this.backwardLayer.name,this.mergeMode=void 0===e.mergeMode?bR:e.mergeMode,b$(this.mergeMode),e.weights)throw new pl("weights support is not implemented for Bidirectional layer yet.");this._stateful=e.layer.stateful,this.returnSequences=e.layer.returnSequences,this.returnState=e.layer.returnState,this.supportsMasking=!0,this._trainable=!0,this.inputSpec=e.layer.inputSpec,this.numConstants=null}get trainable(){return this._trainable}set trainable(e){this._trainable=e,null!=this.forwardLayer&&(this.forwardLayer.trainable=e),null!=this.backwardLayer&&(this.backwardLayer.trainable=e)}getWeights(){return this.forwardLayer.getWeights().concat(this.backwardLayer.getWeights())}setWeights(e){let t=Math.floor(e.length/2);this.forwardLayer.setWeights(e.slice(0,t)),this.backwardLayer.setWeights(e.slice(t))}computeOutputShape(e){let t,n,r,i=this.forwardLayer.computeOutputShape(e);return(Array.isArray(i)&&Array.isArray(i[0])||(i=[i]),this.returnState&&(r=i.slice(1)),t=i[0],"concat"===this.mergeMode?(t[t.length-1]*=2,n=[t]):n=null==this.mergeMode?[t,t.slice()]:[t],this.returnState)?null==this.mergeMode?n.concat(r).concat(r.slice()):[t].concat(r).concat(r.slice()):pf(n)}apply(e,t){let n=null==t?null:t.initialState,r=null==t?null:t.constants;null==t&&(t={});let i=yN(e,n,r,this.numConstants);if(e=i.inputs,n=i.initialState,r=i.constants,Array.isArray(e)&&(n=e.slice(1),e=e[0]),(null==n||0===n.length)&&null==r)return super.apply(e,t);let s=[],a=[];if(null!=n){let e=n.length;if(e%2>0)throw new po("When passing `initialState` to a Bidrectional RNN, the state should be an Array containing the states of the underlying RNNs.");t.initialState=n,s.push(...n);let r=n.map(e=>new f0({shape:e.shape}));this.forwardLayer.stateSpec=r.slice(0,e/2),this.backwardLayer.stateSpec=r.slice(e/2),a.push(...r)}if(null!=r)throw new pl("Support for constants in Bidirectional layers is not implemented yet.");let o=s[0]instanceof f1;for(let e of s)if(e instanceof f1!==o)throw new po("The initial state of a Bidirectional layer cannot be specified as a mix of symbolic and non-symbolic tensors");if(!o)return super.apply(e,t);{let n=[e].concat(s),r=this.inputSpec.concat(a),i=this.inputSpec;this.inputSpec=r;let o=super.apply(n,t);return this.inputSpec=i,o}}call(e,t){return i2(()=>{let n,r,i,s;let a=t.initialState;if(null==a)n=this.forwardLayer.call(e,t),r=this.backwardLayer.call(e,t);else{let i=a.slice(0,a.length/2),s=a.slice(a.length/2);n=this.forwardLayer.call(e,Object.assign(t,{initialState:i})),r=this.backwardLayer.call(e,Object.assign(t,{initialState:s}))}return(this.returnState&&(Array.isArray(n)&&(i=n.slice(1).concat(r.slice(1))),n=n[0],r=r[0]),this.returnSequences&&(r=lO(r,1)),"concat"===this.mergeMode?s=fs([n,r]):"sum"===this.mergeMode?s=s4(n,r):"ave"===this.mergeMode?s=s8(.5,s4(n,r)):"mul"===this.mergeMode?s=s8(n,r):null==this.mergeMode&&(s=[n,r]),this.returnState)?null==this.mergeMode?s.concat(i):[s].concat(i):s})}resetStates(e){this.forwardLayer.resetStates(),this.backwardLayer.resetStates()}build(e){pK(this.forwardLayer.name,()=>{this.forwardLayer.build(e)}),pK(this.backwardLayer.name,()=>{this.backwardLayer.build(e)}),this.built=!0}computeMask(e,t){let n;if(Array.isArray(t)&&(t=t[0]),n=this.returnSequences?null==this.mergeMode?[t,t]:t:null==this.mergeMode?[null,null]:null,!this.returnState)return n;{let e=this.forwardLayer.states.map(e=>null);return Array.isArray(n)?n.concat(e).concat(e):[n].concat(e).concat(e)}}get trainableWeights(){return this.forwardLayer.trainableWeights.concat(this.backwardLayer.trainableWeights)}get nonTrainableWeights(){return this.forwardLayer.nonTrainableWeights.concat(this.backwardLayer.nonTrainableWeights)}setFastWeightInitDuringBuild(e){super.setFastWeightInitDuringBuild(e),null!=this.forwardLayer&&this.forwardLayer.setFastWeightInitDuringBuild(e),null!=this.backwardLayer&&this.backwardLayer.setFastWeightInitDuringBuild(e)}getConfig(){let e={mergeMode:this.mergeMode};return Object.assign(e,super.getConfig()),e}static fromConfig(e,t){let n=gD(t.layer);if(delete t.layer,null!=t.numConstants)throw new pl("Deserialization of a Bidirectional layer with numConstants present is not supported yet.");let r=t;return r.layer=n,new e(r)}}bD.className="Bidirectional",al(bD);class bF extends f6{constructor(e){super(e),this.scale=e.scale,e.offset?this.offset=e.offset:this.offset=0}getConfig(){let e={scale:this.scale,offset:this.offset};return Object.assign(e,super.getConfig()),e}call(e,t){return i2(()=>("float32"!==(e=fq(e)).dtype&&(e=p8(e,"float32")),s4(s8(e,this.scale),this.offset)))}}bF.className="Rescaling",al(bF);let{resizeBilinear:bP,cropAndResize:bM}=uq;class bL extends f6{constructor(e){super(e),this.height=e.height,this.width=e.width}centerCrop(e,t,n,r,i,s,a,o){return i2(()=>{let l;let u=!1,c=[t/s,n/a,(r+t)/s,(i+n)/a],h=[];3===e.rank?(u=!0,l=lG([e])):l=e;for(let e=0;e<l.shape[0];e++)h.push(c);let d=bM(l,iY(h,[h.length,4]),lA(0,h.length,1,"int32"),[r,i],"nearest");return u?p8(fq(lX(d)),o):p8(d,o)})}upsize(e,t,n,r){return i2(()=>p8(bP(e,[t,n]),r))}call(e,t){return i2(()=>{let t=fq(e),n=t.dtype,r=t.shape,i=r[r.length-3],s=r[r.length-2],a=0;i!==this.height&&(a=Math.floor((i-this.height)/2));let o=0;return(s!==this.width&&0===(o=Math.floor((s-this.width)/2))&&(o=1),a>=0&&o>=0)?this.centerCrop(t,a,o,this.height,this.width,i,s,n):this.upsize(e,this.height,this.width,n)})}getConfig(){let e={height:this.height,width:this.width};return Object.assign(e,super.getConfig()),e}computeOutputShape(e){let t=(e=fH(e)).length-3,n=e.length-2;return e[t]=this.height,e[n]=this.width,e}}function bz(e,t,n,r){let i,s=fq(e);if("int32"!==s.dtype&&(s=p8(s,"int32")),"int"===t)return s;let a=s.shape;if(0===s.rank&&(s=oY(s,-1)),"oneHot"===t&&1!==s.shape[s.shape.length-1]&&(s=oY(s,-1)),s.rank>2)throw new po(`When outputMode is not int, maximum output rank is 2 Received outputMode ${t} and input shape ${a} which would result in output rank ${s.rank}.`);let o=["multiHot","oneHot"].includes(t),l=s;if(i=void 0!==r&&"count"===t?oG(l,r,n,o):oG(l,[],n,o),"tfIdf"!==t)return i;if(r)return s8(i,r);throw new po("When outputMode is 'tfIdf', weights must be provided.")}bL.className="CenterCrop",al(bL);class bB extends f6{constructor(e){super(e),this.numTokens=e.numTokens,e.outputMode?this.outputMode=e.outputMode:this.outputMode="multiHot"}getConfig(){let e={numTokens:this.numTokens,outputMode:this.outputMode};return Object.assign(e,super.getConfig()),e}computeOutputShape(e){return null==(e=fH(e))?[this.numTokens]:("oneHot"===this.outputMode&&1!==e[e.length-1]?e.push(this.numTokens):e[e.length-1]=this.numTokens,e)}call(e,t){return i2(()=>{let n;if("int32"!==(e=fq(e)).dtype&&(e=p8(e,"int32")),void 0!==t.countWeights){if("count"!==this.outputMode)throw new po(`countWeights is not used when outputMode !== count.
              Received countWeights=${t.countWeights}`);n=fq(t.countWeights)}let r=o5(e),i=lp(e),s=o1(this.numTokens,r).bufferSync().get(0),a=o2(i,0).bufferSync().get(0);if(!(s&&a))throw new po(`Input values must be between 0 < values <= numTokens with numTokens=${this.numTokens}`);return bz(e,this.outputMode,this.numTokens,n)})}}bB.className="CategoryEncoding",al(bB);let bU=new Set(["bilinear","nearest"]);class bV extends f6{constructor(e){if(super(e),this.height=e.height,this.width=e.width,e.interpolation){if(bU.has(e.interpolation))this.interpolation=e.interpolation;else throw new po(`Invalid interpolation parameter: ${e.interpolation} is not implemented`)}else this.interpolation="bilinear";this.cropToAspectRatio=!!e.cropToAspectRatio}computeOutputShape(e){let t=(e=fH(e))[2];return[this.height,this.width,t]}getConfig(){let e={height:this.height,width:this.width,interpolation:this.interpolation,cropToAspectRatio:this.cropToAspectRatio};return Object.assign(e,super.getConfig()),e}call(e,t){return i2(()=>{let t=[this.height,this.width];if("bilinear"===this.interpolation)return uq.resizeBilinear(e,t,!this.cropToAspectRatio);if("nearest"===this.interpolation)return uq.resizeNearestNeighbor(e,t,!this.cropToAspectRatio);throw Error(`Interpolation is ${this.interpolation} but only ${[...bU]} are supported`)})}}bV.className="Resizing",al(bV);class bj{constructor(e){this.seed=e}next(){if(void 0!==this.seed)return this.seed++}}bj.className="RandomSeed";class bG extends f6{constructor(e){super(e),this.randomGenerator=new bj(e.seed)}getConfig(){let e={seed:this.randomGenerator.seed};return Object.assign(e,super.getConfig()),e}}bG.className="BaseRandomLayer";let bW=new Set(["bilinear","nearest"]);class bq extends bG{constructor(e){super(e);let{factor:t,interpolation:n="bilinear"}=e;if(this.factor=t,Array.isArray(this.factor)&&2===this.factor.length)this.widthLower=this.factor[0],this.widthUpper=this.factor[1];else if(!Array.isArray(this.factor)&&this.factor>0)this.widthLower=-this.factor,this.widthUpper=this.factor;else throw new po(`Invalid factor: ${this.factor}. Must be positive number or tuple of 2 numbers`);if(this.widthLower<-1||this.widthUpper<-1)throw new po(`factor must have values larger than -1. Got: ${this.factor}`);if(this.widthUpper<this.widthLower)throw new po(`factor cannot have upper bound less than lower bound.
        Got upper bound: ${this.widthUpper}.
        Got lower bound: ${this.widthLower}
      `);if(n){if(bW.has(n))this.interpolation=n;else throw new po(`Invalid interpolation parameter: ${n} is not implemented`)}}getConfig(){let e={factor:this.factor,interpolation:this.interpolation};return Object.assign(e,super.getConfig()),e}computeOutputShape(e){let t=(e=fH(e))[2];return[this.imgHeight,-1,t]}call(e,t){return i2(()=>{let t=fq(e);this.imgHeight=t.shape[t.shape.length-3];let n=t.shape[t.shape.length-2];this.widthFactor=lC([1],1+this.widthLower,1+this.widthUpper,"float32",this.randomGenerator.next());let r=this.widthFactor.dataSync()[0]*n;r=Math.round(r);let i=[this.imgHeight,r];switch(this.interpolation){case"bilinear":return uq.resizeBilinear(e,i);case"nearest":return uq.resizeNearestNeighbor(e,i);default:throw Error(`Interpolation is ${this.interpolation}
          but only ${[...bW]} are supported`)}})}}bq.className="RandomWidth",al(bq);eN().registerFlag("KEEP_INTERMEDIATE_TENSORS",()=>!1,e=>{e&&console.warn("Keep intermediate tensors is ON. This will print the values of all intermediate tensors during model inference. Not all models support this mode. For details, check e2e/benchmarks/ model_config.js. This significantly impacts performance.")}),function(e){e[e.DT_INVALID=0]="DT_INVALID",e[e.DT_FLOAT=1]="DT_FLOAT",e[e.DT_DOUBLE=2]="DT_DOUBLE",e[e.DT_INT32=3]="DT_INT32",e[e.DT_UINT8=4]="DT_UINT8",e[e.DT_INT16=5]="DT_INT16",e[e.DT_INT8=6]="DT_INT8",e[e.DT_STRING=7]="DT_STRING",e[e.DT_COMPLEX64=8]="DT_COMPLEX64",e[e.DT_INT64=9]="DT_INT64",e[e.DT_BOOL=10]="DT_BOOL",e[e.DT_QINT8=11]="DT_QINT8",e[e.DT_QUINT8=12]="DT_QUINT8",e[e.DT_QINT32=13]="DT_QINT32",e[e.DT_BFLOAT16=14]="DT_BFLOAT16",e[e.DT_QINT16=15]="DT_QINT16",e[e.DT_QUINT16=16]="DT_QUINT16",e[e.DT_UINT16=17]="DT_UINT16",e[e.DT_COMPLEX128=18]="DT_COMPLEX128",e[e.DT_HALF=19]="DT_HALF",e[e.DT_RESOURCE=20]="DT_RESOURCE",e[e.DT_VARIANT=21]="DT_VARIANT",e[e.DT_UINT32=22]="DT_UINT32",e[e.DT_UINT64=23]="DT_UINT64",e[e.DT_FLOAT_REF=101]="DT_FLOAT_REF",e[e.DT_DOUBLE_REF=102]="DT_DOUBLE_REF",e[e.DT_INT32_REF=103]="DT_INT32_REF",e[e.DT_UINT8_REF=104]="DT_UINT8_REF",e[e.DT_INT16_REF=105]="DT_INT16_REF",e[e.DT_INT8_REF=106]="DT_INT8_REF",e[e.DT_STRING_REF=107]="DT_STRING_REF",e[e.DT_COMPLEX64_REF=108]="DT_COMPLEX64_REF",e[e.DT_INT64_REF=109]="DT_INT64_REF",e[e.DT_BOOL_REF=110]="DT_BOOL_REF",e[e.DT_QINT8_REF=111]="DT_QINT8_REF",e[e.DT_QUINT8_REF=112]="DT_QUINT8_REF",e[e.DT_QINT32_REF=113]="DT_QINT32_REF",e[e.DT_BFLOAT16_REF=114]="DT_BFLOAT16_REF",e[e.DT_QINT16_REF=115]="DT_QINT16_REF",e[e.DT_QUINT16_REF=116]="DT_QUINT16_REF",e[e.DT_UINT16_REF=117]="DT_UINT16_REF",e[e.DT_COMPLEX128_REF=118]="DT_COMPLEX128_REF",e[e.DT_HALF_REF=119]="DT_HALF_REF",e[e.DT_RESOURCE_REF=120]="DT_RESOURCE_REF",e[e.DT_VARIANT_REF=121]="DT_VARIANT_REF",e[e.DT_UINT32_REF=122]="DT_UINT32_REF",e[e.DT_UINT64_REF=123]="DT_UINT64_REF"}(x||(x={})),function(e){let t;!function(e){e[e.LEGACY=0]="LEGACY",e[e.V1=1]="V1",e[e.V2=2]="V2"}(t=e.CheckpointFormatVersion||(e.CheckpointFormatVersion={}))}(T||(T={}));function bH(e,t){return t?`${e}-${t}`:e}function bK(e,t){let n;if(""===e)return["",0,void 0];let r=null!=t&&null!=t.parseNodeNameCache;if(r){let n=t.parseNodeNameCache.get(e);if(null!=n)return n}let i=e.split(":");if(1===i.length)n=[e,0,void 0];else{let e=i[0],t=3===i.length?i[1]:void 0;n=[e,Number(i[i.length-1]),t]}return r&&t.parseNodeNameCache.set(e,n),n}var bX=n(8287).hp;class bY{get id(){return this.idTensor.id}constructor(e,t,n,r=-1){this.tensors=e,this.elementShape=t,this.elementDtype=n,null!=e&&e.forEach(e=>{if(n!==e.dtype)throw Error(`Invalid data types; op elements ${n}, but list elements ${e.dtype}`);assertShapesMatchAllowUndefinedSize(t,e.shape,"TensorList shape mismatch: "),keep(e)}),this.idTensor=scalar(0),this.maxNumElements=r,keep(this.idTensor)}copy(){return new bY([...this.tensors],this.elementShape,this.elementDtype)}clearAndClose(e){this.tensors.forEach(t=>{null!=e&&e.has(t.id)||t.dispose()}),this.tensors.length=0,this.idTensor.dispose()}size(){return this.tensors.length}stack(e,t,n=-1){if(t!==this.elementDtype)throw Error(`Invalid data types; op elements ${t}, but list elements ${this.elementDtype}`);if(-1!==n&&this.tensors.length!==n)throw Error(`Operation expected a list with ${n} elements but got a list with ${this.tensors.length} elements.`);assertShapesMatchAllowUndefinedSize(e,this.elementShape,"TensorList shape mismatch: ");let r=inferElementShape(this.elementShape,this.tensors,e);return tidy(()=>stack(this.tensors.map(e=>reshape(e,r)),0))}popBack(e,t){if(t!==this.elementDtype)throw Error(`Invalid data types; op elements ${t}, but list elements ${this.elementDtype}`);if(0===this.size())throw Error("Trying to pop from an empty list.");let n=inferElementShape(this.elementShape,this.tensors,e),r=this.tensors.pop();return r.kept=!1,assertShapesMatchAllowUndefinedSize(r.shape,e,"TensorList shape mismatch: "),reshape(r,n)}pushBack(e){if(e.dtype!==this.elementDtype)throw Error(`Invalid data types; op elements ${e.dtype}, but list elements ${this.elementDtype}`);if(assertShapesMatchAllowUndefinedSize(e.shape,this.elementShape,"TensorList shape mismatch: "),this.maxNumElements===this.size())throw Error("Trying to push element into a full list.");keep(e),this.tensors.push(e)}resize(e){if(e<0)throw Error(`TensorListResize expects size to be non-negative. Got: ${e}`);if(-1!==this.maxNumElements&&e>this.maxNumElements)throw Error(`TensorListResize input size ${e} is greater maxNumElement ${this.maxNumElements}.`);let t=new bY([],this.elementShape,this.elementDtype,this.maxNumElements);t.tensors.length=e;for(let n=0;n<Math.min(this.tensors.length,e);++n)t.tensors[n]=this.tensors[n];return t}getItem(e,t,n){if(n!==this.elementDtype)throw Error(`Invalid data types; op elements ${n}, but list elements ${this.elementDtype}`);if(e<0||e>this.tensors.length)throw Error(`Trying to access element ${e} in a list with ${this.tensors.length} elements.`);if(null==this.tensors[e])throw Error(`element at index ${e} is null.`);assertShapesMatchAllowUndefinedSize(this.tensors[e].shape,t,"TensorList shape mismatch: ");let r=inferElementShape(this.elementShape,this.tensors,t);return reshape(this.tensors[e],r)}setItem(e,t){if(t.dtype!==this.elementDtype)throw Error(`Invalid data types; op elements ${t.dtype}, but list elements ${this.elementDtype}`);if(e<0||-1!==this.maxNumElements&&e>=this.maxNumElements)throw Error(`Trying to set element ${e} in a list with max ${this.maxNumElements} elements.`);assertShapesMatchAllowUndefinedSize(this.elementShape,t.shape,"TensorList shape mismatch: "),keep(t),null!=this.tensors[e]&&(this.tensors[e].kept=!1),this.tensors[e]=t}gather(e,t,n){if(t!==this.elementDtype)throw Error(`Invalid data types; op elements ${t}, but list elements ${this.elementDtype}`);assertShapesMatchAllowUndefinedSize(this.elementShape,n,"TensorList shape mismatch: "),e=e.slice(0,this.size());let r=inferElementShape(this.elementShape,this.tensors,n);return 0===e.length?tensor([],[0].concat(r)):tidy(()=>stack(e.map(e=>reshape(this.tensors[e],r)),0))}concat(e,t){if(e&&e!==this.elementDtype)throw Error(`TensorList dtype is ${this.elementDtype} but concat requested dtype ${e}`);assertShapesMatchAllowUndefinedSize(this.elementShape,t,"TensorList shape mismatch: ");let n=inferElementShape(this.elementShape,this.tensors,t);return 0===this.size()?tensor([],[0].concat(n)):tidy(()=>concat(this.tensors.map(e=>reshape(e,n)),0))}}function bQ(e,t){return bJ(e,t)}function bJ(e,t,n=new Map,r=new Set){if(null==e)return null;if("function"==typeof Blob&&e instanceof Blob)return e.slice();if(r.has(e))throw Error("Circular references are not supported.");if(n.has(e))return n.get(e);let i=t(e);if(i.recurse&&null!==i.value)throw Error("A deep map function may not return both a value and recurse=true.");if(!i.recurse)return n.set(e,i.value),i.value;if(b2(e)){let i=Array.isArray(e)?[]:{};for(let s in r.add(e),e){let a=bJ(e[s],t,n,r);i[s]=a}return r.delete(e),e.__proto__&&(i.__proto__=e.__proto__),i}throw Error(`Can't recurse into non-iterable type: ${e}`)}function bZ(e,t=b1){return b0(e,t)}function b0(e,t,n=new Set){let r=e[0];if(n.has(r))throw Error("Circular references are not supported.");let i=t(e);if(i.recurse&&null!==i.value)throw Error("A deep zip function may not return both a value and recurse=true.");if(!i.recurse)return i.value;if(b2(r)){let i=Array.isArray(r)?[]:{};for(let s in n.add(r),r){let r=b0(e.map(e=>e[s]),t,n);i[s]=r}return n.delete(r),i}throw Error(`Can't recurse into non-iterable type: ${r}`)}function b1(e){return null===e?null:b2(e[0])?{value:null,recurse:!0}:{value:e,recurse:!1}}function b2(e){let t=!1;if(eN().get("IS_BROWSER"))t=e instanceof TextDecoder;else{let{StringDecoder:r}=n(4222);t=e instanceof r}return null!=e&&!ArrayBuffer.isView(e)&&(Array.isArray(e)||"object"==typeof e&&!(e instanceof im)&&!(e instanceof Promise)&&!t)}function b3(e){return null==e||b4(e)||Array.isArray(e)||"object"==typeof e&&e instanceof im||r1(e)}function b4(e){return null===e||"object"!=typeof e&&"function"!=typeof e}function b6(e){return bQ(e,b5)}function b5(e){return e instanceof im?{value:e.clone(),recurse:!1}:b2(e)?{value:null,recurse:!0}:{value:e,recurse:!1}}class b8{constructor(e){if(this.capacity=e,this.begin=0,this.end=0,null==e)throw RangeError("Can't create a ring buffer of unknown capacity.");if(e<1)throw RangeError("Can't create ring buffer of capacity < 1.");this.data=Array(e),this.doubledCapacity=2*e}wrap(e){for(;e<0;)e+=this.doubledCapacity;return e%this.doubledCapacity}get(e){if(e<0)throw RangeError("Can't get item at a negative index.");return this.data[e%this.capacity]}set(e,t){if(e<0)throw RangeError("Can't set item at a negative index.");this.data[e%this.capacity]=t}length(){let e=this.end-this.begin;return e<0&&(e=this.doubledCapacity+e),e}isFull(){return this.length()===this.capacity}isEmpty(){return 0===this.length()}push(e){if(this.isFull())throw RangeError("Ring buffer is full.");this.set(this.end,e),this.end=this.wrap(this.end+1)}pushAll(e){for(let t of e)this.push(t)}pop(){if(this.isEmpty())throw RangeError("Ring buffer is empty.");this.end=this.wrap(this.end-1);let e=this.get(this.end);return this.set(this.end,void 0),e}unshift(e){if(this.isFull())throw RangeError("Ring buffer is full.");this.begin=this.wrap(this.begin-1),this.set(this.begin,e)}shift(){if(this.isEmpty())throw RangeError("Ring buffer is empty.");let e=this.get(this.begin);return this.set(this.begin,void 0),this.begin=this.wrap(this.begin+1),e}shuffleExcise(e){if(this.isEmpty())throw RangeError("Ring buffer is empty.");let t=this.wrap(this.begin+e),n=this.get(t);return this.set(t,this.pop()),n}}class b7 extends b8{constructor(){super(b7.INITIAL_CAPACITY)}isFull(){return!1}push(e){super.isFull()&&this.expand(),super.push(e)}unshift(e){super.isFull()&&this.expand(),super.unshift(e)}expand(){let e=2*this.capacity,t=Array(e),n=this.length();for(let e=0;e<n;e++)t[e]=this.get(this.wrap(this.begin+e));this.data=t,this.capacity=e,this.doubledCapacity=2*this.capacity,this.begin=0,this.end=n}}function b9(e){return new vr(e)}function ve(e){return new vi(e)}function vt(e,t){return new vg(e,t)}b7.INITIAL_CAPACITY=32;class vn{async toArray(){let e=[],t=await this.next();for(;!t.done;)e.push(t.value),t=await this.next();return e}async toArrayForTest(){let e=this.prefetch(100),t=[],n=await e.next();for(;!n.done;)t.push(n.value),n=await e.next();return t}async resolveFully(){let e=await this.next();for(;!e.done;)e=await this.next()}async resolveWhile(e){let t=await this.next(),n=e(t.value);for(;!t.done&&n;)n=e((t=await this.next()).value)}handleErrors(e){return new vh(this,e)}filter(e){return new vu(this,e)}map(e){return new vc(this,e)}mapAsync(e){return new vd(this,e)}serialMapAsync(e){return new vd(this,e).serial()}flatmap(e){return new vf(this,e)}async forEachAsync(e){return this.map(e).resolveFully()}async serialForEach(e){return this.serialMapAsync(e).resolveWhile(e=>!0===e)}rowMajorBatch(e,t=!0){return new vl(this,e,t)}columnMajorBatch(e,t=!0,n=b1){return this.rowMajorBatch(e,t).map(e=>bZ(e,n))}concatenate(e,t){return new vg(b9([this,e]),t)}take(e){return e<0||null==e?this:new vo(this,e)}skip(e){return e<0||null==e?this:new va(this,e)}prefetch(e){return new vm(this,e)}shuffle(e,t){return new vy(this,e,t)}serial(){return new vs(this)}}class vr extends vn{constructor(e){super(),this.items=e,this.trav=0}summary(){return`Array of ${this.items.length} items`}async next(){if(this.trav>=this.items.length)return{value:null,done:!0};let e=this.items[this.trav];return this.trav++,{value:b6(e),done:!1}}}class vi extends vn{constructor(e){super(),this.nextFn=e}summary(){return"Function call"}async next(){try{return this.nextFn()}catch(e){throw e.message=`Error thrown while iterating through a dataset: ${e.message}`,e}}}class vs extends vn{constructor(e){super(),this.upstream=e,this.lastRead=Promise.resolve({value:null,done:!1})}summary(){return`${this.upstream.summary()} -> Serial`}async next(){return this.lastRead=this.lastRead.then(()=>this.serialNext()),this.lastRead}async serialNext(){return this.upstream.next()}}class va extends vn{constructor(e,t){super(),this.upstream=e,this.maxCount=t,this.count=0,this.lastRead=Promise.resolve({value:null,done:!1})}summary(){return`${this.upstream.summary()} -> Skip`}async next(){return this.lastRead=this.lastRead.then(()=>this.serialNext()),this.lastRead}async serialNext(){for(;this.count++<this.maxCount;){let e=await this.upstream.next();if(e.done)return e;i3(e.value)}return this.upstream.next()}}class vo extends vn{constructor(e,t){super(),this.upstream=e,this.maxCount=t,this.count=0}summary(){return`${this.upstream.summary()} -> Take`}async next(){return this.count++>=this.maxCount?{value:null,done:!0}:this.upstream.next()}}class vl extends vn{constructor(e,t,n=!0){super(),this.upstream=e,this.batchSize=t,this.enableSmallLastBatch=n,this.lastRead=Promise.resolve({value:null,done:!1})}summary(){return`${this.upstream.summary()} -> RowMajorBatch`}async next(){return this.lastRead=this.lastRead.then(()=>this.serialNext()),this.lastRead}async serialNext(){let e=[];for(;e.length<this.batchSize;){let t=await this.upstream.next();if(t.done){if(this.enableSmallLastBatch&&e.length>0)return{value:e,done:!1};return{value:null,done:!0}}e.push(t.value)}return{value:e,done:!1}}}class vu extends vn{constructor(e,t){super(),this.upstream=e,this.predicate=t,this.lastRead=Promise.resolve({value:null,done:!1})}summary(){return`${this.upstream.summary()} -> Filter`}async next(){return this.lastRead=this.lastRead.then(()=>this.serialNext()),this.lastRead}async serialNext(){for(;;){let e=await this.upstream.next();if(e.done||this.predicate(e.value))return e;i3(e.value)}}}class vc extends vn{constructor(e,t){super(),this.upstream=e,this.transform=t}summary(){return`${this.upstream.summary()} -> Map`}async next(){let e=await this.upstream.next();if(e.done)return{value:null,done:!0};let t=iS(e.value),n=this.transform(e.value),r=iS(n);for(let e of t)ik(e,r)||e.dispose();return{value:n,done:!1}}}class vh extends vn{constructor(e,t){super(),this.upstream=e,this.handler=t,this.count=0,this.lastRead=Promise.resolve({value:null,done:!1})}summary(){return`${this.upstream.summary()} -> handleErrors`}async next(){return this.lastRead=this.lastRead.then(()=>this.serialNext()),this.lastRead}async serialNext(){for(;;)try{return await this.upstream.next()}catch(e){if(!this.handler(e))return{value:null,done:!0}}}}class vd extends vn{constructor(e,t){super(),this.upstream=e,this.transform=t}summary(){return`${this.upstream.summary()} -> AsyncMap`}async next(){let e=await this.upstream.next();if(e.done)return{value:null,done:!0};let t=iS(e.value),n=await this.transform(e.value),r=iS(n);for(let e of t)ik(e,r)||e.dispose();return{value:n,done:!1}}}class vp extends vn{constructor(){super(),this.outputQueue=new b7,this.lastRead=Promise.resolve({value:null,done:!1})}async next(){return this.lastRead=this.lastRead.then(()=>this.serialNext()),this.lastRead}async serialNext(){for(;0===this.outputQueue.length();)if(!await this.pump())return{value:null,done:!0};return{value:this.outputQueue.shift(),done:!1}}}class vf extends vp{constructor(e,t){super(),this.upstream=e,this.transform=t}summary(){return`${this.upstream.summary()} -> Flatmap`}async pump(){let e=await this.upstream.next();if(e.done)return!1;let t=iS(e.value),n=this.transform(e.value),r=iS(n);for(let e of(this.outputQueue.pushAll(n),t))ik(e,r)||e.dispose();return!0}}class vg extends vn{constructor(e,t){super(),this.baseErrorHandler=t,this.lastRead=null,this.iterator=null,this.moreIterators=e}summary(){let e="TODO: fill in upstream of chained summaries";return`${e} -> Chained`}async next(){return this.lastRead=this.readFromChain(this.lastRead),this.lastRead}async readFromChain(e){if(await e,null==this.iterator){let e=await this.moreIterators.next();if(e.done)return{value:null,done:!0};this.iterator=e.value,null!=this.baseErrorHandler&&(this.iterator=this.iterator.handleErrors(this.baseErrorHandler))}let t=await this.iterator.next();return t.done?(this.iterator=null,this.readFromChain(e)):t}}!function(e){e[e.FAIL=0]="FAIL",e[e.SHORTEST=1]="SHORTEST",e[e.LONGEST=2]="LONGEST"}(I||(I={}));class vm extends vn{constructor(e,t){super(),this.upstream=e,this.bufferSize=t,this.buffer=new b8(t)}summary(){return`${this.upstream.summary()} -> Prefetch`}refill(){for(;!this.buffer.isFull();){let e=this.upstream.next();this.buffer.push(e)}}next(){return this.refill(),this.buffer.shift()}}class vy extends vm{constructor(e,t,n){super(e,t),this.upstream=e,this.windowSize=t,this.upstreamExhausted=!1,this.random=lI.alea(n||rJ().toString()),this.lastRead=Promise.resolve({value:null,done:!1})}async next(){return this.lastRead=this.lastRead.then(()=>this.serialNext()),this.lastRead}randomInt(e){return Math.floor(this.random()*e)}chooseIndex(){return this.randomInt(this.buffer.length())}async serialNext(){for(this.upstreamExhausted||this.refill();!this.buffer.isEmpty();){let e=this.chooseIndex(),t=await this.buffer.shuffleExcise(e);if(!t.done)return this.refill(),t;this.upstreamExhausted=!0}return{value:null,done:!0}}}class vb{constructor(){this.size=null}batch(e,t=!0){let n;let r=this;return j(e>0,()=>`batchSize needs to be positive, but it is
      ${e}`),vv(async()=>(await r.iterator()).columnMajorBatch(e,t,vw),n=this.size===1/0||null==this.size?this.size:t?Math.ceil(this.size/e):Math.floor(this.size/e))}concatenate(e){let t;let n=this;return vv(async()=>(await n.iterator()).concatenate(await e.iterator()),t=this.size===1/0||e.size===1/0?1/0:null!=this.size&&null!=e.size?this.size+e.size:null)}filter(e){let t;let n=this;return vv(async()=>(await n.iterator()).filter(t=>i2(()=>e(t))),t=this.size===1/0?1/0:null)}async forEachAsync(e){return(await this.iterator()).forEachAsync(e)}map(e){let t=this;return vv(async()=>(await t.iterator()).map(t=>i2(()=>e(t))),this.size)}mapAsync(e){let t=this;return vv(async()=>(await t.iterator()).mapAsync(e),this.size)}prefetch(e){if(null==e)throw RangeError("`Dataset.prefetch()` requires bufferSize to be specified.");let t=this;return vv(async()=>(await t.iterator()).prefetch(e),this.size)}repeat(e){let t;let n=this;return vv(async()=>vt(ve(async()=>({value:await n.iterator(),done:!1})).take(e)),t=null!=this.size&&e>0?this.size*e:0===e?0:null!=this.size&&(void 0===e||e<0)?1/0:null)}skip(e){let t;let n=this;return vv(async()=>(await n.iterator()).skip(e),t=null!=this.size&&e>=0&&this.size>=e?this.size-e:null!=this.size&&(this.size<e||void 0===e||e<0)?0:null)}shuffle(e,t,n=!0){if(null==e||e<0){if(null==this.size)throw RangeError("`Dataset.shuffle()` requires bufferSize to be specified.");throw RangeError(`\`Dataset.shuffle()\` requires bufferSize to be specified.  If your data fits in main memory (for regular JS objects), and/or GPU memory (for \`tf.Tensor\`s), consider setting bufferSize to the dataset size (${this.size} elements)`)}let r=this,i=lI.alea(t||rJ().toString());return vv(async()=>{let t=i.int32();return n&&(t+=i.int32()),(await r.iterator()).shuffle(e,t.toString())},this.size)}take(e){let t;let n=this;return vv(async()=>(await n.iterator()).take(e),t=null!=this.size&&this.size>e?e:null!=this.size&&this.size<=e?this.size:null)}async toArray(){if(this.size===1/0)throw Error("Can not convert infinite data stream to array.");return(await this.iterator()).toArray()}async toArrayForTest(){if(this.size===1/0)throw Error("Can not convert infinite data stream to array.");return(await this.iterator()).toArrayForTest()}}function vv(e,t=null){return new class extends vb{constructor(){super(...arguments),this.size=t}async iterator(){return e()}}}function vw(e){return null===e?null:b3(e[0])?{value:v_(e),recurse:!1}:{value:null,recurse:!0}}function v_(e){if(0===e.length)throw Error("Can't make a batch of zero elements.");return e[0]instanceof im?lG(e):iY(e)}vb.MAX_BUFFER_SIZE=1e4,Symbol("out"),Symbol("field"),Symbol("quote"),Symbol("quoteafterquote"),Symbol("quoteinquote");class vx extends vn{split(e){return new vT(this,e)}}class vT extends vx{constructor(e,t){super(),this.upstream=e,this.impl=new vI(e,t)}summary(){return this.impl.summary()}async next(){return this.impl.next()}}class vI extends vp{constructor(e,t){super(),this.upstream=e,this.separator=t,this.carryover=""}summary(){return`${this.upstream.summary()} -> Split('${this.separator}')`}async pump(){let e=await this.upstream.next();if(e.done)return""!==this.carryover&&(this.outputQueue.push(this.carryover),this.carryover="",!0);let t=e.value.split(this.separator);for(let e of(t[0]=this.carryover+t[0],t.slice(0,-1)))this.outputQueue.push(e);return this.carryover=t[t.length-1],!0}}var vk=n(8287).hp;class vS extends vx{constructor(e){super(),this.upstream=e,this.impl=new vE(e)}summary(){return this.impl.summary()}async next(){return this.impl.next()}}class vE extends vp{constructor(e){if(super(),this.upstream=e,eN().get("IS_BROWSER"))this.decoder=new TextDecoder("utf-8");else{let{StringDecoder:e}=n(4637);this.decoder=new e("utf8")}}summary(){return`${this.upstream.summary()} -> Utf8`}async pump(){let e,t;let n=await this.upstream.next();return!n.done&&(e=n.value,t=eN().get("IS_BROWSER")?this.decoder.decode(e,{stream:!0}):this.decoder.write(vk.from(e.buffer)),this.outputQueue.push(t),!0)}}function vC(e,t){Array.isArray(e)||(e=[e]),e.forEach(e=>{null!=e&&j("complex64"!==e.dtype,()=>`${t} does not support complex64 tensors in the CPU backend.`)})}let vA=cY;class vN extends P{nextDataId(){return vN.nextDataId++}constructor(){super(),this.blockSize=48,this.firstUse=!0,this.data=new F(this,i0())}write(e,t,n){this.firstUse&&(this.firstUse=!1,eN().get("IS_NODE")&&rw("\n============================\nHi, looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, visit https://github.com/tensorflow/tfjs-node for more details. \n============================"));let r={id:this.nextDataId()};return this.data.set(r,{values:e,dtype:n,refCount:1}),r}makeTensorInfo(e,t,n){let r;if("string"===t&&null!=n&&n.length>0&&el(n[0])){let i=n.map(e=>rZ(e));r=this.write(i,e,t)}else r=this.write(n,e,t);return{dataId:r,shape:e,dtype:t}}refCount(e){return this.data.has(e)?this.data.get(e).refCount:0}incRef(e){let t=this.data.get(e);t.refCount++}decRef(e){if(this.data.has(e)){let t=this.data.get(e);t.refCount--}}move(e,t,n,r,i){this.data.set(e,{values:t,dtype:r,refCount:i})}numDataIds(){return this.data.numDataIds()}async read(e){return this.readSync(e)}readSync(e){let{dtype:t,complexTensorInfos:n}=this.data.get(e);return"complex64"===t?cf(this.readSync(n.real.dataId),this.readSync(n.imag.dataId)):ey(this.data.get(e).values,t)}bufferSync(e){let t=this.readSync(e.dataId);if("string"===e.dtype)try{let n=t.map(e=>r0(e));return s0(e.shape,e.dtype,n)}catch(e){throw Error("Failed to decode encoded string bytes into utf-8")}return s0(e.shape,e.dtype,t)}makeOutput(e,t,n){return i0().makeTensorFromTensorInfo(this.makeTensorInfo(t,n,e),this)}disposeData(e,t=!1){if(this.data.has(e)){if(this.data.get(e).refCount--,!t&&this.data.get(e).refCount>0)return!1;let{complexTensorInfos:n}=this.data.get(e);null!=n&&(this.disposeData(n.real.dataId,!0),this.disposeData(n.imag.dataId,!0)),this.data.delete(e)}return!0}disposeIntermediateTensorInfo(e){this.disposeData(e.dataId)}async time(e){let t=rJ();return e(),{kernelMs:rJ()-t}}memory(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}}where(e){vC([e],"where");let t=this.readSync(e.dataId);return vA(e.shape,t)}dispose(){}floatPrecision(){return 32}epsilon(){return super.epsilon()}}function vO(e){return(t,n,r)=>{let i=en(n,t.length);for(let n=0;n<t.length;++n)i[n]=e(t[n],r);return i}}function v$(e,t,n){return vR(e,vO(t),n)}function vR(e,t,n){return({inputs:r,attrs:i,backend:s})=>{let a;let{x:o}=r;vC(o,e);let l=s,u=l.data.get(o.dataId).values;if("string"===o.dtype){if(!Array.isArray(u))throw Error("String tensor's value was not an instance of Array");a=cK(u)}else a=u;let c=n||o.dtype,h=t(a,c,i);return l.makeTensorInfo(o.shape,c,h)}}vN.nextDataId=0,i7("cpu",()=>new vN,1);let vD=v$(tS,e=>e>=0?e:Math.exp(e)-1),vF={kernelName:tS,backendName:"cpu",kernelFunc:vD};function vP(e){let{inputs:t,backend:n}=e,{x:r}=t;return n.incRef(r.dataId),{dataId:r.dataId,shape:r.shape,dtype:r.dtype}}let vM={kernelName:tj,backendName:"cpu",kernelFunc:vP};function vL(e){let{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{alpha:s}=r;vC([i],"leakyRelu");let a=q(i.shape),o=n.data.get(i.dataId).values,l=et("float32",a);for(let e=0;e<o.length;e++)l[e]=o[e]<0?s*o[e]:o[e];return n.makeTensorInfo(i.shape,"float32",l)}let vz={kernelName:tX,backendName:"cpu",kernelFunc:vL};function vB(e){return(t,n,r,i,s)=>{let a=av(t,n),o=a.length,l=ef(a),u=et(s,q(a)),c=t.length,h=n.length,d=ef(t),p=ef(n),f=ay(t,a),g=ay(n,a);if(f.length+g.length===0)for(let t=0;t<u.length;++t)u[t]=e(r[t%r.length],i[t%i.length]);else for(let t=0;t<u.length;++t){let n=eT(t,o,l),s=n.slice(-c);f.forEach(e=>s[e]=0);let a=ex(s,c,d),m=n.slice(-h);g.forEach(e=>m[e]=0);let y=ex(m,h,p);u[t]=e(r[a],i[y])}return[u,a]}}let vU=vB((e,t)=>e<0?t*e:e);function vV(e){let{inputs:t,backend:n}=e,{x:r,alpha:i}=t;vC([r,i],"prelu");let s=n.data.get(r.dataId).values,a=n.data.get(i.dataId).values,[o,l]=vU(r.shape,i.shape,s,a,"float32");return n.makeTensorInfo(l,"float32",o)}let vj={kernelName:n_,backendName:"cpu",kernelFunc:vV},vG=v$(nA,e=>Math.max(0,e)),vW={kernelName:nA,backendName:"cpu",kernelFunc:vG},vq=v$(nF,e=>Math.min(Math.max(0,e),6)),vH={kernelName:nF,backendName:"cpu",kernelFunc:vq},vK=vO(e=>1/(1+Math.exp(-e))),vX=v$(nK,e=>1/(1+Math.exp(-e))),vY={kernelName:nK,backendName:"cpu",kernelFunc:vX};function vQ(e,t,n,r,i){if("linear"===n)return vP({inputs:{x:t},backend:e});if("relu"===n)return vG({inputs:{x:t},backend:e});if("elu"===n)return vD({inputs:{x:t},backend:e});if("relu6"===n)return vq({inputs:{x:t},backend:e});if("prelu"===n)return vV({inputs:{x:t,alpha:r},backend:e});if("leakyrelu"===n)return vL({inputs:{x:t},backend:e,attrs:{alpha:i}});if("sigmoid"===n)return vX({inputs:{x:t},backend:e});throw Error(`Activation ${n} has not been implemented for the CPU backend.`)}function vJ(e){let{inputs:t,backend:n}=e,{real:r,imag:i}=t,s=n.data.get(r.dataId).values,a=n.data.get(i.dataId).values,o=n.makeTensorInfo(r.shape,"complex64");return n.data.get(o.dataId).complexTensorInfos={real:n.makeTensorInfo(r.shape,"float32",s),imag:n.makeTensorInfo(i.shape,"float32",a)},o}let vZ={kernelName:te,backendName:"cpu",kernelFunc:vJ};function v0(e,t,n="float32"){if("complex64"===n)return vJ({inputs:{real:v0(e,t,"float32"),imag:v0(e,t,"float32")},backend:e});let r=ev(q(t),n);return e.makeTensorInfo(t,n,r)}function v1(e){let{inputs:t,backend:n}=e,{input:r}=t,i=n.data.get(r.dataId).complexTensorInfos.real,s=n.data.get(i.dataId).values;return n.makeTensorInfo(i.shape,i.dtype,s)}let v2={kernelName:nE,backendName:"cpu",kernelFunc:v1};function v3(e,t,n,r){if("int32"===r)return[t,"int32",Int32Array.from(e)];if("bool"===r){let r=rQ([0],n),[i,s]=vB((e,t)=>e!==t?1:0)(t,[],e,r,"bool");return[s,"bool",i]}throw Error(`Error in Cast: failed to cast ${n} to ${r}`)}function v4(e){let{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{dtype:s}=r;if("complex64"===s){if("complex64"===i.dtype)return vP({inputs:{x:i},backend:n});let e=v0(n,i.shape,i.dtype),t=v4({inputs:{x:i},backend:n,attrs:{dtype:"float32"}}),r=vJ({inputs:{real:t,imag:e},backend:n});return n.disposeIntermediateTensorInfo(e),n.disposeIntermediateTensorInfo(t),r}if("complex64"===i.dtype){let e=v1({inputs:{input:i},backend:n}),t=v4({inputs:{x:e},backend:n,attrs:{dtype:s}});return n.disposeIntermediateTensorInfo(e),t}if(!es(i.dtype,s)){let e=vP({inputs:{x:i},backend:n});return{dataId:e.dataId,shape:e.shape,dtype:s}}let[a,o,l]=v3(n.data.get(i.dataId).values,i.shape,i.dtype,s);return n.makeTensorInfo(a,o,l)}let v6={kernelName:e8,backendName:"cpu",kernelFunc:v4};function v5(e,t,n,r){return null==n?({inputs:n,backend:i})=>{let{a:s,b:a}=n,o=i;vC([s,a],e);let l=o.data.get(s.dataId).values,u=o.data.get(a.dataId).values,c="string"===s.dtype?cK(l):l,h="string"===s.dtype?cK(u):u,d=r||s.dtype,[p,f]=t(s.shape,a.shape,c,h,d);return o.makeTensorInfo(f,d,p)}:({inputs:e,backend:i})=>{let{a:s,b:a}=e,o=i;if("complex64"===s.dtype||"complex64"===a.dtype){let e=v4({inputs:{x:s},backend:o,attrs:{dtype:"complex64"}}),t=o.data.get(e.dataId),r=t.complexTensorInfos.real,i=t.complexTensorInfos.imag,l=o.data.get(r.dataId).values,u=o.data.get(i.dataId).values,c=v4({inputs:{x:a},backend:o,attrs:{dtype:"complex64"}}),h=o.data.get(c.dataId),d=h.complexTensorInfos.real,p=h.complexTensorInfos.imag,f=o.data.get(d.dataId).values,g=o.data.get(p.dataId).values,[m,y,b]=n(s.shape,a.shape,l,u,f,g),v=o.makeTensorInfo(b,"float32",m),w=o.makeTensorInfo(b,"float32",y),_=vJ({inputs:{real:v,imag:w},backend:o});return o.disposeIntermediateTensorInfo(e),o.disposeIntermediateTensorInfo(c),o.disposeIntermediateTensorInfo(v),o.disposeIntermediateTensorInfo(w),_}{let e=o.data.get(s.dataId).values,n=o.data.get(a.dataId).values,i=r||s.dtype,[l,u]=t(s.shape,a.shape,e,n,i);return o.makeTensorInfo(u,i,l)}}}function v8(e){return(t,n,r,i,s,a)=>{let o=av(t,n),l=q(o),u=o.length,c=ef(o),h=et("float32",l),d=et("float32",l),p=ay(t,o),f=ay(n,o),g=cf(r,i),m=cf(s,a),y=t.length,b=ef(t),v=n.length,w=ef(n);if(p.length+f.length===0)for(let t=0;t<h.length;t++){let n=t%g.length,r=t%m.length,i=e(g[2*n],g[2*n+1],m[2*r],m[2*r+1]);h[t]=i.real,d[t]=i.imag}else for(let t=0;t<h.length;t++){let n=eT(t,u,c),r=n.slice(-y);p.forEach(e=>r[e]=0);let i=ex(r,y,b),s=n.slice(-v);f.forEach(e=>s[e]=0);let a=ex(s,v,w),o=e(g[2*i],g[2*i+1],m[2*a],m[2*a+1]);h[t]=o.real,d[t]=o.imag}return[h,d,o]}}let v7=vB((e,t)=>e+t),v9=v5(eB,v7,v8((e,t,n,r)=>({real:e+n,imag:t+r}))),we={kernelName:eB,backendName:"cpu",kernelFunc:v9};function wt(e){let{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{shape:s}=r,a=q(i.shape),o=J(s,a),l=q(o);j(a===l,()=>`The new shape (${o}) has ${l} elements and the old shape (${i.shape}) has ${a} elements. The new shape and old shape must have the same number of elements.`),n.incRef(i.dataId);let u=n.data.get(i.dataId);if(null!=u.complexTensorInfos){let e=u.complexTensorInfos.real,t=u.complexTensorInfos.imag;e.shape=o,t.shape=o}return{dataId:i.dataId,shape:o,dtype:i.dtype}}let wn={kernelName:nN,backendName:"cpu",kernelFunc:wt};function wr(e){let{inputs:t,backend:n,attrs:r}=e,{a:i,b:s}=t,{transposeA:a,transposeB:o}=r;vC([i,s],"matMul");let l=i.shape.length,u=s.shape.length,c=a?i.shape[l-2]:i.shape[l-1],h=o?s.shape[u-1]:s.shape[u-2],d=a?i.shape[l-1]:i.shape[l-2],p=o?s.shape[u-2]:s.shape[u-1],f=i.shape.slice(0,-2),g=s.shape.slice(0,-2),m=q(f),y=q(g),b=av(i.shape.slice(0,-2),s.shape.slice(0,-2)).concat([d,p]);j(c===h,()=>`Error in matMul: inner shapes (${c}) and (${h}) of Tensors with shapes ${i.shape} and ${s.shape} and transposeA=${a} and transposeB=${o} must match.`);let v=o?[y,p,h]:[y,h,p],w=wt({inputs:{x:i},backend:n,attrs:{shape:a?[m,c,d]:[m,d,c]}}),_=wt({inputs:{x:s},backend:n,attrs:{shape:v}}),x=a?w.shape[1]:w.shape[2],T=a?w.shape[2]:w.shape[1],I=o?_.shape[1]:_.shape[2],k=Math.max(m,y),S=n.data.get(w.dataId).values,E=n.data.get(_.dataId).values,C=ef(w.shape),A=ef(_.shape),[N,O,$]=a?[C[0],1,C[1]]:[C[0],C[1],1],[R,D,F]=o?[1,A[1],A[0]]:[A[1],1,A[0]],P=T*I,M=s0([k,T,I],w.dtype),L=M.values,z=n.blockSize;for(let e=0;e<k;e++){let t=e%m,n=e%y;for(let r=0;r<T;r+=z){let i=Math.min(r+z,T);for(let s=0;s<I;s+=z){let a=Math.min(s+z,I);for(let o=0;o<x;o+=z){let l=Math.min(o+z,x);for(let u=r;u<i;u++)for(let r=s;r<a;r++){let i=0;for(let e=o;e<l;e++)i+=S[t*N+u*O+e*$]*E[e*R+r*D+n*F];L[e*P+(u*I+r)]+=i}}}}}return n.disposeIntermediateTensorInfo(w),n.disposeIntermediateTensorInfo(_),n.makeTensorInfo(b,M.dtype,M.values)}let wi={kernelName:e1,backendName:"cpu",kernelFunc:wr},ws={kernelName:ry,backendName:"cpu",kernelFunc:function(e){let t,n,r;let{inputs:i,backend:s,attrs:a}=e,{a:o,b:l,bias:u,preluActivationWeights:c}=i,{transposeA:h,transposeB:d,activation:p,leakyreluAlpha:f}=a,g=[];for(let e of(t=wr({inputs:{a:o,b:l},attrs:{transposeA:h,transposeB:d},backend:s}),u&&(n=v9({inputs:{a:t,b:u},backend:s}),g.push(t),t=n),p&&(r=vQ(s,t,p,c,f),g.push(t),t=r),g))s.disposeIntermediateTensorInfo(e);return t}};function wa(e){let t=new Float32Array(e.length);for(let n=0;n<e.length;++n)t[n]=Math.abs(e[n]);return t}let wo={kernelName:eM,backendName:"cpu",kernelFunc:e=>{let{x:t}=e.inputs,n=e.backend;vC(t,"abs");let r=new Float32Array(q(t.shape));return r=wa(n.data.get(t.dataId).values),n.makeOutput(r,t.shape,t.dtype)}},wl=v$(eL,e=>Math.acos(e)),wu={kernelName:eL,backendName:"cpu",kernelFunc:wl},wc=v$(ez,e=>Math.acosh(e)),wh={kernelName:ez,backendName:"cpu",kernelFunc:wc},wd={kernelName:eU,backendName:"cpu",kernelFunc:function(e){let{inputs:t,backend:n}=e,r=t;vC(t,"addN");let i=r.map(e=>n.data.get(e.dataId).values),s=s0(r[0].shape,r[0].dtype),a=s.values;for(let e=0;e<r.length;e++){let t=i[e];for(let e=0;e<a.length;e++)a[e]+=t[e]}return n.makeTensorInfo(s.shape,s.dtype,s.values)}};function wp(e,t,n,r,i){let s=t.length,a=q(t),o=ef(t),l=ef(i),u=et(n,q(i));for(let t=0;t<a;++t){let n=eT(t,s,o),i=Array(n.length);for(let e=0;e<i.length;e++)i[e]=n[r[e]];u[ex(i,s,l)]=e[t]}return u}function wf(e){let{inputs:t,attrs:n,backend:r}=e,{x:i}=t,{perm:s}=n;vC(i,"transpose");let a=Array(i.shape.length);for(let e=0;e<a.length;e++)a[e]=i.shape[s[e]];let o=wp(r.data.get(i.dataId).values,i.shape,i.dtype,s,a);return{dataId:r.write(o,a,i.dtype),shape:a,dtype:i.dtype}}let wg={kernelName:ru,backendName:"cpu",kernelFunc:wf},wm={kernelName:eV,backendName:"cpu",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{axis:s,keepDims:a}=r;vC(i,"all");let o=Z(s,i.shape),l=o,u=li(l,i.shape.length),c=i;null!=u&&(c=wf({inputs:{x:i},backend:n,attrs:{perm:u}}),l=la(l.length,i.shape.length)),lr("all",l,c.shape.length);let[h,d]=lt(c.shape,l),p=q(d),f=ev(q(h),c.dtype),g=n.data.get(c.dataId).values;for(let e=0;e<f.length;++e){let t=e*p,n=g[t];for(let e=0;e<p;++e){let r=g[t+e];n=n&&r}f[e]=n}null!=u&&n.disposeIntermediateTensorInfo(c);let m=n.makeTensorInfo(h,c.dtype,f);if(a){let e=wt({inputs:{x:m},backend:n,attrs:{shape:ln(h,o)}});return n.disposeIntermediateTensorInfo(m),e}return m}},wy={kernelName:ej,backendName:"cpu",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{axis:s,keepDims:a}=r;vC(i,"any");let o=Z(s,i.shape),l=o,u=li(l,i.shape.length),c=i;null!=u&&(c=wf({inputs:{x:i},backend:n,attrs:{perm:u}}),l=la(l.length,i.shape.length)),lr("any",l,c.shape.length);let[h,d]=lt(c.shape,l),p=q(d),f=ev(q(h),c.dtype),g=n.data.get(c.dataId).values;for(let e=0;e<f.length;++e){let t=e*p,n=g[t];for(let e=0;e<p;++e){let r=g[t+e];n=n||r}f[e]=n}null!=u&&n.disposeIntermediateTensorInfo(c);let m=n.makeTensorInfo(h,c.dtype,f);if(a){let e=wt({inputs:{x:m},backend:n,attrs:{shape:ln(h,o)}});return n.disposeIntermediateTensorInfo(m),e}return m}},wb={kernelName:eG,backendName:"cpu",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{axis:s}=r;vC(i,"argMax");let a=Z(s,i.shape),o=li(a,i.shape.length),l=i,u=[];null!=o&&(u.push(l=wf({inputs:{x:i},backend:n,attrs:{perm:o}})),a=la(a.length,l.shape.length)),lr("argMax",a=[a[0]],l.shape.length);let[c,h]=lt(l.shape,a),d=ev(q(c),"int32"),p=q(h),f=n.data.get(l.dataId).values;for(let e=0;e<d.length;++e){let t=e*p,n=f[t],r=0;for(let e=0;e<p;++e){let i=f[t+e];i>n&&(n=i,r=e)}d[e]=r}return u.forEach(e=>n.disposeIntermediateTensorInfo(e)),n.makeTensorInfo(c,"int32",d)}},wv={kernelName:eW,backendName:"cpu",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{axis:s}=r;vC(i,"argMin");let a=Z(s,i.shape),o=li(a,i.shape.length),l=i,u=[];null!=o&&(u.push(l=wf({inputs:{x:i},backend:n,attrs:{perm:o}})),a=la(a.length,l.shape.length)),lr("argMin",a=[a[0]],l.shape.length);let[c,h]=lt(l.shape,a),d=ev(q(c),"int32"),p=q(h),f=n.data.get(l.dataId).values;for(let e=0;e<d.length;++e){let t=e*p,n=f[t],r=0;for(let e=0;e<p;++e){let i=f[t+e];i<n&&(n=i,r=e)}d[e]=r}return u.forEach(e=>n.disposeIntermediateTensorInfo(e)),n.makeTensorInfo(c,"int32",d)}},ww=v$(eq,e=>Math.asin(e)),w_={kernelName:eq,backendName:"cpu",kernelFunc:ww},wx=v$(eH,e=>Math.asinh(e)),wT={kernelName:eH,backendName:"cpu",kernelFunc:wx},wI=v$(eK,e=>Math.atan(e)),wk={kernelName:eK,backendName:"cpu",kernelFunc:wI},wS=v5(eY,vB((e,t)=>Math.atan2(e,t))),wE={kernelName:eY,backendName:"cpu",kernelFunc:wS},wC=v$(eX,e=>Math.atanh(e)),wA={kernelName:eX,backendName:"cpu",kernelFunc:wC};function wN(e,t,n,r,i,s){let a=i.strideHeight,o=i.strideWidth,l=i.dilationHeight,u=i.dilationWidth,c=i.effectiveFilterHeight,h=i.effectiveFilterWidth,d=i.padInfo.top,p=i.padInfo.left,f="max"===s?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,g=s0(i.outShape,n),m=g.values,y=i.outShape[1]*i.outShape[2]*i.outShape[3],b=i.outShape[2]*i.outShape[3],v=i.outShape[3];for(let t=0;t<i.batchSize;++t){let n=t*y,g=t*r[0];for(let t=0;t<i.inChannels;++t)for(let y=0;y<i.outHeight;++y){let w=y*a-d,_=Math.max(0,w),x=Math.min(i.inHeight,c+w),T=n+y*b;for(let n=0;n<i.outWidth;++n){let a=n*o-p,c=Math.max(0,a),d=Math.min(i.inWidth,h+a),y=f,b=0,w=0;for(let n=_;n<x;n+=l){let i=g+n*r[1];for(let n=c;n<d;n+=u){let a=e[i+n*r[2]+t];"max"===s&&a>y?y=a:"avg"===s&&(b+=a,w++)}if(isNaN(y))break}m[T+n*v+t]="avg"===s?b/w:y}}}return g}function wO(e,t,n,r,i=!1,s=!1){let a=s0(r.outShape,"int32"),o=r.strideHeight,l=r.strideWidth,u=r.dilationHeight,c=r.dilationWidth,h=r.effectiveFilterHeight,d=r.effectiveFilterWidth,p=r.padInfo.top,f=r.padInfo.left,g=s0(t,n,e);for(let e=0;e<r.batchSize;++e)for(let t=0;t<r.inChannels;++t)for(let n=0;n<r.outHeight;++n){let m=n*o-p,y=m;for(;y<0;)y+=u;let b=Math.min(r.inHeight,h+m);for(let o=0;o<r.outWidth;++o){let h=o*l-f,p=h;for(;p<0;)p+=c;let v=Math.min(r.inWidth,d+h),w=Number.NEGATIVE_INFINITY,_=-1;for(let n=y;n<b;n+=u){let a=n-m;for(let o=p;o<v;o+=c){let l=o-h,u=g.get(e,n,o,t);u>w&&(w=u,_=i?s?((e*r.inHeight+n)*r.inWidth+o)*r.inChannels+t:(n*r.inWidth+o)*r.inChannels+t:a*d+l)}}a.set(_,e,n,o,t)}}return a}function w$(e,t,n,r,i,s){let a=i.strideDepth,o=i.strideHeight,l=i.strideWidth,u=i.dilationDepth,c=i.dilationHeight,h=i.dilationWidth,d=i.effectiveFilterDepth,p=i.effectiveFilterHeight,f=i.effectiveFilterWidth,g=i.padInfo.front,m=i.padInfo.top,y=i.padInfo.left,b="max"===s?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,v=s0(i.outShape,n),w=v.values,_=i.outShape[1]*i.outShape[2]*i.outShape[3]*i.outShape[4],x=i.outShape[2]*i.outShape[3]*i.outShape[4],T=i.outShape[3]*i.outShape[4],I=i.outShape[4];for(let t=0;t<i.batchSize;++t){let n=t*_,v=t*r[0];for(let t=0;t<i.inChannels;++t)for(let _=0;_<i.outDepth;++_){let k=_*a-g,S=k;for(;S<0;)S+=u;let E=Math.min(i.inDepth,d+k),C=n+_*x;for(let n=0;n<i.outHeight;++n){let a=n*o-m,d=a;for(;d<0;)d+=c;let g=Math.min(i.inHeight,p+a),_=C+n*T;for(let n=0;n<i.outWidth;++n){let a=n*l-y,o=a;for(;o<0;)o+=h;let p=Math.min(i.inWidth,f+a),m=_+n*I,x=b,T=0,k=0;for(let n=S;n<E;n+=u){let i=v+n*r[1];for(let n=d;n<g;n+=c){let a=i+n*r[2];for(let n=o;n<p;n+=h){let i=e[a+n*r[3]+t];if("max"===s&&i>x?x=i:"avg"===s&&(T+=i,k++),isNaN(x))break}if(isNaN(x))break}if(isNaN(x))break}w[m+t]="avg"===s?T/Math.max(k,1):x}}}}return v}function wR(e,t){let n=s0(t.outShape,"int32"),r=t.strideDepth,i=t.strideHeight,s=t.strideWidth,a=t.dilationDepth,o=t.dilationHeight,l=t.dilationWidth,u=t.effectiveFilterDepth,c=t.effectiveFilterHeight,h=t.effectiveFilterWidth,d=t.padInfo.front,p=t.padInfo.top,f=t.padInfo.left;for(let g=0;g<t.batchSize;++g)for(let m=0;m<t.inChannels;++m)for(let y=0;y<t.outDepth;++y){let b=y*r-d,v=b;for(;v<0;)v+=a;let w=Math.min(t.inDepth,u+b);for(let r=0;r<t.outHeight;++r){let u=r*i-p,d=u;for(;d<0;)d+=o;let _=Math.min(t.inHeight,c+u);for(let i=0;i<t.outWidth;++i){let p=i*s-f,x=p;for(;x<0;)x+=l;let T=Math.min(t.inWidth,h+p),I=Number.NEGATIVE_INFINITY,k=-1;for(let t=v;t<w;t+=a){let n=t-b;for(let r=d;r<_;r+=o){let i=r-u;for(let s=x;s<T;s+=l){let a=s-p,o=e.get(g,t,r,s,m);o>=I&&(I=o,k=n*c*h+i*c+a)}}}n.set(k,g,y,r,i,m)}}}return n}let wD={kernelName:eQ,backendName:"cpu",kernelFunc:function(e){let t;let{inputs:n,backend:r,attrs:i}=e,{x:s}=n;vC(s,"avgPool");let{filterSize:a,strides:o,pad:l,dimRoundingMode:u}=i,c=1;j(ob(o,1),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${o} and dilations '${c}'`);let h=oi(s.shape,a,o,c,l,u);if(1===h.filterWidth&&1===h.filterHeight&&H(h.inShape,h.outShape))t=vP({inputs:{x:s},backend:r});else{let e=r.data.get(s.dataId).values,n=ef(s.shape),i=wN(e,s.shape,s.dtype,n,h,"avg");t=r.makeTensorInfo(h.outShape,s.dtype,i.values)}return t}},wF={kernelName:eZ,backendName:"cpu",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{filterSize:s,strides:a,pad:o,dimRoundingMode:l,dataFormat:u}=r;vC(i,"avgPool3d");let c=os(i.shape,s,a,1,o,l,u),h=w$(n.data.get(i.dataId).values,i.shape,i.dtype,ef(i.shape),c,"avg");return n.makeTensorInfo(h.shape,"float32",h.values)}},wP={kernelName:e0,backendName:"cpu",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{dy:i,input:s}=t,{filterSize:a,strides:o,pad:l,dimRoundingMode:u}=r;vC([i,s],"avgPool3DGrad");let c=os(s.shape,a,o,1,l,u),h=c.strideDepth,d=c.strideHeight,p=c.strideWidth,f=c.filterDepth,g=c.filterHeight,m=c.filterWidth,y=c.dilationDepth,b=c.dilationHeight,v=c.dilationWidth,w=c.effectiveFilterDepth,_=c.effectiveFilterHeight,x=c.effectiveFilterWidth,T=w-1-c.padInfo.front,I=x-1-c.padInfo.left,k=_-1-c.padInfo.top,S=s0(s.shape,"float32"),E=1/(f*g*m),C=n.bufferSync(i);for(let e=0;e<c.batchSize;++e)for(let t=0;t<c.inChannels;++t)for(let n=0;n<c.inDepth;++n)for(let r=0;r<c.inHeight;++r)for(let i=0;i<c.inWidth;++i){let s=n-T,a=r-k,o=i-I,l=0;for(let n=0;n<w;n+=y){let r=(s+n)/h;if(!(r<0)&&!(r>=c.outDepth)&&Math.floor(r)===r)for(let n=0;n<_;n+=b){let i=(a+n)/d;if(!(i<0)&&!(i>=c.outHeight)&&Math.floor(i)===i)for(let n=0;n<x;n+=v){let s=(o+n)/p;s<0||s>=c.outWidth||Math.floor(s)!==s||(l+=C.get(e,r,i,s,t))}}}S.set(l*E,e,n,r,i,t)}return n.makeTensorInfo(S.shape,S.dtype,S.values)}},wM={kernelName:eJ,backendName:"cpu",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{dy:i,input:s}=t,a=s;vC([i,s],"avgPoolGrad");let{filterSize:o,strides:l,pad:u}=r,c=oi(a.shape,o,l,1,u),h=c.strideHeight,d=c.strideWidth,p=c.filterHeight,f=c.filterWidth,g=c.dilationHeight,m=c.dilationWidth,y=c.effectiveFilterHeight,b=c.effectiveFilterWidth,v=b-1-c.padInfo.left,w=y-1-c.padInfo.top,_=s0(a.shape,"float32"),x=1/(p*f),T=n.data.get(i.dataId).values,I=s0(i.shape,"float32",T);for(let e=0;e<c.batchSize;++e)for(let t=0;t<c.inChannels;++t)for(let n=0;n<c.inHeight;++n)for(let r=0;r<c.inWidth;++r){let i=n-w,s=r-v,a=0;for(let n=0;n<y;n+=g){let r=(i+n)/h;if(!(r<0)&&!(r>=c.outHeight)&&Math.floor(r)===r)for(let n=0;n<b;n+=m){let i=(s+n)/d;i<0||i>=c.outWidth||Math.floor(i)!==i||(a+=I.get(e,r,i,t))}}_.set(a*x,e,n,r,t)}return n.makeTensorInfo(_.shape,_.dtype,_.values)}},wL={kernelName:tL,backendName:"cpu",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{x:i,scale:s,offset:a,mean:o,variance:l}=t;j(o.shape.length===l.shape.length,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),j(null==a||o.shape.length===a.shape.length,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),j(null==s||o.shape.length===s.shape.length,()=>"Batch normalization gradient requires mean and scale to have equal ranks."),vC([i,o,l,s,a],"batchNorm");let{varianceEpsilon:u}=r;null==u&&(u=.001);let c=n.data.get(i.dataId).values,h=n.data.get(o.dataId).values,d=n.data.get(l.dataId).values,p=s?n.data.get(s.dataId).values:new Float32Array([1]),f=a?n.data.get(a.dataId).values:new Float32Array([0]),g=new Float32Array(c.length),m=f.length,y=p.length,b=d.length,v=h.length,w=0,_=0,x=0,T=0;for(let e=0;e<c.length;++e)g[e]=f[w++]+(c[e]-h[_++])*p[x++]/Math.sqrt(d[T++]+u),w>=m&&(w=0),_>=v&&(_=0),x>=y&&(x=0),T>=b&&(T=0);return n.makeTensorInfo(i.shape,i.dtype,g)}};function wz(e,t,n,r,i){let s=a4(r,t,n),a=q(n),o=ef(r);if(s){let n=a6(t,o);return"string"===i?e.slice(n,n+a):e.subarray(n,n+a)}let l="string"===i?cK(e):e,u=s0(r,i,l),c=s0(n,i);for(let e=0;e<c.size;++e){let n=c.indexToLoc(e),r=n.map((e,n)=>e+t[n]);c.set(u.get(...r),...n)}return"string"===i?cX(c.values):c.values}function wB(e){let{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{begin:s,size:a}=r;vC(i,"slice");let[o,l]=a5(i,s,a);aq(i,o,l);let u=wz(n.data.get(i.dataId).values,o,l,i.shape,i.dtype);return n.makeTensorInfo(l,i.dtype,u)}let wU={kernelName:nG,backendName:"cpu",kernelFunc:wB},wV={kernelName:e2,backendName:"cpu",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{blockShape:s,crops:a}=r;vC([i],"batchToSpaceND");let o=s.reduce((e,t)=>e*t),l=u8(i.shape,s,o),u=u7(l.length,s.length),c=u9(i.shape,s,o),h=ce(a,s.length),d=ct(c,a,s.length),p=wt({inputs:{x:i},backend:n,attrs:{shape:l}}),f=wf({inputs:{x:p},backend:n,attrs:{perm:u}}),g=wt({inputs:{x:f},backend:n,attrs:{shape:c}}),m=wB({inputs:{x:g},backend:n,attrs:{begin:h,size:d}});return n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(g),m}};function wj(e,t,n,r,i){let s=q(r),a=ev(i,n);for(let n=0;n<e.length;n++){let r=e[n];if(r<0)throw Error("Input x must be non-negative!");r>=i||(s>0?a[r]+=t[n]:a[r]+=1)}return a}function wG(e,t,n,r=!1){let i=e.shape[0],s=e.shape[1],a=s0([i,n],t.dtype);for(let o=0;o<i;o++)for(let i=0;i<s;i++){let s=e.get(o,i);if(s<0)throw Error("Input x must be non-negative!");s>=n||(r?a.set(1,o,s):t.size>0?a.set(a.get(o,s)+t.get(o,i),o,s):a.set(a.get(o,s)+1,o,s))}return a}let wW={kernelName:e3,backendName:"cpu",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{x:i,weights:s}=t,{size:a}=r,o=wj(n.data.get(i.dataId).values,n.data.get(s.dataId).values,s.dtype,s.shape,a);return n.makeTensorInfo([a],s.dtype,o)}},wq=vB((e,t)=>e&t),wH=v5(e4,wq),wK={kernelName:e4,backendName:"cpu",kernelFunc:wH},wX={kernelName:e5,backendName:"cpu",kernelFunc:function(e){let{inputs:t,backend:n}=e,{s0:r,s1:i}=t,s=n.data.get(r.dataId).values,a=n.data.get(i.dataId).values,o=av(Array.from(s),Array.from(a));return n.makeTensorInfo([o.length],"int32",Int32Array.from(o))}},wY=vO(e=>Math.ceil(e)),wQ=vR(e7,wY),wJ={kernelName:e7,backendName:"cpu",kernelFunc:wQ},wZ=v$(e9,(e,t)=>{let n=t;return e>n.clipValueMax?n.clipValueMax:e<n.clipValueMin?n.clipValueMin:e}),w0={kernelName:e9,backendName:"cpu",kernelFunc:wZ},w1={kernelName:tt,backendName:"cpu",kernelFunc:e=>{let{x:t}=e.inputs,n=e.backend,r=new Float32Array(q(t.shape)),i=n.data.get(t.dataId),s=i.complexTensorInfos.real,a=i.complexTensorInfos.imag,o=n.data.get(s.dataId).values,l=n.data.get(a.dataId).values;for(let e=0;e<o.length;e++){let t=o[e],n=l[e];r[e]=Math.hypot(t,n)}return n.makeOutput(r,t.shape,"float32")}};function w2(e,t,n,r){let i=en(n,q(t));if(r&&"string"!==n){let t=0;e.forEach(e=>{let n=q(e.shape);i.set(e.vals,t),t+=n})}else{let r=0;e.forEach(e=>{let s="string"===n?cK(e.vals):e.vals,a=0;for(let n=0;n<e.shape[0];++n){let o=n*t[1]+r;for(let t=0;t<e.shape[1];++t)i[o+t]=s[a++]}r+=e.shape[1]})}return i}function w3(e){let{inputs:t,backend:n}=e,{input:r}=t,i=n.data.get(r.dataId).complexTensorInfos.imag,s=n.data.get(i.dataId).values;return n.makeTensorInfo(i.shape,i.dtype,s)}let w4={kernelName:tW,backendName:"cpu",kernelFunc:w3};function w6(e){let{inputs:t,backend:n,attrs:r}=e,{axis:i}=r,s=Z(i,t[0].shape)[0];uJ(t.map(e=>e.shape),s);let a=uZ(t.map(e=>e.shape),s);if(0===q(a))return n.makeTensorInfo(a,t[0].dtype,[]);let o=t.filter(e=>q(e.shape)>0);if(1===o.length)return vP({inputs:{x:o[0]},backend:n});if("complex64"===o[0].dtype){let e=o.map(e=>v1({inputs:{input:e},backend:n})),t=o.map(e=>w3({inputs:{input:e},backend:n})),r=w6({inputs:e,backend:n,attrs:{axis:s}}),i=w6({inputs:t,backend:n,attrs:{axis:s}}),a=vJ({inputs:{real:r,imag:i},backend:n});return e.forEach(e=>n.disposeIntermediateTensorInfo(e)),t.forEach(e=>n.disposeIntermediateTensorInfo(e)),n.disposeIntermediateTensorInfo(r),n.disposeIntermediateTensorInfo(i),a}let l=o.map(e=>{let t=[-1,q(e.shape.slice(s))];return wt({inputs:{x:e},backend:n,attrs:{shape:t}})}),u=l.map(e=>({vals:n.data.get(e.dataId).values,shape:e.shape}));a=uZ(l.map(e=>e.shape),1);let c=1===l[0].shape[0],h=w2(u,a,t[0].dtype,c),d=uZ(o.map(e=>e.shape),s),p=n.makeTensorInfo(d,t[0].dtype,h);return l.forEach(e=>n.disposeIntermediateTensorInfo(e)),p}let w5={kernelName:tn,backendName:"cpu",kernelFunc:w6};function w8(e){let{inputs:t,backend:n,attrs:r}=e,{x:i,filter:s}=t,{strides:a,pad:o,dataFormat:l,dilations:u,dimRoundingMode:c}=r;vC([i,s],"conv2d");let h=ow(l),d=oa(i.shape,s.shape,a,u,o,c,!1,h),p=d.filterHeight,f=d.filterWidth,g=d.dilationHeight,m=d.dilationWidth,y=d.padInfo.left,b=d.padInfo.top,v="channelsLast"===d.dataFormat,w=new il(d.outShape,i.dtype),_=ef(i.shape),x=ef(s.shape),T=_[0],I=v?_[1]:_[2],k=v?_[2]:1,S=v?1:_[1],E=w.strides[0],C=v?w.strides[1]:w.strides[2],A=v?w.strides[2]:1,N=v?1:w.strides[1],O=n.data.get(i.dataId).values,$=n.data.get(s.dataId).values,R=w.values;for(let e=0;e<d.batchSize;++e){let t=e*T,n=e*E;for(let e=0;e<d.outHeight;++e){let r=n+e*C,i=e*d.strideHeight-b;for(let e=0;e<p;++e){let n=i+e*g;if(n<0||n>=d.inHeight)continue;let s=e*x[0],a=t+n*I;for(let e=0;e<d.outWidth;++e){let t=r+e*A,n=e*d.strideWidth-y;for(let e=0;e<f;++e){let r=n+e*m;if(r<0||r>=d.inWidth)continue;let i=s+e*x[1],o=a+r*k,l=i;for(let e=0;e<d.inChannels;++e){let n=O[o+e*S];for(let e=0;e<d.outChannels;++e)R[t+e*N]+=n*$[l+e];l+=d.outChannels}}}}}}return n.makeTensorInfo(w.shape,w.dtype,R)}let w7={kernelName:tr,backendName:"cpu",kernelFunc:w8},w9={kernelName:ti,backendName:"cpu",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{x:i,dy:s}=t,{strides:a,pad:o,dataFormat:l,dimRoundingMode:u,filterShape:c}=r;vC([i,s],"conv2dBackpropFilter");let h=ow(l),d=oa(i.shape,c,a,1,o,u,!1,h),{strideHeight:p,strideWidth:f,filterHeight:g,filterWidth:m}=d,y="channelsLast"===d.dataFormat,b=new il(d.filterShape,"float32"),v=d.padInfo.left,w=d.padInfo.top,_=n.data.get(i.dataId).values,x=n.data.get(s.dataId).values,T=new il(i.shape,i.dtype,_),I=new il(s.shape,s.dtype,x);for(let e=0;e<g;++e){let t=Math.max(0,Math.ceil((w-e)/p)),n=Math.min(d.outHeight,(d.inHeight+w-e)/p);for(let r=0;r<m;++r){let i=Math.max(0,Math.ceil((v-r)/f)),s=Math.min(d.outWidth,(d.inWidth+v-r)/f);for(let a=0;a<d.inChannels;++a)for(let o=0;o<d.outChannels;++o){let l=0;for(let u=0;u<d.batchSize;++u)for(let c=t;c<n;++c){let t=e+c*p-w;for(let e=i;e<s;++e){let n=r+e*f-v;y?l+=T.get(u,t,n,a)*I.get(u,c,e,o):l+=T.get(u,a,t,n)*I.get(u,o,c,e)}}b.set(l,e,r,a,o)}}}return n.makeTensorInfo(b.shape,b.dtype,b.values)}},_e={kernelName:ts,backendName:"cpu",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{dy:i,filter:s}=t,{inputShape:a,strides:o,pad:l,dataFormat:u,dimRoundingMode:c}=r;vC([i,s],"conv2dBackpropInput");let h=ef(s.shape),d=ef(i.shape),p=ow(u),f=oa(a,s.shape,o,1,l,c,!1,p),g=new il(f.inShape,"float32"),m=g.values,y=n.data.get(i.dataId).values,b=n.data.get(s.dataId).values,[v,w,_]=h,{batchSize:x,filterHeight:T,filterWidth:I,inChannels:k,inHeight:S,inWidth:E,outChannels:C,outHeight:A,outWidth:N,strideHeight:O,strideWidth:$}=f;p=f.dataFormat;let R=T-1-f.padInfo.top,D=I-1-f.padInfo.left,F="channelsLast"===p,P=g.strides[0],M=F?g.strides[1]:g.strides[2],L=F?g.strides[2]:1,z=F?1:g.strides[1],B=d[0],U=F?d[1]:d[2],V=F?d[2]:1,j=F?1:d[1];for(let e=0;e<x;++e)for(let t=0;t<k;++t)for(let n=0;n<S;++n){let r=n-R,i=Math.max(0,Math.ceil(r/O)),s=Math.min(A,(T+r)/O);for(let a=0;a<E;++a){let o=a-D,l=Math.max(0,Math.ceil(o/$)),u=Math.min(N,(I+o)/$),c=0;for(let n=i;n<s;++n){let i=n*O-r;for(let r=l;r<u;++r){let s=r*$-o,a=B*e+U*n+V*r,l=v*(T-1-i)+w*(I-1-s)+_*t;for(let e=0;e<C;++e)c+=y[a+j*e]*b[l+e]}}m[P*e+M*n+L*a+z*t]=c}}return n.makeTensorInfo(g.shape,g.dtype,g.values)}},_t={kernelName:ta,backendName:"cpu",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{x:i,filter:s}=t,{strides:a,pad:o,dilations:l}=r;vC([i,s],"conv3d");let u=oo(i.shape,s.shape,a,l,o),{filterDepth:c,filterHeight:h,filterWidth:d,dilationDepth:p,dilationHeight:f,dilationWidth:g,padInfo:m}=u,y=m.front,b=m.left,v=m.top,w=new il(u.outShape,i.dtype),_=n.data.get(i.dataId).values,x=n.data.get(s.dataId).values,T=w.values,I=ef(i.shape),k=ef(s.shape);for(let e=0;e<u.batchSize;++e){let t=e*I[0],n=e*w.strides[0];for(let e=0;e<u.outDepth;++e){let r=n+e*w.strides[1],i=e*u.strideDepth-y;for(let e=0;e<c;++e){let n=i+e*p;if(n<0||n>=u.inDepth)continue;let s=e*k[0],a=t+n*I[1];for(let e=0;e<u.outHeight;++e){let t=r+e*w.strides[2],n=e*u.strideHeight-v;for(let e=0;e<h;++e){let r=n+e*f;if(r<0||r>=u.inHeight)continue;let i=s+e*k[1],o=a+r*I[2];for(let e=0;e<u.outWidth;++e){let n=t+e*u.outChannels,r=e*u.strideWidth-b;for(let e=0;e<d;++e){let t=r+e*g;if(t<0||t>=u.inWidth)continue;let s=i+e*k[2],a=o+t*u.inChannels,l=s;for(let e=0;e<u.inChannels;++e){let t=_[a+e];for(let e=0;e<u.outChannels;++e)T[n+e]+=t*x[l+e];l+=u.outChannels}}}}}}}}return n.makeTensorInfo(w.shape,w.dtype,w.values)}},_n={kernelName:to,backendName:"cpu",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{x:i,dy:s}=t,{strides:a,pad:o,filterShape:l}=r;vC([i,s],"conv3dBackpropFilterV2");let u=ef(i.shape),c=ef(s.shape),h=oo(i.shape,l,a,1,o),d=h.strideDepth,p=h.strideHeight,f=h.strideWidth,g=h.filterDepth,m=h.filterHeight,y=h.filterWidth,b=new il(h.filterShape,"float32"),v=b.values,[w,_,x,T]=b.strides,I=n.data.get(s.dataId).values,[k,S,E,C]=c,A=n.data.get(i.dataId).values,[N,O,$,R]=u,D=h.padInfo.front,F=h.padInfo.left,P=h.padInfo.top;for(let e=0;e<g;++e){let t=Math.max(0,Math.ceil((D-e)/d)),n=Math.min(h.outDepth,(h.inDepth+D-e)/d),r=e*w;for(let i=0;i<m;++i){let s=Math.max(0,Math.ceil((P-i)/p)),a=Math.min(h.outHeight,(h.inHeight+P-i)/p),o=i*_+r;for(let r=0;r<y;++r){let l=Math.max(0,Math.ceil((F-r)/f)),u=Math.min(h.outWidth,(h.inWidth+F-r)/f),c=r*x+o;for(let o=0;o<h.inChannels;++o){let g=o*T+c;for(let c=0;c<h.outChannels;++c){let m=0;for(let g=0;g<h.batchSize;++g){let h=g*N,y=g*k;for(let g=t;g<n;++g){let t=(e+g*d-D)*O+h,n=g*S+y;for(let e=s;e<a;++e){let s=(i+e*p-P)*$+t,a=e*E+n;for(let e=l;e<u;++e){let t=(r+e*f-F)*R+s,n=e*C+a;m+=A[t+o]*I[n+c]}}}}v[g+c]=m}}}}}return n.makeTensorInfo(b.shape,b.dtype,b.values)}},_r={kernelName:tl,backendName:"cpu",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{dy:i,filter:s}=t,{pad:a,strides:o,inputShape:l}=r;vC([i],"conv3dBackpropInputV2");let u=ef(i.shape),c=ef(s.shape),h=oo(l,s.shape,o,1,a),d=new il(h.inShape,"float32"),p=d.values,[f,g,m,y]=d.strides,b=n.data.get(i.dataId).values,[v,w,_,x]=u,T=n.data.get(s.dataId).values,[I,k,S,E]=c,{batchSize:C,filterDepth:A,filterHeight:N,filterWidth:O,inChannels:$,inDepth:R,inHeight:D,inWidth:F,outChannels:P,outDepth:M,outHeight:L,outWidth:z,strideDepth:B,strideHeight:U,strideWidth:V}=h,j=A-1-h.padInfo.front,G=N-1-h.padInfo.top,W=O-1-h.padInfo.left;for(let e=0;e<C;++e)for(let t=0;t<$;++t)for(let n=0;n<R;++n){let r=n-j,i=Math.max(0,Math.ceil(r/B)),s=Math.min(M,(A+r)/B);for(let a=0;a<D;++a){let o=a-G,l=Math.max(0,Math.ceil(o/U)),u=Math.min(L,(N+o)/U);for(let c=0;c<F;++c){let h=c-W,d=Math.max(0,Math.ceil(h/V)),C=Math.min(z,(O+h)/V),$=0;for(let n=i;n<s;++n){let i=n*B-r;for(let r=l;r<u;++r){let s=r*U-o;for(let a=d;a<C;++a){let o=a*V-h,l=v*e+w*n+_*r+x*a,u=I*(A-1-i)+k*(N-1-s)+S*(O-1-o)+E*t;for(let e=0;e<P;++e)$+=b[l+e]*T[u+e]}}}p[f*e+g*n+m*a+y*c+t]=$}}}return n.makeTensorInfo(d.shape,d.dtype,d.values)}},_i=v$(tu,e=>Math.cos(e)),_s={kernelName:tu,backendName:"cpu",kernelFunc:_i},_a=v$(tc,e=>Math.cosh(e)),_o={kernelName:tc,backendName:"cpu",kernelFunc:_a},_l={kernelName:tp,backendName:"cpu",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{image:i,boxes:s,boxInd:a}=t,{cropSize:o,method:l,extrapolationValue:u}=r,[c,h,d,p]=i.shape,f=s.shape[0],[g,m]=o,y=s0([f,g,m,p],"float32"),b=n.data.get(s.dataId).values,v=n.data.get(a.dataId).values,w=n.data.get(i.dataId).values,_=ef(i.shape),x=ef(y.shape);for(let e=0;e<f;e++){let t=4*e,n=b[t],r=b[t+1],i=b[t+2],s=b[t+3],a=v[e];if(a>=c)continue;let o=g>1?(i-n)*(h-1)/(g-1):0,f=m>1?(s-r)*(d-1)/(m-1):0;for(let t=0;t<g;t++){let c=g>1?n*(h-1)+t*o:.5*(n+i)*(h-1);if(c<0||c>h-1){for(let n=0;n<m;n++)for(let r=0;r<p;r++){let i=r+n*x[2]+t*x[1]+e*x[0];y.values[i]=u}continue}if("bilinear"===l){let n=Math.floor(c),i=Math.ceil(c),o=c-n;for(let l=0;l<m;l++){let c=m>1?r*(d-1)+l*f:.5*(r+s)*(d-1);if(c<0||c>d-1){for(let n=0;n<p;n++){let r=n+l*x[2]+t*x[1]+e*x[0];y.values[r]=u}continue}let h=Math.floor(c),g=Math.ceil(c),b=c-h;for(let r=0;r<p;r++){let s=r+h*_[2]+n*_[1]+a*_[0],u=w[s],c=w[s=r+g*_[2]+n*_[1]+a*_[0]],d=w[s=r+h*_[2]+i*_[1]+a*_[0]],p=w[s=r+g*_[2]+i*_[1]+a*_[0]],f=u+(c-u)*b,m=d+(p-d)*b;s=r+l*x[2]+t*x[1]+e*x[0],y.values[s]=f+(m-f)*o}}}else for(let n=0;n<m;++n){let i=m>1?r*(d-1)+n*f:.5*(r+s)*(d-1);if(i<0||i>d-1){for(let r=0;r<p;r++){let i=r+n*x[2]+t*x[1]+e*x[0];y.values[i]=u}continue}let o=Math.round(i),l=Math.round(c);for(let r=0;r<p;r++){let i=r+o*_[2]+l*_[1]+a*_[0],s=r+n*x[2]+t*x[1]+e*x[0];y.values[s]=w[i]}}}}return n.makeTensorInfo(y.shape,y.dtype,y.values)}},_u={kernelName:th,backendName:"cpu",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{axis:s,exclusive:a,reverse:o}=r;vC(i,"cumprod");let l=li([s],i.shape.length),u=i;null!=l&&(u=wf({inputs:{x:i},backend:n,attrs:{perm:l}}));let c=la(1,i.shape.length)[0];if(c!==u.shape.length-1)throw Error(`backend.cumprod in CPU expects an inner-most axis=${u.shape.length-1} but got axis=${c}`);let h=iw(u.dtype,"int32"),d=eb(q(u.shape),h),p=n.data.get(u.dataId).values,f=u.shape[u.shape.length-1],g=o?(e,t)=>e+f-t-1:(e,t)=>e+t;for(let e=0;e<p.length;e+=f)for(let t=0;t<f;t++){let n=g(e,t);if(0===t)d[n]=a?1:p[n];else{let r=g(e,t-1);d[n]=a?p[r]*d[r]:p[n]*d[r]}}let m=n.makeTensorInfo(u.shape,h,d);if(null!=l){let e=wf({inputs:{x:m},backend:n,attrs:{perm:ls(l)}});return n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(u),e}return m}},_c={kernelName:td,backendName:"cpu",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{axis:s,exclusive:a,reverse:o}=r;vC(i,"cumsum");let l=li([s],i.shape.length),u=i;null!=l&&(u=wf({inputs:{x:i},backend:n,attrs:{perm:l}}));let c=la(1,i.shape.length)[0];if(c!==u.shape.length-1)throw Error(`backend.cumsum in CPU expects an inner-most axis=${u.shape.length-1} but got axis=${c}`);let h=iw(u.dtype,"int32"),d=ev(q(u.shape),h),p=n.data.get(u.dataId).values,f=u.shape[u.shape.length-1],g=o?(e,t)=>e+f-t-1:(e,t)=>e+t;for(let e=0;e<p.length;e+=f)for(let t=0;t<f;t++){let n=g(e,t);if(0===t)d[n]=a?0:p[n];else{let r=g(e,t-1);d[n]=a?p[r]+d[r]:p[n]+d[r]}}let m=n.makeTensorInfo(u.shape,h,d);if(null!=l){let e=wf({inputs:{x:m},backend:n,attrs:{perm:ls(l)}});return n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(u),e}return m}},_h={kernelName:tf,backendName:"cpu",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{x:i,weights:s}=t,{size:a,binaryOutput:o}=r;if(1===i.shape.length){let e=wj(n.data.get(i.dataId).values,n.data.get(s.dataId).values,s.dtype,s.shape,a);return n.makeTensorInfo([a],s.dtype,e)}if(2===i.shape.length){let e=wG(n.bufferSync(i),n.bufferSync(s),a,o);return n.makeTensorInfo(e.shape,s.dtype,e.values)}throw Error(`Error in denseBincount: input must be at most rank 2, but got rank${i.shape.length}.`)}},_d={kernelName:tg,backendName:"cpu",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{blockSize:s,dataFormat:a}=r;j("NHWC"===a,()=>`Only NHWC dataFormat supported on CPU for depthToSpace. Got ${a}`);let o=i.shape[0],l=i.shape[1],u=i.shape[2],c=i.shape[3],h=l*s,d=u*s,p=c/(s*s),f=n.data.get(i.dataId).values,g=new Float32Array(o*h*d*p),m=0;for(let e=0;e<o;++e)for(let t=0;t<h;++t){let n=Math.floor(t/s),r=t%s;for(let t=0;t<d;++t){let i=Math.floor(t/s),a=t%s,o=(r*s+a)*p;for(let t=0;t<p;++t){let r=t+o+c*(i+u*(n+l*e));g[m++]=f[r]}}}return n.makeTensorInfo([o,h,d,p],i.dtype,g)}};function _p(e){let{inputs:t,backend:n,attrs:r}=e,{x:i,filter:s}=t,{strides:a,pad:o,dilations:l,dimRoundingMode:u}=r;vC([i,s],"depthwiseConv2DNative");let c=ef(i.shape),h=ef(s.shape),d=l;null==d&&(d=[1,1]),j(ob(a,d),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${a} and dilations '${d}'`);let p=oa(i.shape,s.shape,a,d,o,u,!0),{filterHeight:f,filterWidth:g,dilationHeight:m,dilationWidth:y,padInfo:b}=p,v=b.left,w=b.top,_=p.outChannels/p.inChannels,x=new il(p.outShape,i.dtype),T=n.data.get(i.dataId).values,I=n.data.get(s.dataId).values,k=x.values;for(let e=0;e<p.batchSize;++e){let t=e*c[0],n=e*x.strides[0];for(let e=0;e<p.outHeight;++e){let r=n+e*x.strides[1],i=e*p.strideHeight-w;for(let e=0;e<f;++e){let n=i+e*m;if(n<0||n>=p.inHeight)continue;let s=e*h[0],a=t+n*c[1];for(let e=0;e<p.outWidth;++e){let t=r+e*x.strides[2],n=e*p.strideWidth-v;for(let e=0;e<g;++e){let r=n+e*y;if(r<0||r>=p.inWidth)continue;let i=s+e*h[1],o=a+r*p.inChannels,l=t,u=i;for(let e=0;e<p.inChannels;++e){let t=T[o+e];for(let e=0;e<_;++e)k[l+e]+=t*I[u+e];l+=_,u+=_}}}}}}return n.makeTensorInfo(x.shape,x.dtype,x.values)}let _f={kernelName:tm,backendName:"cpu",kernelFunc:_p},_g={kernelName:ty,backendName:"cpu",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{x:i,dy:s}=t,{strides:a,dilations:o,pad:l,dimRoundingMode:u,filterShape:c}=r;vC([i,s],"depthwiseConv2dNativeBackpropFilter");let h=oa(i.shape,c,a,o,l,u,!0),{strideHeight:d,strideWidth:p,filterHeight:f,filterWidth:g}=h,m=new il(h.filterShape,"float32"),y=h.padInfo.left,b=h.padInfo.top,v=h.outChannels/h.inChannels,w=n.data.get(i.dataId).values,_=new il(i.shape,i.dtype,w),x=n.data.get(s.dataId).values,T=new il(s.shape,s.dtype,x);for(let e=0;e<f;++e){let t=Math.max(0,Math.ceil((b-e)/d)),n=Math.min(h.outHeight,(h.inHeight+b-e)/d);for(let r=0;r<g;++r){let i=Math.max(0,Math.ceil((y-r)/p)),s=Math.min(h.outWidth,(h.inWidth+y-r)/p);for(let a=0;a<h.outChannels;++a){let o=Math.trunc(a/v),l=a%v,u=0;for(let l=0;l<h.batchSize;++l)for(let c=t;c<n;++c){let t=e+c*d-b;for(let e=i;e<s;++e){let n=r+e*p-y;u+=_.get(l,t,n,o)*T.get(l,c,e,a)}}m.set(u,e,r,o,l)}}}return n.makeTensorInfo(m.shape,m.dtype,m.values)}},_m={kernelName:tb,backendName:"cpu",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{dy:i,filter:s}=t,{strides:a,dilations:o,pad:l,dimRoundingMode:u,inputShape:c}=r;vC([i,s],"depthwiseConv2DNativeBackpropInput");let h=ef(i.shape),d=ef(s.shape),p=oa(c,s.shape,a,o,l,u,!0),f=new il(p.inShape,"float32"),g=f.values,[m,y,b]=f.strides,v=n.data.get(i.dataId).values,[w,_,x]=h,T=n.data.get(s.dataId).values,[I,k,S]=d,{batchSize:E,filterHeight:C,filterWidth:A,inChannels:N,inHeight:O,inWidth:$,outChannels:R,outHeight:D,outWidth:F,strideHeight:P,strideWidth:M}=p,L=C-1-p.padInfo.top,z=A-1-p.padInfo.left,B=R/N;for(let e=0;e<E;++e)for(let t=0;t<N;++t)for(let n=0;n<O;++n){let r=n-L,i=Math.max(0,Math.ceil(r/P)),s=Math.min(D,(C+r)/P);for(let a=0;a<$;++a){let o=a-z,l=Math.max(0,Math.ceil(o/M)),u=Math.min(F,(A+o)/M),c=0;for(let n=i;n<s;++n){let i=n*P-r;for(let r=l;r<u;++r){let s=r*M-o,a=w*e+_*n+x*r,l=I*(C-1-i)+k*(A-1-s)+S*t;for(let e=0;e<B;++e)c+=v[a+(t*B+e)]*T[l+e]}}g[m*e+y*n+b*a+t]=c}}return n.makeTensorInfo(f.shape,f.dtype,f.values)}},_y={kernelName:tv,backendName:"cpu",kernelFunc:function(e){let{inputs:t,backend:n}=e,{x:r}=t,i=q(r.shape),s=n.data.get(r.dataId).values,a=s0([i,i],r.dtype),o=a.values;for(let e=0;e<s.length;e++)o[e*i+e]=s[e];let l=[...r.shape,...r.shape];return n.makeTensorInfo(l,a.dtype,a.values)}},_b={kernelName:tw,backendName:"cpu",kernelFunc:({inputs:e,backend:t,attrs:n})=>{let{x:r,filter:i}=e,{strides:s,pad:a,dilations:o}=n,l=t,u=l.data.get(r.dataId).values,c=r.shape.length,h=l.data.get(i.dataId).values,d=i.shape.length,{batchSize:p,inHeight:f,inWidth:g,inChannels:m,outHeight:y,outWidth:b,padInfo:v,strideHeight:w,strideWidth:_,filterHeight:x,filterWidth:T,dilationHeight:I,dilationWidth:k,outShape:S}=or(r.shape,i.shape,s,a,"NHWC",o),E=q(S),C=S.length,A=en(r.dtype,E);for(let e=0;e<p;++e)for(let t=0;t<y;++t){let n=t*w-v.top;for(let s=0;s<b;++s){let a=s*_-v.left;for(let o=0;o<m;++o){let l=Number.MIN_SAFE_INTEGER;for(let t=0;t<x;++t){let s=n+t*I;if(s>=0&&s<f)for(let n=0;n<T;++n){let p=a+n*k;if(p>=0&&p<g){let a=ex([e,s,p,o],c,ef(r.shape)),f=ex([t,n,o],d,ef(i.shape)),g=u[a]+h[f];g>l&&(l=g)}}}A[ex([e,t,s,o],C,ef(S))]=l}}}return{dataId:l.write(rQ(A,r.dtype),S,r.dtype),shape:S,dtype:r.dtype}}},_v={kernelName:tx,backendName:"cpu",kernelFunc:({inputs:e,backend:t,attrs:n})=>{let{x:r,filter:i,dy:s}=e,{strides:a,pad:o,dilations:l}=n,u=t,c=em(r.shape,u.data.get(r.dataId).values),h=em(i.shape,u.data.get(i.dataId).values),{batchSize:d,inHeight:p,inWidth:f,inChannels:g,outHeight:m,outWidth:y,padInfo:b,strideHeight:v,strideWidth:w,filterHeight:_,filterWidth:x,dilationHeight:T,dilationWidth:I,outShape:k}=or(r.shape,i.shape,a,o,"NHWC",l);j(s.rank===k.length,()=>`Error in ${tx}, dy must have the same rank as output ${k.length}, but got ${s.rank}`);let S=em(k,u.data.get(s.dataId).values),E=ew(i.shape,i.dtype);for(let e=0;e<d;++e)for(let t=0;t<m;++t){let n=t*v-b.top;for(let r=0;r<y;++r){let i=r*w-b.left;for(let s=0;s<g;++s){let a=Number.MIN_SAFE_INTEGER,o=0,l=0;for(let t=0;t<_;++t){let r=n+t*T;if(r>=0&&r<p)for(let n=0;n<x;++n){let u=i+n*I;if(u>=0&&u<f){let i=c[e][r][u][s]+h[t][n][s];i>a&&(a=i,o=t,l=n)}}}E[o][l][s]+=S[e][t][r][s]}}}return{dataId:u.write(rQ(E,r.dtype),i.shape,i.dtype),shape:i.shape,dtype:i.dtype}}},_w={kernelName:t_,backendName:"cpu",kernelFunc:({inputs:e,backend:t,attrs:n})=>{let{x:r,filter:i,dy:s}=e,{strides:a,pad:o,dilations:l}=n,u=t,c=em(r.shape,u.data.get(r.dataId).values),h=em(i.shape,u.data.get(i.dataId).values),{batchSize:d,inHeight:p,inWidth:f,inChannels:g,outHeight:m,outWidth:y,padInfo:b,strideHeight:v,strideWidth:w,filterHeight:_,filterWidth:x,dilationHeight:T,dilationWidth:I,outShape:k}=or(r.shape,i.shape,a,o,"NHWC",l);j(s.rank===k.length,()=>`Error in ${t_}, dy must have the same rank as output ${k.length}, but got ${s.rank}`);let S=em(k,u.data.get(s.dataId).values),E=ew(r.shape,r.dtype);for(let e=0;e<d;++e)for(let t=0;t<m;++t){let n=t*v-b.top;for(let r=0;r<y;++r){let i=r*w-b.left;for(let s=0;s<g;++s){let a=Number.MIN_SAFE_INTEGER,o=n<0?0:n,l=i<0?0:i;for(let t=0;t<_;++t){let r=n+t*T;if(r>=0&&r<p)for(let n=0;n<x;++n){let u=i+n*I;if(u>=0&&u<f){let i=c[e][r][u][s]+h[t][n][s];i>a&&(a=i,o=r,l=u)}}}E[e][o][l][s]+=S[e][t][r][s]}}}return{dataId:u.write(rQ(E,r.dtype),r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}},__={kernelName:tT,backendName:"cpu",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{image:i}=t,{canvas:s,options:a}=r,{contextOptions:o,imageOptions:l}=a||{},u=(null==l?void 0:l.alpha)||1,c=(null==o?void 0:o.contextType)||"2d";if("2d"!==c)throw Error(`Context type ${o.contextType} is not supported by the CPU backend.`);let h=s.getContext(c,(null==o?void 0:o.contextAttributes)||{});if(null==h)throw Error(`Could not get the context with ${c} type.`);let[d,p]=i.shape.slice(0,2),f=2===i.shape.length?1:i.shape[2],g=n.data.get(i.dataId).values,m="float32"===i.dtype?255:1,y=new Uint8ClampedArray(p*d*4);for(let e=0;e<d*p;++e){let t=[0,0,0,255*u];for(let n=0;n<f;n++){let r=g[e*f+n];if("float32"===i.dtype){if(r<0||r>1)throw Error(`Tensor values for a float32 Tensor must be in the range [0 - 1] but encountered ${r}.`)}else if("int32"===i.dtype&&(r<0||r>255))throw Error(`Tensor values for a int32 Tensor must be in the range [0 - 255] but encountered ${r}.`);1===f?(t[0]=r*m,t[1]=r*m,t[2]=r*m):t[n]=r*m}let n=4*e;y[n+0]=Math.round(t[0]),y[n+1]=Math.round(t[1]),y[n+2]=Math.round(t[2]),y[n+3]=Math.round(t[3])}s.width=p,s.height=d;let b=new ImageData(y,p,d);return h.putImageData(b,0,0),i}},_x=vB((e,t)=>e*t),_T=v5(nc,_x,v8((e,t,n,r)=>({real:e*n-t*r,imag:e*r+t*n}))),_I={kernelName:nc,backendName:"cpu",kernelFunc:_T};function _k(e){let t;let{inputs:n,backend:r,attrs:i}=e,{x:s}=n,{axis:a,keepDims:o}=i;vC(s,"sum");let l=(t="bool"===s.dtype?v4({inputs:{x:s},backend:r,attrs:{dtype:"int32"}}):vP({inputs:{x:s},backend:r})).shape.length,u=Z(a,t.shape),c=li(u,l),h=u,d=t;null!=c&&(d=wf({inputs:{x:t},backend:r,attrs:{perm:c}}),h=la(h.length,l)),lr("sum",h,d.shape.length);let[p,f]=lt(d.shape,h),g=v0(r,p,iw(d.dtype,"int32")),m=q(f),y=r.data.get(g.dataId).values,b=r.data.get(d.dataId).values;for(let e=0;e<y.length;++e){let t=e*m,n=0;for(let e=0;e<m;++e)n+=b[t+e];y[e]=n}if(o){let e=ln(g.shape,u),t=g;g=wt({inputs:{x:g},backend:r,attrs:{shape:e}}),r.disposeIntermediateTensorInfo(t)}return r.disposeIntermediateTensorInfo(t),null!=c&&r.disposeIntermediateTensorInfo(d),g}let _S={kernelName:nQ,backendName:"cpu",kernelFunc:_k},_E={kernelName:tk,backendName:"cpu",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{equation:i}=r,s=t,{allDims:a,summedDims:o,idDims:l}=cS(i,s.length);cC(a.length,l,s);let{path:u,steps:c}=cA(o,l),h=c.length,d=null,p=a.length,f=[];for(let e=0;e<h;++e){for(let t of c[e]){let e;let{permutationIndices:r,expandDims:i}=cE(p,l[t]);cN(r)?e=s[t]:(e=wf({inputs:{x:s[t]},backend:n,attrs:{perm:r}}),f.push(e));let a=e.shape.slice();for(let e=0;e<i.length;++e)a.splice(i[e],0,1);H(e.shape,a)||(e=wt({inputs:{x:e},backend:n,attrs:{shape:a}}),f.push(e)),null===d?d=e:(d=_T({inputs:{a:e,b:d},backend:n}),f.push(d))}e<h-1&&(u[e]>=0&&(d=_k({inputs:{x:d},backend:n,attrs:{axis:u[e]-(a.length-p),keepDims:!1}}),f.push(d)),p--)}for(let e of f)e!==d&&n.disposeIntermediateTensorInfo(e);return d}},_C={kernelName:tE,backendName:"cpu",kernelFunc:function(e){let{inputs:t,backend:n}=e,{dy:r,y:i}=t;vC([r,i],"eluGrad");let s=new Float32Array(q(i.shape)),a=n.data.get(i.dataId).values,o=n.data.get(r.dataId).values;for(let e=0;e<a.length;++e){let t=a[e];t>=0?s[e]=o[e]:s[e]=o[e]*(t+1)}return n.makeTensorInfo(i.shape,"float32",s)}},_A=vB((e,t)=>e===t?1:0),_N=v5(tA,_A,null,"bool"),_O={kernelName:tA,backendName:"cpu",kernelFunc:_N},_$=cl,_R=cu,_D=cc,_F=ch,_P=cd,_M=cp,_L=v$(tC,e=>{let t=Math.sign(e),n=Math.abs(e),r=1/(1+_$*n);return t*(1-((((_M*r+_P)*r+_F)*r+_D)*r+_R)*r*Math.exp(-n*n))}),_z={kernelName:tC,backendName:"cpu",kernelFunc:_L},_B=vO(e=>Math.exp(e)),_U=vR(tN,_B,"float32"),_V={kernelName:tN,backendName:"cpu",kernelFunc:_U};function _j(e){let{inputs:t,backend:n,attrs:r}=e,{input:i}=t,{dim:s}=r,a=i.shape.length,o=i.shape.slice(),l=s;return s<0&&(j(-(a+1)<=s,()=>`Axis must be in the interval [${-(a+1)}, ${a}]`),l=a+s+1),o.splice(l,0,1),wt({inputs:{x:i},backend:n,attrs:{shape:o}})}let _G={kernelName:tO,backendName:"cpu",kernelFunc:_j},_W=vO(e=>Math.expm1(e)),_q=vR(t$,_W),_H={kernelName:t$,backendName:"cpu",kernelFunc:_q},_K=v5(tI,vB((e,t)=>e/t)),_X={kernelName:tI,backendName:"cpu",kernelFunc:_K},_Y=vB((e,t)=>e-t),_Q=v5(rr,_Y,v8((e,t,n,r)=>({real:e-n,imag:t-r}))),_J={kernelName:rr,backendName:"cpu",kernelFunc:_Q};function _Z(e,t,n){let r=e.shape,i=r[0],s=r[1],a=n.data.get(e.dataId),o=a.complexTensorInfos.real,l=a.complexTensorInfos.imag,u=[i,s],c=q(u),h=et("float32",c),d=et("float32",c);for(let e=0;e<i;e++){let r=wB({inputs:{x:o},backend:n,attrs:{begin:[e,0],size:[1,s]}}),i=wB({inputs:{x:l},backend:n,attrs:{begin:[e,0],size:[1,s]}}),a=vJ({inputs:{real:r,imag:i},backend:n}),{real:u,imag:c}=_0(a,t,n),p=cf(u,c);for(let t=0;t<s;t++){let n=cb(p,t);h[e*s+t]=n.real,d[e*s+t]=n.imag}n.disposeIntermediateTensorInfo(r),n.disposeIntermediateTensorInfo(i),n.disposeIntermediateTensorInfo(a)}let p=n.makeTensorInfo(u,"float32",h),f=n.makeTensorInfo(u,"float32",d),g=vJ({inputs:{real:p,imag:f},backend:n});return n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(f),g}function _0(e,t,n){let r=q(e.shape),i=n.data.get(e.dataId),s=n.data.get(i.complexTensorInfos.real.dataId).values,a=n.data.get(i.complexTensorInfos.imag.dataId).values;if(!_1(r))return cg(_3(cf(s,a),r,t));{let i=_2(s,a,r,t,n),o=[e.shape[0],e.shape[1]];if(t){let e=n.makeTensorInfo(o,"float32",i.real),t=n.makeTensorInfo(o,"float32",i.imag),s=n.makeTensorInfo([],"float32",rX(r,"float32")),a=vP({inputs:{x:s},backend:n}),l=_X.kernelFunc({inputs:{a:e,b:s},backend:n}),u=_X.kernelFunc({inputs:{a:t,b:a},backend:n}),c=n.data.get(l.dataId).values,h=n.data.get(u.dataId).values;return n.disposeIntermediateTensorInfo(e),n.disposeIntermediateTensorInfo(t),n.disposeIntermediateTensorInfo(s),n.disposeIntermediateTensorInfo(a),n.disposeIntermediateTensorInfo(l),n.disposeIntermediateTensorInfo(u),{real:c,imag:h}}return i}}function _1(e){return(e&e-1)==0}function _2(e,t,n,r,i){if(1===n)return{real:e,imag:t};let s=cf(e,t),a=n/2,o=cm(s),l=o.real,u=o.imag,c=[l.length],h=i.makeTensorInfo(c,"float32",l),d=i.makeTensorInfo(c,"float32",u),p=vJ({inputs:{real:h,imag:d},backend:i}),f=cy(s),g=f.real,m=f.imag,y=[g.length],b=i.makeTensorInfo(y,"float32",g),v=i.makeTensorInfo(y,"float32",m),w=vJ({inputs:{real:b,imag:v},backend:i}),_=_2(l,u,a,r,i),x=_.real,T=_.imag,I=[x.length],k=i.makeTensorInfo(I,"float32",x),S=i.makeTensorInfo(I,"float32",T),E=vJ({inputs:{real:k,imag:S},backend:i}),C=_2(g,m,a,r,i),A=C.real,N=C.imag,O=[A.length],$=i.makeTensorInfo(O,"float32",A),R=i.makeTensorInfo(O,"float32",N),D=vJ({inputs:{real:$,imag:R},backend:i}),F=cw(n,r),P=[F.real.length],M=i.makeTensorInfo(P,"float32",F.real),L=i.makeTensorInfo(P,"float32",F.imag),z=vJ({inputs:{real:M,imag:L},backend:i}),B=_T({inputs:{a:z,b:D},backend:i}),U=v9({inputs:{a:E,b:B},backend:i}),V=_Q({inputs:{a:E,b:B},backend:i}),j=v1({inputs:{input:U},backend:i}),G=v1({inputs:{input:V},backend:i}),W=w3({inputs:{input:U},backend:i}),q=w3({inputs:{input:V},backend:i}),H=w6({inputs:[j,G],backend:i,attrs:{axis:0}}),K=w6({inputs:[W,q],backend:i,attrs:{axis:0}}),X=i.data.get(H.dataId).values,Y=i.data.get(K.dataId).values;return i.disposeIntermediateTensorInfo(h),i.disposeIntermediateTensorInfo(d),i.disposeIntermediateTensorInfo(p),i.disposeIntermediateTensorInfo(b),i.disposeIntermediateTensorInfo(v),i.disposeIntermediateTensorInfo(w),i.disposeIntermediateTensorInfo(k),i.disposeIntermediateTensorInfo(S),i.disposeIntermediateTensorInfo(E),i.disposeIntermediateTensorInfo($),i.disposeIntermediateTensorInfo(R),i.disposeIntermediateTensorInfo(D),i.disposeIntermediateTensorInfo(M),i.disposeIntermediateTensorInfo(L),i.disposeIntermediateTensorInfo(z),i.disposeIntermediateTensorInfo(B),i.disposeIntermediateTensorInfo(U),i.disposeIntermediateTensorInfo(V),i.disposeIntermediateTensorInfo(j),i.disposeIntermediateTensorInfo(W),i.disposeIntermediateTensorInfo(G),i.disposeIntermediateTensorInfo(q),i.disposeIntermediateTensorInfo(H),i.disposeIntermediateTensorInfo(K),{real:X,imag:Y}}function _3(e,t,n){let r=new Float32Array(2*t);for(let i=0;i<t;i++){let s=0,a=0;for(let r=0;r<t;r++){let o=c_(i*r,t,n),l=cb(e,r);s+=l.real*o.real-l.imag*o.imag,a+=l.real*o.imag+l.imag*o.real}n&&(s/=t,a/=t),cv(r,s,a,i)}return r}let _4={kernelName:tR,backendName:"cpu",kernelFunc:function(e){let{inputs:t,backend:n}=e,{input:r}=t,i=q(r.shape),s=r.shape[r.shape.length-1],a=wt({inputs:{x:r},backend:n,attrs:{shape:[i/s,s]}}),o=_Z(a,!1,n),l=wt({inputs:{x:o},backend:n,attrs:{shape:r.shape}});return n.disposeIntermediateTensorInfo(a),n.disposeIntermediateTensorInfo(o),l}};function _6(e){let{backend:t,attrs:n}=e,{shape:r,value:i,dtype:s}=n,a=s||eh(i),o=en(a,q(r));return _8(o,i,a),t.makeTensorInfo(r,a,o)}let _5={kernelName:tD,backendName:"cpu",kernelFunc:_6};function _8(e,t,n){e.fill(t)}let _7={kernelName:tF,backendName:"cpu",kernelFunc:({inputs:e,attrs:t,backend:n})=>{let{image:r}=e,i=n,s=et(r.dtype,q(r.shape)),[a,o,l,u]=r.shape,c=i.data.get(r.dataId).values;for(let e=0;e<a;e++){let t=e*l*o*u;for(let e=0;e<o;e++){let n=l*u*e;for(let e=0;e<l;e++){let r=e*u;for(let i=0;i<u;i++){let a=Math.round(l-e-1),o=t+n+r+i,h=c[o];a>=0&&a<l&&(h=c[t+n+a*u+i]),s[o]=h}}}}return{dataId:i.write(s,r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}},_9=vO(e=>Math.floor(e)),xe=vR(tP,_9),xt={kernelName:tP,backendName:"cpu",kernelFunc:xe},xn=v5(tM,vB((e,t)=>Math.floor(e/t)),null,"int32"),xr={kernelName:tM,backendName:"cpu",kernelFunc:xn},xi={kernelName:rb,backendName:"cpu",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{x:i,filter:s,bias:a,preluActivationWeights:o}=t,{strides:l,pad:u,dataFormat:c,dilations:h,dimRoundingMode:d,activation:p,leakyreluAlpha:f}=r,g=w8({inputs:{x:i,filter:s},backend:n,attrs:{strides:l,pad:u,dataFormat:c,dilations:h,dimRoundingMode:d}});if(a){let e=g;if("NCHW"===c&&1===a.shape.length&&1!==a.shape[0]){let e=wt({inputs:{x:a},backend:n,attrs:{shape:[a.shape[0],1,1]}});g=v9({inputs:{a:g,b:e},backend:n}),n.disposeIntermediateTensorInfo(e)}else g=v9({inputs:{a:g,b:a},backend:n});n.disposeIntermediateTensorInfo(e)}if(p){let e=g;if("NCHW"===c&&"prelu"===p&&1===o.shape.length&&1!==o.shape[0]){let e=wt({inputs:{x:o},backend:n,attrs:{shape:[o.shape[0],1,1]}});g=vQ(n,g,p,e,f),n.disposeIntermediateTensorInfo(e)}else g=vQ(n,g,p,o,f);n.disposeIntermediateTensorInfo(e)}return g}},xs={kernelName:rv,backendName:"cpu",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{x:i,filter:s,bias:a,preluActivationWeights:o}=t,{strides:l,pad:u,dataFormat:c,dilations:h,dimRoundingMode:d,activation:p,leakyreluAlpha:f}=r,g=_p({inputs:{x:i,filter:s},backend:n,attrs:{strides:l,pad:u,dataFormat:c,dilations:h,dimRoundingMode:d}});if(a){let e=g;g=v9({inputs:{a:g,b:a},backend:n}),n.disposeIntermediateTensorInfo(e)}if(p){let e=g;g=vQ(n,g,p,o,f),n.disposeIntermediateTensorInfo(e)}return g}};function xa(e,t,n,r,i,s,a,o,l){let u=s0([r,s],n);for(let n=0;n<r;n++){let r=[],c=0;for(let t=0;t<i;t++){let s=e[n*i+t];c+=s*a[t],r.push(s)}if(c<0||c>=l/s)throw Error(`Invalid indices: ${r} does not index into ${o}`);for(let e=0;e<s;e++)u.values[n*s+e]=t.get(...t.indexToLoc(c*s+e))}return u}let xo={kernelName:tB,backendName:"cpu",kernelFunc:function(e){let{inputs:t,backend:n}=e,{params:r,indices:i}=t,s=q(r.shape),a=i.shape,o=a[a.length-1],[l,u,c,h]=cn(r,i);if(0===u)return n.makeTensorInfo(l,r.dtype,[]);let d=xa(n.data.get(i.dataId).values,n.bufferSync(r),r.dtype,u,o,c,h,r.shape,s);return n.makeTensorInfo(l,r.dtype,d.values)}};function xl(e,t,n){let r=s0(n,e.dtype);for(let n=0;n<r.size;++n){let i=r.indexToLoc(n).slice(),s=i[0],a=i[2],o=t.locToIndex([s,a]);i[2]=t.values[o];let l=e.locToIndex(i);0<=l&&l<e.values.length&&(r.values[n]=e.values[l])}return r}let xu={kernelName:tz,backendName:"cpu",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{x:i,indices:s}=t,{axis:a,batchDims:o}=r;vC([i,s],"gatherV2");let l=Z(a,i.shape)[0],u=n.data.get(s.dataId).values,c=i.shape[l];for(let e=0;e<u.length;++e){let t=u[e];j(t<=c-1&&t>=0,()=>`GatherV2: the index value ${t} is not in [0, ${c-1}]`)}let h=o;null==o&&(h=0);let d=q(s.shape),p=cH(i,s,l,h),f=wt({inputs:{x:i},backend:n,attrs:{shape:[p.batchSize,p.outerSize,p.dimSize,p.sliceSize]}}),g=wt({inputs:{x:s},backend:n,attrs:{shape:[p.batchSize,d/p.batchSize]}}),m=[p.batchSize,p.outerSize,d/p.batchSize,p.sliceSize],y=n.bufferSync(g),b=xl(n.bufferSync(f),y,m);return n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(g),n.makeTensorInfo(p.outputShape,b.dtype,b.values)}},xc=vB((e,t)=>e>t?1:0),xh=v5(tU,xc,null,"bool"),xd={kernelName:tU,backendName:"cpu",kernelFunc:xh},xp=vB((e,t)=>e>=t?1:0),xf=v5(tV,xp,null,"bool"),xg={kernelName:tV,backendName:"cpu",kernelFunc:xf},xm={kernelName:tG,backendName:"cpu",kernelFunc:function(e){let{inputs:t,backend:n}=e,{input:r}=t,i=q(r.shape),s=r.shape[r.shape.length-1],a=wt({inputs:{x:r},backend:n,attrs:{shape:[i/s,s]}}),o=_Z(a,!0,n),l=wt({inputs:{x:o},backend:n,attrs:{shape:r.shape}});return n.disposeIntermediateTensorInfo(a),n.disposeIntermediateTensorInfo(o),l}},xy=v$(tq,e=>Number.isFinite(e)?1:0,"bool"),xb={kernelName:tq,backendName:"cpu",kernelFunc:xy},xv=v$(tH,e=>Math.abs(e)===1/0?1:0,"bool"),xw={kernelName:tH,backendName:"cpu",kernelFunc:xv},x_=v$(tK,e=>Number.isNaN(e)?1:0,"bool"),xx={kernelName:tK,backendName:"cpu",kernelFunc:x_},xT=vB((e,t)=>e<t?1:0),xI=v5(tY,xT,null,"bool"),xk={kernelName:tY,backendName:"cpu",kernelFunc:xI},xS=vB((e,t)=>e<=t?1:0),xE=v5(tQ,xS,null,"bool"),xC={kernelName:tQ,backendName:"cpu",kernelFunc:xE};function xA(e,t,n){let r=(t-e)/(n-1),i=ev(n,"float32");i[0]=e;for(let e=1;e<i.length;e++)i[e]=i[e-1]+r;return i}let xN={kernelName:tJ,backendName:"cpu",kernelFunc:function(e){let{backend:t,attrs:n}=e,{start:r,stop:i,num:s}=n,a=xA(r,i,s);return t.makeTensorInfo([a.length],"float32",a)}},xO=vO(e=>Math.log(e)),x$=vR(tZ,xO),xR={kernelName:tZ,backendName:"cpu",kernelFunc:x$},xD=v$(t0,e=>Math.log1p(e)),xF={kernelName:t0,backendName:"cpu",kernelFunc:xD},xP=v5(t1,vB((e,t)=>e&&t),null,"bool"),xM={kernelName:t1,backendName:"cpu",kernelFunc:xP},xL=v$(t2,e=>e?0:1,"bool"),xz={kernelName:t2,backendName:"cpu",kernelFunc:xL},xB=v5(t3,vB((e,t)=>e||t),null,"bool"),xU={kernelName:t3,backendName:"cpu",kernelFunc:xB},xV={kernelName:t6,backendName:"cpu",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{depthRadius:s,bias:a,alpha:o,beta:l}=r;vC(i,"LRN");let u=i.shape[3],c=u-1,h=n.data.get(i.dataId).values,d=q(i.shape),p=new Float32Array(d);function f(e){let t=e%u,n=e-t+Math.max(0,t-s),r=e-t+Math.min(t+s,c),i=0;for(;n<=r;n++){let e=h[n];i+=e*e}return i}for(let e=0;e<d;e++){let t=f(e),n=h[e]*Math.pow(a+o*t,-l);p[e]=n}return n.makeTensorInfo(i.shape,i.dtype,p)}},xj={kernelName:t5,backendName:"cpu",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{x:i,y:s,dy:a}=t,{depthRadius:o,bias:l,alpha:u,beta:c}=r;vC(a,"LRNGrad");let h=q(a.shape),d=a.shape[3],p=n.data.get(a.dataId).values,f=n.data.get(i.dataId).values,g=n.data.get(s.dataId).values,m=new Float32Array(h),y=h;for(let e=0;e<y;e++){let t=e%d,n=e-t+Math.max(0,t-o),r=e-t+Math.min(d,t+o+1),i=0;for(let e=n;e<r;e++)i+=Math.pow(f[e],2);i=u*i+l;for(let t=n;t<r;t++){let n=-2*u*c*f[t]*g[e]/i;e===t&&(n+=Math.pow(i,-c)),n*=p[e],m[t]+=n}}return n.makeTensorInfo(a.shape,i.dtype,m)}};function xG(e,t,n,r){let i=et(r,q(n));for(let n=0;n<i.length;++n){let r=n*t,s=e[r];for(let n=0;n<t;++n){let t=e[r+n];(Number.isNaN(t)||t>s)&&(s=t)}i[n]=s}return i}function xW(e){let{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{reductionIndices:s,keepDims:a}=r,o=n,l=i.shape,u=l.length,c=Z(s,l),h=c,d=li(h,u),p=o.data.get(i.dataId).values;if(null!=d){let e=Array(u);for(let t=0;t<e.length;t++)e[t]=l[d[t]];p=wp(p,l,i.dtype,d,e),h=la(h.length,u),l=e}vC(i,"max"),lr("max",h,u);let[f,g]=lt(l,h),m=xG(p,q(g),f,i.dtype),y=o.write(m,f,i.dtype),b=f;return a&&(b=ln(f,c)),{dataId:y,shape:b,dtype:i.dtype}}let xq={kernelName:t8,backendName:"cpu",kernelFunc:xW},xH=vB((e,t)=>Math.max(e,t)),xK=v5(t7,xH),xX={kernelName:t7,backendName:"cpu",kernelFunc:xK},xY={kernelName:t9,backendName:"cpu",kernelFunc:function(e){let t;let{inputs:n,backend:r,attrs:i}=e,{x:s}=n;vC(s,"maxPool");let{filterSize:a,strides:o,pad:l,dimRoundingMode:u}=i,c=1;j(ob(o,1),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${o} and dilations '${c}'`);let h=oi(s.shape,a,o,c,l,u);if(1===h.filterWidth&&1===h.filterHeight&&H(h.inShape,h.outShape))t=vP({inputs:{x:s},backend:r});else{let e=r.data.get(s.dataId).values,n=ef(s.shape),i=wN(e,s.shape,s.dtype,n,h,"max");t=r.makeTensorInfo(h.outShape,s.dtype,i.values)}return t}},xQ={kernelName:nt,backendName:"cpu",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{filterSize:s,strides:a,pad:o,dimRoundingMode:l,dataFormat:u}=r;vC(i,"maxPool3d");let c=os(i.shape,s,a,1,o,l,u),h=w$(n.data.get(i.dataId).values,i.shape,i.dtype,ef(i.shape),c,"max");return n.makeTensorInfo(h.shape,"float32",h.values)}},xJ={kernelName:nn,backendName:"cpu",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{dy:i,input:s}=t,{filterSize:a,strides:o,pad:l,dimRoundingMode:u}=r;vC([i,s],"maxPool3DGrad");let c=os(s.shape,a,o,1,l,u),h=wR(n.bufferSync(s),c),d=c.strideDepth,p=c.strideHeight,f=c.strideWidth,g=c.dilationDepth,m=c.dilationHeight,y=c.dilationWidth,b=c.effectiveFilterDepth,v=c.effectiveFilterHeight,w=c.effectiveFilterWidth,_=b-1-c.padInfo.front,x=w-1-c.padInfo.left,T=v-1-c.padInfo.top,I=s0(s.shape,"float32"),k=n.bufferSync(i);for(let e=0;e<c.batchSize;++e)for(let t=0;t<c.inChannels;++t)for(let n=0;n<c.inDepth;++n)for(let r=0;r<c.inHeight;++r)for(let i=0;i<c.inWidth;++i){let s=n-_,a=r-T,o=i-x,l=0;for(let n=0;n<b;n+=g){let r=(s+n)/d;if(!(r<0)&&!(r>=c.outDepth)&&Math.floor(r)===r)for(let i=0;i<v;i+=m){let s=(a+i)/p;if(!(s<0)&&!(s>=c.outHeight)&&Math.floor(s)===s)for(let a=0;a<w;a+=y){let u=(o+a)/f;if(u<0||u>=c.outWidth||Math.floor(u)!==u)continue;let d=b*v*w-1-h.get(e,r,s,u,t)===n*v*w+i*w+a?1:0;0!==d&&(l+=k.get(e,r,s,u,t)*d)}}}I.set(l,e,n,r,i,t)}return n.makeTensorInfo(I.shape,I.dtype,I.values)}},xZ={kernelName:ne,backendName:"cpu",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{dy:i,input:s,output:a}=t,o=s;vC([s,a],"maxPoolGrad");let{filterSize:l,strides:u,pad:c,dimRoundingMode:h}=r,d=oi(o.shape,l,u,1,c,h),p=n.data.get(o.dataId).values,f=s0(d.outShape,o.dtype,wO(p,o.shape,o.dtype,d).values),g=d.strideHeight,m=d.strideWidth,y=d.dilationHeight,b=d.dilationWidth,v=d.effectiveFilterHeight,w=d.effectiveFilterWidth,_=w-1-d.padInfo.left,x=v-1-d.padInfo.top,T=s0(o.shape,"float32"),I=n.data.get(i.dataId).values,k=s0(i.shape,"float32",I);for(let e=0;e<d.batchSize;++e)for(let t=0;t<d.inChannels;++t)for(let n=0;n<d.inHeight;++n)for(let r=0;r<d.inWidth;++r){let i=n-x,s=r-_,a=0;for(let n=0;n<v;n+=y){let r=(i+n)/g;if(!(r<0)&&!(r>=d.outHeight)&&Math.floor(r)===r)for(let i=0;i<w;i+=b){let o=(s+i)/m;if(o<0||o>=d.outWidth||Math.floor(o)!==o)continue;let l=v*w-1-f.get(e,r,o,t)===n*w+i?1:0;0!==l&&(a+=k.get(e,r,o,t)*l)}}T.set(a,e,n,r,t)}return n.makeTensorInfo(T.shape,T.dtype,T.values)}};function x0(e,t,n,r,i){let s=ef(t),a=wN(e,t,n,s,i,"max"),o=wO(e,t,n,i,!0,r);return[a.values,o.values]}let x1={kernelName:nr,backendName:"cpu",kernelFunc:({inputs:e,attrs:t,backend:n})=>{let{x:r}=e,{filterSize:i,strides:s,pad:a,includeBatchInIndex:o}=t,l=n;vC(r,"MaxPoolWithArgmax");let u=l.data.get(r.dataId).values,c=oi(r.shape,i,s,[1,1],a),[h,d]=x0(u,r.shape,r.dtype,o,c),p=l.write(h,c.outShape,r.dtype),f=l.write(d,c.outShape,r.dtype);return[{dataId:p,shape:c.outShape,dtype:r.dtype},{dataId:f,shape:c.outShape,dtype:"int32"}]}},x2={kernelName:ni,backendName:"cpu",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{axis:s,keepDims:a}=r,o=Z(s,i.shape),l=q(lt(i.shape,o)[1]),u=[],c=n.makeTensorInfo([],"float32",new Float32Array([l]));u.push(c);let h=v4({inputs:{x:i},backend:n,attrs:{dtype:"float32"}});u.push(h);let d=_K({inputs:{a:h,b:c},backend:n});u.push(d);let p=_k({inputs:{x:d},backend:n,attrs:{axis:s,keepDims:a}});return u.forEach(e=>n.disposeIntermediateTensorInfo(e)),p}},x3={kernelName:ns,backendName:"cpu",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{axis:s,keepDims:a}=r;vC(i,"min");let o=Z(s,i.shape),l=o,u=li(l,i.shape.length),c=i;null!=u&&(c=wf({inputs:{x:i},backend:n,attrs:{perm:u}}),l=la(l.length,i.shape.length)),lr("min",l,c.shape.length);let[h,d]=lt(c.shape,l),p=q(d),f=ev(q(h),c.dtype),g=n.data.get(c.dataId).values;for(let e=0;e<f.length;++e){let t=e*p,n=g[t];for(let e=0;e<p;++e){let r=g[t+e];(Number.isNaN(r)||r<n)&&(n=r)}f[e]=n}null!=u&&n.disposeIntermediateTensorInfo(c);let m=n.makeTensorInfo(h,c.dtype,f);if(a){let e=wt({inputs:{x:m},backend:n,attrs:{shape:ln(h,o)}});return n.disposeIntermediateTensorInfo(m),e}return m}},x4=vB((e,t)=>Math.min(e,t)),x6=v5(na,x4),x5={kernelName:na,backendName:"cpu",kernelFunc:x6},x8={kernelName:no,backendName:"cpu",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{paddings:s,mode:a}=r;vC(i,"mirrorPad");let o=s.map((e,t)=>e[0]+i.shape[t]+e[1]),l=s.map(e=>e[0]),u=s.map((e,t)=>e[0]+i.shape[t]),c="reflect"===a?0:1,h=n.data.get(i.dataId).values,d=i.shape.length,p=ef(i.shape),f=q(o),g=o.length,m=ef(o),y=et(i.dtype,f);for(let e=0;e<f;e++){let t=eT(e,g,m);for(let e=0;e<g;e++)t[e]<l[e]?t[e]=2*l[e]-t[e]-c:t[e]>=u[e]&&(t[e]=(u[e]-1)*2-t[e]+c);let n=ex(t=t.map((e,t)=>e-l[t]),d,p);y[e]=h[n]}return{dataId:n.write(y,o,i.dtype),shape:o,dtype:i.dtype}}},x7=v5(nl,vB((e,t)=>{let n=e%t;return e<0&&t<0||e>=0&&t>=0?n:(n+t)%t})),x9={kernelName:nl,backendName:"cpu",kernelFunc:x7};function Te(e){let{inputs:t,backend:n,attrs:r}=e,{logits:i}=t,{dim:s}=r,a=i.shape.length,o=s;if(-1===o&&(o=a-1),o!==a-1)throw Error(`Softmax along a non-last dimension is not yet supported. Logits was rank ${a} and dim was ${o}`);let l=Z([o],i.shape),u=xW({inputs:{x:i},backend:n,attrs:{reductionIndices:l,keepDims:!1}}),c=ln(u.shape,l),h=wt({inputs:{x:u},backend:n,attrs:{shape:c}}),d=_Q({inputs:{a:i,b:h},backend:n}),p=_U({inputs:{x:d},backend:n}),f=_k({inputs:{x:p},backend:n,attrs:{axis:l,keepDims:!1}}),g=wt({inputs:{x:f},backend:n,attrs:{shape:c}}),m=_K({inputs:{a:p,b:g},backend:n});return n.disposeIntermediateTensorInfo(u),n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(g),m}let Tt={kernelName:n0,backendName:"cpu",kernelFunc:Te},Tn={kernelName:nu,backendName:"cpu",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{logits:i}=t,{numSamples:s,seed:a,normalized:o}=r;vC(i,"multinomial");let l=o?i:Te({inputs:{logits:i},backend:n,attrs:{dim:-1}}),u=l.shape[0],c=l.shape[1],h=n.data.get(l.dataId).values,d=[u,s],p=ev(q(d),"int32");for(let e=0;e<u;++e){let t=e*c,n=new Float32Array(c-1);n[0]=h[t];for(let e=1;e<n.length;++e)n[e]=n[e-1]+h[t+e];let r=lI.alea(a.toString()),i=e*s;for(let e=0;e<s;++e){let t=r();p[i+e]=n.length;for(let r=0;r<n.length;r++)if(t<n[r]){p[i+e]=r;break}}}return o||n.disposeIntermediateTensorInfo(l),n.makeTensorInfo(d,"int32",p)}};function Tr(e,t,n){return _x([],t,rX(-1,n),e,n)}let Ti={kernelName:nh,backendName:"cpu",kernelFunc:function(e){let{inputs:t,backend:n}=e,{x:r}=t;vC(r,"neg");let[i,s]=Tr(n.data.get(r.dataId).values,r.shape,r.dtype);return n.makeTensorInfo(s,r.dtype,i)}},Ts=uw,Ta={kernelName:np,backendName:"cpu",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{boxes:i,scores:s}=t,{maxOutputSize:a,iouThreshold:o,scoreThreshold:l}=r;vC(i,"NonMaxSuppression");let{selectedIndices:u}=Ts(n.data.get(i.dataId).values,n.data.get(s.dataId).values,a,o,l);return n.makeTensorInfo([u.length],"int32",new Int32Array(u))}},To=u_,Tl={kernelName:nf,backendName:"cpu",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{boxes:i,scores:s}=t,{maxOutputSize:a,iouThreshold:o,scoreThreshold:l,padToMaxOutputSize:u}=r;vC(i,"NonMaxSuppressionPadded");let{selectedIndices:c,validOutputs:h}=To(n.data.get(i.dataId).values,n.data.get(s.dataId).values,a,o,l,u);return[n.makeTensorInfo([c.length],"int32",new Int32Array(c)),n.makeTensorInfo([],"int32",new Int32Array([h]))]}},Tu=ux,Tc={kernelName:ng,backendName:"cpu",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{boxes:i,scores:s}=t,{maxOutputSize:a,iouThreshold:o,scoreThreshold:l,softNmsSigma:u}=r;vC(i,"NonMaxSuppressionWithScore");let{selectedIndices:c,selectedScores:h}=Tu(n.data.get(i.dataId).values,n.data.get(s.dataId).values,a,o,l,u);return[n.makeTensorInfo([c.length],"int32",new Int32Array(c)),n.makeTensorInfo([h.length],"float32",new Float32Array(h))]}},Th=vB((e,t)=>e!==t?1:0),Td=v5(nd,Th,null,"bool"),Tp={kernelName:nd,backendName:"cpu",kernelFunc:Td},Tf={kernelName:ny,backendName:"cpu",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{indices:i}=t,{dtype:s,depth:a,onValue:o,offValue:l}=r;vC(i,"oneHot");let u=q(i.shape),c=new Float32Array(u*a);c.fill(l);let h=n.data.get(i.dataId).values;for(let e=0;e<u;++e)h[e]>=0&&h[e]<a&&(c[e*a+h[e]]=o);return n.makeTensorInfo([...i.shape,a],s,c)}};function Tg(e){let{inputs:t,backend:n}=e,{x:r}=t;if("string"===r.dtype)throw Error("zerosLike is not supported for string tensors");if("complex64"!==r.dtype)return _6({backend:n,attrs:{shape:r.shape,value:0,dtype:r.dtype}});{let e=v1({inputs:{input:r},backend:n}),t=Tg({inputs:{x:e},backend:n}),i=w3({inputs:{input:r},backend:n}),s=Tg({inputs:{x:i},backend:n}),a=vJ({inputs:{real:t,imag:s},backend:n});return n.disposeIntermediateTensorInfo(e),n.disposeIntermediateTensorInfo(t),n.disposeIntermediateTensorInfo(i),n.disposeIntermediateTensorInfo(s),a}}let Tm={kernelName:rp,backendName:"cpu",kernelFunc:Tg};function Ty(e){let{inputs:t,backend:n}=e,{x:r}=t;if("string"===r.dtype)throw Error("onesLike is not supported for string tensors");if("complex64"!==r.dtype)return _6({backend:n,attrs:{shape:r.shape,value:1,dtype:r.dtype}});{let e=v1({inputs:{input:r},backend:n}),t=Ty({inputs:{x:e},backend:n}),i=w3({inputs:{input:r},backend:n}),s=Tg({inputs:{x:i},backend:n}),a=vJ({inputs:{real:t,imag:s},backend:n});return n.disposeIntermediateTensorInfo(e),n.disposeIntermediateTensorInfo(t),n.disposeIntermediateTensorInfo(i),n.disposeIntermediateTensorInfo(s),a}}let Tb={kernelName:nm,backendName:"cpu",kernelFunc:Ty};function Tv(e){let{inputs:t,backend:n,attrs:r}=e,{axis:i}=r;if(1===t.length)return _j({inputs:{input:t[0]},backend:n,attrs:{dim:i}});let s=t[0].shape,a=t[0].dtype;t.forEach(e=>{G(s,e.shape,"All tensors passed to stack must have matching shapes"),j(a===e.dtype,()=>"All tensors passed to stack must have matching dtypes")});let o=[],l=w6({inputs:t.map(e=>{let t=_j({inputs:{input:e},backend:n,attrs:{dim:i}});return o.push(t),t}),backend:n,attrs:{axis:i}});return o.forEach(e=>n.disposeIntermediateTensorInfo(e)),l}let Tw={kernelName:nb,backendName:"cpu",kernelFunc:Tv},T_={kernelName:nv,backendName:"cpu",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{paddings:s,constantValue:a}=r;vC(i,"pad");let o=s.map((e,t)=>e[0]+i.shape[t]+e[1]),l=s.map(e=>e[0]),u=n.data.get(i.dataId).values,c=q(i.shape),h=i.shape.length,d=ef(i.shape),p=q(o),f=o.length,g=ef(o),m=et(i.dtype,p);0!==a&&m.fill(a);for(let e=0;e<c;e++)m[ex(eT(e,h,d).map((e,t)=>e+l[t]),f,g)]=u[e];return{dataId:n.write(m,o,i.dtype),shape:o,dtype:i.dtype}}},Tx=v5(nw,vB((e,t)=>Math.pow(e,t))),TT={kernelName:nw,backendName:"cpu",kernelFunc:Tx};function TI(e,t,n,r){let[i,s]=lt(e,r),a=iw(t,"int32"),o=ev(q(i),a),l=q(s);for(let e=0;e<o.length;++e){let t=e*l,r=1;for(let e=0;e<l;++e)r*=n[t+e];o[e]=r}return{outVals:o,outShape:i,outDtype:a}}let Tk={kernelName:nx,backendName:"cpu",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{axis:s,keepDims:a}=r;vC(i,"prod");let o=i.shape.length,l=Z(s,i.shape),u=li(l,o),c=l,h=i,d=[];null!=u&&(d.push(h=wf({inputs:{x:i},backend:n,attrs:{perm:u}})),c=la(c.length,o));let p=n.data.get(h.dataId).values,{outVals:f,outShape:g,outDtype:m}=TI(h.shape,h.dtype,p,c),y=g;return a&&(y=ln(g,l)),d.forEach(e=>n.disposeIntermediateTensorInfo(e)),n.makeTensorInfo(y,m,f)}};function TS(e,t,n){e.forEach((e,r)=>{if(e<0||e>=n){let i=eT(r,t.length,ef(t)).join(",");throw Error(`indices[${i}] = ${e} is not in [0, ${n})`)}})}function TE(e,t){for(let n=0;n<e.length;++n){let r=e[n],i=n===e.length-1?t:e[n+1].length;if(0===r.length)throw Error("Ragged splits may not be empty");if(r[0]<0)throw Error("Ragged splits must be non-negative");if(r[r.length-1]>i)throw Error("Ragged splits must not point past values");for(let e=1;e<r.length;++e)if(r[e-1]>r[e])throw Error("Ragged splits must be sorted in ascending order")}}function TC(e,t,n,r){let i=[],s=0,a=Array(t.length-1+n.length).fill(null).map(()=>[0]);TE(n,r);let o=1;for(let e=0;e<t.length-1;++e){o*=t[e];let n=t[e+1];for(let t=1;t<o+1;++t)a[e].push(t*n)}for(let r=0;r<e.length;++r){let o=e[r],l=e[r]+1;for(let e=0;e<n.length;++e){let r=n[e],i=e+t.length-1;if(i>=0){let e=a[i],t=e[e.length-1]-r[o];for(let e=o;e<l;++e)a[i].push(r[e+1]+t)}o=r[o],l=r[l]}l!==o&&(i.push([o,l]),s+=l-o)}return{outSplits:a,valueSlices:i,numValues:s}}function TA(e){let t=[];for(let n=0;n<e.length;++n){let r=en("int32",e[n].length);t.push(r),e[n].forEach((e,t)=>r[t]=e)}return t}function TN(e,t){let n=e.slice(0,t);for(;n.length<t;)n.push(1);for(let r=t;r<e.length;r++)n[t-1]*=e[r];return n}function TO(e,t,n,r,i,s){let a=TN(t,2)[1],o=TN(s,2)[1],l=0;for(let t of n)for(let n=t[0];n<t[1];++n){for(let t=0;t<r;++t)i[l*o+t]=e[n*a+t];++l}}function T$(e,t,n,r,i){let s=t.slice();s[0]=i;let a=en(n,q(s)),o=e.length,l=0===o?0:o/t[0];return TO(e,t,r,l,a,s),[a,s]}function TR(e,t,n,r,i,s,a,o){if(0===e.length)throw Error("paramsNestedSplits must be non empty");if(0===t[0].length)throw Error("Split tensors must not be scalars");if(TS(s,a,t[0][0]-1),0===r.length)throw Error("params.rank must be nonzero");let{outSplits:l,valueSlices:u,numValues:c}=TC(s,a,e,r[0]),h=TA(l),d=T$(n,r,i,u,c);return[h,d[0],d[1]]}let TD={kernelName:nT,backendName:"cpu",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{paramsNestedSplits:i,paramsDenseValues:s,indices:a}=t,{outputRaggedRank:o}=r,l=i.map(e=>n.data.get(e.dataId).values),u=i.map(e=>e.shape),c=n.data.get(s.dataId).values,h=n.data.get(a.dataId).values,[d,p,f]=TR(l,u,c,s.shape,s.dtype,h,a.shape,o),g=d.map(e=>n.makeTensorInfo([e.length],"int32",e)),m=n.makeTensorInfo(f,s.dtype,p);return g.concat([m])}},TF=0x7fffffff;function TP(e,t,n,r,i,s,a){if(t.length>1)throw Error("starts must be a scalar or vector");if(i.length>1)throw Error("limits must be a scalar or vector");if(a.length>1)throw Error("deltas must be a scalar or vector");let o=0===t.length,l=0===i.length,u=0===a.length,c=[];o||c.push(t[0]),l||c.push(i[0]),u||c.push(a[0]);for(let e=1;e<c.length;++e)if(c[e]!==c[e-1])throw Error("starts, limits, and deltas must have the same shape");let h=0===c.length?1:c[0],d=en("int32",h+1);d[0]=0;for(let t=0;t<h;++t){let n;let i=o?e[0]:e[t],a=l?r[0]:r[t],c=u?s[0]:s[t];if(0===c)throw Error("Requires delta != 0");if(c>0&&a<i||c<0&&a>i)n=0;else if((n=Math.ceil(Math.abs((a-i)/c)))>TF)throw Error(`Requires ((limit - start) / delta) <= ${TF}`);d[t+1]=d[t]+n}let p=en(n,d[h]),f=0;for(let t=0;t<h;++t){let n=d[t+1]-d[t],r=o?e[0]:e[t],i=u?s[0]:s[t];for(let e=0;e<n;++e)p[f++]=r,r+=i}return[d,p]}let TM={kernelName:nI,backendName:"cpu",kernelFunc:function(e){let{inputs:t,backend:n}=e,{starts:r,limits:i,deltas:s}=t,a=n.data.get(r.dataId).values,o=n.data.get(i.dataId).values,l=n.data.get(s.dataId).values,[u,c]=TP(a,r.shape,r.dtype,o,i.shape,l,s.shape);return[n.makeTensorInfo([u.length],"int32",u),n.makeTensorInfo([c.length],r.dtype,c)]}};var TL=w;class Tz{constructor(e,t,n,r,i,s,a,o,l,u){this.shape=e,this.shapeShape=t,this.values=n,this.valuesShape=r,this.valuesDType=i,this.defaultValue=s,this.defaultValueShape=a,this.rowPartitionValues=o,this.rowPartitionValuesShapes=l,this.rowPartitionTypes=u1(u),this.raggedRank=u2(this.rowPartitionTypes)}getRowPartitionTypeByDimension(e){return this.rowPartitionTypes[0]===TL.FIRST_DIM_SIZE?this.rowPartitionTypes[e+1]:this.rowPartitionTypes[e]}getRowPartitionTensor(e){return this.rowPartitionTypes[0]===TL.FIRST_DIM_SIZE?this.rowPartitionValues[e+1]:this.rowPartitionValues[e]}getMaxWidth(e){let t=this.getRowPartitionTensor(e-1);switch(this.getRowPartitionTypeByDimension(e-1)){case TL.VALUE_ROWIDS:return Tz.getMaxWidthValueRowID(t);case TL.ROW_SPLITS:return Tz.getMaxWidthRowSplit(t);default:throw Error(`Cannot handle partition type ${TL[this.getRowPartitionTypeByDimension(e-1)]}`)}}static getMaxWidthRowSplit(e){let t=e.length;if(0===t||1===t)return 0;let n=0;for(let r=0;r<t-1;++r){let t=e[r+1]-e[r];t>n&&(n=t)}return n}static getMaxWidthValueRowID(e){let t=e.length;if(0===t)return 0;let n=0,r=e[0],i=0;for(let s=1;s<t;++s){let t=e[s];t!==r&&(r=t,i=Math.max(s-n,i),n=s)}return Math.max(t-n,i)}tensorShapeFromTensor(e,t,n=!0){if(0===t.length){if(-1===e[0])return[];throw Error("The only valid scalar shape tensor is the fully unknown shape specified as -1.")}return TU(e,n)}calculateOutputSize(e){let t=this.valuesShape;u3(this.defaultValueShape,t);let n=this.tensorShapeFromTensor(this.shape,this.shapeShape),r=u0(this.raggedRank,n,t);r[0]<0&&(r[0]=e);for(let e=1;e<=this.raggedRank;++e)r[e]<0&&(r[e]=this.getMaxWidth(e));return r}calculateFirstParentOutputIndex(e,t,n){let r=Math.min(e,n),i=[],s=0;for(let e=0;e<r;++e,s+=t)i.push(s);for(let t=r;t<e;++t)i.push(-1);return j(i.length===e,()=>"Final length of result must be equal to firstDimension."),i}calculateOutputIndexRowSplit(e,t,n,r){let i=e.length,s=[];for(let a=0;a<i-1;++a){let i=e[a+1]-e[a],o=Math.min(r,i),l=t[a];-1===l&&(o=0);for(let e=0;e<o;++e)s.push(l),l+=n;for(let e=0;e<i-o;++e)s.push(-1)}if(i>0&&s.length!==e[i-1])throw Error("Invalid row split size.");return s}calculateOutputIndexValueRowID(e,t,n,r){let i=e.length,s=[];if(0===i)return[];let a=0,o=e[0];if(o>=t.length)throw Error(`Got currentValueRowId=${o}, which is not less than ${t.length}`);let l=t[o];s.push(l);for(let u=1;u<i;++u){let i=e[u];if(i===o)l>=0&&(++a<r?l+=n:l=-1);else{if(a=0,o=i,i>=t.length)throw Error(`Got nextValueRowId=${i} which is not less than ${t.length}`);l=t[i]}s.push(l)}if(s.length!==e.length)throw Error("Invalid row ids.");return s}calculateOutputIndex(e,t,n,r){let i=this.getRowPartitionTensor(e),s=this.getRowPartitionTypeByDimension(e);switch(s){case TL.VALUE_ROWIDS:return this.calculateOutputIndexValueRowID(i,t,n,r);case TL.ROW_SPLITS:if(i.length-1>t.length)throw Error(`Row partition size is greater than output size: ${i.length-1} > ${t.length}`);return this.calculateOutputIndexRowSplit(i,t,n,r);default:throw Error(`Unsupported partition type: ${TL[s]}`)}}getFirstDimensionSize(){let e=this.rowPartitionValues[0];if(0===this.rowPartitionTypes.length)throw Error("No row_partition_types given.");let t=this.rowPartitionTypes[0];switch(t){case TL.FIRST_DIM_SIZE:return e[0];case TL.VALUE_ROWIDS:throw Error("Cannot handle VALUE_ROWIDS in first dimension.");case TL.ROW_SPLITS:return this.rowPartitionValuesShapes[0][0]-1;default:throw Error(`Cannot handle type ${TL[t]}`)}}compute(){if(this.rowPartitionValues[0].length<=0)throw Error("Invalid first partition input. Tensor requires at least one element.");let e=this.getFirstDimensionSize(),t=this.calculateOutputSize(e),n=Array(this.raggedRank+1);n[n.length-1]=1;for(let e=n.length-2;e>=0;--e)n[e]=n[e+1]*t[e+1];let r=TU(t,!1),i=en(this.valuesDType,q(r));if(n[0]*t[0]>0){let s=this.calculateFirstParentOutputIndex(e,n[0],t[0]);for(let e=1;e<=this.raggedRank;++e)s=this.calculateOutputIndex(e-1,s,n[e],t[e]);this.setOutput(this.raggedRank,s,i,r)}return[r,i]}setOutput(e,t,n,r){if(0===n.length)return;let i=this.values,s=n,a=r.slice(),o=q(a=a.slice(e+1)),l=t.length,u=this.defaultValue;if(u.length!==o&&1!==u.length){let e=this.defaultValueShape;i2(()=>{u=oN(ox(u,e),a).dataSync()})}let c=0,h=0,d=0;for(let e=0;e<=l;++e){let r=e<l?t[e]:-1;if(r===d){++d;continue}if(h<d){let e=i.subarray(c*o);TB(s.subarray(h*o),e,(d-h)*o)}if(e>=l&&(r=Math.floor(n.length/o)),r>d){if(1===this.defaultValue.length)s.subarray(d*o,r*o).fill(this.defaultValue[0]),d=r;else for(;r>d;)TB(s.slice(d*o),u,o),++d}r<0?(c=e+1,h=d):(c=e,d=(h=d)+1)}}}function TB(e,t,n){for(let r=0;r<n;r++)e[r]=t[r]}function TU(e,t){let n=[];for(let r of e){if(r<0){if(!t)throw Error(`Dimension ${r} must be >= 0`);if(r<-1)throw Error(`Dimension ${r} must be >= -1`);r=-1}n.push(r)}return n}function TV(e,t,n,r,i,s,a,o,l,u){return new Tz(e,t,n,r,i,s,a,o,l,u).compute()}let Tj={kernelName:nk,backendName:"cpu",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{shape:i,values:s,defaultValue:a,rowPartitionTensors:o}=t,{rowPartitionTypes:l}=r,u=n.data.get(i.dataId).values,c=n.data.get(s.dataId).values,h=n.data.get(a.dataId).values,d=o.map(e=>n.data.get(e.dataId).values),p=o.map(e=>e.shape),[f,g]=TV(u,i.shape,c,s.shape,s.dtype,h,a.shape,d,p,l);return n.makeTensorInfo(f,s.dtype,g)}};function TG(e,t,n,r){let i=e===t,s=e<t&&n<0,a=t<e&&n>1;if(i||s||a)return ev(0,r);let o=ev(Math.abs(Math.ceil((t-e)/n)),r);t<e&&1===n&&(n=-1),o[0]=e;for(let e=1;e<o.length;e++)o[e]=o[e-1]+n;return o}let TW={kernelName:nS,backendName:"cpu",kernelFunc:function(e){let{backend:t,attrs:n}=e,{start:r,stop:i,dtype:s,step:a}=n,o=TG(r,i,a,s);return t.makeTensorInfo([o.length],s,o)}},Tq=v$(nC,e=>1/e),TH={kernelName:nC,backendName:"cpu",kernelFunc:Tq},TK={kernelName:nR,backendName:"cpu",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{images:i}=t,{alignCorners:s,halfPixelCenters:a,size:o}=r;vC(i,"resizeBilinear");let l=ef(i.shape),[u,c]=o,[h,d,p,f]=i.shape,g=n.data.get(i.dataId).values,m=new Float32Array(q([h,u,c,f])),y=[s&&u>1?d-1:d,s&&c>1?p-1:p],b=[s&&u>1?u-1:u,s&&c>1?c-1:c],v=0,w=y[0]/b[0],_=y[1]/b[1];for(let e=0;e<h;e++)for(let t=0;t<u;t++){let n;let r=Math.max(0,Math.floor(n=a?w*(t+.5)-.5:w*t)),i=n-r,s=Math.min(d-1,Math.ceil(n)),o=e*l[0]+r*l[1],u=e*l[0]+s*l[1];for(let e=0;e<c;e++){let t;let n=Math.max(0,Math.floor(t=a?_*(e+.5)-.5:_*e)),r=t-n,s=Math.min(p-1,Math.ceil(t)),c=o+n*l[2],h=u+n*l[2],d=o+s*l[2],y=u+s*l[2];for(let e=0;e<f;e++){let t=g[c+e],n=g[h+e],s=g[d+e],a=g[y+e],o=t+(s-t)*r,l=o+(n+(a-n)*r-o)*i;m[v++]=l}}}return n.makeTensorInfo([h,u,c,f],"float32",m)}},TX={kernelName:nD,backendName:"cpu",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{images:i,dy:s}=t,{alignCorners:a}=r;vC([s,i],"resizeBilinearGrad");let o=ef(i.shape),[l,u,c,h]=i.shape,[,d,p]=s.shape,f=new Float32Array(l*u*c*h),g=[a&&d>1?u-1:u,a&&p>1?c-1:c],m=[a&&d>1?d-1:d,a&&p>1?p-1:p],y=g[0]/m[0],b=g[1]/m[1],v=n.data.get(s.dataId).values,w=0;for(let e=0;e<l;e++){let t=e*o[0];for(let e=0;e<d;e++){let n=e*y,r=Math.floor(n),i=Math.min(Math.ceil(n),u-1),s=t+r*o[1],a=t+i*o[1],l=n-r,d=1-l;for(let e=0;e<p;e++){let t=e*b,n=Math.floor(t),r=Math.min(Math.ceil(t),c-1),i=t-n,u=1-i,p=s+n*o[2],g=s+r*o[2],m=a+n*o[2],y=a+r*o[2],_=d*u,x=d*i,T=l*u,I=l*i;for(let e=0;e<h;e++){let t=v[w++];f[p+e]+=t*_,f[g+e]+=t*x,f[m+e]+=t*T,f[y+e]+=t*I}}}}return n.makeTensorInfo([l,c,u,h],"float32",f)}},TY={kernelName:nO,backendName:"cpu",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{images:i}=t,{alignCorners:s,halfPixelCenters:a,size:o}=r;vC(i,"resizeNearestNeighbor");let l=ef(i.shape),[u,c]=o,[h,d,p,f]=i.shape,g=n.data.get(i.dataId).values,m=new Float32Array(h*u*c*f),y=[s&&u>1?d-1:d,s&&c>1?p-1:p],b=[s&&u>1?u-1:u,s&&c>1?c-1:c],v=y[0]/b[0],w=y[1]/b[1],_=0;for(let e=0;e<h;e++){let t=e*l[0];for(let e=0;e<u;e++){let n=a?v*(e+.5):v*e,r=Math.min(d-1,s?Math.round(n):Math.floor(n));a&&(r=Math.max(0,r));let i=t+r*l[1];for(let e=0;e<c;e++){let t=a?w*(e+.5):w*e,n=Math.min(p-1,s?Math.round(t):Math.floor(t));a&&(n=Math.max(0,n));let r=i+n*l[2];for(let e=0;e<f;e++){let t=g[r+e];m[_++]=t}}}}return n.makeTensorInfo([h,u,c,f],i.dtype,m)}},TQ={kernelName:n$,backendName:"cpu",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{images:i,dy:s}=t,{alignCorners:a}=r;vC([s,i],"resizeNearestNeighborGrad");let o=ef(i.shape),l=ef(s.shape),[u,c,h,d]=i.shape,[,p,f]=s.shape,g=new Float32Array(u*c*h*d),m=n.data.get(s.dataId).values,y=[a&&p>1?c-1:c,a&&f>1?h-1:h],b=[a&&p>1?p-1:p,a&&f>1?f-1:f],v=y[0]/b[0],w=y[1]/b[1],_=1/v,x=1/w,T=2*Math.ceil(_)+2,I=2*Math.ceil(x)+2;for(let e=0;e<u;e++){let t=e*o[0];for(let e=0;e<c;e++){let n=t+e*o[1],r=Math.floor(Math.floor(e*_)-T/2);for(let i=0;i<h;i++){let s=n+i*o[2],u=Math.floor(Math.floor(i*x)-I/2);for(let n=0;n<d;n++){let o=0;for(let s=0;s<T;s++){let d=s+r;if(d<0||d>=p)continue;let g=t+d*l[1],y=d*v;if(e===Math.min(c-1,a?Math.round(y):Math.floor(y)))for(let e=0;e<I;e++){let t=e+u;if(t<0||t>=f)continue;let r=g+t*l[2],s=t*w;i===Math.min(h-1,a?Math.round(s):Math.floor(s))&&(o+=m[r+n])}}g[s+n]=o}}}}return n.makeTensorInfo(i.shape,i.dtype,g)}},TJ={kernelName:nP,backendName:"cpu",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{dims:s}=r;vC(i,"reverse");let a=i.shape.length,o=Z(s,i.shape);if(0===a)return vP({inputs:{x:i},backend:n});let l=new il(i.shape,i.dtype),u=n.bufferSync(i);for(let e=0;e<l.size;e++){let t=l.indexToLoc(e),n=t.slice();o.forEach(e=>n[e]=i.shape[e]-1-n[e]),l.set(u.get(...n),...t)}return n.makeTensorInfo(l.shape,l.dtype,l.values)}},TZ={kernelName:rm,backendName:"cpu",kernelFunc:({inputs:e,attrs:t,backend:n})=>{let{image:r}=e,{radians:i,fillValue:s,center:a}=t,o=n,l=et(r.dtype,q(r.shape)),[u,c,h,d]=r.shape,[p,f]=u5(a,c,h),g=255,m=Math.sin(i),y=Math.cos(i),b=o.data.get(r.dataId).values;for(let e=0;e<u;e++){let t=e*h*c*d;for(let e=0;e<c;e++){let n=h*d*e;for(let r=0;r<h;r++){let i=r*d;for(let a=0;a<d;a++){let o=[u,e,r,a],v=o[2],w=o[1],_=(v-p)*y-(w-f)*m,x=(v-p)*m+(w-f)*y;_=Math.round(_+p),x=Math.round(x+f);let T=s;"number"!=typeof s&&(T=3===a?g:s[a]),_>=0&&_<h&&x>=0&&x<c&&(T=b[t+h*d*x+_*d+a]),l[t+n+i+a]=T}}}}return{dataId:o.write(l,r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}},T0=v$(nM,e=>{let t=Math.floor(e);return e-t<.5?Math.floor(e):e-t>.5?Math.ceil(e):t%2==0?t:t+1}),T1={kernelName:nM,backendName:"cpu",kernelFunc:T0},T2=vO(e=>1/Math.sqrt(e)),T3=vR(nL,T2),T4={kernelName:nL,backendName:"cpu",kernelFunc:T3};function T6(e,t,n,r,i,s,a,o,l,u){let c=[r/i,i],h=e.values,d=t.values;if(0===r)return s0(n,t.dtype);let p=l instanceof il?l:s0(c,t.dtype);"string"==typeof l?p.values.fill(l):"number"==typeof l?p.values.fill(l):"boolean"==typeof l&&p.values.fill(+l);for(let e=0;e<s;e++){let s=[],l=0;for(let t=0;t<a;t++){let n=h[e*a+t];s.push(n),l+=n*o[t]}if(l<0||l>=r/i)throw Error(`Invalid indices: ${s} does not index into ${n}`);for(let n=0;n<i;n++)u?p.values[l*i+n]+=d[e*i+n]:p.values[l*i+n]=0===t.rank?d[0]:d[e*i+n]}return p}let T5={kernelName:nz,backendName:"cpu",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{indices:i,updates:s}=t,{shape:a}=r,{sliceRank:o,numUpdates:l,sliceSize:u,strides:c,outputSize:h}=cs(s,i,a),d=!0,p=T6(n.bufferSync(i),n.bufferSync(s),a,h,u,l,o,c,0,d);return n.makeTensorInfo(a,p.dtype,p.values)}};function T8(e,t){let n=0,r=e.length,i=0;for(;n<r;)e[i=Math.floor((n+r)/2)]<t?n=i+1:r=i;return r}function T7(e,t){let n=0,r=e.length,i=0;for(;n<r;)e[i=Math.floor((n+r)/2)]<=t?n=i+1:r=i;return r}function T9(e,t,n,r,i,s){let a=en("int32",n*i);for(let o=0;o<n;++o){let n=e.slice(o*r,(o+1)*r),l=o*i;for(let e=0;e<i;++e)a[l+e]="left"===s?T8(n,t[e+l]):T7(n,t[e+l])}return a}let Ie={kernelName:nU,backendName:"cpu",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{sortedSequence:i,values:s}=t,{side:a}=r,o=T9(n.data.get(i.dataId).values,n.data.get(s.dataId).values,i.shape[0],i.shape[1],s.shape[1],a);return n.makeTensorInfo(s.shape,"int32",o)}},It={kernelName:nV,backendName:"cpu",kernelFunc:function(e){let{inputs:t,backend:n}=e,{condition:r,t:i,e:s}=t;vC([r,i,s],"select");let a=r.shape.length,o=n.data.get(r.dataId).values,l=n.data.get(i.dataId).values,u=n.data.get(s.dataId).values,c=iw(i.dtype,s.dtype),h=ev(q(i.shape),c),d=0,p=0===a||a>1||1===i.shape.length?1:q(i.shape.slice(1));for(let e=0;e<o.length;e++)for(let t=0;t<p;t++)1===o[e]?h[d++]=l[e]:h[d++]=u[e];return n.makeTensorInfo(i.shape,c,h)}},In=ca,Ir=co,Ii=v$(nj,e=>e>=0?Ir*e:In*(Math.exp(e)-1)),Is={kernelName:nj,backendName:"cpu",kernelFunc:Ii},Ia=v$(nH,e=>e<0?-1:e>0?1:0),Io={kernelName:nH,backendName:"cpu",kernelFunc:Ia},Il=v$(nW,e=>Math.sin(e)),Iu={kernelName:nW,backendName:"cpu",kernelFunc:Il},Ic=v$(nq,e=>Math.sinh(e)),Ih={kernelName:nq,backendName:"cpu",kernelFunc:Ic},Id=Math.log(11920928955078125e-23)+2,Ip=v$(nX,e=>{let t=e>-Id,n=e<Id,r=Math.exp(e);return n?r:t?e:Math.log(1+r)}),If={kernelName:nX,backendName:"cpu",kernelFunc:Ip},Ig={kernelName:nJ,backendName:"cpu",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{blockShape:s,paddings:a}=r;vC([i],"spaceToBatchND");let o=q(s),l=[[0,0]];l.push(...a);for(let e=1+s.length;e<i.shape.length;++e)l.push([0,0]);let u=T_.kernelFunc({inputs:{x:i},backend:n,attrs:{paddings:l,constantValue:0}}),c=u8(u.shape,s,o,!1),h=u7(c.length,s.length,!1),d=u9(u.shape,s,o,!1),p=wt({inputs:{x:u},backend:n,attrs:{shape:c}}),f=wf({inputs:{x:p},backend:n,attrs:{perm:h}}),g=wt({inputs:{x:f},backend:n,attrs:{shape:d}});return n.disposeIntermediateTensorInfo(u),n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(f),g}};function Im(e,t,n,r,i,s,a){let o=t[0],l=s[0],u=Array(l),c=Array(o),h=t[1];if(0===l){if(0!==o)throw Error(cR(o));return[en(n,0),[0,h],en(i,0),u,c]}let d=!0,p=0,f=Array(l).fill(0);for(let t=0;t<o;++t){let n=e[t*h];if(n<0)throw Error(cD(t,n));if(n>=l)throw Error(cF(t,n,l));++f[n],d=d&&n>=p,p=n}let g=!0;for(let e=0;e<l;++e){let t=0===f[e];u[e]=t,g=g&&!t,f[e]=Math.max(f[e],1),e>0&&(f[e]+=f[e-1])}if(g&&d){let t=e,n=r;for(let e=0;e<o;++e)c[e]=e;return[t,[o,h],n,u,c]}{let t=f[l-1],s=en(n,t*h),d=en(i,t),p=Array(l).fill(0);for(let t=0;t<o;++t){let n=e[t*h],i=p[n],a=(0===n?0:f[n-1])+i;p[n]++;for(let n=0;n<h;++n)s[a*h+n]=e[t*h+n];d[a]=r[t],c[t]=a}for(let e=0;e<l;++e)if(0===p[e]){let t=0===e?0:f[e-1];s[t*h+0]=e;for(let e=1;e<h;++e)s[t*h+e]=0;d[t]=a}return[s,[t,h],d,u,c]}}let Iy={kernelName:n1,backendName:"cpu",kernelFunc:function(e){let{inputs:t,backend:n}=e,{indices:r,values:i,denseShape:s,defaultValue:a}=t;if(1!==s.shape.length)throw Error(`Dense shape must be a vector, saw:
        ${s.shape}`);if(2!==r.shape.length)throw Error(`Indices must be a matrix, saw:
        ${r.shape}`);if(1!==i.shape.length)throw Error(`Values must be a vector, saw:
        ${i.shape}`);if(0!==a.shape.length)throw Error(`Default value must be a scalar, saw:
        ${a.shape}`);let o=n.data.get(r.dataId).values,l=n.data.get(i.dataId).values,u=n.data.get(s.dataId).values,c=n.data.get(a.dataId).values[0],[h,d,p,f,g]=Im(o,r.shape,r.dtype,l,i.dtype,u,c);return[n.makeTensorInfo(d,r.dtype,h),n.makeTensorInfo([d[0]],i.dtype,p),n.makeTensorInfo([f.length],"bool",new Uint8Array(f.map(e=>Number(e)))),n.makeTensorInfo([g.length],r.dtype,new Int32Array(g))]}};function Ib(e,t,n,r,i){let s=q(r),a=t[0],o=i.length,l=[],u=1,c=-1;for(let e=0;e<o;++e){let t=i[e];if(-1===t){if(-1!==c)throw Error(cP(c,e));c=e,l.push(1)}else{if(t<0)throw Error(cM(e,t));u*=t,l.push(t)}}if(-1!==c){if(u<=0)throw Error(cL());let e=Math.trunc(s/u);if(u*e!==s)throw Error(cz(r,l));l[c]=e}if(q(l)!==s)throw Error(cB(r,l));let h=r.length,d=[];if(h>0){d[h-1]=1;for(let e=h-2;e>=0;--e)d[e]=d[e+1]*r[e+1]}let p=[];if(o>0){p[o-1]=1;for(let e=o-2;e>=0;--e)p[e]=p[e+1]*l[e+1]}let f=en(n,a*o);for(let t=0;t<a;++t){let n=0;for(let r=0;r<h;++r)n+=e[t*h+r]*d[r];for(let e=0;e<o;++e)f[t*o+e]=Math.trunc(n/p[e]),n%=p[e]}return[f,[a,o],l]}let Iv={kernelName:n2,backendName:"cpu",kernelFunc:function(e){let{inputs:t,backend:n}=e,{inputIndices:r,inputShape:i,newShape:s}=t;if(2!==r.shape.length)throw Error(`Input indices should be a matrix but received shape
        ${r.shape}`);if(1!==i.shape.length)throw Error(`Input shape should be a vector but received shape
        ${i.shape}`);if(1!==s.shape.length)throw Error(`Target shape should be a vector but received shape ${s.shape}`);let a=Array.from(n.data.get(i.dataId).values),o=n.data.get(r.dataId).values,l=Array.from(n.data.get(s.dataId).values),[u,c,h]=Ib(o,r.shape,r.dtype,a,l);return[n.makeTensorInfo(c,r.dtype,u),n.makeTensorInfo([h.length],s.dtype,new Int32Array(h))]}};function Iw(e,t,n,r,i,s=!1,a=0){let o=r.length,l=[t[0],e.length/t[0]],u=l[1],c=o>0?i[o-1]+1:0;if(c<0)throw Error(cU());let h=t.slice();h[0]=c;let d=en(n,h.reduce((e,t)=>e*t,1));if(0===o)return c>0&&d.fill(a),[d,h];if(c<=0)throw Error(cU());let p=0,f=1,g=0,m=i[0];for(;;){let t=0;if(f<o){if(m===(t=i[f])){++f;continue}if(m>=t)throw Error(cV())}if(m<0||m>=c)throw Error(cj(m,c));m>g&&d.fill(a,g*u,m*u);for(let t=p;t<f;++t){let n=r[t];if(n<0||n>=l[0])throw Error(cG(t,r[t],l[0]));for(let t=0;t<u;t++)d[m*u+t]+=e[n*u+t]}if(s)for(let e=0;e<u;e++)d[m*u+e]/=f-p;if(p=f,++f,g=m+1,m=t,f>o)break}return g<c&&d.fill(a,g*u,c*u),[d,h]}let I_={kernelName:n3,backendName:"cpu",kernelFunc:function(e){let{inputs:t,backend:n}=e,{data:r,indices:i,segmentIds:s}=t;if(r.shape.length<1)throw Error("Data should be at least 1 dimensional but received scalar");if(1!==i.shape.length)throw Error(`Indices should be a vector but received shape
          ${i.shape}`);if(1!==s.shape.length)throw Error(`Segment ids should be a vector but received shape
          ${s.shape}`);if(i.shape[0]!==s.shape[0])throw Error("segmentIds and indices should have same size.");let a=n.data.get(r.dataId).values,o=n.data.get(i.dataId).values,l=n.data.get(s.dataId).values,[u,c]=Iw(a,r.shape,r.dtype,o,l,!0);return n.makeTensorInfo(c,r.dtype,u)}},Ix={kernelName:n4,backendName:"cpu",kernelFunc:function(e){let{inputs:t,backend:n}=e,{data:r,indices:i,segmentIds:s}=t;if(r.shape.length<1)throw Error("Data should be at least 1 dimensional but received scalar");if(1!==i.shape.length)throw Error(`Indices should be a vector but received shape
         ${i.shape}`);if(1!==s.shape.length)throw Error(`Segment ids should be a vector but received shape
         ${s.shape}`);if(i.shape[0]!==s.shape[0])throw Error("segmentIds and indices should have same size.");let a=n.data.get(r.dataId).values,o=n.data.get(i.dataId).values,l=n.data.get(s.dataId).values,[u,c]=Iw(a,r.shape,r.dtype,o,l);return n.makeTensorInfo(c,r.dtype,u)}},IT={kernelName:n6,backendName:"cpu",kernelFunc:function(e){let t;let{inputs:n,backend:r,attrs:i}=e,{sparseIndices:s,sparseValues:a,defaultValue:o}=n,{outputShape:l}=i,{sliceRank:u,numUpdates:c,sliceSize:h,strides:d,outputSize:p}=cs(a,s,l),f=!1,g=r.bufferSync(s);switch(a.dtype){case"bool":t=T6(g,r.bufferSync(a),l,p,h,c,u,d,!!r.data.get(o.dataId).values[0],f);break;case"float32":case"int32":t=T6(g,r.bufferSync(a),l,p,h,c,u,d,r.data.get(o.dataId).values[0],f);break;case"string":t=T6(g,r.bufferSync(a),l,p,h,c,u,d,r0(r.data.get(o.dataId).values[0]),f);break;default:throw Error(`Unsupported type ${a.dtype}`)}return r.makeTensorInfo(l,t.dtype,t.values)}},II={kernelName:nZ,backendName:"cpu",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{numOrSizeSplits:s,axis:a}=r,o=Z(a,i.shape)[0],l=c$(i,s,o),u=Array(i.shape.length).fill(0),c=i.shape.slice();return l.map(e=>{let t=[...c];t[o]=e;let r=wB({inputs:{x:i},backend:n,attrs:{begin:u,size:t}});return u[o]+=e,r})}},Ik=vO(e=>Math.sqrt(e)),IS=v$(nY,e=>Math.sqrt(e)),IE={kernelName:nY,backendName:"cpu",kernelFunc:IS},IC={kernelName:n8,backendName:"cpu",kernelFunc:({inputs:e,backend:t})=>{let{x:n}=e,r=t;vC(n,"square");let i=r.data.get(n.dataId).values,s=new Float32Array(i.length);for(let e=0;e<i.length;++e){let t=i[e];s[e]=t*t}return{dataId:r.write(s,n.shape,n.dtype),shape:n.shape,dtype:n.dtype}}},IA=v5(n5,vB((e,t)=>{let n=e-t;return n*n})),IN={kernelName:n5,backendName:"cpu",kernelFunc:IA},IO=vO((e,t)=>{let{pattern:n,replaceGlobal:r,rewrite:i}=t;return e.replace(new RegExp(n,r?"g":""),i)}),I$=vR(n7,IO),IR={kernelName:n7,backendName:"cpu",kernelFunc:I$},ID=v$(rf,(e,t)=>{let n=t;return isNaN(e)?NaN:e>0?1:n.alpha}),IF={kernelName:rf,backendName:"cpu",kernelFunc:ID};function IP(e,t,n,r){let i=s0(e,t.dtype);for(let e=0;e<i.size;e++){let s=i.indexToLoc(e),a=Array(s.length);for(let e=0;e<a.length;e++)a[e]=s[e]*n[e]+r[e];i.set(t.get(...a),...s)}return i}let IM={kernelName:n9,backendName:"cpu",kernelFunc:function(e){let t;let{inputs:n,backend:r,attrs:i}=e,{x:s}=n,{begin:a,end:o,strides:l,beginMask:u,endMask:c,ellipsisMask:h,newAxisMask:d,shrinkAxisMask:p}=i;vC(s,"stridedSlice");let{finalShapeSparse:f,finalShape:g,isIdentity:m,sliceDim0:y,isSimpleSlice:b,begin:v,end:w,strides:_}=a8(s.shape,a,o,l,u,c,h,d,p);if(m)t=wt({inputs:{x:s},backend:r,attrs:{shape:g}});else if(y||b){j(s.shape.length>=1,()=>`Input must have rank at least 1, got: ${s.shape.length}`);let e=aK(v,w,_),n=wB({inputs:{x:s},backend:r,attrs:{begin:v,size:e}});t=wt({inputs:{x:n},backend:r,attrs:{shape:g}}),r.disposeIntermediateTensorInfo(n)}else{let e=IP(f,r.bufferSync(s),_,v);t=r.makeTensorInfo(g,e.dtype,e.values)}return t}};class IL{constructor(e,t,n,r,i,s){this.separator=rZ(e),this.nGramWidths=t,this.leftPad=rZ(n),this.rightPad=rZ(r),this.padWidth=i,this.preserveShort=s}getPadWidth(e){return Math.min(this.padWidth<0?e-1:this.padWidth,e-1)}getNumNGrams(e,t){return Math.max(0,e+2*this.getPadWidth(t)-t+1)}createNGrams(e,t,n,r,i,s){for(let a=0;a<i;++a){let o;let l=this.getPadWidth(s),u=Math.max(0,l-a),c=Math.max(0,l-(i-(a+1))),h=s-(u+c),d=t+(u>0?0:a-l);o=0+u*this.leftPad.length;for(let t=0;t<h;++t)o+=e[d+t].length;o+=c*this.rightPad.length,o+=(u+c+h-1)*this.separator.length,n[r+a]=new Uint8Array(o);let p=n[r+a],f=0,g=e=>e.forEach(e=>p[f++]=e);for(let e=0;e<u;++e)g(this.leftPad),g(this.separator);for(let t=0;t<h-1;++t)g(e[d+t]),g(this.separator);if(h>0){g(e[d+h-1]);for(let e=0;e<c;++e)g(this.separator),g(this.rightPad)}else{for(let e=0;e<c-1;++e)g(this.rightPad),g(this.separator);g(this.rightPad)}}}compute(e,t){let n=e.length,r=t.length;if(r>0){let e=t[0];if(0!==e)throw Error(`First split value must be 0, got ${e}`);for(let i=1;i<r;++i){let r=t[i]>=e;if(!(r=r&&t[i]<=n))throw Error(`Invalid split value ${t[i]}, must be in [${e}, ${n}]`);e=t[i]}if(e!==n)throw Error(`Last split value must be data size. Expected ${n}, got ${e}`)}let i=r-1,s=en("int32",r);if(0===n||0===r){let e=Array(n);for(let e=0;e<=i;++e)s[e]=0;return[e,s]}s[0]=0;for(let e=1;e<=i;++e){let n=t[e]-t[e-1],r=0;this.nGramWidths.forEach(e=>{r+=this.getNumNGrams(n,e)}),this.preserveShort&&n>0&&0===r&&(r=1),s[e]=s[e-1]+r}let a=Array(s[i]);for(let n=0;n<i;++n){let r=t[n],i=s[n];if(this.nGramWidths.forEach(s=>{let o=t[n+1]-t[n],l=this.getNumNGrams(o,s);this.createNGrams(e,r,a,i,l,s),i+=l}),this.preserveShort&&i===s[n]){let s=t[n+1]-t[n];if(0===s)continue;let o=s+2*this.padWidth,l=1;this.createNGrams(e,r,a,i,l,o)}}return[a,s]}}function Iz(e,t,n,r,i,s,a,o){return new IL(n,r,i,s,a,o).compute(e,t)}let IB={kernelName:re,backendName:"cpu",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{separator:i,nGramWidths:s,leftPad:a,rightPad:o,padWidth:l,preserveShortSequences:u}=r,{data:c,dataSplits:h}=t,[d,p]=Iz(n.data.get(c.dataId).values,n.data.get(h.dataId).values,i,s,a,o,l,u);return[n.makeTensorInfo([d.length],"string",d),n.makeTensorInfo(h.shape,"int32",p)]}};function IU(e,t,n,r){if(!e.length)return;if(0===t.length){for(let t=0;t<e.length;++t)r.push(e.subarray(t,t+1));return}if(1===t.length){let i=t[0],s=e.indexOf(i);for(;-1!==s;){let t=e.subarray(0,s);n&&0===t.length||r.push(t),s=(e=e.subarray(s+1)).indexOf(i)}n&&0===e.length||r.push(e);return}let i=0;for(let s=0;s<e.length+1;s++)if(s===e.length||-1!==t.indexOf(e[s])){let t=e.subarray(i,s);n&&0===t.length||r.push(t),i=s+1}}function IV(e,t,n){let r=e.length,i=[],s=0,a=0,o=Array(r);for(let l=0;l<r;++l){let r=i.length;IU(e[l],t,n,i);let u=i.length-r;o[l]=u,s+=u,a=Math.max(a,u)}let l=en("int32",2*s),u=Array(s),c=[r,a],h=0;for(let e=0;e<r;++e)for(let t=0;t<o[e];++t)l[2*h]=e,l[2*h+1]=t,u[h]=i[h],++h;return[l,u,c]}let Ij={kernelName:rt,backendName:"cpu",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{skipEmpty:i}=r,{input:s,delimiter:a}=t;if("string"!==s.dtype)throw Error("Input must be of datatype string");if(1!==s.shape.length)throw Error(`Input must be a vector, got shape: ${s.shape}`);if(0!==a.shape.length)throw Error(`Delimiter must be a scalar, got shape: ${a.shape}`);let[o,l,u]=IV(n.data.get(s.dataId).values,n.data.get(a.dataId).values[0],i),c=l.length;return[n.makeTensorInfo([c,2],"int32",o),n.makeTensorInfo([c],"string",l),n.makeTensorInfo([2],"int32",new Int32Array(u))]}};function IG(e,t){let n=en("int32",e.length);for(let r=0;r<e.length;++r)n[r]=rK(e[r]).modulo(t).getLowBitsUnsigned();return n}let IW={kernelName:rn,backendName:"cpu",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{numBuckets:i}=r,{input:s}=t;if("string"!==s.dtype)throw Error("Input must be of datatype string");if(i<=0)throw Error("Number of buckets must be at least 1");let a=IG(n.data.get(s.dataId).values,i);return n.makeTensorInfo(s.shape,"int32",a)}},Iq=v$(ri,e=>Math.tan(e)),IH={kernelName:ri,backendName:"cpu",kernelFunc:Iq},IK=v$(rs,e=>Math.tanh(e));function IX(e,t){let n=Array(e.rank);for(let r=0;r<n.length;r++)n[r]=e.shape[r]*t[r];let r=s0(n,e.dtype);for(let t=0;t<r.values.length;++t){let n=r.indexToLoc(t),i=Array(e.rank);for(let t=0;t<i.length;t++)i[t]=n[t]%e.shape[t];let s=e.locToIndex(i);r.values[t]=e.values[s]}return r}let IY=(e,t)=>{let n=t.value-e.value;return 0===n?e.index-t.index:n};function IQ(e,t,n=0,r=e.length-1){for(;r>n;){if(r-n>600){let i=r-n+1,s=t-n+1,a=Math.log(i),o=.5*Math.exp(2*a/3),l=.5*Math.sqrt(a*o*(i-o)/i)*Math.sign(s-i/2),u=Math.max(n,Math.floor(t-s*o/i+l)),c=Math.min(r,Math.floor(t+(i-s)*o/i+l));IQ(e,t,u,c)}let i=e[t],s=n,a=r;for(U(e,n,t),IY(e[r],i)>0&&U(e,n,r);s<a;){for(U(e,s,a),s++,a--;0>IY(e[s],i);)s+=1;for(;IY(e[a],i)>0;)a-=1}0===IY(e[n],i)?U(e,n,a):U(e,a+=1,r),a<=t&&(n=a+1),t<=a&&(r=a-1)}}function IJ(e,t,n,r,i){let s=t[t.length-1],[a,o]=[e.length/s,s],l=et(n,a*r),u=et("int32",a*r);for(let t=0;t<a;t++){let n=t*o,s=e.subarray(n,n+o),a=Array(s.length);s.forEach((e,t)=>a[t]={value:e,index:t}),r<a.length&&(IQ(a,r),a=a.slice(0,r)),i&&a.sort(IY);let c=t*r,h=l.subarray(c,c+r),d=u.subarray(c,c+r);for(let e=0;e<r;e++)h[e]=a[e].value,d[e]=a[e].index}let c=t.slice();return c[c.length-1]=r,[s0(c,n,l),s0(c,"int32",u)]}function IZ(e,t,n){switch(n){case"reflect":return I0(e,t);case"wrap":return I1(e,t);case"nearest":return I3(e,t);default:return I2(e,t)}}function I0(e,t){let n=e;if(n<0){if(t<=1)n=0;else{let e=2*t;n<e&&(n=e*Math.trunc(-n/e)+n),n=n<-t?n+e:-n-1}}else if(n>t-1){if(t<=1)n=0;else{let e=2*t;(n-=e*Math.trunc(n/e))>=t&&(n=e-n-1)}}return z(0,n,t-1)}function I1(e,t){let n=e;if(n<0){if(t<=1)n=0;else{let e=t-1;n+=t*(Math.trunc(-n/e)+1)}}else if(n>t-1){if(t<=1)n=0;else{let e=t-1;n-=t*Math.trunc(n/e)}}return z(0,n,t-1)}function I2(e,t){return e}function I3(e,t){return z(0,e,t-1)}function I4(e,t,n,r,i,s,a,o,l,u,c){let h=a*r+o*i+l*s+u;return 0<=o&&o<t&&0<=l&&l<n?e[h]:c}function I6(e,t,n,r,i,s,a,o,l,u,c){return I4(e,t,n,r,i,s,a,Math.round(o),Math.round(l),u,c)}function I5(e,t,n,r,i,s,a,o,l,u,c){let h=Math.floor(o),d=Math.floor(l),p=h+1,f=d+1,g=(f-l)*I4(e,t,n,r,i,s,a,h,d,u,c)+(l-d)*I4(e,t,n,r,i,s,a,h,f,u,c),m=(f-l)*I4(e,t,n,r,i,s,a,p,d,u,c)+(l-d)*I4(e,t,n,r,i,s,a,p,f,u,c);return(p-o)*g+(o-h)*m}function I8(e,t,n,r){let i=Z(t,n)[0],s=[1,n[0],1];for(let e=0;e<i;e++)s[0]*=n[e];s[1]=n[i];for(let e=i+1;e<n.length;e++)s[2]*=n[e];let a=new Map,o=new Int32Array(n[i]),l=new il(s,r,e),u=[],c=1===s[0]&&1===s[2];for(let t=0;t<n[i];t++){let n;if(c)n=e[t].toString();else{let e=[];for(let n=0;n<s[0];n++)for(let r=0;r<s[2];r++)e.push(l.get(n,t,r));n=e.join(",")}let r=a.get(n);if(null!=r)o[t]=r;else{let e=a.size;a.set(n,e),o[t]=e,u.push(t)}}let h=s.slice();h[1]=a.size;let d=new il(h,r);u.forEach((e,t)=>{for(let n=0;n<s[0];n++)for(let r=0;r<s[2];r++)d.set(l.get(n,e,r),n,t,r)});let p=n.slice();return p[i]=h[1],{outputValues:d.values,outputShape:p,indices:o}}for(let e of[ws,wo,wu,wh,we,wd,wm,wy,wb,wv,w_,wT,wk,wE,wA,wD,wF,wP,wM,wi,wL,wV,wW,wK,wX,v6,wJ,w0,vZ,w1,w5,w7,w9,_e,_t,_n,_r,_s,_o,_l,_u,_c,_h,_d,_f,_g,_m,_y,_b,_v,_w,__,_E,vF,_C,_O,_z,_V,_G,_H,_4,_5,_7,xt,xr,xi,xs,xo,xu,xd,xg,vM,xm,w4,xb,xw,xx,vz,xk,xC,xN,xR,xF,xM,xz,xU,xV,xj,xq,xX,xY,xQ,xJ,xZ,x1,x2,x3,x5,x8,x9,Tn,_I,Ti,Ta,Tl,Tc,Tp,Tf,Tb,Tw,T_,TT,vj,Tk,TD,TM,Tj,TW,v2,_X,TH,vW,vH,wn,TK,TX,TY,TQ,TJ,TZ,T1,T4,T5,Ie,It,Is,vY,Io,Iu,Ih,wU,Tt,If,Ig,Iy,Iv,I_,Ix,IT,II,IE,IC,IN,IR,IF,IM,IB,Ij,IW,_J,_S,IH,{kernelName:rs,backendName:"cpu",kernelFunc:IK},{kernelName:nB,backendName:"cpu",kernelFunc:function(e){let{inputs:t,backend:n}=e,{tensor:r,indices:i,updates:s}=t,{sliceRank:a,numUpdates:o,sliceSize:l,strides:u,outputSize:c}=cs(s,i,r.shape),h=!1,d=n.bufferSync(i),p=n.bufferSync(s),f=n.bufferSync(r),g=T6(d,p,r.shape,c,l,o,a,u,f,h);return n.makeTensorInfo(r.shape,g.dtype,g.values)}},{kernelName:ra,backendName:"cpu",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{reps:s}=r;vC(i,"tile");let a=IX(n.bufferSync(i),s);return n.makeTensorInfo(a.shape,a.dtype,a.values)}},{kernelName:ro,backendName:"cpu",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{k:s,sorted:a}=r;vC(i,"topk");let[o,l]=IJ(n.data.get(i.dataId).values,i.shape,i.dtype,s,a);return[n.makeTensorInfo(o.shape,o.dtype,o.values),n.makeTensorInfo(l.shape,l.dtype,l.values)]}},{kernelName:rl,backendName:"cpu",kernelFunc:function(e){let{inputs:t,attrs:n,backend:r}=e,{image:i,transforms:s}=t,{interpolation:a,fillMode:o,fillValue:l,outputShape:u}=n,[c,h,d,p]=i.shape,[f,g]=null!=u?u:[h,d],m=[c,f,g,p],y=ef(i.shape),b=y[0],v=y[1],w=y[2],_=ef(m),x=_[0],T=_[1],I=_[2],k=et(i.dtype,q(m));k.fill(l);let S=r.data.get(i.dataId).values,E=r.data.get(s.dataId).values;for(let e=0;e<c;++e){let t=1===s.shape[0]?E:E.subarray(8*e,8*e+8);for(let n=0;n<f;++n)for(let r=0;r<g;++r)for(let i=0;i<p;++i){let s;let u=t[6]*r+t[7]*n+1;if(0===u)continue;let c=(t[0]*r+t[1]*n+t[2])/u,p=(t[3]*r+t[4]*n+t[5])/u,f=IZ(c,d,o),g=IZ(p,h,o);switch(a){case"nearest":s=I6(S,h,d,b,v,w,e,g,f,i,l);break;case"bilinear":s=I5(S,h,d,b,v,w,e,g,f,i,l);break;default:throw Error(`Error in Transform: Expect 'nearest' or 'bilinear', but got ${a}`)}k[e*x+n*T+r*I+i]=s}return r.makeTensorInfo(m,i.dtype,k)}return{dataId:r.write(k,m,i.dtype),shape:i.shape,dtype:i.dtype}}},wg,{kernelName:rc,backendName:"cpu",kernelFunc:function(e){let{inputs:t,attrs:n,backend:r}=e,{axis:i}=n,{x:s}=t;vC(s,"unique");let{outputValues:a,outputShape:o,indices:l}=I8(r.data.get(s.dataId).values,i,s.shape,s.dtype);return[r.makeTensorInfo(o,s.dtype,a),r.makeTensorInfo([l.length],"int32",l)]}},{kernelName:rh,backendName:"cpu",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{value:i}=t,{axis:s}=r;s<0&&(s+=i.shape.length);let a=i.shape.length,o=i.shape[s],l=Array(a-1),u=0;for(let e=0;e<a;e++)e!==s&&(l[u++]=i.shape[e]);let c=Array(a).fill(0),h=i.shape.slice();h[s]=1;let d=Array(o);for(let e=0;e<d.length;e++){c[s]=e;let t=wB({inputs:{x:i},backend:n,attrs:{begin:c,size:h}});d[e]=wt({inputs:{x:t},backend:n,attrs:{shape:l}}),n.disposeIntermediateTensorInfo(t)}return d}},{kernelName:rd,backendName:"cpu",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{x:i,segmentIds:s}=t,{numSegments:a}=r;vC(i,"unsortedSegmentSum");let o=i.shape.length,l=s.shape.length,u=[],c=[],h=o-l,d=s;for(let e=0;e<h;++e){let t=_j({inputs:{input:d},backend:n,attrs:{dim:e+1}});d=t,c.push(t)}for(let e=0;e<a;++e){let t=rX(e,"int32"),r=n.makeTensorInfo([],"int32",t),s=_N({inputs:{a:r,b:d},backend:n}),a=v4({inputs:{x:s},backend:n,attrs:{dtype:"float32"}}),o=_T({inputs:{a:a,b:i},backend:n}),l=_k({inputs:{x:o},backend:n,attrs:{axis:0,keepDims:!1}});u.push(l),c.push(r),c.push(s),c.push(a),c.push(o),c.push(l)}let p=Tv({inputs:u,backend:n,attrs:{axis:0}});return c.forEach(e=>n.disposeIntermediateTensorInfo(e)),p}},Tm])rE(e);let I7={},I9={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function ke(e,t){I7[e]=t}function kt(e,t){if(!(e in I7)||null!=t){let n=kr(e,t);if(null===n)return console.log("Could not get context for WebGL version",e),null;I7[e]=n}let n=I7[e];return null==n||n.isContextLost()?(delete I7[e],kt(e)):(n.disable(n.DEPTH_TEST),n.disable(n.STENCIL_TEST),n.disable(n.BLEND),n.disable(n.DITHER),n.disable(n.POLYGON_OFFSET_FILL),n.disable(n.SAMPLE_COVERAGE),n.enable(n.SCISSOR_TEST),n.enable(n.CULL_FACE),n.cullFace(n.BACK),I7[e])}function kn(e){if(!eN().getBool("IS_SAFARI")&&"undefined"!=typeof OffscreenCanvas&&2===e)return new OffscreenCanvas(300,150);if("undefined"!=typeof document)return document.createElement("canvas");throw Error("Cannot create a canvas in this context")}function kr(e,t){if(1!==e&&2!==e)throw Error("Cannot get WebGL rendering context, WebGL is disabled.");let n=null==t?kn(e):t;return(n.addEventListener("webglcontextlost",t=>{t.preventDefault(),delete I7[e]},!1),eN().getBool("SOFTWARE_WEBGL_ENABLED")&&(I9.failIfMajorPerformanceCaveat=!1),1===e)?n.getContext("webgl",I9)||n.getContext("experimental-webgl",I9):n.getContext("webgl2",I9)}function ki(e,t){return[t,e]}function ks(e,t){return e*t}function ka(e){return X(Math.ceil(q(e)/4))}function ko(e,t){return[Math.max(1,Math.ceil(t/2)),Math.max(1,Math.ceil(e/2))]}function kl(e,t){let[n,r]=ko(e,t);return n*r*4}function ku(e,t){let n,r,i,s,a,o,l,u,c,h;let d=e;return 2===eN().getNumber("WEBGL_VERSION")?(n=d.R32F,r=d.R16F,i=d.RGBA16F,s=d.RGBA32F,a=d.RED,l=4,u=1,c=d.HALF_FLOAT,h=d.FLOAT,o=d.RGBA8):(n=e.RGBA,r=e.RGBA,i=e.RGBA,s=d.RGBA,a=e.RGBA,l=4,u=4,c=null!=t?t.HALF_FLOAT_OES:null,h=e.FLOAT,o=e.RGBA),{internalFormatFloat:n,internalFormatHalfFloat:r,internalFormatPackedHalfFloat:i,internalFormatPackedFloat:s,textureFormatFloat:a,downloadTextureFormat:o,downloadUnpackNumChannels:l,defaultNumChannels:u,textureTypeHalfFloat:c,textureTypeFloat:h}}function kc(e,t){let n=t();return eN().getBool("DEBUG")&&kh(e),n}function kh(e){let t=e.getError();if(t!==e.NO_ERROR)throw Error("WebGL Error: "+kg(e,t))}!function(e){e[e.DENSE=0]="DENSE",e[e.SHARED_BATCH=1]="SHARED_BATCH"}(k||(k={})),function(e){e[e.RENDER=0]="RENDER",e[e.UPLOAD=1]="UPLOAD",e[e.PIXELS=2]="PIXELS",e[e.DOWNLOAD=3]="DOWNLOAD"}(S||(S={})),function(e){e[e.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",e[e.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",e[e.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",e[e.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",e[e.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"}(E||(E={}));let kd=596e-10,kp=65504;function kf(e){return!!(eN().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||0===e||kd<Math.abs(e)&&Math.abs(e)<kp)}function kg(e,t){switch(t){case e.NO_ERROR:return"NO_ERROR";case e.INVALID_ENUM:return"INVALID_ENUM";case e.INVALID_VALUE:return"INVALID_VALUE";case e.INVALID_OPERATION:return"INVALID_OPERATION";case e.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case e.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case e.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return`Unknown error code ${t}`}}function km(e,t){return kL(e,()=>e.getExtension(t),'Extension "'+t+'" not supported on this browser.')}function ky(e,t){let n=kL(e,()=>e.createShader(e.VERTEX_SHADER),"Unable to create vertex WebGLShader.");if(kc(e,()=>e.shaderSource(n,t)),kc(e,()=>e.compileShader(n)),!1===e.getShaderParameter(n,e.COMPILE_STATUS))throw console.log(e.getShaderInfoLog(n)),Error("Failed to compile vertex shader.");return n}function kb(e,t){let n=kL(e,()=>e.createShader(e.FRAGMENT_SHADER),"Unable to create fragment WebGLShader.");if(kc(e,()=>e.shaderSource(n,t)),kc(e,()=>e.compileShader(n)),eN().get("ENGINE_COMPILE_ONLY"))return n;if(!1===e.getShaderParameter(n,e.COMPILE_STATUS))throw kw(t,e.getShaderInfoLog(n)),Error("Failed to compile fragment shader.");return n}let kv=/ERROR: [0-9]+:([0-9]+):/g;function kw(e,t){let n=kv.exec(t);if(null==n){console.log(`Couldn't parse line number in error: ${t}`),console.log(e);return}let r=+n[1],i=e.split("\n"),s=i.length.toString().length+2,a=i.map((e,t)=>Y((t+1).toString(),s)+e),o=0;for(let e=0;e<a.length;e++)o=Math.max(a[e].length,o);let l=a.slice(0,r-1),u=a.slice(r-1,r),c=a.slice(r);console.log(l.join("\n")),console.log(t.split("\n")[0]),console.log(`%c ${Y(u[0],o)}`,"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(c.join("\n"))}function k_(e){return kL(e,()=>e.createProgram(),"Unable to create WebGLProgram.")}function kx(e,t){if(kc(e,()=>e.linkProgram(t)),!eN().get("ENGINE_COMPILE_ONLY")&&!1===e.getProgramParameter(t,e.LINK_STATUS))throw console.log(e.getProgramInfoLog(t)),Error("Failed to link vertex and fragment shaders.")}function kT(e,t){if(kc(e,()=>e.validateProgram(t)),!1===e.getProgramParameter(t,e.VALIDATE_STATUS))throw console.log(e.getProgramInfoLog(t)),Error("Shader program validation failed.")}function kI(e,t){let n=kL(e,()=>e.createBuffer(),"Unable to create WebGLBuffer");return kc(e,()=>e.bindBuffer(e.ARRAY_BUFFER,n)),kc(e,()=>e.bufferData(e.ARRAY_BUFFER,t,e.STATIC_DRAW)),n}function kk(e,t){let n=kL(e,()=>e.createBuffer(),"Unable to create WebGLBuffer");return kc(e,()=>e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,n)),kc(e,()=>e.bufferData(e.ELEMENT_ARRAY_BUFFER,t,e.STATIC_DRAW)),n}function kS(e){return kL(e,()=>e.createTexture(),"Unable to create WebGLTexture.")}function kE(e,t){let n=eN().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(e<=0||t<=0)throw Error(`Requested texture size [${e}x${t}] is invalid.`);if(e>n||t>n)throw Error(`Requested texture size [${e}x${t}] greater than WebGL maximum on this browser / GPU [${n}x${n}].`)}function kC(e){return kL(e,()=>e.createFramebuffer(),"Unable to create WebGLFramebuffer.")}function kA(e,t,n,r,i,s,a){let o=e.getAttribLocation(t,n);return -1!==o&&(kc(e,()=>e.bindBuffer(e.ARRAY_BUFFER,r)),kc(e,()=>e.vertexAttribPointer(o,i,e.FLOAT,!1,s,a)),kc(e,()=>e.enableVertexAttribArray(o)),!0)}function kN(e,t,n){kz(e,n),kc(e,()=>e.activeTexture(e.TEXTURE0+n)),kc(e,()=>e.bindTexture(e.TEXTURE_2D,t))}function kO(e,t,n){return kL(e,()=>e.getUniformLocation(t,n),'uniform "'+n+'" not present in program.')}function k$(e,t,n){return e.getUniformLocation(t,n)}function kR(e,t,n,r){kc(e,()=>kN(e,t,r)),kc(e,()=>e.uniform1i(n,r))}function kD(e,t,n){kc(e,()=>e.bindFramebuffer(e.FRAMEBUFFER,n)),kc(e,()=>e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t,0))}function kF(e,t){kc(e,()=>e.bindFramebuffer(e.FRAMEBUFFER,t)),kc(e,()=>e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,null,0))}function kP(e){let t=e.checkFramebufferStatus(e.FRAMEBUFFER);if(t!==e.FRAMEBUFFER_COMPLETE)throw Error("Error binding framebuffer: "+kM(e,t))}function kM(e,t){switch(t){case e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case e.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return`unknown error ${t}`}}function kL(e,t,n){let r=kc(e,()=>t());if(null==r)throw Error(n);return r}function kz(e,t){let n=e.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,r=t+e.TEXTURE0;if(r<e.TEXTURE0||r>n){let e=`[gl.TEXTURE0, gl.TEXTURE${n}]`;throw Error(`textureUnit must be in ${e}.`)}}function kB(e,t=2){return q(e.slice(0,e.length-t))}function kU(e){if(0===e.length)throw Error("Cannot get rows and columns of an empty shape array.");return[e.length>1?e[e.length-2]:1,e[e.length-1]]}function kV(e){let t=[1,1,1];return 0===e.length||1===e.length&&1===e[0]||(t=[kB(e),...kU(e)]),t}function kj(e,t=!1){let n=eN().getNumber("WEBGL_MAX_TEXTURE_SIZE"),r=eN().getNumber("WEBGL_MAX_SIZE_FOR_NARROW_TEXTURE");r===1/0&&eN().getBool("WEBGL_AUTO_SQUARIFY_NARROW_TEXTURE_SHAPE")&&(r=n/2),t&&(n*=2,r*=2,1===(e=e.map((t,n)=>n>=e.length-2?B(e[n]):e[n])).length&&(e=[2,e[0]])),2!==e.length&&(e=ee(e).newShape);let i=q(e),s=null;e.length<=1&&i<=n?s=[1,i]:2===e.length&&e[0]<=n&&e[1]<=n?s=e:3===e.length&&e[0]*e[1]<=n&&e[2]<=n?s=[e[0]*e[1],e[2]]:3===e.length&&e[0]<=n&&e[1]*e[2]<=n?s=[e[0],e[1]*e[2]]:4===e.length&&e[0]*e[1]*e[2]<=n&&e[3]<=n?s=[e[0]*e[1]*e[2],e[3]]:4===e.length&&e[0]<=n&&e[1]*e[2]*e[3]<=n&&(s=[e[0],e[1]*e[2]*e[3]]);let a=null!=s&&Math.max(...s)>r&&Math.min(...s)<=(t?2:1)&&Math.min(...s)>0;if(null==s||a){if(t){let t=kB(e),n=2,r=2;e.length&&([n,r]=kU(e)),s=X(i=n/2*t*(r/2)).map(e=>2*e)}else s=X(i)}return s}function kG(e){return e%2==0}function kW(e,t){if(H(e=e.slice(-2),t=t.slice(-2))||!e.length||!t.length||0===e[0]||0===e[1]||0===t[0]||0===t[1])return!0;if(e.length!==t.length){let n=e[e.length-1],r=t[t.length-1];if(n===r||kG(n)&&kG(r)&&(1===e[0]||1===t[0]))return!0}return e[1]===t[1]&&kG(e[0])&&kG(t[0])}function kq(e){if(null==o){let t=kt(e);o=t.getParameter(t.MAX_TEXTURE_SIZE)}return o}function kH(e){if(null==l){let t=kt(e);l=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,l)}function kK(e){if(0===e)return 0;let t=kt(e);return kX(t,"EXT_disjoint_timer_query_webgl2")&&2===e?2:kX(t,"EXT_disjoint_timer_query")?1:0}function kX(e,t){return null!=e.getExtension(t)}function kY(e){try{let t=kt(e);if(null!=t)return!0}catch(e){console.log("Error when getting WebGL context: ",e)}return!1}function kQ(e){if(0===e)return!1;let t=kt(e);if(1===e){if(!kX(t,"OES_texture_float"))return!1}else if(!kX(t,"EXT_color_buffer_float"))return!1;return kZ(t)}function kJ(e){if(0===e)return!1;let t=kt(e);if(1===e){if(!kX(t,"OES_texture_float")||!kX(t,"WEBGL_color_buffer_float"))return!1}else{if(kX(t,"EXT_color_buffer_float"))return kZ(t);let e="EXT_color_buffer_half_float";if(kX(t,e)){let n=t.getExtension(e);return k0(t,n)}return!1}return kZ(t)}function kZ(e){let t=ku(e),n=e.createTexture();e.bindTexture(e.TEXTURE_2D,n);let r=1,i=1;e.texImage2D(e.TEXTURE_2D,0,t.internalFormatFloat,r,i,0,t.textureFormatFloat,t.textureTypeFloat,null);let s=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,s),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,n,0);let a=e.checkFramebufferStatus(e.FRAMEBUFFER)===e.FRAMEBUFFER_COMPLETE;return e.bindTexture(e.TEXTURE_2D,null),e.bindFramebuffer(e.FRAMEBUFFER,null),e.deleteTexture(n),e.deleteFramebuffer(s),a}function k0(e,t){let n=ku(e,t),r=e.createTexture();e.bindTexture(e.TEXTURE_2D,r);let i=1,s=1;e.texImage2D(e.TEXTURE_2D,0,n.internalFormatHalfFloat,i,s,0,n.textureFormatFloat,n.textureTypeHalfFloat,null);let a=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,a),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,r,0);let o=e.checkFramebufferStatus(e.FRAMEBUFFER)===e.FRAMEBUFFER_COMPLETE;return e.bindTexture(e.TEXTURE_2D,null),e.bindFramebuffer(e.FRAMEBUFFER,null),e.deleteTexture(r),e.deleteFramebuffer(a),o}function k1(e){return 2===e&&null!=kt(e).fenceSync}function k2(e,t){Array.isArray(e)||(e=[e]),e.forEach(e=>{null!=e&&j("complex64"!==e.dtype,()=>`${t} does not support complex64 tensors in the WebGL backend.`)})}let k3=eN();function k4(){let e,t,n,r,i,s,a,o,l,u;return 2===eN().getNumber("WEBGL_VERSION")?(e="#version 300 es",t="in",n="out",r="in",i="texture",s="outputColor",a="out vec4 outputColor;",o=eN().getBool("WEBGL2_ISNAN_CUSTOM")?`
      bool isnan_custom(float val) {
        uint floatToUint = floatBitsToUint(val);
        return (floatToUint & 0x7fffffffu) > 0x7f800000u;
      }

      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan_custom(val.x),
          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));
      }

      #define isnan(value) isnan_custom(value)
    `:"",l="",u=`
      #define round(value) newRound(value)
      int newRound(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 newRound(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `):(e="",t="attribute",n="varying",r="varying",i="texture2D",s="gl_FragColor",a="",o=`
      #define isnan(value) isnan_custom(value)
      bool isnan_custom(float val) {
        return (val > 0. || val < 1. || val == 0.) ? false : true;
      }
      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));
      }
    `,l=`
      uniform float INFINITY;

      bool isinf(float val) {
        return abs(val) == INFINITY;
      }
      bvec4 isinf(vec4 val) {
        return equal(abs(val), vec4(INFINITY));
      }
    `,u=`
      int round(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 round(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `),{version:e,attribute:t,varyingVs:n,varyingFs:r,texture2D:i,output:s,defineOutput:a,defineSpecialNaN:o,defineSpecialInf:l,defineRound:u}}function k6(e,t,n="index"){let r=ef(t);return r.map((t,i)=>{let s=`int ${e[i]} = ${n} / ${t}`,a=i===r.length-1?`int ${e[i+1]} = ${n} - ${e[i]} * ${t}`:`index -= ${e[i]} * ${t}`;return`${s}; ${a};`}).join("")}function k5(e,t,n="index"){let r=ef(t);return r.map((t,i)=>{let s=`int ${e[i]} = ${n} / outShapeStrides[${i}]`,a=i===r.length-1?`int ${e[i+1]} = ${n} - ${e[i]} * outShapeStrides[${i}]`:`index -= ${e[i]} * outShapeStrides[${i}]`;return`${s}; ${a};`}).join("")}function k8(e,t){let n=e.length,r=e.map(e=>`${t}[${e}]`),i=Array(n-1);i[n-2]=r[n-1];for(let e=n-3;e>=0;--e)i[e]=`(${i[e+1]} * ${r[e+1]})`;return i}function k7(e,t,n="index"){let r=k8(e.map((e,t)=>t),t);return r.map((t,i)=>{let s=`int ${e[i]} = ${n} / ${r[i]}`,a=i===r.length-1?`int ${e[i+1]} = ${n} - ${e[i]} * ${r[i]}`:`index -= ${e[i]} * ${r[i]}`;return`${s}; ${a};`}).join("")}function k9(e){let t=ef(e).map(e=>e.toString());return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * ${t[0]} + coords.y * ${t[1]} + coords.z;
  }
`}function Se(){return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * outShapeStrides[0] + coords.y * outShapeStrides[1] + coords.z;
  }
`}k3.registerFlag("HAS_WEBGL",()=>k3.getNumber("WEBGL_VERSION")>0),k3.registerFlag("WEBGL_VERSION",()=>kY(2)?2:kY(1)?1:0),k3.registerFlag("WEBGL_CHECK_NUMERICAL_PROBLEMS",()=>!1),k3.registerFlag("WEBGL_BUFFER_SUPPORTED",()=>2===k3.get("WEBGL_VERSION")),k3.registerFlag("WEBGL_CPU_FORWARD",()=>!0),k3.registerFlag("WEBGL_FORCE_F16_TEXTURES",()=>!1),k3.registerFlag("WEBGL_PACK",()=>k3.getBool("HAS_WEBGL")),k3.registerFlag("WEBGL_PACK_NORMALIZATION",()=>k3.getBool("WEBGL_PACK")),k3.registerFlag("WEBGL_PACK_CLIP",()=>k3.getBool("WEBGL_PACK")),k3.registerFlag("WEBGL_PACK_DEPTHWISECONV",()=>k3.getBool("WEBGL_PACK")),k3.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",()=>k3.getBool("WEBGL_PACK")),k3.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",()=>k3.getBool("WEBGL_PACK")),k3.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",()=>k3.getBool("WEBGL_PACK")),k3.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",()=>k3.getBool("WEBGL_PACK")),k3.registerFlag("WEBGL_PACK_REDUCE",()=>k3.getBool("WEBGL_PACK")),k3.registerFlag("WEBGL_LAZILY_UNPACK",()=>k3.getBool("WEBGL_PACK")),k3.registerFlag("WEBGL_CONV_IM2COL",()=>k3.getBool("WEBGL_PACK")),k3.registerFlag("WEBGL_PACK_CONV2DTRANSPOSE",()=>k3.getBool("WEBGL_PACK")),k3.registerFlag("WEBGL_MAX_TEXTURE_SIZE",()=>kq(k3.getNumber("WEBGL_VERSION"))),k3.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",()=>kH(k3.getNumber("WEBGL_VERSION"))),k3.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",()=>{let e=k3.getNumber("WEBGL_VERSION");return 0===e?0:kK(e)}),k3.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",()=>k3.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&!iM()),k3.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",()=>kQ(k3.getNumber("WEBGL_VERSION"))),k3.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",()=>!k3.getBool("WEBGL_FORCE_F16_TEXTURES")&&k3.getBool("WEBGL_RENDER_FLOAT32_CAPABLE")),k3.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",()=>kJ(k3.getNumber("WEBGL_VERSION"))),k3.registerFlag("WEBGL_FENCE_API_ENABLED",()=>k1(k3.getNumber("WEBGL_VERSION"))),k3.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",()=>k3.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0),k3.registerFlag("WEBGL_DELETE_TEXTURE_THRESHOLD",()=>-1,e=>{if("number"!=typeof e)throw Error(`WEBGL_DELETE_TEXTURE_THRESHOLD must be a number but got ${e}.`);if(e<0&&-1!==e)throw Error(`WEBGL_DELETE_TEXTURE_THRESHOLD must be -1 (indicating never delete) or at least 0, but got ${e}.`)}),k3.registerFlag("WEBGL_FLUSH_THRESHOLD",()=>iM()?1:-1,e=>{if("number"!=typeof e)throw Error(`WEBGL_FLUSH_THRESHOLD must be a number but got ${e}.`);if(e<0&&-1!==e)throw Error(`WEBGL_FLUSH_THRESHOLD must be -1 (indicating never manual flush) or at least 0, but got ${e}.`)}),k3.registerFlag("CPU_HANDOFF_SIZE_THRESHOLD",()=>128),k3.registerFlag("WEBGL_USE_SHAPES_UNIFORMS",()=>!1),k3.registerFlag("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD",()=>1e5),k3.registerFlag("TOPK_K_CPU_HANDOFF_THRESHOLD",()=>128),k3.registerFlag("WEBGL_EXP_CONV",()=>!1),k3.registerFlag("SOFTWARE_WEBGL_ENABLED",()=>k3.getBool("IS_TEST")),k3.registerFlag("WEBGL_MAX_SIZE_FOR_NARROW_TEXTURE",()=>1/0),k3.registerFlag("WEBGL_AUTO_SQUARIFY_NARROW_TEXTURE_SHAPE",()=>!1),k3.registerFlag("WEBGL2_ISNAN_CUSTOM",()=>!1),k3.registerFlag("ENGINE_COMPILE_ONLY",()=>!1);let St=`
  const float FLOAT_MAX = 1.70141184e38;
  const float FLOAT_MIN = 1.17549435e-38;

  lowp vec4 encode_float(highp float v) {
    if (isnan(v)) {
      return vec4(255, 255, 255, 255);
    }

    highp float av = abs(v);

    if(av < FLOAT_MIN) {
      return vec4(0.0, 0.0, 0.0, 0.0);
    } else if(v > FLOAT_MAX) {
      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;
    } else if(v < -FLOAT_MAX) {
      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;
    }

    highp vec4 c = vec4(0,0,0,0);

    highp float e = floor(log2(av));
    highp float m = exp2(fract(log2(av))) - 1.0;

    c[2] = floor(128.0 * m);
    m -= c[2] / 128.0;
    c[1] = floor(32768.0 * m);
    m -= c[1] / 32768.0;
    c[0] = floor(8388608.0 * m);

    highp float ebias = e + 127.0;
    c[3] = floor(ebias / 2.0);
    ebias -= c[3] * 2.0;
    c[2] += floor(ebias) * 128.0;

    c[3] += 128.0 * step(0.0, -v);

    return c / 255.0;
  }
`,{getBroadcastDims:Sn}=O;function Sr(e,t,n){let r,i;let s=[];if(e.forEach(e=>{let t=q(e.shapeInfo.logicalShape);if(e.shapeInfo.isUniform?s.push(`uniform float ${e.name}${t>1?`[${t}]`:""};`):(s.push(`uniform sampler2D ${e.name};`),s.push(`uniform int offset${e.name};`)),n.enableShapeUniforms){let{uniformShape:t}=SW(n.packedInputs,e.shapeInfo.logicalShape,e.shapeInfo.texShape);switch(t.length){case 1:s.push(`uniform int ${e.name}Shape;`);break;case 2:s.push(`uniform ivec2 ${e.name}Shape;`);break;case 3:s.push(`uniform ivec3 ${e.name}Shape;`);break;case 4:s.push(`uniform ivec4 ${e.name}Shape;`)}s.push(`uniform ivec2 ${e.name}TexShape;`)}}),n.enableShapeUniforms){switch(t.logicalShape.length){case 1:s.push("uniform int outShape;");break;case 2:s.push("uniform ivec2 outShape;"),s.push("uniform int outShapeStrides;");break;case 3:s.push("uniform ivec3 outShape;"),s.push("uniform ivec2 outShapeStrides;");break;case 4:s.push("uniform ivec4 outShape;"),s.push("uniform ivec3 outShapeStrides;")}s.push("uniform ivec2 outTexShape;")}n.customUniforms&&n.customUniforms.forEach(e=>{s.push(`uniform ${e.type} ${e.name}${e.arrayIndex?`[${e.arrayIndex}]`:""};`)});let a=s.join("\n"),o=e.map(e=>Sa(e,t,n.packedInputs,n.enableShapeUniforms)).join("\n"),l=t.texShape,u=k4(),c=Su(u),h=Sd(u);return t.isPacked?(r=So(t.logicalShape,l,n.enableShapeUniforms),i=Sh(u)):(r=Sl(t.logicalShape,l,n.enableShapeUniforms),i=Sc(u)),n.packedInputs&&(h+=Sm),[h,c,i,a,r,o,n.userCode].join("\n")}function Si(e,t=!1){let n=e.shapeInfo.logicalShape;switch(n.length){case 0:return SN(e,t);case 1:return S$(e,t);case 2:return SD(e,t);case 3:return SP(e,t);case 4:return SL(e,t);case 5:return Sz(e);case 6:return SB(e);default:throw Error(`${n.length}-D input sampling is not yet supported`)}}function Ss(e,t){switch(e.shapeInfo.logicalShape.length){case 0:return SA(e);case 1:return SO(e,t);case 2:return SR(e,t);case 3:return SF(e,t);default:return SM(e,t)}}function Sa(e,t,n=!1,r){let i="";n?i+=Ss(e,r):i+=Si(e,r);let s=e.shapeInfo.logicalShape,a=t.logicalShape;return s.length<=a.length&&(n?i+=SV(e,t):i+=Sj(e,t)),i}function So(e,t,n){switch(e.length){case 0:return Sy();case 1:return Sb(e,t,n);case 2:return SS(e,t,n);case 3:return Sw(e,t,n);default:return Sx(e,t,n)}}function Sl(e,t,n){switch(e.length){case 0:return Sy();case 1:return Sv(e,t,n);case 2:return SE(e,t,n);case 3:return S_(e,t,n);case 4:return ST(e,t,n);case 5:return SI(e,t);case 6:return Sk(e,t);default:throw Error(`${e.length}-D output sampling is not yet supported`)}}function Su(e){return`
    float sampleTexture(sampler2D textureSampler, vec2 uv) {
      return ${e.texture2D}(textureSampler, uv).r;
    }
  `}function Sc(e){return`
    void setOutput(float val) {
      ${e.output} = vec4(val, 0, 0, 0);
    }
  `}function Sh(e){return`
    void setOutput(vec4 val) {
      ${e.output} = val;
    }
  `}function Sd(e){return`${e.version}
    precision highp float;
    precision highp int;
    precision highp sampler2D;
    ${e.varyingFs} vec2 resultUV;
    ${e.defineOutput}
    const vec2 halfCR = vec2(0.5, 0.5);

    struct ivec5
    {
      int x;
      int y;
      int z;
      int w;
      int u;
    };

    struct ivec6
    {
      int x;
      int y;
      int z;
      int w;
      int u;
      int v;
    };

    uniform float NAN;
    ${e.defineSpecialNaN}
    ${e.defineSpecialInf}
    ${e.defineRound}

    int imod(int x, int y) {
      return x - y * (x / y);
    }

    int idiv(int a, int b, float sign) {
      int res = a / b;
      int mod = imod(a, b);
      if (sign < 0. && mod != 0) {
        res -= 1;
      }
      return res;
    }

    //Based on the work of Dave Hoskins
    //https://www.shadertoy.com/view/4djSRW
    #define HASHSCALE1 443.8975
    float random(float seed){
      vec2 p = resultUV * seed;
      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);
      p3 += dot(p3, p3.yzx + 19.19);
      return fract((p3.x + p3.y) * p3.z);
    }

    ${Sp}
    ${Sf}
    ${Sg}
  `}let Sp=`
vec2 uvFromFlat(int texNumR, int texNumC, int index) {
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
vec2 packedUVfrom1D(int texNumR, int texNumC, int index) {
  int texelIndex = index / 2;
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,Sf=`
vec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,
  int texNumC, int row, int col) {
  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,Sg=`
vec2 packedUVfrom3D(int texNumR, int texNumC,
    int texelsInBatch, int texelsInLogicalRow, int b,
    int row, int col) {
  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,Sm=`
  float getChannel(vec4 frag, vec2 innerDims) {
    vec2 modCoord = mod(innerDims, 2.);
    return modCoord.x == 0. ?
      (modCoord.y == 0. ? frag.r : frag.g) :
      (modCoord.y == 0. ? frag.b : frag.a);
  }
  float getChannel(vec4 frag, int dim) {
    float modCoord = mod(float(dim), 2.);
    return modCoord == 0. ? frag.r : frag.g;
  }
`;function Sy(){return`
    int getOutputCoords() {
      return 0;
    }
  `}function Sb(e,t,n){let r=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)];return 1===r[0]?n?`
      int getOutputCoords() {
        return 2 * int(resultUV.x * ceil(float(outTexShape[1]) / 2.0));
      }
    `:`
      int getOutputCoords() {
        return 2 * int(resultUV.x * ${r[1]}.0);
      }
    `:1===r[1]?n?`
      int getOutputCoords() {
        return 2 * int(resultUV.y * ceil(float(outTexShape[0]) / 2.0));
      }
    `:`
      int getOutputCoords() {
        return 2 * int(resultUV.y * ${r[0]}.0);
      }
    `:n?`
    int getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      return 2 * (resTexRC.x * packedTexShape[1] + resTexRC.y);
    }
  `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${r[0]}, ${r[1]}));
      return 2 * (resTexRC.x * ${r[1]} + resTexRC.y);
    }
  `}function Sv(e,t,n){return 1===t[0]?n?`
      int getOutputCoords() {
        return int(resultUV.x * float(outTexShape[1]));
      }
    `:`
      int getOutputCoords() {
        return int(resultUV.x * ${t[1]}.0);
      }
    `:1===t[1]?n?`
      int getOutputCoords() {
        return int(resultUV.y * float(outTexShape[0]));
      }
    `:`
      int getOutputCoords() {
        return int(resultUV.y * ${t[0]}.0);
      }
    `:n?`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(outTexShape[0], outTexShape[1]));
      return resTexRC.x * outTexShape[1] + resTexRC.y;
    }
  `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${t[0]}, ${t[1]}));
      return resTexRC.x * ${t[1]} + resTexRC.y;
    }
  `}function Sw(e,t,n){if(n)return`
    ivec3 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      int texelsInLogicalRow = int(ceil(float(outShape[2]) / 2.0));
      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;

      int b = index / texelsInBatch;
      index -= b * texelsInBatch;

      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec3(b, r, c);
    }
  `;let r=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)],i=Math.ceil(e[2]/2),s=i*Math.ceil(e[1]/2);return`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${r[0]}, ${r[1]}));
      int index = resTexRC.x * ${r[1]} + resTexRC.y;

      int b = index / ${s};
      index -= b * ${s};

      int r = 2 * (index / ${i});
      int c = imod(index, ${i}) * 2;

      return ivec3(b, r, c);
    }
  `}function S_(e,t,n){if(n){let t=k5(["r","c","d"],e);return`
  ivec3 getOutputCoords() {
    ivec2 resTexRC = ivec2(resultUV.yx *
                           vec2(outTexShape[0], outTexShape[1]));
    int index = resTexRC.x * outTexShape[1] + resTexRC.y;
    ${t}
    return ivec3(r, c, d);
  }
`}let r=k6(["r","c","d"],e);return`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${t[0]}, ${t[1]}));
      int index = resTexRC.x * ${t[1]} + resTexRC.y;
      ${r}
      return ivec3(r, c, d);
    }
  `}function Sx(e,t,n){if(n)return`
    ivec4 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;

      int texelsInLogicalRow = int(ceil(float(outShape[3]) / 2.0));
      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[2]) / 2.0));
      int texelsInBatchN = texelsInBatch * outShape[1];

      int b2 = index / texelsInBatchN;
      index -= b2 * texelsInBatchN;

      int b = index / texelsInBatch;
      index -= b * texelsInBatch;

      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec4(b2, b, r, c);
    }
  `;let r=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)],i=Math.ceil(e[e.length-1]/2),s=i*Math.ceil(e[e.length-2]/2),a=s,o="",l="b, r, c";for(let t=2;t<e.length-1;t++)a*=e[e.length-t-1],o=`
      int b${t} = index / ${a};
      index -= b${t} * ${a};
    `+o,l=`b${t}, `+l;return`
    ivec${e.length} getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${r[0]}, ${r[1]}));
      int index = resTexRC.x * ${r[1]} + resTexRC.y;

      ${o}

      int b = index / ${s};
      index -= b * ${s};

      int r = 2 * (index / ${i});
      int c = imod(index, ${i}) * 2;

      return ivec${e.length}(${l});
    }
  `}function ST(e,t,n){if(n){let t=k5(["r","c","d","d2"],e);return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(outTexShape[0], outTexShape[1]));
      int index = resTexRC.x * outTexShape[1] + resTexRC.y;
      ${t}
      return ivec4(r, c, d, d2);
    }
  `}let r=k6(["r","c","d","d2"],e);return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(${t[0]}, ${t[1]}));
      int index = resTexRC.x * ${t[1]} + resTexRC.y;
      ${r}
      return ivec4(r, c, d, d2);
    }
  `}function SI(e,t){let n=k6(["r","c","d","d2","d3"],e);return`
    ivec5 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx * vec2(${t[0]},
                             ${t[1]}));

      int index = resTexRC.x * ${t[1]} + resTexRC.y;

      ${n}

      ivec5 outShape = ivec5(r, c, d, d2, d3);
      return outShape;
    }
  `}function Sk(e,t){let n=k6(["r","c","d","d2","d3","d4"],e);return`
    ivec6 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(${t[0]}, ${t[1]}));
      int index = resTexRC.x * ${t[1]} + resTexRC.y;

      ${n}

      ivec6 result = ivec6(r, c, d, d2, d3, d4);
      return result;
    }
  `}function SS(e,t,n){let r=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)];if(H(e,t))return n?`
      ivec2 getOutputCoords() {
        ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
        return 2 * ivec2(resultUV.yx * vec2(packedTexShape[0], packedTexShape[1]));
      }
    `:`
      ivec2 getOutputCoords() {
        return 2 * ivec2(resultUV.yx * vec2(${r[0]}, ${r[1]}));
      }
    `;let i=Math.ceil(e[1]/2);return n?`
    ivec2 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      int texelsInLogicalRow = int(ceil(float(outShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));

      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;
      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec2(r, c);
    }
  `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${r[0]}, ${r[1]}));

      int index = resTexRC.x * ${r[1]} + resTexRC.y;
      int r = 2 * (index / ${i});
      int c = imod(index, ${i}) * 2;

      return ivec2(r, c);
    }
  `}function SE(e,t,n){return H(e,t)?n?`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(outTexShape[0], outTexShape[1]));
      }
    `:`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(${t[0]}, ${t[1]}));
      }
    `:1===e[1]?n?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(outTexShape[0], outTexShape[1]));
        int index = resTexRC.x * outTexShape[1] + resTexRC.y;
        return ivec2(index, 0);
      }
    `:`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(${t[0]}, ${t[1]}));
        int index = resTexRC.x * ${t[1]} + resTexRC.y;
        return ivec2(index, 0);
      }
    `:1===e[0]?n?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(outTexShape[0], outTexShape[1]));
        int index = resTexRC.x * outTexShape[1] + resTexRC.y;
        return ivec2(0, index);
      }
    `:`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(${t[0]}, ${t[1]}));
        int index = resTexRC.x * ${t[1]} + resTexRC.y;
        return ivec2(0, index);
      }
    `:n?`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(outTexShape[0], outTexShape[1]));
      int index = resTexRC.x * outTexShape[1] + resTexRC.y;
      int r = index / outShape[1];
      int c = index - r * outShape[1];
      return ivec2(r, c);
    }
  `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${t[0]}, ${t[1]}));
      int index = resTexRC.x * ${t[1]} + resTexRC.y;
      int r = index / ${e[1]};
      int c = index - r * ${e[1]};
      return ivec2(r, c);
    }
  `}function SC(e){return`offset${e}`}function SA(e){let t=e.name,n="get"+t.charAt(0).toUpperCase()+t.slice(1),r=k4();return`
    vec4 ${n}() {
      return ${r.texture2D}(${t}, halfCR);
    }
  `}function SN(e,t){let n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1);if(e.shapeInfo.isUniform)return`float ${r}() {return ${n};}`;let[i,s]=e.shapeInfo.texShape;if(1===i&&1===s)return`
      float ${r}() {
        return sampleTexture(${n}, halfCR);
      }
    `;let a=SC(n);if(t)return`
    float ${r}() {
      vec2 uv = uvFromFlat(${n}TexShape[0], ${n}TexShape[1], ${a});
      return sampleTexture(${n}, uv);
    }
  `;let[o,l]=e.shapeInfo.texShape;return`
    float ${r}() {
      vec2 uv = uvFromFlat(${o}, ${l}, ${a});
      return sampleTexture(${n}, uv);
    }
  `}function SO(e,t){let n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),i=e.shapeInfo.texShape,s=k4();if(t)return`
    vec4 ${r}(int index) {
      ivec2 packedTexShape = ivec2(ceil(float(${n}TexShape[0]) / 2.0), ceil(float(${n}TexShape[1]) / 2.0));
      vec2 uv = packedUVfrom1D(
        packedTexShape[0], packedTexShape[1], index);
      return ${s.texture2D}(${n}, uv);
    }
  `;let a=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)];return`
    vec4 ${r}(int index) {
      vec2 uv = packedUVfrom1D(
        ${a[0]}, ${a[1]}, index);
      return ${s.texture2D}(${n}, uv);
    }
  `}function S$(e,t){let n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1);if(e.shapeInfo.isUniform)return`
      float ${r}(int index) {
        ${SU(e)}
      }
    `;let i=e.shapeInfo.texShape,s=i[0],a=i[1];if(1===a&&1===s)return`
      float ${r}(int index) {
        return sampleTexture(${n}, halfCR);
      }
    `;let o=SC(n);return 1===a?t?`
      float ${r}(int index) {
        vec2 uv = vec2(0.5, (float(index + ${o}) + 0.5) / float(${n}TexShape[0]));
        return sampleTexture(${n}, uv);
      }
    `:`
      float ${r}(int index) {
        vec2 uv = vec2(0.5, (float(index + ${o}) + 0.5) / ${s}.0);
        return sampleTexture(${n}, uv);
      }
    `:1===s?t?`
      float ${r}(int index) {
        vec2 uv = vec2((float(index + ${o}) + 0.5) / float(${n}TexShape[1]), 0.5);
        return sampleTexture(${n}, uv);
      }
    `:`
      float ${r}(int index) {
        vec2 uv = vec2((float(index + ${o}) + 0.5) / ${a}.0, 0.5);
        return sampleTexture(${n}, uv);
      }
    `:t?`
    float ${r}(int index) {
      vec2 uv = uvFromFlat(${n}TexShape[0], ${n}TexShape[1], index + ${o});
      return sampleTexture(${n}, uv);
    }
  `:`
    float ${r}(int index) {
      vec2 uv = uvFromFlat(${s}, ${a}, index + ${o});
      return sampleTexture(${n}, uv);
    }
  `}function SR(e,t){let n=e.shapeInfo.logicalShape,r=e.name,i="get"+r.charAt(0).toUpperCase()+r.slice(1),s=e.shapeInfo.texShape,a=s[0],o=s[1],l=k4();if(null!=s&&H(n,s))return t?`
      vec4 ${i}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${r}TexShape[1], ${r}TexShape[0]);

        return ${l.texture2D}(${r}, uv);
      }
    `:`
      vec4 ${i}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${o}.0, ${a}.0);

        return ${l.texture2D}(${r}, uv);
      }
    `;if(t)return`
    vec4 ${i}(int row, int col) {
      ivec2 packedTexShape = ivec2(ceil(float(${r}TexShape[0]) / 2.0), ceil(float(${r}TexShape[1]) / 2.0));
      int valuesPerRow = int(ceil(float(${r}Shape[1]) / 2.0));
      vec2 uv = packedUVfrom2D(valuesPerRow, packedTexShape[0], packedTexShape[1], row, col);
      return ${l.texture2D}(${r}, uv);
    }
  `;let u=[Math.ceil(s[0]/2),Math.ceil(s[1]/2)],c=Math.ceil(n[1]/2);return`
    vec4 ${i}(int row, int col) {
      vec2 uv = packedUVfrom2D(${c}, ${u[0]}, ${u[1]}, row, col);
      return ${l.texture2D}(${r}, uv);
    }
  `}function SD(e,t){let n=e.shapeInfo.logicalShape,r=e.name,i="get"+r.charAt(0).toUpperCase()+r.slice(1),s=e.shapeInfo.texShape;if(null!=s&&H(n,s)){if(t)return`
      float ${i}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${r}TexShape[1], ${r}TexShape[0]);
        return sampleTexture(${r}, uv);
      }
    `;let e=s[0],n=s[1];return`
    float ${i}(int row, int col) {
      vec2 uv = (vec2(col, row) + halfCR) / vec2(${n}.0, ${e}.0);
      return sampleTexture(${r}, uv);
    }
  `}let{newShape:a,keptDims:o}=ee(n),l=a;if(l.length<n.length){let n=Sq(e,l),r=["row","col"];return`
      ${Si(n,t)}
      float ${i}(int row, int col) {
        return ${i}(${SH(r,o)});
      }
    `}if(e.shapeInfo.isUniform)return`
      float ${i}(int row, int col) {
        int index = round(dot(vec2(row, col), vec2(${n[1]}, 1)));
        ${SU(e)}
      }
    `;let u=s[0],c=s[1],h=SC(r);return 1===c?t?`
      float ${i}(int row, int col) {
        float index = dot(vec3(row, col, ${h}), vec3(${r}Shape[1], 1, 1));
        vec2 uv = vec2(0.5, (index + 0.5) / float(${r}TexShape[0]));
        return sampleTexture(${r}, uv);
      }
    `:`
    float ${i}(int row, int col) {
      float index = dot(vec3(row, col, ${h}), vec3(${n[1]}, 1, 1));
      vec2 uv = vec2(0.5, (index + 0.5) / ${u}.0);
      return sampleTexture(${r}, uv);
    }
  `:1===u?t?`
      float ${i}(int row, int col) {
        float index = dot(vec3(row, col, ${h}), vec3(${r}Shape[1], 1, 1));
        vec2 uv = vec2((index + 0.5) / float(${r}TexShape[1]), 0.5);
        return sampleTexture(${r}, uv);
      }
    `:`
    float ${i}(int row, int col) {
      float index = dot(vec3(row, col, ${h}), vec3(${n[1]}, 1, 1));
      vec2 uv = vec2((index + 0.5) / ${c}.0, 0.5);
      return sampleTexture(${r}, uv);
    }
  `:t?`
      float ${i}(int row, int col) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * ${r}Shape[1] + col + ${h};
        vec2 uv = uvFromFlat(${r}TexShape[0], ${r}TexShape[1], index);
        return sampleTexture(${r}, uv);
      }
    `:`
  float ${i}(int row, int col) {
    // Explicitly use integer operations as dot() only works on floats.
    int index = row * ${n[1]} + col + ${h};
    vec2 uv = uvFromFlat(${u}, ${c}, index);
    return sampleTexture(${r}, uv);
  }
`}function SF(e,t){let n=e.shapeInfo.logicalShape,r=e.name,i="get"+r.charAt(0).toUpperCase()+r.slice(1),s=e.shapeInfo.texShape,a=[Math.ceil(s[0]/2),Math.ceil(s[1]/2)];if(1===n[0]){let r=n.slice(1),s=[1,2],a=Sq(e,r),o=["b","row","col"];return`
        ${Ss(a,t)}
        vec4 ${i}(int b, int row, int col) {
          return ${i}(${SH(o,s)});
        }
      `}let o=k4();if(t)return`
    vec4 ${i}(int b, int row, int col) {
      ivec2 packedTexShape = ivec2(ceil(float(${r}TexShape[0]) / 2.0), ceil(float(${r}TexShape[1]) / 2.0));
      int valuesPerRow = int(ceil(float(${r}Shape[2]) / 2.0));
      int texelsInBatch = valuesPerRow * int(ceil(float(${r}Shape[1]) / 2.0));
      vec2 uv = packedUVfrom3D(
        packedTexShape[0], packedTexShape[1], texelsInBatch, valuesPerRow, b, row, col);
      return ${o.texture2D}(${r}, uv);
    }
  `;let l=a[0],u=a[1],c=Math.ceil(n[2]/2),h=c*Math.ceil(n[1]/2);return`
    vec4 ${i}(int b, int row, int col) {
      vec2 uv = packedUVfrom3D(
        ${l}, ${u}, ${h}, ${c}, b, row, col);
      return ${o.texture2D}(${r}, uv);
    }
  `}function SP(e,t){let n=e.shapeInfo.logicalShape,r=e.name,i="get"+r.charAt(0).toUpperCase()+r.slice(1),s=n[1]*n[2],a=n[2],{newShape:o,keptDims:l}=ee(n),u=o;if(u.length<n.length){let n=Sq(e,u),r=["row","col","depth"];return`
        ${Si(n,t)}
        float ${i}(int row, int col, int depth) {
          return ${i}(${SH(r,l)});
        }
      `}if(e.shapeInfo.isUniform)return`
      float ${i}(int row, int col, int depth) {
        int index = round(dot(vec3(row, col, depth),
                          vec3(${s}, ${a}, 1)));
        ${SU(e)}
      }
    `;let c=e.shapeInfo.texShape,h=c[0],d=c[1],p=e.shapeInfo.flatOffset;if(d===s&&null==p)return t?`
      float ${i}(int row, int col, int depth) {
        int stride1 = ${r}Shape[2];
        float texR = float(row);
        float texC = dot(vec2(col, depth), vec2(stride1, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${r}TexShape[1], ${r}TexShape[0]);
        return sampleTexture(${r}, uv);
      }
    `:`
        float ${i}(int row, int col, int depth) {
          float texR = float(row);
          float texC = dot(vec2(col, depth), vec2(${a}, 1));
          vec2 uv = (vec2(texC, texR) + halfCR) /
                     vec2(${d}.0, ${h}.0);
          return sampleTexture(${r}, uv);
        }
      `;if(d===a&&null==p)return t?`
      float ${i}(int row, int col, int depth) {
        float texR = dot(vec2(row, col), vec2(${r}Shape[1], 1));
        float texC = float(depth);
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${r}TexShape[1], ${r}TexShape[0]);
        return sampleTexture(${r}, uv);
      }
    `:`
    float ${i}(int row, int col, int depth) {
      float texR = dot(vec2(row, col), vec2(${n[1]}, 1));
      float texC = float(depth);
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${d}.0, ${h}.0);
      return sampleTexture(${r}, uv);
    }
  `;let f=SC(r);return t?`
    float ${i}(int row, int col, int depth) {
      // Explicitly use integer operations as dot() only works on floats.
      int stride0 = ${r}Shape[1] * ${r}Shape[2];
      int stride1 = ${r}Shape[2];
      int index = row * stride0 + col * stride1 + depth + ${f};
      vec2 uv = uvFromFlat(${r}TexShape[0], ${r}TexShape[1], index);
      return sampleTexture(${r}, uv);
    }
    `:`
      float ${i}(int row, int col, int depth) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * ${s} + col * ${a} + depth + ${f};
        vec2 uv = uvFromFlat(${h}, ${d}, index);
        return sampleTexture(${r}, uv);
      }
  `}function SM(e,t){let n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),i=k4();if(t)return`
    vec4 ${r}(int b2, int b, int row, int col) {
      int valuesPerRow = int(ceil(float(${n}Shape[3]) / 2.0));
      int texelsInBatch = valuesPerRow * int(ceil(float(${n}Shape[2]) / 2.0));
      int index = b * texelsInBatch + (row / 2) * valuesPerRow + (col / 2);
      texelsInBatch *= ${n}Shape[1];
      index = b2 * texelsInBatch + index;
      ivec2 packedTexShape = ivec2(ceil(float(${n}TexShape[0]) / 2.0), ceil(float(${n}TexShape[1]) / 2.0));
      int texR = index / packedTexShape[1];
      int texC = index - texR * packedTexShape[1];
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(packedTexShape[1], packedTexShape[0]); return ${i.texture2D}(${n}, uv);
    }
  `;let s=e.shapeInfo.logicalShape,a=s.length,o=e.shapeInfo.texShape,l=[Math.ceil(o[0]/2),Math.ceil(o[1]/2)],u=l[0],c=l[1],h=Math.ceil(s[a-1]/2),d=h*Math.ceil(s[a-2]/2),p="int b, int row, int col",f=`b * ${d} + (row / 2) * ${h} + (col / 2)`;for(let e=2;e<a-1;e++)p=`int b${e}, `+p,d*=s[a-e-1],f=`b${e} * ${d} + `+f;return`
    vec4 ${r}(${p}) {
      int index = ${f};
      int texR = index / ${c};
      int texC = index - texR * ${c};
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${c}, ${u});
      return ${i.texture2D}(${n}, uv);
    }
  `}function SL(e,t){let n=e.shapeInfo.logicalShape,r=e.name,i="get"+r.charAt(0).toUpperCase()+r.slice(1),s=n[3],a=n[2]*s,o=n[1]*a,{newShape:l,keptDims:u}=ee(n);if(l.length<n.length){let n=Sq(e,l),r=["row","col","depth","depth2"];return`
      ${Si(n,t)}
      float ${i}(int row, int col, int depth, int depth2) {
        return ${i}(${SH(r,u)});
      }
    `}if(e.shapeInfo.isUniform)return`
      float ${i}(int row, int col, int depth, int depth2) {
        int index = round(dot(vec4(row, col, depth, depth2),
                          vec4(${o}, ${a}, ${s}, 1)));
        ${SU(e)}
      }
    `;let c=e.shapeInfo.flatOffset,h=e.shapeInfo.texShape,d=h[0],p=h[1],f=`int stride2 = ${r}Shape[3];`,g=`int stride1 = ${r}Shape[2] * stride2;`,m=`int stride0 = ${r}Shape[1] * stride1;`;if(p===o&&null==c)return t?`
      float ${i}(int row, int col, int depth, int depth2) {
        ${f}
        ${g}
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(stride1, stride2, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${r}TexShape[1], ${r}TexShape[0]);
        return sampleTexture(${r}, uv);
      }
    `:`
      float ${i}(int row, int col, int depth, int depth2) {
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(${a}, ${s}, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${p}.0, ${d}.0);
        return sampleTexture(${r}, uv);
      }
    `;if(p===s&&null==c)return t?`
      float ${i}(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(${r}Shape[1] * ${r}Shape[2], ${r}Shape[2], 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${r}TexShape[1], ${r}TexShape[0]);
        return sampleTexture(${r}, uv);
      }
    `:`
      float ${i}(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(${n[1]*n[2]}, ${n[2]}, 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${p}.0, ${d}.0);
        return sampleTexture(${r}, uv);
      }
    `;let y=SC(r);return t?`
    float ${i}(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      ${f}
      ${g}
      ${m}
      int index = row * stride0 + col * stride1 +
          depth * stride2 + depth2;
      vec2 uv = uvFromFlat(${r}TexShape[0], ${r}TexShape[1], index + ${y});
      return sampleTexture(${r}, uv);
    }
  `:`
    float ${i}(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${o} + col * ${a} +
          depth * ${s} + depth2;
      vec2 uv = uvFromFlat(${d}, ${p}, index + ${y});
      return sampleTexture(${r}, uv);
    }
  `}function Sz(e){let t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),i=t[4],s=t[3]*i,a=t[2]*s,o=t[1]*a,{newShape:l,keptDims:u}=ee(t);if(l.length<t.length){let t=Sq(e,l),n=["row","col","depth","depth2","depth3"];return`
      ${Si(t)}
      float ${r}(int row, int col, int depth, int depth2, int depth3) {
        return ${r}(${SH(n,u)});
      }
    `}if(e.shapeInfo.isUniform)return`
      float ${r}(int row, int col, int depth, int depth2, int depth3) {
        float index = dot(
          vec4(row, col, depth, depth2),
          vec4(${o}, ${a}, ${s}, ${i})) +
          depth3;
        ${SU(e)}
      }
    `;let c=e.shapeInfo.flatOffset,h=e.shapeInfo.texShape,d=h[0],p=h[1];if(p===o&&null==c)return`
      float ${r}(int row, int col, int depth, int depth2, int depth3) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
                         vec4(${a}, ${s}, ${i}, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${p}.0, ${d}.0);
        return sampleTexture(${n}, uv);
      }
    `;if(p===i&&null==c)return`
      float ${r}(int row, int col, int depth, int depth2, int depth3) {
        float texR = dot(
          vec4(row, col, depth, depth2),
          vec4(${t[1]*t[2]*t[3]},
               ${t[2]*t[3]}, ${t[3]}, 1));
        int texC = depth3;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${p}.0, ${d}.0);
        return sampleTexture(${n}, uv);
      }
    `;let f=SC(n);return`
    float ${r}(int row, int col, int depth, int depth2, int depth3) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${o} + col * ${a} + depth * ${s} +
          depth2 * ${i} + depth3 + ${f};
      vec2 uv = uvFromFlat(${d}, ${p}, index);
      return sampleTexture(${n}, uv);
    }
  `}function SB(e){let t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),{newShape:i,keptDims:s}=ee(t);if(i.length<t.length){let t=Sq(e,i),n=["row","col","depth","depth2","depth3","depth4"];return`
      ${Si(t)}
      float ${r}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        return ${r}(${SH(n,s)});
      }
    `}let a=t[5],o=t[4]*a,l=t[3]*o,u=t[2]*l,c=t[1]*u;if(e.shapeInfo.isUniform)return`
      float ${r}(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
        int index = round(dot(
          vec4(row, col, depth, depth2),
          vec4(${c}, ${u}, ${l}, ${o})) +
          dot(
            vec2(depth3, depth4),
            vec2(${a}, 1)));
        ${SU(e)}
      }
    `;let h=e.shapeInfo.flatOffset,d=e.shapeInfo.texShape,p=d[0],f=d[1];if(f===c&&null==h)return`
      float ${r}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
          vec4(${u}, ${l}, ${o}, ${a})) +
               float(depth4);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${f}.0, ${p}.0);
        return sampleTexture(${n}, uv);
      }
    `;if(f===a&&null==h)return`
      float ${r}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        float texR = dot(vec4(row, col, depth, depth2),
          vec4(${t[1]*t[2]*t[3]*t[4]},
               ${t[2]*t[3]*t[4]},
               ${t[3]*t[4]},
               ${t[4]})) + float(depth3);
        int texC = depth4;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${f}.0, ${p}.0);
        return sampleTexture(${n}, uv);
      }
    `;let g=SC(n);return`
    float ${r}(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${c} + col * ${u} + depth * ${l} +
          depth2 * ${o} + depth3 * ${a} + depth4 + ${g};
      vec2 uv = uvFromFlat(${p}, ${f}, index);
      return sampleTexture(${n}, uv);
    }
  `}function SU(e){let t=e.name,n=q(e.shapeInfo.logicalShape);return n<2?`return ${t};`:`
    for (int i = 0; i < ${n}; i++) {
      if (i == index) {
        return ${t}[i];
      }
    }
  `}function SV(e,t){let n;let r=e.name,i=r.charAt(0).toUpperCase()+r.slice(1),s="get"+i+"AtOutCoords",a=e.shapeInfo.logicalShape.length,o=t.logicalShape.length,l=Sn(e.shapeInfo.logicalShape,t.logicalShape),u=SG(o),c=o-a,h=["x","y","z","w","u","v"];n=0===a?"":o<2&&l.length>=1?"coords = 0;":l.map(e=>`coords.${h[e+c]} = 0;`).join("\n");let d="";d=o<2&&a>0?"coords":e.shapeInfo.logicalShape.map((e,t)=>`coords.${h[t+c]}`).join(", ");let p="return outputValue;",f=1===q(e.shapeInfo.logicalShape),g=1===q(t.logicalShape);if(1!==a||f||g){if(f&&!g)p=1===o?`
        return vec4(outputValue.x, outputValue.x, 0., 0.);
      `:`
        return vec4(outputValue.x);
      `;else if(l.length){let e=a-2,t=a-1;l.indexOf(e)>-1&&l.indexOf(t)>-1?p="return vec4(outputValue.x);":l.indexOf(e)>-1?p="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":l.indexOf(t)>-1&&(p="return vec4(outputValue.xx, outputValue.zz);")}}else p=`
      return vec4(outputValue.xy, outputValue.xy);
    `;return`
    vec4 ${s}() {
      ${u} coords = getOutputCoords();
      ${n}
      vec4 outputValue = get${i}(${d});
      ${p}
    }
  `}function Sj(e,t){let n;let r=e.name,i=r.charAt(0).toUpperCase()+r.slice(1),s="get"+i+"AtOutCoords",a=t.texShape,o=e.shapeInfo.texShape,l=e.shapeInfo.logicalShape.length,u=t.logicalShape.length;if(!e.shapeInfo.isUniform&&l===u&&null==e.shapeInfo.flatOffset&&H(o,a))return`
      float ${s}() {
        return sampleTexture(${r}, resultUV);
      }
    `;let c=SG(u),h=Sn(e.shapeInfo.logicalShape,t.logicalShape),d=u-l,p=["x","y","z","w","u","v"];n=0===l?"":u<2&&h.length>=1?"coords = 0;":h.map(e=>`coords.${p[e+d]} = 0;`).join("\n");let f="";return f=u<2&&l>0?"coords":e.shapeInfo.logicalShape.map((e,t)=>`coords.${p[t+d]}`).join(", "),`
    float ${s}() {
      ${c} coords = getOutputCoords();
      ${n}
      return get${i}(${f});
    }
  `}function SG(e){if(e<=1)return"int";if(2===e)return"ivec2";if(3===e)return"ivec3";if(4===e)return"ivec4";if(5===e)return"ivec5";if(6===e)return"ivec6";throw Error(`GPU for rank ${e} is not yet supported`)}function SW(e,t,n){let{newShape:r,keptDims:i}=ee(t),s=t.length,a=e&&3===s&&1===t[0],o=a?t.slice(1):r,l=!e&&s>1&&!H(t,n)&&r.length<s||a,u=l?o:t;return{useSqueezeShape:l,uniformShape:u,keptDims:i}}function Sq(e,t){let n=JSON.parse(JSON.stringify(e));return n.shapeInfo.logicalShape=t,n}function SH(e,t){return t.map(t=>e[t]).join(", ")}function SK(e,t,n,r){let i=n.map((e,n)=>{let r={logicalShape:e.shape,texShape:e.isUniform?null:e.texData.texShape,isUniform:e.isUniform,isPacked:!e.isUniform&&e.texData.isPacked,flatOffset:null};return null!=e.texData&&null!=e.texData.slice&&e.texData.slice.flatOffset>0&&(r.flatOffset=e.texData.slice.flatOffset),{name:t.variableNames[n],shapeInfo:r}}),s=i.map(e=>e.shapeInfo),a={logicalShape:r.shape,texShape:r.texData.texShape,isUniform:!1,isPacked:r.texData.isPacked,flatOffset:null},o=Sr(i,a,t),l=kb(e.gl,o),u=e.createProgram(l);return eN().get("ENGINE_COMPILE_ONLY")?{program:t,fragmentShader:l,source:o,webGLProgram:u,inShapeInfos:s,outShapeInfo:a,variablesLocations:null,customUniformLocations:null,infLoc:null,nanLoc:null,outShapeLocation:null,outShapeStridesLocation:null,outTexShapeLocation:null}:(e.buildVao(u),Object.assign({program:t,fragmentShader:l,source:o,webGLProgram:u,inShapeInfos:s,outShapeInfo:a},SX(e,t,u)))}function SX(e,t,n){let r,i,s;let a=[],o=[],l=null,u=null;u=e.getUniformLocation(n,"NAN",!1),1===eN().getNumber("WEBGL_VERSION")&&(l=e.getUniformLocation(n,"INFINITY",!1));let c=!1;for(let r of t.variableNames){let i={name:r,uniform:e.getUniformLocation(n,r,c),offset:e.getUniformLocation(n,`offset${r}`,c)};t.enableShapeUniforms&&(i.shape=e.getUniformLocation(n,`${r}Shape`,c),i.texShape=e.getUniformLocation(n,`${r}TexShape`,c)),a.push(i)}if(t.enableShapeUniforms&&(r=e.getUniformLocation(n,"outShape",c),s=e.getUniformLocation(n,"outShapeStrides",c),i=e.getUniformLocation(n,"outTexShape",c)),t.customUniforms)for(let r of t.customUniforms)o.push(e.getUniformLocation(n,r.name,c));return{variablesLocations:a,customUniformLocations:o,infLoc:l,nanLoc:u,outShapeLocation:r,outShapeStridesLocation:s,outTexShapeLocation:i}}function SY(e,t){if(e.length!==t.length)throw Error(`Binary was compiled with ${e.length} inputs, but was executed with ${t.length} inputs`);e.forEach((e,n)=>{let r=e.logicalShape,i=t[n],s=i.shape;if(!H(r,s))throw Error(`Binary was compiled with different shapes than the current args. Shapes ${r} and ${s} must match`);if(e.isUniform&&i.isUniform)return;let a=e.texShape,o=i.isUniform?null:i.texData.texShape;if(!H(a,o))throw Error(`Binary was compiled with different texture shapes than the current args. Shape ${a} and ${o} must match`)})}function SQ(e,t,n,r,i){t.program.enableShapeUniforms||(SY(t.inShapeInfos,n),SY([t.outShapeInfo],[r]));let s=r.texData.texture,a=r.texData.texShape;r.texData.isPacked?e.setOutputPackedMatrixTexture(s.texture,a[0],a[1]):e.setOutputMatrixTexture(s.texture,a[0],a[1]),e.setProgram(t.webGLProgram),e.bindVertexArray(t.webGLProgram.vao),1===eN().getNumber("WEBGL_VERSION")&&null!==t.infLoc&&e.gl.uniform1f(t.infLoc,1/0),null!==t.nanLoc&&e.gl.uniform1f(t.nanLoc,NaN);for(let r=0;r<n.length;++r){let i=n[r],{uniform:s,offset:a,shape:o,texShape:l}=t.variablesLocations[r];if(o){let{uniformShape:n}=SW(t.program.packedInputs,i.shape,i.texData.texShape);switch(n.length){case 1:e.gl.uniform1iv(o,new Int32Array(n));break;case 2:e.gl.uniform2iv(o,new Int32Array(n));break;case 3:e.gl.uniform3iv(o,new Int32Array(n));break;case 4:e.gl.uniform4iv(o,new Int32Array(n))}}if(l&&e.gl.uniform2i(l,i.texData.texShape[0],i.texData.texShape[1]),null!=s){if(i.isUniform){if(2>q(i.shape))e.gl.uniform1f(s,i.uniformValues[0]);else{let t=i.uniformValues;t instanceof Float32Array||(t=new Float32Array(t)),e.gl.uniform1fv(s,t)}continue}null!=i.texData.slice&&null!=a&&e.gl.uniform1i(a,i.texData.slice.flatOffset),e.setInputMatrixTexture(i.texData.texture.texture,s,r)}}let o=t.outShapeLocation;if(o)switch(r.shape.length){case 1:e.gl.uniform1iv(o,new Int32Array(r.shape));break;case 2:e.gl.uniform2iv(o,new Int32Array(r.shape));break;case 3:e.gl.uniform3iv(o,new Int32Array(r.shape));break;case 4:e.gl.uniform4iv(o,new Int32Array(r.shape))}if(t.outShapeStridesLocation){let n=ef(r.shape);switch(r.shape.length){case 2:e.gl.uniform1iv(t.outShapeStridesLocation,new Int32Array(n));break;case 3:e.gl.uniform2iv(t.outShapeStridesLocation,new Int32Array(n));break;case 4:e.gl.uniform3iv(t.outShapeStridesLocation,new Int32Array(n))}}if(t.outTexShapeLocation&&e.gl.uniform2i(t.outTexShapeLocation,r.texData.texShape[0],r.texData.texShape[1]),t.program.customUniforms&&i)for(let n=0;n<t.program.customUniforms.length;++n){let r=t.program.customUniforms[n],s=t.customUniformLocations[n],a=i[n];if("float"===r.type)e.gl.uniform1fv(s,a);else if("vec2"===r.type)e.gl.uniform2fv(s,a);else if("vec3"===r.type)e.gl.uniform3fv(s,a);else if("vec4"===r.type)e.gl.uniform4fv(s,a);else if("int"===r.type)e.gl.uniform1iv(s,a);else if("ivec2"===r.type)e.gl.uniform2iv(s,a);else if("ivec3"===r.type)e.gl.uniform3iv(s,a);else if("ivec4"===r.type)e.gl.uniform4iv(s,a);else throw Error(`uniform type ${r.type} is not supported yet.`)}e.executeProgram()}function SJ(e,t,n){let r="";t.concat(n).forEach(t=>{let i=null!=t.texData&&null!=t.texData.slice&&t.texData.slice.flatOffset>0;if(e.enableShapeUniforms&&!t.isUniform){let s=t.texData.texShape,{useSqueezeShape:a,uniformShape:o,keptDims:l}=SW(e.packedInputs,t.shape,s),u="",c="",h="";if(1===o.length&&e.packedInputs){let e=[Math.ceil(s[0]/2),Math.ceil(s[1]/2)];u=`${e[0]>1}_${e[1]>1}`}else if(2!==o.length||e.packedInputs){if(o.length>2&&!e.packedInputs){let e=ef(o);h=`${e[0]===s[1]}_${e[e.length-1]===s[1]}`}}else c=`${o[0]>1}_${o[1]>1}`;let d=t.shape.length,p=2===o.length&&H(t.shape,s),f=1===q(t.shape),g=ay(t.shape,n.shape),m=!e.packedInputs&&d===n.shape.length&&H(s,n.texData.texShape),y=e.packedInputs||o.length>2?"":`${s[0]>1}_${s[1]>1}`;r+=`${d}_${m}_${a?l:""}_${o.length}_${f}_${g}_${p}_${u}_${c}_${h}_${y}_${i}`}else{let e=t.isUniform?"uniform":t.texData.texShape;r+=`${t.shape}_${e}_${i}`}});let i=e.userCode;return e.constructor.name+("_"+r+"_"+i)+`${eN().getNumber("WEBGL_VERSION")}`}function SZ(e){return eN().getBool("WEBGL_USE_SHAPES_UNIFORMS")&&e<=4}class S0{constructor(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=k.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];let t=k4();this.outputShape=e,this.enableShapeUniforms=SZ(this.outputShape.length),this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        ${this.enableShapeUniforms?k5(["r","c","d"],e):k6(["r","c","d"],e)}
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));
        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getA(rc.x, rc.y, rc.z);
        }

        ${t.output} = result;
      }
    `}}class S1{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=k.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];let t=k4();this.outputShape=e,this.enableShapeUniforms=SZ(this.outputShape.length),this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        ${this.enableShapeUniforms?k5(["r","c","d"],e):k6(["r","c","d"],e)}
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));
        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));
        }

        ${t.output} = result;
      }
    `}}class S2{constructor(e){this.variableNames=["A"],this.outTexUsage=S.DOWNLOAD;let t=k4();this.outputShape=e,this.userCode=`
      ${St}

      void main() {
        float x = getAAtOutCoords();
        ${t.output} = encode_float(x);
      }
    `}}class S3{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=S.DOWNLOAD;let t=k4();this.outputShape=e,this.userCode=`
      ${St}

      void main() {
        ivec3 coords = getOutputCoords();
        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));
        ${t.output} = encode_float(x);
      }
    `}}let S4={R:0,G:1,B:2,A:3};class S6{constructor(e,t=!1,n="RGBA"){this.variableNames=["A"],this.customUniforms=[{name:"texShape",type:"ivec2"}];let r=k4();this.outputShape=e,this.enableShapeUniforms=SZ(this.outputShape.length);let i="result";t&&(i="floor(result * 255. + 0.5)");let s="";for(let e=0;e<n.length;e++){let t=n[e];s+=`
          if(offset == ${e}) {
            result = values[${S4[t]}];
          }`}this.userCode=`
      ${this.enableShapeUniforms?Se():k9(e)}

      void main() {
        ivec3 coords = getOutputCoords();
        int flatIndex = getFlatIndex(coords);
        float result = 0.;
        int offset = imod(flatIndex, ${n.length});

        flatIndex = idiv(flatIndex, ${n.length}, 1.);

        int r = flatIndex / texShape[1];
        if (r < texShape[0]) {
          int c = imod(flatIndex, texShape[1]);
          vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);
          vec4 values = ${r.texture2D}(A, uv);
          ${s}
        }
        ${r.output} = vec4(${i}, 0., 0., 0.);
      }
    `}}class S5{constructor(e,t=!1){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.customUniforms=[{name:"texShape",type:"ivec2"}];let n=k4();this.outputShape=e,this.enableShapeUniforms=SZ(this.outputShape.length);let r="",i="result";t&&(i="floor(result * 255. + 0.5)");for(let t=0;t<=1;t++)for(let i=0;i<=1;i++){let s=2*t+i;r+=`
          localCoords = coords;
          if(localCoords[2] + ${i} < ${this.enableShapeUniforms?"outShape[2]":`${e[2]}`}) {
          localCoords[2] += ${i};
          if (localCoords[1] + ${t} < ${this.enableShapeUniforms?"outShape[1]":`${e[1]}`}) {
            localCoords[1] += ${t};

            flatIndex = getFlatIndex(localCoords);
            offset = imod(flatIndex, 4);

            flatIndex = idiv(flatIndex, 4, 1.);

            int r = flatIndex / texShape[1];
            int c = imod(flatIndex, texShape[1]);
            vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);
            values = ${n.texture2D}(A, uv);

            if (offset == 0) {
              result[${s}] = values[0];
            } else if (offset == 1) {
              result[${s}] = values[1];
            } else if (offset == 2) {
              result[${s}] = values[2];
            } else {
              result[${s}] = values[3];
            }
          }
        }
        `}this.userCode=`
        ${this.enableShapeUniforms?Se():k9(e)}

        void main() {
          ivec3 coords = getOutputCoords();

          vec4 result = vec4(0.);
          int flatIndex, r, c, offset;
          ivec3 localCoords;
          vec2 uv;
          vec4 values;

          ${r}

          ${n.output} = ${i};
        }
    `}}function S8(e){let t=k4();return ky(e,`${t.version}
    precision highp float;
    ${t.attribute} vec3 clipSpacePos;
    ${t.attribute} vec2 uv;
    ${t.varyingVs} vec2 resultUV;

    void main() {
      gl_Position = vec4(clipSpacePos, 1);
      resultUV = uv;
    }`)}function S7(e){return kI(e,new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]))}function S9(e){return kk(e,new Uint16Array([0,1,2,2,1,3]))}function Ee(e,t,n,r,i,s){kE(t,n);let a=kS(e),o=e.TEXTURE_2D;return kc(e,()=>e.bindTexture(o,a)),kc(e,()=>e.texParameteri(o,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE)),kc(e,()=>e.texParameteri(o,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE)),kc(e,()=>e.texParameteri(o,e.TEXTURE_MIN_FILTER,e.NEAREST)),kc(e,()=>e.texParameteri(o,e.TEXTURE_MAG_FILTER,e.NEAREST)),1===eN().getNumber("WEBGL_VERSION")?kc(e,()=>e.texImage2D(o,0,r,t,n,0,i,s,null)):kc(e,()=>e.texStorage2D(o,1,r,t,n)),kc(e,()=>e.bindTexture(e.TEXTURE_2D,null)),{texture:a,texShape:[n,t]}}function Et(e){return e.internalFormatFloat}function En(e,t,n,r){let[i,s]=ki(t,n);return Ee(e,i,s,Et(r),r.textureFormatFloat,e.FLOAT)}function Er(e){return e.internalFormatHalfFloat}function Ei(e,t,n,r){let[i,s]=ki(t,n);return Ee(e,i,s,Er(r),r.textureFormatFloat,r.textureTypeHalfFloat)}function Es(e){return e.downloadTextureFormat}function Ea(e,t,n,r){let[i,s]=ki(t,n);return Ee(e,i,s,Es(r),e.RGBA,e.UNSIGNED_BYTE)}function Eo(e){return e.internalFormatPackedFloat}function El(e,t,n,r){let[i,s]=ko(t,n);return Ee(e,i,s,Eo(r),e.RGBA,e.FLOAT)}function Eu(e){return e.internalFormatPackedHalfFloat}function Ec(e,t,n,r){let[i,s]=ko(t,n);return Ee(e,i,s,Eu(r),e.RGBA,r.textureTypeHalfFloat)}function Eh(e,t,n){let r=0,i=12,s=20;return kc(e,()=>e.bindBuffer(e.ARRAY_BUFFER,n)),kA(e,t,"clipSpacePos",n,3,s,r)&&kA(e,t,"uv",n,2,s,i)}function Ed(e,t,n,r,i,s){let a,o,l;kc(e,()=>e.bindTexture(e.TEXTURE_2D,t)),i instanceof Uint8Array?(a=new Uint8Array(n*r*4),o=e.UNSIGNED_BYTE,l=e.RGBA):(a=new Float32Array(n*r*4),o=e.FLOAT,l=s.internalFormatPackedFloat),a.set(i),2===eN().getNumber("WEBGL_VERSION")?kc(e,()=>e.texSubImage2D(e.TEXTURE_2D,0,0,0,n,r,e.RGBA,o,a)):kc(e,()=>e.texImage2D(e.TEXTURE_2D,0,l,n,r,0,e.RGBA,o,a)),kc(e,()=>e.bindTexture(e.TEXTURE_2D,null))}function Ep(e,t,n){kc(e,()=>e.bindTexture(e.TEXTURE_2D,t)),n.data instanceof Uint8Array?2===eN().getNumber("WEBGL_VERSION")?kc(e,()=>e.texSubImage2D(e.TEXTURE_2D,0,0,0,n.width,n.height,e.RGBA,e.UNSIGNED_BYTE,n.data)):kc(e,()=>e.texImage2D(e.TEXTURE_2D,0,e.RGBA,n.width,n.height,0,e.RGBA,e.UNSIGNED_BYTE,n.data)):2===eN().getNumber("WEBGL_VERSION")?kc(e,()=>e.texSubImage2D(e.TEXTURE_2D,0,0,0,e.RGBA,e.UNSIGNED_BYTE,n)):kc(e,()=>e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,n)),kc(e,()=>e.bindTexture(e.TEXTURE_2D,null))}function Ef(e,t,n,r){let i=e.createBuffer();kc(e,()=>e.bindBuffer(e.PIXEL_PACK_BUFFER,i));let s=16*t*n;return kc(e,()=>e.bufferData(e.PIXEL_PACK_BUFFER,s,e.STREAM_READ)),kc(e,()=>e.readPixels(0,0,n,t,e.RGBA,e.FLOAT,0)),kc(e,()=>e.bindBuffer(e.PIXEL_PACK_BUFFER,null)),i}function Eg(e,t,n){let r=e,i=new Float32Array(n);return r.bindBuffer(r.PIXEL_PACK_BUFFER,t),r.getBufferSubData(r.PIXEL_PACK_BUFFER,0,i),r.bindBuffer(r.PIXEL_PACK_BUFFER,null),i}function Em(e,t,n,r){let[i,s]=ki(t,n),a=new Uint8Array(ks(t*n,4));return kc(e,()=>e.readPixels(0,0,i,s,r.downloadTextureFormat,e.UNSIGNED_BYTE,a)),new Float32Array(a.buffer)}function Ey(e,t,n,r,i,s,a,o){let l=e,u=new Float32Array(kl(s,a));return l.bindBuffer(l.PIXEL_PACK_BUFFER,t),l.getBufferSubData(l.PIXEL_PACK_BUFFER,0,u),l.bindBuffer(l.PIXEL_PACK_BUFFER,null),u}function Eb(e,t,n){let r=new Float32Array(t*n*4);return kc(e,()=>e.readPixels(0,0,n,t,e.RGBA,e.FLOAT,r)),r}class Ev{constructor(e){this.outputTexture=null,this.program=null,this.disposed=!1,this.itemsToPoll=[];let t=eN().getNumber("WEBGL_VERSION");if(null!=e?(this.gl=e,ke(t,e)):this.gl=kt(t),e=this.gl,2===eN().getNumber("WEBGL_VERSION")){let t=e;this.createVertexArray=()=>kc(t,()=>t.createVertexArray()),this.bindVertexArray=e=>kc(t,()=>t.bindVertexArray(e)),this.deleteVertexArray=e=>kc(t,()=>t.deleteVertexArray(e)),this.getVertexArray=()=>kc(t,()=>t.getParameter(t.VERTEX_ARRAY_BINDING))}else if(null!=e){let t=e.getExtension("OES_vertex_array_object");if(null==t)throw Error("All WebGL1 implementations are expected to offer OES_vertex_array_object.");this.createVertexArray=()=>kc(e,()=>t.createVertexArrayOES()),this.bindVertexArray=n=>kc(e,()=>t.bindVertexArrayOES(n)),this.deleteVertexArray=n=>kc(e,()=>t.deleteVertexArrayOES(n)),this.getVertexArray=()=>kc(e,()=>e.getParameter(t.VERTEX_ARRAY_BINDING_OES))}let n="WEBGL_color_buffer_float",r="EXT_color_buffer_half_float";if(this.parallelCompilationExtension=this.gl.getExtension("KHR_parallel_shader_compile"),1===eN().getNumber("WEBGL_VERSION")){let e="OES_texture_float",t="OES_texture_half_float";if(this.textureFloatExtension=km(this.gl,e),kX(this.gl,t))this.textureHalfFloatExtension=km(this.gl,t);else if(eN().get("WEBGL_FORCE_F16_TEXTURES"))throw Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(n),kX(this.gl,r))this.colorBufferHalfFloatExtension=km(this.gl,r);else if(eN().get("WEBGL_FORCE_F16_TEXTURES"))throw Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(n="EXT_color_buffer_float",kX(this.gl,n))this.colorBufferFloatExtension=this.gl.getExtension(n);else if(kX(this.gl,r))this.colorBufferHalfFloatExtension=this.gl.getExtension(r);else throw Error("GL context does not support color renderable floats");this.vertexBuffer=S7(this.gl),this.indexBuffer=S9(this.gl),this.framebuffer=kC(this.gl),this.textureConfig=ku(this.gl,this.textureHalfFloatExtension)}get debug(){return eN().getBool("DEBUG")}dispose(){if(this.disposed)return;null!=this.program&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),null!=this.outputTexture&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");let e=this.gl;kc(e,()=>e.finish()),kc(e,()=>e.bindFramebuffer(e.FRAMEBUFFER,null)),kc(e,()=>e.deleteFramebuffer(this.framebuffer)),kc(e,()=>e.bindBuffer(e.ARRAY_BUFFER,null)),kc(e,()=>e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null)),kc(e,()=>e.deleteBuffer(this.indexBuffer)),this.disposed=!0}createFloat32MatrixTexture(e,t){return this.throwIfDisposed(),En(this.gl,e,t,this.textureConfig)}createFloat16MatrixTexture(e,t){return this.throwIfDisposed(),Ei(this.gl,e,t,this.textureConfig)}createUnsignedBytesMatrixTexture(e,t){return this.throwIfDisposed(),Ea(this.gl,e,t,this.textureConfig)}uploadPixelDataToTexture(e,t){this.throwIfDisposed(),Ep(this.gl,e,t)}uploadDenseMatrixToTexture(e,t,n,r){this.throwIfDisposed(),Ed(this.gl,e,t,n,r,this.textureConfig)}createFloat16PackedMatrixTexture(e,t){return this.throwIfDisposed(),Ec(this.gl,e,t,this.textureConfig)}createPackedMatrixTexture(e,t){return this.throwIfDisposed(),El(this.gl,e,t,this.textureConfig)}deleteMatrixTexture(e){this.throwIfDisposed(),this.outputTexture===e&&(kF(this.gl,this.framebuffer),this.outputTexture=null),kc(this.gl,()=>this.gl.deleteTexture(e))}downloadByteEncodedFloatMatrixFromOutputTexture(e,t,n){return this.downloadMatrixDriver(e,()=>Em(this.gl,t,n,this.textureConfig))}downloadPackedMatrixFromBuffer(e,t,n,r,i,s){return Ey(this.gl,e,t,n,r,i,s,this.textureConfig)}downloadFloat32MatrixFromBuffer(e,t){return Eg(this.gl,e,t)}createBufferFromTexture(e,t,n){this.bindTextureToFrameBuffer(e);let r=Ef(this.gl,t,n,this.textureConfig);return this.unbindTextureToFrameBuffer(),r}createAndWaitForFence(){let e=this.createFence(this.gl);return this.pollFence(e)}createFence(e){let t,n;if(eN().getBool("WEBGL_FENCE_API_ENABLED")){let r=e,i=r.fenceSync(r.SYNC_GPU_COMMANDS_COMPLETE,0);e.flush(),n=()=>{let e=r.clientWaitSync(i,0,0);return e===r.ALREADY_SIGNALED||e===r.CONDITION_SATISFIED},t=i}else eN().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(t=this.beginQuery(),this.endQuery(),n=()=>this.isQueryAvailable(t,eN().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))):n=()=>!0;return{query:t,isFencePassed:n}}downloadMatrixFromPackedTexture(e,t,n){return this.downloadMatrixDriver(e,()=>Eb(this.gl,t,n))}createProgram(e){this.throwIfDisposed();let t=this.gl;null==this.vertexShader&&(this.vertexShader=S8(t));let n=k_(t);kc(t,()=>t.attachShader(n,this.vertexShader)),kc(t,()=>t.attachShader(n,e)),kx(t,n);let r=Object.assign(n,{vao:this.createVertexArray()});return this.debug&&kT(t,r),r}buildVao(e){this.setProgram(e),this.bindVertexArray(e.vao);let t=this.gl;kc(t,()=>t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.indexBuffer)),Eh(t,e,this.vertexBuffer)}deleteProgram(e){this.throwIfDisposed(),e===this.program&&(this.program=null),null!=e&&(kc(this.gl,()=>this.gl.deleteProgram(e)),this.deleteVertexArray(e.vao))}setProgram(e){this.throwIfDisposed(),this.program=e,null!=this.program&&this.debug&&kT(this.gl,this.program),kc(this.gl,()=>this.gl.useProgram(e))}getUniformLocation(e,t,n=!0){return(this.throwIfDisposed(),n)?kO(this.gl,e,t):k$(this.gl,e,t)}getAttributeLocation(e,t){return this.throwIfDisposed(),kc(this.gl,()=>this.gl.getAttribLocation(e,t))}getUniformLocationNoThrow(e,t){return this.throwIfDisposed(),this.gl.getUniformLocation(e,t)}setInputMatrixTexture(e,t,n){this.throwIfDisposed(),this.throwIfNoProgram(),kR(this.gl,e,t,n)}setOutputMatrixTexture(e,t,n){this.setOutputMatrixTextureDriver(e,n,t)}setOutputPackedMatrixTexture(e,t,n){this.throwIfDisposed();let[r,i]=ko(t,n);this.setOutputMatrixTextureDriver(e,r,i)}setOutputMatrixWriteRegion(e,t,n,r){this.setOutputMatrixWriteRegionDriver(n,e,r,t)}setOutputPackedMatrixWriteRegion(e,t,n,r){throw Error("setOutputPackedMatrixWriteRegion not implemented.")}debugValidate(){null!=this.program&&kT(this.gl,this.program),kP(this.gl)}executeProgram(){this.throwIfDisposed(),this.throwIfNoProgram();let e=this.gl;this.debug&&(console.assert(this.getVertexArray()===this.program.vao,"VAO changed between setProgram and executeProgram!"),this.debugValidate()),kc(e,()=>e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0))}blockUntilAllProgramsCompleted(){this.throwIfDisposed(),kc(this.gl,()=>this.gl.finish())}getQueryTimerExtension(){return null==this.disjointQueryTimerExtension&&(this.disjointQueryTimerExtension=km(this.gl,2===eN().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension}getQueryTimerExtensionWebGL2(){return this.getQueryTimerExtension()}getQueryTimerExtensionWebGL1(){return this.getQueryTimerExtension()}beginQuery(){if(2===eN().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){let e=this.gl,t=this.getQueryTimerExtensionWebGL2(),n=e.createQuery();return e.beginQuery(t.TIME_ELAPSED_EXT,n),n}let e=this.getQueryTimerExtensionWebGL1(),t=e.createQueryEXT();return e.beginQueryEXT(e.TIME_ELAPSED_EXT,t),t}endQuery(){if(2===eN().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){let e=this.gl,t=this.getQueryTimerExtensionWebGL2();e.endQuery(t.TIME_ELAPSED_EXT);return}let e=this.getQueryTimerExtensionWebGL1();e.endQueryEXT(e.TIME_ELAPSED_EXT)}async waitForQueryAndGetTime(e){return await Q(()=>this.disposed||this.isQueryAvailable(e,eN().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))),this.getQueryTime(e,eN().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}getQueryTime(e,t){if(0===t)return null;if(2===t){let t=this.gl;return t.getQueryParameter(e,t.QUERY_RESULT)/1e6}{let t=this.getQueryTimerExtensionWebGL1();return t.getQueryObjectEXT(e,t.QUERY_RESULT_EXT)/1e6}}isQueryAvailable(e,t){if(0===t)return!0;if(2===t){let t=this.gl,n=this.getQueryTimerExtensionWebGL2(),r=t.getQueryParameter(e,t.QUERY_RESULT_AVAILABLE);return null==this.disjoint&&(this.disjoint=this.gl.getParameter(n.GPU_DISJOINT_EXT)),r&&!this.disjoint}{let t=this.getQueryTimerExtensionWebGL1(),n=t.getQueryObjectEXT(e,t.QUERY_RESULT_AVAILABLE_EXT);return null==this.disjoint&&(this.disjoint=this.gl.getParameter(t.GPU_DISJOINT_EXT)),n&&!this.disjoint}}pollFence(e){return new Promise(t=>{this.addItemToPoll(()=>e.isFencePassed(),()=>t())})}pollItems(){let e=Ew(this.itemsToPoll.map(e=>e.isDoneFn));for(let t=0;t<=e;++t){let{resolveFn:e}=this.itemsToPoll[t];e()}this.itemsToPoll=this.itemsToPoll.slice(e+1)}addItemToPoll(e,t){let n;this.itemsToPoll.push({isDoneFn:e,resolveFn:t}),this.itemsToPoll.length>1||("setTimeoutCustom"in eN().platform&&(n=eN().platform.setTimeoutCustom.bind(eN().platform)),Q(()=>(this.pollItems(),0===this.itemsToPoll.length),()=>0,null,n))}bindTextureToFrameBuffer(e){this.throwIfDisposed(),kD(this.gl,e,this.framebuffer),this.debug&&kP(this.gl)}unbindTextureToFrameBuffer(){null!=this.outputTexture?(kD(this.gl,this.outputTexture,this.framebuffer),this.debug&&kP(this.gl)):kF(this.gl,this.framebuffer)}downloadMatrixDriver(e,t){this.bindTextureToFrameBuffer(e);let n=t();return this.unbindTextureToFrameBuffer(),n}setOutputMatrixTextureDriver(e,t,n){this.throwIfDisposed();let r=this.gl;kD(r,e,this.framebuffer),this.debug&&kP(r),this.outputTexture=e,kc(r,()=>r.viewport(0,0,t,n)),kc(r,()=>r.scissor(0,0,t,n))}setOutputMatrixWriteRegionDriver(e,t,n,r){this.throwIfDisposed(),kc(this.gl,()=>this.gl.scissor(e,t,n,r))}throwIfDisposed(){if(this.disposed)throw Error("Attempted to use disposed GPGPUContext.")}throwIfNoProgram(){if(null==this.program)throw Error("No GPU program is currently set.")}}function Ew(e){let t=0;for(;t<e.length&&e[t]();++t);return t-1}let{mx:E_,XI:Ex,Nk:ET,f6:EI,ct:Ek,YG:ES,hH:EE,z3:EC,sG:EA,uM:EN,vS:EO,qB:E$,GG:ER,rq:ED,lg:EF,WR:EP,cu:EM,GE:EL,px:Ez,jC:EB,He:EU,hE:EV,BF:Ej,Dk:EG,cl:EW,_B:Eq,ub:EH,_f:EK,Ku:EX,qy:EY,Zy:EQ,bu:EJ,zv:EZ,dH:E0,HS:E1,yH:E2,l3:E3,z9:E4,x6:E6,_m:E5,eW:E8,GK:E7,SP:E9,yr:Ce,dl:Ct,Dw:Cn,xT:Cr,_X:Ci,wz:Cs}=$;function Ca(e,t){return["x","y","z","w","u","v"].slice(0,t).map(t=>`${e}.${t}`)}function Co(e,t){return 1===t?[e]:Ca(e,t)}function Cl(e,t){if(1===e)return"rc";let n="";for(let r=0;r<e;r++)n+=t[r],r<e-1&&(n+=",");return n}class Cu{constructor(e){if(this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=e,this.rank=e.length,this.enableShapeUniforms=SZ(this.outputShape.length),0===this.rank)this.userCode=`
        void main() {
          setOutput(vec4(getA(), 0., 0., 0.));
        }
      `;else{let e=Co("rc",this.rank),t=SG(this.rank),n=this.getOutOfBoundsCondition(e),r=this.getSetup(e),i=this.getOutput(e);this.userCode=`
        void main() {
          ${t} rc = getOutputCoords();

          if(${n}) {
            setOutput(vec4(0));
          } else {
            ${r}

            setOutput(vec4(${i}));
          }
        }
      `}}getSourceCoordsArr(e){let t=[];for(let n=0;n<=1;n++)for(let r=0;r<=1;r++){let i=`${0===n?"r":"rp1"}, ${0===r?"c":"cp1"}`;for(let t=2;t<this.rank;t++)i=`${e[e.length-1-t]},`+i;t.push(i)}return t}getOutOfBoundsCondition(e){if(1===this.rank)return`rc > ${this.enableShapeUniforms?"outShape":this.outputShape[0]}`;let t="";for(let n=this.rank-2;n<this.rank;n++)t+=`${e[n]} >= ${this.enableShapeUniforms?`outShape[${n}]`:this.outputShape[n]}`,n<this.rank-1&&(t+="||");return t}getSetup(e){if(1===this.rank)return"";let t=e.slice(-2),n=this.enableShapeUniforms?`outShape[${this.rank} - 1]`:this.outputShape[this.rank-1],r=this.enableShapeUniforms?`outShape[${this.rank} - 2]`:this.outputShape[this.rank-2];return`
      int r = ${t[0]};
      int c = ${t[1]};
      int rp1 = r + 1;
      int cp1 = c + 1;

      bool cEdge = cp1 >= ${n};
      bool rEdge = rp1 >= ${r};
    `}getOutput(e){let t=this.getSourceCoordsArr(e);if(1===this.rank){let e=this.enableShapeUniforms?"outShape":this.outputShape[0];return`getA(rc), (rc + 1 >= ${e} ? 0. : getA(rc + 1)), 0, 0`}return`getA(${t[0]}),
            cEdge ? 0. : getA(${t[1]}),
            rEdge ? 0. : getA(${t[2]}),
            rEdge || cEdge ? 0. : getA(${t[3]})`}}class Cc{constructor(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec3"}],this.outputShape=e,this.enableShapeUniforms=SZ(this.outputShape.length);let n="";for(let e=0;e<4;e++){let t="thisRC = rc;";e%2==1&&(t+="thisRC.z += 1;"),e>1&&(t+="thisRC.y += 1;"),n+=`
        ${t}
        ${e>0?"if(thisRC.y < rows && thisRC.z < cols){":""}
          int flatIndex = getFlatIndex(thisRC);

          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);
          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));

          result[${e}] =
            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);
        ${e>0?"}":""}
      `}this.userCode=`
      ${Ch(t,this.enableShapeUniforms)}
      ${this.enableShapeUniforms?Se():k9(e)}

      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0.);

        ivec3 thisRC;
        int rows = ${this.enableShapeUniforms?"outShape[1]":e[1]};
        int cols = ${this.enableShapeUniforms?"outShape[2]":e[2]};

        ${n}

        setOutput(result);
      }
    `}}function Ch(e,t){let n=t?k7(["r","c","d"],"inputShape"):k6(["r","c","d"],e);return`
    ivec3 inputCoordsFromReshapedOutCoords(int index) {
      ${n}
      return ivec3(r, c, d);
    }
  `}class Cd{constructor(e){this.gpgpu=e,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0,this.freeTextures={},this.usedTextures={},this.logEnabled=!1}acquireTexture(e,t,n){let r;let i=Cy(t,n),s=Cb(e,i,n);s in this.freeTextures||(this.freeTextures[s]=[]),s in this.usedTextures||(this.usedTextures[s]=[]);let a=Cf(e,i,this.gpgpu.gl,this.gpgpu.textureConfig,n);if(this.freeTextures[s].length>0){this.numFreeTextures--,this.numUsedTextures++,this._numBytesFree-=a,this.log();let e=this.freeTextures[s].pop();return this.usedTextures[s].push(e),e}return i===E.PACKED_2X2_FLOAT32?r=this.gpgpu.createPackedMatrixTexture(e[0],e[1]):i===E.PACKED_2X2_FLOAT16?r=this.gpgpu.createFloat16PackedMatrixTexture(e[0],e[1]):i===E.UNPACKED_FLOAT32?r=this.gpgpu.createFloat32MatrixTexture(e[0],e[1]):i===E.UNPACKED_FLOAT16?r=this.gpgpu.createFloat16MatrixTexture(e[0],e[1]):i===E.PACKED_4X1_UNSIGNED_BYTE&&(r=this.gpgpu.createUnsignedBytesMatrixTexture(e[0],e[1])),this.usedTextures[s].push(r),this.numUsedTextures++,this._numBytesAllocated+=a,this.log(),r}releaseTexture(e,t,n,r){if(null==this.freeTextures)return;let i=Cy(n,r),s=Cb(t,i,r);s in this.freeTextures||(this.freeTextures[s]=[]);let a=Cf(t,i,this.gpgpu.gl,this.gpgpu.textureConfig,r),o=eN().getNumber("WEBGL_DELETE_TEXTURE_THRESHOLD");-1!==o&&this._numBytesAllocated>o?(this.gpgpu.deleteMatrixTexture(e.texture),this._numBytesAllocated-=a):(this.freeTextures[s].push(e),this.numFreeTextures++,this._numBytesFree+=a),this.numUsedTextures--;let l=this.usedTextures[s],u=l&&l.indexOf(e);if(null==u||u<0)throw Error("Cannot release a texture that was never provided by this texture manager");l[u]=l[l.length-1],l.pop(),this.log()}log(){if(!this.logEnabled)return;let e=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used",`${this.numFreeTextures} / ${this.numUsedTextures}`,`(${e})`);let t=this._numBytesFree/this._numBytesAllocated;console.log(`Bytes allocated: ${this._numBytesAllocated}`),console.log(`Bytes unused: ${this._numBytesFree} (${Math.round(100*t)}%)`)}get numBytesAllocated(){return this._numBytesAllocated}get numBytesFree(){return this._numBytesFree}getNumUsedTextures(){return this.numUsedTextures}getNumFreeTextures(){return this.numFreeTextures}dispose(){if(null!=this.freeTextures){for(let e in this.freeTextures)this.freeTextures[e].forEach(e=>{this.gpgpu.deleteMatrixTexture(e.texture)});for(let e in this.usedTextures)this.usedTextures[e].forEach(e=>{this.gpgpu.deleteMatrixTexture(e.texture)});this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0}}}function Cp(e,t){let n=e;if(t===n.R32F)return 4;if(t===n.R16F)return 2;if(t===n.RGBA32F||t===e.RGBA)return 16;if(t===n.RGBA16F)return 8;if(t===n.RGBA8)return 4;throw Error(`Unknown internal format ${t}`)}function Cf(e,t,n,r,i){let s;let a=Cg(t,r);if(i){let[t,n]=ko(e[0],e[1]);s=t*n}else{let[t,n]=ki(e[0],e[1]);s=t*n}return s*Cp(n,a)}function Cg(e,t){switch(e){case E.PACKED_2X2_FLOAT32:return Eo(t);case E.PACKED_2X2_FLOAT16:return Eu(t);case E.UNPACKED_FLOAT32:return Et(t);case E.UNPACKED_FLOAT16:return Er(t);case E.PACKED_4X1_UNSIGNED_BYTE:return Es(t);default:throw Error(`Unknown physical texture type ${e}`)}}function Cm(e){return eN().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?e?E.PACKED_2X2_FLOAT32:E.UNPACKED_FLOAT32:e?E.PACKED_2X2_FLOAT16:E.UNPACKED_FLOAT16}function Cy(e,t){if(e===S.UPLOAD)return E.PACKED_2X2_FLOAT32;if(e===S.RENDER||null==e)return Cm(t);if(e===S.DOWNLOAD||e===S.PIXELS)return E.PACKED_4X1_UNSIGNED_BYTE;throw Error(`Unknown logical texture type ${e}`)}function Cb(e,t,n){return`${e[0]}_${e[1]}_${t}_${n}`}class Cv{constructor(e,t){this.variableNames=["A"],this.outputShape=e,this.enableShapeUniforms=SZ(this.outputShape.length),this.userCode=`
      float unaryOperation(float x) {
        ${t}
      }

      void main() {
        float x = getAAtOutCoords();
        float y = unaryOperation(x);

        setOutput(y);
      }
    `}}let Cw="if (isnan(x)) return x;",C_="return x;",Cx="return abs(x);",CT="return (x >= 0.0) ? x : (exp(x) - 1.0);",CI=Cw+`
  return (x < 0.0) ? 0.0 : x;
`,Ck=Cw+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,CS="return x;",CE="return 1.0 / (1.0 + exp(-1.0 * x));",CC="return x;",CA=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,CN=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,CO=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,C$="return 1.0 / (1.0 + exp(-1.0 * x));";class CR{constructor(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.enableShapeUniforms=SZ(this.outputShape.length),this.userCode=`
      vec4 unaryOperation(vec4 x) {
        ${t}
      }

      void main() {
        vec4 x = getAAtOutCoords();
        vec4 y = unaryOperation(x);

        setOutput(y);
      }
    `}}class CD{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=e,this.enableShapeUniforms=SZ(this.outputShape.length);let t=e.length,n=Co("rc",t),r=SG(t),i=Cl(t,n),s=n.slice(-2),a=t<=1?"rc":`vec2(${s.join(",")})`;this.userCode=`
      void main() {
        ${r} rc = getOutputCoords();
        vec4 packedInput = getA(${i});

        setOutput(getChannel(packedInput, ${a}));
      }
    `}}let CF=cY,CP=1e-7,CM=1e-4,CL={};function Cz(e){return e in CL||(CL[e]={}),CL[e]}let CB=eN().getNumber("CPU_HANDOFF_SIZE_THRESHOLD"),CU=600;function CV(){return null==eN().global.screen?1024:eN().global.screen.height*eN().global.screen.width*window.devicePixelRatio*CU/1024/1024}class Cj extends P{nextDataId(){return Cj.nextDataId++}constructor(e){let t;if(super(),this.pendingRead=new WeakMap,this.pendingDisposal=new WeakSet,this.dataRefCount=new WeakMap,this.numBytesInGPU=0,this.uploadWaitMs=0,this.downloadWaitMs=0,this.lastGlFlushTime=0,this.warnedAboutMemory=!1,this.pendingDeletes=0,this.disposed=!1,!eN().getBool("HAS_WEBGL"))throw Error("WebGL is not supported on this device");null!=e?(t=e instanceof Ev?e:new Ev(kt(eN().getNumber("WEBGL_VERSION"),e)),this.binaryCache={},this.gpgpuCreatedLocally=!1):(t=new Ev(kt(eN().getNumber("WEBGL_VERSION"))),this.binaryCache=Cz(eN().getNumber("WEBGL_VERSION")),this.gpgpuCreatedLocally=!0),this.gpgpu=t,this.canvas=this.gpgpu.gl.canvas,this.textureManager=new Cd(this.gpgpu),this.numMBBeforeWarning=CV(),this.texData=new F(this,i0())}numDataIds(){return this.texData.numDataIds()-this.pendingDeletes}writeTexture(e,t,n,r,i,s){let a=this.makeTensorInfo(t,n),o=this.texData.get(a.dataId);o.isPacked=!1,o.texture={texture:e,texShape:[r,i]},o.texShape=[r,i];let l=new S6(kV(t),!1,s),u=this.runWebGLProgram(l,[a],n,[[r,i]]);return u.shape=t,o.texture=null,this.disposeIntermediateTensorInfo(a),u.dataId}write(e,t,n){if((eN().getBool("WEBGL_CHECK_NUMERICAL_PROBLEMS")||eN().getBool("DEBUG"))&&this.checkNumericalProblems(e),"complex64"===n&&null!=e)throw Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");let r={id:this.nextDataId()};return this.texData.set(r,{shape:t,dtype:n,values:e,usage:S.UPLOAD,refCount:1}),r}refCount(e){return this.texData.has(e)?this.texData.get(e).refCount:0}incRef(e){let t=this.texData.get(e);t.refCount++}decRef(e){if(this.texData.has(e)){let t=this.texData.get(e);t.refCount--}}move(e,t,n,r,i){if(eN().getBool("DEBUG")&&this.checkNumericalProblems(t),"complex64"===r)throw Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(e,{shape:n,dtype:r,values:t,usage:S.UPLOAD,refCount:i})}disposeIntermediateTensorInfo(e){this.disposeData(e.dataId)}readSync(e){let t,n;let{values:r,dtype:i,complexTensorInfos:s,slice:a,shape:o,isPacked:l}=this.texData.get(e);if(null!=a){let t;t=l?new CR(o,CS):new Cv(o,CS);let n=this.runWebGLProgram(t,[{dataId:e,shape:o,dtype:i}],i),r=this.readSync(n.dataId);return this.disposeIntermediateTensorInfo(n),r}if(null!=r)return this.convertAndCacheOnCPU(e);if("string"===i)return r;let u=null!=this.activeTimers;return u&&(t=rJ()),n="complex64"===i?cf(this.readSync(s.real.dataId),this.readSync(s.imag.dataId)):this.getValuesFromTexture(e),u&&(this.downloadWaitMs+=rJ()-t),this.convertAndCacheOnCPU(e,n)}async read(e){let t,n;if(this.pendingRead.has(e)){let t=this.pendingRead.get(e);return new Promise(e=>t.push(e))}let{values:r,shape:i,slice:s,dtype:a,complexTensorInfos:o,isPacked:l}=this.texData.get(e);if(null!=s){let t;t=l?new CR(i,CS):new Cv(i,CS);let n=this.runWebGLProgram(t,[{dataId:e,shape:i,dtype:a}],a),r=this.read(n.dataId);return this.disposeIntermediateTensorInfo(n),r}if(null!=r)return this.convertAndCacheOnCPU(e);if(eN().getBool("DEBUG")&&!eN().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&2===eN().getNumber("WEBGL_VERSION"))throw Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");let u=null;if("complex64"!==a&&eN().get("WEBGL_BUFFER_SUPPORTED")){t=this.decode(e);let n=this.texData.get(t.dataId);u=this.gpgpu.createBufferFromTexture(n.texture.texture,...ka(i))}if(this.pendingRead.set(e,[]),"complex64"!==a&&await this.gpgpu.createAndWaitForFence(),"complex64"===a){let e=await Promise.all([this.read(o.real.dataId),this.read(o.imag.dataId)]);n=cf(e[0],e[1])}else if(null==u)n=this.getValuesFromTexture(e);else{let e=q(i);n=this.gpgpu.downloadFloat32MatrixFromBuffer(u,e)}if(null!=t&&this.disposeIntermediateTensorInfo(t),null!=u){let e=this.gpgpu.gl;kc(e,()=>e.deleteBuffer(u))}let c=this.convertAndCacheOnCPU(e,n),h=this.pendingRead.get(e);return this.pendingRead.delete(e),h.forEach(e=>e(c)),this.pendingDisposal.has(e)&&(this.pendingDisposal.delete(e),this.disposeData(e)&&i0().removeDataId(e,this),this.pendingDeletes--),c}readToGPU(e,t={}){let{values:n,shape:r,slice:i,dtype:s,isPacked:a,texture:o}=this.texData.get(e);if("complex64"===s)throw Error("Does not support reading texture for complex64 dtype.");if(null!=i){let n;n=a?new CR(r,CS):new Cv(r,CS);let i=this.runWebGLProgram(n,[{dataId:e,shape:r,dtype:s}],s),o=this.readToGPU(i,t);return this.disposeIntermediateTensorInfo(i),o}if(null==o){if(null!=n)throw Error("Data is not on GPU but on CPU.");throw Error("There is no data on GPU or CPU.")}let l=this.decode(e,t.customTexShape);return Object.assign({tensorRef:i0().makeTensorFromTensorInfo(l)},this.texData.get(l.dataId).texture)}bufferSync(e){let t=this.readSync(e.dataId);if("string"===e.dtype)try{let n=t.map(e=>r0(e));return s0(e.shape,e.dtype,n)}catch(e){throw Error("Failed to decode encoded string bytes into utf-8")}return s0(e.shape,e.dtype,t)}checkNumericalProblems(e){if(null!=e)for(let t=0;t<e.length;t++){let n=e[t];if(!kf(n)){if(eN().getBool("WEBGL_RENDER_FLOAT32_CAPABLE"))throw Error(`The value ${n} cannot be represented with your current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'`);throw Error(`The value ${n} cannot be represented on this device.`)}}}getValuesFromTexture(e){let{shape:t,dtype:n,isPacked:r}=this.texData.get(e),i=q(t);if(eN().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){let n=this.decode(e),r=this.texData.get(n.dataId),s=this.gpgpu.downloadMatrixFromPackedTexture(r.texture.texture,...ka(t)).subarray(0,i);return this.disposeIntermediateTensorInfo(n),s}let s=eN().getBool("WEBGL_PACK")&&!0===r,a=s?kV(t):t,o=s?new S3(a):new S2(a),l=this.runWebGLProgram(o,[{shape:a,dtype:n,dataId:e}],"float32"),u=this.texData.get(l.dataId),c=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(u.texture.texture,u.texShape[0],u.texShape[1]).subarray(0,i);return this.disposeIntermediateTensorInfo(l),c}timerAvailable(){return eN().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0}time(e){let t=this.activeTimers,n=[],r=!1;null==this.programTimersStack?(this.programTimersStack=n,r=!0):this.activeTimers.push(n),this.activeTimers=n,e();let i=r2(this.activeTimers.map(e=>e.query)).filter(e=>null!=e),s=r2(this.activeTimers.map(e=>e.name)).filter(e=>null!=e);this.activeTimers=t,r&&(this.programTimersStack=null);let a={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null};return(async()=>{if(eN().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0){let e=await Promise.all(i);a.kernelMs=V(e),a.getExtraProfileInfo=()=>e.map((e,t)=>({name:s[t],ms:e})).map(e=>`${e.name}: ${e.ms}`).join(", ")}else a.kernelMs={error:"WebGL query timers are not supported in this environment."};return this.uploadWaitMs=0,this.downloadWaitMs=0,a})()}memory(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU,numBytesInGPUAllocated:this.textureManager.numBytesAllocated,numBytesInGPUFree:this.textureManager.numBytesFree}}startTimer(){return eN().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:rJ(),endMs:null}}endTimer(e){return eN().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.endQuery():e.endMs=rJ(),e}async getQueryTime(e){if(eN().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0)return this.gpgpu.waitForQueryAndGetTime(e);let t=e;return t.endMs-t.startMs}disposeData(e,t=!1){if(this.pendingDisposal.has(e))return!1;if(!this.texData.has(e))return!0;if(t?this.texData.get(e).refCount=0:this.texData.get(e).refCount--,!t&&this.texData.get(e).refCount>0)return!1;if(this.pendingRead.has(e))return this.pendingDisposal.add(e),this.pendingDeletes++,!1;this.releaseGPUData(e);let{complexTensorInfos:n}=this.texData.get(e);return null!=n&&(this.disposeData(n.real.dataId,t),this.disposeData(n.imag.dataId,t)),this.texData.delete(e),!0}releaseGPUData(e){let{texture:t,dtype:n,texShape:r,usage:i,isPacked:s,slice:a}=this.texData.get(e),o=a&&a.origDataId||e,l=this.dataRefCount.get(o);l>1?this.dataRefCount.set(o,l-1):(this.dataRefCount.delete(o),null!=t&&(this.numBytesInGPU-=this.computeBytes(r,n),this.textureManager.releaseTexture(t,r,i,s)));let u=this.texData.get(e);u.texture=null,u.texShape=null,u.isPacked=!1,u.slice=null}getTexture(e){return this.uploadToGPU(e),this.texData.get(e).texture.texture}getDataInfo(e){return this.texData.get(e)}shouldExecuteOnCPU(e,t=CB){return eN().getBool("WEBGL_CPU_FORWARD")&&e.every(e=>null==this.texData.get(e.dataId).texture&&q(e.shape)<t)}getGPGPUContext(){return this.gpgpu}where(e){rw("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");let t=e.dataSync();return CF(e.shape,t)}packedUnaryOp(e,t,n){let r=new CR(e.shape,t),i=this.compileAndRun(r,[e],n);return i0().makeTensorFromTensorInfo(i)}abs(e){if(this.shouldExecuteOnCPU([e])&&"complex64"!==e.dtype){let t=E0(this.texData.get(e.dataId).values);return this.makeOutput(e.shape,e.dtype,t)}if(eN().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,Cx,e.dtype);let t=new Cv(e.shape,Cx),n=this.compileAndRun(t,[e]);return i0().makeTensorFromTensorInfo(n)}makeTensorInfo(e,t,n){let r;if("string"===t&&null!=n&&n.length>0&&el(n[0])){let i=n.map(e=>rZ(e));r=this.write(i,e,t)}else r=this.write(n,e,t);return this.texData.get(r).usage=null,{dataId:r,shape:e,dtype:t}}makeOutput(e,t,n){return i0().makeTensorFromTensorInfo(this.makeTensorInfo(e,t,n),this)}unpackTensor(e){let t=new CD(e.shape);return this.runWebGLProgram(t,[e],e.dtype)}packTensor(e){let t=new Cu(e.shape),n=!0;return this.runWebGLProgram(t,[e],e.dtype,null,n)}packedReshape(e,t){let n=[kB(e.shape),...kU(e.shape)],r={dtype:e.dtype,shape:n,dataId:e.dataId},i=new Cc([kB(t),...kU(t)],n),s=!0,a=[n],o=this.runWebGLProgram(i,[r],e.dtype,a,s);return{dataId:o.dataId,shape:t,dtype:o.dtype}}decode(e,t){let n;let{isPacked:r,shape:i,dtype:s}=this.texData.get(e);null!=t&&j(q(i)<=t[0]*t[1]*4,()=>"customTexShape is too small. Row * Column * 4 should be equal or larger than the size of the tensor data.");let a=kV(i);n=r?new S1(a):new S0(a);let o=!0,l=[null!=t?t:ka(a)],u=this.runWebGLProgram(n,[{shape:a,dtype:s,dataId:e}],s,l,o,t);return{dtype:s,shape:i,dataId:u.dataId}}runWebGLProgram(e,t,n,r,i=!1,s){let a;let o=this.makeTensorInfo(e.outputShape,n),l=this.texData.get(o.dataId);if(e.packedOutput&&(l.isPacked=!0),e.outPackingScheme===k.DENSE){let t=null!=s?s:ka(e.outputShape);l.texShape=t.map(e=>2*e)}if(null!=e.outTexUsage&&(l.usage=e.outTexUsage),0===q(o.shape))return l.values=et(o.dtype,0),o;let u=[],c=t.map(t=>{if("complex64"===t.dtype)throw Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");let n=this.texData.get(t.dataId);if(null==n.texture){if(!e.packedInputs&&q(t.shape)<=eN().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:t.shape,texData:null,isUniform:!0,uniformValues:n.values};e.packedInputs&&(n.isPacked=!0,n.shape=t.shape)}if(this.uploadToGPU(t.dataId),!!n.isPacked!=!!e.packedInputs)t=n.isPacked?this.unpackTensor(t):this.packTensor(t),u.push(t),n=this.texData.get(t.dataId);else if(n.isPacked&&!kW(n.shape,t.shape)){let e=t,r=t.shape;t.shape=n.shape,t=this.packedReshape(t,r),u.push(t),n=this.texData.get(t.dataId),e.shape=r}return{shape:t.shape,texData:n,isUniform:!1}});this.uploadToGPU(o.dataId);let h={shape:o.shape,texData:l,isUniform:!1},d=SJ(e,c,h),p=this.getAndSaveBinary(d,()=>SK(this.gpgpu,e,c,h)),f=null!=this.activeTimers;f&&(a=this.startTimer()),eN().get("ENGINE_COMPILE_ONLY")||SQ(this.gpgpu,p,c,h,r),u.forEach(e=>this.disposeIntermediateTensorInfo(e)),f&&(a=this.endTimer(a),this.activeTimers.push({name:e.constructor.name,query:this.getQueryTime(a)}));let g=eN().getNumber("WEBGL_FLUSH_THRESHOLD");if(g>0){let e=rJ();e-this.lastGlFlushTime>g&&(this.gpgpu.gl.flush(),this.lastGlFlushTime=e)}if(!eN().getBool("WEBGL_LAZILY_UNPACK")&&l.isPacked&&!1===i){let e=this.unpackTensor(o);return this.disposeIntermediateTensorInfo(o),e}return o}compileAndRun(e,t,n,r,i=!1){return n=n||t[0].dtype,this.runWebGLProgram(e,t,n,r,i)}getAndSaveBinary(e,t){return e in this.binaryCache||(this.binaryCache[e]=t()),this.binaryCache[e]}getTextureManager(){return this.textureManager}dispose(){this.disposed||(eN().getBool("IS_TEST")||Object.keys(this.binaryCache).forEach(e=>{this.gpgpu.deleteProgram(this.binaryCache[e].webGLProgram),delete this.binaryCache[e]}),this.textureManager.dispose(),null!=this.canvas&&"undefined"!=typeof HTMLCanvasElement&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0)}floatPrecision(){return null==this.floatPrecisionValue&&(this.floatPrecisionValue=i2(()=>{if(!eN().get("WEBGL_RENDER_FLOAT32_ENABLED")){let e=eN().getBool("DEBUG");eN().set("DEBUG",!1);let t=this.abs(ar(1e-8)).dataSync()[0];if(eN().set("DEBUG",e),t>0)return 32}return 16})),this.floatPrecisionValue}epsilon(){return 32===this.floatPrecision()?CP:CM}uploadToGPU(e){let t;let n=this.texData.get(e),{shape:r,dtype:i,values:s,texture:a,usage:o,isPacked:l}=n;if(null!=a)return;let u=null!=this.activeTimers;u&&(t=rJ());let c=n.texShape;if(null==c&&(c=kj(r,l),n.texShape=c),null!=s){let e;let a=kV(r),o=c[1],h=c[0],d=s instanceof Uint8Array||s instanceof Uint8ClampedArray;(l||!d)&&([o,h]=ko(c[0],c[1])),e=l?new S5(a,d):new S6(a,d);let p=d?[h,o]:c,f=this.makeTensorInfo(p,i),g=this.texData.get(f.dataId);d?g.usage=S.PIXELS:g.usage=S.UPLOAD,g.texShape=p,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(f.dataId),o,h,s);let m=[[h,o]],y=!0,b=this.runWebGLProgram(e,[f],i,m,y),v=this.texData.get(b.dataId);n.texShape=v.texShape,n.isPacked=v.isPacked,n.usage=v.usage,eN().get("ENGINE_COMPILE_ONLY")?this.disposeData(b.dataId):(n.texture=v.texture,n.values=null,this.texData.delete(b.dataId)),this.disposeIntermediateTensorInfo(f),u&&(this.uploadWaitMs+=rJ()-t)}else{let e=this.acquireTexture(c,o,i,l);n.texture=e}}convertAndCacheOnCPU(e,t){let n=this.texData.get(e),{dtype:r}=n;return null!=t&&(n.values=CG(t,r)),n.values}acquireTexture(e,t,n,r){if(this.numBytesInGPU+=this.computeBytes(e,n),!this.warnedAboutMemory&&this.numBytesInGPU>1048576*this.numMBBeforeWarning){let e=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn(`High memory usage in GPU: ${e} MB, most likely due to a memory leak`)}return this.textureManager.acquireTexture(e,t,r)}computeBytes(e,t){return e[0]*e[1]*ea(t)}checkCompileCompletion(){for(let[,e]of Object.entries(this.binaryCache))this.checkCompletion_(e)}async checkCompileCompletionAsync(){let e=[];if(this.gpgpu.parallelCompilationExtension){for(let[,t]of Object.entries(this.binaryCache))e.push(this.checkCompletionAsync_(t));return Promise.all(e)}for(let[,t]of Object.entries(this.binaryCache)){let n=new Promise(e=>{try{this.checkCompletion_(t),e(!0)}catch(e){throw e}});e.push(n)}return Promise.all(e)}async checkCompletionAsync_(e){return this.gpgpu.gl.getProgramParameter(e.webGLProgram,this.gpgpu.parallelCompilationExtension.COMPLETION_STATUS_KHR)?this.checkCompletion_(e):(await uQ(),this.checkCompletionAsync_(e))}checkCompletion_(e){if(!1===this.gpgpu.gl.getProgramParameter(e.webGLProgram,this.gpgpu.gl.LINK_STATUS)){if(console.log(this.gpgpu.gl.getProgramInfoLog(e.webGLProgram)),!1===this.gpgpu.gl.getShaderParameter(e.fragmentShader,this.gpgpu.gl.COMPILE_STATUS))throw kw(e.source,this.gpgpu.gl.getShaderInfoLog(e.fragmentShader)),Error("Failed to compile fragment shader.");throw Error("Failed to link vertex and fragment shaders.")}return!0}getUniformLocations(){for(let e of Object.values(this.binaryCache)){this.gpgpu.buildVao(e.webGLProgram);let{variablesLocations:t,customUniformLocations:n,infLoc:r,nanLoc:i,outShapeLocation:s,outShapeStridesLocation:a,outTexShapeLocation:o}=SX(this.gpgpu,e.program,e.webGLProgram);e.variablesLocations=t,e.customUniformLocations=n,e.infLoc=r,e.nanLoc=i,e.outShapeLocation=s,e.outShapeStridesLocation=a,e.outTexShapeLocation=o}}createTensorFromGPUData(e,t,n){e.channels=e.channels||"RGBA";let{texture:r,height:i,width:s,channels:a}=e,o=i0().backend;if(!o.gpgpu.gl.isTexture(r))throw Error("The texture is invalid. Also, please make sure the texture and the TFJS WebGL backend are using the same canvas. If you want to use your own custom canvas, you have to create and use the custom TFJS WebGL backend created from the canvas through 'new tf.MathBackendWebGL(customCanvas)'.");let l=o.writeTexture(r,t,n,i,s,a);return i0().makeTensorFromDataId(l,t,n,o)}}function CG(e,t){if("float32"===t||"complex64"===t)return e;if("int32"===t||"bool"===t){let n="int32"===t?new Int32Array(e.length):new Uint8Array(e.length);for(let t=0;t<n.length;++t)n[t]=Math.round(e[t]);return n}throw Error(`Unknown dtype ${t}`)}Cj.nextDataId=0,iL()&&i7("webgl",()=>new Cj,2);let CW=`
  if (isnan(a)) return a;
  if (isnan(b)) return b;
`;class Cq{constructor(e,t,n){this.variableNames=["A","B"],this.outputShape=av(t,n),this.enableShapeUniforms=SZ(this.outputShape.length),this.userCode=`
      float binaryOperation(float a, float b) {
        ${e}
      }

      void main() {
        float a = getAAtOutCoords();
        float b = getBAtOutCoords();
        setOutput(binaryOperation(a, b));
      }
    `}}let CH=`
  result.r = isNaN.r ? NAN : result.r;
  result.g = isNaN.g ? NAN : result.g;
  result.b = isNaN.b ? NAN : result.b;
  result.a = isNaN.a ? NAN : result.a;
`;class CK{constructor(e,t,n,r=!1){this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=av(t,n);let i=this.outputShape.length;this.enableShapeUniforms=SZ(i);let s="";if(r){if(0===i||1===q(this.outputShape))s=`
          result.y = 0.;
          result.z = 0.;
          result.w = 0.;
        `;else{let e=SG(i);if(s=`
          ${e} coords = getOutputCoords();
        `,1===i)this.enableShapeUniforms?s+=`
            result.y = (coords + 1) >= outShape ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `:s+=`
            result.y = (coords + 1) >= ${this.outputShape[0]} ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `;else{let e=Co("coords",i);this.enableShapeUniforms?s+=`
            bool nextRowOutOfBounds =
              (${e[i-2]} + 1) >= outShape[${i} - 2];
            bool nextColOutOfBounds =
              (${e[i-1]} + 1) >= outShape[${i} - 1];
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `:s+=`
            bool nextRowOutOfBounds =
              (${e[i-2]} + 1) >= ${this.outputShape[i-2]};
            bool nextColOutOfBounds =
              (${e[i-1]} + 1) >= ${this.outputShape[i-1]};
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `}}}this.userCode=`
      vec4 binaryOperation(vec4 a, vec4 b) {
        ${e}
      }

      void main() {
        vec4 a = getAAtOutCoords();
        vec4 b = getBAtOutCoords();

        vec4 result = binaryOperation(a, b);
        ${s}

        setOutput(result);
      }
    `}}function CX(e){let{inputs:t,backend:n}=e,{x:r}=t;return n.incRef(r.dataId),{dataId:r.dataId,shape:r.shape,dtype:r.dtype}}let CY={kernelName:tj,backendName:"webgl",kernelFunc:CX};function CQ(e){let{inputs:t,backend:n}=e,{real:r,imag:i}=t,s=n.makeTensorInfo(r.shape,"complex64"),a=n.texData.get(s.dataId),o=CX({inputs:{x:r},backend:n}),l=CX({inputs:{x:i},backend:n});return a.complexTensorInfos={real:o,imag:l},s}let CJ={kernelName:te,backendName:"webgl",kernelFunc:CQ},CZ="return (a < 0.) ? b * a : a;",C0=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`,C1={kernelName:tX,backendName:"webgl",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{alpha:s}=r,a=n.makeTensorInfo([],"float32",rX(s,"float32")),o=eN().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new CK(C0,i.shape,a.shape):new Cq(CZ,i.shape,a.shape),l=n.runWebGLProgram(o,[i,a],"float32");return n.disposeIntermediateTensorInfo(a),l}},C2="return (a < 0.) ? b * a : a;",C3=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`,C4={kernelName:n_,backendName:"webgl",kernelFunc:function(e){let{inputs:t,backend:n}=e,{x:r,alpha:i}=t,s=eN().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new CK(C3,r.shape,i.shape):new Cq(C2,r.shape,i.shape);return n.runWebGLProgram(s,[r,i],"float32")}},C6="if (isnan(x)) return x;";function C5({opSnippet:e,packedOpSnippet:t,cpuKernelImpl:n,dtype:r}){return({inputs:i,backend:s})=>{let a;let{x:o}=i,l=s,u=r||o.dtype;if(l.shouldExecuteOnCPU([o])&&null!=n){let e=n(l.texData.get(o.dataId).values,u);return l.makeTensorInfo(o.shape,u,e)}return a=eN().getBool("WEBGL_PACK_UNARY_OPERATIONS")&&null!=t?new CR(o.shape,t):new Cv(o.shape,e),l.runWebGLProgram(a,[o],u)}}function C8({opSnippet:e,packedOpSnippet:t,checkOutOfBounds:n=!1,supportsComplex:r=!1,cpuKernelImpl:i,dtype:s}){return({inputs:a,backend:o})=>{let l;let{a:u,b:c}=a,h=o;if(r&&"complex64"===u.dtype){let t=h.texData.get(u.dataId),n=h.texData.get(c.dataId),[r,i]=[[t.complexTensorInfos.real,n.complexTensorInfos.real],[t.complexTensorInfos.imag,n.complexTensorInfos.imag]].map(t=>{let[n,r]=t,i={dataId:n.dataId,dtype:n.dtype,shape:u.shape},s={dataId:r.dataId,dtype:r.dtype,shape:c.shape},a=new Cq(e,u.shape,c.shape);return h.runWebGLProgram(a,[i,s],iw(n.dtype,r.dtype))}),s=CQ({inputs:{real:r,imag:i},backend:h});return h.disposeIntermediateTensorInfo(r),h.disposeIntermediateTensorInfo(i),s}let d=s||iw(u.dtype,c.dtype);if(("string"===u.dtype||"string"===c.dtype||h.shouldExecuteOnCPU([u,c]))&&null!=i){let e=h.texData.get(u.dataId).values,t=h.texData.get(c.dataId).values,n="string"===u.dtype?cK(e):e,r="string"===u.dtype?cK(t):t,[s,a]=i(u.shape,c.shape,n,r,d),o=h.makeTensorInfo(a,d);return h.texData.get(o.dataId).values=s,o}return l=eN().getBool("WEBGL_PACK_BINARY_OPERATIONS")&&null!=t?new CK(t,u.shape,c.shape,n):new Cq(e,u.shape,c.shape),h.runWebGLProgram(l,[u,c],d)}}function C7(e,t=!1){if("linear"===e)return t?CC:C_;if("relu"===e)return t?CN:CI;if("elu"===e)return t?CA:CT;if("relu6"===e)return t?CO:Ck;if("prelu"===e)return t?C3:C2;if("leakyrelu"===e)return t?C0:CZ;if("sigmoid"===e)return t?C$:CE;throw Error(`Activation ${e} has not been implemented for the WebGL backend.`)}class C9{constructor(e,t,n,r=!1,i=!1,s=!1,a=null,o=!1,l=!1){this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n,this.enableShapeUniforms=SZ(this.outputShape.length);let u=Math.ceil((r?e[1]:e[2])/2),c=r?"i * 2, rc.y":"rc.y, i * 2",h=i?"rc.z, i * 2":"i * 2, rc.z",d=r?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],p=i?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"],f="",g="";a&&(f=o?`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          ${a}
        }`:l?`vec4 activation(vec4 a) {
          vec4 b = getLeakyreluAlphaAtOutCoords();
          ${a}
        }`:`vec4 activation(vec4 x) {
          ${a}
        }`,g="result = activation(result);");let m=s?"result += getBiasAtOutCoords();":"";s&&this.variableNames.push("bias"),o&&this.variableNames.push("preluActivationWeights"),l&&this.variableNames.push("leakyreluAlpha");let y="rc.x",b="rc.x";e[0]<t[0]?y=`imod(rc.x, ${e[0]})`:t[0]<e[0]&&(b=`imod(rc.x, ${t[0]})`),this.userCode=`
      ${f}
      // Don't use uniform for sharedDimensionPacked for performance.
      const float sharedDimension = ${u}.0;

      vec4 dot2x2ARowBCol(ivec3 rc) {
        vec4 result = vec4(0);
        int batchA = ${y};
        int batchB = ${b};
        for (int i = 0; i < ${u}; i++) {
          vec4 a = getMatrixA(batchA, ${c});
          vec4 b = getMatrixB(batchB, ${h});

          // These swizzled products need to be separately added.
          // See: https://github.com/tensorflow/tfjs/issues/1735
          result += (${d[0]} * ${p[0]});
          result += (${d[1]} * ${p[1]});
        }
        return result;
      }

      void main() {
        ivec3 rc = getOutputCoords();
        vec4 result = dot2x2ARowBCol(rc);

        ${m}

        ${g}

        setOutput(result);
      }
    `}}let Ae={REAL:"return areal * breal - aimag * bimag;",IMAG:"return areal * bimag + aimag * breal;"};class At{constructor(e,t,n){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=av(t,n),this.userCode=`
      float binaryOpComplex(
          float areal, float aimag, float breal, float bimag) {
        ${e}
      }

      void main() {
        float areal = getARealAtOutCoords();
        float aimag = getAImagAtOutCoords();
        float breal = getBRealAtOutCoords();
        float bimag = getBImagAtOutCoords();
        setOutput(binaryOpComplex(areal, aimag, breal, bimag));
      }
    `}}let An="return a * b;";function Ar(e){let t;let{inputs:n,backend:r}=e,{a:i,b:s}=n,a=iw(i.dtype,s.dtype);if("complex64"===i.dtype){let e=r.texData.get(i.dataId),t=r.texData.get(s.dataId),n=new At(Ae.REAL,i.shape,s.shape),a=new At(Ae.IMAG,i.shape,s.shape),o=[{dataId:e.complexTensorInfos.real.dataId,dtype:e.complexTensorInfos.real.dtype,shape:i.shape},{dataId:e.complexTensorInfos.imag.dataId,dtype:e.complexTensorInfos.imag.dtype,shape:i.shape},{dataId:t.complexTensorInfos.real.dataId,dtype:t.complexTensorInfos.real.dtype,shape:s.shape},{dataId:t.complexTensorInfos.imag.dataId,dtype:t.complexTensorInfos.imag.dtype,shape:s.shape}],l=r.runWebGLProgram(n,o,"float32"),u=r.runWebGLProgram(a,o,"float32"),c=CQ({inputs:{real:l,imag:u},backend:r});return r.disposeIntermediateTensorInfo(l),r.disposeIntermediateTensorInfo(u),c}if(r.shouldExecuteOnCPU([i,s])){let e=r.texData.get(i.dataId),t=r.texData.get(s.dataId),[n,o]=Ej(i.shape,s.shape,e.values,t.values,a),l=r.makeTensorInfo(o,a);return r.texData.get(l.dataId).values=n,l}return t=eN().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new CK(An,i.shape,s.shape):new Cq(An,i.shape,s.shape),r.runWebGLProgram(t,[i,s],a)}let Ai={kernelName:nc,backendName:"webgl",kernelFunc:Ar};function As(e,t,n){let r=[kB(e.shape),...kU(e.shape)],i={dtype:e.dtype,shape:r,dataId:e.dataId},s=new Cc([kB(t),...kU(t)],r),a=!0,o=[r],l=n.runWebGLProgram(s,[i],e.dtype,o,a);return{dataId:l.dataId,shape:t,dtype:l.dtype}}function Aa(e){let{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{shape:s}=r,a=n,o=q(i.shape),l=J(s,o),u=q(l);j(o===u,()=>`The new shape (${l}) has ${u} elements and the old shape (${i.shape}) has ${o} elements. The new shape and old shape must have the same number of elements.`);let c=a.texData.get(i.dataId);return!c.isPacked||kW(i.shape,l)||null!==c.texture&&kW(c.shape,l)?(a.incRef(i.dataId),{dataId:i.dataId,shape:l,dtype:i.dtype}):As(i,l,a)}let Ao={kernelName:nN,backendName:"webgl",kernelFunc:Aa};class Al{constructor(e,t){this.variableNames=["x"];let{windowSize:n,batchSize:r,inSize:i,outSize:s}=e;this.outputShape=[r,s];let a=4*Math.floor(n/4),o=n%4,l="sumValue += dot(values, ones);";if(null!=t){let e=1/t;l=`sumValue += dot(values * ${K(e)?e.toPrecision(2):e}, ones);`}let u="";i%n>0&&(u=`
        if (inIdx < 0 || inIdx >= ${i}) {
          return 0.0;
        }
      `),this.userCode=`
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        ${u}
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${n};

        float sumValue = 0.0;

        for (int i = 0; i < ${a}; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          ${l}
        }

        int inIdx = inOffset + ${a};
        if (${1===o}) {
          vec4 values = vec4(getValue(batch, inIdx), 0.0, 0.0, 0.0);

          ${l}
        } else if (${2===o}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1), 0.0, 0.0);

          ${l}
        } else if (${3===o}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2), 0.0);

          ${l}
        }
        setOutput(sumValue);
      }
    `}}class Au{constructor(e,t){this.variableNames=["x"];let{windowSize:n,batchSize:r,inSize:i,outSize:s}=e;this.outputShape=[r,s];let a="0.0",o="";"prod"===t?a="1.0":"min"===t?(a="1.0 / 1e-20",o="min"):"max"===t&&(a="-1.0 / 1e-20",o="max");let l=`${t}(${t}(${t}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;"sum"===t?l="sumValue":"prod"===t?l="prodValue":"all"===t?l="allValue":"any"===t&&(l="anyValue");let u=4*Math.floor(n/4),c=n%4,h=`
      if (${"sum"===t}) {
        sumValue += dot(values, ones);
      } else if (${"prod"===t}) {
        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);
        prodValue *= tmp[0] * tmp[1];
      } else {
        minMaxValue = ${o}(values, minMaxValue);
        if (${"min"===t} || ${"max"===t}) {
          minMaxValue = ${o}(values, minMaxValue);
          bvec4 isNaN = isnan(values);
          if (isNaN.r || isNaN.g || isNaN.b || isNaN.a) {
            minMaxValue = vec4(NAN);
          }
        }
      }
    `,d="vec4";"all"===t?(a="1.0",h=`
        bool reducedAllValue = all(values);
        float floatedReducedAllValue = float(reducedAllValue);
        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);
      `,d="bvec4"):"any"===t&&(a="0.0",h=`
        bool reducedAnyValue = any(values);
        float floatedReducedAnyValue = float(reducedAnyValue);
        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);
      `,d="bvec4");let p="";i%n>0&&(p=`
        if (inIdx < 0 || inIdx >= ${i}) {
          return initializationValue;
        }
      `),this.userCode=`
      const float initializationValue = ${a};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        ${p}
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${n};

        vec4 minMaxValue = vec4(${a});
        float prodValue = 1.0;
        float sumValue = 0.0;
        float allValue = 1.0;
        float anyValue = 0.0;

        for (int i = 0; i < ${u}; i += 4) {
          int inIdx = inOffset + i;
          ${d} values = ${d}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          ${h}
        }

        int inIdx = inOffset + ${u};
        if (${1===c}) {
          ${d} values = ${d}(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          ${h}
        } else if (${2===c}) {
          ${d} values = ${d}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          ${h}
        } else if (${3===c}) {
          ${d} values = ${d}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          ${h}
        }
        setOutput(${l});
      }
    `}}function Ac(e){let t=[];for(;0===t.length||1!==t[t.length-1].outSize;){let n=t.length?t[t.length-1].outSize:e[1],r=u6(n);t.push({inSize:n,windowSize:r,outSize:Math.ceil(n/r)})}return t}function Ah(e,t,n,r){let i=Ac(e.shape),s=e;for(let a=0;a<i.length;a++){let o,l;let{inSize:u,windowSize:c,outSize:h}=i[a];o="mean"===n?0===a?new Al({windowSize:c,inSize:u,batchSize:e.shape[0],outSize:h},u):new Al({windowSize:c,inSize:u,batchSize:e.shape[0],outSize:h}):new Au({windowSize:c,inSize:u,batchSize:e.shape[0],outSize:h},n),l=s,s=r.runWebGLProgram(o,[s],t),l.dataId!==e.dataId&&r.disposeIntermediateTensorInfo(l)}return s}class Ad{constructor(e,t){this.variableNames=["A"];let n=Array(e.length);for(let r=0;r<n.length;r++)n[r]=e[t[r]];this.outputShape=n,this.rank=n.length;let r=SG(this.rank),i=Ap(t);this.userCode=`
    void main() {
      ${r} resRC = getOutputCoords();
      setOutput(getA(${i}));
    }
    `}}function Ap(e){let t=e.length;if(t>6)throw Error(`Transpose for rank ${t} is not yet supported`);let n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],r=Array(t);for(let t=0;t<e.length;t++)r[e[t]]=n[t];return r.join()}class Af{constructor(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;let n=Array(e.length);for(let r=0;r<n.length;r++)n[r]=e[t[r]];if(this.outputShape=n,this.rank=n.length,this.rank>6)throw Error(`Packed transpose for rank ${this.rank} is not yet supported.`);let r=SG(this.rank),i=Ca("rc",this.rank),s=Array(this.rank);for(let e=0;e<t.length;e++)s[t[e]]=i[e];let a=`vec2(${s.slice(-2).join()})`,o=`++${i[this.rank-1]} < ${n[this.rank-1]}`,l=`getChannel(getA(${s.join()}), ${a})`;this.userCode=`
    void main() {
      ${r} rc = getOutputCoords();
      vec4 result = vec4(0.);
      result[0] = ${l};
      if(${o}) {
        result[1] = ${l};
      }
      --${i[this.rank-1]};
      if(++${i[this.rank-2]} < ${n[this.rank-2]}) {
        result[2] = ${l};
        if(${o}) {
          result[3] = ${l};
        }
      }
      setOutput(result);
    }
    `}}function Ag(e,t,n){let r=eN().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new Af(e.shape,t):new Ad(e.shape,t);return n.runWebGLProgram(r,[e],e.dtype)}function Am(e,t,n,r){let i=t,s=e.shape.length,a=Z(i,e.shape),o=a,l=li(o,s),u=null!=l,c=e;u&&(c=Ag(e,l,r),o=la(o.length,s)),lr("sum",o,s);let[h,d]=lt(c.shape,o),p=h;n&&(p=ln(h,a));let f=q(d),g=Aa({inputs:{x:c},attrs:{shape:[q(e.shape)/f,f]},backend:r}),m=Ah(g,i_(e.dtype),"sum",r),y=Aa({inputs:{x:m},attrs:{shape:p},backend:r});return r.disposeIntermediateTensorInfo(g),r.disposeIntermediateTensorInfo(m),u&&r.disposeIntermediateTensorInfo(c),y}function Ay(e){let{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{axis:s,keepDims:a}=r;return Am(i,s,a,n)}let Ab={kernelName:nQ,backendName:"webgl",kernelFunc:Ay};function Av(e){let t;let{inputs:n,backend:r,attrs:i}=e,{x:s}=n,{perm:a}=i,o=r,l=Array(s.shape.length);for(let e=0;e<l.length;e++)l[e]=s.shape[a[e]];if(o.shouldExecuteOnCPU([s])){let e=Ci(o.texData.get(s.dataId).values,s.shape,s.dtype,a,l);t=o.makeTensorInfo(l,s.dtype),o.texData.get(t.dataId).values=e}else t=Ag(s,a,o);return t}let Aw={kernelName:ru,backendName:"webgl",kernelFunc:Av},A_=1e3;function Ax({a:e,b:t,transposeA:n,transposeB:r,backend:i,bias:s=null,preluActivationWeights:a=null,leakyreluAlpha:o=0,activation:l=null}){let u;let c=e.shape.length,h=t.shape.length,d=n?e.shape[c-2]:e.shape[c-1],p=r?t.shape[h-1]:t.shape[h-2],f=n?e.shape[c-1]:e.shape[c-2],g=r?t.shape[h-2]:t.shape[h-1],m=e.shape.slice(0,-2),y=t.shape.slice(0,-2),b=q(m),v=q(y),w=av(e.shape.slice(0,-2),t.shape.slice(0,-2)).concat([f,g]);j(d===p,()=>`Error in matMul: inner shapes (${d}) and (${p}) of Tensors with shapes ${e.shape} and ${t.shape} and transposeA=${n} and transposeB=${r} must match.`);let _=n?[b,d,f]:[b,f,d],x=r?[v,g,p]:[v,p,g],T=Aa({inputs:{x:e},backend:i,attrs:{shape:_}}),I=Aa({inputs:{x:t},backend:i,attrs:{shape:x}}),k=[T,I],S=Math.max(b,v),E=n?T.shape[1]:T.shape[2],C=null!=s,A=null!=a,N="leakyrelu"===l,O=null!=l?C7(l,!0):null,$=C||A||N||null!=O;if((1===f||1===g)&&E>A_&&!1===$){let e=T,t=I;n&&(e=Av({inputs:{x:T},backend:i,attrs:{perm:[0,2,1]}}),k.push(e)),r&&(t=Av({inputs:{x:I},backend:i,attrs:{perm:[0,2,1]}}),k.push(t));let s=1!==g,a=1===g,o=e;s&&(o=Aa({inputs:{x:e},backend:i,attrs:{shape:[S,E,1]}}),k.push(o));let l=1===g?2:1,c=t;a&&(c=Aa({inputs:{x:t},backend:i,attrs:{shape:[S,1,E]}}),k.push(c));let h=Ar({inputs:{a:o,b:c},backend:i});u=Ay({inputs:{x:h},backend:i,attrs:{axis:l,keepDims:!0}}),k.push(h)}else{let l=iw(e.dtype,t.dtype),c=new C9(_,x,[S,f,g],n,r,C,O,A,N),h=[T,I];if(null!=s&&h.push(s),A&&h.push(a),N){let e=i.makeTensorInfo([],"float32",rX(o,"float32"));h.push(e),k.push(e)}u=i.runWebGLProgram(c,h,l)}let R=Aa({inputs:{x:u},backend:i,attrs:{shape:w}});for(let e of(k.push(u),k))i.disposeIntermediateTensorInfo(e);return R}let AT={kernelName:ry,backendName:"webgl",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{a:i,b:s,bias:a,preluActivationWeights:o}=t,{transposeA:l,transposeB:u,activation:c,leakyreluAlpha:h}=r;return Ax({a:i,b:s,transposeA:l,transposeB:u,backend:n,bias:a,preluActivationWeights:o,leakyreluAlpha:h,activation:c})}},AI="return abs(x);",Ak={kernelName:eM,backendName:"webgl",kernelFunc:function(e){let t;let{inputs:n,backend:r}=e,{x:i}=n;if(r.shouldExecuteOnCPU([i])&&"complex64"!==i.dtype){let e=E0(r.texData.get(i.dataId).values);return r.makeTensorInfo(i.shape,i.dtype,e)}return t=eN().getBool("WEBGL_PACK_UNARY_OPERATIONS")?new CR(i.shape,AI):new Cv(i.shape,AI),r.runWebGLProgram(t,[i],i.dtype)}},AS={kernelName:eL,backendName:"webgl",kernelFunc:C5({opSnippet:Cw+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return acos(x);
`})},AE={kernelName:ez,backendName:"webgl",kernelFunc:C5({opSnippet:Cw+`
  if (x < 1.0) return NAN;
return log(x + sqrt(x * x - 1.0));`})},AC="return a + b;",AA={kernelName:eB,backendName:"webgl",kernelFunc:C8({opSnippet:AC,packedOpSnippet:AC,supportsComplex:!0,cpuKernelImpl:E_})};class AN{constructor(e,t){this.outputShape=[],this.outputShape=e,this.variableNames=t.map((e,t)=>`T${t}`);let n=[];this.variableNames.forEach(e=>{n.push(`float v${e} = get${e}AtOutCoords();`)});let r=this.variableNames.map(e=>`v${e}`).join(" + ");this.userCode=`
      void main() {
        ${n.join("\n        ")}

        float result = ${r};
        setOutput(result);
      }
    `}}class AO{constructor(e,t){this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.variableNames=t.map((e,t)=>`T${t}`);let n=[];this.variableNames.forEach(e=>{n.push(`vec4 v${e} = get${e}AtOutCoords();`)});let r=this.variableNames.map(e=>`v${e}`).join(" + ");this.userCode=`
      void main() {
        ${n.join("\n        ")}

        vec4 result = ${r};
        setOutput(result);
      }
    `}}function A$(e){let{inputs:t,backend:n}=e,r=t;if(1===r.length)return CX({inputs:{x:r[0]},backend:n});if(r.length>eN().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER")){let e=Math.floor(r.length/2),t=A$({inputs:r.slice(0,e),backend:n}),i=A$({inputs:r.slice(e),backend:n});return A$({inputs:[t,i],backend:n})}let i=r.map(e=>e.dtype).reduce((e,t)=>iw(e,t)),s=r.map(e=>e.shape),a=eN().getBool("WEBGL_PACK")?new AO(r[0].shape,s):new AN(r[0].shape,s);return n.runWebGLProgram(a,r,i)}let AR={kernelName:eU,backendName:"webgl",kernelFunc:A$},AD={kernelName:eV,backendName:"webgl",kernelFunc:function(e){let t;let{inputs:n,backend:r,attrs:i}=e,{x:s}=n,{axis:a,keepDims:o}=i,l=s.shape.length,u=Z(a,s.shape),c=u,h=li(c,l),d=s;null!=h&&(d=Av({inputs:{x:s},backend:r,attrs:{perm:h}}),c=la(c.length,l)),lr("all",c,l);let[p,f]=lt(d.shape,c),g=Aa({inputs:{x:d},backend:r,attrs:{shape:[-1,q(f)]}}),m=Ah(g,g.dtype,"all",r);return t=o?Aa({inputs:{x:m},backend:r,attrs:{shape:ln(p,u)}}):Aa({inputs:{x:m},backend:r,attrs:{shape:p}}),r.disposeIntermediateTensorInfo(g),r.disposeIntermediateTensorInfo(m),null!=h&&r.disposeIntermediateTensorInfo(d),t}},AF={kernelName:ej,backendName:"webgl",kernelFunc:function(e){let t;let{inputs:n,backend:r,attrs:i}=e,{x:s}=n,{axis:a,keepDims:o}=i,l=s.shape.length,u=Z(a,s.shape),c=u,h=li(c,l),d=s;null!=h&&(d=Av({inputs:{x:s},backend:r,attrs:{perm:h}}),c=la(c.length,l)),lr("any",c,l);let[p,f]=lt(d.shape,c),g=Aa({inputs:{x:d},backend:r,attrs:{shape:[-1,q(f)]}}),m=Ah(g,g.dtype,"any",r);return t=o?Aa({inputs:{x:m},backend:r,attrs:{shape:ln(p,u)}}):Aa({inputs:{x:m},backend:r,attrs:{shape:p}}),r.disposeIntermediateTensorInfo(g),r.disposeIntermediateTensorInfo(m),null!=h&&r.disposeIntermediateTensorInfo(d),t}};class AP{constructor(e,t,n){this.variableNames=["A"];let{windowSize:r,batchSize:i,outSize:s}=e;n||this.variableNames.push("bestIndicesA"),this.outputShape=[i,s];let a="max"===t?">":"<",o=n?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${r};

        int bestIndex = inOffset;
        float bestValue = getA(batch, bestIndex);

        for (int i = 0; i < ${r}; i++) {
          int inIdx = ${o};
          float candidate = getA(batch, inIdx);
          if (candidate ${a} bestValue) {
            bestValue = candidate;
            bestIndex = inIdx;
          }
        }
        setOutput(float(bestIndex));
      }
    `}}class AM{constructor(e,t,n,r){let i,s;this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,j(e.length>2,()=>`Packed arg${n.charAt(0).toUpperCase()+n.slice(1)} supports only inputs with rank above 2.`);let a=Math.ceil(e[e.length-1]/t);this.outputShape=e.slice(0,-1),a>1&&this.outputShape.push(a),r||this.variableNames.push("bestIndicesA");let o=this.outputShape,l=o.length,u=SG(l),c=Co("coords",l);if(1===a){let e=SG(s=l+1);i=`
        ${e} sourceLocR = ${e}(${c.join()}, 0);
        ++${c[l-1]};
        ${e} sourceLocG = ${e}(${c.join()}, 0);
        ++${c[l-2]};
        ${e} sourceLocA = ${e}(${c.join()}, 0);
        --${c[l-1]};
        ${e} sourceLocB = ${e}(${c.join()}, 0);
        --${c[l-2]};`}else s=l,i=`
        ${u} sourceLocR = coords;
        ++${c[l-1]};
        ${u} sourceLocG = coords;
        ++${c[l-2]};
        ${u} sourceLocA = coords;
        --${c[l-1]};
        ${u} sourceLocB = coords;
        --${c[l-2]};`;let h=["x","y","z","w","u","v"].slice(0,s),d="."+h[s-1],p=h.map(e=>"int "+e),f=Co("sourceLocR",s-1).concat("inIdx.r"),g=Co("sourceLocG",s-1).concat("inIdx.g"),m=Co("sourceLocB",s-1).concat("inIdx.b"),y=Co("sourceLocA",s-1).concat("inIdx.a"),b="max"===n?"greaterThan":"lessThan",v=r?"":`
          inIdx = round(vec4(getBestIndicesAChannel(${f.join()}),
                             getBestIndicesAChannel(${g.join()}),
                             getBestIndicesAChannel(${m.join()}),
                             getBestIndicesAChannel(${y.join()})));`,w=`vec4(
            getAChannel(${f.join()}),
            hasNextCol ? getAChannel(${g.join()}) : 0.,
            hasNextRow ? getAChannel(${m.join()}) : 0.,
            hasNextRow && hasNextCol ? getAChannel(${y.join()}) : 0.)`,_=r?"":`
      float getBestIndicesAChannel(${p.join()}) {
        return getChannel(getBestIndicesA(${h.join()}),
                                          vec2(${h.slice(-2).join()}));
      }`;this.userCode=`
      float getAChannel(${p.join()}) {
        return getChannel(getA(${h.join()}),
                               vec2(${h.slice(-2).join()}));
      }
      ${_}
      void main() {
        ${u} coords = getOutputCoords();
        bool hasNextCol = ${c[l-1]} < ${o[l-1]-1};
        bool hasNextRow = ${c[l-2]} < ${o[l-2]-1};
        ${i}
        ivec4 srcIdx = ivec4(sourceLocR${d}, sourceLocG${d},
          sourceLocB${d}, sourceLocA${d}) * ${t};
        ivec4 inIdx = srcIdx;
        vec4 bestIndex = vec4(inIdx);
        vec4 bestValue = ${w};

        for (int i = 0; i < ${t}; i++) {
          inIdx = srcIdx;
          ${v}
          vec4 candidate = ${w};
          bvec4 nan = isnan(candidate);
          bvec4 replace = bvec4(
            vec4(${b}(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));

          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,
                           replace.y  ? candidate.y : bestValue.y,
                           replace.z  ? candidate.z : bestValue.z,
                           replace.w  ? candidate.w : bestValue.w);
          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));
          srcIdx++;
        }
        setOutput(bestIndex);
      }
    `}}function AL(e,t,n,r=null){let i=t.shape[0],s=t.shape[1];null!=r&&(i=r.shape[0],s=r.shape[1]);let a=u6(s),o=new AP({windowSize:a,inSize:s,batchSize:i,outSize:Math.ceil(s/a)},n,null==r),l=[t];null!=r&&l.push(r);let u=e.runWebGLProgram(o,l,"int32");if(1===u.shape[1])return u;let c=AL(e,t,n,u);return e.disposeIntermediateTensorInfo(u),c}function Az(e,t,n,r=null){let i=null!=r?r.shape:t.shape,s=u6(i[i.length-1]),a=new AM(i,s,n,null==r),o=null==r?[t]:[t,r],l=e.runWebGLProgram(a,o,"int32");if(l.shape.length===t.shape.length){let r=Az(e,t,n,l);return e.disposeIntermediateTensorInfo(l),r}return l}function AB(e,t,n,r){let i=[n];if(lr("arg"+r.charAt(0).toUpperCase()+r.slice(1),i,t.shape.length),!eN().getBool("WEBGL_PACK_REDUCE")||t.shape.length<=2){let n=[],s=e.texData.get(t.dataId),a=null!==s&&s.isPacked,o=t;a&&n.push(o=e.unpackTensor(t));let[l,u]=lt(o.shape,i),c=Aa({inputs:{x:o},backend:e,attrs:{shape:[-1,q(u)]}});n.push(c);let h=AL(e,c,r);n.push(h);let d=Aa({inputs:{x:h},backend:e,attrs:{shape:l}});return n.forEach(t=>e.disposeIntermediateTensorInfo(t)),d}return Az(e,t,r)}let AU={kernelName:eG,backendName:"webgl",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{axis:s}=r,a=Z(s,i.shape),o=li(a,i.shape.length),l=i,u=[];null!=o&&(u.push(l=Av({inputs:{x:i},backend:n,attrs:{perm:o}})),a=la(a.length,l.shape.length)),lr("argMax",[a[0]],l.shape.length);let c=AB(n,l,a[0],"max");return u.forEach(e=>n.disposeIntermediateTensorInfo(e)),c}},AV={kernelName:eW,backendName:"webgl",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{axis:s}=r,a=Z(s,i.shape),o=li(a,i.shape.length),l=i,u=[];null!=o&&(u.push(l=Av({inputs:{x:i},backend:n,attrs:{perm:o}})),a=la(a.length,l.shape.length)),lr("argMin",[a[0]],l.shape.length);let c=AB(n,l,a[0],"min");return u.forEach(e=>n.disposeIntermediateTensorInfo(e)),c}},Aj={kernelName:eq,backendName:"webgl",kernelFunc:C5({opSnippet:Cw+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return asin(x);
`})},AG={kernelName:eH,backendName:"webgl",kernelFunc:C5({opSnippet:Cw+"return log(x + sqrt(x * x + 1.0));"})},AW={kernelName:eK,backendName:"webgl",kernelFunc:C5({opSnippet:Cw+`
  return atan(x);
`})},Aq={kernelName:eY,backendName:"webgl",kernelFunc:C8({opSnippet:CW+`
  return atan(a, b);
`,packedOpSnippet:`
  vec4 result = atan(a, b);
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+CH+`
  return result;
`})},AH={kernelName:eX,backendName:"webgl",kernelFunc:C5({opSnippet:Cw+`
  if ((x < -1.0) || (x > 1.0)) return NAN;
return (log(1.0 + x) - log(1.0 - x)) / 2.0;`})};class AK{constructor(e,t,n,r=!1,i=!1){if(this.variableNames=["x"],"avg"===t&&n)throw Error("Cannot compute positions for average pool.");let s=e.filterWidth,a=e.strideHeight,o=e.strideWidth,l=e.dilationHeight,u=e.dilationWidth,c=e.effectiveFilterHeight,h=e.effectiveFilterWidth,d=e.padInfo.top,p=e.padInfo.left;this.outputShape=e.outShape;let f="avg"===t,g=`((batch  * ${e.inHeight} + xR) * ${e.inWidth} + xC) * ${e.inChannels} + d`,m=`(xR * ${e.inWidth} + xC) * ${e.inChannels} + d`,y="0.0";if(f||(y="-1.0 / 1e-20"),n){let t=">=";this.userCode=`
        const ivec2 strides = ivec2(${a}, ${o});
        const ivec2 pads = ivec2(${d}, ${p});

        void main() {
          ivec4 coords = getOutputCoords();
          int batch = coords[0];
          int d = coords[3];

          ivec2 xRCCorner = coords.yz * strides - pads;
          int xRCorner = xRCCorner.x;
          int xCCorner = xRCCorner.y;

          // max/min x(?, ?, d) to get y(yR, yC, d).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;
          float avgValue = 0.0;

          for (int wR = 0; wR < ${c};
              wR += ${l}) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${h};
                wC += ${u}) {
              int xC = xCCorner + wC;

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              float value = getX(batch, xR, xC, d);

              // If a min / max value has already been found, use it. If not,
              // use the current value.
              float currMinMaxValue = mix(
                  value, minMaxValue, minMaxValueFound);
              if (value ${t} currMinMaxValue) {
                minMaxValue = value;
                minMaxValueFound = 1.0;
                minMaxPosition = ${r?i?g:m:`wR * ${h} + wC`};
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;return}let b="max",v=`${t}(${t}(${t}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;"avg"===t&&(v="avgValue / max(count, 1.0)");let w=4*Math.floor(s/4),_=s%4,x=`
      if (${f}) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = ${b}(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec2 strides = ivec2(${a}, ${o});
      const ivec2 pads = ivec2(${d}, ${p});
      const float initializationValue = ${y};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xR, int xC, int d) {
        if (xC < 0 || xC >= ${e.inWidth}) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xR, xC, d);
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d = coords[3];

        ivec2 xRCCorner = coords.yz * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // max/min x(?, ?, d) to get y(yR, yC, d).
        // ? = to be determined
        vec4 minMaxValue = vec4(${y});
        float avgValue = 0.0;
        count = 0.0;

        for (int wR = 0; wR < ${c};
            wR += ${l}) {
          int xR = xRCorner + wR;

          if (xR < 0 || xR >= ${e.inHeight}) {
            continue;
          }

          for (int wC = 0; wC < ${w}; wC += 4) {
            int xC = xCCorner + wC * ${u};

            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${u}, d),
              getValue(batch, xR, xC + 2 * ${u}, d),
              getValue(batch, xR, xC + 3 * ${u}, d)
            );

            ${x}
          }

          int xC = xCCorner + ${w};
          if (${1===_}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              initializationValue,
              initializationValue,
              initializationValue
            );

            ${x}
          } else if (${2===_}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${u}, d),
              initializationValue,
              initializationValue
            );

            ${x}
          } else if (${3===_}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${u}, d),
              getValue(batch, xR, xC + 2 * ${u}, d),
              initializationValue
            );

            ${x}
          }
        }
        setOutput(${v});
      }
    `}}class AX{constructor(e,t,n,r=!1,i=!1){if(this.variableNames=["x"],"avg"===t&&n)throw Error("Cannot compute positions for average pool.");let s=e.filterWidth,a=e.strideDepth,o=e.strideHeight,l=e.strideWidth,u=e.dilationDepth,c=e.dilationHeight,h=e.dilationWidth,d=e.effectiveFilterDepth,p=e.effectiveFilterHeight,f=e.effectiveFilterWidth,g=e.padInfo.front,m=e.padInfo.top,y=e.padInfo.left;this.outputShape=e.outShape;let b="avg"===t,v="0.0";if(b||(v="-1.0 / 1e-20"),n){let t=">=";this.userCode=`
        const ivec3 strides =
            ivec3(${a}, ${o}, ${l});
        const ivec3 pads = ivec3(${g}, ${m}, ${y});

        void main() {
          ivec5 coords = getOutputCoords();
          int batch = coords.x;
          int ch = coords.u;

          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
          int xDCorner = xCorner.x;
          int xRCorner = xCorner.y;
          int xCCorner = xCorner.z;

          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;

          for (int wD = 0; wD < ${d};
              wD += ${u}) {
            int xD = xDCorner + wD;

            if (xD < 0 || xD >= ${e.inDepth}) {
              continue;
            }

            for (int wR = 0; wR < ${p};
                wR += ${c}) {
              int xR = xRCorner + wR;

              if (xR < 0 || xR >= ${e.inHeight}) {
                continue;
              }

              for (int wC = 0; wC < ${f};
                  wC += ${h}) {
                int xC = xCCorner + wC;

                if (xC < 0 || xC >= ${e.inWidth}) {
                  continue;
                }

                float value = getX(batch, xD, xR, xC, ch);

                // If a min / max value has already been found, use it. If not,
                // use the current value.
                float currMinMaxValue = mix(
                    value, minMaxValue, minMaxValueFound);
                if (value ${t} currMinMaxValue) {
                  minMaxValue = value;
                  minMaxValueFound = 1.0;
                  minMaxPosition = ${r?i?`(((batch * ${e.inDepth} + xD) * ${e.inHeight} + xR) * ${e.inWidth} + xC) * ${e.inChannels} + ch`:`((xD * ${e.inHeight} + xR) * ${e.inWidth} + xC) * ${e.inChannels} + ch`:`wD * ${p} * ${f} +
                      wR * ${f} + wC`};
                }
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;return}let w="max",_=`${t}(${t}(${t}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;"avg"===t&&(_="avgValue / max(count, 1.0)");let x=4*Math.floor(s/4),T=s%4,I=`
      if (${b}) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = ${w}(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec3 strides =
        ivec3(${a}, ${o}, ${l});
      const ivec3 pads = ivec3(${g}, ${m}, ${y});
      const float initializationValue = ${v};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xD, int xR, int xC, int ch) {
        if (xC < 0 || xC >= ${e.inWidth}) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xD, xR, xC, ch);
      }

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xDCorner = xCorner.x;
        int xRCorner = xCorner.y;
        int xCCorner = xCorner.z;

        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).
        // ? = to be determined
        vec4 minMaxValue = vec4(${v});
        float avgValue = 0.0;
        count = 0.0;

        for (int wD = 0; wD < ${d};
            wD += ${u}) {
          int xD = xDCorner + wD;

          if (xD < 0 || xD >= ${e.inDepth}) {
            continue;
          }

          for (int wR = 0; wR < ${p};
            wR += ${c}) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${x}; wC += 4) {
              int xC = xCCorner + wC * ${h};

              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${h}, ch),
                getValue(batch, xD, xR, xC + 2 * ${h}, ch),
                getValue(batch, xD, xR, xC + 3 * ${h}, ch)
              );

              ${I}
            }

            int xC = xCCorner + ${x};
            if (${1===T}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                initializationValue,
                initializationValue,
                initializationValue
              );

              ${I}
            } else if (${2===T}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${h}, ch),
                initializationValue,
                initializationValue
              );

              ${I}
            } else if (${3===T}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${h}, ch),
                getValue(batch, xD, xR, xC + 2 * ${h}, ch),
                initializationValue
              );

              ${I}
            }
          }
        }
        setOutput(${_});
      }
    `}}let AY={kernelName:eQ,backendName:"webgl",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{x:i}=t;k2(i,"avgPool");let{filterSize:s,strides:a,pad:o,dimRoundingMode:l}=r,u=1;j(ob(a,1),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${a} and dilations '${u}'`);let c=oi(i.shape,s,a,u,o,l);if(1===c.filterWidth&&1===c.filterHeight&&H(c.inShape,c.outShape))return CX({inputs:{x:i},backend:n});let h=new AK(c,"avg",!1);return n.runWebGLProgram(h,[i],"float32")}},AQ={kernelName:eZ,backendName:"webgl",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{filterSize:s,strides:a,pad:o,dimRoundingMode:l,dataFormat:u}=r,c=[1,1,1],h=new AX(os(i.shape,s,a,c,o,l,u),"avg",!1);return n.runWebGLProgram(h,[i],"float32")}};class AJ{constructor(e){this.variableNames=["dy"],this.outputShape=e.inShape;let t=e.filterHeight,n=e.filterWidth,r=e.strideHeight,i=e.strideWidth,s=e.dilationHeight,a=e.dilationWidth,o=e.effectiveFilterHeight,l=e.effectiveFilterWidth,u=o-1-e.padInfo.top,c=l-1-e.padInfo.left,h=1/(t*n);this.userCode=`
      const ivec2 pads = ivec2(${u}, ${c});
      const float avgMultiplier = float(${h});

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${o};
            wR += ${s}) {
          float dyR = float(dyRCorner + wR) / ${r}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < ${l};
            wC+= ${a}) {
            float dyC = float(dyCCorner + wC) / ${i}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);

            dotProd += dyValue * avgMultiplier;
          }
        }
        setOutput(dotProd);
      }
    `}}class AZ{constructor(e){this.variableNames=["dy"],this.outputShape=e.inShape;let t=e.filterDepth,n=e.filterHeight,r=e.filterWidth,i=e.strideDepth,s=e.strideHeight,a=e.strideWidth,o=e.dilationDepth,l=e.dilationHeight,u=e.dilationWidth,c=e.effectiveFilterDepth,h=e.effectiveFilterHeight,d=e.effectiveFilterWidth,p=c-1-e.padInfo.front,f=h-1-e.padInfo.top,g=d-1-e.padInfo.left,m=1/(t*n*r);this.userCode=`
      const ivec3 pads = ivec3(${p}, ${f}, ${g});
      const float avgMultiplier = float(${m});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < ${c};
            wD += ${o}) {
          float dyD = float(dyDCorner + wD) / ${i}.0;

          if (dyD < 0.0 || dyD >= ${e.outDepth}.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < ${h};
              wR += ${l}) {
            float dyR = float(dyRCorner + wR) / ${s}.0;

            if (dyR < 0.0 || dyR >= ${e.outHeight}.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < ${d};
                wC += ${u}) {
              float dyC = float(dyCCorner + wC) / ${a}.0;

              if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);

              dotProd += dyValue * avgMultiplier;
            }
          }
        }
        setOutput(dotProd);
      }
    `}}let A0={kernelName:e0,backendName:"webgl",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{dy:i,input:s}=t,a=s,{filterSize:o,strides:l,pad:u,dimRoundingMode:c}=r,h=[1,1,1],d=new AZ(os(a.shape,o,l,h,u,c));return n.runWebGLProgram(d,[i],a.dtype)}},A1={kernelName:eJ,backendName:"webgl",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{dy:i,input:s}=t,a=s;k2([i,s],"avgPoolGrad");let{filterSize:o,strides:l,pad:u}=r,c=new AJ(oi(a.shape,o,l,1,u));return n.runWebGLProgram(c,[i],a.dtype)}},A2={kernelName:e1,backendName:"webgl",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{a:i,b:s}=t,{transposeA:a,transposeB:o}=r;return Ax({a:i,b:s,transposeA:a,transposeB:o,backend:n})}};class A3{constructor(e,t,n,r,i,s){this.outputShape=[],this.variableNames=["x","mean","variance"],av(e,t),av(e,n);let a="0.0";null!=r&&(av(e,r),this.variableNames.push("offset"),a="getOffsetAtOutCoords()");let o="1.0";null!=i&&(av(e,i),this.variableNames.push("scale"),o="getScaleAtOutCoords()"),this.outputShape=e,this.userCode=`
      void main() {
        float x = getXAtOutCoords();
        float mean = getMeanAtOutCoords();
        float variance = getVarianceAtOutCoords();
        float offset = ${a};
        float scale = ${o};
        float inv = scale * inversesqrt(variance + float(${s}));
        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));
      }
    `}}class A4{constructor(e,t,n,r,i,s){this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],av(e,t),av(e,n);let a="vec4(0.0)";null!=r&&(av(e,r),this.variableNames.push("offset"),a="getOffsetAtOutCoords()");let o="vec4(1.0)";null!=i&&(av(e,i),this.variableNames.push("scale"),o="getScaleAtOutCoords()"),this.outputShape=e,this.userCode=`
      void main() {
        vec4 offset = ${a};
        vec4 scale = ${o};

        vec4 x = getXAtOutCoords();
        vec4 mean = getMeanAtOutCoords();
        vec4 variance = getVarianceAtOutCoords();

        vec4 inv = scale * inversesqrt(variance + vec4(${s}));

        setOutput((x - mean) * inv + offset);
      }
    `}}let A6={kernelName:tL,backendName:"webgl",kernelFunc:({inputs:e,backend:t,attrs:n})=>{let{x:r,mean:i,variance:s,offset:a,scale:o}=e;j(i.shape.length===s.shape.length,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),j(null==a||i.shape.length===a.shape.length,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),j(null==o||i.shape.length===o.shape.length,()=>"Batch normalization gradient requires mean and scale to have equal ranks.");let{varianceEpsilon:l}=n;null==l&&(l=.001);let u=[r,i,s],c=null;null!=a&&(c=a.shape,u.push(a));let h=null;null!=o&&(h=o.shape,u.push(o));let d=eN().getBool("WEBGL_PACK_NORMALIZATION")?new A4(r.shape,i.shape,s.shape,c,h,l):new A3(r.shape,i.shape,s.shape,c,h,l);return t.runWebGLProgram(d,u,u[0].dtype)}};class A5{constructor(e){let t;this.variableNames=["source"],this.outputShape=e,this.rank=e.length;let n=SG(this.rank);this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];let r=A7(this.rank),i=e.map((e,t)=>`sourceLoc.${A8[t]} = start[${t}] + coords.${A8[t]};`);t=`
        ${n} sourceLoc;
        ${n} coords = getOutputCoords();
        ${i.join("\n")}
      `,this.userCode=`
      void main() {
        ${t}
        setOutput(getSource(${r}));
      }
    `}}let A8=["x","y","z","w","u","v"];function A7(e){if(1===e)return"sourceLoc";if(e<=6)return A8.slice(0,e).map(e=>"sourceLoc."+e).join(",");throw Error(`Slicing for rank ${e} is not yet supported`)}class A9{constructor(e){this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.rank=e.length,this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];let t=SG(this.rank),n=Co("coords",this.rank),r=Co("sourceLoc",this.rank),i=1===this.rank?"sourceLoc":`vec2(${r.slice(-2).join()})`,s=`getChannel(getSource(${r.join()}), ${i})`,a=`
      result.x = ${s};
      if (++${n[this.rank-1]} < ${e[this.rank-1]}) {
        ++${r[this.rank-1]};
        result.y = ${s};
        --${r[this.rank-1]};
      }
    `,o=1===this.rank?"":`
      --${n[this.rank-1]};
      if (++${n[this.rank-2]} < ${e[this.rank-2]}) {
        ++${r[this.rank-2]};
        result.z = ${s};
        if (++${n[this.rank-1]} < ${e[this.rank-1]}) {
          ++${r[this.rank-1]};
          result.w = ${s};
        }
      }
    `,l=this.rank<=4?`sourceLoc = coords +
            ${t}(${e.map((e,t)=>`start[${t}]`).join()});`:e.map((e,t)=>`${r[t]} = ${n[t]} + start[${t}];`).join("\n");this.userCode=`
      void main() {
        ${t} coords = getOutputCoords();
        ${t} sourceLoc;
        ${l}
        vec4 result = vec4(0.);
        ${a}
        ${o}
        setOutput(result);
      }
    `}}function Ne(e,t,n,r){let i=r.texData.get(e.dataId),s=r.makeTensorInfo(n,e.dtype),a=r.texData.get(s.dataId);Object.assign(a,i),a.refCount=1,a.shape=n,a.dtype=e.dtype;let o=a6(t,ef(e.shape));i.slice&&(o+=i.slice.flatOffset),a.slice={flatOffset:o,origDataId:i.slice&&i.slice.origDataId||e.dataId};let l=r.dataRefCount.get(a.slice.origDataId)||1;return r.dataRefCount.set(a.slice.origDataId,l+1),s}function Nt(e){let{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{begin:s,size:a}=r,[o,l]=a5(i,s,a);if(aq(i,o,l),0===q(l))return n.makeTensorInfo(l,i.dtype,[]);if(n.shouldExecuteOnCPU([i])||"string"===i.dtype){let e=E1(n.texData.get(i.dataId).values,o,l,i.shape,i.dtype);return n.makeTensorInfo(l,i.dtype,e)}let{isPacked:u}=n.texData.get(i.dataId),c=a4(i.shape,o,l);if(u||!c){let e=eN().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new A9(l):new A5(l),t=[o];return n.runWebGLProgram(e,[i],i.dtype,t)}return n.uploadToGPU(i.dataId),Ne(i,o,l,n)}let Nn={kernelName:nG,backendName:"webgl",kernelFunc:Nt},Nr={kernelName:e2,backendName:"webgl",kernelFunc:e=>{let{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{blockShape:s,crops:a}=r;j(i.shape.length<=4,()=>"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet");let o=s.reduce((e,t)=>e*t),l=u8(i.shape,s,o),u=u7(l.length,s.length),c=u9(i.shape,s,o),h=ce(a,s.length),d=ct(c,a,s.length),p=[],f=Aa({inputs:{x:i},backend:n,attrs:{shape:l}}),g=Av({inputs:{x:f},backend:n,attrs:{perm:u}}),m=Aa({inputs:{x:g},backend:n,attrs:{shape:c}}),y=Nt({inputs:{x:m},backend:n,attrs:{begin:h,size:d}});return p.push(f),p.push(g),p.push(m),p.forEach(e=>n.disposeIntermediateTensorInfo(e)),y}},Ni={kernelName:e3,backendName:"webgl",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{x:i,weights:s}=t,{size:a}=r,o=Ex(n.readSync(i.dataId),n.readSync(s.dataId),s.dtype,s.shape,a);return n.makeTensorInfo([a],s.dtype,o)}},Ns=`
  int r = int(a.r) & int(b.r);
  int g = int(a.g) & int(b.g);
  int rb = int(a.b) & int(b.b);
  int ra = int(a.a) & int(b.a);
  return vec4(r, g, rb, ra);
`,Na=`
  return float(int(a.r) & int(b.r));
`,No={kernelName:e4,backendName:"webgl",kernelFunc:function(e){let t;let{inputs:n,backend:r}=e,{a:i,b:s}=n,a=eN().getBool("WEBGL_PACK_BINARY_OPERATIONS"),o=eN().getNumber("WEBGL_VERSION");if(r.shouldExecuteOnCPU([i,s])||1===o){let e=r.texData.get(i.dataId).values,t=r.texData.get(s.dataId).values,[n,a]=EI(i.shape,s.shape,e,t,i.dtype),o=r.makeTensorInfo(a,i.dtype);return r.texData.get(o.dataId).values=n,o}return t=a?new CK(Ns,i.shape,s.shape,!1):new Cq(Na,i.shape,s.shape),r.runWebGLProgram(t,[i,s],i.dtype)}},Nl={kernelName:e5,backendName:"webgl",kernelFunc:function(e){let{inputs:t,backend:n}=e,{s0:r,s1:i}=t,s=n.readSync(r.dataId),a=n.readSync(i.dataId),o=av(Array.from(s),Array.from(a));return n.makeTensorInfo([o.length],"int32",Int32Array.from(o))}},Nu=C8({opSnippet:"return float(a != b);",cpuKernelImpl:EW,dtype:"bool"}),Nc={kernelName:nd,backendName:"webgl",kernelFunc:Nu};function Nh(e){let{inputs:t,backend:n}=e,{input:r}=t;return CX({inputs:{x:n.texData.get(r.dataId).complexTensorInfos.real},backend:n})}let Nd={kernelName:nE,backendName:"webgl",kernelFunc:Nh},Np="return float(int(x));";function Nf(e,t){let n=new Cv(e.shape,Np),r=t.runWebGLProgram(n,[e],"int32");return{dataId:r.dataId,shape:r.shape,dtype:r.dtype}}function Ng(e){let{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{dtype:s}=r;if("complex64"===s){if("complex64"===i.dtype)return CX({inputs:{x:i},backend:n});let e=lv(i.shape),t=Ng({inputs:{x:i},backend:n,attrs:{dtype:"float32"}}),r=CQ({inputs:{real:t,imag:e},backend:n});return e.dispose(),n.disposeIntermediateTensorInfo(t),r}if("complex64"===i.dtype){let e=Nh({inputs:{input:i},backend:n}),t=Ng({inputs:{x:e},backend:n,attrs:{dtype:s}});return n.disposeIntermediateTensorInfo(e),t}if(!es(i.dtype,s)){let e=CX({inputs:{x:i},backend:n});return{dataId:e.dataId,shape:e.shape,dtype:s}}if(n.shouldExecuteOnCPU([i])){let[e,t,r]=Ek(n.texData.get(i.dataId).values,i.shape,i.dtype,s);return n.makeTensorInfo(e,t,r)}if("int32"===s)return Nf(i,n);if("bool"===s){let e=n.makeTensorInfo([],"bool",et("bool",1)),t=Nu({inputs:{a:i,b:e},backend:n});return n.disposeIntermediateTensorInfo(e),t}throw Error(`Error in Cast: failed to cast ${i.dtype} to ${s}`)}let Nm={kernelName:e8,backendName:"webgl",kernelFunc:Ng},Ny="return ceil(x);",Nb={kernelName:e7,backendName:"webgl",kernelFunc:C5({opSnippet:Ny,packedOpSnippet:Ny,cpuKernelImpl:ES})};class Nv{constructor(e){this.variableNames=["A"],this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=e,this.userCode=`

      void main() {
        float value = getAAtOutCoords();
        if (isnan(value)) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, minVal, maxVal));
      }
    `}}class Nw{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=e,this.userCode=`
      void main() {
        vec4 value = getAAtOutCoords();

        if (any(isnan(value))) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));
      }
    `}}let N_={kernelName:e9,backendName:"webgl",kernelFunc:function(e){let t;let{inputs:n,backend:r,attrs:i}=e,{x:s}=n,{clipValueMin:a,clipValueMax:o}=i;t=eN().getBool("WEBGL_PACK_CLIP")?new Nw(s.shape):new Nv(s.shape);let l=[[a],[o]];return r.runWebGLProgram(t,[s],s.dtype,l)}};class Nx{constructor(e){this.variableNames=["real","imag"],this.outputShape=e,this.userCode=`
      void main() {
        float re = abs(getRealAtOutCoords());
        float im = abs(getImagAtOutCoords());
        float mx = max(re, im);

        // sadly the length function in glsl is not underflow-safe
        // (at least not on Intel GPUs). So the safe solution is
        // to ensure underflow-safety in all cases.
        setOutput(
          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))
        );
      }
    `}}function NT(e,t){return{dataId:t.dataId,dtype:t.dtype,shape:e.shape}}let NI={kernelName:tt,backendName:"webgl",kernelFunc:function(e){let{inputs:t,backend:n}=e,{x:r}=t,i=n.texData.get(r.dataId),s=new Nx(r.shape),a=[NT(r,i.complexTensorInfos.real),NT(r,i.complexTensorInfos.imag)];return n.runWebGLProgram(s,a,a[0].dtype)}};class Nk{constructor(e){this.outputShape=[],this.outputShape=uZ(e,1),this.variableNames=e.map((e,t)=>`T${t}`);let t=Array(e.length-1);t[0]=e[0][1];for(let n=1;n<t.length;n++)t[n]=t[n-1]+e[n][1];let n=[`if (yC < ${t[0]}) setOutput(getT0(yR, yC));`];for(let e=1;e<t.length;e++){let r=t[e-1];n.push(`else if (yC < ${t[e]}) setOutput(getT${e}(yR, yC-${r}));`)}let r=t.length,i=t[t.length-1];n.push(`else setOutput(getT${r}(yR, yC-${i}));`),this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int yR = coords.x;
        int yC = coords.y;

        ${n.join("\n        ")}
      }
    `}}class NS{constructor(e,t){this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=uZ(e,t);let n=this.outputShape,r=n.length,i=SG(r),s=Co("coords",r),a=["x","y","z","w","u","v"].slice(0,r);this.variableNames=e.map((e,t)=>`T${t}`);let o=Array(e.length-1);o[0]=e[0][t];for(let n=1;n<o.length;n++)o[n]=o[n-1]+e[n][t];let l=a[t],u=a.slice(-2),c=a.join(),h=`if (${l} < ${o[0]}) {
        return getChannel(
            getT0(${c}), vec2(${u.join()}));
        }`;for(let e=1;e<o.length;e++){let t=o[e-1];h+=`
        if (${l} < ${o[e]}  && ${l} >= ${o[e-1]}) {
          return getChannel(
            getT${e}(${NE(a,l,t)}),
            vec2(${NE(u,l,t)}));
        }`}let d=o.length,p=o[o.length-1];h+=`
        return getChannel(
          getT${d}(${NE(a,l,p)}),
          vec2(${NE(u,l,p)}));`,this.userCode=`
      float getValue(${a.map(e=>"int "+e)}) {
        ${h}
      }

      void main() {
        ${i} coords = getOutputCoords();
        vec4 result = vec4(getValue(${s}), 0., 0., 0.);

        ${s[r-1]} = ${s[r-1]} + 1;
        if (${s[r-1]} < ${n[r-1]}) {
          result.g = getValue(${s});
        }

        ${s[r-2]} = ${s[r-2]} + 1;
        if (${s[r-2]} < ${n[r-2]}) {
          result.a = getValue(${s});
        }

        ${s[r-1]} = ${s[r-1]} - 1;
        if (${s[r-2]} < ${n[r-2]} &&
            ${s[r-1]} < ${n[r-1]}) {
          result.b = getValue(${s});
        }
        setOutput(result);
      }
    `}}function NE(e,t,n){let r=e.indexOf(t);return e.map((e,t)=>t===r?`${e} - ${n}`:e).join()}function NC(e){let{inputs:t,backend:n}=e,{input:r}=t;return CX({inputs:{x:n.texData.get(r.dataId).complexTensorInfos.imag},backend:n})}let NA={kernelName:tW,backendName:"webgl",kernelFunc:NC};function NN(e,t,n){let r=e[0].dtype;if("complex64"===r){let r=e.map(e=>Nh({inputs:{input:e},backend:n})),i=e.map(e=>NC({inputs:{input:e},backend:n})),s=NN(r,t,n),a=NN(i,t,n),o=CQ({inputs:{real:s,imag:a},backend:n});return r.forEach(e=>n.disposeIntermediateTensorInfo(e)),i.forEach(e=>n.disposeIntermediateTensorInfo(e)),n.disposeIntermediateTensorInfo(s),n.disposeIntermediateTensorInfo(a),o}let i=n.shouldExecuteOnCPU(e);if("string"===r&&(i=!0),i){let i=e.map(e=>{let r=[-1,q(e.shape.slice(t))];return Aa({inputs:{x:e},backend:n,attrs:{shape:r}})}),s=EE(i.map(e=>({vals:n.readSync(e.dataId),shape:e.shape})),uZ(i.map(e=>e.shape),1),r,1===i[0].shape[0]),a=uZ(e.map(e=>e.shape),t),o=n.makeTensorInfo(a,r,s);return i.forEach(e=>n.disposeIntermediateTensorInfo(e)),o}let s=e.filter(e=>q(e.shape)>0),a=eN().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&s[0].shape.length>1;if(1===s.length){let t=a?new Cv(e[0].shape,CS):new CR(e[0].shape,CS);return n.runWebGLProgram(t,e,r)}let o=eN().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER");if(s.length>o){let e=[];for(let r=0;r<s.length;r+=o){let i=s.slice(r,r+o);e.push(NN(i,t,n))}let r=NN(e,t,n);for(let t of e)n.disposeIntermediateTensorInfo(t);return r}if(a){let e=new NS(s.map(e=>e.shape),t);return n.runWebGLProgram(e,s,r)}let{tensors2D:l,outShape:u}=NO(s,t,n),c=new Nk(l.map(e=>e.shape)),h=n.runWebGLProgram(c,l,r);l.forEach(e=>n.disposeIntermediateTensorInfo(e));let d=Aa({inputs:{x:h},attrs:{shape:u},backend:n});return n.disposeIntermediateTensorInfo(h),d}function NO(e,t,n){let r=uZ(e.map(e=>e.shape),t);return{tensors2D:e.map(e=>Aa({inputs:{x:e},attrs:{shape:[-1,q(e.shape.slice(t))]},backend:n})),outShape:r}}function N$(e){let{inputs:t,backend:n,attrs:r}=e,{axis:i}=r,s=Z(i,t[0].shape)[0];uJ(t.map(e=>e.shape),s);let a=uZ(t.map(e=>e.shape),s);if(0===q(a))return n.makeTensorInfo(a,t[0].dtype,[]);let o=t.filter(e=>q(e.shape)>0);return 1===o.length?CX({inputs:{x:o[0]},backend:n}):NN(o,s,n)}let NR={kernelName:tn,backendName:"webgl",kernelFunc:N$};class ND{constructor(e,t=!1,n=null,r=!1,i=!1){this.variableNames=["x","W"],this.outputShape=e.outShape;let s=e.padInfo.top,a=e.padInfo.left,o=e.strideHeight,l=e.strideWidth,u=e.dilationHeight,c=e.dilationWidth,h=e.filterHeight,d=e.filterWidth,p=4*Math.floor(e.inChannels/4),f=e.inChannels%4,g="channelsLast"===e.dataFormat,m=g?1:2,y=g?2:3,b=g?3:1,v="",w="";n&&(v=r?`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          ${n}
        }`:i?`float activation(float a) {
          float b = getLeakyreluAlphaAtOutCoords();
          ${n}
        }`:`
          float activation(float x) {
            ${n}
          }
        `,w="result = activation(result);");let _=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${v}

      const ivec2 strides = ivec2(${o}, ${l});
      const ivec2 pads = ivec2(${s}, ${a});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d2 = coords[${b}];

        ivec2 xRCCorner =
            ivec2(coords[${m}], coords[${y}]) * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${h}; wR++) {
          int xR = xRCorner + wR * ${u};

          if (xR < 0 || xR >= ${e.inHeight}) {
            continue;
          }

          for (int wC = 0; wC < ${d}; wC++) {
            int xC = xCCorner + wC * ${c};

            if (xC < 0 || xC >= ${e.inWidth}) {
              continue;
            }

            for (int d1 = 0; d1 < ${p}; d1 += 4) {
              vec4 wValues = vec4(
                getW(wR, wC, d1, d2),
                getW(wR, wC, d1 + 1, d2),
                getW(wR, wC, d1 + 2, d2),
                getW(wR, wC, d1 + 3, d2)
              );

              if (${g}) {
                vec4 xValues = vec4(
                  getX(batch, xR, xC, d1),
                  getX(batch, xR, xC, d1 + 1),
                  getX(batch, xR, xC, d1 + 2),
                  getX(batch, xR, xC, d1 + 3)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec4 xValues = vec4(
                  getX(batch, d1, xR, xC),
                  getX(batch, d1 + 1, xR, xC),
                  getX(batch, d1 + 2, xR, xC),
                  getX(batch, d1 + 3, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }
            }

            if (${1===f}) {

              if (${g}) {
                dotProd +=
                    getX(batch, xR, xC, ${p}) *
                    getW(wR, wC, ${p}, d2);
              } else {
                dotProd +=
                    getX(batch, ${p}, xR, xC) *
                    getW(wR, wC, ${p}, d2);
              }

            } else if (${2===f}) {
              vec2 wValues = vec2(
                getW(wR, wC, ${p}, d2),
                getW(wR, wC, ${p} + 1, d2)
              );

              if (${g}) {
                vec2 xValues = vec2(
                  getX(batch, xR, xC, ${p}),
                  getX(batch, xR, xC, ${p} + 1)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec2 xValues = vec2(
                  getX(batch, ${p}, xR, xC),
                  getX(batch, ${p} + 1, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            } else if (${3===f}) {
              vec3 wValues = vec3(
                getW(wR, wC, ${p}, d2),
                getW(wR, wC, ${p} + 1, d2),
                getW(wR, wC, ${p} + 2, d2)
              );

              if (${g}) {
                vec3 xValues = vec3(
                  getX(batch, xR, xC, ${p}),
                  getX(batch, xR, xC, ${p} + 1),
                  getX(batch, xR, xC, ${p} + 2)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec3 xValues = vec3(
                  getX(batch, ${p}, xR, xC),
                  getX(batch, ${p} + 1, xR, xC),
                  getX(batch, ${p} + 2, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            }
          }
        }

        float result = dotProd;
        ${_}
        ${w}
        setOutput(result);
      }
    `}}class NF{constructor(e){this.variableNames=["x","W"],this.outputShape=e.outShape;let t=e.padInfo.front,n=e.padInfo.top,r=e.padInfo.left,i=e.strideDepth,s=e.strideHeight,a=e.strideWidth,o=e.dilationDepth,l=e.dilationHeight,u=e.dilationWidth,c=e.filterDepth,h=e.filterHeight,d=e.filterWidth,p=4*Math.floor(e.inChannels/4),f=e.inChannels%4;this.userCode=`
      const ivec3 strides = ivec3(${i}, ${s}, ${a});
      const ivec3 pads = ivec3(${t}, ${n}, ${r});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d2 = coords.u;

        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xFCorner = xFRCCorner.x;
        int xRCorner = xFRCCorner.y;
        int xCCorner = xFRCCorner.z;

        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get
        // y(yF, yR, yC, d2). ? = to be determined. : = across all
        // values in that axis.
        float dotProd = 0.0;
        for (int wF = 0; wF < ${c}; wF++) {
          int xF = xFCorner + wF * ${o};

          if (xF < 0 || xF >= ${e.inDepth}) {
            continue;
          }

          for (int wR = 0; wR < ${h}; wR++) {
            int xR = xRCorner + wR * ${l};

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${d}; wC++) {
              int xC = xCCorner + wC * ${u};

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              for (int d1 = 0; d1 < ${p}; d1 += 4) {
                vec4 xValues = vec4(
                  getX(batch, xF, xR, xC, d1),
                  getX(batch, xF, xR, xC, d1 + 1),
                  getX(batch, xF, xR, xC, d1 + 2),
                  getX(batch, xF, xR, xC, d1 + 3)
                );
                vec4 wValues = vec4(
                  getW(wF, wR, wC, d1, d2),
                  getW(wF, wR, wC, d1 + 1, d2),
                  getW(wF, wR, wC, d1 + 2, d2),
                  getW(wF, wR, wC, d1 + 3, d2)
                );

                dotProd += dot(xValues, wValues);
              }

              if (${1===f}) {
                dotProd +=
                  getX(batch, xF, xR, xC, ${p}) *
                  getW(wF, wR, wC, ${p}, d2);
              } else if (${2===f}) {
                vec2 xValues = vec2(
                  getX(batch, xF, xR, xC, ${p}),
                  getX(batch, xF, xR, xC, ${p} + 1)
                );
                vec2 wValues = vec2(
                  getW(wF, wR, wC, ${p}, d2),
                  getW(wF, wR, wC, ${p} + 1, d2)
                );
                dotProd += dot(xValues, wValues);
              } else if (${3===f}) {
                vec3 xValues = vec3(
                  getX(batch, xF, xR, xC, ${p}),
                  getX(batch, xF, xR, xC, ${p} + 1),
                  getX(batch, xF, xR, xC, ${p} + 2)
                );
                vec3 wValues = vec3(
                  getW(wF, wR, wC, ${p}, d2),
                  getW(wF, wR, wC, ${p} + 1, d2),
                  getW(wF, wR, wC, ${p} + 2, d2)
                );
                dotProd += dot(xValues, wValues);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}class NP{constructor(e,t=!1,n=null,r=!1,i=!1){this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=SZ(this.outputShape.length);let s=e.padInfo.left,a=e.strideWidth,o=e.dilationWidth,l=e.filterHeight,u=e.filterWidth,c=u,h=`
       int xR; int xC; int xCOffset;
       vec4 wTexel; vec4 previous; vec4 final;`;for(let e=0;e<u;e++)h+=`
           vec4 xTexelC${2*e};
           int xTexelC${2*e}Ready;
           vec4 xTexelC${2*e+1};
           int xTexelC${2*e+1}Ready;
           vec4 xC${e};`;h+=`
     for (int r = 0; r < ${l}; r++) {
      for (int d1 = 0; d1 < ${e.inChannels}; d1 += 2) {
       `;for(let e=0;e<u;e++)h+=`
           xTexelC${2*e} = vec4(0.0);
           xTexelC${2*e}Ready = 0;
           xTexelC${2*e+1} = vec4(0.0);
           xTexelC${2*e+1}Ready = 0;
           xC${e} = vec4(0.0);`;h+=`
         xR = xRCorner + r * dilations[0];
         if (xR >=0 && xR < inDims[0]) {
       `;for(let t=0;t<(c+1)/2;t++){let n=2*t;if(h+=`
           xC = xCCorner + ${n*o};
           `,1===a){if(n<u&&(s%2==1?(h+=`
                 xCOffset = xC + 1;
                 if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${n}Ready == 0) {
                   xTexelC${n} = getX(batch, xR, xCOffset, d1);

                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC${n}.zw = vec2(0.0);
                   }
                   xTexelC${n}Ready = 1;
                 }
               `,1===o&&n>0?h+=`
                 xC${n} = vec4(xTexelC${n-2}.zw, xTexelC${n}.xy);
                 `:h+=`
                   xCOffset = xC + 1 - 2;

                   if (xCOffset >= 0 && xCOffset < inDims[1]) {
                     previous = getX(batch, xR, xCOffset, d1);

                     // Need to manually clear unused channels in case
                     // we're reading from recycled texture.
                     if (xCOffset + 1 >= inDims[1]) {
                       previous.zw = vec2(0.0);
                     }

                     xC${n} = vec4(previous.zw, xTexelC${n}.xy);
                   } else {
                     xC${n} = vec4(0.0, 0.0, xTexelC${n}.xy);
                   }
                   `):h+=`
                 if (xC >= 0 && xC < inDims[1] && xTexelC${n}Ready == 0) {
                   xTexelC${n} = getX(batch, xR, xC, d1);
                   if (xC + 1 >= inDims[1]) {
                     xTexelC${n}.zw = vec2(0.0);
                   }
                   xTexelC${n}Ready = 1;
                 }

                 xC${n} = xTexelC${n};
                 `,n+1<u)){let e=s%2==0?B(o):o;o%2==0&&s%2==1||o%2!=0&&s%2!=1?(h+=`
                   xCOffset = xC + imod(pads[1], 2) + ${e};

                   if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${n+1}Ready == 0) {
                     xTexelC${n+1} = getX(batch, xR, xCOffset, d1);

                     // Need to manually clear unused channels in case
                     // we're reading from recycled texture.
                     if (xCOffset + 1 >= inDims[1]) {
                       xTexelC${n+1}.zw = vec2(0.0);
                     }
                     xTexelC${n+1}Ready = 1;
                   }
                   `,o>1?h+=`
                     xCOffset -= 2;
                     if (xCOffset >= 0 && xCOffset < inDims[1]) {
                      previous = getX(batch, xR, xCOffset, d1);
                      xC${n+1} = vec4(previous.zw, xTexelC${n+1}.xy);
                     } else {
                      xC${n+1} = vec4(0.0, 0.0, xTexelC${n+1}.xy);
                     }
                     `:h+=`
                     xC${n+1} = vec4(xTexelC${n}.zw, xTexelC${n+1}.xy);
                     `):1===e?h+=`
                     xC${n+1} = xTexelC${n};
                     `:h+=`
                     xCOffset = xC + ${e};

                     if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${n+1}Ready == 0) {
                       xTexelC${n+1} = getX(batch, xR, xCOffset, d1);
                       if (xCOffset + 1 >= inDims[1]) {
                         xTexelC${n+1}.zw = vec2(0.0);
                       }
                       xTexelC${n+1}Ready = 1;
                     }

                     xC${n+1} = xTexelC${n+1};
                     `}}else n<u&&(s%2==1?(h+=`
                 xCOffset = xC + 1 - strides[1];
                 if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${n}Ready == 0) {
                   xTexelC${n} = getX(batch, xR, xCOffset, d1);
                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC${n}.zw = vec2(0.0);
                   }
                   xTexelC${n}Ready = 1;
                 }

                 if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC${n+1}Ready == 0) {
                   xTexelC${n+1} = getX(batch, xR, xC + 1, d1);
                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xC + 2 >= inDims[1]) {
                     xTexelC${n+1}.zw = vec2(0.0);
                   }
                   xTexelC${n+1}Ready = 1;
                 }

                 xC${n} = vec4(xTexelC${n}.zw, xTexelC${n+1}.zw);
               `,n+1<u&&(h+=`
                   final = vec4(0.0);
                   xCOffset = xC + 1 + strides[1];
                   if(xCOffset >= 0 && xCOffset < inDims[1]) {
                     final = getX(batch, xR, xCOffset, d1);
                   }
                   xC${n+1} = vec4(xTexelC${n+1}.xy, final.xy);
                 `)):(h+=`
                 if(xC >= 0 && xC < inDims[1] && xTexelC${n}Ready == 0) {
                   xTexelC${n} = getX(batch, xR, xC, d1);
                   if (xC + 1 >= inDims[1]) {
                     xTexelC${n}.zw = vec2(0.0);
                   }
                   xTexelC${n}Ready = 1;
                 }

                 xCOffset = xC + strides[1];
                 if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${n+1}Ready == 0) {
                   xTexelC${n+1} = getX(batch, xR, xCOffset, d1);
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC${n+1}.zw = vec2(0.);
                   }
                   xTexelC${n+1}Ready = 1;
                 }

                 xC${n} = vec4(
                   xTexelC${n}.xy, xTexelC${n+1}.xy);
               `,n+1<u&&(h+=`
                   xC${n+1} = vec4(xTexelC${n}.zw, xTexelC${n+1}.zw);
                 `)));n<u&&(h+=`
             wTexel = getW(r, ${n}, d1, d2);
             dotProd += xC${n}.xxzz * vec4(wTexel.xy, wTexel.xy);
             if(d1 + 1 < ${e.inChannels}) {
               dotProd += xC${n}.yyww * vec4(wTexel.zw, wTexel.zw);
             }
           `,n+1<u&&(h+=`
               wTexel = getW(r, ${n+1}, d1, d2);
               dotProd += xC${n+1}.xxzz * vec4(wTexel.xy, wTexel.xy);
               if(d1 + 1 < ${e.inChannels}) {
                 dotProd += xC${n+1}.yyww * vec4(wTexel.zw, wTexel.zw);
               }
             `))}h+=`
     }
   
     }
   
     }
   `;let d="",p="";n&&(d=r?`vec4 activation(vec4 a) {
           vec4 b = getPreluActivationWeightsAtOutCoords();
           ${n}
         }`:i?`vec4 activation(vec4 a) {
           vec4 b = getLeakyreluAlphaAtOutCoords();
           ${n}
         }`:`vec4 activation(vec4 x) {
           ${n}
         }`,p="result = activation(result);");let f=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
       ${d}

       void main() {
         ivec4 coords = getOutputCoords();
         int batch = coords.x;
         ivec2 xRCCorner = coords.yz * strides - pads;
         int d2 = coords.w;
         int xRCorner = xRCCorner.x;
         int xCCorner = xRCCorner.y;

         //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.
         vec4 dotProd = vec4(0.000000000000001);

         ${h}

         vec4 result = dotProd - vec4(0.000000000000001);
         ${f}
         ${p}
         setOutput(result);
       }
     `}}class NM{constructor(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec4"},{name:"pad",type:"ivec2"},{name:"stride",type:"ivec2"},{name:"dilation",type:"ivec2"},{name:"inChannels",type:"int"},{name:"itemsPerBlockRow",type:"int"},{name:"outWidth",type:"int"}],this.outputShape=e,this.enableShapeUniforms=SZ(this.outputShape.length);let{dataFormat:n}=t,r=k4(),i="channelsLast"===n,s=i?1:2,a=i?2:3,o=this.enableShapeUniforms?"if(blockIndex < outShape[2] && pos < outShape[1]) {":`if(blockIndex < ${e[2]} && pos < ${e[1]}) {`,l="";for(let e=0;e<=1;e++)for(let t=0;t<=1;t++)l+=`
          blockIndex = rc.z + ${t};
          pos = rc.y + ${e};

          ${o}
            offsetY = int(blockIndex / outWidth) * stride[0] - pad[0];
            d0 = offsetY + dilation[0] * (pos / itemsPerBlockRow);

            if(d0 < inputShape[${s}] && d0 >= 0) {
              // Use custom imod instead mod. On Intel GPU, mod may generate
              // unexpected value.
              // https://github.com/tensorflow/tfjs/issues/5447
              offsetX = imod(blockIndex, outWidth) * stride[1] - pad[1];
              d1 = offsetX + dilation[1] * (imod(pos, itemsPerBlockRow) /
                  inChannels);

              if(d1 < inputShape[${a}] && d1 >= 0) {

                ch = imod(pos, inChannels);

                if (${i}) {
                  innerDims = vec2(d1, ch);
                  result[${2*e+t}] = getChannel(
                    getA(rc.x, d0, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                } else {
                  innerDims = vec2(d0, d1);
                  result[${2*e+t}] = getChannel(
                    getA(rc.x, ch, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                }
              }
            }
          }
        `;this.userCode=`
      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0);

        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;
        vec2 innerDims;

        ${l}

        ${r.output} = result;
      }
    `}}function NL(e,t){let n=e.length;return n>=3?t?[...e.slice(0,-3),e[n-3]*e[n-2],e[n-1]]:[...e.slice(0,-3),e[n-3],e[n-2]*e[n-1]]:!t&&1===n&&e[0]>1?[e[0],1]:null}function Nz({x:e,filter:t,convInfo:n,backend:r,bias:i=null,preluActivationWeights:s=null,leakyreluAlpha:a=0,activation:o=null}){let l;let u=e.shape,c=r.texData.get(e.dataId),h=n.inChannels,d=u[0]*u[1]*u[2],p=n.outChannels,f="channelsLast"===n.dataFormat,g=!1,m=!1,y=[];if(null!=s){let e=NL(s.shape,f);null!=e&&(s=Aa({inputs:{x:s},backend:r,attrs:{shape:e}}),y.push(s))}if(null!=i){let e=NL(i.shape,f);null!=e&&(i=Aa({inputs:{x:i},backend:r,attrs:{shape:e}}),y.push(i))}if(!((1===d||1===p)&&h>A_)&&c.isPacked&&f&&null!=c.texture&&u[2]%2!=0&&H(c.shape.slice(-3),u.slice(-3))){let h=u[0]*u[1]*(u[2]+1),d={dataId:e.dataId,shape:[1,h,n.inChannels],dtype:e.dtype},p=c.shape;c.shape=c.shape.slice(),c.shape[c.shape.length-2]++,j(kW(c.shape,d.shape),()=>`packed reshape ${c.shape} to ${d.shape} isn't free`);let f=Aa({inputs:{x:t},backend:r,attrs:{shape:[1,n.inChannels,n.outChannels]}});y.push(f);let b=Ax({a:d,b:f,backend:r,transposeA:g,transposeB:m,bias:i,activation:o,preluActivationWeights:s,leakyreluAlpha:a}),v=r.texData.get(b.dataId);j(v.isPacked,()=>"batchMatMul result is expected to be packed"),c.shape=p,v.shape=n.outShape,(l=CX({inputs:{x:b},backend:r})).shape=n.outShape,y.push(b)}else{let u=n.outHeight*n.outWidth,c=Aa({inputs:{x:e},backend:r,attrs:{shape:f?[n.batchSize,u,n.inChannels]:[n.batchSize,n.inChannels,u]}}),h=Aa({inputs:{x:t},backend:r,attrs:{shape:[1,n.inChannels,n.outChannels]}}),d=Ax({a:f?c:h,b:f?h:c,transposeA:!f,transposeB:m,backend:r,bias:i,activation:o,preluActivationWeights:s,leakyreluAlpha:a});l=Aa({inputs:{x:d},backend:r,attrs:{shape:n.outShape}}),y.push(c),y.push(h),y.push(d)}for(let e of y)r.disposeIntermediateTensorInfo(e);return l}function NB({x:e,filter:t,convInfo:n,backend:r,bias:i=null,preluActivationWeights:s=null,leakyreluAlpha:a=0,activation:o=null}){let{filterWidth:l,filterHeight:u,inChannels:c,outWidth:h,outHeight:d,dataFormat:p}=n,f="channelsLast"===p,g=l*u*c,m=d*h,y=[n.batchSize,g,m],b=!0,v=!1,w=[];if(null!=s){let e=NL(s.shape,f);null!=e&&(s=Aa({inputs:{x:s},backend:r,attrs:{shape:e}}),w.push(s))}if(null!=i){let e=NL(i.shape,f);null!=e&&(i=Aa({inputs:{x:i},backend:r,attrs:{shape:e}}),w.push(i))}let _=Aa({inputs:{x:t},backend:r,attrs:{shape:[1,g,q(t.shape)/g]}});w.push(_);let x=new NM(y,n),T=[e.shape,[n.padInfo.top,n.padInfo.left],[n.strideHeight,n.strideWidth],[n.dilationHeight,n.dilationWidth],[n.inChannels],[n.filterWidth*n.inChannels],[n.outWidth]],I=r.runWebGLProgram(x,[e],"float32",T),k=Aa({inputs:{x:I},backend:r,attrs:{shape:y}});w.push(I),w.push(k);let S=null!=i,E=null!=s,C="leakyrelu"===o,A=o?C7(o,!0):null,N=new C9(f?k.shape:_.shape,f?_.shape:k.shape,f?[n.batchSize,m,n.outChannels]:[n.batchSize,n.outChannels,m],b,v,S,A,E,C),O=f?[k,_]:[_,k];if(i&&O.push(i),E&&O.push(s),C){let e=r.makeTensorInfo([],"float32",rX(a,"float32"));O.push(e),w.push(e)}let $=r.runWebGLProgram(N,O,"float32"),R=Aa({inputs:{x:$},backend:r,attrs:{shape:n.outShape}});for(let e of(w.push($),w))r.disposeIntermediateTensorInfo(e);return R}let NU={kernelName:tr,backendName:"webgl",kernelFunc:function(e){let t;let{inputs:n,backend:r,attrs:i}=e,{x:s,filter:a}=n,{strides:o,pad:l,dataFormat:u,dilations:c,dimRoundingMode:h}=i,d=ow(u),p=oa(s.shape,a.shape,o,c,l,h,!1,d);if(1===p.filterHeight&&1===p.filterWidth&&1===p.dilationHeight&&1===p.dilationWidth&&1===p.strideHeight&&1===p.strideWidth&&("SAME"===p.padInfo.type||"VALID"===p.padInfo.type))t=Nz({x:s,filter:a,convInfo:p,backend:r});else if(p.strideWidth<=2&&"channelsLast"===d&&eN().getBool("WEBGL_EXP_CONV")){let e=new NP(p),n=[[p.padInfo.top,p.padInfo.left],[p.strideHeight,p.strideWidth],[p.dilationHeight,p.dilationWidth],[p.inHeight,p.inWidth]];t=r.runWebGLProgram(e,[s,a],"float32",n)}else if(eN().getBool("WEBGL_CONV_IM2COL"))t=NB({x:s,filter:a,convInfo:p,backend:r});else{let e=new ND(p);t=r.runWebGLProgram(e,[s,a],"float32")}let f=Aa({inputs:{x:t},backend:r,attrs:{shape:p.outShape}});return r.disposeIntermediateTensorInfo(t),f}};class NV{constructor(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;let t=e.strideHeight,n=e.strideWidth,r=e.padInfo.top,i=e.padInfo.left,s="channelsLast"===e.dataFormat;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int d2 = coords.w;

        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int b = 0; b < ${e.batchSize}; b++) {
          for (int yR = 0; yR < ${e.outHeight}; yR++) {
            int xR = wR + yR * ${t} - ${r};

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int yC = 0; yC < ${e.outWidth}; yC++) {
              int xC = wC + yC * ${n} - ${i};

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              ${s?`float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);`:`float dyValue = getDy(b, d2, yR, yC);
              float xValue = getX(b, d1, xR, xC);
              dotProd += (xValue * dyValue);`}
            }
          }
        }
        setOutput(dotProd);
      }
    `}}class Nj{constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;let t=e.filterHeight,n=e.filterWidth,r=e.strideHeight,i=e.strideWidth,s="channelsLast"===e.dataFormat,a=t-1-e.padInfo.top,o=n-1-e.padInfo.left,l=s?1:2,u=s?2:3,c=s?3:1;this.userCode=`
      const ivec2 pads = ivec2(${a}, ${o});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[${c}];

        ivec2 dyCorner = ivec2(coords[${l}], coords[${u}]) - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${t}; wR++) {
          float dyR = float(dyRCorner + wR) / ${r}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = ${t} - 1 - wR;

          for (int wC = 0; wC < ${n}; wC++) {
            float dyC = float(dyCCorner + wC) / ${i}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = ${n} - 1 - wC;

            for (int d2 = 0; d2 < ${e.outChannels}; d2++) {

              if (${s}) {
                float xValue = getDy(batch, idyR, idyC, d2);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              } else {
                float xValue = getDy(batch, d2, idyR, idyC);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }

            }
          }
        }
        setOutput(dotProd);
      }
    `}}class NG{constructor(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;let t=e.strideDepth,n=e.strideHeight,r=e.strideWidth,i=e.padInfo.front,s=e.padInfo.top,a=e.padInfo.left;this.userCode=`
      void main() {
        ivec5 coords = getOutputCoords();
        int wF = coords.x;
        int wR = coords.y;
        int wC = coords.z;
        int d1 = coords.w;
        int d2 = coords.u;

        float dotProd = 0.0;

        for (int b = 0; b < ${e.batchSize}; b++) {
          for (int yF = 0; yF < ${e.outDepth}; yF++) {
            int xF = wF + yF * ${t} - ${i};

            if (xF < 0 || xF >= ${e.inDepth}) {
              continue;
            }

            for (int yR = 0; yR < ${e.outHeight}; yR++) {
              int xR = wR + yR * ${n} - ${s};

              if (xR < 0 || xR >= ${e.inHeight}) {
                continue;
              }

              for (int yC = 0; yC < ${e.outWidth}; yC++) {
                int xC = wC + yC * ${r} - ${a};

                if (xC < 0 || xC >= ${e.inWidth}) {
                  continue;
                }

                float dyValue = getDy(b, yF, yR, yC, d2);
                float xValue = getX(b, xF, xR, xC, d1);
                dotProd += (xValue * dyValue);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}class NW{constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;let t=e.filterDepth,n=e.filterHeight,r=e.filterWidth,i=e.strideDepth,s=e.strideHeight,a=e.strideWidth,o=t-1-e.padInfo.front,l=n-1-e.padInfo.top,u=r-1-e.padInfo.left;this.userCode=`
      const ivec3 pads = ivec3(${o}, ${l}, ${u});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.u;


        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyFCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        float dotProd = 0.0;
        for (int wF = 0; wF < ${t}; wF++) {
          float dyF = float(dyFCorner + wF) / ${i}.0;

          if (dyF < 0.0 || dyF >= ${e.outDepth}.0 || fract(dyF) > 0.0) {
            continue;
          }
          int idyF = int(dyF);

          int wFPerm = ${t} - 1 - wF;

          for (int wR = 0; wR < ${n}; wR++) {
            float dyR = float(dyRCorner + wR) / ${s}.0;

            if (dyR < 0.0 || dyR >= ${e.outHeight}.0 ||
              fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            int wRPerm = ${n} - 1 - wR;

            for (int wC = 0; wC < ${r}; wC++) {
              float dyC = float(dyCCorner + wC) / ${a}.0;

              if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              int wCPerm = ${r} - 1 - wC;

              for (int d2 = 0; d2 < ${e.outChannels}; d2++) {
                float xValue = getDy(batch, idyF, idyR, idyC, d2);
                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}let Nq={kernelName:ti,backendName:"webgl",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{x:i,dy:s}=t,{strides:a,pad:o,dataFormat:l,dimRoundingMode:u,filterShape:c}=r,h=ow(l),d=new NV(oa(i.shape,c,a,1,o,u,!1,h));return n.runWebGLProgram(d,[i,s],"float32")}};class NH{constructor(e){this.variableNames=["dy","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"strides",type:"vec2"}],this.outputShape=e.inShape,this.enableShapeUniforms=SZ(this.outputShape.length);let t=e.filterHeight,n=e.filterWidth,r=t-1-e.padInfo.top,i=n-1-e.padInfo.left;this.userCode=`
      const ivec2 pads = ivec2(${r}, ${i});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];

        ivec2 dyCorner = ivec2(coords[1], coords[2]) - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        vec4 result = vec4(0.);
        for (int wR = 0; wR < ${t}; wR++) {
          float dyR = float(dyRCorner + wR) / strides[0];
          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);
          int wRPerm = ${t} - 1 - wR;

          for (int wC = 0; wC < ${n}; wC++) {
            int wCPerm = ${n} - 1 - wC;

            float dyC = float(dyCCorner + wC) / strides[1];
            bool idyCVal = (dyC >= 0.0) && (dyC < ${e.outWidth}.0)
              && (fract(dyC) == 0.0);
            int idyC = int(dyC);

            float dyC2 = float(dyCCorner + wC + 1) / strides[1];
            bool idyCVal2 = (dyC2 >= 0.0) && (dyC2 < ${e.outWidth}.0)
              && (fract(dyC2) == 0.0);
            int idyC2 = int(dyC2);

            if (idyCVal && idyCVal2) {
              for (int d2 = 0; d2 < ${e.outChannels}; d2 += 2) {
                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);
                vec4 dySample = getDy(batch, idyR, idyC, d2);
                vec4 dySample2 = (idyC / 2 == idyC2 / 2) ?
                  dySample : getDy(batch, idyR, idyC2, d2);

                vec2 dyValue = mod(float(idyC), 2.) == 0. ?
                  dySample.xy : dySample.zw;
                result.xy += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));

                dyValue = mod(float(idyC2), 2.) == 0. ?
                  dySample2.xy : dySample2.zw;
                result.zw += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));
              }
            } else if (idyCVal) {
              for (int d2 = 0; d2 < ${e.outChannels}; d2 += 2) {
                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);
                vec4 dySample = getDy(batch, idyR, idyC, d2);
                vec2 dyValue = mod(float(idyC), 2.) == 0. ?
                  dySample.xy : dySample.zw;
                result.xy += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));
              }
            } else if (idyCVal2) {
              for (int d2 = 0; d2 < ${e.outChannels}; d2 += 2) {
                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);
                vec4 dySample = getDy(batch, idyR, idyC2, d2);
                vec2 dyValue = mod(float(idyC2), 2.) == 0. ?
                  dySample.xy : dySample.zw;
                result.zw += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));
              }
            }
          }
        }
        setOutput(result);
      }
    `}}let NK={kernelName:ts,backendName:"webgl",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{dy:i,filter:s}=t,{inputShape:a,strides:o,pad:l,dataFormat:u,dimRoundingMode:c}=r,h=ow(u),d=oa(a,s.shape,o,1,l,c,!1,h);if(eN().getBool("WEBGL_PACK_CONV2DTRANSPOSE")&&"channelsLast"===h){let e=[[d.strideHeight,d.strideWidth]],t=new NH(d);return n.runWebGLProgram(t,[i,s],"float32",e)}{let e=new Nj(d);return n.runWebGLProgram(e,[i,s],"float32")}}},NX={kernelName:ta,backendName:"webgl",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{x:i,filter:s}=t,{strides:a,pad:o,dilations:l}=r,u=new NF(oo(i.shape,s.shape,a,l,o));return n.runWebGLProgram(u,[i,s],"float32")}},NY={kernelName:to,backendName:"webgl",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{x:i,dy:s}=t,{strides:a,pad:o,filterShape:l}=r,u=new NG(oo(i.shape,l,a,1,o));return n.runWebGLProgram(u,[i,s],"float32")}},NQ={kernelName:tl,backendName:"webgl",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{dy:i,filter:s}=t,{pad:a,strides:o,inputShape:l}=r,u=new NW(oo(l,s.shape,o,1,a));return n.runWebGLProgram(u,[i,s],"float32")}},NJ={kernelName:tu,backendName:"webgl",kernelFunc:C5({opSnippet:C6+`
  return cos(x);
`,packedOpSnippet:`
  vec4 result = cos(x);
  bvec4 isNaN = isnan(x);
  ${CH}
  return result;
`})},NZ={kernelName:tc,backendName:"webgl",kernelFunc:C5({opSnippet:`
  float e2x = exp(-x);
  return (e2x + 1.0 / e2x) / 2.0;
`})};class N0{constructor(e,t,n,r,i){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];let[s,a,o,l]=e,[u]=t,[c,h]=n;this.outputShape=[u,c,h,l];let d="bilinear"===r?1:0,[p,f]=[`${a-1}.0`,`${o-1}.0`],[g,m,y]=c>1?[`${(a-1)/(c-1)}`,"(y2-y1) * height_ratio",`y1*${p} + float(y)*(height_scale)`]:["0.0","0.0",`0.5 * (y1+y2) * ${p}`],[b,v,w]=h>1?[`${(o-1)/(h-1)}`,"(x2-x1) * width_ratio",`x1*${f} + float(x)*(width_scale)`]:["0.0","0.0",`0.5 * (x1+x2) * ${f}`];this.userCode=`
      const float height_ratio = float(${g});
      const float width_ratio = float(${b});
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int y = coords[1];
        int x = coords[2];
        int d = coords[3];

        // get box vals
        float y1 = getBoxes(b,0);
        float x1 = getBoxes(b,1);
        float y2 = getBoxes(b,2);
        float x2 = getBoxes(b,3);

        // get image in batch index
        int bInd = round(getBoxInd(b));
        if(bInd < 0 || bInd >= ${s}) {
          return;
        }

        float height_scale = ${m};
        float width_scale = ${v};

        float in_y = ${y};
        if( in_y < 0.0 || in_y > ${p} ) {
          setOutput(float(${i}));
          return;
        }
        float in_x = ${w};
        if( in_x < 0.0 || in_x > ${f} ) {
          setOutput(float(${i}));
          return;
        }

        vec2 sourceFracIndexCR = vec2(in_x,in_y);
        if(${d} == 1) {
          // Compute the four integer indices.
          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);
          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));

          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);
          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);
          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);
          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);

          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);

          float top = topLeft + (topRight - topLeft) * fracCR.x;
          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;
          float newValue = top + (bottom - top) * fracCR.y;
          setOutput(newValue);
        } else {
          // Compute the coordinators of nearest neighbor point.
          ivec2 sourceNearestCR = ivec2(floor(
            sourceFracIndexCR + vec2(0.5,0.5)));
          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);
          setOutput(newValue);
        }
      }
    `}}let N1={kernelName:tp,backendName:"webgl",kernelFunc:e=>{let{inputs:t,backend:n,attrs:r}=e,{image:i,boxes:s,boxInd:a}=t,{cropSize:o,method:l,extrapolationValue:u}=r,c=new N0(i.shape,s.shape,o,l,u);return n.runWebGLProgram(c,[i,s,a],"float32")}};!function(e){e.Prod="*",e.Sum="+"}(C||(C={}));class N2{constructor(e,t,n,r){this.op=e,this.outputShape=t,this.variableNames=["x"],this.customUniforms=[{name:"index",type:"float"}];let i=this.outputShape.length,s=this.op===C.Prod?"1.0":"0.0",a=n?s:`getX(${N3(i,"coords",this.op)})`,o=this.outputShape[this.outputShape.length-1],l="",u="";n?(l=r?`end != ${o-1}`:"end != 0",u=r?"end + 1":"end - 1"):(l=r?`end + pow2 < ${o}`:"end >= pow2",u=r?"end + pow2":"end - pow2"),this.userCode=`
      void main() {
        ${SG(i)} coords = getOutputCoords();
        int end = ${N4(i,"coords",this.op)};
        float val = ${a};
        int pow2 = int(pow(2.0, index));
        if (${l}) {
          int idx = ${u};
          ${N4(i,"coords",this.op)} = idx;
          val ${this.op}= getX(${N3(i,"coords",this.op)});
        }
        setOutput(val);
      }
    `}}function N3(e,t,n){if(1===e)return`${t}`;if(2===e)return`${t}.x, ${t}.y`;if(3===e)return`${t}.x, ${t}.y, ${t}.z`;if(4===e)return`${t}.x, ${t}.y, ${t}.z, ${t}.w`;throw Error(`Cumulative ${n} for rank ${e} is not yet supported`)}function N4(e,t,n){if(1===e)return`${t}`;if(2===e)return`${t}.y`;if(3===e)return`${t}.z`;if(4===e)return`${t}.w`;throw Error(`Cumulative ${n} for rank ${e} is not yet supported`)}function N6(e,t,n,r,i,s){let a=t.shape.length,o=li([r],a),l=t;null!=o&&(l=Av({inputs:{x:t},backend:n,attrs:{perm:o}}));let u=la(1,a)[0];if(u!==a-1)throw Error(`WebGL cumprod shader expects an inner-most axis=${t.shape.length-1} but got axis=${r}`);let c=l.shape[u],h=CX({inputs:{x:l},backend:n});for(let t=0;t<=Math.ceil(Math.log2(c))-1;t++){let r=new N2(e,l.shape,!1,s),i=[[t]],a=h;h=n.runWebGLProgram(r,[h],h.dtype,i),n.disposeIntermediateTensorInfo(a)}if(i){let t=new N2(e,l.shape,i,s),r=h;h=n.runWebGLProgram(t,[h],h.dtype),n.disposeIntermediateTensorInfo(r)}if(null!=o){let e=Av({inputs:{x:h},backend:n,attrs:{perm:ls(o)}});return n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(l),e}return h}let N5={kernelName:th,backendName:"webgl",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{axis:s,exclusive:a,reverse:o}=r;return N6(C.Prod,i,n,s,a,o)}},N8={kernelName:td,backendName:"webgl",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{axis:s,exclusive:a,reverse:o}=r;return N6(C.Sum,i,n,s,a,o)}},N7={kernelName:tf,backendName:"webgl",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{x:i,weights:s}=t,{size:a,binaryOutput:o}=r;if(1===i.shape.length){let e=Ex(n.readSync(i.dataId),n.readSync(s.dataId),s.dtype,s.shape,a);return n.makeTensorInfo([a],s.dtype,e)}if(2===i.shape.length){let e=ET(n.bufferSync(i),n.bufferSync(s),a,o);return n.makeTensorInfo(e.shape,s.dtype,e.values)}throw Error(`Error in denseBincount: input must be at most rank 2, but got rank${i.shape.length}.`)}};class N9{constructor(e,t,n){this.variableNames=["x"],this.outputShape=[],this.outputShape=e,this.blockSize=t,this.dataFormat=n,this.userCode=`
    void main() {
      ivec4 coords = getOutputCoords();
      int b = coords[0];
      int h = ${this.getHeightCoordString()};
      int w = ${this.getWidthCoordString()};
      int d = ${this.getDepthCoordString()};

      int in_h = h / ${t};
      int offset_h = imod(h, ${t});
      int in_w = w / ${t};
      int offset_w = imod(w, ${t});
      int offset_d = (offset_h * ${t} + offset_w) *
        ${this.getOutputDepthSize()};
      int in_d = d + offset_d;

      float result = ${this.getInputSamplingString()};
      setOutput(result);
    }
  `}getHeightCoordString(){return"NHWC"===this.dataFormat?"coords[1]":"coords[2]"}getWidthCoordString(){return"NHWC"===this.dataFormat?"coords[2]":"coords[3]"}getDepthCoordString(){return"NHWC"===this.dataFormat?"coords[3]":"coords[1]"}getOutputDepthSize(){return"NHWC"===this.dataFormat?this.outputShape[3]:this.outputShape[1]}getInputSamplingString(){return"NHWC"===this.dataFormat?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"}}let Oe={kernelName:tg,backendName:"webgl",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{blockSize:s,dataFormat:a}=r,o=i.shape[0],l="NHWC"===a?i.shape[1]:i.shape[2],u="NHWC"===a?i.shape[2]:i.shape[3],c="NHWC"===a?i.shape[3]:i.shape[1],h=l*s,d=u*s,p=c/(s*s),f=new N9("NHWC"===a?[o,h,d,p]:[o,p,h,d],s,a);return n.runWebGLProgram(f,[i],i.dtype)}};class Ot{constructor(e,t=!1,n=null,r=!1,i=!1){this.variableNames=["x","W"],this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=SZ(this.outputShape.length);let s=e.filterHeight,a=e.filterWidth,o=e.outChannels/e.inChannels,l="",u="";n&&(l=r?`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          ${n}
        }`:i?`float activation(float a) {
          float b = getLeakyreluAlphaAtOutCoords();
          ${n}
        }`:`
          float activation(float x) {
            ${n}
          }
        `,u="result = activation(result);");let c=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${l}

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / ${o};
        int q = d2 - d1 * ${o};

        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.
        for (int wR = 0; wR < ${s}; wR++) {
          int xR = xRCorner + wR * dilations[0];

          if (xR < 0 || xR >= inDims[0]) {
            continue;
          }

          for (int wC = 0; wC < ${a}; wC++) {
            int xC = xCCorner + wC * dilations[1];

            if (xC < 0 || xC >= inDims[1]) {
              continue;
            }

            float xVal = getX(batch, xR, xC, d1);
            float wVal = getW(wR, wC, d1, q);
            dotProd += xVal * wVal;
          }
        }

        float result = dotProd;
        ${c}
        ${u}
        setOutput(result);
      }
    `}}class On{constructor(e,t=!1,n=null,r=!1,i=!1){this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=SZ(this.outputShape.length);let s=e.outChannels/e.inChannels,a=e.padInfo.left,o=e.strideWidth,l=e.dilationWidth,u=e.filterHeight,c=e.filterWidth,h=c,d=`
      int xR; int xC; int xCOffset;
      vec4 wTexel; vec4 previous; vec4 final;`;for(let e=0;e<c;e++)d+=`
          vec4 xTexelC${2*e};
          int xTexelC${2*e}Ready;
          vec4 xTexelC${2*e+1};
          int xTexelC${2*e+1}Ready;
          vec4 xC${e};`;d+=`
    for (int r = 0; r < ${u}; r++) {
      `;for(let e=0;e<c;e++)d+=`
          xTexelC${2*e} = vec4(0.0);
          xTexelC${2*e}Ready = 0;
          xTexelC${2*e+1} = vec4(0.0);
          xTexelC${2*e+1}Ready = 0;
          xC${e} = vec4(0.0);`;d+=`
        xR = xRCorner + r * dilations[0];
        if (xR >=0 && xR < inDims[0]) {
      `;for(let e=0;e<(h+1)/2;e++){let t=2*e;if(d+=`
          xC = xCCorner + ${t*l};
          `,1===o){if(t<c&&(a%2==1?(d+=`
                xCOffset = xC + 1;
                if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${t}Ready == 0) {
                  xTexelC${t} = getX(batch, xR, xCOffset, d1);

                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${t}.zw = vec2(0.0);
                  }
                  xTexelC${t}Ready = 1;
                }
              `,1===l&&t>0?d+=`
                xC${t} = vec4(xTexelC${t-2}.zw, xTexelC${t}.xy);
                `:d+=`
                  xCOffset = xC + 1 - 2;

                  if (xCOffset >= 0 && xCOffset < inDims[1]) {
                    previous = getX(batch, xR, xCOffset, d1);

                    // Need to manually clear unused channels in case
                    // we're reading from recycled texture.
                    if (xCOffset + 1 >= inDims[1]) {
                      previous.zw = vec2(0.0);
                    }

                    xC${t} = vec4(previous.zw, xTexelC${t}.xy);
                  } else {
                    xC${t} = vec4(0.0, 0.0, xTexelC${t}.xy);
                  }
                  `):d+=`
                if (xC >= 0 && xC < inDims[1] && xTexelC${t}Ready == 0) {
                  xTexelC${t} = getX(batch, xR, xC, d1);
                  if (xC + 1 >= inDims[1]) {
                    xTexelC${t}.zw = vec2(0.0);
                  }
                  xTexelC${t}Ready = 1;
                }

                xC${t} = xTexelC${t};
                `,t+1<c)){let e=a%2==0?B(l):l;l%2==0&&a%2==1||l%2!=0&&a%2!=1?(d+=`
                  xCOffset = xC + imod(pads[1], 2) + ${e};

                  if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${t+1}Ready == 0) {
                    xTexelC${t+1} = getX(batch, xR, xCOffset, d1);

                    // Need to manually clear unused channels in case
                    // we're reading from recycled texture.
                    if (xCOffset + 1 >= inDims[1]) {
                      xTexelC${t+1}.zw = vec2(0.0);
                    }
                    xTexelC${t+1}Ready = 1;
                  }
                  `,l>1?d+=`
                    xCOffset -= 2;
                    if (xCOffset >= 0 && xCOffset < inDims[1]) {
                     previous = getX(batch, xR, xCOffset, d1);
                     xC${t+1} = vec4(previous.zw, xTexelC${t+1}.xy);
                    } else {
                     xC${t+1} = vec4(0.0, 0.0, xTexelC${t+1}.xy);
                    }
                    `:d+=`
                    xC${t+1} = vec4(xTexelC${t}.zw, xTexelC${t+1}.xy);
                    `):1===e?d+=`
                    xC${t+1} = xTexelC${t};
                    `:d+=`
                    xCOffset = xC + ${e};

                    if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${t+1}Ready == 0) {
                      xTexelC${t+1} = getX(batch, xR, xCOffset, d1);
                      if (xCOffset + 1 >= inDims[1]) {
                        xTexelC${t+1}.zw = vec2(0.0);
                      }
                      xTexelC${t+1}Ready = 1;
                    }

                    xC${t+1} = xTexelC${t+1};
                    `}}else t<c&&(a%2==1?(d+=`
                xCOffset = xC + 1 - strides[1];
                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${t}Ready == 0) {
                  xTexelC${t} = getX(batch, xR, xCOffset, d1);
                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${t}.zw = vec2(0.0);
                  }
                  xTexelC${t}Ready = 1;
                }

                if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC${t+1}Ready == 0) {
                  xTexelC${t+1} = getX(batch, xR, xC + 1, d1);
                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xC + 2 >= inDims[1]) {
                    xTexelC${t+1}.zw = vec2(0.0);
                  }
                  xTexelC${t+1}Ready = 1;
                }

                xC${t} = vec4(xTexelC${t}.zw, xTexelC${t+1}.zw);
              `,t+1<c&&(d+=`
                  final = vec4(0.0);
                  xCOffset = xC + 1 + strides[1];
                  if(xCOffset >= 0 && xCOffset < inDims[1]) {
                    final = getX(batch, xR, xCOffset, d1);
                  }
                  xC${t+1} = vec4(xTexelC${t+1}.xy, final.xy);
                `)):(d+=`
                if(xC >= 0 && xC < inDims[1] && xTexelC${t}Ready == 0) {
                  xTexelC${t} = getX(batch, xR, xC, d1);
                  if (xC + 1 >= inDims[1]) {
                    xTexelC${t}.zw = vec2(0.0);
                  }
                  xTexelC${t}Ready = 1;
                }

                xCOffset = xC + strides[1];
                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${t+1}Ready == 0) {
                  xTexelC${t+1} = getX(batch, xR, xCOffset, d1);
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${t+1}.zw = vec2(0.);
                  }
                  xTexelC${t+1}Ready = 1;
                }

                xC${t} = vec4(
                  xTexelC${t}.xy, xTexelC${t+1}.xy);
              `,t+1<c&&(d+=`
                  xC${t+1} = vec4(xTexelC${t}.zw, xTexelC${t+1}.zw);
                `)));t<c&&(d+=`
            wTexel = getW(r, ${t}, d1, q);
            dotProd += xC${t} * vec4(wTexel.xz, wTexel.xz);
          `,t+1<c&&(d+=`
              wTexel = getW(r, ${t+1}, d1, q);
              dotProd += xC${t+1} * vec4(wTexel.xz, wTexel.xz);
            `))}d+=`
    }
  
      }
    `;let p="",f="";n&&(p=r?`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          ${n}
        }`:i?`vec4 activation(vec4 a) {
          vec4 b = getLeakyreluAlphaAtOutCoords();
          ${n}
        }`:`vec4 activation(vec4 x) {
          ${n}
        }`,f="result = activation(result);");let g=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${p}

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / ${s};
        int q = d2 - d1 * ${s};
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.
        vec4 dotProd = vec4(0.000000000000001);

        ${d}

        vec4 result = dotProd - vec4(0.000000000000001);
        ${g}
        ${f}
        setOutput(result);
      }
    `}}let Or={kernelName:tm,backendName:"webgl",kernelFunc:function(e){let t;let{inputs:n,backend:r,attrs:i}=e,{x:s,filter:a}=n,{strides:o,pad:l,dilations:u,dimRoundingMode:c}=i,h=u;null==h&&(h=[1,1]),j(ob(o,h),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${o} and dilations '${h}'`);let d=oa(s.shape,a.shape,o,h,l,c,!0);t=eN().getBool("WEBGL_PACK_DEPTHWISECONV")&&d.strideWidth<=2&&d.outChannels/d.inChannels==1?new On(d):new Ot(d);let p=[[d.padInfo.top,d.padInfo.left],[d.strideHeight,d.strideWidth],[d.dilationHeight,d.dilationWidth],[d.inHeight,d.inWidth]];return r.runWebGLProgram(t,[s,a],"float32",p)}};class Oi{constructor(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;let t=e.strideHeight,n=e.strideWidth,r=e.padInfo.top,i=e.padInfo.left,s=e.outChannels/e.inChannels;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int dm = coords.w;
        int d2 = d1 * ${s} + dm;

        float dotProd = 0.0;

        // TO DO: Vec4 over the batch size
        for (int b = 0; b < ${e.batchSize}; b++) {
          for (int yR = 0; yR < ${e.outHeight}; yR++) {
            int xR = wR + yR * ${t} - ${r};

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int yC = 0; yC < ${e.outWidth}; yC++) {
              int xC = wC + yC * ${n} - ${i};

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);
            }
          }
        }
        setOutput(dotProd);
      }
    `}}class Os{constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;let t=e.filterHeight,n=e.filterWidth,r=e.strideHeight,i=e.strideWidth,s=t-1-e.padInfo.top,a=n-1-e.padInfo.left,o=e.outChannels/e.inChannels;this.userCode=`
      const ivec2 pads = ivec2(${s}, ${a});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];
        ivec2 dyCorner = coords.yz - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        float dotProd = 0.0;

        for (int wR = 0; wR < ${t}; wR++) {
          float dyR = float(dyRCorner + wR) / ${r}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = ${t} - 1 - wR;

          for (int wC = 0; wC < ${n}; wC++) {
            float dyC = float(dyCCorner + wC) / ${i}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = ${n} - 1 - wC;

            // TO DO: Vec4 over the channelMul
            for (int dm = 0; dm < ${o}; dm++) {
              int d2 = d1 * ${o} + dm;
              float xValue = getDy(batch, idyR, idyC, d2);
              float wValue = getW(wRPerm, wCPerm, d1, dm);
              dotProd += xValue * wValue;
            }
          }
        }
        setOutput(dotProd);
      }
    `}}let Oa={kernelName:ty,backendName:"webgl",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{x:i,dy:s}=t,{strides:a,dilations:o,pad:l,dimRoundingMode:u,filterShape:c}=r,h=new Oi(oa(i.shape,c,a,o,l,u,!0));return n.runWebGLProgram(h,[i,s],"float32")}},Oo={kernelName:tb,backendName:"webgl",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{dy:i,filter:s}=t,{strides:a,dilations:o,pad:l,dimRoundingMode:u,inputShape:c}=r,h=new Os(oa(c,s.shape,a,o,l,u,!0));return n.runWebGLProgram(h,[i,s],"float32")}};class Ol{constructor(e){this.variableNames=["X"],this.outputShape=[e,e],this.userCode=`
      void main() {
          ivec2 coords = getOutputCoords();
          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;
          setOutput(val);
      }
    `}}let Ou={kernelName:tv,backendName:"webgl",kernelFunc:function(e){let{inputs:t,backend:n}=e,{x:r}=t,i=[...r.shape,...r.shape],s=q(r.shape),a=Aa({inputs:{x:r},backend:n,attrs:{shape:[s]}}),o=new Ol(s),l=n.runWebGLProgram(o,[a],a.dtype),u=Aa({inputs:{x:l},backend:n,attrs:{shape:i}});return n.disposeIntermediateTensorInfo(a),n.disposeIntermediateTensorInfo(l),u}};class Oc{constructor(e){this.variableNames=["x","W"],this.outputShape=e.outShape;let{inHeight:t,inWidth:n,padInfo:r,strideHeight:i,strideWidth:s,filterHeight:a,filterWidth:o,dilationHeight:l,dilationWidth:u}=e,{top:c,left:h}=r;this.userCode=`
      const ivec2 strides = ivec2(${i}, ${s});
      const ivec2 pads = ivec2(${c}, ${h});
      const float neg_infinity = -3.4e38;

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.w;
        ivec2 outTopLeftCorner =
            coords.yz * strides - pads;
        int hBeg = outTopLeftCorner.x;
        int wBeg = outTopLeftCorner.y;

        float curVal = neg_infinity;
        for (int h = 0; h < ${a}; h++) {
          int hIn = hBeg + h * ${l};

          if (hIn >= 0 && hIn < ${t}) {
            for (int w = 0; w < ${o}; w++) {
              int wIn = wBeg + w * ${u};

              if (wIn >= 0 && wIn < ${n}) {
                float xVal = getX(batch, hIn, wIn, d1);
                float wVal = getW(h, w, d1);

                float val = xVal + wVal;
                if (val > curVal) {
                  curVal = val;
                }
              }
            }
          }
        }

        float result = curVal;
        setOutput(result);
      }
    `}}let Oh={kernelName:tw,backendName:"webgl",kernelFunc:function(e){let t;let{inputs:n,backend:r,attrs:i}=e,{x:s,filter:a}=n,{strides:o,pad:l,dilations:u}=i,c=or(s.shape,a.shape,o,l,"NHWC",u),h=new Oc(c),d=Aa({inputs:{x:t=r.runWebGLProgram(h,[s,a],"float32")},backend:r,attrs:{shape:c.outShape}});return r.disposeIntermediateTensorInfo(t),d}},Od={kernelName:tk,backendName:"webgl",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{equation:i}=r,s=t,{allDims:a,summedDims:o,idDims:l}=cS(i,s.length);cC(a.length,l,s);let{path:u,steps:c}=cA(o,l),h=c.length,d=null,p=a.length,f=[];for(let e=0;e<h;++e){for(let t of c[e]){let e;let{permutationIndices:r,expandDims:i}=cE(p,l[t]);cN(r)?e=s[t]:(e=Av({inputs:{x:s[t]},backend:n,attrs:{perm:r}}),f.push(e));let a=e.shape.slice();for(let e=0;e<i.length;++e)a.splice(i[e],0,1);H(e.shape,a)||(e=Aa({inputs:{x:e},backend:n,attrs:{shape:a}}),f.push(e)),null===d?d=e:(d=Ar({inputs:{a:e,b:d},backend:n}),f.push(d))}e<h-1&&(u[e]>=0&&(d=Ay({inputs:{x:d},backend:n,attrs:{axis:u[e]-(a.length-p),keepDims:!1}}),f.push(d)),p--)}for(let e of f)e!==d&&n.disposeIntermediateTensorInfo(e);return d}},Op={kernelName:tS,backendName:"webgl",kernelFunc:C5({opSnippet:"return (x >= 0.0) ? x : (exp(x) - 1.0);",packedOpSnippet:`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`})},Of="return (b >= 0.0) ? a : a * (b + 1.0);",Og=`
  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));
  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));
`,Om={kernelName:tE,backendName:"webgl",kernelFunc:e=>{let{inputs:t,backend:n}=e,{dy:r,y:i}=t,s=eN().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new CK(Og,r.shape,i.shape):new Cq(Of,r.shape,i.shape);return n.runWebGLProgram(s,[r,i],r.dtype)}},Oy={kernelName:tA,backendName:"webgl",kernelFunc:C8({opSnippet:"return float(a == b);",packedOpSnippet:`
  return vec4(equal(a, b));
`,dtype:"bool",cpuKernelImpl:EC})},Ob={kernelName:tC,backendName:"webgl",kernelFunc:C5({opSnippet:`
  // Error function is calculated approximately with elementary function.
  // See "Handbook of Mathematical Functions with Formulas,
  // Graphs, and Mathematical Tables", Abramowitz and Stegun.
  float p = ${cl};
  float a1 = ${cu};
  float a2 = ${cc};
  float a3 = ${ch};
  float a4 = ${cd};
  float a5 = ${cp};

  float sign = sign(x);
  x = abs(x);
  float t = 1.0 / (1.0 + p * x);
  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));
`})},Ov=C5({opSnippet:C6+`
  return exp(x);
`,packedOpSnippet:`
  vec4 result = exp(x);
  bvec4 isNaN = isnan(x);
  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,cpuKernelImpl:EA,dtype:"float32"}),Ow={kernelName:tN,backendName:"webgl",kernelFunc:Ov};function O_(e){let{inputs:t,attrs:n,backend:r}=e,{dim:i}=n,{input:s}=t,a=s.shape.length,o=s.shape.slice(),l=i;return i<0&&(j(-(a+1)<=i,()=>`Axis must be in the interval [${-(a+1)}, ${a}]`),l=a+i+1),o.splice(l,0,1),Aa({inputs:{x:s},backend:r,attrs:{shape:o}})}let Ox={kernelName:tO,backendName:"webgl",kernelFunc:O_},OT="return exp(x) - 1.0;",OI={kernelName:t$,backendName:"webgl",kernelFunc:C5({opSnippet:OT,packedOpSnippet:OT,cpuKernelImpl:EN})};class Ok{constructor(e,t,n){let r;this.variableNames=["real","imag"];let i=t[1];this.outputShape=t;let s=n?`2.0 * ${Math.PI}`:`-2.0 * ${Math.PI}`,a=n?`${i}.0`:"1.0";if("real"===e)r="return real * expR - imag * expI;";else if("imag"===e)r="return real * expI + imag * expR;";else throw Error(`FFT component must be either "real" or "imag", got ${e}.`);this.userCode=`
      const float exponentMultiplier = ${s};

      float unaryOpComplex(float real, float expR, float imag, float expI) {
        ${r}
      }

      float mulMatDFT(int batch, int index) {
        float indexRatio = float(index) / float(${i});
        float exponentMultiplierTimesIndexRatio =
            exponentMultiplier * indexRatio;

        float result = 0.0;

        for (int i = 0; i < ${i}; i++) {
          // x = (-2|2 * PI / N) * index * i;
          float x = exponentMultiplierTimesIndexRatio * float(i);
          float expR = cos(x);
          float expI = sin(x);
          float real = getReal(batch, i);
          float imag = getImag(batch, i);

          result +=
              unaryOpComplex(real, expR, imag, expI) / ${a};
        }

        return result;
      }

      void main() {
        ivec2 coords = getOutputCoords();
        setOutput(mulMatDFT(coords[0], coords[1]));
      }
    `}}function OS(e,t,n){let r=n.texData.get(e.dataId),i=q(e.shape),s=e.shape[e.shape.length-1],a=Aa({inputs:{x:e},backend:n,attrs:{shape:[i/s,s]}}),o=a.shape,l=new Ok("real",o,t),u=new Ok("imag",o,t),c=[{dataId:r.complexTensorInfos.real.dataId,dtype:r.complexTensorInfos.real.dtype,shape:o},{dataId:r.complexTensorInfos.imag.dataId,dtype:r.complexTensorInfos.imag.dtype,shape:o}],h=n.runWebGLProgram(l,c,"float32"),d=n.runWebGLProgram(u,c,"float32"),p=CQ({inputs:{real:h,imag:d},backend:n});n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(d);let f=Aa({inputs:{x:p},backend:n,attrs:{shape:e.shape}});return n.disposeIntermediateTensorInfo(a),n.disposeIntermediateTensorInfo(p),f}let OE={kernelName:tR,backendName:"webgl",kernelFunc:function(e){let{inputs:t,backend:n}=e,{input:r}=t;return OS(r,!1,n)}};class OC{constructor(e,t){this.outputShape=[],this.customUniforms=[{name:"value",type:"float"}],this.variableNames=["x"],this.outputShape=e,this.userCode=`
      void main() {
        // Input can be obtained from uniform value.
        setOutput(value);
      }
    `}}function OA(e){let{backend:t,attrs:n}=e,{shape:r,value:i}=n,{dtype:s}=n;if("string"===(s=s||eh(i))){let e=en(s,q(r));return e.fill(i),t.makeTensorInfo(r,s,e)}{let e=new OC(r,i),n=[[i]];return t.runWebGLProgram(e,[],s,n)}}let ON={kernelName:tD,backendName:"webgl",kernelFunc:OA};class OO{constructor(e){this.variableNames=["Image"],this.outputShape=[];let t=e[2];this.outputShape=e,this.userCode=`
        void main() {
          ivec4 coords = getOutputCoords();
          int x = coords[2];

          int coordX = ${t} - x - 1;
          float outputValue;
          if(coordX >= 0 && coordX < ${t}) {
            outputValue = getImage(coords[0], coords[1], coordX, coords[3]);
          } else {
            outputValue = getImage(coords[0], coords[1], coords[2], coords[3]);
          }
          setOutput(outputValue);
        }
    `}}let O$={kernelName:tF,backendName:"webgl",kernelFunc:({inputs:e,backend:t})=>{let{image:n}=e,r=t,i=new OO(n.shape);return r.runWebGLProgram(i,[n],n.dtype)}},OR="return floor(x);",OD={kernelName:tP,backendName:"webgl",kernelFunc:C5({opSnippet:OR,packedOpSnippet:OR,cpuKernelImpl:EO})},OF={kernelName:tM,backendName:"webgl",kernelFunc:C8({opSnippet:`
  float s = sign(a) * sign(b);
  int ia = round(a);
  int ib = round(b);
  if (ib != 0) {
    // Windows (D3D) wants guaranteed non-zero int division at compile-time.
    return float(idiv(ia, ib, s));
  } else {
    return NAN;
  }
`,packedOpSnippet:`
  ivec4 ia = round(a);
  ivec4 ib = round(b);
  bvec4 cond = notEqual(ib, ivec4(0));
  ivec4 result = ivec4(0);
  vec4 s = sign(a) * sign(b);

  // Windows (D3D) wants guaranteed non-zero int division at compile-time.
  if (cond[0]) {
    result[0] = idiv(ia[0], ib[0], s[0]);
  }
  if (cond[1]) {
    result[1] = idiv(ia[1], ib[1], s[1]);
  }
  if (cond[2]) {
    result[2] = idiv(ia[2], ib[2], s[2]);
  }
  if (cond[3]) {
    result[3] = idiv(ia[3], ib[3], s[3]);
  }
  return vec4(result);
`,dtype:"int32"})};class OP{constructor(e){this.variableNames=["A"];let t=k4(),[n,r]=e;this.outputShape=e,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${r}.0, ${n}.0);

        vec4 values = ${t.texture2D}(A, uv);
        float value;
        if (depth == 0) {
          value = values.r;
        } else if (depth == 1) {
          value = values.g;
        } else if (depth == 2) {
          value = values.b;
        } else if (depth == 3) {
          value = values.a;
        }

        setOutput(floor(value * 255.0 + 0.5));
      }
    `}}class OM{constructor(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;let t=k4(),[n,r]=e;this.outputShape=e,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];

        vec4 result = vec4(0.);

        for(int row=0; row<=1; row++) {
          for(int col=0; col<=1; col++) {
            texC = coords[1] + row;
            depth = coords[2] + col;

            vec2 uv = (vec2(texC, texR) + halfCR) /
                       vec2(${r}.0, ${n}.0);
            vec4 values = ${t.texture2D}(A, uv);
            float value;
            if (depth == 0) {
              value = values.r;
            } else if (depth == 1) {
              value = values.g;
            } else if (depth == 2) {
              value = values.b;
            } else if (depth == 3) {
              value = values.a;
            }

            result[row * 2 + col] = floor(value * 255.0 + 0.5);
          }
        }

        ${t.output} = result;
      }
    `}}let OL={kernelName:rg,backendName:"webgl",kernelFunc:OB},Oz=eN().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU");function OB(e){let{inputs:t,backend:n,attrs:r}=e,{pixels:i}=t,{numChannels:s}=r,a="undefined"!=typeof HTMLVideoElement&&i instanceof HTMLVideoElement,o="undefined"!=typeof HTMLImageElement&&i instanceof HTMLImageElement,[l,c]=a?[i.videoWidth,i.videoHeight]:[i.width,i.height],h=[c,l],d=[c,l,s];if(o||a){let e=eN().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU");(null==u||e!==Oz)&&(Oz=e,u=document.createElement("canvas").getContext("2d",{willReadFrequently:Oz})),u.canvas.width=l,u.canvas.height=c,u.drawImage(i,0,0,l,c),i=u.canvas}let p=n.makeTensorInfo(h,"int32");n.texData.get(p.dataId).usage=S.PIXELS,n.gpgpu.uploadPixelDataToTexture(n.getTexture(p.dataId),i);let f=eN().getBool("WEBGL_PACK")?new OM(d):new OP(d),g=n.runWebGLProgram(f,[p],"int32");return n.disposeData(p.dataId),g}let OU={kernelName:rb,backendName:"webgl",kernelFunc:function(e){let t;let{inputs:n,backend:r,attrs:i}=e,{x:s,filter:a,bias:o,preluActivationWeights:l}=n,{strides:u,pad:c,dataFormat:h,dilations:d,dimRoundingMode:p,activation:f,leakyreluAlpha:g}=i,m=ow(h),y=oa(s.shape,a.shape,u,d,c,p,!1,m),b=[],v=null!=o,w=null!=l,_="leakyrelu"===f,x=()=>{let e=[s,a],t=(e,t)=>{if("NCHW"===t&&1===e.shape.length&&1!==e.shape[0]){let t=Aa({inputs:{x:e},backend:r,attrs:{shape:[e.shape[0],1,1]}});return b.push(t),t}return e};if(v&&e.push(t(o,h)),w&&e.push(t(l,h)),_){let t=r.makeTensorInfo([],"float32",rX(g,"float32"));e.push(t),b.push(t)}return e};if(1===y.filterHeight&&1===y.filterWidth&&1===y.dilationHeight&&1===y.dilationWidth&&1===y.strideHeight&&1===y.strideWidth&&("SAME"===y.padInfo.type||"VALID"===y.padInfo.type))t=Nz({x:s,filter:a,convInfo:y,backend:r,bias:o,activation:f,preluActivationWeights:l,leakyreluAlpha:g});else if(y.strideWidth<=2&&"channelsLast"===m&&eN().getBool("WEBGL_EXP_CONV")){let e=new NP(y,v,f?C7(f,!0):null,w,_),n=[[y.padInfo.top,y.padInfo.left],[y.strideHeight,y.strideWidth],[y.dilationHeight,y.dilationWidth],[y.inHeight,y.inWidth]],i=x();t=r.runWebGLProgram(e,i,"float32",n)}else if(eN().getBool("WEBGL_CONV_IM2COL"))t=NB({x:s,filter:a,convInfo:y,backend:r,bias:o,activation:f,preluActivationWeights:l,leakyreluAlpha:g});else{let e=new ND(y,v,f?C7(f,!1):null,w,_),n=x();t=r.runWebGLProgram(e,n,"float32")}let T=Aa({inputs:{x:t},backend:r,attrs:{shape:y.outShape}});return b.push(t),b.forEach(e=>r.disposeIntermediateTensorInfo(e)),T}},OV={kernelName:rv,backendName:"webgl",kernelFunc:function(e){let t;let{inputs:n,backend:r,attrs:i}=e,{x:s,filter:a,bias:o,preluActivationWeights:l}=n,{strides:u,pad:c,dilations:h,dimRoundingMode:d,activation:p,leakyreluAlpha:f}=i,g=[],m=h;null==m&&(m=[1,1]),j(ob(u,m),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${u} and dilations '${m}'`);let y=oa(s.shape,a.shape,u,m,c,d,!0),b=eN().getBool("WEBGL_PACK_DEPTHWISECONV")&&y.strideWidth<=2&&y.outChannels/y.inChannels==1,v=p?C7(p,b):null,w=[s,a],_=null!=o,x=null!=l,T="leakyrelu"===p;if(_&&w.push(o),x&&w.push(l),T){let e=r.makeTensorInfo([],"float32",rX(f,"float32"));w.push(e),g.push(e)}t=b?new On(y,_,v,x,T):new Ot(y,_,v,x,T);let I=[[y.padInfo.top,y.padInfo.left],[y.strideHeight,y.strideWidth],[y.dilationHeight,y.dilationWidth],[y.inHeight,y.inWidth]],k=r.runWebGLProgram(t,w,"float32",I);return g.forEach(e=>r.disposeIntermediateTensorInfo(e)),k}};class Oj{constructor(e,t,n,r){this.sliceDim=e,this.strides=t,this.paramsShape=r,this.variableNames=["x","indices"],this.outputShape=n;let i=SG(n.length),s=`
    int index;`;for(let e=0;e<this.sliceDim;e++)s+=`
          index = round(getIndices(coords[0], ${e}));
          out_of_bounds = out_of_bounds || index < 0;
          out_of_bounds = out_of_bounds || index >= ${this.paramsShape[e]};
          flattenIndex += index * ${this.strides[e]};`;this.userCode=`
         void main() {
          ${i} coords = getOutputCoords();
          int flattenIndex = 0;
          bool out_of_bounds = false;

          ${s}

          setOutput(out_of_bounds ? 0.0 : getX(flattenIndex, coords[1]));
        }
      `}}let OG={kernelName:tB,backendName:"webgl",kernelFunc:function(e){let{inputs:t,backend:n}=e,{params:r,indices:i}=t,s=i.shape,a=s[s.length-1],o=q(r.shape),[l,u,c,h]=cn(r,i),d=Aa({inputs:{x:i},backend:n,attrs:{shape:[u,a]}}),p=Aa({inputs:{x:r},backend:n,attrs:{shape:[q(r.shape)/c,c]}});if(n.shouldExecuteOnCPU([r,i])||"string"===r.dtype){let e=E$(n.readSync(i.dataId),n.bufferSync(r),r.dtype,u,a,c,h,r.shape,o);return n.makeTensorInfo(l,r.dtype,e.values)}let f=new Oj(a,h,[u,c],r.shape),g=n.runWebGLProgram(f,[p,d],p.dtype),m=Aa({inputs:{x:g},backend:n,attrs:{shape:l}});return n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(g),m}};class OW{constructor(e,t){this.variableNames=["A","indices"],this.outputShape=t,this.rank=t.length;let n=SG(this.rank),r=Oq(e,2);this.userCode=`
      void main() {
        ${n} resRC = getOutputCoords();
        int index = int(getIndices(resRC.x, resRC.z));
        float inBounds = (index >= 0) && (index < ${e[2]}) ? 1.0 : 0.0;
        setOutput(inBounds * getA(${r}));
      }
    `}}function Oq(e,t){let n=["resRC.x","resRC.y","resRC.z","resRC.w"],r=[];for(let t=0;t<e.length;t++)2===t?r.push("index"):r.push(`${n[t]}`);return r.join()}function OH(e){let{inputs:t,backend:n,attrs:r}=e,{x:i,indices:s}=t,{axis:a,batchDims:o}=r,l=Z(a,i.shape)[0];if(eN().get("DEBUG")){let e=n.readSync(s.dataId),t=i.shape[l];for(let n=0;n<e.length;++n){let r=e[n];j(r<=t-1&&r>=0,()=>`GatherV2: the index value ${r} is not in [0, ${t-1}]`)}}let u=cH(i,s,l,o),c=q(s.shape),h=[],d=Aa({inputs:{x:i},backend:n,attrs:{shape:[u.batchSize,u.outerSize,u.dimSize,u.sliceSize]}}),p=Aa({inputs:{x:s},backend:n,attrs:{shape:[u.batchSize,c/u.batchSize]}});h.push(d),h.push(p);let f=[u.batchSize,u.outerSize,c/u.batchSize,u.sliceSize];if(n.shouldExecuteOnCPU([i,s])||"string"===i.dtype){let e=n.bufferSync(p),t=ER(n.bufferSync(d),e,f);return h.forEach(e=>n.disposeIntermediateTensorInfo(e)),n.makeTensorInfo(u.outputShape,t.dtype,t.values)}let g=new OW(d.shape,f),m=n.runWebGLProgram(g,[d,p],d.dtype);h.push(m);let y=Aa({inputs:{x:m},backend:n,attrs:{shape:u.outputShape}});return h.forEach(e=>n.disposeIntermediateTensorInfo(e)),y}let OK={kernelName:tz,backendName:"webgl",kernelFunc:OH},OX={kernelName:tU,backendName:"webgl",kernelFunc:C8({opSnippet:"return float(a > b);",packedOpSnippet:`
  return vec4(greaterThan(a, b));
`,cpuKernelImpl:ED,dtype:"bool"})},OY={kernelName:tV,backendName:"webgl",kernelFunc:C8({opSnippet:"return float(a >= b);",packedOpSnippet:`
  return vec4(greaterThanEqual(a, b));
`,dtype:"bool",cpuKernelImpl:EF})},OQ={kernelName:tG,backendName:"webgl",kernelFunc:function(e){let{inputs:t,backend:n}=e,{input:r}=t;return OS(r,!0,n)}},OJ={kernelName:tq,backendName:"webgl",kernelFunc:C5({opSnippet:"return float(!isnan(x) && !isinf(x));",dtype:"bool"})},OZ={kernelName:tH,backendName:"webgl",kernelFunc:C5({opSnippet:"return float(isinf(x));",dtype:"bool"})},O0={kernelName:tK,backendName:"webgl",kernelFunc:C5({opSnippet:"return float(isnan(x));",dtype:"bool"})},O1={kernelName:tY,backendName:"webgl",kernelFunc:C8({opSnippet:"return float(a < b);",packedOpSnippet:`
  return vec4(lessThan(a, b));
`,cpuKernelImpl:EP,dtype:"bool"})},O2={kernelName:tQ,backendName:"webgl",kernelFunc:C8({opSnippet:"return float(a <= b);",packedOpSnippet:`
  return vec4(lessThanEqual(a, b));
`,cpuKernelImpl:EM,dtype:"bool"})},O3={kernelName:tJ,backendName:"webgl",kernelFunc:function(e){let{backend:t,attrs:n}=e,{start:r,stop:i,num:s}=n,a=EL(r,i,s);return t.makeTensorInfo([a.length],"float32",a)}},O4={kernelName:tZ,backendName:"webgl",kernelFunc:C5({opSnippet:C6+`
  return x < 0.0 ? 0./0. : log(x);
`,packedOpSnippet:`
  vec4 result = log(x);
  bvec4 isNaN = isnan(x);
  result.r = isNaN.r ? x.r : (x.r < 0.0 ? 0./0. : result.r);
  result.g = isNaN.g ? x.g : (x.g < 0.0 ? 0./0. : result.g);
  result.b = isNaN.b ? x.b : (x.b < 0.0 ? 0./0. : result.b);
  result.a = isNaN.a ? x.a : (x.a < 0.0 ? 0./0. : result.a);
  return result;
`,cpuKernelImpl:Ez})},O6={kernelName:t0,backendName:"webgl",kernelFunc:C5({opSnippet:C6+`
  return log(1.0 + x);
`})},O5={kernelName:t1,backendName:"webgl",kernelFunc:C8({opSnippet:"return float(a >= 1.0 && b >= 1.0);",packedOpSnippet:`
  return vec4(
    vec4(greaterThanEqual(a, vec4(1.0))) *
    vec4(greaterThanEqual(b, vec4(1.0))));
`,dtype:"bool"})},O8={kernelName:t2,backendName:"webgl",kernelFunc:C5({opSnippet:"return float(!(x >= 1.0));"})},O7={kernelName:t3,backendName:"webgl",kernelFunc:C8({opSnippet:"return float(a >= 1.0 || b >= 1.0);",packedOpSnippet:`
  return min(
    vec4(greaterThanEqual(a, vec4(1.0))) +
    vec4(greaterThanEqual(b, vec4(1.0))),
    vec4(1.0));
`,dtype:"bool"})};class O9{constructor(e,t,n,r,i){let s;this.variableNames=["x"],this.outputShape=[];let a=t,o=e[3]-1;this.outputShape=e;let l=`float(${n}) + float(${r}) * sum`;s=.5===i?`inversesqrt(${l})`:1===i?`1.0/(${l})`:`exp(log(${l}) * float(-${i}));`,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];
        int d = coords[3];
        float x = getX(b, r, c, d);
        float sum = 0.0;
        for (int j = -${a}; j <= ${a}; j++) {
          int idx = d + j;
          if (idx >= 0 && idx <=  ${o}) {
            float z = getX(b, r, c, idx);
            sum += z * z;
          }
        }
        float val = x * ${s};
        setOutput(val);
      }
    `}}class $e{constructor(e,t,n,r,i){let s;this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;let a=t,o=e[3]-1;this.outputShape=e;let l=`float(${n}) + float(${r}) * sum`;s=.5===i?`inversesqrt(${l})`:1===i?`1.0/(${l})`:`exp(log(${l}) * float(-${i}));`,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords.x;
        int r = coords.y;
        int c = coords.z;
        int d = coords.w;

        bool hasNextCol = d < ${this.outputShape[3]};
        bool hasNextRow = c < ${this.outputShape[2]};

        vec4 sum = vec4(0.);
        vec4 xFragAtOutputCoords = getX(b, r, c, d);

        vec4 xAtOutputCoords = vec4(
          getChannel(xFragAtOutputCoords, vec2(c, d)),
          hasNextCol ?
            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,
          hasNextRow ?
            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,
          (hasNextRow && hasNextCol) ?
            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0
        );

        int firstChannel = d - ${a};
        vec2 cache = vec2(0.);
        if(firstChannel >= 0){
          vec4 firstChannelFrag = getX(b, r, c, firstChannel);
          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));
            if(hasNextRow){
              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));
            }
        }

        ivec2 depth = ivec2(d, d + 1);
        for (int j = - ${a}; j <= ${a}; j++) {
          ivec2 idx = depth + j;
          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));
          bvec2 belowUpperBound = lessThanEqual(idx, ivec2(${o}));

          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;
          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;

          if(depthInRange || depthPlusOneInRange){
            vec4 z = vec4(0.);
            vec4 xFragAtCurrentDepth;
            z.xz = cache.xy;
            if(depthPlusOneInRange && hasNextCol){
              xFragAtCurrentDepth = idx.y != d ?
                getX(b, r, c, idx.y) : xFragAtOutputCoords;
              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));
              if(hasNextRow){
                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));
              }
            }
            cache.xy = z.yw;
            sum += z * z;
          }
        }
        vec4 result = xAtOutputCoords * ${s};
        setOutput(result);
      }
    `}}let $t={kernelName:t6,backendName:"webgl",kernelFunc:e=>{let{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{depthRadius:s,bias:a,alpha:o,beta:l}=r,u=eN().getBool("WEBGL_PACK_NORMALIZATION")?new $e(i.shape,s,a,o,l):new O9(i.shape,s,a,o,l);return n.runWebGLProgram(u,[i],i.dtype)}};class $n{constructor(e,t,n,r,i){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=e,this.depth=e[3],this.depthRadius=t,this.bias=n,this.alpha=r,this.beta=i,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];

        float result = 0.0;
        for (int d = 0; d < ${this.depth}; ++d) {
          int depthBegin = int(max(0.0, float(d - ${t})));
          int depthEnd = int(min(float(${this.depth}),
              float(d + ${t} + 1)));

          const int MIN_DEPTH_BEGIN = 0;
          const int MAX_DEPTH_END = ${this.depth};

          float norm = 0.0;
          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd) {
              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);
            }
            else {
              break;
            }
          }

          norm = float(${r}) * norm + float(${n});

          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd){
              float dyi = -2.0 * float(${r})
                * float(${i})
                * getInputImage(b, r, c, k) * getOutputImage(b, r, c, d)
                / norm;
              if (k == d) {
                dyi += pow(norm, -1.0 * ${i});
              }
              if (k == coords[3]) {
                dyi *= getDy(b, r, c, d);
                result += dyi;
              }
            }
            else {
              break;
            }
          }
      }
      setOutput(result);
      }
    `}}let $r={kernelName:t5,backendName:"webgl",kernelFunc:e=>{let{inputs:t,backend:n,attrs:r}=e,{x:i,y:s,dy:a}=t,{depthRadius:o,bias:l,alpha:u,beta:c}=r,h=new $n(i.shape,o,l,u,c);return n.runWebGLProgram(h,[i,s,a],i.dtype)}};function $i(e,t,n,r){let i=q(t),s=q(e.shape)/i,a=Aa({inputs:{x:e},attrs:{shape:[s,i]},backend:r}),o=Ah(a,e.dtype,"max",r),l=Aa({inputs:{x:o},attrs:{shape:n},backend:r});return r.disposeIntermediateTensorInfo(a),r.disposeIntermediateTensorInfo(o),l}function $s(e){let t;let{inputs:n,backend:r,attrs:i}=e,{x:s}=n,{reductionIndices:a,keepDims:o}=i,l=s.shape.length,u=Z(a,s.shape),c=u,h=li(c,l),d=null!=h,p=r.shouldExecuteOnCPU([s]),f=s;if(d){if(p){let e=r.texData.get(f.dataId).values,t=Array(l);for(let e=0;e<t.length;e++)t[e]=s.shape[h[e]];let n=Ci(e,s.shape,s.dtype,h,t);f=r.makeTensorInfo(t,s.dtype),r.texData.get(f.dataId).values=n}else f=Ag(s,h,r);c=la(c.length,l)}lr("max",c,l);let[g,m]=lt(f.shape,c),y=g;if(o&&(y=ln(g,u)),p){let e=EB(r.texData.get(f.dataId).values,q(m),y,s.dtype);t=r.makeTensorInfo(y,s.dtype),r.texData.get(t.dataId).values=e}else t=$i(f,m,y,r);return d&&r.disposeIntermediateTensorInfo(f),t}let $a={kernelName:t8,backendName:"webgl",kernelFunc:$s},$o={kernelName:t7,backendName:"webgl",kernelFunc:C8({opSnippet:CW+`
  return max(a, b);
`,packedOpSnippet:`
  vec4 result = vec4(max(a, b));
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+CH+`
  return result;
`,cpuKernelImpl:EU})},$l={kernelName:t9,backendName:"webgl",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{x:i}=t;k2(i,"maxPool");let{filterSize:s,strides:a,pad:o,dimRoundingMode:l}=r,u=1;j(ob(a,1),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${a} and dilations '${u}'`);let c=oi(i.shape,s,a,u,o,l);if(1===c.filterWidth&&1===c.filterHeight&&H(c.inShape,c.outShape))return CX({inputs:{x:i},backend:n});let h=new AK(c,"max",!1);return n.runWebGLProgram(h,[i],i.dtype)}},$u={kernelName:nt,backendName:"webgl",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{filterSize:s,strides:a,pad:o,dataFormat:l,dimRoundingMode:u}=r,c=[1,1,1],h=new AX(os(i.shape,s,a,c,o,u,l),"max",!1);return n.runWebGLProgram(h,[i],i.dtype)}};class $c{constructor(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;let t=e.strideHeight,n=e.strideWidth,r=e.dilationHeight,i=e.effectiveFilterHeight,s=e.effectiveFilterWidth,a=i-1-e.padInfo.top,o=s-1-e.padInfo.left,l=i*s-1;this.userCode=`
      const ivec2 pads = ivec2(${a}, ${o});

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${i};
          wR += ${r}) {
          float dyR = float(dyRCorner + wR) / ${t}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < ${s}; wC++) {
            float dyC = float(dyCCorner + wC) / ${n}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);
            int maxPosValue = ${l} - int(getMaxPos(b, idyR, idyC, d));

            // Get the current value, check it against the value from the
            // position matrix.
            int curPosValue = wR * ${s} + wC;
            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

            dotProd += dyValue * mask;
          }
        }
        setOutput(dotProd);
      }
    `}}class $h{constructor(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;let t=e.strideDepth,n=e.strideHeight,r=e.strideWidth,i=e.dilationDepth,s=e.dilationHeight,a=e.dilationWidth,o=e.effectiveFilterDepth,l=e.effectiveFilterHeight,u=e.effectiveFilterWidth,c=o-1-e.padInfo.front,h=l-1-e.padInfo.top,d=u-1-e.padInfo.left,p=o*l*u-1;this.userCode=`
      const ivec3 pads = ivec3(${c}, ${h}, ${d});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < ${o};
           wD += ${i}) {
          float dyD = float(dyDCorner + wD) / ${t}.0;

          if (dyD < 0.0 || dyD >= ${e.outDepth}.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < ${l};
              wR += ${s}) {
            float dyR = float(dyRCorner + wR) / ${n}.0;

            if (dyR < 0.0 || dyR >= ${e.outHeight}.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < ${u};
                wC += ${a}) {
              float dyC = float(dyCCorner + wC) / ${r}.0;

              if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);
              int maxPosValue = ${p} -
                  int(getMaxPos(batch, idyD, idyR, idyC, ch));

              // Get the current value, check it against the value from the
              // position matrix.
              int curPosValue =
                  wD * ${l} * ${u} +
                  wR * ${u} + wC;
              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

              dotProd += dyValue * mask;
            }
          }
        }
        setOutput(dotProd);
      }
    `}}let $d={kernelName:nn,backendName:"webgl",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{dy:i,input:s}=t,a=s,{filterSize:o,strides:l,pad:u,dimRoundingMode:c}=r,h=[1,1,1],d=os(a.shape,o,l,h,u,c),p=new AX(d,"max",!0),f=n.runWebGLProgram(p,[a],a.dtype),g=new $h(d),m=n.runWebGLProgram(g,[i,f],a.dtype);return n.disposeIntermediateTensorInfo(f),m}},$p={kernelName:ne,backendName:"webgl",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{dy:i,input:s,output:a}=t,o=s;k2([s,a],"maxPoolGrad");let{filterSize:l,strides:u,pad:c,dimRoundingMode:h}=r,d=oi(o.shape,l,u,1,c,h),p=new AK(d,"max",!0),f=n.runWebGLProgram(p,[o],o.dtype),g=new $c(d),m=n.runWebGLProgram(g,[i,f],o.dtype);return n.disposeIntermediateTensorInfo(f),m}};function $f(e,t,n,r){let i=new AK(n,"max",!1),s=r.runWebGLProgram(i,[e],"float32");return i=new AK(n,"max",!0,!0,t),[s,r.runWebGLProgram(i,[e],"float32")]}let $g={kernelName:nr,backendName:"webgl",kernelFunc:({inputs:e,attrs:t,backend:n})=>{let{x:r}=e,{filterSize:i,strides:s,pad:a,includeBatchInIndex:o}=t,l=n;j(4===r.shape.length,()=>`Error in maxPool: input must be rank 4 but got rank ${r.shape.length}.`);let u=[1,1];j(ob(s,u),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${s} and dilations '${u}'`);let c=oi(r.shape,i,s,u,a),[h,d]=$f(r,o,c,l);return[h,d]}};function $m(e,t,n,r){let i=q(t),s=q(e.shape)/i,a=Aa({inputs:{x:e},attrs:{shape:[s,i]},backend:r}),o=Ah(a,"float32","mean",r),l=Aa({inputs:{x:o},attrs:{shape:n},backend:r});return r.disposeIntermediateTensorInfo(a),r.disposeIntermediateTensorInfo(o),l}let $y={kernelName:ni,backendName:"webgl",kernelFunc:({inputs:e,attrs:t,backend:n})=>{let{x:r}=e,{keepDims:i,axis:s}=t,a=n,o=r.shape.length,l=Z(s,r.shape),u=l,c=li(u,o),h=null!=c,d=a.shouldExecuteOnCPU([r]),p=[],f=r;if(h){if(d){let e=a.texData.get(f.dataId).values,t=Array(o);for(let e=0;e<t.length;e++)t[e]=r.shape[c[e]];let n=Ci(e,r.shape,r.dtype,c,t);f=a.makeTensorInfo(t,r.dtype),a.texData.get(f.dataId).values=n}else f=Ag(r,c,a);p.push(f),u=la(u.length,o)}lr("sum",u,o);let[g,m]=lt(f.shape,u),y=g;i&&(y=ln(g,l));let b=$m(f,m,y,a);for(let e of p)a.disposeIntermediateTensorInfo(e);return b}},$b={kernelName:ns,backendName:"webgl",kernelFunc:function(e){let t;let{inputs:n,backend:r,attrs:i}=e,{x:s}=n,{axis:a,keepDims:o}=i,l=s.shape.length,u=Z(a,s.shape),c=u,h=li(c,l),d=s;null!=h&&(d=Av({inputs:{x:s},backend:r,attrs:{perm:h}}),c=la(c.length,s.shape.length)),lr("min",c,l);let[p,f]=lt(d.shape,c),g=Aa({inputs:{x:d},backend:r,attrs:{shape:[-1,q(f)]}}),m=Ah(g,g.dtype,"min",r);return t=o?Aa({inputs:{x:m},backend:r,attrs:{shape:ln(p,u)}}):Aa({inputs:{x:m},backend:r,attrs:{shape:p}}),r.disposeIntermediateTensorInfo(g),r.disposeIntermediateTensorInfo(m),null!=h&&r.disposeIntermediateTensorInfo(d),t}},$v={kernelName:na,backendName:"webgl",kernelFunc:C8({opSnippet:CW+`
  return min(a, b);
`,packedOpSnippet:`
  vec4 result = vec4(min(a, b));
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+CH+`
  return result;
`,cpuKernelImpl:EV})};class $w{constructor(e,t,n){this.variableNames=["x"],this.outputShape=t.map((t,n)=>t[0]+e[n]+t[1]);let r=e.length,i=SG(r),s=t.map(e=>e[0]).join(","),a=t.map((t,n)=>t[0]+e[n]).join(","),o=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,r),l="reflect"===n?0:1;if(1===r){this.userCode=`
        int start = ${s};
        int end = ${a};

        void main() {
          int outC = getOutputCoords();
          if (outC < start) {
            outC = start * 2 - outC - ${l};
          } else if(outC >= end) {
            outC = (end - 1) * 2 - outC + ${l};
          }
          setOutput(getX(outC - start));
        }
      `;return}this.userCode=`
      ${i} start = ${i}(${s});
      ${i} end = ${i}(${a});

      void main() {
        ${i} outC = getOutputCoords();
        for (int i = 0; i < ${r}; i++) {
          if (outC[i] < start[i]) {
            outC[i] = start[i] * 2 - outC[i] - ${l};
          } else if(outC[i] >= end[i]) {
            outC[i] = (end[i] - 1) * 2 - outC[i] + ${l};
          }
        }
        ${i} coords = outC - start;
        setOutput(getX(${o}));
      }
    `}}class $_{constructor(e,t,n){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t.map((t,n)=>t[0]+e[n]+t[1]);let r=e.length,i=SG(r),s=t.map(e=>e[0]).join(","),a=t.map((t,n)=>t[0]+e[n]).join(","),o=Co("rc",r),l=Co("source",r),u=`${o[r-1]} < ${this.outputShape[r-1]}`,c=1===r?"source":`vec2(${l.slice(-2).join()})`,h="reflect"===n?0:1,d="";if(1===r){let e=`
        ${i} source = rc;
        if (source < start) {
          source = start * 2 - source - ${h};
        } else if (source >= end) {
          source = (end - 1) * 2 - source + ${h};
        }
        source -= start;
      `;d=`
        ${i} rc = outputLoc;
        ${e}
        result[0] = getChannel(getX(${l.join()}), ${c});
        ${o[r-1]} += 1;
        if(${u}) {
          ${e}
          result[1] = getChannel(getX(${l.join()}), ${c});
        }
      `}else{let e=`
        ${i} source = rc;
        ${i} lt = ${i}(lessThan(source, start));
        ${i} gte = ${i}(greaterThanEqual(source, end));
        ${i} orig = 1 - (lt + gte);
        source = orig * source +
                lt * (start * 2 - source - ${h}) +
                gte * ((end - 1) * 2 - source + ${h});
        source -= start;
      `;d=`
        ${i} rc = outputLoc;
        ${e}
        result[0] = getChannel(getX(${l.join()}), ${c});
        ${o[r-1]} += 1;
        if(${u}) {
          ${e}
          result[1] = getChannel(getX(${l.join()}), ${c});
        }
        rc = outputLoc;
        ${o[r-2]} += 1;
        if(${o[r-2]} < ${this.outputShape[r-2]}) {
          ${e}
          result[2] = getChannel(getX(${l.join()}), ${c});
          ${o[r-1]} += 1;
          if(${u}) {
            ${e}
            result[3] = getChannel(getX(${l.join()}), ${c});
          }
        }
      `}this.userCode=`
      const ${i} start = ${i}(${s});
      const ${i} end = ${i}(${a});

      void main() {
        ${i} outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        ${d}
        setOutput(result);
      }
    `}}let $x={kernelName:no,backendName:"webgl",kernelFunc:({inputs:e,backend:t,attrs:n})=>{let{x:r}=e,{paddings:i,mode:s}=n,a=eN().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new $_(r.shape,i,s):new $w(r.shape,i,s);return t.runWebGLProgram(a,[r],r.dtype)}},$T={kernelName:nl,backendName:"webgl",kernelFunc:C8({opSnippet:`if (b == 0.0) return NAN;
  return mod(a, b);`,packedOpSnippet:`
  vec4 result = mod(a, b);
  bvec4 isNaN = equal(b, vec4(0.0));
  `+CH+`
  return result;
`})};class $I{constructor(e,t,n){this.variableNames=["probs"],this.customUniforms=[{name:"seed",type:"float"}],this.outputShape=[e,n],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];

        float r = random(seed);
        float cdf = 0.0;

        for (int i = 0; i < ${t-1}; i++) {
          cdf += getProbs(batch, i);

          if (r < cdf) {
            setOutput(float(i));
            return;
          }
        }

        // If no other event happened, last event happened.
        setOutput(float(${t-1}));
      }
    `}}let $k=C8({opSnippet:`
if (a == b) {
  return 1.0;
};
return a / b;`,packedOpSnippet:`
  // vec4 one = vec4(equal(a, b));
  // return one + (vec4(1.0) - one) * a / b;
  vec4 result = a / b;
  if(a.x == b.x) {
    result.x = 1.;
  }
  if(a.y == b.y) {
    result.y = 1.;
  }
  if(a.z == b.z) {
    result.z = 1.;
  }
  if(a.w == b.w) {
    result.w = 1.;
  }

  return result;
`,checkOutOfBounds:!0}),$S={kernelName:tI,backendName:"webgl",kernelFunc:$k},$E="return a - b;",$C=C8({opSnippet:$E,packedOpSnippet:$E,supportsComplex:!0,cpuKernelImpl:Ct}),$A={kernelName:rr,backendName:"webgl",kernelFunc:$C};function $N(e){let{inputs:t,backend:n,attrs:r}=e,{logits:i}=t,{dim:s}=r,a=Z([s],i.shape),o=$s({inputs:{x:i},backend:n,attrs:{reductionIndices:a,keepDims:!1}}),l=ln(o.shape,a),u=Aa({inputs:{x:o},backend:n,attrs:{shape:l}}),c=$C({inputs:{a:i,b:u},backend:n}),h=Ov({inputs:{x:c},backend:n}),d=Ay({inputs:{x:h},backend:n,attrs:{axis:a,keepDims:!1}}),p=Aa({inputs:{x:d},backend:n,attrs:{shape:l}}),f=$k({inputs:{a:h,b:p},backend:n});return n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(u),n.disposeIntermediateTensorInfo(c),n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(p),f}let $O={kernelName:n0,backendName:"webgl",kernelFunc:$N},$$={kernelName:nu,backendName:"webgl",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{logits:i}=t,{numSamples:s,seed:a,normalized:o}=r,l=o?i:$N({inputs:{logits:i},backend:n,attrs:{dim:i.shape.length-1}}),u=new $I(l.shape[0],l.shape[1],s),c=[[a]],h=n.runWebGLProgram(u,[l],"int32",c);return o||n.disposeIntermediateTensorInfo(l),h}},$R=Cw+`
  return -x;
`,$D=`
  vec4 result = -x;
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,$F={kernelName:nh,backendName:"webgl",kernelFunc:function(e){let t;let{inputs:n,backend:r}=e,{x:i}=n;if(r.shouldExecuteOnCPU([i])){let[e,t]=EG(r.texData.get(i.dataId).values,i.shape,i.dtype);return r.makeTensorInfo(t,i.dtype,e)}return t=eN().getBool("WEBGL_PACK_UNARY_OPERATIONS")?new CR(i.shape,$D):new Cv(i.shape,$R),r.runWebGLProgram(t,[i],i.dtype)}},$P=uw,$M={kernelName:np,backendName:"webgl",kernelFunc:function(e){rw("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");let{inputs:t,backend:n,attrs:r}=e,{boxes:i,scores:s}=t,{maxOutputSize:a,iouThreshold:o,scoreThreshold:l}=r,{selectedIndices:u}=$P(n.readSync(i.dataId),n.readSync(s.dataId),a,o,l);return n.makeTensorInfo([u.length],"int32",new Int32Array(u))}},$L=u_,$z={kernelName:nf,backendName:"webgl",kernelFunc:function(e){rw("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");let{inputs:t,backend:n,attrs:r}=e,{boxes:i,scores:s}=t,{maxOutputSize:a,iouThreshold:o,scoreThreshold:l,padToMaxOutputSize:u}=r,{selectedIndices:c,validOutputs:h}=$L(n.readSync(i.dataId),n.readSync(s.dataId),a,o,l,u);return[n.makeTensorInfo([c.length],"int32",new Int32Array(c)),n.makeTensorInfo([],"int32",new Int32Array([h]))]}},$B=ux,$U={kernelName:ng,backendName:"webgl",kernelFunc:function(e){rw("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");let{inputs:t,backend:n,attrs:r}=e,{boxes:i,scores:s}=t,{maxOutputSize:a,iouThreshold:o,scoreThreshold:l,softNmsSigma:u}=r,{selectedIndices:c,selectedScores:h}=$B(n.readSync(i.dataId),n.readSync(s.dataId),a,o,l,u);return[n.makeTensorInfo([c.length],"int32",new Int32Array(c)),n.makeTensorInfo([h.length],"float32",new Float32Array(h))]}};class $V{constructor(e,t,n,r){this.variableNames=["indices"],this.outputShape=[e,t],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int index = round(getIndices(coords.x));
        setOutput(mix(float(${r}), float(${n}),
                      float(index == coords.y)));
      }
    `}}let $j={kernelName:ny,backendName:"webgl",kernelFunc:e=>{let{inputs:t,backend:n,attrs:r}=e,{indices:i}=t,{dtype:s,depth:a,onValue:o,offValue:l}=r,u=q(i.shape),c=new $V(u,a,o,l),h=Aa({inputs:{x:i},backend:n,attrs:{shape:[u]}}),d=n.runWebGLProgram(c,[h],s);n.disposeIntermediateTensorInfo(h);let p=Aa({inputs:{x:d},backend:n,attrs:{shape:[...i.shape,a]}});return n.disposeIntermediateTensorInfo(d),p}};function $G(e){let{inputs:t,backend:n}=e,{x:r}=t;if("complex64"!==r.dtype)return OA({attrs:{shape:r.shape,dtype:r.dtype,value:"string"===r.dtype?"":0},backend:n});{let e=Nh({inputs:{input:r},backend:n}),t=$G({inputs:{x:e},backend:n}),i=NC({inputs:{input:r},backend:n}),s=$G({inputs:{x:i},backend:n}),a=CQ({inputs:{real:t,imag:s},backend:n});return n.disposeIntermediateTensorInfo(e),n.disposeIntermediateTensorInfo(t),n.disposeIntermediateTensorInfo(i),n.disposeIntermediateTensorInfo(s),a}}let $W={kernelName:rp,backendName:"webgl",kernelFunc:$G};function $q(e){let{inputs:t,backend:n}=e,{x:r}=t;if("string"===r.dtype)throw Error("onesLike is not supported under string dtype");if("complex64"!==r.dtype)return OA({attrs:{shape:r.shape,dtype:r.dtype,value:1},backend:n});{let e=Nh({inputs:{input:r},backend:n}),t=$q({inputs:{x:e},backend:n}),i=NC({inputs:{input:r},backend:n}),s=$G({inputs:{x:i},backend:n}),a=CQ({inputs:{real:t,imag:s},backend:n});return n.disposeIntermediateTensorInfo(e),n.disposeIntermediateTensorInfo(t),n.disposeIntermediateTensorInfo(i),n.disposeIntermediateTensorInfo(s),a}}let $H={kernelName:nm,backendName:"webgl",kernelFunc:$q},$K={kernelName:nb,backendName:"webgl",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{axis:i}=r;if(1===t.length)return O_({inputs:{input:t[0]},backend:n,attrs:{dim:i}});let s=t[0].shape,a=t[0].dtype;t.forEach(e=>{G(s,e.shape,"All tensors passed to stack must have matching shapes"),j(a===e.dtype,()=>"All tensors passed to stack must have matching dtypes")});let o=[],l=N$({inputs:t.map(e=>{let t=O_({inputs:{input:e},backend:n,attrs:{dim:i}});return o.push(t),t}),backend:n,attrs:{axis:i}});return o.forEach(e=>n.disposeIntermediateTensorInfo(e)),l}};class $X{constructor(e,t,n){this.variableNames=["x"],this.customUniforms=[{name:"value",type:"float"}],this.outputShape=t.map((t,n)=>t[0]+e[n]+t[1]);let r=e.length,i=SG(r),s=t.map(e=>e[0]).join(","),a=t.map((t,n)=>t[0]+e[n]).join(","),o=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,r);if(1===r){this.userCode=`
        int start = ${s};
        int end = ${a};

        void main() {
          int outC = getOutputCoords();
          if (outC < start || outC >= end) {
            setOutput(value);
          } else {
            setOutput(getX(outC - start));
          }
        }
      `;return}this.userCode=`
      ${i} start = ${i}(${s});
      ${i} end = ${i}(${a});

      void main() {
        ${i} outC = getOutputCoords();
        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {
          setOutput(value);
        } else {
          ${i} coords = outC - start;
          setOutput(getX(${o}));
        }
      }
    `}}class $Y{constructor(e,t,n){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"value",type:"float"}],this.outputShape=t.map((t,n)=>t[0]+e[n]+t[1]);let r=e.length,i=SG(r),s=t.map(e=>e[0]).join(","),a=t.map((t,n)=>t[0]+e[n]).join(","),o=Co("rc",r),l=Co("source",r),u=`${o[r-1]} < ${this.outputShape[r-1]}`,c=1===r?"source":`vec2(${l.slice(-2).join()})`,h=[`${i} rc = outputLoc;`,`${o[r-1]} += 1;
       if(${u}) {
      `,1===r?"":`}
       rc = outputLoc;
       ${o[r-2]} += 1;
       if(${o[r-2]} < ${this.outputShape[r-2]}) {`,1===r?"":`  ${o[r-1]} += 1;
         if(${u}) {`],d=1===r?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))",p="";for(let e=0,t=1===r?2:4;e<t;e++)p+=`
        ${h[e]}
        if (${d}) {
          result[${e}] = float(value);
        } else {
          ${i} source = rc - start;
          result[${e}] = getChannel(getX(${l.join()}), ${c});
        }
      `;p+=1===r?"} ":"}}",this.userCode=`
      const ${i} start = ${i}(${s});
      const ${i} end = ${i}(${a});

      void main() {
        ${i} outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        ${p}
        setOutput(result);
      }
    `}}let $Q=e=>{let{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{paddings:s,constantValue:a}=r;if(0===q(i.shape))return OA({backend:n,attrs:{shape:s.map((e,t)=>e[0]+i.shape[t]+e[1]),value:a,dtype:i.dtype}});let o=eN().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new $Y(i.shape,s,a):new $X(i.shape,s,a),l=[[a]];return n.runWebGLProgram(o,[i],i.dtype,l)},$J={kernelName:nv,backendName:"webgl",kernelFunc:$Q},$Z={kernelName:nw,backendName:"webgl",kernelFunc:C8({opSnippet:`
  if(a < 0.0 && floor(b) < b){
    return NAN;
  }
  if (b == 0.0) {
    return 1.0;
  }
  return (round(mod(b, 2.0)) != 1) ?
      pow(abs(a), b) : sign(a) * pow(abs(a), b);
`,packedOpSnippet:`
  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.
  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));
  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);
  vec4 result = multiplier * pow(abs(a), b);

  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS
  bvec4 isExpZero = equal(b, vec4(0.0));
  result.r = isExpZero.r ? 1.0 : result.r;
  result.g = isExpZero.g ? 1.0 : result.g;
  result.b = isExpZero.b ? 1.0 : result.b;
  result.a = isExpZero.a ? 1.0 : result.a;

  bvec4 isNaN1 = lessThan(a, vec4(0.0));
  bvec4 isNaN2 = lessThan(floor(b), b);
  bvec4 isNaN = bvec4(isNaN1.x && isNaN2.x, isNaN1.y && isNaN2.y, isNaN1.z && isNaN2.z, isNaN1.w && isNaN2.w);
  `+CH+`
  return result;
`})},$0={kernelName:nx,backendName:"webgl",kernelFunc:function(e){let t;let{inputs:n,backend:r,attrs:i}=e,{x:s}=n,{axis:a,keepDims:o}=i,l=s.shape.length,u=[],c=Z(a,s.shape),h=c,d=li(h,l),p=s;if(null!=d&&(p=Av({inputs:{x:s},backend:r,attrs:{perm:d}}),h=la(h.length,l),u.push(p)),lr("prod",h,l),r.shouldExecuteOnCPU([p])){let e=r.texData.get(p.dataId).values,{outVals:n,outShape:i,outDtype:s}=Eq(p.shape,p.dtype,e,h);t=r.makeTensorInfo(i,s,n)}else{let[e,n]=lt(p.shape,h),i=Aa({inputs:{x:p},backend:r,attrs:{shape:[-1,q(n)]}}),a=Ah(i,i_(s.dtype),"prod",r);t=Aa({inputs:{x:a},backend:r,attrs:{shape:e}}),u.push(i),u.push(a)}if(o){u.push(t);let e=ln(t.shape,c);t=Aa({inputs:{x:t},backend:r,attrs:{shape:e}})}return u.forEach(e=>r.disposeIntermediateTensorInfo(e)),t}},$1={kernelName:nT,backendName:"webgl",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{paramsNestedSplits:i,paramsDenseValues:s,indices:a}=t,{outputRaggedRank:o}=r,l=i.map(e=>n.readSync(e.dataId)),u=i.map(e=>e.shape),c=n.readSync(s.dataId),h=n.readSync(a.dataId),[d,p,f]=EH(l,u,c,s.shape,s.dtype,h,a.shape,o),g=d.map(e=>n.makeTensorInfo([e.length],"int32",e)),m=n.makeTensorInfo(f,s.dtype,p);return g.concat([m])}},$2={kernelName:nI,backendName:"webgl",kernelFunc:function(e){let{inputs:t,backend:n}=e,{starts:r,limits:i,deltas:s}=t,a=n.readSync(r.dataId),o=n.readSync(i.dataId),l=n.readSync(s.dataId),[u,c]=EK(a,r.shape,r.dtype,o,i.shape,l,s.shape);return[n.makeTensorInfo([u.length],"int32",u),n.makeTensorInfo([c.length],r.dtype,c)]}},$3={kernelName:nk,backendName:"webgl",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{shape:i,values:s,defaultValue:a,rowPartitionTensors:o}=t,{rowPartitionTypes:l}=r,u=n.readSync(i.dataId),c=n.readSync(s.dataId),h=n.readSync(a.dataId),d=o.map(e=>n.readSync(e.dataId)),p=o.map(e=>e.shape),[f,g]=EX(u,i.shape,c,s.shape,s.dtype,h,a.shape,d,p,l);return n.makeTensorInfo(f,s.dtype,g)}},$4=e=>{let{backend:t,attrs:n}=e,{start:r,stop:i,step:s,dtype:a}=n,o=EY(r,i,s,a);return t.makeTensorInfo([o.length],a,o)},$6={kernelName:nS,backendName:"webgl",kernelFunc:$4},$5={kernelName:nC,backendName:"webgl",kernelFunc:C5({opSnippet:"return 1.0 / x;"})},$8={kernelName:nA,backendName:"webgl",kernelFunc:C5({opSnippet:Cw+`
  return (x < 0.0) ? 0.0 : x;
`,packedOpSnippet:`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`})},$7={kernelName:nF,backendName:"webgl",kernelFunc:C5({opSnippet:Cw+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,packedOpSnippet:`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`})};class $9{constructor(e,t,n,r,i){let s;this.variableNames=["A"],this.outputShape=[];let[a,o,l,u]=e;this.outputShape=[a,t,n,u];let c=[r&&t>1?o-1:o,r&&n>1?l-1:l],h=[r&&t>1?t-1:t,r&&n>1?n-1:n];s=i?"(vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC - vec2(0.5)":"vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          ${c[0]/h[0]},
          ${c[1]/h[1]});
      const vec2 inputShapeRC = vec2(${o}.0, ${l}.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = ${s};

        // Compute the four integer indices.
        ivec2 sourceFloorRC = ivec2(max(sourceFracIndexRC, vec2(0.0)));
        ivec2 sourceCeilRC = ivec2(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);
        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);
        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);
        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);

        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);

        float top = topLeft + (topRight - topLeft) * fracRC.y;
        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;
        float newValue = top + (bottom - top) * fracRC.x;

        setOutput(newValue);
      }
    `}}class Re{constructor(e,t,n,r,i){let s;this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];let[a,o,l,u]=e;this.outputShape=[a,t,n,u];let c=[r&&t>1?o-1:o,r&&n>1?l-1:l],h=[r&&t>1?t-1:t,r&&n>1?n-1:n];s=i?"(vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC - vec3(0.5)":"vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          ${c[0]/h[0]},
          ${c[1]/h[1]},
          ${c[1]/h[1]});
      const vec3 inputShapeRC = vec3(${o}.0, ${l}.0,
                                     ${l}.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = ${s};

        // Compute the four integer indices.
        ivec3 sourceFloorRC = ivec3(max(sourceFracIndexRC, vec3(0.0)));
        ivec3 sourceCeilRC = ivec3(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < ${u-1};
        bool hasNextRow = coords.z < ${n-1};

        // In parallel, construct four corners for all four components in
        // packed 2x2 cell.
        vec4 topLeft = vec4(
          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 bottomLeft = vec4(
          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 topRight = vec4(
          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec4 bottomRight = vec4(
          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);

        vec4 top = mix(topLeft, topRight, fracRC.yyzz);
        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);
        vec4 newValue = mix(top, bottom, fracRC.x);

        setOutput(newValue);
      }
    `}}let Rt={kernelName:nR,backendName:"webgl",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{images:i}=t,{alignCorners:s,halfPixelCenters:a,size:o}=r,[l,u]=o,c=eN().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new Re(i.shape,l,u,s,a):new $9(i.shape,l,u,s,a);return n.runWebGLProgram(c,[i],"float32")}};class Rn{constructor(e,t,n){this.variableNames=["dy"],this.outputShape=[],this.outputShape=t;let[,r,i]=t,[,s,a]=e,o=[n&&s>1?r-1:r,n&&a>1?i-1:i],l=[n&&s>1?s-1:s,n&&a>1?a-1:a],u=o[0]/l[0],c=o[1]/l[1],h=1/u,d=1/c,p=2*Math.ceil(h)+2,f=2*Math.ceil(d)+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(${u});
        const float widthScale = float(${c});

        const float invHeightScale = float(${h});
        const float invWidthScale = float(${d});

        const int winHeight = int(${p});
        const int winWidth = int(${f});

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(startRLerp - float(winHeight / 2));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(startCLerp - float(winWidth / 2));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= ${s}) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= ${a}) {
              continue;
            }

            float dxR = float(dyR) * heightScale;
            int topDxRIndex = int(floor(dxR));
            int bottomDxRIndex = int(min(ceil(dxR), ${r-1}.0));
            float dxRLerp = dxR - float(topDxRIndex);
            float inverseDxRLerp = 1.0 - dxRLerp;

            float dxC = float(dyC) * widthScale;
            int leftDxCIndex = int(floor(dxC));
            int rightDxCIndex = int(min(ceil(dxC), ${i-1}.0));
            float dxCLerp = dxC - float(leftDxCIndex);
            float inverseDxCLerp = 1.0 - dxCLerp;

            if (r == topDxRIndex && c == leftDxCIndex) {
              // topLeft
              accumulator +=
                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;
            }

            if (r == topDxRIndex && c == rightDxCIndex) {
              // topRight
              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;
            }

            if (r == bottomDxRIndex && c == leftDxCIndex) {
              // bottomLeft
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;
            }

            if (r == bottomDxRIndex && c == rightDxCIndex) {
              // bottomRight
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `}}let Rr={kernelName:nD,backendName:"webgl",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{images:i,dy:s}=t,{alignCorners:a}=r,o=new Rn(s.shape,i.shape,a);return n.runWebGLProgram(o,[s],s.dtype)}};class Ri{constructor(e,t,n,r,i){let s;this.variableNames=["A"],this.outputShape=[];let[a,o,l,u]=e;this.outputShape=[a,t,n,u];let c=[r&&t>1?o-1:o,r&&n>1?l-1:l],h=[r&&t>1?t-1:t,r&&n>1?n-1:n],d=r?"0.5":"0.0";s=i?"max((vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC, vec2(0.0))":"vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          ${c[0]/h[0]},
          ${c[1]/h[1]});
      const vec2 inputShapeRC = vec2(${o}.0, ${l}.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = ${s};

        // Compute the coordinators of nearest neighbor point.
        ivec2 sourceNearestRC = ivec2(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ${d})));
        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);

        setOutput(newValue);
      }
    `}}class Rs{constructor(e,t,n,r,i){let s;this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];let[a,o,l,u]=e;this.outputShape=[a,t,n,u];let c=[r&&t>1?o-1:o,r&&n>1?l-1:l],h=[r&&t>1?t-1:t,r&&n>1?n-1:n],d=r?"0.5":"0.0";s=i?"max((vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC, vec3(0.0))":"vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          ${c[0]/h[0]},
          ${c[1]/h[1]},
          ${c[1]/h[1]});
      const vec3 inputShapeRC = vec3(${o}.0, ${l}.0,
                                     ${l}.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = ${s};

        // Compute the coordinators of nearest neighbor point.
        ivec3 sourceNearestRC = ivec3(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ${d})));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < ${u-1};
        bool hasNextRow = coords.z < ${n-1};

        vec4 newValue = vec4(
          getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d),
          hasNextCol ? getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d + 1) : 0.0);

        setOutput(newValue);
      }
    `}}let Ra={kernelName:nO,backendName:"webgl",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{images:i}=t,{alignCorners:s,halfPixelCenters:a,size:o}=r,[l,u]=o,c=eN().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new Rs(i.shape,l,u,s,a):new Ri(i.shape,l,u,s,a);return n.runWebGLProgram(c,[i],i.dtype)}};class Ro{constructor(e,t,n){this.variableNames=["dy"],this.outputShape=[],this.outputShape=t;let[,r,i]=t,[,s,a]=e,o=[n&&s>1?r-1:r,n&&a>1?i-1:i],l=[n&&s>1?s-1:s,n&&a>1?a-1:a],u=o[0]/l[0],c=o[1]/l[1],h=1/u,d=1/c,p=2*Math.ceil(h)+2,f=2*Math.ceil(d)+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(${u});
        const float widthScale = float(${c});

        const float invHeightScale = float(${h});
        const float invWidthScale = float(${d});

        const int winHeight = int(${p});
        const int winWidth = int(${f});

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(floor(startRLerp - float(winHeight / 2)));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(floor(startCLerp - float(winWidth / 2)));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= ${s}) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= ${a}) {
              continue;
            }

            float sourceFracRow =
              float(${o[0]}) *
                (float(dyR) / float(${l[0]}));

            float sourceFracCol =
                float(${o[1]}) *
                  (float(dyC) / float(${l[1]}));

            int sourceNearestRow = int(min(
                float(int(${r}) - 1),
                ${n} ? float(round(sourceFracRow)) :
                                  float(floor(sourceFracRow))));

            int sourceNearestCol = int(min(
                float(int(${i}) - 1),
                ${n} ? float(round(sourceFracCol)) :
                                  float(floor(sourceFracCol))));

            if (r == sourceNearestRow && c == sourceNearestCol) {
              accumulator += getDy(b, dyR, dyC, d);
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `}}let Rl={kernelName:n$,backendName:"webgl",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{images:i,dy:s}=t,{alignCorners:a}=r,o=new Ro(s.shape,i.shape,a);return n.runWebGLProgram(o,[s],s.dtype)}};class Ru{constructor(e,t){this.variableNames=["x"];let n=e.length;if(n>4)throw Error(`WebGL backend: Reverse of rank-${n} tensor is not yet supported`);if(this.outputShape=e,1===n){this.userCode=`
        void main() {
          int coord = getOutputCoords();
          setOutput(getX(${e[0]} - coord - 1));
        }
      `;return}let r=n=>-1!==t.indexOf(n)&&1!==e[n]?`${e[n]} - coords[${n}] - 1`:`coords[${n}]`,i=e.map((e,t)=>r(t)).join(","),s=SG(n);this.userCode=`
      void main() {
        ${s} coords = getOutputCoords();
        setOutput(getX(${i}));
      }
    `}}class Rc{constructor(e,t){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;let n=e.length;if(n>4)throw Error(`WebGL backend: Reverse of rank-${n} tensor is not yet supported`);this.outputShape=e;let r=Co("rc",n),i=`${r[n-1]} + 1 < ${this.outputShape[n-1]}`,s=`${r[n-2]} + 1 < ${this.outputShape[n-2]}`,a=SG(n);function o(e){return h(e)}function l(e){return e[n-1]="("+e[n-1]+" + 1)",h(e)}function u(e){return e[n-2]="("+e[n-2]+" + 1)",h(e)}function c(e){return e[n-1]="("+e[n-1]+" + 1)",e[n-2]="("+e[n-2]+" + 1)",h(e)}function h(t){let n=e.map((e,n)=>d(n,t)),r=n.join(","),i=n.slice(-2).join(",");return`getChannel(getX(${r}), vec2(${i}))`}function d(n,r){return -1!==t.indexOf(n)&&1!==e[n]?`${e[n]} - ${r[n]} - 1`:`${r[n]}`}1===n?this.userCode=`
        void main(){
          int rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = getChannel(getX(${e[0]} - rc - 1),
            ${e[0]} - rc - 1);
          if(${i}){
              result.g = getChannel(getX(${e[0]} - (rc  + 1) - 1),
                ${e[0]} - (rc  + 1) - 1);
          }
          setOutput(result);
        }
      `:this.userCode=`
        void main() {
          ${a} rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = ${o(r.slice())};
          if(${i}){
            result.g = ${l(r.slice())};
          }
          if(${s}) {
            result.b = ${u(r.slice())};
            if(${i}) {
              result.a = ${c(r.slice())};
            }
          }
          setOutput(result);
        }
    `}}let Rh={kernelName:nP,backendName:"webgl",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{dims:s}=r,a=i.shape.length,o=Z(s,i.shape);if(0===a)return CX({inputs:{x:i},backend:n});let l=eN().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new Rc(i.shape,o):new Ru(i.shape,o);return n.runWebGLProgram(l,[i],i.dtype)}};class Rd{constructor(e,t){this.variableNames=["Image"],this.outputShape=[],this.customUniforms=[{name:"params",type:"vec4"}];let n=e[1],r=e[2];this.outputShape=e;let i="";i="number"==typeof t?`float outputValue = ${t.toFixed(2)};`:`
        vec3 fill = vec3(${t.join(",")});
        float outputValue = fill[coords[3]];`,this.userCode=`
        void main() {
          ivec4 coords = getOutputCoords();
          int x = coords[2];
          int y = coords[1];
          float coordXFloat = (float(x) - params[0]) * params[3] -
            (float(y) - params[1]) * params[2];
          float coordYFloat = (float(x) - params[0]) * params[2] +
            (float(y) - params[1]) * params[3];
          int coordX = int(round(coordXFloat + params[0]));
          int coordY = int(round(coordYFloat + params[1]));
          ${i}
          if(coordX >= 0 && coordX < ${r} && coordY >= 0 && coordY < ${n}) {
            outputValue = getImage(coords[0], coordY, coordX, coords[3]);
          }
          setOutput(outputValue);
        }
    `}}let Rp={kernelName:rm,backendName:"webgl",kernelFunc:({inputs:e,attrs:t,backend:n})=>{let{image:r}=e,{radians:i,fillValue:s,center:a}=t,o=n,l=new Rd(r.shape,s),[u,c]=u5(a,r.shape[1],r.shape[2]),h=[[u,c,Math.sin(i),Math.cos(i)]];return o.runWebGLProgram(l,[r],r.dtype,h)}},Rf={kernelName:nM,backendName:"webgl",kernelFunc:C5({opSnippet:`
  // OpenGL ES does not support round function.
  // The algorithm is based on banker's rounding.
  float base = floor(x);
  if ((x - base) < 0.5) {
    return floor(x);
  } else if ((x - base) > 0.5) {
    return ceil(x);
  } else {
    if (mod(base, 2.0) == 0.0) {
      return base;
    } else {
      return base + 1.0;
    }
  }
`})},Rg={kernelName:nL,backendName:"webgl",kernelFunc:C5({opSnippet:"return inversesqrt(x);",cpuKernelImpl:EQ})};class Rm{constructor(e,t,n,r,i,s,a=!0,o=!1){this.variableNames=["updates","indices","defaultValue"],this.outputShape=s;let l=SG(i.length),u=SG(s.length),c="";1===n?c="i":2===n&&(c="i, j");let h=`getIndices(${c})`,d="";1===r?d="i":2===r&&(d="i, coords[1]");let p=`getUpdates(${d})`,f="";o&&(f="coords[0], coords[1]");let g=`getDefaultValue(${f})`,m=t>1?"strides[j]":"strides";this.userCode=`
        ${l} strides = ${l}(${i});

        void main() {
          ${u} coords = getOutputCoords();
          float sum = 0.0;
          bool found = false;
          for (int i = 0; i < ${e}; i++) {
            int flattenedIndex = 0;
            for (int j = 0; j < ${t}; j++) {
              int index = round(${h});
              flattenedIndex += index * ${m};
            }
            if (flattenedIndex == coords[0]) {
              sum += ${p};
              found = true;
            }
          }
          setOutput(mix(${g}, sum, float(found)));
        }
      `}}class Ry{constructor(e,t,n,r,i,s,a=!0,o=!1){this.variableNames=["updates","indices","defaultValue"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=s;let l=SG(i.length),u=SG(s.length),c="";1===n?c="i":2===n&&(c="i, j");let h=`getIndices(${c})`,d="";1===r?d="i":2===r&&(d="i, coords[1]");let p=`getUpdates(${d})`,f="";o&&(f="coords[0], coords[1]");let g=`getDefaultValue(${f})`,m=t>1?"strides[j]":"strides",y=t>1?"strides[j + 1]":"strides";this.userCode=`
        ${l} strides = ${l}(${i});

        void main() {
          ${u} coords = getOutputCoords();
          vec4 sum = vec4(0.);
          vec4 found = vec4(0.);
          for (int i = 0; i < ${e}; i+=2) {
            ivec2 flattenedIndex = ivec2(0);
            for (int j = 0; j < ${t}; j+=2) {
              ivec4 index = round(${h});
              flattenedIndex += index.xz * ${m};
              if (j + 1 < ${t}) {
                flattenedIndex += index.yw * ${y};
              }
            }
            if (flattenedIndex[0] == coords[0] || flattenedIndex[1] == coords[0] ||
                flattenedIndex[0] == coords[0] + 1 || flattenedIndex[1] == coords[0] + 1) {
              vec4 updVals = ${p};
              if (flattenedIndex[0] == coords[0]) {
                sum.xy += updVals.xy;
                found.xy = vec2(1.);
              } else if (flattenedIndex[0] == coords[0] + 1) {
                sum.zw += updVals.xy;
                found.zw = vec2(1.);
              }
              if (flattenedIndex[1] == coords[0]) {
                sum.xy += updVals.zw;
                found.xy = vec2(1.);
              } else if (flattenedIndex[1] == coords[0] + 1) {
                sum.zw += updVals.zw;
                found.zw = vec2(1.);
              }
            }
          }
          setOutput(mix(${g}, sum, found));
        }
      `}}let Rb={kernelName:nz,backendName:"webgl",kernelFunc:function(e){let t;let{inputs:n,backend:r,attrs:i}=e,{indices:s,updates:a}=n,{shape:o}=i,{sliceRank:l,numUpdates:u,sliceSize:c,strides:h,outputSize:d}=cs(a,s,o),p=[d/c,c];if(0===d)return r.makeTensorInfo(o,s.dtype);let f=Aa({inputs:{x:s},backend:r,attrs:{shape:[u,l]}}),g=Aa({inputs:{x:a},backend:r,attrs:{shape:[u,c]}}),m=r.makeTensorInfo([],"float32",new Float32Array([0]));t=eN().getBool("WEBGL_PACK")?new Ry(u,l,f.shape.length,g.shape.length,h,p):new Rm(u,l,f.shape.length,g.shape.length,h,p);let y=r.runWebGLProgram(t,[g,f,m],g.dtype),b=Aa({inputs:{x:y},backend:r,attrs:{shape:o}});return r.disposeIntermediateTensorInfo(f),r.disposeIntermediateTensorInfo(g),r.disposeIntermediateTensorInfo(y),r.disposeIntermediateTensorInfo(m),b}};class Rv{constructor(e,t,n,r){this.variableNames=["sortedSequence","values"],this.customUniforms=[{name:"numInputs",type:"int"}],this.outputShape=[e,n];let i="while (left < right) {",s=`for (int i = 0; i < ${Math.ceil(Math.log2(t+1))}; ++i) { if (left >= right) break;`,a=2===eN().getNumber("WEBGL_VERSION")?i:s,o="left"===r?"<":"<=";this.userCode=`
       int findBound(int batch, float value) {
         int left = 0;
         int right = numInputs;
         int mid;
         ${a}
           mid = (left + right) / 2;
           if (getSortedSequence(batch, mid) ${o} value) {
             left = mid + 1;
           } else {
             right = mid;
           }
         }
         return right;
       }

       void main() {
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int valueIndex = coords[1];

         float value = getValues(batch, valueIndex);

         setOutput(float(findBound(batch, value)));
       }
     `}}let Rw={kernelName:nU,backendName:"webgl",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{sortedSequence:i,values:s}=t,{side:a}=r,o=new Rv(i.shape[0],i.shape[1],s.shape[1],a),l=[[i.shape[1]]];return n.runWebGLProgram(o,[i,s],"int32",l)}};class R_{constructor(e,t,n){let r,i;if(this.variableNames=["c","a","b"],this.outputShape=t,n>4)throw Error(`Where for rank ${n} is not yet supported`);if(1===n)i="resRC",r="resRC";else{let n=["resRC.x","resRC.y","resRC.z","resRC.w"],s=[],a=[];for(let r=0;r<t.length;r++)a.push(`${n[r]}`),r<e&&s.push(`${n[r]}`);r=s.join(),i=a.join()}let s=SG(n);this.userCode=`
      void main() {
        ${s} resRC = getOutputCoords();
        float cVal = getC(${r});
        if (cVal >= 1.0) {
          setOutput(getA(${i}));
        } else {
          setOutput(getB(${i}));
        }
      }
    `}}let Rx={kernelName:nV,backendName:"webgl",kernelFunc:function(e){let{inputs:t,backend:n}=e,{condition:r,t:i,e:s}=t,a=new R_(r.shape.length,i.shape,i.shape.length);return n.runWebGLProgram(a,[r,i,s],iw(i.dtype,s.dtype))}},RT={kernelName:nj,backendName:"webgl",kernelFunc:C5({opSnippet:`
  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.
  // see: https://arxiv.org/abs/1706.02515
  float scaleAlpha = ${ca};
  float scale = ${co};
  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);
`})},RI={kernelName:nK,backendName:"webgl",kernelFunc:C5({opSnippet:C6+`
  return 1.0 / (1.0 + exp(-1.0 * x));
`,packedOpSnippet:`
  vec4 result = 1.0 / (1.0 + exp(-1.0 * x));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,cpuKernelImpl:EZ})},Rk={kernelName:nH,backendName:"webgl",kernelFunc:C5({opSnippet:`
  if (isnan(x)) { return 0.0; }
  return sign(x);
`})},RS={kernelName:nW,backendName:"webgl",kernelFunc:C5({opSnippet:C6+`
  return sin(x);
`,packedOpSnippet:`
  vec4 result = sin(x);
  bvec4 isNaN = isnan(x);
  ${CH}
  return result;
`})},RE={kernelName:nq,backendName:"webgl",kernelFunc:C5({opSnippet:`
  float e2x = exp(x);
  return (e2x - 1.0 / e2x) / 2.0;
`})},RC={kernelName:nX,backendName:"webgl",kernelFunc:C5({opSnippet:`
  float epsilon = 1.1920928955078125e-7;
  float threshold = log(epsilon) + 2.0;

  bool too_large = x > -threshold;
  bool too_small = x < threshold;

  float result;
  float exp_x = exp(x);

  if (too_large){
    result = x;
  }
  else if (too_small){
    result = exp_x;
  }
  else{
    result = log(exp_x + 1.0);
  }
  return result;
`})},RA={kernelName:nJ,backendName:"webgl",kernelFunc:e=>{let{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{blockShape:s,paddings:a}=r;j(i.shape.length<=4,()=>"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet");let o=s.reduce((e,t)=>e*t),l=[[0,0]];l.push(...a);for(let e=1+s.length;e<i.shape.length;++e)l.push([0,0]);let u=[],c=$Q({inputs:{x:i},backend:n,attrs:{paddings:l,constantValue:0}}),h=u8(c.shape,s,o,!1),d=u7(h.length,s.length,!1),p=u9(c.shape,s,o,!1),f=Aa({inputs:{x:c},backend:n,attrs:{shape:h}}),g=Av({inputs:{x:f},backend:n,attrs:{perm:d}}),m=Aa({inputs:{x:g},backend:n,attrs:{shape:p}});return u.push(c),u.push(f),u.push(g),u.forEach(e=>n.disposeIntermediateTensorInfo(e)),m}},RN={kernelName:n1,backendName:"webgl",kernelFunc:function(e){let{inputs:t,backend:n}=e,{indices:r,values:i,denseShape:s,defaultValue:a}=t;if(1!==s.shape.length)throw Error(`Dense shape must be a vector, saw:
         ${s.shape}`);if(2!==r.shape.length)throw Error(`Indices must be a matrix, saw:
         ${r.shape}`);if(1!==i.shape.length)throw Error(`Values must be a vector, saw:
         ${i.shape}`);if(0!==a.shape.length)throw Error(`Default value must be a scalar, saw:
        ${a.shape}`);let o=n.readSync(r.dataId),l=n.readSync(i.dataId),u=n.readSync(s.dataId),c=n.readSync(a.dataId)[0],[h,d,p,f,g]=E2(o,r.shape,r.dtype,l,i.dtype,u,c);return[n.makeTensorInfo(d,r.dtype,h),n.makeTensorInfo([d[0]],i.dtype,p),n.makeTensorInfo([f.length],"bool",new Uint8Array(f.map(e=>Number(e)))),n.makeTensorInfo([g.length],r.dtype,new Int32Array(g))]}},RO={kernelName:n2,backendName:"webgl",kernelFunc:function(e){let{inputs:t,backend:n}=e,{inputIndices:r,inputShape:i,newShape:s}=t;if(2!==r.shape.length)throw Error(`Input indices should be a matrix but received shape ${r.shape}`);if(1!==i.shape.length)throw Error(`Input shape should be a vector but received shape ${i.shape}`);if(1!==s.shape.length)throw Error(`Target shape should be a vector but received shape ${s.shape}`);let a=Array.from(n.readSync(i.dataId)),o=n.readSync(r.dataId),l=Array.from(n.readSync(s.dataId)),[u,c,h]=E3(o,r.shape,r.dtype,a,l);return[n.makeTensorInfo(c,r.dtype,u),n.makeTensorInfo([h.length],s.dtype,new Int32Array(h))]}},R$={kernelName:n3,backendName:"webgl",kernelFunc:function(e){let{inputs:t,backend:n}=e,{data:r,indices:i,segmentIds:s}=t;if(r.shape.length<1)throw Error("Data should be at least 1 dimensional but received scalar");if(1!==i.shape.length)throw Error(`Indices should be a vector but received shape
              ${i.shape}`);if(1!==s.shape.length)throw Error(`Segment ids should be a vector but received shape
              ${s.shape}`);let a=n.readSync(r.dataId),o=n.readSync(i.dataId),l=n.readSync(s.dataId),[u,c]=E4(a,r.shape,r.dtype,o,l,!0);return n.makeTensorInfo(c,r.dtype,u)}},RR={kernelName:n4,backendName:"webgl",kernelFunc:function(e){let{inputs:t,backend:n}=e,{data:r,indices:i,segmentIds:s}=t;if(r.shape.length<1)throw Error("Data should be at least 1 dimensional but received scalar");if(1!==i.shape.length)throw Error(`Indices should be a vector but received shape
             ${i.shape}`);if(1!==s.shape.length)throw Error(`Segment ids should be a vector but received shape
             ${s.shape}`);let a=n.readSync(r.dataId),o=n.readSync(i.dataId),l=n.readSync(s.dataId),[u,c]=E4(a,r.shape,r.dtype,o,l);return n.makeTensorInfo(c,r.dtype,u)}},RD={kernelName:n6,backendName:"webgl",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{sparseIndices:i,sparseValues:s,defaultValue:a}=t,{outputShape:o}=r,{sliceRank:l,numUpdates:u,sliceSize:c,strides:h,outputSize:d}=cs(s,i,o),p=!1;if("string"===s.dtype){let e=EJ(n.bufferSync(i),n.bufferSync(s),o,d,c,u,l,h,r0(n.readSync(a.dataId)[0]),p);return n.makeTensorInfo(o,e.dtype,e.values)}let f=new Rm(u,l,i.shape.length,s.shape.length,h,[d,1],p),g=n.runWebGLProgram(f,[s,i,a],s.dtype),m=Aa({inputs:{x:g},backend:n,attrs:{shape:o}});return n.disposeIntermediateTensorInfo(g),m}},RF={kernelName:nZ,backendName:"webgl",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{numOrSizeSplits:s,axis:a}=r,o=Z(a,i.shape)[0],l=c$(i,s,o),u=Array(i.shape.length).fill(0),c=i.shape.slice();return l.map(e=>{let t=[...c];t[o]=e;let r=Nt({inputs:{x:i},backend:n,attrs:{begin:u,size:t}});return u[o]+=e,r})}},RP="return sqrt(x);",RM={kernelName:nY,backendName:"webgl",kernelFunc:C5({opSnippet:RP,packedOpSnippet:RP,cpuKernelImpl:E6})},RL={kernelName:n8,backendName:"webgl",kernelFunc:C5({opSnippet:"return x * x;"})},Rz="return (a - b) * (a - b);",RB={kernelName:n5,backendName:"webgl",kernelFunc:C8({opSnippet:Rz,packedOpSnippet:Rz})},RU={kernelName:n7,backendName:"webgl",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{x:i}=t;if("string"!==i.dtype)throw Error("Input must be of datatype string");let s=E5(cK(n.readSync(i.dataId)),"string",r);return n.makeTensorInfo(i.shape,"string",s)}},RV={kernelName:rf,backendName:"webgl",kernelFunc:function({inputs:e,attrs:t,backend:n}){let{x:r}=e,i=Cw+`
    return x > 0.0 ? 1.0 : float(${t.alpha});
  `,s=new Cv(r.shape,i);return n.runWebGLProgram(s,[r],r.dtype)}};class Rj{constructor(e,t,n){this.variableNames=["x"],this.outputShape=n;let r=n.length,i=SG(n.length),s=SG(n.length),a="";if(1===r)a="coords * strides + begin";else{let e=0;a=n.map((t,r)=>(e++,1===n.length?`coords * strides[${r}] + begin[${r}]`:`coords[${e-1}] * strides[${r}] + begin[${r}]`)).join(",")}this.userCode=`
      ${i} begin = ${i}(${e});
      ${i} strides = ${i}(${t});

      void main() {
        ${s} coords = getOutputCoords();
        setOutput(getX(${a}));
      }
    `}}let RG={kernelName:n9,backendName:"webgl",kernelFunc:function(e){let t;let{inputs:n,backend:r,attrs:i}=e,{x:s}=n,{begin:a,end:o,strides:l,beginMask:u,endMask:c,ellipsisMask:h,newAxisMask:d,shrinkAxisMask:p}=i,{finalShapeSparse:f,finalShape:g,isIdentity:m,sliceDim0:y,isSimpleSlice:b,begin:v,end:w,strides:_}=a8(s.shape,a,o,l,u,c,h,d,p);if(m)t=Aa({inputs:{x:s},backend:r,attrs:{shape:g}});else if(y||b){j(s.shape.length>=1,()=>`Input must have rank at least 1, got: ${s.shape.length}`);let e=aK(v,w,_),n=Nt({inputs:{x:s},backend:r,attrs:{begin:v,size:e}});t=Aa({inputs:{x:n},backend:r,attrs:{shape:g}}),r.disposeIntermediateTensorInfo(n)}else if(r.shouldExecuteOnCPU([s])){let e=r.readSync(s.dataId),n=E8(f,s0(s.shape,s.dtype,e),_,v);t=r.makeTensorInfo(g,s.dtype,n.values)}else{let e=new Rj(v,_,f);t=r.runWebGLProgram(e,[s],s.dtype)}let x=Aa({inputs:{x:t},backend:r,attrs:{shape:g}});return r.disposeIntermediateTensorInfo(t),x}},RW={kernelName:re,backendName:"webgl",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{separator:i,nGramWidths:s,leftPad:a,rightPad:o,padWidth:l,preserveShortSequences:u}=r,{data:c,dataSplits:h}=t,[d,p]=E7(n.readSync(c.dataId),n.readSync(h.dataId),i,s,a,o,l,u);return[n.makeTensorInfo([d.length],"string",d),n.makeTensorInfo(h.shape,"int32",p)]}},Rq={kernelName:rt,backendName:"webgl",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{skipEmpty:i}=r,{input:s,delimiter:a}=t;if("string"!==s.dtype)throw Error("Input must be of datatype string");if(1!==s.shape.length)throw Error(`Input must be a vector, got shape: ${s.shape}`);if(0!==a.shape.length)throw Error(`Delimiter must be a scalar, got shape: ${a.shape}`);let[o,l,u]=E9(n.readSync(s.dataId),n.readSync(a.dataId)[0],i),c=l.length;return[n.makeTensorInfo([c,2],"int32",o),n.makeTensorInfo([c],"string",l),n.makeTensorInfo([2],"int32",new Int32Array(u))]}},RH={kernelName:rn,backendName:"webgl",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{numBuckets:i}=r,{input:s}=t;if("string"!==s.dtype)throw Error("Input must be of datatype string");if(i<=0)throw Error("Number of buckets must be at least 1");let a=Ce(n.readSync(s.dataId),i);return n.makeTensorInfo(s.shape,"int32",a)}},RK={kernelName:ri,backendName:"webgl",kernelFunc:C5({opSnippet:"return tan(x);"})},RX={kernelName:rs,backendName:"webgl",kernelFunc:C5({opSnippet:`
  float e2x = exp(-2.0 * abs(x));
  return sign(x) * (1.0 - e2x) / (1.0 + e2x);
`})},RY={kernelName:nB,backendName:"webgl",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{tensor:i,indices:s,updates:a}=t,{}=r,{sliceRank:o,numUpdates:l,sliceSize:u,strides:c,outputSize:h}=cs(a,s,i.shape),d=[h/u,u];if(0===h)return n.makeTensorInfo(i.shape,s.dtype);let p=Aa({inputs:{x:s},backend:n,attrs:{shape:[l,o]}}),f=Aa({inputs:{x:a},backend:n,attrs:{shape:[l,u]}}),g=Aa({inputs:{x:i},backend:n,attrs:{shape:d}}),m=new Rm(l,o,p.shape.length,f.shape.length,c,d,!1,!0),y=n.runWebGLProgram(m,[f,p,g],g.dtype),b=Aa({inputs:{x:y},backend:n,attrs:{shape:i.shape}});return n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(g),n.disposeIntermediateTensorInfo(y),b}};class RQ{constructor(e,t){this.variableNames=["A"];let n=Array(e.length);for(let r=0;r<n.length;r++)n[r]=e[r]*t[r];this.outputShape=n,this.rank=n.length;let r=SG(this.rank),i=RJ(e);this.userCode=`
      void main() {
        ${r} resRC = getOutputCoords();
        setOutput(getA(${i}));
      }
    `}}function RJ(e){let t=e.length;if(t>5)throw Error(`Tile for rank ${t} is not yet supported`);if(1===t)return`imod(resRC, ${e[0]})`;let n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],r=[];for(let t=0;t<e.length;t++)r.push(`imod(${n[t]}, ${e[t]})`);return r.join()}function RZ(e){let{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{reps:s}=r;if("string"===i.dtype||i.shape.length>5){let e=n.readSync(i.dataId),t="string"===i.dtype?e.map(e=>r0(e)):e,r=Cn(s0(i.shape,i.dtype,t),s);return n.makeTensorInfo(r.shape,r.dtype,r.values)}let a=new RQ(i.shape,s);return n.runWebGLProgram(a,[i],i.dtype)}let R0={kernelName:ra,backendName:"webgl",kernelFunc:RZ};class R1{constructor(e){this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"negativeInf",type:"float"},{name:"dir",type:"int"},{name:"inc",type:"int"}],this.outputShape=e,this.userCode=`
       void main() {
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int elemIdx = coords[1];

         // We compare elements pair-wise within a group of size 2 * inc.
         // The comparing rule for each group alternates between ascending
         // and descending. Within each group, we compare each pair at
         // positions i and i+inc. To decide whether an element at position i
         // is x0 or x1, we mod it by 2 * inc, if the result is smaller than
         // inc, it is in the first half of the group, we denote it as x0,
         // otherwise we denote it as x1.
         // For example, as shown in the Bitonic top K paper referenced above,
         // Figure5(a) shows that element[1] is in the
         // second half of the group when group size is 2, but it is in the
         // first half of the group when group size is 4.

         bool isFirstInPair = imod(elemIdx, 2 * inc) < inc;
         int i = isFirstInPair ? elemIdx : elemIdx - inc;

         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));
         int i1 = firstPass == 1 ? i + inc : int(getIndices(batch, i + inc));
         float x0 = i0 < n ? getX(batch, i0) : negativeInf;
         float x1 = i1 < n ? getX(batch, i1) : negativeInf;

         // Denotes which direction indices are in (ascending or descending).
         bool reverse = imod(elemIdx, 2 * dir) >= dir;
         bool isGreater = x0 > x1 || (x0 == x1 && i1 > i0);
         if (reverse == isGreater) { // Elements in opposite order of direction
           int iTemp = i0;
           i0 = i1;
           i1 = iTemp;
         }
         if (isFirstInPair) {
            setOutput(float(i0));
         } else {
            setOutput(float(i1));
         }
       }
     `}}class R2{constructor(e){this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"k",type:"int"}],this.outputShape=e,this.userCode=`
    void main() {
         // Takes max of indices (0, k), (1, k + 1), (2, k + 2) ...
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int elemIdx = coords[1];

         // The output size is half of the previous size.
         // If the previous sequence is | | | | _ _ _ _  | | | |  _ _ _ _ (k=4),
         // we only need to output the indices at positions |, the indices at
         // positions _ can be thrown away, see Figure5(b) After Phase 2
         // (Merge phase) in the Bitonic Top K paper referenced above.
         // For example, the paper shows we only need to output the orange bars.
         // The output sequence should look like this | | | | | | | |.
         // Because the sequence is halved, to map the output index back
         // to the previous sequence to find the corresponding value,
         // we need to double the index. When we double the index,
         // we basically interpolate a position, so 2i looks like
         // | _ | _ | _ | _ | _ | _ | _. We move the | to the first k position
         // of each 2k positions by - elemIdx % k. E.g. for output at
         // index 4,5,6,7, we want to get the corresponding element at
         // original index 8,9,10,11, for output at index 8,9,10,11,
         // we want to get the corresponding element at original index
         // 16,17,18,19, so on and so forth.

         int i = elemIdx < k ? elemIdx : (elemIdx * 2 - imod(elemIdx, k));
         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));
         int i1 = firstPass == 1 ? i + k : int(getIndices(batch, i + k));

         float x0 = getX(batch, i0);
         float x1 = i1 < n ? getX(batch, i1) : x0;

         setOutput(x0 >= x1 ? float(i0) : float(i1));
       }
     `}}function R3(e,t){null!==t&&e.disposeIntermediateTensorInfo(t)}function R4(e){let t=1;for(;t<e;)t*=2;return t}let R6={kernelName:ro,backendName:"webgl",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{k:s,sorted:a}=r,o=eN().getNumber("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD"),l=eN().getNumber("TOPK_K_CPU_HANDOFF_THRESHOLD"),u=i.shape,c=u[u.length-1];if(n.shouldExecuteOnCPU([i])||c<o||s>l){let[e,t]=Cr(n.readSync(i.dataId),u,i.dtype,s,a);return[n.makeTensorInfo(e.shape,e.dtype,e.values),n.makeTensorInfo(t.shape,t.dtype,t.values)]}if(0===s)return u[u.length-1]=0,[n.makeTensorInfo(u,i.dtype,[]),n.makeTensorInfo(u,"int32",[])];if(1===c)return[i,OA({attrs:{shape:u,dtype:"int32",value:0},backend:n})];let h=n.texData.get(i.dataId),d=null!==h&&h.isPacked,p=d?n.unpackTensor(i):i,f=q(u)/c,g=Aa({inputs:{x:p},attrs:{shape:[f,c]},backend:n});d&&R3(n,p);let m=R4(s),y=R4(c),b=null,v=()=>null===b?[g,g]:[g,b],w=(e,t,r)=>{let i=v(),s=new R1(r),a=[[c],[null===b?1:0],[Number.NEGATIVE_INFINITY],[e],[t]],o=b;b=n.runWebGLProgram(s,i,"int32",a),R3(n,o)};for(let e=1;e<m;e*=2){let t=2*e;for(let n=e;n>=1;n/=2)w(t,n,[f,y])}for(let e=y;e>m;e/=2){let t=v(),r=new R2([f,e/2]),i=[[c],[null===b?1:0],[m]],s=b;b=n.runWebGLProgram(r,t,"int32",i),R3(n,s);let a=m/2,o=2*a;for(let e=a;e>=1;e/=2)w(o,e,b.shape)}let _=b;b=Nt({inputs:{x:b},backend:n,attrs:{begin:0,size:[f,s]}}),R3(n,_);let x=OH({inputs:{x:g,indices:b},backend:n,attrs:{axis:1,batchDims:1}});R3(n,g);let T=u.slice(0,-1);T.push(s),_=b,b=Aa({inputs:{x:b},attrs:{shape:T},backend:n}),R3(n,_);let I=x;return x=Aa({inputs:{x:x},attrs:{shape:T},backend:n}),R3(n,I),[x,b]}};class R5{constructor(e,t,n,r,i,s){let a;this.variableNames=["Image","Transforms"],this.outputShape=s;let o="nearest"===n?1:2;switch(r){case"constant":default:a=1;break;case"reflect":a=2;break;case"wrap":a=3;break;case"nearest":a=4}this.userCode=`
            float mapCoord(float outCoord, float len) {
              float inCoord = outCoord;
              if(${a} == 2) {
                if (inCoord < 0.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz2 = 2.0 * len;
                    if (inCoord < sz2) {
                      inCoord = sz2 * float(int(float(-inCoord / sz2))) +
                      inCoord;
                    }
                    inCoord = inCoord < -len ? inCoord + sz2 : -inCoord - 1.0;
                  }
                } else if (inCoord > len - 1.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz2 = 2.0 * len;
                    inCoord -= sz2 * float(int(float(inCoord / sz2)));
                    if (inCoord >= len) {
                      inCoord = sz2 - inCoord - 1.0;
                    }
                  }
                }
                return clamp(inCoord, 0.0, len - 1.0);
              } else if (${a} == 3) {
                if (inCoord < 0.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz = len - 1.0;
                    inCoord += len * (float(int(float(-inCoord / sz))) + 1.0);
                  }
                } else if (inCoord > len - 1.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz = len - 1.0;
                    inCoord -= len * float(int(float(inCoord / sz)));
                  }
                }
                return clamp(inCoord, 0.0, len - 1.0);
              } else if (${a} == 4) {
                return clamp(outCoord, 0.0, len - 1.0);
              } else {
                return outCoord;
              }
            }

            float readWithFillValue(int batch, int coordY, int coordX,
              int channel) {
              float outputValue;
              if (0 <= coordY && coordY < ${e} && 0 <= coordX && coordX < ${t}) {
                  outputValue = getImage(batch, coordY, coordX, channel);
              } else {
                outputValue = float(${i});
              }
              return outputValue;
            }

            void main() {
              ivec4 coords = getOutputCoords();
              float outputValue;
              int batch = coords[0];
              int x = coords[2];
              int y = coords[1];
              int channel = coords[3];
              float xf = float(x);
              float yf = float(y);
              float a1 = getTransforms(batch, 0);
              float a2 = getTransforms(batch, 1);
              float a3 = getTransforms(batch, 2);
              float b1 = getTransforms(batch, 3);
              float b2 = getTransforms(batch, 4);
              float b3 = getTransforms(batch, 5);
              float c1 = getTransforms(batch, 6);
              float c2 = getTransforms(batch, 7);
              float projection = c1 * xf + c2 * yf + 1.0;
              if (projection == 0.0) {
                outputValue = float(${i});
              } else {
                float inX = (a1 * xf + a2 * yf + a3) / projection;
                float inY = (b1 * xf + b2 * yf + b3) / projection;
                float mapX = mapCoord(inX, float(${t}));
                float mapY = mapCoord(inY, float(${e}));

                if (${o} == 1) {
                  int coordY = int(round(mapY));
                  int coordX = int(round(mapX));
                  outputValue = readWithFillValue(batch, coordY, coordX,
                    channel);
                } else {
                  float yFloor = floor(mapY);
                  float xFloor = floor(mapX);
                  float yCeil = yFloor + 1.0;
                  float xCeil = xFloor + 1.0;
                  float valueYFloor = (xCeil - mapX) *
                  readWithFillValue(batch, int(yFloor), int(xFloor), channel) +
                  (mapX - xFloor) *
                  readWithFillValue(batch, int(yFloor), int(xCeil), channel);
                  float valueYCeil = (xCeil - mapX) *
                  readWithFillValue(batch, int(yCeil), int(xFloor), channel) +
                  (mapX - xFloor) *
                  readWithFillValue(batch, int(yCeil), int(xCeil), channel);
                  outputValue = (yCeil - mapY) * valueYFloor +
                  (mapY - yFloor) * valueYCeil;
                }
              }
              setOutput(outputValue);
            }
        `}}let R8={kernelName:rl,backendName:"webgl",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{image:i,transforms:s}=t,{interpolation:a,fillMode:o,fillValue:l,outputShape:u}=r,[c,h,d,p]=i.shape,[f,g]=null!=u?u:[h,d],m=new R5(h,d,a,o,l,[c,f,g,p]);return n.runWebGLProgram(m,[i,s],"float32")}},R7={kernelName:rc,backendName:"webgl",kernelFunc:function(e){let{inputs:t,attrs:n,backend:r}=e,{axis:i}=n,{x:s}=t;k2(s,"unique"),console.warn("WARNING: ","UI might be locked temporarily as data is being downloaded");let{outputValues:a,outputShape:o,indices:l}=Cs(r.readSync(s.dataId),i,s.shape,s.dtype);return[r.makeTensorInfo(o,s.dtype,a),r.makeTensorInfo([l.length],"int32",l)]}},R9={kernelName:rh,backendName:"webgl",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{value:i}=t,{axis:s}=r;s<0&&(s+=i.shape.length);let a=i,o=a.shape.length,l=i.shape[s],u=Array(o-1),c=0;for(let e=0;e<o;e++)e!==s&&(u[c++]=a.shape[e]);let h=[],d=Array(o).fill(0),p=a.shape.slice();p[s]=1;let f=Array(l);for(let e=0;e<f.length;e++){d[s]=e;let t=Nt({inputs:{x:a},backend:n,attrs:{begin:d,size:p}}),r=Aa({inputs:{x:t},backend:n,attrs:{shape:u}});f[e]=r,h.push(t)}return h.forEach(e=>n.disposeIntermediateTensorInfo(e)),f}};class De{constructor(e,t){this.variableNames=["x","segmentIds"];let n=e.windowSize,r=e.batchSize,i=e.inSize,s=e.numSegments,a=s*Math.ceil(i/n);this.outputShape=[r,a];let o="0.0",l="sumValue",u=4*Math.floor(n/4),c=n%4,h=`
        sumValue += dot(values, segFilter);
    `,d="";i%n>0&&(d=`
        if (inIdx < 0 || inIdx >= ${i}) {
          return initializationValue;
        }
      `);let p="";i%n>0&&(p=`
        if (inIdx < 0 || inIdx >= ${i}) {
          return -1.0;
        }
      `),this.userCode=`
      const float initializationValue = ${o};

      float getValue(int batch, int inIdx) {
        ${d}
        return getX(batch, inIdx);
      }

      float getSegmentIdAtIndex(int inIdx) {
        ${p}
        return getSegmentIds(inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = int(floor(float(outIdx) / float(
          ${s})) * float(${n}));
        int currentSeg = int(mod(float(outIdx), float(${s})));

        float sumValue = 0.0;

        for (int i = 0; i < ${u}; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0
          );

          ${h}
        }

        int inIdx = inOffset + ${u};
        if (${1===c}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            0,
            0,
            0
          );

          ${h}
        } else if (${2===c}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
              0,
              0
          );

          ${h}
        } else if (${3===c}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            0
          );

          ${h}
        }
        setOutput(${l});
      }
    `}}for(let e of[AT,Ak,AS,AE,AA,AR,AD,AF,AU,AV,Aj,AG,AW,Aq,AH,AY,AQ,A0,A1,A2,A6,Nr,Ni,No,Nl,Nm,Nb,N_,CJ,NI,NR,NU,Nq,NK,NX,NY,NQ,NJ,NZ,N1,N5,N8,N7,Oe,Or,Oa,Oo,Ou,Oh,Od,Op,Om,Oy,Ob,Ow,Ox,OI,OE,ON,O$,OD,OF,OL,OU,OV,OG,OK,OX,OY,CY,OQ,NA,OJ,OZ,O0,C1,O1,O2,O3,O4,O6,O5,O8,O7,$t,$r,$a,$o,$l,$u,$d,$p,$g,$y,$b,$v,$x,$T,$$,Ai,$F,$M,$z,$U,Nc,$j,$H,$K,$J,$Z,C4,$0,$1,$2,$3,$6,Nd,$S,$5,$8,$7,Ao,Rt,Rr,Ra,Rl,Rh,Rp,Rf,Rg,Rb,Rw,Rx,RT,RI,Rk,RS,RE,Nn,$O,RC,RA,RN,RO,R$,RR,RD,RF,RM,RL,RB,RU,RV,RG,RW,Rq,RH,$A,Ab,RK,RX,RY,R0,R6,R8,Aw,R7,R9,{kernelName:rd,backendName:"webgl",kernelFunc:function(e){let{inputs:t,backend:n,attrs:r}=e,{x:i,segmentIds:s}=t,{numSegments:a}=r,o=i.shape.length,l=[],u=0,c=li([0],o),h=i;null!=c&&(h=Av({inputs:{x:i},backend:n,attrs:{perm:c}}),l.push(h),u=la(1,o)[0]);let d=cq(h.shape,u,a),p=q([h.shape[u]]),f=Aa({inputs:{x:h},backend:n,attrs:{shape:[-1,p]}});l.push(f);let g=i_(i.dtype),m=(e,t,r,i,s)=>{let a=e.shape[0],o=e.shape[1],u=cW(o,s),c=new De({windowSize:u,inSize:o,batchSize:a,numSegments:s},t),h=n.compileAndRun(c,[e,r],i);if(l.push(h),h.shape[1]===s)return h;let d=$4({backend:n,attrs:{start:0,stop:s,step:1,dtype:"float32"}}),p=RZ({inputs:{x:d},backend:n,attrs:{reps:[o/u]}});return l.push(d),l.push(p),m(h,t,p,i,s)},y=Aa({inputs:{x:m(f,"unsortedSegmentSum",s,g,a)},backend:n,attrs:{shape:d}}),b=y;return null!=c&&(l.push(y),b=Av({inputs:{x:b},backend:n,attrs:{perm:ls(c)}})),l.forEach(e=>n.disposeIntermediateTensorInfo(e)),b}},$W])rE(e);function Dt(e,t){e&&e(t)}function Dn(e){return Object.fromEntries(Object.entries(e).map(([e,t])=>[t,e]))}function Dr(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}let Di=class{constructor(){let e=function(...t){return e._call(...t)};return Object.setPrototypeOf(e,new.target.prototype)}_call(...e){throw Error("Must implement _call method in subclass")}};function Ds(e){return e?.prototype?.__proto__?.constructor?.name==="TypedArray"}function Da(e){return Number.isInteger(e)||"bigint"==typeof e}function Do(e){return null!=e}function Dl(e){let t=[],n=e;for(;Array.isArray(n);)t.push(n.length),n=n[0];return t}function Du(e,t,n){let r=e[t];if(void 0!==r)return delete e[t],r;if(void 0===n)throw Error(`Key ${t} does not exist in object.`);return n}function Dc(...e){return Array.prototype.concat.apply([],e)}function Dh(...e){return e.reduce((e,t)=>e.flatMap(e=>t.map(t=>[e,t])))}function Dd(e,t){return Math.abs((e+t)%(2*t)-t)}var Dp=n(143),Df=n(2603),Dg=n(2009),Dm=n(6837),Dy=n(8797),Db=n(3052),Dv=n.t(Db,2),Dw=n(250),D_=n.t(Dw,2),Dx=n(7836);let DT=["wasm"];void 0!==Dx&&Dx?.release?.name==="node"?(c=Db??Dv,DT.unshift("cpu")):(c=Dw??D_,"undefined"!=typeof navigator&&/iP(hone|od|ad).+16_4.+AppleWebKit/.test(navigator.userAgent)&&(c.env.wasm.simd=!1));let{env:DI}=c,Dk="2.17.2",DS="undefined"!=typeof self&&"caches"in self,DE=!DF(Dg),DC=!DF(Dm),DA=DE&&DC,DN=DA?Dm.dirname(Dm.dirname(Dy.fileURLToPath("file:///D:/CSVParse/venv/env/sentiment-tracker/sentiment/node_modules/@xenova/transformers/src/env.js"))):"./",DO=DA?Dm.join(DN,"/.cache/"):null,D$="/models/",DR=DA?Dm.join(DN,D$):D$;DI?.wasm&&(DI.wasm.wasmPaths=DA?Dm.join(DN,"/dist/"):`https://cdn.jsdelivr.net/npm/@xenova/transformers@${Dk}/dist/`);let DD={version:Dk,allowRemoteModels:!0,remoteHost:"https://huggingface.co/",remotePathTemplate:"{model}/resolve/{revision}/",allowLocalModels:!0,localModelPath:DR,useFS:DE,useBrowserCache:DS,useFSCache:DE,cacheDir:DO,useCustomCache:!1,customCache:null};function DF(e){return 0===Object.keys(e).length}var DP=n(7836),DM=n(8287).hp;class DL{_CONTENT_TYPE_MAP={txt:"text/plain",html:"text/html",css:"text/css",js:"text/javascript",json:"application/json",png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg",gif:"image/gif"};constructor(e){if(this.filePath=e,this.headers=new Headers,this.exists=Dp.existsSync(e),this.exists){this.status=200,this.statusText="OK";let t=Dp.statSync(e);this.headers.set("content-length",t.size.toString()),this.updateContentType();let n=this;this.body=new ReadableStream({start(e){n.arrayBuffer().then(t=>{e.enqueue(new Uint8Array(t)),e.close()})}})}else this.status=404,this.statusText="Not Found",this.body=null}updateContentType(){let e=this.filePath.toString().split(".").pop().toLowerCase();this.headers.set("content-type",this._CONTENT_TYPE_MAP[e]??"application/octet-stream")}clone(){let e=new DL(this.filePath);return e.exists=this.exists,e.status=this.status,e.statusText=this.statusText,e.headers=new Headers(this.headers),e}async arrayBuffer(){return(await Dp.promises.readFile(this.filePath)).buffer}async blob(){return new Blob([await Dp.promises.readFile(this.filePath)],{type:this.headers.get("content-type")})}async text(){return await Dp.promises.readFile(this.filePath,"utf8")}async json(){return JSON.parse(await this.text())}}function Dz(e,t=null,n=null){let r;try{r=new URL(e)}catch(e){return!1}return(!t||!!t.includes(r.protocol))&&(!n||!!n.includes(r.hostname))}async function DB(e){if(DD.useFS&&!Dz(e,["http:","https:","blob:"]))return new DL(e);if(void 0===DP||DP?.release?.name!=="node")return fetch(e);{let t=!!DP.env?.TESTING_REMOTELY,n=DD.version,r=new Headers;if(r.set("User-Agent",`transformers.js/${n}; is_ci/${t};`),Dz(e,["http:","https:"],["huggingface.co","hf.co"])){let e=DP.env?.HF_TOKEN??DP.env?.HF_ACCESS_TOKEN;e&&r.set("Authorization",`Bearer ${e}`)}return fetch(e,{headers:r})}}let DU={400:"Bad request error occurred while trying to load file",401:"Unauthorized access to file",403:"Forbidden access to file",404:"Could not locate file",408:"Request timeout error occurred while trying to load file",500:"Internal server error error occurred while trying to load file",502:"Bad gateway error occurred while trying to load file",503:"Service unavailable error occurred while trying to load file",504:"Gateway timeout error occurred while trying to load file"};function DV(e,t,n){if(!n)return null;let r=DU[e]??`Error (${e}) occurred while trying to load file`;throw Error(`${r}: "${t}".`)}class Dj{constructor(e){this.path=e}async match(e){let t=new DL(Df.join(this.path,e));return t.exists?t:void 0}async put(e,t){let n=DM.from(await t.arrayBuffer()),r=Df.join(this.path,e);try{await Dp.promises.mkdir(Df.dirname(r),{recursive:!0}),await Dp.promises.writeFile(r,n)}catch(e){console.warn("An error occurred while writing the file to cache:",e)}}}async function DG(e,...t){for(let n of t)try{let t=await e.match(n);if(t)return t}catch(e){continue}}async function DW(e,t,n=!0,r={}){let i,s,a,o;if(!DD.allowLocalModels){if(r.local_files_only)throw Error("Invalid configuration detected: local models are disabled (`env.allowLocalModels=false`) but you have requested to only use local models (`local_files_only=true`).");if(!DD.allowRemoteModels)throw Error("Invalid configuration detected: both local and remote models are disabled. Fix by setting `env.allowLocalModels` or `env.allowRemoteModels` to `true`.")}if(Dt(r.progress_callback,{status:"initiate",name:e,file:t}),!i&&DD.useBrowserCache){if("undefined"==typeof caches)throw Error("Browser cache is not available in this environment.");try{i=await caches.open("transformers-cache")}catch(e){console.warn("An error occurred while opening the browser cache:",e)}}if(!i&&DD.useFSCache&&(i=new Dj(r.cache_dir??DD.cacheDir)),!i&&DD.useCustomCache){if(!DD.customCache)throw Error("`env.useCustomCache=true`, but `env.customCache` is not defined.");if(!DD.customCache.match||!DD.customCache.put)throw Error("`env.customCache` must be an object which implements the `match` and `put` functions of the Web Cache API. For more information, see https://developer.mozilla.org/en-US/docs/Web/API/Cache");i=DD.customCache}let l=r.revision??"main",u=DK(e,t),c=DK(DD.localModelPath,u),h=DK(DD.remoteHost,DD.remotePathTemplate.replaceAll("{model}",e).replaceAll("{revision}",encodeURIComponent(l)),t),d="main"===l?u:DK(e,l,t),p=i instanceof Dj?d:h,f=!1;i&&(a=await DG(i,c,p));let g=void 0!==a;if(void 0===a){if(DD.allowLocalModels){if(Dz(u,["http:","https:"])){if(r.local_files_only)throw Error(`\`local_files_only=true\`, but attempted to load a remote file from: ${u}.`);if(!DD.allowRemoteModels)throw Error(`\`env.allowRemoteModels=false\`, but attempted to load a remote file from: ${u}.`)}else try{a=await DB(c),s=c}catch(e){console.warn(`Unable to load from local path "${c}": "${e}"`)}}if(void 0===a||404===a.status){if(r.local_files_only||!DD.allowRemoteModels){if(!n)return null;throw Error(`\`local_files_only=true\` or \`env.allowRemoteModels=false\` and file was not found locally at "${c}".`)}if(200!==(a=await DB(h)).status)return DV(a.status,h,n);s=p}f=i&&"undefined"!=typeof Response&&a instanceof Response&&200===a.status}Dt(r.progress_callback,{status:"download",name:e,file:t});let m={status:"progress",name:e,file:t};return r.progress_callback?g&&"undefined"!=typeof navigator&&/firefox/i.test(navigator.userAgent)?(o=new Uint8Array(await a.arrayBuffer()),Dt(r.progress_callback,{...m,progress:100,loaded:o.length,total:o.length})):o=await DH(a,e=>{Dt(r.progress_callback,{...m,...e})}):o=new Uint8Array(await a.arrayBuffer()),f&&s&&await i.match(s)===void 0&&await i.put(s,new Response(o,{headers:a.headers})).catch(e=>{console.warn(`Unable to add response to browser cache: ${e}.`)}),Dt(r.progress_callback,{status:"done",name:e,file:t}),o}async function Dq(e,t,n=!0,r={}){let i=await DW(e,t,n,r);return null===i?{}:JSON.parse(new TextDecoder("utf-8").decode(i))}async function DH(e,t){let n=e.headers.get("Content-Length");null===n&&console.warn("Unable to determine content-length from response headers. Will expand buffer when needed.");let r=parseInt(n??"0"),i=new Uint8Array(r),s=0,a=e.body.getReader();async function o(){let{done:e,value:n}=await a.read();if(e)return;let l=s+n.length;if(l>r){let e=new Uint8Array(r=l);e.set(i),i=e}return i.set(n,s),t({progress:(s=l)/r*100,loaded:s,total:r}),o()}return await o(),i}function DK(...e){return(e=e.map((t,n)=>(n&&(t=t.replace(RegExp("^/"),"")),n!==e.length-1&&(t=t.replace(RegExp("/$"),"")),t))).join("/")}function DX(e,[t,n,r],[i,s],a="bilinear",o=!1){let l=s/r,u=i/n,c=new e.constructor(i*s*t),h=n*r,d=i*s;for(let a=0;a<i;++a)for(let i=0;i<s;++i){let o=a*s+i,p=(i+.5)/l-.5,f=(a+.5)/u-.5,g=Math.floor(p),m=Math.floor(f),y=Math.min(g+1,r-1),b=Math.min(m+1,n-1),v=p-(g=Math.max(g,0)),w=f-(m=Math.max(m,0)),_=(1-v)*(1-w),x=v*(1-w),T=(1-v)*w,I=v*w,k=m*r,S=b*r,E=k+g,C=k+y,A=S+g,N=S+y;for(let n=0;n<t;++n){let t=n*h;c[n*d+o]=_*e[t+E]+x*e[t+C]+T*e[t+A]+I*e[t+N]}}return c}function DY(e,t,n){let r=Array(n.length),i=Array(n.length);for(let e=n.length-1,s=1;e>=0;--e)i[e]=s,r[e]=t[n[e]],s*=r[e];let s=n.map((e,t)=>i[n.indexOf(t)]),a=new e.constructor(e.length);for(let n=0;n<e.length;++n){let r=0;for(let e=t.length-1,i=n;e>=0;--e)r+=i%t[e]*s[e],i=Math.floor(i/t[e]);a[r]=e[n]}return[a,r]}function DQ(e){let t=D1(e)[0],n=e.map(e=>Math.exp(e-t)),r=n.reduce((e,t)=>e+t,0);return n.map(e=>e/r)}function DJ(e){return DQ(e).map(e=>Math.log(e))}function DZ(e,t=0){return e=Array.from(e).map((e,t)=>[t,e]).sort((e,t)=>t[1]-e[1]),null!==t&&t>0&&(e=e.slice(0,t)),e}function D0(e){if(0===e.length)throw Error("Array must not be empty");let t=e[0],n=0;for(let r=1;r<e.length;++r)e[r]<t&&(t=e[r],n=r);return[t,n]}function D1(e){if(0===e.length)throw Error("Array must not be empty");let t=e[0],n=0;for(let r=1;r<e.length;++r)e[r]>t&&(t=e[r],n=r);return[Number(t),n]}function D2(e){return e>0&&(e&e-1)==0}class D3{constructor(e){if(this.size=0|e,this.size<=1||!D2(this.size))throw Error("FFT size must be a power of two larger than 1");this._csize=e<<1,this.table=new Float64Array(2*this.size);for(let e=0;e<this.table.length;e+=2){let t=Math.PI*e/this.size;this.table[e]=Math.cos(t),this.table[e+1]=-Math.sin(t)}let t=0;for(let e=1;this.size>e;e<<=1)++t;this._width=t%2==0?t-1:t,this._bitrev=new Int32Array(1<<this._width);for(let e=0;e<this._bitrev.length;++e){this._bitrev[e]=0;for(let t=0;t<this._width;t+=2){let n=this._width-t-2;this._bitrev[e]|=(e>>>t&3)<<n}}}createComplexArray(){return new Float64Array(this._csize)}fromComplexArray(e,t){let n=t||Array(e.length>>>1);for(let t=0;t<e.length;t+=2)n[t>>>1]=e[t];return n}toComplexArray(e,t){let n=t||this.createComplexArray();for(let t=0;t<n.length;t+=2)n[t]=e[t>>>1],n[t+1]=0;return n}transform(e,t){if(e===t)throw Error("Input and output buffers must be different");this._transform4(e,t,1)}realTransform(e,t){if(e===t)throw Error("Input and output buffers must be different");this._realTransform4(e,t,1)}inverseTransform(e,t){if(e===t)throw Error("Input and output buffers must be different");this._transform4(e,t,-1);for(let t=0;t<e.length;++t)e[t]/=this.size}_transform4(e,t,n){let r,i;let s=this._csize,a=1<<this._width,o=s/a<<1,l=this._bitrev;if(4===o)for(r=0,i=0;r<s;r+=o,++i){let n=l[i];this._singleTransform2(t,e,r,n,a)}else for(r=0,i=0;r<s;r+=o,++i){let s=l[i];this._singleTransform4(t,e,r,s,a,n)}let u=this.table;for(a>>=2;a>=2;a>>=2){let t=(o=s/a<<1)>>>2;for(r=0;r<s;r+=o){let i=r+t-1;for(let s=r,o=0;s<i;s+=2,o+=a){let r=s,i=r+t,a=i+t,l=a+t,c=e[r],h=e[r+1],d=e[i],p=e[i+1],f=e[a],g=e[a+1],m=e[l],y=e[l+1],b=u[o],v=n*u[o+1],w=d*b-p*v,_=d*v+p*b,x=u[2*o],T=n*u[2*o+1],I=f*x-g*T,k=f*T+g*x,S=u[3*o],E=n*u[3*o+1],C=m*S-y*E,A=m*E+y*S,N=c+I,O=h+k,$=c-I,R=h-k,D=w+C,F=_+A,P=n*(w-C),M=n*(_-A);e[r]=N+D,e[r+1]=O+F,e[i]=$+M,e[i+1]=R-P,e[a]=N-D,e[a+1]=O-F,e[l]=$-M,e[l+1]=R+P}}}}_singleTransform2(e,t,n,r,i){let s=e[r],a=e[r+1],o=e[r+i],l=e[r+i+1];t[n]=s+o,t[n+1]=a+l,t[n+2]=s-o,t[n+3]=a-l}_singleTransform4(e,t,n,r,i,s){let a=2*i,o=3*i,l=e[r],u=e[r+1],c=e[r+i],h=e[r+i+1],d=e[r+a],p=e[r+a+1],f=e[r+o],g=e[r+o+1],m=l+d,y=u+p,b=l-d,v=u-p,w=c+f,_=h+g,x=s*(c-f),T=s*(h-g);t[n]=m+w,t[n+1]=y+_,t[n+2]=b+T,t[n+3]=v-x,t[n+4]=m-w,t[n+5]=y-_,t[n+6]=b-T,t[n+7]=v+x}_realTransform4(e,t,n){let r,i;let s=this._csize,a=1<<this._width,o=s/a<<1,l=this._bitrev;if(4===o)for(r=0,i=0;r<s;r+=o,++i){let n=l[i];this._singleRealTransform2(t,e,r,n>>>1,a>>>1)}else for(r=0,i=0;r<s;r+=o,++i){let s=l[i];this._singleRealTransform4(t,e,r,s>>>1,a>>>1,n)}let u=this.table;for(a>>=2;a>=2;a>>=2){let t=(o=s/a<<1)>>>1,i=t>>>1,l=i>>>1;for(r=0;r<s;r+=o)for(let s=0,o=0;s<=l;s+=2,o+=a){let a=r+s,c=a+i,h=c+i,d=h+i,p=e[a],f=e[a+1],g=e[c],m=e[c+1],y=e[h],b=e[h+1],v=e[d],w=e[d+1],_=p,x=f,T=u[o],I=n*u[o+1],k=g*T-m*I,S=g*I+m*T,E=u[2*o],C=n*u[2*o+1],A=y*E-b*C,N=y*C+b*E,O=u[3*o],$=n*u[3*o+1],R=v*O-w*$,D=v*$+w*O,F=_+A,P=x+N,M=_-A,L=x-N,z=k+R,B=S+D,U=n*(k-R),V=n*(S-D);if(e[a]=F+z,e[a+1]=P+B,e[c]=M+V,e[c+1]=L-U,0===s){e[h]=F-z,e[h+1]=P-B;continue}if(s===l)continue;let j=r+i-s,G=r+t-s;e[j]=M-n*V,e[j+1]=-L-n*U,e[G]=F-n*z,e[G+1]=-P+n*B}}let c=s>>>1;for(let t=2;t<c;t+=2)e[s-t]=e[t],e[s-t+1]=-e[t+1]}_singleRealTransform2(e,t,n,r,i){let s=e[r],a=e[r+i];t[n]=s+a,t[n+1]=0,t[n+2]=s-a,t[n+3]=0}_singleRealTransform4(e,t,n,r,i,s){let a=2*i,o=3*i,l=e[r],u=e[r+i],c=e[r+a],h=e[r+o],d=l+c,p=l-c,f=u+h,g=s*(u-h);t[n]=d+f,t[n+1]=0,t[n+2]=p,t[n+3]=-g,t[n+4]=d-f,t[n+5]=0,t[n+6]=p,t[n+7]=g}}class D4{constructor(e){let t=2*(e-1),n=2*(2*e-1),r=2**Math.ceil(Math.log2(n));this.bufferSize=r,this._a=t;let i=new Float64Array(n),s=new Float64Array(r);this._chirpBuffer=new Float64Array(r),this._buffer1=new Float64Array(r),this._buffer2=new Float64Array(r),this._outBuffer1=new Float64Array(r),this._outBuffer2=new Float64Array(r);let a=-2*Math.PI/e,o=Math.cos(a),l=Math.sin(a);for(let t=0;t<n>>1;++t){let n=(t+1-e)**2/2,r=Math.sqrt(o**2+l**2)**n,a=n*Math.atan2(l,o),u=2*t;i[u]=r*Math.cos(a),i[u+1]=r*Math.sin(a),s[u]=i[u],s[u+1]=-i[u+1]}this._slicedChirpBuffer=i.subarray(t,n),this._f=new D3(r>>1),this._f.transform(this._chirpBuffer,s)}_transform(e,t,n){let r=this._buffer1,i=this._buffer2,s=this._outBuffer1,a=this._outBuffer2,o=this._chirpBuffer,l=this._slicedChirpBuffer,u=this._a;if(n)for(let e=0;e<l.length;e+=2){let n=e+1,i=t[e>>1];r[e]=i*l[e],r[n]=i*l[n]}else for(let e=0;e<l.length;e+=2){let n=e+1;r[e]=t[e]*l[e]-t[n]*l[n],r[n]=t[e]*l[n]+t[n]*l[e]}this._f.transform(s,r);for(let e=0;e<o.length;e+=2){let t=e+1;i[e]=s[e]*o[e]-s[t]*o[t],i[t]=s[e]*o[t]+s[t]*o[e]}this._f.inverseTransform(a,i);for(let t=0;t<a.length;t+=2){let n=a[t+u],r=a[t+u+1],i=l[t],s=l[t+1];e[t]=n*i-r*s,e[t+1]=n*s+r*i}}transform(e,t){this._transform(e,t,!1)}realTransform(e,t){this._transform(e,t,!0)}}class D6{constructor(e){this.fft_length=e,this.isPowerOfTwo=D2(e),this.isPowerOfTwo?(this.fft=new D3(e),this.outputBufferSize=2*e):(this.fft=new D4(e),this.outputBufferSize=this.fft.bufferSize)}realTransform(e,t){this.fft.realTransform(e,t)}transform(e,t){this.fft.transform(e,t)}}function D5(e,t){if(t%2==0||t<=0)throw Error("Window size must be a positive odd number");let n=new e.constructor(e.length),r=new e.constructor(t),i=Math.floor(t/2);for(let t=0;t<e.length;++t){let s=0;for(let n=-i;n<=i;++n){let i=t+n;i<0?i=Math.abs(i):i>=e.length&&(i=2*(e.length-1)-i),r[s++]=e[i]}r.sort(),n[t]=r[i]}return n}function D8(e,t){let n=Math.pow(10,t);return Math.round(e*n)/n}function D7(e){let t=Math.round(e);return Math.abs(e)%1==.5?t%2==0?t:t-1:t}let D9=Object.freeze({float32:Float32Array,float64:Float64Array,string:Array,int8:Int8Array,uint8:Uint8Array,int16:Int16Array,uint16:Uint16Array,int32:Int32Array,uint32:Uint32Array,int64:BigInt64Array,uint64:BigUint64Array,bool:Uint8Array}),Fe=c.Tensor;class Ft{dims;type;data;size;constructor(...e){return e[0]instanceof Fe?Object.assign(this,e[0]):Object.assign(this,new Fe(e[0],e[1],e[2])),new Proxy(this,{get:(e,t)=>{if("string"==typeof t){let n=Number(t);if(Number.isInteger(n))return e._getitem(n)}return e[t]},set:(e,t,n)=>e[t]=n})}*[Symbol.iterator](){let[e,...t]=this.dims;if(t.length>0){let n=t.reduce((e,t)=>e*t);for(let r=0;r<e;++r)yield this._subarray(r,n,t)}else yield*this.data}_getitem(e){let[t,...n]=this.dims;if(e=Fl(e,t),!(n.length>0))return new Ft(this.type,[this.data[e]],n);{let t=n.reduce((e,t)=>e*t);return this._subarray(e,t,n)}}indexOf(e){for(let t=0;t<this.data.length;++t)if(this.data[t]==e)return t;return -1}_subarray(e,t,n){let r=e*t,i=(e+1)*t,s="subarray"in this.data?this.data.subarray(r,i):this.data.slice(r,i);return new Ft(this.type,s,n)}item(){if(1!==this.data.length)throw Error(`a Tensor with ${this.data.length} elements cannot be converted to Scalar`);return this.data[0]}tolist(){return Fn(this.data,this.dims)}sigmoid(){return this.clone().sigmoid_()}sigmoid_(){for(let e=0;e<this.data.length;++e)this.data[e]=1/(1+Math.exp(-this.data[e]));return this}mul(e){return this.clone().mul_(e)}mul_(e){for(let t=0;t<this.data.length;++t)this.data[t]*=e;return this}add(e){return this.clone().add_(e)}add_(e){for(let t=0;t<this.data.length;++t)this.data[t]+=e;return this}clone(){return new Ft(this.type,this.data.slice(),this.dims.slice())}slice(...e){let t=[],n=[];for(let r=0;r<this.dims.length;++r){let i=e[r];if(null==i)n.push([0,this.dims[r]]),t.push(this.dims[r]);else if("number"==typeof i)i=Fl(i,this.dims[r],r),n.push([i,i+1]);else if(Array.isArray(i)&&2===i.length){if(i[0]>i[1])throw Error(`Invalid slice: ${i}`);let e=[Math.max(i[0],0),Math.min(i[1],this.dims[r])];n.push(e),t.push(e[1]-e[0])}else throw Error(`Invalid slice: ${i}`)}let r=n.map(([e,t])=>t-e),i=r.reduce((e,t)=>e*t),s=new this.data.constructor(i),a=this.stride();for(let e=0;e<i;++e){let t=0;for(let i=r.length-1,s=e;i>=0;--i){let e=r[i];t+=(s%e+n[i][0])*a[i],s=Math.floor(s/e)}s[e]=this.data[t]}return new Ft(this.type,s,t)}permute(...e){return Fr(this,e)}transpose(...e){return this.permute(...e)}sum(e=null,t=!1){return this.norm(1,e,t)}norm(e="fro",t=null,n=!1){if("fro"===e)e=2;else if("string"==typeof e)throw Error(`Unsupported norm: ${e}`);if(null===t){let t=this.data.reduce((t,n)=>t+n**e,0)**(1/e);return new Ft(this.type,[t],[])}t=Fl(t,this.dims.length);let r=this.dims.slice();r[t]=1;let i=new this.data.constructor(this.data.length/this.dims[t]);for(let n=0;n<this.data.length;++n){let s=0;for(let e=this.dims.length-1,i=n,a=1;e>=0;--e){let n=this.dims[e];e!==t&&(s+=i%n*a,a*=r[e]),i=Math.floor(i/n)}i[s]+=this.data[n]**e}if(1!==e)for(let t=0;t<i.length;++t)i[t]=i[t]**(1/e);return n||r.splice(t,1),new Ft(this.type,i,r)}normalize_(e=2,t=1){t=Fl(t,this.dims.length);let n=this.norm(e,t,!0);for(let e=0;e<this.data.length;++e){let r=0;for(let n=this.dims.length-1,i=e,s=1;n>=0;--n){let e=this.dims[n];n!==t&&(r+=i%e*s,s*=this.dims[n]),i=Math.floor(i/e)}this.data[e]/=n.data[r]}return this}normalize(e=2,t=1){return this.clone().normalize_(e,t)}stride(){return Ff(this.dims)}squeeze(e=null){return new Ft(this.type,this.data,Fa(this.dims,e))}squeeze_(e=null){return this.dims=Fa(this.dims,e),this}unsqueeze(e=null){return new Ft(this.type,this.data,Fo(this.dims,e))}unsqueeze_(e=null){return this.dims=Fo(this.dims,e),this}flatten_(e=0,t=-1){t=(t+this.dims.length)%this.dims.length;let n=this.dims.slice(0,e),r=this.dims.slice(e,t+1),i=this.dims.slice(t+1);return this.dims=[...n,r.reduce((e,t)=>e*t,1),...i],this}flatten(e=0,t=-1){return this.clone().flatten_(e,t)}view(...e){let t=-1;for(let n=0;n<e.length;++n)if(-1===e[n]){if(-1!==t)throw Error("Only one dimension can be inferred");t=n}if(-1!==t){let n=e.reduce((e,n,r)=>r!==t?e*n:e,1);e[t]=this.data.length/n}return new Ft(this.type,this.data,e)}neg_(){for(let e=0;e<this.data.length;++e)this.data[e]=-this.data[e];return this}neg(){return this.clone().neg_()}clamp_(e,t){for(let n=0;n<this.data.length;++n)this.data[n]=Math.min(Math.max(this.data[n],e),t);return this}clamp(e,t){return this.clone().clamp_(e,t)}round_(){for(let e=0;e<this.data.length;++e)this.data[e]=Math.round(this.data[e]);return this}round(){return this.clone().round_()}to(e){if(this.type===e)return this;if(!D9.hasOwnProperty(e))throw Error(`Unsupported type: ${e}`);return new Ft(e,D9[e].from(this.data),this.dims)}}function Fn(e,t){let n=e.length;if(n!==t.reduce((e,t)=>e*t))throw Error(`cannot reshape array of size ${n} into shape (${t})`);let r=e;for(let e=t.length-1;e>=0;e--)r=r.reduce((n,r)=>{let i=n[n.length-1];return i.length<t[e]?i.push(r):n.push([r]),n},[[]]);return r[0]}function Fr(e,t){let[n,r]=DY(e.data,e.dims,t);return new Ft(e.type,n,r)}function Fi(e,[t,n],r="bilinear",i=!1){let s=e.dims.at(-3)??1,a=e.dims.at(-2),o=e.dims.at(-1),l=DX(e.data,[s,a,o],[t,n],r,i);return new Ft(e.type,l,[s,t,n])}function Fs(e,t){let n=[e.dims[0],e.dims[2]],r=new e.data.constructor(n[0]*n[1]),[i,s,a]=e.dims,o=0;for(let n=0;n<i;++n){let i=n*a*s;for(let l=0;l<a;++l){let u=0,c=0,h=n*s,d=i+l;for(let n=0;n<s;++n){let r=Number(t.data[h+n]);c+=r,u+=e.data[d+n*a]*r}let p=u/c;r[o++]=p}}return new Ft(e.type,r,n)}function Fa(e,t){return e=e.slice(),null===t?e=e.filter(e=>1!==e):"number"==typeof t?1===e[t]&&e.splice(t,1):Array.isArray(t)&&(e=e.filter((e,n)=>1!==e||!t.includes(n))),e}function Fo(e,t){return t=Fl(t,e.length+1),(e=e.slice()).splice(t,0,1),e}function Fl(e,t,n=null){if(e<-t||e>=t)throw Error(`IndexError: index ${e} is out of bounds for dimension${null===n?"":" "+n} with size ${t}`);return e<0&&(e=(e%t+t)%t),e}function Fu(e,t=0){t=Fl(t,e[0].dims.length);let n=e[0].dims.slice();n[t]=e.reduce((e,n)=>e+n.dims[t],0);let r=n.reduce((e,t)=>e*t,1),i=new e[0].data.constructor(r),s=e[0].type;if(0===t){let t=0;for(let n of e)i.set(n.data,t),t+=n.data.length}else{let r=0;for(let s=0;s<e.length;++s){let a=e[s];for(let e=0;e<a.data.length;++e){let s=0;for(let i=a.dims.length-1,o=e,l=1;i>=0;--i){let e=a.dims[i],u=o%e;i===t&&(u+=r),s+=u*l,l*=n[i],o=Math.floor(o/e)}i[s]=a.data[e]}r+=a.dims[t]}}return new Ft(s,i,n)}function Fc(e,t=0){return Fu(e.map(e=>e.unsqueeze(t)),t)}function Fh(e,t=null,n=1,r=!1){if(null===t){let t=e.data.reduce((e,t)=>e+t,0)/e.data.length,r=Math.sqrt(e.data.reduce((e,n)=>e+(n-t)**2,0)/(e.data.length-n)),i=new Ft(e.type,[t],[]);return[new Ft(e.type,[r],[]),i]}t=Fl(t,e.dims.length);let i=Fd(e,t,r),s=e.dims.slice();s[t]=1;let a=new e.data.constructor(e.data.length/e.dims[t]);for(let n=0;n<e.data.length;++n){let r=0;for(let i=e.dims.length-1,a=n,o=1;i>=0;--i){let n=e.dims[i];i!==t&&(r+=a%n*o,o*=s[i]),a=Math.floor(a/n)}a[r]+=(e.data[n]-i.data[r])**2}for(let r=0;r<a.length;++r)a[r]=Math.sqrt(a[r]/(e.dims[t]-n));return r||s.splice(t,1),[new Ft(e.type,a,s),i]}function Fd(e,t=null,n=!1){if(null===t){let t=e.data.reduce((e,t)=>e+t,0);return new Ft(e.type,[t/e.data.length],[])}t=Fl(t,e.dims.length);let r=e.dims.slice();r[t]=1;let i=new e.data.constructor(e.data.length/e.dims[t]);for(let n=0;n<e.data.length;++n){let s=0;for(let i=e.dims.length-1,a=n,o=1;i>=0;--i){let n=e.dims[i];i!==t&&(s+=a%n*o,o*=r[i]),a=Math.floor(a/n)}i[s]+=e.data[n]}if(1!==e.dims[t])for(let n=0;n<i.length;++n)i[n]=i[n]/e.dims[t];return n||r.splice(t,1),new Ft(e.type,i,r)}function Fp(e){let[t,n]=e.dims,r=[t+1,n+1],i=new Ft("float32",new Float32Array(r[0]*r[1]).fill(1/0),r),s=new Ft("float32",new Float32Array(r[0]*r[1]).fill(-1),r);i[0].data[0]=0;for(let r=1;r<n+1;++r)for(let n=1;n<t+1;++n){let t,a;let o=i[n-1][r-1].item(),l=i[n-1][r].item(),u=i[n][r-1].item();o<l&&o<u?(t=o,a=0):l<o&&l<u?(t=l,a=1):(t=u,a=2),i[n].data[r]=e[n-1][r-1].item()+t,s[n].data[r]=a}let a=t,o=n;s.data.fill(2,0,r[1]);for(let e=0;e<r[0];++e)s[e].data[0]=1;let l=[],u=[];for(;a>0||o>0;)switch(l.push(a-1),u.push(o-1),s[a][o].item()){case 0:--a,--o;break;case 1:--a;break;case 2:--o;break;default:throw Error(`Internal error in dynamic time warping. Unexpected trace[${a}, ${o}]. Please file a bug report.`)}return l.reverse(),u.reverse(),[l,u]}function Ff(e){let t=Array(e.length);for(let n=e.length-1,r=1;n>=0;--n)t[n]=r,r*=e[n];return t}function Fg(e){return new Ft("int64",new BigInt64Array(e.reduce((e,t)=>e*t,1)).fill(1n),e)}function Fm(e){return Fg(e.dims)}function Fy(e,t){if(2!==e.dims.length)throw Error("The tensor must have 2 dimensions");if(e.dims.at(-1)%8!=0)throw Error("The last dimension of the tensor must be a multiple of 8");if(!["binary","ubinary"].includes(t))throw Error("The precision must be either 'binary' or 'ubinary'");let n="binary"===t,r=n?"int8":"uint8",i=n?Int8Array:Uint8Array,s=e.data,a=new i(s.length/8);for(let e=0;e<s.length;++e){let t=s[e]>0?1:0,r=Math.floor(e/8),i=e%8;a[r]|=t<<7-i,n&&0===i&&(a[r]-=128)}return new Ft(r,a,[e.dims[0],e.dims[1]/8])}class Fb{constructor(e=(e,t)=>e>t){this._heap=[],this._comparator=e}get size(){return this._heap.length}isEmpty(){return 0===this.size}peek(){return this._heap[0]}push(...e){return this.extend(e)}extend(e){for(let t of e)this._heap.push(t),this._siftUp();return this.size}pop(){let e=this.peek(),t=this.size-1;return t>0&&this._swap(0,t),this._heap.pop(),this._siftDown(),e}replace(e){let t=this.peek();return this._heap[0]=e,this._siftDown(),t}_parent(e){return(e+1>>>1)-1}_left(e){return(e<<1)+1}_right(e){return e+1<<1}_greater(e,t){return this._comparator(this._heap[e],this._heap[t])}_swap(e,t){let n=this._heap[e];this._heap[e]=this._heap[t],this._heap[t]=n}_siftUp(){let e=this.size-1;for(;e>0&&this._greater(e,this._parent(e));)this._swap(e,this._parent(e)),e=this._parent(e)}_siftDown(){let e=0;for(;this._left(e)<this.size&&this._greater(this._left(e),e)||this._right(e)<this.size&&this._greater(this._right(e),e);){let t=this._right(e)<this.size&&this._greater(this._right(e),this._left(e))?this._right(e):this._left(e);this._swap(e,t),e=t}}}class Fv{constructor(){this.root=Fw.default()}extend(e){for(let t of e)this.push(t)}push(e){let t=this.root;for(let n of e){let e=t.children.get(n);void 0===e&&(e=Fw.default(),t.children.set(n,e)),t=e}t.isLeaf=!0}*commonPrefixSearch(e){let t=this.root,n="";for(let r=0;r<e.length&&void 0!==t;++r){let i=e[r];n+=i,void 0!==(t=t.children.get(i))&&t.isLeaf&&(yield n)}}}class Fw{constructor(e,t){this.isLeaf=e,this.children=t}static default(){return new Fw(!1,new Map)}}class F_{constructor(e,t,n){this.sentence=e,this.len=e.length,this.bosTokenId=t,this.eosTokenId=n,this.nodes=[],this.beginNodes=Array.from({length:this.len+1},()=>[]),this.endNodes=Array.from({length:this.len+1},()=>[]);let r=new Fx(this.bosTokenId,0,0,0,0),i=new Fx(this.eosTokenId,1,this.len,0,0);this.nodes.push(r.clone()),this.nodes.push(i.clone()),this.beginNodes[this.len].push(i),this.endNodes[0].push(r)}insert(e,t,n,r){let i=new Fx(r,this.nodes.length,e,t,n);this.beginNodes[e].push(i),this.endNodes[e+t].push(i),this.nodes.push(i)}viterbi(){let e=this.len,t=0;for(;t<=e;){if(0==this.beginNodes[t].length)return[];for(let e of this.beginNodes[t]){e.prev=null;let n=0,r=null;for(let i of this.endNodes[t]){let t=i.backtraceScore+e.score;(null===r||t>n)&&(r=i.clone(),n=t)}if(null===r)return[];e.prev=r,e.backtraceScore=n}++t}let n=[],r=this.beginNodes[e][0].prev;if(null===r)return[];let i=r.clone();for(;null!==i.prev;)n.push(i.clone()),i=i.clone().prev.clone();return n.reverse(),n}piece(e){return this.sentence.slice(e.pos,e.pos+e.length)}tokens(){return this.viterbi().map(e=>this.piece(e))}tokenIds(){return this.viterbi().map(e=>e.tokenId)}}class Fx{constructor(e,t,n,r,i){this.tokenId=e,this.nodeId=t,this.pos=n,this.length=r,this.score=i,this.prev=null,this.backtraceScore=0}clone(){let e=new Fx(this.tokenId,this.nodeId,this.pos,this.length,this.score);return e.prev=this.prev,e.backtraceScore=this.backtraceScore,e}}var FT=Object.freeze({Text:"Text",NumericLiteral:"NumericLiteral",BooleanLiteral:"BooleanLiteral",StringLiteral:"StringLiteral",Identifier:"Identifier",Equals:"Equals",OpenParen:"OpenParen",CloseParen:"CloseParen",OpenStatement:"OpenStatement",CloseStatement:"CloseStatement",OpenExpression:"OpenExpression",CloseExpression:"CloseExpression",OpenSquareBracket:"OpenSquareBracket",CloseSquareBracket:"CloseSquareBracket",OpenCurlyBracket:"OpenCurlyBracket",CloseCurlyBracket:"CloseCurlyBracket",Comma:"Comma",Dot:"Dot",Colon:"Colon",Pipe:"Pipe",CallOperator:"CallOperator",AdditiveBinaryOperator:"AdditiveBinaryOperator",MultiplicativeBinaryOperator:"MultiplicativeBinaryOperator",ComparisonBinaryOperator:"ComparisonBinaryOperator",UnaryOperator:"UnaryOperator",Set:"Set",If:"If",For:"For",In:"In",Is:"Is",NotIn:"NotIn",Else:"Else",EndIf:"EndIf",ElseIf:"ElseIf",EndFor:"EndFor",And:"And",Or:"Or",Not:"UnaryOperator"}),FI=Object.freeze({set:FT.Set,for:FT.For,in:FT.In,is:FT.Is,if:FT.If,else:FT.Else,endif:FT.EndIf,elif:FT.ElseIf,endfor:FT.EndFor,and:FT.And,or:FT.Or,not:FT.Not,"not in":FT.NotIn,true:FT.BooleanLiteral,false:FT.BooleanLiteral}),Fk=class{constructor(e,t){this.value=e,this.type=t}};function FS(e){return/\w/.test(e)}function FE(e){return/[0-9]/.test(e)}var FC=[["{%",FT.OpenStatement],["%}",FT.CloseStatement],["{{",FT.OpenExpression],["}}",FT.CloseExpression],["(",FT.OpenParen],[")",FT.CloseParen],["{",FT.OpenCurlyBracket],["}",FT.CloseCurlyBracket],["[",FT.OpenSquareBracket],["]",FT.CloseSquareBracket],[",",FT.Comma],[".",FT.Dot],[":",FT.Colon],["|",FT.Pipe],["<=",FT.ComparisonBinaryOperator],[">=",FT.ComparisonBinaryOperator],["==",FT.ComparisonBinaryOperator],["!=",FT.ComparisonBinaryOperator],["<",FT.ComparisonBinaryOperator],[">",FT.ComparisonBinaryOperator],["+",FT.AdditiveBinaryOperator],["-",FT.AdditiveBinaryOperator],["*",FT.MultiplicativeBinaryOperator],["/",FT.MultiplicativeBinaryOperator],["%",FT.MultiplicativeBinaryOperator],["=",FT.Equals]],FA=new Map([["n","\n"],["t","	"],["r","\r"],["b","\b"],["f","\f"],["v","\v"],["'","'"],['"','"'],["\\","\\"]]);function FN(e,t={}){return e.endsWith("\n")&&(e=e.slice(0,-1)),e=e.replace(/{#.*?#}/gs,"{##}"),t.lstrip_blocks&&(e=e.replace(/^[ \t]*({[#%])/gm,"$1")),t.trim_blocks&&(e=e.replace(/([#%]})\n/g,"$1")),e.replace(/{##}/g,"").replace(/-%}\s*/g,"%}").replace(/\s*{%-/g,"{%").replace(/-}}\s*/g,"}}").replace(/\s*{{-/g,"{{")}function FO(e,t={}){let n=[],r=FN(e,t),i=0,s=e=>{let t="";for(;e(r[i]);){if("\\"===r[i]){if(++i>=r.length)throw SyntaxError("Unexpected end of input");let e=r[i++],n=FA.get(e);if(void 0===n)throw SyntaxError(`Unexpected escaped character: ${e}`);t+=n;continue}if(t+=r[i++],i>=r.length)throw SyntaxError("Unexpected end of input")}return t};r:for(;i<r.length;){let e=n.at(-1)?.type;if(void 0===e||e===FT.CloseStatement||e===FT.CloseExpression){let e="";for(;i<r.length&&!("{"===r[i]&&("%"===r[i+1]||"{"===r[i+1]));)e+=r[i++];if(e.length>0){n.push(new Fk(e,FT.Text));continue}}s(e=>/\s/.test(e));let t=r[i];if("-"===t||"+"===t){let e=n.at(-1)?.type;if(e===FT.Text||void 0===e)throw SyntaxError(`Unexpected character: ${t}`);switch(e){case FT.Identifier:case FT.NumericLiteral:case FT.BooleanLiteral:case FT.StringLiteral:case FT.CloseParen:case FT.CloseSquareBracket:break;default:{++i;let e=s(FE);n.push(new Fk(`${t}${e}`,e.length>0?FT.NumericLiteral:FT.UnaryOperator));continue}}}for(let[e,t]of FC)if(r.slice(i,i+e.length)===e){n.push(new Fk(e,t)),i+=e.length;continue r}if("'"===t||'"'===t){++i;let e=s(e=>e!==t);n.push(new Fk(e,FT.StringLiteral)),++i;continue}if(FE(t)){let e=s(FE);n.push(new Fk(e,FT.NumericLiteral));continue}if(FS(t)){let e=s(FS),t=Object.hasOwn(FI,e)?FI[e]:FT.Identifier;t===FT.In&&n.at(-1)?.type===FT.Not?(n.pop(),n.push(new Fk("not in",FT.NotIn))):n.push(new Fk(e,t));continue}throw SyntaxError(`Unexpected character: ${t}`)}return n}var F$=class{type="Statement"},FR=class extends F${constructor(e){super(),this.body=e}type="Program"},FD=class extends F${constructor(e,t,n){super(),this.test=e,this.body=t,this.alternate=n}type="If"},FF=class extends F${constructor(e,t,n){super(),this.loopvar=e,this.iterable=t,this.body=n}type="For"},FP=class extends F${constructor(e,t){super(),this.assignee=e,this.value=t}type="Set"},FM=class extends F${type="Expression"},FL=class extends FM{constructor(e,t,n){super(),this.object=e,this.property=t,this.computed=n}type="MemberExpression"},Fz=class extends FM{constructor(e,t){super(),this.callee=e,this.args=t}type="CallExpression"},FB=class extends FM{constructor(e){super(),this.value=e}type="Identifier"},FU=class extends FM{constructor(e){super(),this.value=e}type="Literal"},FV=class extends FU{type="NumericLiteral"},Fj=class extends FU{type="StringLiteral"},FG=class extends FU{type="BooleanLiteral"},FW=class extends FU{type="ArrayLiteral"},Fq=class extends FU{type="TupleLiteral"},FH=class extends FU{type="ObjectLiteral"},FK=class extends FM{constructor(e,t,n){super(),this.operator=e,this.left=t,this.right=n}type="BinaryExpression"},FX=class extends FM{constructor(e,t){super(),this.operand=e,this.filter=t}type="FilterExpression"},FY=class extends FM{constructor(e,t,n){super(),this.operand=e,this.negate=t,this.test=n}type="TestExpression"},FQ=class extends FM{constructor(e,t){super(),this.operator=e,this.argument=t}type="UnaryExpression"},FJ=class extends FM{constructor(e,t,n){super(),this.start=e,this.stop=t,this.step=n}type="SliceExpression"},FZ=class extends FM{constructor(e,t){super(),this.key=e,this.value=t}type="KeywordArgumentExpression"};function F0(e){let t=new FR([]),n=0;function r(t,r){let i=e[n++];if(!i||i.type!==t)throw Error(`Parser Error: ${r}. ${i.type} !== ${t}.`);return i}function i(){switch(e[n].type){case FT.Text:return o();case FT.OpenStatement:return l();case FT.OpenExpression:return u();default:throw SyntaxError(`Unexpected token type: ${e[n].type}`)}}function s(...t){return n+t.length<=e.length&&t.some((t,r)=>t!==e[n+r].type)}function a(...t){return n+t.length<=e.length&&t.every((t,r)=>t===e[n+r].type)}function o(){return new Fj(r(FT.Text,"Expected text token").value)}function l(){let t;switch(r(FT.OpenStatement,"Expected opening statement token"),e[n].type){case FT.Set:++n,t=c(),r(FT.CloseStatement,"Expected closing statement token");break;case FT.If:++n,t=h(),r(FT.OpenStatement,"Expected {% token"),r(FT.EndIf,"Expected endif token"),r(FT.CloseStatement,"Expected %} token");break;case FT.For:++n,t=p(),r(FT.OpenStatement,"Expected {% token"),r(FT.EndFor,"Expected endfor token"),r(FT.CloseStatement,"Expected %} token");break;default:throw SyntaxError(`Unknown statement type: ${e[n].type}`)}return t}function u(){r(FT.OpenExpression,"Expected opening expression token");let e=f();return r(FT.CloseExpression,"Expected closing expression token"),e}function c(){let e=f();return a(FT.Equals)?(++n,new FP(e,c())):e}function h(){let t=f();r(FT.CloseStatement,"Expected closing statement token");let s=[],o=[];for(;!(e[n]?.type===FT.OpenStatement&&(e[n+1]?.type===FT.ElseIf||e[n+1]?.type===FT.Else||e[n+1]?.type===FT.EndIf));)s.push(i());if(e[n]?.type===FT.OpenStatement&&e[n+1]?.type!==FT.EndIf){if(++n,a(FT.ElseIf))r(FT.ElseIf,"Expected elseif token"),o.push(h());else for(r(FT.Else,"Expected else token"),r(FT.CloseStatement,"Expected closing statement token");!(e[n]?.type===FT.OpenStatement&&e[n+1]?.type===FT.EndIf);)o.push(i())}return new FD(t,s,o)}function d(e=!1){let t=e?N:f,r=[t()],i=a(FT.Comma);for(;i&&(++n,r.push(t()),a(FT.Comma)););return i?new Fq(r):r[0]}function p(){let e=d(!0);if(!(e instanceof FB||e instanceof Fq))throw SyntaxError(`Expected identifier/tuple for the loop variable, got ${e.type} instead`);r(FT.In,"Expected `in` keyword following loop variable");let t=f();r(FT.CloseStatement,"Expected closing statement token");let n=[];for(;s(FT.OpenStatement,FT.EndFor);)n.push(i());return new FF(e,t,n)}function f(){return g()}function g(){let e=m();if(a(FT.If)){++n;let t=m();return r(FT.Else,"Expected else token"),new FD(t,[e],[m()])}return e}function m(){let t=y();for(;a(FT.Or);){let r=e[n];++n,t=new FK(r,t,y())}return t}function y(){let t=b();for(;a(FT.And);){let r=e[n];++n,t=new FK(r,t,b())}return t}function b(){let t;for(;a(FT.Not);){let r=e[n];++n,t=new FQ(r,b())}return t??v()}function v(){let t=w();for(;a(FT.ComparisonBinaryOperator)||a(FT.In)||a(FT.NotIn);){let r=e[n];++n,t=new FK(r,t,w())}return t}function w(){let t=E();for(;a(FT.AdditiveBinaryOperator);){let r=e[n];++n,t=new FK(r,t,E())}return t}function _(){let e=S();return a(FT.OpenParen)?x(e):e}function x(e){let t=new Fz(e,T());return a(FT.OpenParen)&&(t=x(t)),t}function T(){r(FT.OpenParen,"Expected opening parenthesis for arguments list");let e=I();return r(FT.CloseParen,"Expected closing parenthesis for arguments list"),e}function I(){let e=[];for(;!a(FT.CloseParen);){let t=f();if(a(FT.Equals)){if(++n,!(t instanceof FB))throw SyntaxError("Expected identifier for keyword argument");t=new FZ(t,f())}e.push(t),a(FT.Comma)&&++n}return e}function k(){let e=[],t=!1;for(;!a(FT.CloseSquareBracket);)a(FT.Colon)?(e.push(void 0),++n,t=!0):(e.push(f()),a(FT.Colon)&&(++n,t=!0));if(0===e.length)throw SyntaxError("Expected at least one argument for member/slice expression");if(t){if(e.length>3)throw SyntaxError("Expected 0-3 arguments for slice expression");return new FJ(...e)}return e[0]}function S(){let t=N();for(;a(FT.Dot)||a(FT.OpenSquareBracket);){let i;let s=e[n];++n;let a=s.type!==FT.Dot;if(a)i=k(),r(FT.CloseSquareBracket,"Expected closing square bracket");else if("Identifier"!==(i=N()).type)throw SyntaxError("Expected identifier following dot operator");t=new FL(t,i,a)}return t}function E(){let t=C();for(;a(FT.MultiplicativeBinaryOperator);){let r=e[n];++n,t=new FK(r,t,C())}return t}function C(){let e=A();for(;a(FT.Is);){++n;let t=a(FT.Not);t&&++n;let r=N();if(r instanceof FG&&(r=new FB(r.value.toString())),!(r instanceof FB))throw SyntaxError("Expected identifier for the test");e=new FY(e,t,r)}return e}function A(){let e=_();for(;a(FT.Pipe);){++n;let t=N();if(!(t instanceof FB))throw SyntaxError("Expected identifier for the filter");a(FT.OpenParen)&&(t=x(t)),e=new FX(e,t)}return e}function N(){let t=e[n];switch(t.type){case FT.NumericLiteral:return++n,new FV(Number(t.value));case FT.StringLiteral:return++n,new Fj(t.value);case FT.BooleanLiteral:return++n,new FG("true"===t.value);case FT.Identifier:return++n,new FB(t.value);case FT.OpenParen:{++n;let t=d();if(e[n].type!==FT.CloseParen)throw SyntaxError(`Expected closing parenthesis, got ${e[n].type} instead`);return++n,t}case FT.OpenSquareBracket:{++n;let e=[];for(;!a(FT.CloseSquareBracket);)e.push(f()),a(FT.Comma)&&++n;return++n,new FW(e)}case FT.OpenCurlyBracket:{++n;let e=new Map;for(;!a(FT.CloseCurlyBracket);){let t=f();r(FT.Colon,"Expected colon between key and value in object literal");let i=f();e.set(t,i),a(FT.Comma)&&++n}return++n,new FH(e)}default:throw SyntaxError(`Unexpected token: ${t.type}`)}}for(;n<e.length;)t.body.push(i());return t}function F1(e,t,n=1){void 0===t&&(t=e,e=0);let r=[];for(let i=e;i<t;i+=n)r.push(i);return r}function F2(e,t,n,r=1){let i=Math.sign(r);i>=0?(t=(t??=0)<0?Math.max(e.length+t,0):Math.min(t,e.length),n=(n??=e.length)<0?Math.max(e.length+n,0):Math.min(n,e.length)):(t=(t??=e.length-1)<0?Math.max(e.length+t,-1):Math.min(t,e.length-1),n=(n??=-1)<-1?Math.max(e.length+n,-1):Math.min(n,e.length-1));let s=[];for(let a=t;i*a<i*n;a+=r)s.push(e[a]);return s}function F3(e){return e.replace(/\b\w/g,e=>e.toUpperCase())}var F4=class{type="RuntimeValue";value;builtins=new Map;constructor(e){this.value=e}__bool__(){return new F8(!!this.value)}},F6=class extends F4{type="NumericValue"},F5=class extends F4{type="StringValue";builtins=new Map([["upper",new Pt(()=>new F5(this.value.toUpperCase()))],["lower",new Pt(()=>new F5(this.value.toLowerCase()))],["strip",new Pt(()=>new F5(this.value.trim()))],["title",new Pt(()=>new F5(F3(this.value)))],["length",new F6(this.value.length)]])},F8=class extends F4{type="BooleanValue"},F7=class extends F4{type="ObjectValue";__bool__(){return new F8(this.value.size>0)}builtins=new Map([["get",new Pt(([e,t])=>{if(!(e instanceof F5))throw Error(`Object key must be a string: got ${e.type}`);return this.value.get(e.value)??t??new Pn})],["items",new Pt(()=>new F9(Array.from(this.value.entries()).map(([e,t])=>new F9([new F5(e),t]))))]])},F9=class extends F4{type="ArrayValue";builtins=new Map([["length",new F6(this.value.length)]]);__bool__(){return new F8(this.value.length>0)}},Pe=class extends F9{type="TupleValue"},Pt=class extends F4{type="FunctionValue"},Pn=class extends F4{type="NullValue"},Pr=class extends F4{type="UndefinedValue"},Pi=class{constructor(e){this.parent=e}variables=new Map([["namespace",new Pt(e=>{if(0===e.length)return new F7(new Map);if(1!==e.length||!(e[0]instanceof F7))throw Error("`namespace` expects either zero arguments or a single object argument");return e[0]})]]);tests=new Map([["boolean",e=>"BooleanValue"===e.type],["callable",e=>e instanceof Pt],["odd",e=>{if("NumericValue"!==e.type)throw Error(`Cannot apply test "odd" to type: ${e.type}`);return e.value%2!=0}],["even",e=>{if("NumericValue"!==e.type)throw Error(`Cannot apply test "even" to type: ${e.type}`);return e.value%2==0}],["false",e=>"BooleanValue"===e.type&&!e.value],["true",e=>"BooleanValue"===e.type&&e.value],["number",e=>"NumericValue"===e.type],["integer",e=>"NumericValue"===e.type&&Number.isInteger(e.value)],["iterable",e=>e instanceof F9||e instanceof F5],["lower",e=>{let t=e.value;return"StringValue"===e.type&&t===t.toLowerCase()}],["upper",e=>{let t=e.value;return"StringValue"===e.type&&t===t.toUpperCase()}],["none",e=>"NullValue"===e.type],["defined",e=>"UndefinedValue"!==e.type],["undefined",e=>"UndefinedValue"===e.type],["equalto",(e,t)=>e.value===t.value]]);set(e,t){return this.declareVariable(e,Pa(t))}declareVariable(e,t){if(this.variables.has(e))throw SyntaxError(`Variable already declared: ${e}`);return this.variables.set(e,t),t}setVariable(e,t){return this.variables.set(e,t),t}resolve(e){if(this.variables.has(e))return this;if(this.parent)return this.parent.resolve(e);throw Error(`Unknown variable: ${e}`)}lookupVariable(e){try{return this.resolve(e).variables.get(e)??new Pr}catch{return new Pr}}},Ps=class{global;constructor(e){this.global=e??new Pi}run(e){return this.evaluate(e,this.global)}evaluateBinaryExpression(e,t){let n=this.evaluate(e.left,t);switch(e.operator.value){case"and":return n.__bool__().value?this.evaluate(e.right,t):n;case"or":return n.__bool__().value?n:this.evaluate(e.right,t)}let r=this.evaluate(e.right,t);switch(e.operator.value){case"==":return new F8(n.value==r.value);case"!=":return new F8(n.value!=r.value)}if(n instanceof Pr||r instanceof Pr)throw Error("Cannot perform operation on undefined values");if(n instanceof Pn||r instanceof Pn)throw Error("Cannot perform operation on null values");if(n instanceof F6&&r instanceof F6)switch(e.operator.value){case"+":return new F6(n.value+r.value);case"-":return new F6(n.value-r.value);case"*":return new F6(n.value*r.value);case"/":return new F6(n.value/r.value);case"%":return new F6(n.value%r.value);case"<":return new F8(n.value<r.value);case">":return new F8(n.value>r.value);case">=":return new F8(n.value>=r.value);case"<=":return new F8(n.value<=r.value)}else if(n instanceof F9&&r instanceof F9){if("+"===e.operator.value)return new F9(n.value.concat(r.value))}else if(r instanceof F9){let t=void 0!==r.value.find(e=>e.value===n.value);switch(e.operator.value){case"in":return new F8(t);case"not in":return new F8(!t)}}if((n instanceof F5||r instanceof F5)&&"+"===e.operator.value)return new F5(n.value.toString()+r.value.toString());if(n instanceof F5&&r instanceof F5)switch(e.operator.value){case"in":return new F8(r.value.includes(n.value));case"not in":return new F8(!r.value.includes(n.value))}if(n instanceof F5&&r instanceof F7)switch(e.operator.value){case"in":return new F8(r.value.has(n.value));case"not in":return new F8(!r.value.has(n.value))}throw SyntaxError(`Unknown operator "${e.operator.value}" between ${n.type} and ${r.type}`)}evaluateFilterExpression(e,t){let n=this.evaluate(e.operand,t);if("Identifier"===e.filter.type){let t=e.filter;if(n instanceof F9)switch(t.value){case"list":return n;case"first":return n.value[0];case"last":return n.value[n.value.length-1];case"length":return new F6(n.value.length);case"reverse":return new F9(n.value.reverse());case"sort":return new F9(n.value.sort((e,t)=>{if(e.type!==t.type)throw Error(`Cannot compare different types: ${e.type} and ${t.type}`);switch(e.type){case"NumericValue":return e.value-t.value;case"StringValue":return e.value.localeCompare(t.value);default:throw Error(`Cannot compare type: ${e.type}`)}}));default:throw Error(`Unknown ArrayValue filter: ${t.value}`)}else if(n instanceof F5)switch(t.value){case"length":return new F6(n.value.length);case"upper":return new F5(n.value.toUpperCase());case"lower":return new F5(n.value.toLowerCase());case"title":return new F5(F3(n.value));case"capitalize":return new F5(n.value.charAt(0).toUpperCase()+n.value.slice(1));case"trim":return new F5(n.value.trim());default:throw Error(`Unknown StringValue filter: ${t.value}`)}else if(n instanceof F6){if("abs"===t.value)return new F6(Math.abs(n.value));throw Error(`Unknown NumericValue filter: ${t.value}`)}else if(n instanceof F7)switch(t.value){case"items":return new F9(Array.from(n.value.entries()).map(([e,t])=>new F9([new F5(e),t])));case"length":return new F6(n.value.size);default:throw Error(`Unknown ObjectValue filter: ${t.value}`)}throw Error(`Cannot apply filter "${t.value}" to type: ${n.type}`)}if("CallExpression"===e.filter.type){let r=e.filter;if("Identifier"!==r.callee.type)throw Error(`Unknown filter: ${r.callee.type}`);let i=r.callee.value;if(n instanceof F9){if("selectattr"===i){let e;if(n.value.some(e=>!(e instanceof F7)))throw Error("`selectattr` can only be applied to array of objects");if(r.args.some(e=>"StringLiteral"!==e.type))throw Error("arguments of `selectattr` must be strings");let[i,s,a]=r.args.map(e=>this.evaluate(e,t));if(s){let n=t.tests.get(s.value);if(!n)throw Error(`Unknown test: ${s.value}`);e=n}else e=(...e)=>e[0].__bool__().value;return new F9(n.value.filter(t=>{let n=t.value.get(i.value);return!!n&&e(n,a)}))}throw Error(`Unknown ArrayValue filter: ${i}`)}throw Error(`Cannot apply filter "${i}" to type: ${n.type}`)}throw Error(`Unknown filter: ${e.filter.type}`)}evaluateTestExpression(e,t){let n=this.evaluate(e.operand,t),r=t.tests.get(e.test.value);if(!r)throw Error(`Unknown test: ${e.test.value}`);let i=r(n);return new F8(e.negate?!i:i)}evaluateUnaryExpression(e,t){let n=this.evaluate(e.argument,t);if("not"===e.operator.value)return new F8(!n.value);throw SyntaxError(`Unknown operator: ${e.operator.value}`)}evalProgram(e,t){return this.evaluateBlock(e.body,t)}evaluateBlock(e,t){let n="";for(let r of e){let e=this.evaluate(r,t);"NullValue"!==e.type&&"UndefinedValue"!==e.type&&(n+=e.value)}return new F5(n)}evaluateIdentifier(e,t){return t.lookupVariable(e.value)}evaluateCallExpression(e,t){let n=[],r=new Map;for(let i of e.args)if("KeywordArgumentExpression"===i.type){let e=i;r.set(e.key.value,this.evaluate(e.value,t))}else n.push(this.evaluate(i,t));r.size>0&&n.push(new F7(r));let i=this.evaluate(e.callee,t);if("FunctionValue"!==i.type)throw Error(`Cannot call something that is not a function: got ${i.type}`);return i.value(n,t)}evaluateSliceExpression(e,t,n){if(!(e instanceof F9||e instanceof F5))throw Error("Slice object must be an array or string");let r=this.evaluate(t.start,n),i=this.evaluate(t.stop,n),s=this.evaluate(t.step,n);if(!(r instanceof F6||r instanceof Pr))throw Error("Slice start must be numeric or undefined");if(!(i instanceof F6||i instanceof Pr))throw Error("Slice stop must be numeric or undefined");if(!(s instanceof F6||s instanceof Pr))throw Error("Slice step must be numeric or undefined");return e instanceof F9?new F9(F2(e.value,r.value,i.value,s.value)):new F5(F2(Array.from(e.value),r.value,i.value,s.value).join(""))}evaluateMemberExpression(e,t){let n,r;let i=this.evaluate(e.object,t);if(e.computed){if("SliceExpression"===e.property.type)return this.evaluateSliceExpression(i,e.property,t);n=this.evaluate(e.property,t)}else n=new F5(e.property.value);if(i instanceof F7){if(!(n instanceof F5))throw Error(`Cannot access property with non-string: got ${n.type}`);r=i.value.get(n.value)??i.builtins.get(n.value)}else if(i instanceof F9||i instanceof F5){if(n instanceof F6)r=i.value.at(n.value),i instanceof F5&&(r=new F5(i.value.at(n.value)));else if(n instanceof F5)r=i.builtins.get(n.value);else throw Error(`Cannot access property with non-string/non-number: got ${n.type}`)}else{if(!(n instanceof F5))throw Error(`Cannot access property with non-string: got ${n.type}`);r=i.builtins.get(n.value)}return r instanceof F4?r:new Pr}evaluateSet(e,t){let n=this.evaluate(e.value,t);if("Identifier"===e.assignee.type){let r=e.assignee.value;t.setVariable(r,n)}else if("MemberExpression"===e.assignee.type){let r=e.assignee,i=this.evaluate(r.object,t);if(!(i instanceof F7))throw Error("Cannot assign to member of non-object");if("Identifier"!==r.property.type)throw Error("Cannot assign to member with non-identifier property");i.value.set(r.property.value,n)}else throw Error(`Invalid LHS inside assignment expression: ${JSON.stringify(e.assignee)}`);return new Pn}evaluateIf(e,t){let n=this.evaluate(e.test,t);return this.evaluateBlock(n.__bool__().value?e.body:e.alternate,t)}evaluateFor(e,t){let n=new Pi(t),r=this.evaluate(e.iterable,n);if(!(r instanceof F9))throw Error(`Expected iterable type in for loop: got ${r.type}`);let i="";for(let t=0;t<r.value.length;++t){let s=new Map([["index",new F6(t+1)],["index0",new F6(t)],["revindex",new F6(r.value.length-t)],["revindex0",new F6(r.value.length-t-1)],["first",new F8(0===t)],["last",new F8(t===r.value.length-1)],["length",new F6(r.value.length)],["previtem",t>0?r.value[t-1]:new Pr],["nextitem",t<r.value.length-1?r.value[t+1]:new Pr]]);n.setVariable("loop",new F7(s));let a=r.value[t];if("Identifier"===e.loopvar.type)n.setVariable(e.loopvar.value,a);else if("TupleLiteral"===e.loopvar.type){let t=e.loopvar;if("ArrayValue"!==a.type)throw Error(`Cannot unpack non-iterable type: ${a.type}`);let r=a;if(t.value.length!==r.value.length)throw Error(`Too ${t.value.length>r.value.length?"few":"many"} items to unpack`);for(let e=0;e<t.value.length;++e){if("Identifier"!==t.value[e].type)throw Error(`Cannot unpack non-identifier type: ${t.value[e].type}`);n.setVariable(t.value[e].value,r.value[e])}}i+=this.evaluateBlock(e.body,n).value}return new F5(i)}evaluate(e,t){if(void 0===e)return new Pr;switch(e.type){case"Program":return this.evalProgram(e,t);case"Set":return this.evaluateSet(e,t);case"If":return this.evaluateIf(e,t);case"For":return this.evaluateFor(e,t);case"NumericLiteral":return new F6(Number(e.value));case"StringLiteral":return new F5(e.value);case"BooleanLiteral":return new F8(e.value);case"ArrayLiteral":return new F9(e.value.map(e=>this.evaluate(e,t)));case"TupleLiteral":return new Pe(e.value.map(e=>this.evaluate(e,t)));case"ObjectLiteral":{let n=new Map;for(let[r,i]of e.value){let e=this.evaluate(r,t);if(!(e instanceof F5))throw Error(`Object keys must be strings: got ${e.type}`);n.set(e.value,this.evaluate(i,t))}return new F7(n)}case"Identifier":return this.evaluateIdentifier(e,t);case"CallExpression":return this.evaluateCallExpression(e,t);case"MemberExpression":return this.evaluateMemberExpression(e,t);case"UnaryExpression":return this.evaluateUnaryExpression(e,t);case"BinaryExpression":return this.evaluateBinaryExpression(e,t);case"FilterExpression":return this.evaluateFilterExpression(e,t);case"TestExpression":return this.evaluateTestExpression(e,t);default:throw SyntaxError(`Unknown node type: ${e.type}`)}}};function Pa(e){switch(typeof e){case"number":return new F6(e);case"string":return new F5(e);case"boolean":return new F8(e);case"object":if(null===e)return new Pn;if(Array.isArray(e))return new F9(e.map(Pa));return new F7(new Map(Object.entries(e).map(([e,t])=>[e,Pa(t)])));case"function":return new Pt((t,n)=>Pa(e(...t.map(e=>e.value))??null));default:throw Error(`Cannot convert to runtime value: ${e}`)}}var Po=class{parsed;constructor(e){let t=FO(e,{lstrip_blocks:!0,trim_blocks:!0});this.parsed=F0(t)}render(e){let t=new Pi;for(let[n,r]of(t.set("false",!1),t.set("true",!0),t.set("raise_exception",e=>{throw Error(e)}),t.set("range",F1),Object.entries(e)))t.set(n,r);return new Ps(t).run(this.parsed).value}};async function Pl(e,t){let n=await Promise.all([Dq(e,"tokenizer.json",!0,t),Dq(e,"tokenizer_config.json",!0,t)]);return null!==t.legacy&&(n[1].legacy=t.legacy),n}function Pu(e,t){let n=[],r=0;for(let i of e.matchAll(t)){let t=i[0];r<i.index&&n.push(e.slice(r,i.index)),t.length>0&&n.push(t),r=i.index+t.length}return r<e.length&&n.push(e.slice(r)),n}function Pc(e,t=!0){if(void 0!==e.Regex){let t=e.Regex.replace(/\\([#&~])/g,"$1");for(let[e,n]of Pv)t=t.replaceAll(e,n);return RegExp(t,"gu")}if(void 0===e.String)return console.warn("Unknown pattern type:",e),null;{let n=Dr(e.String);return RegExp(t?n:`(${n})`,"gu")}}function Ph(e){return new Map(Object.entries(e))}function Pd(e){let t=e.dims;switch(t.length){case 1:return e.tolist();case 2:if(1!==t[0])throw Error("Unable to decode tensor with `batch size !== 1`. Use `tokenizer.batch_decode(...)` for batched inputs.");return e.tolist()[0];default:throw Error(`Expected tensor to have 1-2 dimensions, got ${t.length}.`)}}function Pp(e){return e.replace(/ \./g,".").replace(/ \?/g,"?").replace(/ \!/g,"!").replace(/ ,/g,",").replace(/ \' /g,"'").replace(/ n\'t/g,"n't").replace(/ \'m/g,"'m").replace(/ \'s/g,"'s").replace(/ \'ve/g,"'ve").replace(/ \'re/g,"'re")}function Pf(e){return e.replace(/[\u0300-\u036f]/g,"")}function Pg(e){return Pf(e.toLowerCase())}function Pm(e,t,n){let r=[],i=0;for(;i<e.length;){if(r.push(e[i]),(n.get(e[i])??t)!==t){++i;continue}for(;i<e.length&&(n.get(e[i])??t)===t;)++i}return r}function Py(e){return e.match(/\S+/g)||[]}let Pb="\\p{P}\\u0021-\\u002F\\u003A-\\u0040\\u005B-\\u0060\\u007B-\\u007E",Pv=new Map([["(?i:'s|'t|'re|'ve|'m|'ll|'d)","(?:'([sS]|[tT]|[rR][eE]|[vV][eE]|[mM]|[lL][lL]|[dD]))"]]);class Pw{constructor(e){this.content=e.content,this.id=e.id,this.single_word=e.single_word??!1,this.lstrip=e.lstrip??!1,this.rstrip=e.rstrip??!1,this.special=e.special??!1,this.normalized=e.normalized??null}}class P_ extends Di{constructor(e){super(),this.config=e,this.vocab=[],this.tokens_to_ids=new Map,this.unk_token_id=void 0,this.unk_token=void 0,this.end_of_word_suffix=void 0,this.fuse_unk=this.config.fuse_unk??!1}static fromConfig(e,...t){switch(e.type){case"WordPiece":return new Px(e);case"Unigram":return new PT(e,...t);case"BPE":return new PS(e);default:if(e.vocab)return new PE(e,...t);throw Error(`Unknown TokenizerModel type: ${e.type}`)}}_call(e){let t=this.encode(e);return this.fuse_unk&&(t=Pm(t,this.unk_token_id,this.tokens_to_ids)),t}encode(e){throw Error("encode should be implemented in subclass.")}convert_tokens_to_ids(e){return e.map(e=>this.tokens_to_ids.get(e)??this.unk_token_id)}convert_ids_to_tokens(e){return e.map(e=>this.vocab[e]??this.unk_token)}}class Px extends P_{constructor(e){for(let[t,n]of(super(e),this.tokens_to_ids=Ph(e.vocab),this.unk_token_id=this.tokens_to_ids.get(e.unk_token),this.unk_token=e.unk_token,this.max_input_chars_per_word=e.max_input_chars_per_word??100,this.vocab=Array(this.tokens_to_ids.size),this.tokens_to_ids))this.vocab[n]=t}encode(e){let t=[];for(let n of e){let e=[...n];if(e.length>this.max_input_chars_per_word){t.push(this.unk_token);continue}let r=!1,i=0,s=[];for(;i<e.length;){let t=e.length,n=null;for(;i<t;){let r=e.slice(i,t).join("");if(i>0&&(r=this.config.continuing_subword_prefix+r),this.tokens_to_ids.has(r)){n=r;break}--t}if(null===n){r=!0;break}s.push(n),i=t}r?t.push(this.unk_token):t.push(...s)}return t}}class PT extends P_{constructor(e,t){super(e);let n=e.vocab.length;this.vocab=Array(n),this.scores=Array(n);for(let t=0;t<n;++t){let n=e.vocab[t];this.vocab[t]=n[0],this.scores[t]=n[1]}this.unk_token_id=e.unk_id,this.unk_token=this.vocab[e.unk_id],this.tokens_to_ids=new Map(this.vocab.map((e,t)=>[e,t])),this.bosToken=" ",this.bosTokenId=this.tokens_to_ids.get(this.bosToken),this.eosToken=t.eos_token,this.eosTokenId=this.tokens_to_ids.get(this.eosToken),this.unkToken=this.vocab[this.unk_token_id],this.minScore=D0(this.scores)[0],this.unkScore=this.minScore-10,this.scores[this.unk_token_id]=this.unkScore,this.trie=new Fv,this.trie.extend(this.vocab),this.fuse_unk=!0}populateNodes(e){let t=e.sentence,n=t.length,r=0;for(;r<n;){let n=1,i=!1,s=[];for(let a of this.trie.commonPrefixSearch(t.slice(r))){s.push(a);let t=this.tokens_to_ids.get(a),o=this.scores[t],l=a.length;e.insert(r,l,o,t),i||l!==n||(i=!0)}i||e.insert(r,n,this.unkScore,this.unk_token_id),r+=n}}tokenize(e){let t=new F_(e,this.bosTokenId,this.eosTokenId);return this.populateNodes(t),t.tokens()}encode(e){let t=[];for(let n of e){let e=this.tokenize(n);t.push(...e)}return t}}let PI=(()=>{let e=[...Array.from({length:94},(e,t)=>t+33),...Array.from({length:12},(e,t)=>t+161),...Array.from({length:82},(e,t)=>t+174)],t=e.slice(),n=0;for(let r=0;r<256;++r)e.includes(r)||(e.push(r),t.push(256+n),n+=1);let r=t.map(e=>String.fromCharCode(e));return Object.fromEntries(e.map((e,t)=>[e,r[t]]))})(),Pk=Dn(PI);class PS extends P_{constructor(e){for(let[t,n]of(super(e),this.BPE_SPLIT_TOKEN=" ",this.tokens_to_ids=Ph(e.vocab),this.unk_token_id=this.tokens_to_ids.get(e.unk_token),this.unk_token=e.unk_token,this.vocab=Array(this.tokens_to_ids.size),this.tokens_to_ids))this.vocab[n]=t;this.bpe_ranks=new Map(e.merges.map((e,t)=>[e,t])),this.merges=e.merges.map(e=>e.split(this.BPE_SPLIT_TOKEN)),this.end_of_word_suffix=e.end_of_word_suffix,this.continuing_subword_suffix=e.continuing_subword_suffix??null,this.byte_fallback=this.config.byte_fallback??!1,this.byte_fallback&&(this.text_encoder=new TextEncoder),this.ignore_merges=this.config.ignore_merges??!1,this.cache=new Map}bpe(e){if(0===e.length)return[];let t=this.cache.get(e);if(void 0!==t)return t;let n=Array.from(e);this.end_of_word_suffix&&(n[n.length-1]+=this.end_of_word_suffix);let r=[];if(n.length>1){let e=new Fb((e,t)=>e.score<t.score),t={token:n[0],bias:0,prev:null,next:null},i=t;for(let t=1;t<n.length;++t){let r={bias:t/n.length,token:n[t],prev:i,next:null};i.next=r,this._add_node(e,i),i=r}for(;!e.isEmpty();){let n=e.pop();if(n.deleted||!n.next||n.next.deleted)continue;if(n.deleted=!0,n.next.deleted=!0,n.prev){let e={...n.prev};n.prev.deleted=!0,n.prev=e,e.prev?e.prev.next=e:t=e}let r={token:n.token+n.next.token,bias:n.bias,prev:n.prev,next:n.next.next};r.prev?(r.prev.next=r,this._add_node(e,r.prev)):t=r,r.next&&(r.next.prev=r,this._add_node(e,r))}for(let e=t;null!==e;e=e.next)r.push(e.token)}else r=n;if(this.continuing_subword_suffix)for(let e=0;e<r.length-1;++e)r[e]+=this.continuing_subword_suffix;return this.cache.set(e,r),r}_add_node(e,t){let n=this.bpe_ranks.get(t.token+this.BPE_SPLIT_TOKEN+t.next.token);void 0!==n&&(t.score=n+t.bias,e.push(t))}encode(e){let t=[];for(let n of e){if(this.ignore_merges&&this.tokens_to_ids.has(n)){t.push(n);continue}for(let e of this.bpe(n))this.tokens_to_ids.has(e)?t.push(e):this.byte_fallback?t.push(...Array.from(this.text_encoder.encode(e)).map(e=>`<0x${e.toString(16).toUpperCase().padStart(2,"0")}>`)):t.push(this.unk_token)}return t}}class PE extends P_{constructor(e,t){for(let[n,r]of(super(e),this.tokens_to_ids=Ph(t.target_lang?e.vocab[t.target_lang]:e.vocab),this.bos_token=t.bos_token,this.bos_token_id=this.tokens_to_ids.get(this.bos_token),this.eos_token=t.eos_token,this.eos_token_id=this.tokens_to_ids.get(this.eos_token),this.pad_token=t.pad_token,this.pad_token_id=this.tokens_to_ids.get(this.pad_token),this.unk_token=t.unk_token,this.unk_token_id=this.tokens_to_ids.get(this.unk_token),this.vocab=Array(this.tokens_to_ids.size),this.tokens_to_ids))this.vocab[r]=n}encode(e){return e}}class PC extends Di{constructor(e){super(),this.config=e}static fromConfig(e){if(null===e)return null;switch(e.type){case"BertNormalizer":return new PL(e);case"Precompiled":return new Me(e);case"Sequence":return new PM(e);case"Replace":return new PA(e);case"NFC":return new PN(e);case"NFKC":return new PO(e);case"NFKD":return new P$(e);case"Strip":return new PR(e);case"StripAccents":return new PD(e);case"Lowercase":return new PF(e);case"Prepend":return new PP(e);default:throw Error(`Unknown Normalizer type: ${e.type}`)}}normalize(e){throw Error("normalize should be implemented in subclass.")}_call(e){return this.normalize(e)}}class PA extends PC{normalize(e){let t=Pc(this.config.pattern);return null===t?e:e.replaceAll(t,this.config.content)}}class PN extends PC{normalize(e){return e=e.normalize("NFC")}}class PO extends PC{normalize(e){return e=e.normalize("NFKC")}}class P$ extends PC{normalize(e){return e=e.normalize("NFKD")}}class PR extends PC{normalize(e){return this.config.strip_left&&this.config.strip_right?e=e.trim():(this.config.strip_left&&(e=e.trimStart()),this.config.strip_right&&(e=e.trimEnd())),e}}class PD extends PC{normalize(e){return e=Pf(e)}}class PF extends PC{normalize(e){return e=e.toLowerCase()}}class PP extends PC{normalize(e){return e=this.config.prepend+e}}class PM extends PC{constructor(e){super(e),this.normalizers=e.normalizers.map(e=>PC.fromConfig(e))}normalize(e){return this.normalizers.reduce((e,t)=>t.normalize(e),e)}}class PL extends PC{_tokenize_chinese_chars(e){let t=[];for(let n=0;n<e.length;++n){let r=e[n],i=r.charCodeAt(0);this._is_chinese_char(i)?(t.push(" "),t.push(r),t.push(" ")):t.push(r)}return t.join("")}_is_chinese_char(e){return e>=19968&&e<=40959||e>=13312&&e<=19903||e>=131072&&e<=173791||e>=173824&&e<=177983||e>=177984&&e<=178207||e>=178208&&e<=183983||e>=63744&&e<=64255||e>=194560&&e<=195103}stripAccents(e){return e.normalize("NFD").replace(/[\u0300-\u036f]/g,"")}_is_control(e){switch(e){case"	":case"\n":case"\r":return!1;default:return/^\p{Cc}|\p{Cf}|\p{Co}|\p{Cs}$/u.test(e)}}_clean_text(e){let t=[];for(let n of e){let e=n.charCodeAt(0);0===e||65533===e||this._is_control(n)||(/^\s$/.test(n)?t.push(" "):t.push(n))}return t.join("")}normalize(e){return this.config.clean_text&&(e=this._clean_text(e)),this.config.handle_chinese_chars&&(e=this._tokenize_chinese_chars(e)),this.config.lowercase?(e=e.toLowerCase(),!1!==this.config.strip_accents&&(e=this.stripAccents(e))):this.config.strip_accents&&(e=this.stripAccents(e)),e}}class Pz extends Di{static fromConfig(e){if(null===e)return null;switch(e.type){case"BertPreTokenizer":return new PB(e);case"Sequence":return new Mt(e);case"Whitespace":return new Mn(e);case"WhitespaceSplit":return new Mr(e);case"Metaspace":return new P7(e);case"ByteLevel":return new PU(e);case"Split":return new PV(e);case"Punctuation":return new Pj(e);case"Digits":return new PG(e);case"Replace":return new Mi(e);default:throw Error(`Unknown PreTokenizer type: ${e.type}`)}}pre_tokenize_text(e,t){throw Error("pre_tokenize_text should be implemented in subclass.")}pre_tokenize(e,t){return(Array.isArray(e)?e.map(e=>this.pre_tokenize_text(e,t)):this.pre_tokenize_text(e,t)).flat()}_call(e,t){return this.pre_tokenize(e,t)}}class PB extends Pz{constructor(e){super(),this.pattern=RegExp(`[^\\s${Pb}]+|[${Pb}]`,"gu")}pre_tokenize_text(e,t){return e.trim().match(this.pattern)||[]}}class PU extends Pz{constructor(e){super(),this.config=e,this.add_prefix_space=this.config.add_prefix_space,this.trim_offsets=this.config.trim_offsets,this.use_regex=this.config.use_regex??!0,this.pattern=/'s|'t|'re|'ve|'m|'ll|'d| ?\p{L}+| ?\p{N}+| ?[^\s\p{L}\p{N}]+|\s+(?!\S)|\s+/gu,this.byte_encoder=PI,this.text_encoder=new TextEncoder}pre_tokenize_text(e,t){return this.add_prefix_space&&!e.startsWith(" ")&&(e=" "+e),(this.use_regex?e.match(this.pattern)||[]:[e]).map(e=>Array.from(this.text_encoder.encode(e),e=>this.byte_encoder[e]).join(""))}}class PV extends Pz{constructor(e){super(),this.config=e,this.pattern=Pc(this.config.pattern,this.config.invert)}pre_tokenize_text(e,t){return null===this.pattern?[]:this.config.invert?e.match(this.pattern)||[]:Pu(e,this.pattern)}}class Pj extends Pz{constructor(e){super(),this.config=e,this.pattern=RegExp(`[^${Pb}]+|[${Pb}]+`,"gu")}pre_tokenize_text(e,t){return e.match(this.pattern)||[]}}class PG extends Pz{constructor(e){super(),this.config=e;let t=`[^\\d]+|\\d${this.config.individual_digits?"":"+"}`;this.pattern=RegExp(t,"gu")}pre_tokenize_text(e,t){return e.match(this.pattern)||[]}}class PW extends Di{constructor(e){super(),this.config=e}static fromConfig(e){if(null===e)return null;switch(e.type){case"TemplateProcessing":return new PK(e);case"ByteLevel":return new PX(e);case"RobertaProcessing":return new PH(e);case"BertProcessing":return new Pq(e);case"Sequence":return new PY(e);default:throw Error(`Unknown PostProcessor type: ${e.type}`)}}post_process(e,...t){throw Error("post_process should be implemented in subclass.")}_call(e,...t){return this.post_process(e,...t)}}class Pq extends PW{constructor(e){super(e),this.cls=e.cls[0],this.sep=e.sep[0]}post_process(e,t=null,{add_special_tokens:n=!0}={}){n&&(e=Dc([this.cls],e,[this.sep]));let r=Array(e.length).fill(0);if(null!==t){let i=n&&this instanceof PH?[this.sep]:[],s=n?[this.sep]:[];e=Dc(e,i,t,s),r=Dc(r,Array(t.length+i.length+s.length).fill(1))}return{tokens:e,token_type_ids:r}}}class PH extends Pq{}class PK extends PW{constructor(e){super(e),this.single=e.single,this.pair=e.pair}post_process(e,t=null,{add_special_tokens:n=!0}={}){let r=null===t?this.single:this.pair,i=[],s=[];for(let a of r)"SpecialToken"in a?n&&(i.push(a.SpecialToken.id),s.push(a.SpecialToken.type_id)):"Sequence"in a&&("A"===a.Sequence.id?(i=Dc(i,e),s=Dc(s,Array(e.length).fill(a.Sequence.type_id))):"B"===a.Sequence.id&&(i=Dc(i,t),s=Dc(s,Array(t.length).fill(a.Sequence.type_id))));return{tokens:i,token_type_ids:s}}}class PX extends PW{post_process(e,t=null){return t&&(e=Dc(e,t)),{tokens:e}}}class PY extends PW{constructor(e){super(e),this.processors=e.processors.map(e=>PW.fromConfig(e))}post_process(e,t=null,n={}){let r;for(let i of this.processors)if(i instanceof PX)e=i.post_process(e).tokens,t&&(t=i.post_process(t).tokens);else{let s=i.post_process(e,t,n);e=s.tokens,r=s.token_type_ids}return{tokens:e,token_type_ids:r}}}class PQ extends Di{constructor(e){super(),this.config=e,this.added_tokens=[],this.end_of_word_suffix=null,this.trim_offsets=e.trim_offsets}static fromConfig(e){if(null===e)return null;switch(e.type){case"WordPiece":return new P2(e);case"Metaspace":return new P9(e);case"ByteLevel":return new P3(e);case"Replace":return new PJ(e);case"ByteFallback":return new PZ(e);case"Fuse":return new P0(e);case"Strip":return new P1(e);case"Sequence":return new P6(e);case"CTC":return new P4(e);case"BPEDecoder":return new P5(e);default:throw Error(`Unknown Decoder type: ${e.type}`)}}_call(e){return this.decode(e)}decode(e){return this.decode_chain(e).join("")}decode_chain(e){throw Error("`decode_chain` should be implemented in subclass.")}}class PJ extends PQ{decode_chain(e){let t=Pc(this.config.pattern);return null===t?e:e.map(e=>e.replaceAll(t,this.config.content))}}class PZ extends PQ{constructor(e){super(e),this.text_decoder=new TextDecoder}decode_chain(e){let t=[],n=[];for(let r of e){let e=null;if(6===r.length&&r.startsWith("<0x")&&r.endsWith(">")){let t=parseInt(r.slice(3,5),16);isNaN(t)||(e=t)}if(null!==e)n.push(e);else{if(n.length>0){let e=this.text_decoder.decode(Uint8Array.from(n));t.push(e),n=[]}t.push(r)}}if(n.length>0){let e=this.text_decoder.decode(Uint8Array.from(n));t.push(e),n=[]}return t}}class P0 extends PQ{decode_chain(e){return[e.join("")]}}class P1 extends PQ{constructor(e){super(e),this.content=this.config.content,this.start=this.config.start,this.stop=this.config.stop}decode_chain(e){return e.map(e=>{let t=0;for(let n=0;n<this.start;++n){if(e[n]===this.content){t=n+1;continue}break}let n=e.length;for(let t=0;t<this.stop;++t){let r=e.length-t-1;if(e[r]===this.content){n=r;continue}break}return e.slice(t,n)})}}class P2 extends PQ{constructor(e){super(e),this.cleanup=e.cleanup}decode_chain(e){return e.map((e,t)=>(0!==t&&(e=e.startsWith(this.config.prefix)?e.replace(this.config.prefix,""):" "+e),this.cleanup&&(e=Pp(e)),e))}}class P3 extends PQ{constructor(e){super(e),this.byte_decoder=Pk,this.text_decoder=new TextDecoder("utf-8",{fatal:!1,ignoreBOM:!0}),this.end_of_word_suffix=null}convert_tokens_to_string(e){let t=new Uint8Array([...e.join("")].map(e=>this.byte_decoder[e]));return this.text_decoder.decode(t)}decode_chain(e){let t=[],n=[];for(let r of e)void 0!==this.added_tokens.find(e=>e.content===r)?(n.length>0&&(t.push(this.convert_tokens_to_string(n)),n=[]),t.push(r)):n.push(r);return n.length>0&&t.push(this.convert_tokens_to_string(n)),t}}class P4 extends PQ{constructor(e){super(e),this.pad_token=this.config.pad_token,this.word_delimiter_token=this.config.word_delimiter_token,this.cleanup=this.config.cleanup}convert_tokens_to_string(e){if(0===e.length)return"";let t=[e[0]];for(let n=1;n<e.length;++n)e[n]!==t.at(-1)&&t.push(e[n]);let n=t.filter(e=>e!==this.pad_token).join("");return this.cleanup&&(n=Pp(n).replaceAll(this.word_delimiter_token," ").trim()),n}decode_chain(e){return[this.convert_tokens_to_string(e)]}}class P6 extends PQ{constructor(e){super(e),this.decoders=e.decoders.map(e=>PQ.fromConfig(e))}decode_chain(e){return this.decoders.reduce((e,t)=>t.decode_chain(e),e)}}class P5 extends PQ{constructor(e){super(e),this.suffix=this.config.suffix}decode_chain(e){return e.map((t,n)=>t.replaceAll(this.suffix,n===e.length-1?"":" "))}}class P8 extends PQ{decode_chain(e){let t="";for(let n=1;n<e.length;n+=2)t+=e[n];return[t]}}class P7 extends Pz{constructor(e){super(),this.addPrefixSpace=e.add_prefix_space,this.replacement=e.replacement,this.strRep=e.str_rep||this.replacement,this.prepend_scheme=e.prepend_scheme??"always"}pre_tokenize_text(e,{section_index:t}={}){let n=e.replaceAll(" ",this.strRep);return this.addPrefixSpace&&!n.startsWith(this.replacement)&&("always"===this.prepend_scheme||"first"===this.prepend_scheme&&0===t)&&(n=this.strRep+n),[n]}}class P9 extends PQ{constructor(e){super(e),this.addPrefixSpace=e.add_prefix_space,this.replacement=e.replacement}decode_chain(e){let t=[];for(let n=0;n<e.length;++n){let r=e[n].replaceAll(this.replacement," ");this.addPrefixSpace&&0==n&&r.startsWith(" ")&&(r=r.substring(1)),t.push(r)}return t}}class Me extends PC{constructor(e){super(e),this.charsmap=e.precompiled_charsmap}normalize(e){return e=(e=(e=e.replace(/[\u0001-\u0008\u000B\u000E-\u001F\u007F\u008F\u009F]/gm,"")).replace(/[\u0009\u000A\u000C\u000D\u1680\u200B\u200C\u200E\u200F\u2028\u2029\u2581\uFEFF\uFFFD]/gm," ")).includes("")?e.split("").map(e=>e.normalize("NFKC")).join(""):e.normalize("NFKC")}}class Mt extends Pz{constructor(e){super(),this.tokenizers=e.pretokenizers.map(e=>Pz.fromConfig(e))}pre_tokenize_text(e,t){return this.tokenizers.reduce((e,n)=>n.pre_tokenize(e,t),[e])}}class Mn extends Pz{constructor(e){super()}pre_tokenize_text(e,t){return e.match(/\w+|[^\w\s]+/g)||[]}}class Mr extends Pz{constructor(e){super()}pre_tokenize_text(e,t){return Py(e)}}class Mi extends Pz{constructor(e){super(),this.config=e,this.pattern=Pc(this.config.pattern),this.content=this.config.content}pre_tokenize_text(e,t){return null===this.pattern?[e]:[e.replaceAll(this.pattern,this.config.content)]}}let Ms=["bos_token","eos_token","unk_token","sep_token","pad_token","cls_token","mask_token"];function Ma(e,t,n,r){for(let i of Object.keys(e)){let s=t-e[i].length,a=n(i),o=Array(s).fill(a);e[i]="right"===r?Dc(e[i],o):Dc(o,e[i])}}function Mo(e,t){for(let n of Object.keys(e))e[n].length=t}class Ml extends Di{return_token_type_ids=!1;_default_chat_template=`{% for message in messages %}{{'<|im_start|>' + message['role'] + '
' + message['content'] + '<|im_end|>' + '
'}}{% endfor %}{% if add_generation_prompt %}{{ '<|im_start|>assistant
' }}{% endif %}`;constructor(e,t){for(let n of(super(),this._tokenizer_config=t,this.normalizer=PC.fromConfig(e.normalizer),this.pre_tokenizer=Pz.fromConfig(e.pre_tokenizer),this.model=P_.fromConfig(e.model,t),this.post_processor=PW.fromConfig(e.post_processor),this.decoder=PQ.fromConfig(e.decoder),this.special_tokens=[],this.all_special_ids=[],this.added_tokens=[],e.added_tokens)){let e=new Pw(n);this.added_tokens.push(e),this.model.tokens_to_ids.set(e.content,e.id),this.model.vocab[e.id]=e.content,e.special&&(this.special_tokens.push(e.content),this.all_special_ids.push(e.id))}if(this.additional_special_tokens=t.additional_special_tokens??[],this.special_tokens.push(...this.additional_special_tokens),this.special_tokens=[...new Set(this.special_tokens)],this.decoder&&(this.decoder.added_tokens=this.added_tokens,this.decoder.end_of_word_suffix=this.model.end_of_word_suffix),this.added_tokens_regex=this.added_tokens.length>0?new RegExp(this.added_tokens.map(e=>`${e.lstrip?"\\s*":""}(${Dr(e.content)})${e.rstrip?"\\s*":""}`).join("|")):null,this.mask_token=this.getToken("mask_token"),this.mask_token_id=this.model.tokens_to_ids.get(this.mask_token),this.pad_token=this.getToken("pad_token","eos_token"),this.pad_token_id=this.model.tokens_to_ids.get(this.pad_token),this.sep_token=this.getToken("sep_token"),this.sep_token_id=this.model.tokens_to_ids.get(this.sep_token),this.unk_token=this.getToken("unk_token"),this.unk_token_id=this.model.tokens_to_ids.get(this.unk_token),this.model_max_length=t.model_max_length,this.remove_space=t.remove_space,this.clean_up_tokenization_spaces=t.clean_up_tokenization_spaces??!0,this.do_lowercase_and_remove_accent=t.do_lowercase_and_remove_accent??!1,this.padding_side="right",this.legacy=!1,this.chat_template=t.chat_template??null,Array.isArray(this.chat_template)){let e=Object.create(null);for(let{name:t,template:n}of this.chat_template){if("string"!=typeof t||"string"!=typeof n)throw Error('Chat template must be a list of objects with "name" and "template" properties');e[t]=n}this.chat_template=e}this._compiled_template_cache=new Map}getToken(...e){for(let t of e){let e=this._tokenizer_config[t];if(e){if("object"!=typeof e)return e;if("AddedToken"===e.__type)return e.content;throw Error(`Unknown token: ${e}`)}}return null}static async from_pretrained(e,{progress_callback:t=null,config:n=null,cache_dir:r=null,local_files_only:i=!1,revision:s="main",legacy:a=null}={}){return new this(...await Pl(e,{progress_callback:t,config:n,cache_dir:r,local_files_only:i,revision:s,legacy:a}))}_call(e,{text_pair:t=null,add_special_tokens:n=!0,padding:r=!1,truncation:i=null,max_length:s=null,return_tensor:a=!0,return_token_type_ids:o=null}={}){let l;let u=Array.isArray(e);if(u){if(0===e.length)throw Error("text array must be non-empty");if(null!==t){if(Array.isArray(t)){if(e.length!==t.length)throw Error("text and text_pair must have the same length")}else throw Error("text_pair must also be an array");l=e.map((e,r)=>this._encode_plus(e,t[r],{add_special_tokens:n,return_token_type_ids:o}))}else l=e.map(e=>this._encode_plus(e,null,{add_special_tokens:n,return_token_type_ids:o}))}else{if(null==e)throw Error("text may not be null or undefined");if(Array.isArray(t))throw Error("When specifying `text_pair`, since `text` is a string, `text_pair` must also be a string (i.e., not an array).");l=[this._encode_plus(e,t,{add_special_tokens:n,return_token_type_ids:o})]}if(null===s?s="max_length"===r?this.model_max_length:D1(l.map(e=>e.input_ids.length))[0]:i||console.warn("Truncation was not explicitly activated but `max_length` is provided a specific value, please use `truncation=true` to explicitly truncate examples to max length."),s=Math.min(s,this.model_max_length),r||i)for(let e=0;e<l.length;++e)l[e].input_ids.length!==s&&(l[e].input_ids.length>s?i&&Mo(l[e],s):r&&Ma(l[e],s,e=>"input_ids"===e?this.pad_token_id:0,this.padding_side));let c={};if(a){if(!(r&&i)&&l.some(e=>{for(let t of Object.keys(e))if(e[t].length!==l[0][t]?.length)return!0;return!1}))throw Error("Unable to create tensor, you should probably activate truncation and/or padding with 'padding=true' and 'truncation=true' to have batched tensors with the same length.");let e=[l.length,l[0].input_ids.length];for(let t of Object.keys(l[0]))c[t]=new Ft("int64",BigInt64Array.from(l.flatMap(e=>e[t]).map(BigInt)),e)}else{for(let e of Object.keys(l[0]))c[e]=l.map(t=>t[e]);if(!u)for(let e of Object.keys(c))c[e]=c[e][0]}return c}_encode_text(e){return null===e?null:(this.added_tokens_regex?e.split(this.added_tokens_regex).filter(e=>e):[e]).map((e,t)=>{if(void 0!==this.added_tokens.find(t=>t.content===e))return e;{if(!0===this.remove_space&&(e=e.trim().split(/\s+/).join(" ")),this.do_lowercase_and_remove_accent&&(e=Pg(e)),null!==this.normalizer&&(e=this.normalizer(e)),0===e.length)return[];let n=null!==this.pre_tokenizer?this.pre_tokenizer(e,{section_index:t}):[e];return this.model(n)}}).flat()}_encode_plus(e,t=null,{add_special_tokens:n=!0,return_token_type_ids:r=null}={}){let i=this._encode_text(e),s=this._encode_text(t),a=this.post_processor?this.post_processor(i,s,{add_special_tokens:n}):{tokens:Dc(i??[],s??[])},o=this.model.convert_tokens_to_ids(a.tokens),l={input_ids:o,attention_mask:Array(o.length).fill(1)};return(r??this.return_token_type_ids)&&a.token_type_ids&&(l.token_type_ids=a.token_type_ids),l}encode(e,t=null,{add_special_tokens:n=!0,return_token_type_ids:r=null}={}){let{input_ids:i}=this._encode_plus(e,t,{add_special_tokens:n,return_token_type_ids:r});return i}batch_decode(e,t={}){return e instanceof Ft&&(e=e.tolist()),e.map(e=>this.decode(e,t))}decode(e,t={}){if(e instanceof Ft&&(e=Pd(e)),!Array.isArray(e)||0===e.length||!Da(e[0]))throw Error("token_ids must be a non-empty array of integers.");return this.decode_single(e,t)}decode_single(e,{skip_special_tokens:t=!1,clean_up_tokenization_spaces:n=null}){let r=this.model.convert_ids_to_tokens(e);t&&(r=r.filter(e=>!this.special_tokens.includes(e)));let i=this.decoder?this.decoder(r):r.join(" ");return this.decoder&&this.decoder.end_of_word_suffix&&(i=i.replaceAll(this.decoder.end_of_word_suffix," "),t&&(i=i.trim())),(n??this.clean_up_tokenization_spaces)&&(i=Pp(i)),i}get default_chat_template(){return this._warned_about_chat_template||(console.warn("No chat template is defined for this tokenizer - using a default chat template that implements the ChatML format. If the default is not appropriate for your model, please set `tokenizer.chat_template` to an appropriate template. See https://huggingface.co/docs/transformers/main/chat_templating for more information."),this._warned_about_chat_template=!0),this._default_chat_template}apply_chat_template(e,{chat_template:t=null,add_generation_prompt:n=!1,tokenize:r=!0,padding:i=!1,truncation:s=!1,max_length:a=null,return_tensor:o=!0,tokenizer_kwargs:l={},...u}={}){if(this.chat_template&&"object"==typeof this.chat_template||null===this.chat_template&&this.default_chat_template&&"object"==typeof this.default_chat_template){let e=this.chat_template??this.default_chat_template;if(null!==t&&Object.hasOwn(e,t))t=e[t];else if(null===t&&"default"in e)t=e.default;else if(null===t)throw Error(`This model has multiple chat templates with no default specified! Please either pass a chat template or the name of the template you wish to use to the 'chat_template' argument. Available template names are ${Object.keys(e).sort()}.`)}else t??=this.chat_template??this.default_chat_template;if("string"!=typeof t)throw Error(`chat_template must be a string, but got ${typeof t}`);let c=this._compiled_template_cache.get(t);void 0===c&&(c=new Po(t),this._compiled_template_cache.set(t,c));let h=Object.create(null);for(let e of Ms){let t=this.getToken(e);t&&(h[e]=t)}let d=c.render({messages:e,add_generation_prompt:n,...h,...u});return r?this._call(d,{add_special_tokens:!1,padding:i,truncation:s,max_length:a,return_tensor:o,...l}).input_ids:d}}class Mu extends Ml{return_token_type_ids=!0}class Mc extends Ml{return_token_type_ids=!0}class Mh extends Ml{return_token_type_ids=!0}class Md extends Ml{return_token_type_ids=!0}class Mp extends Ml{return_token_type_ids=!0}class Mf extends Ml{return_token_type_ids=!0}class Mg extends Ml{return_token_type_ids=!0}class Mm extends Ml{return_token_type_ids=!0}class My extends Ml{return_token_type_ids=!0}class Mb extends Ml{}class Mv extends Ml{}class Mw extends Ml{return_token_type_ids=!0;constructor(e,t){super(e,t),console.warn('WARNING: `XLMTokenizer` is not yet supported by Hugging Face\'s "fast" tokenizers library. Therefore, you may experience slightly inaccurate results.')}}class M_ extends Ml{return_token_type_ids=!0}class Mx extends Ml{}class MT extends Ml{_default_chat_template='{% for message in messages %}" "{{ message.content }}{{ eos_token }}" "{% endfor %}'}class MI extends Ml{}class Mk extends Ml{constructor(e,t){super(e,t),this.languageRegex=/^[a-z]{2}_[A-Z]{2}$/,this.language_codes=this.special_tokens.filter(e=>this.languageRegex.test(e)),this.lang_to_token=e=>e}_build_translation_inputs(e,t,n){return MB(this,e,t,n)}}class MS extends Mk{}class ME extends Ml{}class MC extends MT{constructor(e,t){let n=".,!?",r=e.pre_tokenizer?.pretokenizers[0]?.pattern;r&&r.Regex===` ?[^(\\s|[${n}])]+`&&(r.Regex=` ?[^\\s${n}]+`),super(e,t)}}let MA="";class MN extends Ml{_default_chat_template=`{% if messages[0]['role'] == 'system' %}{% set loop_messages = messages[1:] %}{% set system_message = messages[0]['content'] %}{% elif USE_DEFAULT_PROMPT == true and not '<<SYS>>' in messages[0]['content'] %}{% set loop_messages = messages %}{% set system_message = 'DEFAULT_SYSTEM_MESSAGE' %}{% else %}{% set loop_messages = messages %}{% set system_message = false %}{% endif %}{% for message in loop_messages %}{% if (message['role'] == 'user') != (loop.index0 % 2 == 0) %}{{ raise_exception('Conversation roles must alternate user/assistant/user/assistant/...') }}{% endif %}{% if loop.index0 == 0 and system_message != false %}{% set content = '<<SYS>>
' + system_message + '
<</SYS>>

' + message['content'] %}{% else %}{% set content = message['content'] %}{% endif %}{% if message['role'] == 'user' %}{{ bos_token + '[INST] ' + content.strip() + ' [/INST]' }}{% elif message['role'] == 'system' %}{{ '<<SYS>>
' + content.strip() + '
<</SYS>>

' }}{% elif message['role'] == 'assistant' %}{{ ' '  + content.strip() + ' ' + eos_token }}{% endif %}{% endfor %}`;DEFAULT_SYSTEM_PROMPT="You are a helpful, respectful and honest assistant. Always answer as helpfully as possible, while being safe. Your answers should not include any harmful, unethical, racist, sexist, toxic, dangerous, or illegal content. Please ensure that your responses are socially unbiased and positive in nature.\n\nIf a question does not make any sense, or is not factually coherent, explain why instead of answering something not correct. If you don't know the answer to a question, please don't share false information.";constructor(e,t){super(e,t),this.use_default_system_prompt=t.use_default_system_prompt??!1,this.legacy=t.legacy??!0,this.legacy||(this.normalizer=null,this.pre_tokenizer=new P7({replacement:MA,add_prefix_space:!0,prepend_scheme:"first"}))}_encode_text(e){if(null===e)return null;if(this.legacy||0===e.length)return super._encode_text(e);let t=super._encode_text(MA+e.replaceAll(MA," "));return t.length>1&&t[0]===MA&&this.special_tokens.includes(t[1])&&(t=t.slice(1)),t}get default_chat_template(){return super.default_chat_template.replaceAll("USE_DEFAULT_PROMPT",this.use_default_system_prompt?"true":"false").replaceAll("DEFAULT_SYSTEM_MESSAGE",this.DEFAULT_SYSTEM_PROMPT.replaceAll("\n","\\n").replaceAll("'","\\'"))}}class MO extends MN{}class M$ extends Ml{}class MR extends Ml{}class MD extends Ml{}class MF extends Ml{}class MP extends Ml{}class MM extends Ml{}class ML extends Ml{_default_chat_template="{% if messages[0]['role'] == 'system' %}{{ raise_exception('System role not supported') }}{% endif %}{% for message in messages %}{% if (message['role'] == 'user') != (loop.index0 % 2 == 0) %}{{ raise_exception('Conversation roles must alternate user/assistant/user/assistant/...') }}{% endif %}{% if (message['role'] == 'assistant') %}{% set role = 'model' %}{% else %}{% set role = message['role'] %}{% endif %}{{ '<start_of_turn>' + role + '\n' + message['content'] | trim + '<end_of_turn>\n' }}{% endfor %}{% if add_generation_prompt %}{{'<start_of_turn>model\n'}}{% endif %}"}class Mz extends Ml{}function MB(e,t,n,r){if(!("language_codes"in e)||!Array.isArray(e.language_codes))throw Error("Tokenizer must have `language_codes` attribute set and it should be an array of language ids.");if(!("languageRegex"in e)||!(e.languageRegex instanceof RegExp))throw Error("Tokenizer must have `languageRegex` attribute set and it should be a regular expression.");if(!("lang_to_token"in e)||"function"!=typeof e.lang_to_token)throw Error("Tokenizer must have `lang_to_token` attribute set and it should be a function.");let i=r.src_lang,s=r.tgt_lang;if(!e.language_codes.includes(s))throw Error(`Target language code "${s}" is not valid. Must be one of: {${e.language_codes.join(", ")}}`);if(void 0!==i){if(!e.language_codes.includes(i))throw Error(`Source language code "${i}" is not valid. Must be one of: {${e.language_codes.join(", ")}}`);for(let t of e.post_processor.config.single)if("SpecialToken"in t&&e.languageRegex.test(t.SpecialToken.id)){t.SpecialToken.id=e.lang_to_token(i);break}}return r.forced_bos_token_id=e.model.convert_tokens_to_ids([e.lang_to_token(s)])[0],e._call(t,n)}class MU extends Ml{constructor(e,t){super(e,t),this.languageRegex=/^[a-z]{3}_[A-Z][a-z]{3}$/,this.language_codes=this.special_tokens.filter(e=>this.languageRegex.test(e)),this.lang_to_token=e=>e}_build_translation_inputs(e,t,n){return MB(this,e,t,n)}}class MV extends Ml{constructor(e,t){super(e,t),this.languageRegex=/^__[a-z]{2,3}__$/,this.language_codes=this.special_tokens.filter(e=>this.languageRegex.test(e)).map(e=>e.slice(2,-2)),this.lang_to_token=e=>`__${e}__`}_build_translation_inputs(e,t,n){return MB(this,e,t,n)}}let Mj=[["en","english"],["zh","chinese"],["de","german"],["es","spanish"],["ru","russian"],["ko","korean"],["fr","french"],["ja","japanese"],["pt","portuguese"],["tr","turkish"],["pl","polish"],["ca","catalan"],["nl","dutch"],["ar","arabic"],["sv","swedish"],["it","italian"],["id","indonesian"],["hi","hindi"],["fi","finnish"],["vi","vietnamese"],["he","hebrew"],["uk","ukrainian"],["el","greek"],["ms","malay"],["cs","czech"],["ro","romanian"],["da","danish"],["hu","hungarian"],["ta","tamil"],["no","norwegian"],["th","thai"],["ur","urdu"],["hr","croatian"],["bg","bulgarian"],["lt","lithuanian"],["la","latin"],["mi","maori"],["ml","malayalam"],["cy","welsh"],["sk","slovak"],["te","telugu"],["fa","persian"],["lv","latvian"],["bn","bengali"],["sr","serbian"],["az","azerbaijani"],["sl","slovenian"],["kn","kannada"],["et","estonian"],["mk","macedonian"],["br","breton"],["eu","basque"],["is","icelandic"],["hy","armenian"],["ne","nepali"],["mn","mongolian"],["bs","bosnian"],["kk","kazakh"],["sq","albanian"],["sw","swahili"],["gl","galician"],["mr","marathi"],["pa","punjabi"],["si","sinhala"],["km","khmer"],["sn","shona"],["yo","yoruba"],["so","somali"],["af","afrikaans"],["oc","occitan"],["ka","georgian"],["be","belarusian"],["tg","tajik"],["sd","sindhi"],["gu","gujarati"],["am","amharic"],["yi","yiddish"],["lo","lao"],["uz","uzbek"],["fo","faroese"],["ht","haitian creole"],["ps","pashto"],["tk","turkmen"],["nn","nynorsk"],["mt","maltese"],["sa","sanskrit"],["lb","luxembourgish"],["my","myanmar"],["bo","tibetan"],["tl","tagalog"],["mg","malagasy"],["as","assamese"],["tt","tatar"],["haw","hawaiian"],["ln","lingala"],["ha","hausa"],["ba","bashkir"],["jw","javanese"],["su","sundanese"]],MG=new Map(Mj),MW=new Map([...Mj.map(([e,t])=>[t,e]),["burmese","my"],["valencian","ca"],["flemish","nl"],["haitian","ht"],["letzeburgesch","lb"],["pushto","ps"],["panjabi","pa"],["moldavian","ro"],["moldovan","ro"],["sinhalese","si"],["castilian","es"]]);class Mq extends Ml{_default_chat_template='{% for message in messages %}" "{{ message.content }}{{ eos_token }}" "{% endfor %}';_decode_asr(e,{return_timestamps:t=!1,return_language:n=!1,time_precision:r=null,force_full_sequences:i=!0}={}){if(null===r)throw Error("Must specify time_precision");let s=null,a="word"===t;function o(){return{language:s,timestamp:[null,null],text:""}}let l=[],u=o(),c=0,h=this.model.convert_tokens_to_ids(["<|notimestamps|>"])[0]+1,d=[],p=[],f=!1,g=null,m=new Set(this.all_special_ids);for(let n of e){let e=n.tokens,i=a?n.token_timestamps:null,y=null,b=h;if("stride"in n){let[t,i,s]=n.stride;if(c-=i,g=t-s,i&&(b=i/r+h),s)for(let t=e.length-1;t>=0;--t){let n=e[t];if(n>=h){if(null!==y&&(n-h)*r<g)break;y=n}}}let v=[],w=[];for(let n=0;n<e.length;++n){let g=e[n];if(m.has(g)){let e=this.decode([g]),n=MG.get(e.slice(2,-2));if(void 0!==n){if(null!==s&&n!==s&&!t){d.push(v);let e=this.findLongestCommonSequence(d)[0],t=this.decode(e);u.text=t,l.push(u),d=[],v=[],u=o()}s=u.language=n}}else if(g>=h){let e=D8((g-h)*r+c,2);if(null!==y&&g>=y)f=!0;else if(f||d.length>0&&g<b)f=!1;else if(null===u.timestamp[0])u.timestamp[0]=e;else if(e===u.timestamp[0]);else{u.timestamp[1]=e,d.push(v),a&&p.push(w);let[t,n]=this.findLongestCommonSequence(d,p),r=this.decode(t);u.text=r,a&&(u.words=this.collateWordTimestamps(t,n,s)),l.push(u),d=[],v=[],p=[],w=[],u=o()}}else if(v.push(g),a){let e,t=D8(i[n]+c,2);e=n+1<i.length?D8(i[n+1]+c,2):null,w.push([t,e])}}if("stride"in n){let[e,t,r]=n.stride;c+=e-r}v.length>0?(d.push(v),a&&p.push(w)):d.every(e=>0===e.length)&&(u=o(),d=[],v=[],p=[],w=[])}if(d.length>0){if(i&&t)throw Error("Whisper did not predict an ending timestamp, which can happen if audio is cut off in the middle of a word. Also make sure WhisperTimeStampLogitsProcessor was used during generation.");let[e,n]=this.findLongestCommonSequence(d,p),r=this.decode(e);u.text=r,a&&(u.words=this.collateWordTimestamps(e,n,s)),l.push(u)}let y=Object.create(null),b=l.map(e=>e.text).join("");if(t||n){for(let e=0;e<l.length;++e){let r=l[e];t||delete r.timestamp,n||delete r.language}if(a){let e=[];for(let t of l)for(let n of t.words)e.push(n);y={chunks:e}}else y={chunks:l}}return[b,y]}findLongestCommonSequence(e,t=null){let n=e[0],r=n.length,i=[],s=Array.isArray(t)&&t.length>0,a=s?[]:null,o=s?t[0]:null;for(let l=1;l<e.length;++l){let u=e[l],c=0,h=[r,r,0,0],d=u.length;for(let e=1;e<r+d;++e){let t=e/1e4,i=Math.max(0,r-e),s=Math.min(r,r+d-e),a=n.slice(i,s),o=Math.max(0,e-r),l=Math.min(d,e),p=u.slice(o,l);if(a.length!==p.length)throw Error("There is a bug within whisper `decode_asr` function, please report it. Dropping to prevent bad inference.");let f=a.filter((e,t)=>e===p[t]).length,g=f/e+t;f>1&&g>c&&(c=g,h=[i,s,o,l])}let[p,f,g,m]=h,y=Math.floor((f+p)/2),b=Math.floor((m+g)/2);i.push(...n.slice(0,y)),r=(n=u.slice(b)).length,s&&(a.push(...o.slice(0,y)),o=t[l].slice(b))}return(i.push(...n),s)?(a.push(...o),[i,a]):[i,[]]}collateWordTimestamps(e,t,n){let[r,i,s]=this.combineTokensIntoWords(e,n),a=[];for(let e=0;e<r.length;++e){let n=s[e];a.push({text:r[e],timestamp:[t[n.at(0)][0],t[n.at(-1)][1]]})}return a}combineTokensIntoWords(e,t,n="\"'\xa1\xbf([{-",r="\"'.,!?:)]}"){let i,s,a;return["chinese","japanese","thai","lao","myanmar"].includes(t=t??"english")?[i,s,a]=this.splitTokensOnUnicode(e):[i,s,a]=this.splitTokensOnSpaces(e),this.mergePunctuations(i,s,a,n,r)}decode(e,t){let n;return t&&t.decode_with_timestamps?(e instanceof Ft&&(e=Pd(e)),n=this.decodeWithTimestamps(e,t)):n=super.decode(e,t),n}decodeWithTimestamps(e,t){let n=t?.time_precision??.02,r=Array.from(this.all_special_ids).at(-1)+1,i=[[]];for(let t of e)if(t>=r){let e=D8((t-r)*n,2);i.push(`<|${e}|>`),i.push([])}else i[i.length-1].push(t);return(i=i.map(e=>"string"==typeof e?e:super.decode(e,t))).join("")}splitTokensOnUnicode(e){let t=this.decode(e,{decode_with_timestamps:!0}),n="",r=[],i=[],s=[],a=[],o=[],l=0;for(let u=0;u<e.length;++u){let c=e[u];a.push(c),o.push(u);let h=this.decode(a,{decode_with_timestamps:!0});h.includes(n)&&t[l+h.indexOf(n)]!==n||(r.push(h),i.push(a),s.push(o),a=[],o=[],l+=h.length)}return[r,i,s]}splitTokensOnSpaces(e){let[t,n,r]=this.splitTokensOnUnicode(e),i=[],s=[],a=[],o=RegExp(`^[${Pb}]$`,"gu");for(let e=0;e<t.length;++e){let l=t[e],u=n[e],c=r[e],h=u[0]>=this.model.tokens_to_ids.get("<|endoftext|>"),d=l.startsWith(" "),p=l.trim(),f=o.test(p);if(h||d||f||0===i.length)i.push(l),s.push(u),a.push(c);else{let e=i.length-1;i[e]+=l,s[e].push(...u),a[e].push(...c)}}return[i,s,a]}mergePunctuations(e,t,n,r,i){let s=structuredClone(e),a=structuredClone(t),o=structuredClone(n),l=s.length-2,u=s.length-1;for(;l>=0;)s[l].startsWith(" ")&&r.includes(s[l].trim())?(s[u]=s[l]+s[u],a[u]=Dc(a[l],a[u]),o[u]=Dc(o[l],o[u]),s[l]="",a[l]=[],o[l]=[]):u=l,--l;for(l=0,u=1;u<s.length;)!s[l].endsWith(" ")&&i.includes(s[u])?(s[l]+=s[u],a[l]=Dc(a[l],a[u]),o[l]=Dc(o[l],o[u]),s[u]="",a[u]=[],o[u]=[]):l=u,++u;return[s.filter(e=>e),a.filter(e=>e.length>0),o.filter(e=>e.length>0)]}get_decoder_prompt_ids({language:e=null,task:t=null,no_timestamps:n=!0}={}){let r=[];if(e){e=e.toLowerCase();let t=MW.get(e);if(void 0===t){if(MG.has(e))t=e;else{let t=2===e.length?MG.keys():MG.values();throw Error(`Language "${e}" is not supported. Must be one of: ${JSON.stringify(t)}`)}}let n=this.model.tokens_to_ids.get(`<|${t}|>`);if(void 0===n)throw Error(`Unable to find language "${t}" in model vocabulary. Please report this issue at https://github.com/xenova/transformers.js/issues/new/choose.`);r.push(n)}else r.push(null);if(t){if("transcribe"!==(t=t.toLowerCase())&&"translate"!==t)throw Error(`Task "${t}" is not supported. Must be one of: ["transcribe", "translate"]`);let e=this.model.tokens_to_ids.get(`<|${t}|>`);if(void 0===e)throw Error(`Unable to find task "${t}" in model vocabulary. Please report this issue at https://github.com/xenova/transformers.js/issues/new/choose.`);r.push(e)}else r.push(null);if(n){let e=this.model.tokens_to_ids.get("<|notimestamps|>");if(void 0===e)throw Error('Unable to find "<|notimestamps|>" in model vocabulary. Please report this issue at https://github.com/xenova/transformers.js/issues/new/choose.');r.push(e)}return r.map((e,t)=>[t+1,e]).filter(e=>null!==e[1])}}class MH extends Ml{}class MK extends Ml{}class MX extends Ml{}class MY extends Ml{constructor(e,t){super(e,t),this.languageRegex=/^(>>\w+<<)\s*/g,this.supported_language_codes=this.model.vocab.filter(e=>this.languageRegex.test(e)),console.warn('WARNING: `MarianTokenizer` is not yet supported by Hugging Face\'s "fast" tokenizers library. Therefore, you may experience slightly inaccurate results.')}_encode_text(e){if(null===e)return null;let[t,...n]=e.trim().split(this.languageRegex);if(0===n.length)return super._encode_text(t);if(2===n.length){let[e,t]=n;return this.supported_language_codes.includes(e)||console.warn(`Unsupported language code "${e}" detected, which may lead to unexpected behavior. Should be one of: ${JSON.stringify(this.supported_language_codes)}`),Dc([e],super._encode_text(t))}}}class MQ extends Ml{}class MJ extends Ml{_default_chat_template="{% for message in messages %}{% if message['role'] == 'user' %}{{ ' ' }}{% endif %}{{ message['content'] }}{% if not loop.last %}{{ '  ' }}{% endif %}{% endfor %}{{ eos_token }}"}class MZ extends MJ{}class M0 extends Ml{}class M1 extends Ml{}class M2 extends Ml{constructor(e,t){super(e,t),this.decoder=new P8({})}}class M3 extends Ml{}class M4{static TOKENIZER_CLASS_MAPPING={T5Tokenizer:Mx,DistilBertTokenizer:Mb,CamembertTokenizer:Mv,DebertaTokenizer:Mp,DebertaV2Tokenizer:Mf,BertTokenizer:Mu,HerbertTokenizer:Mg,ConvBertTokenizer:Mm,RoFormerTokenizer:My,XLMTokenizer:Mw,ElectraTokenizer:M_,MobileBertTokenizer:Mh,SqueezeBertTokenizer:Md,AlbertTokenizer:Mc,GPT2Tokenizer:MT,BartTokenizer:MI,MBartTokenizer:Mk,MBart50Tokenizer:MS,RobertaTokenizer:ME,WhisperTokenizer:Mq,CodeGenTokenizer:MH,CLIPTokenizer:MK,SiglipTokenizer:MX,MarianTokenizer:MY,BloomTokenizer:MC,NllbTokenizer:MU,M2M100Tokenizer:MV,LlamaTokenizer:MN,CodeLlamaTokenizer:MO,XLMRobertaTokenizer:M$,MPNetTokenizer:MR,FalconTokenizer:MD,GPTNeoXTokenizer:MF,EsmTokenizer:MP,Wav2Vec2CTCTokenizer:MQ,BlenderbotTokenizer:MJ,BlenderbotSmallTokenizer:MZ,SpeechT5Tokenizer:M0,NougatTokenizer:M1,VitsTokenizer:M2,Qwen2Tokenizer:MM,GemmaTokenizer:ML,Grok1Tokenizer:Mz,CohereTokenizer:M3,PreTrainedTokenizer:Ml};static async from_pretrained(e,{quantized:t=!0,progress_callback:n=null,config:r=null,cache_dir:i=null,local_files_only:s=!1,revision:a="main",legacy:o=null}={}){let[l,u]=await Pl(e,{quantized:t,progress_callback:n,config:r,cache_dir:i,local_files_only:s,revision:a,legacy:o}),c=u.tokenizer_class?.replace(/Fast$/,"")??"PreTrainedTokenizer",h=this.TOKENIZER_CLASS_MAPPING[c];return h||(console.warn(`Unknown tokenizer class "${c}", attempting to construct from base class.`),h=Ml),new h(l,u)}}async function M6(e,t){return await Dq(e,"config.json",!0,t)}class M5{constructor(e){this.model_type=null,this.is_encoder_decoder=!1,Object.assign(this,e)}static async from_pretrained(e,{progress_callback:t=null,config:n=null,cache_dir:r=null,local_files_only:i=!1,revision:s="main"}={}){return new this(n??await M6(e,{progress_callback:t,config:n,cache_dir:r,local_files_only:i,revision:s}))}}class M8{static async from_pretrained(...e){return M5.from_pretrained(...e)}}class M7 extends Di{constructor(){super(),this.processors=[]}push(e){this.processors.push(e)}extend(e){this.processors.push(...e)}_call(e,t){for(let n of t)this.processors.forEach(t=>t(e,n))}[Symbol.iterator](){return this.processors.values()}}class M9 extends Di{_call(e,t){throw Error("`_call` should be implemented in a subclass")}}class Le extends M9{constructor(e){super(),this.force_token_map=Object.fromEntries(e??[])}_call(e,t){let n=this.force_token_map[e.length];return Do(n)&&(t.data.fill(-1/0),t.data[n]=0),t}}class Lt extends M9{constructor(e){super(),this.bos_token_id=e}_call(e,t){return 1===e.length&&(t.data.fill(-1/0),t.data[this.bos_token_id]=0),t}}class Ln extends M9{constructor(e,t){super(),this.max_length=e,this.forced_eos_token_id=t}_call(e,t){}}class Lr extends M9{constructor(e,t){super(),this.begin_suppress_tokens=e,this.begin_index=t}_call(e,t){if(e.length===this.begin_index)for(let e of this.begin_suppress_tokens)t.data[e]=-1/0;return t}}class Li extends M9{constructor(e){super(),this.eos_token_id=e.eos_token_id,this.no_timestamps_token_id=e.no_timestamps_token_id,this.timestamp_begin=this.no_timestamps_token_id+1,this.begin_index=(e.forced_decoder_ids||[]).length+2,e.forced_decoder_ids.slice(-1)[0][1]===this.no_timestamps_token_id&&(this.begin_index-=1),this.max_initial_timestamp_index=e.max_initial_timestamp_index}_call(e,t){let n=t.data;if(n[this.no_timestamps_token_id]=-1/0,e.length===this.begin_index-1)return n.fill(-1/0),n[this.timestamp_begin]=0,t;let r=e.slice(this.begin_index),i=r.length>=1&&r[r.length-1]>=this.timestamp_begin,s=r.length<2||r[r.length-2]>=this.timestamp_begin;if(i&&(s?n.subarray(this.timestamp_begin).fill(-1/0):n.subarray(0,this.eos_token_id).fill(-1/0)),e.length===this.begin_index&&null!==this.max_initial_timestamp_index){let e=this.timestamp_begin+this.max_initial_timestamp_index;n.subarray(e+1).fill(-1/0)}let a=DJ(n);return Math.log(a.subarray(this.timestamp_begin).map(Math.exp).reduce((e,t)=>e+t))>D1(a.subarray(0,this.timestamp_begin))[0]&&n.subarray(0,this.timestamp_begin).fill(-1/0),t}}class Ls extends M9{constructor(e){super(),this.no_repeat_ngram_size=e}getNgrams(e){let t=e.length,n=[];for(let r=0;r<t+1-this.no_repeat_ngram_size;++r){let t=[];for(let n=0;n<this.no_repeat_ngram_size;++n)t.push(e[r+n]);n.push(t)}let r=new Map;for(let e of n){let t=JSON.stringify(e.slice(0,e.length-1)),n=r.get(t)??[];n.push(e[e.length-1]),r.set(t,n)}return r}getGeneratedNgrams(e,t){let n=t.slice(t.length+1-this.no_repeat_ngram_size,t.length);return e.get(JSON.stringify(n))??[]}calcBannedNgramTokens(e){let t=[];if(e.length+1<this.no_repeat_ngram_size)return t;{let t=this.getNgrams(e);return this.getGeneratedNgrams(t,e)}}_call(e,t){for(let n of this.calcBannedNgramTokens(e))t.data[n]=-1/0;return t}}class La extends M9{constructor(e){super(),this.penalty=e}_call(e,t){for(let n of e)t.data[n]<0?t.data[n]*=this.penalty:t.data[n]/=this.penalty;return t}}class Lo extends M9{constructor(e,t){super(),this.min_length=e,this.eos_token_id=Array.isArray(t)?t:[t]}_call(e,t){if(e.length<this.min_length)for(let e of this.eos_token_id)t.data[e]=-1/0;return t}}class Ll extends M9{constructor(e,t,n){super(),this.prompt_length_to_skip=e,this.min_new_tokens=t,this.eos_token_id=Array.isArray(n)?n:[n]}_call(e,t){if(e.length-this.prompt_length_to_skip<this.min_new_tokens)for(let e of this.eos_token_id)t.data[e]=-1/0;return t}}class Lu extends M9{constructor(e,t){super(),this.bad_words_ids=e,this.eos_token_id=Array.isArray(t)?t:[t]}_call(e,t){for(let n of this.bad_words_ids){let r=!0;for(let t=1;t<=n.length-1&&n.length<e.length;++t)if(n.at(-t-1)!==e.at(-t)){r=!1;break}r&&(t.data[n.at(-1)]=-1/0)}return t}}let Lc=class{constructor(e={}){this.max_length=e.max_length??20,this.max_new_tokens=e.max_new_tokens??null,this.min_length=e.min_length??0,this.min_new_tokens=e.min_new_tokens??null,this.early_stopping=e.early_stopping??!1,this.max_time=e.max_time??null,this.do_sample=e.do_sample??!1,this.num_beams=e.num_beams??1,this.num_beam_groups=e.num_beam_groups??1,this.penalty_alpha=e.penalty_alpha??null,this.use_cache=e.use_cache??!0,this.temperature=e.temperature??1,this.top_k=e.top_k??50,this.top_p=e.top_p??1,this.typical_p=e.typical_p??1,this.epsilon_cutoff=e.epsilon_cutoff??0,this.eta_cutoff=e.eta_cutoff??0,this.diversity_penalty=e.diversity_penalty??0,this.repetition_penalty=e.repetition_penalty??1,this.encoder_repetition_penalty=e.encoder_repetition_penalty??1,this.length_penalty=e.length_penalty??1,this.no_repeat_ngram_size=e.no_repeat_ngram_size??0,this.bad_words_ids=e.bad_words_ids??null,this.force_words_ids=e.force_words_ids??null,this.renormalize_logits=e.renormalize_logits??!1,this.constraints=e.constraints??null,this.forced_bos_token_id=e.forced_bos_token_id??null,this.forced_eos_token_id=e.forced_eos_token_id??null,this.remove_invalid_values=e.remove_invalid_values??!1,this.exponential_decay_length_penalty=e.exponential_decay_length_penalty??null,this.suppress_tokens=e.suppress_tokens??null,this.begin_suppress_tokens=e.begin_suppress_tokens??null,this.forced_decoder_ids=e.forced_decoder_ids??null,this.num_return_sequences=e.num_return_sequences??1,this.output_attentions=e.output_attentions??!1,this.output_hidden_states=e.output_hidden_states??!1,this.output_scores=e.output_scores??!1,this.return_dict_in_generate=e.return_dict_in_generate??!1,this.pad_token_id=e.pad_token_id??null,this.bos_token_id=e.bos_token_id??null,this.eos_token_id=e.eos_token_id??null,this.encoder_no_repeat_ngram_size=e.encoder_no_repeat_ngram_size??0,this.decoder_start_token_id=e.decoder_start_token_id??null,this.generation_kwargs=e.generation_kwargs??{}}};class Lh extends Di{constructor(e){super(),this.generation_config=e}_call(e,t=-1){return this.sample(e,t)}sample(e,t){throw Error("sample should be implemented in subclasses.")}getLogits(e,t){let n=e.dims.at(-1),r=e.data;if(-1===t)r=r.slice(-n);else{let e=t*n;r=r.slice(e,e+n)}return this.generation_config.temperature>0&&(r=r.map(e=>e/this.generation_config.temperature)),r}randomSelect(e){let t=Math.random()*e.reduce((e,t)=>e+t,0);for(let n=0;n<e.length;++n)if((t-=e[n])<=0)return n;return 0}static getSampler(e){if(e.do_sample)return new Lp(e);if(e.num_beams>1)return new Lf(e);if(e.num_return_sequences>1)throw Error(`num_return_sequences has to be 1 when doing greedy search, but is ${e.num_return_sequences}.`);return new Ld(e)}}class Ld extends Lh{sample(e,t=-1){return[[D1(this.getLogits(e,t))[1],0]]}}class Lp extends Lh{sample(e,t=-1){let n=e.dims.at(-1);this.generation_config.top_k>0&&(n=Math.min(this.generation_config.top_k,n));let r=DZ(this.getLogits(e,t),n),i=DQ(r.map(e=>e[1]));return Array.from({length:this.generation_config.num_beams},()=>{let e=this.randomSelect(i);return[r[e][0],Math.log(i[e])]})}}class Lf extends Lh{sample(e,t=-1){let n=e.dims.at(-1);this.generation_config.top_k>0&&(n=Math.min(this.generation_config.top_k,n));let r=DZ(this.getLogits(e,t),n),i=DQ(r.map(e=>e[1]));return Array.from({length:this.generation_config.num_beams},(e,t)=>[r[t][0],Math.log(i[t])])}}let{InferenceSession:Lg,Tensor:Lm,env:Ly}=c,Lb={EncoderOnly:0,EncoderDecoder:1,Seq2Seq:2,Vision2Seq:3,DecoderOnly:4,MaskGeneration:5},Lv=new Map,Lw=new Map,L_=new Map;async function Lx(e,t,n){let r=`onnx/${t}${n.quantized?"_quantized":""}.onnx`,i=await DW(e,r,!0,n);try{return await Lg.create(i,{executionProviders:DT})}catch(e){if(1===DT.length&&"wasm"===DT[0])throw e;return console.warn(e),console.warn("Something went wrong during model construction (most likely a missing operation). Using `wasm` as a fallback. "),await Lg.create(i,{executionProviders:["wasm"]})}}function LT(e,t){let n=Object.create(null),r=[];for(let i of e.inputNames){let e=t[i];if(!(e instanceof Ft)){r.push(i);continue}n[i]=Ly.wasm.proxy?e.clone():e}if(r.length>0)throw Error(`An error occurred during model execution: "Missing the following inputs: ${r.join(", ")}.`);let i=Object.keys(t).length,s=e.inputNames.length;if(i>s){let n=Object.keys(t).filter(t=>!e.inputNames.includes(t));console.warn(`WARNING: Too many inputs were provided (${i} > ${s}). The following inputs will be ignored: "${n.join(", ")}".`)}return n}async function LI(e,t){let n=LT(e,t);try{let t=await e.run(n);return t=Lk(t)}catch(e){throw console.error(`An error occurred during model execution: "${e}".`),console.error("Inputs given to model:",n),e}}function Lk(e){for(let t in e)e[t]instanceof Lm?e[t]=new Ft(e[t]):"object"==typeof e[t]&&Lk(e[t]);return e}function LS(e){if(e instanceof Ft)return e;if(0===e.length)throw Error("items must be non-empty");if(!Array.isArray(e[0]))return new Ft("int64",BigInt64Array.from(e.map(e=>BigInt(e))),[1,e.length]);if(e.some(t=>t.length!==e[0].length))throw Error("Unable to create tensor, you should probably activate truncation and/or padding with 'padding=True' and/or 'truncation=True' to have batched tensors with the same length.");return new Ft("int64",BigInt64Array.from(e.flat().map(e=>BigInt(e))),[e.length,e[0].length])}function LE(e,t){let n=e.config.pad_token_id??null,r=e.config.eos_token_id??null;Da(r)&&(r=[r]);let i=-1!==t.indexOf(n),s=null===r||!r.includes(n);return i&&s?new Ft("int64",BigInt64Array.from(t.data.map(e=>e!=n)),t.dims):Fm(t)}function LC(e,t,n){if(!e.inputNames.includes("position_ids"))return;let r=new BigInt64Array(t.attention_mask.data.length);for(let e=0;e<t.attention_mask.dims[0];++e){let n=e*t.attention_mask.dims[1],i=BigInt(0);for(let e=0;e<t.attention_mask.dims[1];++e){let s=n+e;0n===t.attention_mask.data[s]?r[s]=BigInt(1):(r[s]=i,i+=t.attention_mask.data[s])}}t.position_ids=new Ft("int64",r,t.attention_mask.dims),n&&(t.position_ids=t.position_ids.slice(null,-1).unsqueeze_(-1))}function LA(e){return new Ft("bool",[e],[1])}async function LN(e,t){let{encoder_outputs:n,past_key_values:r}=t;n||(n=(await LD(e,t)).last_hidden_state);let i={input_ids:t.decoder_input_ids,encoder_hidden_states:n},s=!!r;e.decoder_merged_session.inputNames.includes("use_cache_branch")&&(i.use_cache_branch=LA(s)),e.decoder_merged_session.inputNames.includes("encoder_attention_mask")&&(i.encoder_attention_mask=t.attention_mask),LC(e.decoder_merged_session,i,s),e.addPastKeyValues(i,r);let a=await LI(e.decoder_merged_session,i);return new Gm({logits:a.logits,past_key_values:r=e.getPastKeyValues(a,r),encoder_outputs:n,...e.getAttentions(a)})}function LO(e,t,n,r){let i=[],s=0,a=e.requires_attention_mask??!0,o=n.decoder_input_ids??n.decoder_start_token_id??n.bos_token_id??n.eos_token_id;for(let n of(o instanceof Ft?o=o.tolist().flat():Array.isArray(o)||(o=[o]),t)){n.dims=[1,...n.dims];let t={inputs:n,encoder_outputs:null,prev_model_outputs:null,output_token_ids:o,done:!1,score:0,id:s++};a&&(t.attention_mask=LE(e,n)),i.push(t)}return i}async function L$(e,t){let n=e.main_input_name,r=t.output_token_ids;t.prev_model_outputs&&(r=r.slice(-1));let i={[n]:t.inputs,decoder_input_ids:LS(r),encoder_outputs:t.encoder_outputs,past_key_values:t.prev_model_outputs?.past_key_values};t.attention_mask&&(i.attention_mask=t.attention_mask);let s=await e.forward(i);return t.prev_model_outputs=s,t.encoder_outputs=s.encoder_outputs,s}function LR(e,t){e.output_token_ids=[...e.output_token_ids,t]}async function LD(e,t){let n=Object.create(null);for(let r of e.session.inputNames)n[r]=t[r];return e.session.inputNames.includes("token_type_ids")&&!n.token_type_ids&&(n.token_type_ids=new Ft("int64",new BigInt64Array(n.input_ids.data.length),n.input_ids.dims)),await LI(e.session,n)}async function LF(e,t){let{input_ids:n,past_key_values:r,attention_mask:i}=t,s={input_ids:n,attention_mask:i??LE(e,n)},a=!!r;e.session.inputNames.includes("use_cache_branch")&&(s.use_cache_branch=LA(a)),LC(e.session,s,a),e.addPastKeyValues(s,r);let o=await LI(e.session,s);return{logits:o.logits,past_key_values:r=e.getPastKeyValues(o,r)}}function LP(e,t,n,r,i){let s=[],a=0;for(let n of t){let t,o=n.tolist().map(Number);n.dims=[1,...n.dims],i?(t=i[a]).dims=[1,...t.dims]:t=LE(e,n);let l={input:n,model_input_ids:n,attention_mask:t,prev_model_outputs:null,output_token_ids:o,num_output_tokens:r,done:!1,score:0,id:a++};s.push(l)}return s}async function LM(e,t){let n=new BigInt64Array(t.output_token_ids.length).fill(1n),r={input_ids:t.model_input_ids,attention_mask:new Ft("int64",n,[1,n.length]),past_key_values:t.prev_model_outputs?.past_key_values},i=await e.forward(r);return t.prev_model_outputs=i,i}function LL(e,t){e.output_token_ids=[...e.output_token_ids,t],e.model_input_ids=new Ft("int64",[BigInt(t)],[1,1])}class Lz extends Di{main_input_name="input_ids";constructor(e,t){super(),this.config=e,this.session=t;let n=L_.get(this.constructor),r=Lv.get(n);this.can_generate=!1,this._runBeam=null,this._getStartBeams=null,this._updateBeam=null,this._forward=null,r===Lb.DecoderOnly?(this.can_generate=!0,this._runBeam=LM,this._getStartBeams=LP,this._updateBeam=LL,this._forward=LF):r===Lb.Seq2Seq||r===Lb.Vision2Seq?(this.can_generate=!0,this._runBeam=L$,this._getStartBeams=LO,this._updateBeam=LR,this._forward=LN):(Lb.EncoderDecoder,this._forward=LD)}async dispose(){let e=[];for(let t of Object.keys(this)){let n=this[t];n instanceof Lg&&e.push(n.handler.dispose())}return await Promise.all(e)}static async from_pretrained(e,{quantized:t=!0,progress_callback:n=null,config:r=null,cache_dir:i=null,local_files_only:s=!1,revision:a="main",model_file_name:o=null}={}){let l,u={quantized:t,progress_callback:n,config:r,cache_dir:i,local_files_only:s,revision:a,model_file_name:o},c=L_.get(this),h=Lv.get(c);return h===Lb.DecoderOnly?l=await Promise.all([M8.from_pretrained(e,u),Lx(e,u.model_file_name??"decoder_model_merged",u),Dq(e,"generation_config.json",!1,u)]):h===Lb.Seq2Seq||h===Lb.Vision2Seq?l=await Promise.all([M8.from_pretrained(e,u),Lx(e,"encoder_model",u),Lx(e,"decoder_model_merged",u),Dq(e,"generation_config.json",!1,u)]):h===Lb.MaskGeneration?l=await Promise.all([M8.from_pretrained(e,u),Lx(e,"vision_encoder",u),Lx(e,"prompt_encoder_mask_decoder",u)]):h===Lb.EncoderDecoder?l=await Promise.all([M8.from_pretrained(e,u),Lx(e,"encoder_model",u),Lx(e,"decoder_model_merged",u)]):(h!==Lb.EncoderOnly&&console.warn(`Model type for '${c??r?.model_type}' not found, assuming encoder-only architecture. Please report this at https://github.com/xenova/transformers.js/issues/new/choose.`),l=await Promise.all([M8.from_pretrained(e,u),Lx(e,u.model_file_name??"model",u)])),new this(...l)}async _call(e){return await this.forward(e)}async forward(e){return await this._forward(this,e)}_get_logits_processor(e,t,n=null){let r=new M7;if(null!==e.repetition_penalty&&1!==e.repetition_penalty&&r.push(new La(e.repetition_penalty)),null!==e.no_repeat_ngram_size&&e.no_repeat_ngram_size>0&&r.push(new Ls(e.no_repeat_ngram_size)),null!==e.bad_words_ids&&r.push(new Lu(e.bad_words_ids,e.eos_token_id)),null!==e.min_length&&null!==e.eos_token_id&&e.min_length>0&&r.push(new Lo(e.min_length,e.eos_token_id)),null!==e.min_new_tokens&&null!==e.eos_token_id&&e.min_new_tokens>0&&r.push(new Ll(t,e.min_new_tokens,e.eos_token_id)),null!==e.forced_bos_token_id&&r.push(new Lt(e.forced_bos_token_id)),null!==e.forced_eos_token_id&&r.push(new Ln(e.max_length,e.forced_eos_token_id)),null!==e.begin_suppress_tokens){let n=t>1||null===e.forced_bos_token_id?t:t+1;null!==e.forced_decoder_ids&&(n+=e.forced_decoder_ids[e.forced_decoder_ids.length-1][0]),r.push(new Lr(e.begin_suppress_tokens,n))}return null!==e.forced_decoder_ids&&r.push(new Le(e.forced_decoder_ids)),null!==n&&r.extend(n),r}_get_generation_config(e){let t=new Lc(this.config);return"generation_config"in this&&Object.assign(t,this.generation_config),null!==e&&Object.assign(t,e),t}async generate(e,t=null,n=null,{inputs_attention_mask:r=null}={}){let i;if(!this.can_generate){let e=L_.get(this.constructor),t=`The current model class (${e}) is not compatible with \`.generate()\`, as it doesn't have a language model head.`,n=this.config.model_type,r=jL.get(n)??jM.get(n)??j$.get(n)??jU.get(n);throw r&&(t+=` Please use the following class instead: '${r[0]}'`),Error(t)}if(!(e instanceof Ft)&&!Ds(e)&&!Array.isArray(e))throw Error(`\`inputs\` must be a Tensor, TypedArray, or Array, but is "${e.constructor.name}".`);if(this.config.is_encoder_decoder)i=0;else if(0===(i=e instanceof Ft?e.dims.at(-1):e.length))throw Error("Must supply a non-empty array of input token ids.");t=this._get_generation_config(t),n=n??new M7,n=this._get_logits_processor(t,i,n);let s=t.eos_token_id;null===s||Array.isArray(s)||(s=[s]);let a=1,o=1+(t.max_new_tokens??1/0),l=Number.isInteger(t.max_length)&&(t.max_new_tokens??null)===null,u=Lh.getSampler(t),c=this.getStartBeams(e,t,a,r);for(;c.some(e=>!e.done)&&a<o;){let e=[];for(let r of c){if(r.done){e.push(r);continue}if(l&&r.output_token_ids.length>=t.max_length){r.done=!0,e.push(r);continue}let i=await this.runBeam(r);t.output_attentions&&this.addAttentionsToBeam(r,i),t.output_scores;let a=i.logits.slice(null,-1,null);for(let[t,i]of(n(r.output_token_ids,a),u(a))){let n={...r};this.updateBeam(n,t),n.score+=i,s&&s.includes(t)&&(n.done=!0),e.push(n)}}++a,c=(e=this.groupBeams(e).map(e=>e.sort((e,t)=>t.score-e.score).slice(0,t.num_beams))).flat(),t.callback_function&&t.callback_function(c)}let h=this.groupBeams(c),d=e=>h.map(n=>t.num_return_sequences>1?n.slice(0,t.num_return_sequences).map(t=>t[e]):[n[0][e]]).flat(),p=d("output_token_ids");return t.return_dict_in_generate?{sequences:p,decoder_attentions:d("decoder_attentions"),cross_attentions:d("cross_attentions")}:p}addAttentionsToBeam(e,t){if(this.config.is_encoder_decoder){if(!t.cross_attentions||0===t.cross_attentions.length)throw Error("`output_attentions` is true, but the model did not produce cross-attentions. This is most likely because the model was not exported with `output_attentions=True`.");e.cross_attentions||(e.cross_attentions=[]),e.cross_attentions.push(t.cross_attentions)}if(!t.decoder_attentions||0===t.decoder_attentions.length)throw Error("`output_attentions` is true, but the model did not produce decoder-attentions. This is most likely because the model was not exported with `output_attentions=True`.");e.decoder_attentions||(e.decoder_attentions=[]),e.decoder_attentions.push(t.decoder_attentions)}groupBeams(e){let t=Object.create(null);for(let n of e)void 0===t[n.id]?t[n.id]=[n]:t[n.id].push(n);return Object.values(t)}getPastKeyValues(e,t){let n=Object.create(null);for(let r in e)if(r.startsWith("present")){let i=r.replace("present","past_key_values");t&&r.includes("encoder")?n[i]=t[i]:n[i]=e[r]}return n}getAttentions(e){let t=Object.create(null);for(let n of["cross_attentions","decoder_attentions"]){let r=[];for(let t in e)t.startsWith(n)&&(r[t.split(".").pop()]=e[t]);t[n]=r}return t}addPastKeyValues(e,t){if(t)Object.assign(e,t);else{let t=1;if(this.config.is_encoder_decoder&&(this.add_encoder_pkv??!0)){let n=[t,this.num_encoder_heads,0,this.encoder_dim_kv],r=[t,this.num_decoder_heads,0,this.decoder_dim_kv];for(let t=0;t<this.num_decoder_layers;++t)e[`past_key_values.${t}.encoder.key`]=new Ft("float32",[],n),e[`past_key_values.${t}.encoder.value`]=new Ft("float32",[],n),e[`past_key_values.${t}.decoder.key`]=new Ft("float32",[],r),e[`past_key_values.${t}.decoder.value`]=new Ft("float32",[],r)}else if("falcon"===this.config.model_type){let n=[t*this.num_heads,0,this.dim_kv];for(let t=0;t<this.num_layers;++t)e[`past_key_values.${t}.key`]=new Ft("float32",[],n),e[`past_key_values.${t}.value`]=new Ft("float32",[],n)}else if(this.config.multi_query){let n=[t*this.num_heads,0,2*this.dim_kv];for(let t=0;t<this.num_layers;++t)e[`past_key_values.${t}.key_value`]=new Ft("float32",[],n)}else if("bloom"===this.config.model_type){let n=[t*this.num_heads,this.dim_kv,0],r=[t*this.num_heads,0,this.dim_kv];for(let t=0;t<this.num_layers;++t)e[`past_key_values.${t}.key`]=new Ft("float32",[],n),e[`past_key_values.${t}.value`]=new Ft("float32",[],r)}else{let n=[t,this.num_heads,0,this.dim_kv];for(let t=0;t<this.num_layers;++t)e[`past_key_values.${t}.key`]=new Ft("float32",[],n),e[`past_key_values.${t}.value`]=new Ft("float32",[],n)}}}getStartBeams(e,t,n,r){return this._getStartBeams(this,e,t,n,r)}async runBeam(e){return await this._runBeam(this,e)}updateBeam(e,t){return this._updateBeam(e,t)}}class LB{}class LU extends Lz{}class LV extends LU{}class Lj extends LU{async _call(e){return new Gw(await super._call(e))}}class LG extends LU{async _call(e){return new Gy(await super._call(e))}}class LW extends LU{async _call(e){return new Gv(await super._call(e))}}class Lq extends LU{async _call(e){return new G_(await super._call(e))}}class LH extends Lz{}class LK extends LH{}class LX extends Lz{}class LY extends LX{}class LQ extends LX{async _call(e){return new Gw(await super._call(e))}}class LJ extends LX{async _call(e){return new Gy(await super._call(e))}}class LZ extends LX{async _call(e){return new Gv(await super._call(e))}}class L0 extends LX{async _call(e){return new G_(await super._call(e))}}class L1 extends Lz{}class L2 extends L1{}class L3 extends L1{async _call(e){return new Gw(await super._call(e))}}class L4 extends L1{async _call(e){return new Gy(await super._call(e))}}class L6 extends L1{async _call(e){return new Gv(await super._call(e))}}class L5 extends L1{async _call(e){return new G_(await super._call(e))}}class L8 extends Lz{}class L7 extends L8{}class L9 extends L8{async _call(e){return new Gw(await super._call(e))}}class ze extends L8{async _call(e){return new Gy(await super._call(e))}}class zt extends L8{async _call(e){return new Gv(await super._call(e))}}class zn extends L8{async _call(e){return new G_(await super._call(e))}}class zr extends Lz{}class zi extends zr{}class zs extends zr{async _call(e){return new Gw(await super._call(e))}}class za extends zr{async _call(e){return new Gy(await super._call(e))}}class zo extends zr{async _call(e){return new Gv(await super._call(e))}}class zl extends zr{async _call(e){return new G_(await super._call(e))}}class zu extends Lz{}class zc extends zu{}class zh extends zu{async _call(e){return new Gw(await super._call(e))}}class zd extends zu{async _call(e){return new Gy(await super._call(e))}}class zp extends zu{async _call(e){return new Gv(await super._call(e))}}class zf extends zu{async _call(e){return new G_(await super._call(e))}}class zg extends Lz{}class zm extends zg{}class zy extends zg{async _call(e){return new Gw(await super._call(e))}}class zb extends zg{async _call(e){return new Gy(await super._call(e))}}class zv extends zg{async _call(e){return new Gv(await super._call(e))}}class zw extends zg{async _call(e){return new G_(await super._call(e))}}class z_ extends Lz{}class zx extends z_{}class zT extends z_{async _call(e){return new Gy(await super._call(e))}}class zI extends z_{async _call(e){return new Gv(await super._call(e))}}class zk extends z_{async _call(e){return new G_(await super._call(e))}}class zS extends z_{async _call(e){return new Gw(await super._call(e))}}class zE extends Lz{}class zC extends zE{}class zA extends zE{async _call(e){return new Gw(await super._call(e))}}class zN extends zE{async _call(e){return new Gy(await super._call(e))}}class zO extends zE{async _call(e){return new Gv(await super._call(e))}}class z$ extends Lz{}class zR extends z${}class zD extends z${async _call(e){return new Gw(await super._call(e))}}class zF extends z${async _call(e){return new Gy(await super._call(e))}}class zP extends z${async _call(e){return new G_(await super._call(e))}}class zM extends Lz{}class zL extends zM{}class zz extends zM{async _call(e){return new Gw(await super._call(e))}}class zB extends zM{async _call(e){return new Gy(await super._call(e))}}class zU extends zM{async _call(e){return new Gv(await super._call(e))}}class zV extends zM{async _call(e){return new G_(await super._call(e))}}class zj extends Lz{}class zG extends zj{}class zW extends zj{async _call(e){return new Gw(await super._call(e))}}class zq extends zj{async _call(e){return new Gy(await super._call(e))}}class zH extends zj{async _call(e){return new G_(await super._call(e))}}class zK extends Lz{}class zX extends zK{}class zY extends zK{async _call(e){return new Gy(await super._call(e))}}class zQ extends zK{async _call(e){return new G_(await super._call(e))}}class zJ extends zK{async _call(e){return new Gw(await super._call(e))}}class zZ extends Lz{}class z0 extends zZ{}class z1 extends zZ{constructor(e,t,n,r){super(e,t),this.decoder_merged_session=n,this.generation_config=r,this.num_decoder_layers=this.config.num_decoder_layers,this.num_decoder_heads=this.config.num_heads,this.decoder_dim_kv=this.config.d_kv,this.num_encoder_layers=this.config.num_layers,this.num_encoder_heads=this.config.num_heads,this.encoder_dim_kv=this.config.d_kv}}class z2 extends Lz{}class z3 extends z2{}class z4 extends z2{constructor(e,t,n,r){super(e,t),this.decoder_merged_session=n,this.generation_config=r,this.num_decoder_layers=this.config.num_decoder_layers,this.num_decoder_heads=this.config.num_heads,this.decoder_dim_kv=this.config.d_kv,this.num_encoder_layers=this.config.num_layers,this.num_encoder_heads=this.config.num_heads,this.encoder_dim_kv=this.config.d_kv}}class z6 extends Lz{}class z5 extends z6{}class z8 extends z6{constructor(e,t,n,r){super(e,t),this.decoder_merged_session=n,this.generation_config=r,this.num_decoder_layers=this.config.num_decoder_layers,this.num_decoder_heads=this.config.num_heads,this.decoder_dim_kv=this.config.d_kv,this.num_encoder_layers=this.config.num_layers,this.num_encoder_heads=this.config.num_heads,this.encoder_dim_kv=this.config.d_kv}}class z7 extends Lz{}class z9 extends z7{}class Be extends z7{constructor(e,t,n,r){super(e,t),this.decoder_merged_session=n,this.generation_config=r,this.num_decoder_layers=this.config.decoder_layers,this.num_decoder_heads=this.config.decoder_attention_heads,this.decoder_dim_kv=this.config.d_model/this.num_decoder_heads,this.num_encoder_layers=this.config.encoder_layers,this.num_encoder_heads=this.config.encoder_attention_heads,this.encoder_dim_kv=this.config.d_model/this.num_encoder_heads}}class Bt extends z7{async _call(e){return new Gy(await super._call(e))}}class Bn extends Lz{}class Br extends Bn{}class Bi extends Bn{constructor(e,t,n,r){super(e,t),this.decoder_merged_session=n,this.generation_config=r,this.num_decoder_layers=this.config.decoder_layers,this.num_decoder_heads=this.config.decoder_attention_heads,this.decoder_dim_kv=this.config.d_model/this.num_decoder_heads,this.num_encoder_layers=this.config.encoder_layers,this.num_encoder_heads=this.config.encoder_attention_heads,this.encoder_dim_kv=this.config.d_model/this.num_encoder_heads}}class Bs extends Bn{async _call(e){return new Gy(await super._call(e))}}class Ba extends Bn{constructor(e,t,n){super(e,t),this.generation_config=n,this.num_decoder_layers=this.config.decoder_layers,this.num_decoder_heads=this.config.decoder_attention_heads,this.decoder_dim_kv=this.config.d_model/this.num_decoder_heads,this.num_encoder_layers=this.config.encoder_layers,this.num_encoder_heads=this.config.encoder_attention_heads,this.encoder_dim_kv=this.config.d_model/this.num_encoder_heads}}class Bo extends Lz{}class Bl extends Bo{}class Bu extends Bo{constructor(e,t,n,r){super(e,t),this.decoder_merged_session=n,this.generation_config=r,this.num_decoder_layers=this.config.decoder_layers,this.num_decoder_heads=this.config.decoder_attention_heads,this.decoder_dim_kv=this.config.d_model/this.num_decoder_heads,this.num_encoder_layers=this.config.encoder_layers,this.num_encoder_heads=this.config.encoder_attention_heads,this.encoder_dim_kv=this.config.d_model/this.num_encoder_heads}}class Bc extends Lz{}class Bh extends Bc{}class Bd extends Bc{constructor(e,t,n,r){super(e,t),this.decoder_merged_session=n,this.generation_config=r,this.num_decoder_layers=this.config.decoder_layers,this.num_decoder_heads=this.config.decoder_attention_heads,this.decoder_dim_kv=this.config.d_model/this.num_decoder_heads,this.num_encoder_layers=this.config.encoder_layers,this.num_encoder_heads=this.config.encoder_attention_heads,this.encoder_dim_kv=this.config.d_model/this.num_encoder_heads}}class Bp extends Lz{}class Bf extends Bp{}class Bg extends Bp{async _call(e){return new Gw(await super._call(e))}}class Bm extends Bp{async _call(e){return new Gy(await super._call(e))}}class By extends Bp{async _call(e){return new Gv(await super._call(e))}}class Bb extends Bp{async _call(e){return new G_(await super._call(e))}}class Bv extends Lz{}class Bw extends Bv{}class B_ extends Bv{async _call(e){return new Gw(await super._call(e))}}class Bx extends Bv{async _call(e){return new Gy(await super._call(e))}}class BT extends Bv{async _call(e){return new Gv(await super._call(e))}}class BI extends Bv{async _call(e){return new G_(await super._call(e))}}class Bk extends Lz{}class BS extends Bk{}class BE extends Bk{async _call(e){return new Gw(await super._call(e))}}class BC extends Bk{async _call(e){return new Gy(await super._call(e))}}class BA extends Bk{async _call(e){return new Gv(await super._call(e))}}class BN extends Bk{async _call(e){return new G_(await super._call(e))}}class BO extends Lz{}class B$ extends BO{}class BR extends BO{}class BD extends Lz{}class BF extends BD{}class BP extends BD{requires_attention_mask=!1;main_input_name="input_features";constructor(e,t,n,r){super(e,t),this.decoder_merged_session=n,this.generation_config=r,this.num_decoder_layers=this.config.decoder_layers,this.num_decoder_heads=this.config.decoder_attention_heads,this.decoder_dim_kv=this.config.d_model/this.num_decoder_heads,this.num_encoder_layers=this.config.encoder_layers,this.num_encoder_heads=this.config.encoder_attention_heads,this.encoder_dim_kv=this.config.d_model/this.num_encoder_heads}async generate(e,t=null,n=null){if(t=this._get_generation_config(t),t.return_timestamps??=!1,t.return_timestamps&&(n=[new Li(t)]),t.return_token_timestamps&&(t.output_attentions=!0,t.return_dict_in_generate=!0,"translate"===t.task&&console.warn("Token-level timestamps may not be reliable for task 'translate'."),!t.alignment_heads))throw Error("Model generation config has no `alignment_heads`, token-level timestamps not available. See https://gist.github.com/hollance/42e32852f24243b748ae6bc1f985b13a on how to add this property to the generation config.");let r=await super.generate(e,t,n);return t.return_token_timestamps&&t.alignment_heads&&(r.token_timestamps=this._extract_token_timestamps(r,t.alignment_heads,t.num_frames)),r}_extract_token_timestamps(e,t,n=null,r=.02){if(!e.cross_attentions)throw Error("Model outputs must contain cross attentions to extract timestamps. This is most likely because the model was not exported with `output_attentions=True`.");let i=this.config.median_filter_width;void 0===i&&(console.warn("Model config has no `median_filter_width`, using default value of 7."),i=7);let s=e.cross_attentions.map(e=>{let r=Array.from({length:this.config.decoder_layers},(t,n)=>Fu(e.map(e=>e[n]),2)),s=Fc(t.map(([e,t])=>n?r[e].slice(null,t,null,[0,n]):r[e].slice(null,t))),[a,o]=Fh(s=s.transpose(1,0,2,3),-2,0,!0),l=s.clone();for(let e=0;e<l.dims[0];++e){let t=l[e];for(let n=0;n<t.dims[0];++n){let r=t[n],s=a[e][n][0],l=o[e][n][0];for(let e=0;e<r.dims[0];++e){let t=r[e];for(let e=0;e<t.data.length;++e)t.data[e]=(t.data[e]-l.data[e])/s.data[e];t.data.set(D5(t.data,i))}}}return Fd(l,1)}),a=[e.sequences.length,e.sequences[0].length],o=new Ft("float32",new Float32Array(a[0]*a[1]),a);for(let e=0;e<a[0];++e){let[t,n]=Fp(s[e].neg().squeeze_(0)),i=Dc([1],Array.from({length:t.length-1},(e,n)=>t[n+1]-t[n])).map(e=>!!e),a=[];for(let e=0;e<i.length;++e)i[e]&&a.push(n[e]*r);o[e].data.set(a,1)}return o}}class BM extends Lz{main_input_name="pixel_values";constructor(e,t,n,r){super(e,t),this.decoder_merged_session=n,this.generation_config=r;let i=this.config.encoder,s=this.config.decoder,a=i.model_type;(jA.get(a)??jN.get(a))||console.warn(`Model type for encoder '${a}' not found, assuming encoder-only architecture. Please report this at https://github.com/xenova/transformers.js/issues/new/choose.`);let o=jL.get(s.model_type);if(!o)throw Error(`Unable to construct \`VisionEncoderDecoder\` due to unsupported decoder: "${this.config.decoder.model_type}"`);let l=new o[1](s,n,r);this.add_encoder_pkv="num_decoder_layers"in l,this.add_encoder_pkv?(this.num_decoder_layers=l.num_decoder_layers,this.num_decoder_heads=l.num_decoder_heads,this.decoder_dim_kv=l.decoder_dim_kv,this.num_encoder_layers=l.num_encoder_layers,this.num_encoder_heads=l.num_encoder_heads,this.encoder_dim_kv=l.encoder_dim_kv):(this.num_layers=l.num_layers,this.num_heads=l.num_heads,this.dim_kv=l.dim_kv)}}class BL extends Lz{}class Bz extends BL{}class BB extends BL{static async from_pretrained(e,t={}){return t.model_file_name??="text_model",super.from_pretrained(e,t)}}class BU extends BL{static async from_pretrained(e,t={}){return t.model_file_name??="vision_model",super.from_pretrained(e,t)}}class BV extends Lz{}class Bj extends BV{}class BG extends BV{static async from_pretrained(e,t={}){return t.model_file_name??="text_model",super.from_pretrained(e,t)}}class BW extends BL{static async from_pretrained(e,t={}){return t.model_file_name??="vision_model",super.from_pretrained(e,t)}}class Bq extends Lz{}class BH extends Bq{}class BK extends Lz{}class BX extends BK{}class BY extends BK{}class BQ extends Lz{constructor(e,t,n){super(e,t),this.generation_config=n,this.config.pad_token_id=this.config.eos_token_id,this.num_heads=this.config.n_head,this.num_layers=this.config.n_layer,this.dim_kv=this.config.n_embd/this.num_heads}}class BJ extends BQ{}class BZ extends BQ{}class B0 extends Lz{constructor(e,t,n){super(e,t),this.generation_config=n,this.config.pad_token_id=this.config.eos_token_id,this.num_heads=this.config.num_heads,this.num_layers=this.config.num_layers,this.dim_kv=this.config.hidden_size/this.num_heads}}class B1 extends B0{}class B2 extends B0{}class B3 extends Lz{constructor(e,t,n){super(e,t),this.generation_config=n,this.config.pad_token_id=this.config.eos_token_id,this.num_heads=this.config.num_attention_heads,this.num_layers=this.config.num_hidden_layers,this.dim_kv=this.config.hidden_size/this.num_heads}}class B4 extends B3{}class B6 extends B3{}class B5 extends Lz{constructor(e,t,n){super(e,t),this.generation_config=n,this.config.pad_token_id=this.config.eos_token_id,this.num_heads=this.config.n_head,this.num_layers=this.config.n_layer,this.dim_kv=this.config.n_embd/this.num_heads}}class B8 extends B5{}class B7 extends B5{}class B9 extends Lz{constructor(e,t,n){super(e,t),this.generation_config=n,this.config.pad_token_id=this.config.eos_token_id,this.num_heads=this.config.n_head,this.num_layers=this.config.n_layer,this.dim_kv=this.config.n_embd/this.num_heads}}class Ue extends B9{}class Ut extends B9{}class Un extends Lz{constructor(e,t,n){super(e,t),this.generation_config=n,this.config.pad_token_id=this.config.eos_token_id,this.num_heads=this.config.n_head,this.num_layers=this.config.n_layer,this.dim_kv=this.config.n_embd/this.num_heads}}class Ur extends Un{}class Ui extends Un{}class Us extends Lz{constructor(e,t,n){super(e,t),this.generation_config=n,this.config.pad_token_id=this.config.eos_token_id,this.num_heads=this.config.num_key_value_heads??this.config.num_attention_heads,this.num_layers=this.config.num_hidden_layers,this.dim_kv=this.config.hidden_size/this.config.num_attention_heads}}class Ua extends Us{}class Uo extends Us{}class Ul extends Lz{constructor(e,t,n){super(e,t),this.generation_config=n,this.config.pad_token_id=this.config.eos_token_id,this.num_heads=this.config.num_key_value_heads??this.config.num_attention_heads,this.num_layers=this.config.num_hidden_layers,this.dim_kv=this.config.hidden_size/this.config.num_attention_heads}}class Uu extends Ul{}class Uc extends Ul{}class Uh extends Lz{constructor(e,t,n){super(e,t),this.generation_config=n,this.config.pad_token_id=this.config.eos_token_id,this.num_heads=this.config.num_attention_heads,this.num_layers=this.config.num_hidden_layers,this.dim_kv=this.config.hidden_size/this.num_heads}}class Ud extends Uh{}class Up extends Uh{}class Uf extends Lz{constructor(e,t,n){super(e,t),this.generation_config=n,this.config.pad_token_id=this.config.eos_token_id,this.num_heads=this.config.n_head,this.num_layers=this.config.n_layer,this.dim_kv=this.config.hidden_size/this.num_heads}}class Ug extends Uf{}class Um extends Uf{}class Uy extends Lz{constructor(e,t,n){super(e,t),this.generation_config=n,this.config.pad_token_id=this.config.eos_token_id,this.num_heads=this.config.n_heads,this.num_layers=this.config.n_layers,this.dim_kv=this.config.d_model/this.num_heads}}class Ub extends Uy{}class Uv extends Uy{}class Uw extends Lz{constructor(e,t,n){super(e,t),this.generation_config=n,this.config.pad_token_id=this.config.eos_token_id,this.num_heads=this.config.num_attention_heads,this.num_layers=this.config.num_hidden_layers,this.dim_kv=this.config.hidden_size/this.num_heads}}class U_ extends Uw{}class Ux extends Uw{}class UT extends Lz{}class UI extends UT{}class Uk extends UT{async _call(e){return new Gy(await super._call(e))}}class US extends Lz{}class UE extends US{}class UC extends US{async _call(e){return new Gy(await super._call(e))}}class UA extends Lz{}class UN extends UA{async _call(e){return new GT(await super._call(e))}}class UO extends Lz{}class U$ extends UO{}class UR extends UO{async _call(e){return new Gy(await super._call(e))}}class UD extends Lz{}class UF extends UD{}class UP extends UD{async _call(e){return new Gy(await super._call(e))}}class UM extends Lz{}class UL extends UM{}class Uz extends UM{}class UB extends Lz{}class UU extends UB{}class UV extends UB{}class Uj extends Lz{}class UG extends Uj{}class UW extends Uj{async _call(e){return new Gy(await super._call(e))}}class Uq extends Lz{}class UH extends Uq{}class UK extends Uq{async _call(e){return new UY(await super._call(e))}}class UX extends Uq{async _call(e){return new UQ(await super._call(e))}}class UY extends LB{constructor({logits:e,pred_boxes:t}){super(),this.logits=e,this.pred_boxes=t}}class UQ extends LB{constructor({logits:e,pred_boxes:t,pred_masks:n}){super(),this.logits=e,this.pred_boxes=t,this.pred_masks=n}}class UJ extends Lz{}class UZ extends UJ{}class U0 extends UJ{async _call(e){return new U1(await super._call(e))}}class U1 extends UY{}class U2 extends Lz{}class U3 extends U2{}class U4 extends U2{async _call(e){return new Gy(await super._call(e))}}class U6 extends Lz{}class U5 extends U6{}class U8 extends U6{async _call(e){return new Gy(await super._call(e))}}class U7 extends Lz{}class U9 extends U7{}class Ve extends U7{async _call(e){return new Gy(await super._call(e))}}class Vt extends Lz{}class Vn extends Vt{}class Vr extends Vt{}class Vi extends Lz{}class Vs extends Vi{}class Va extends Vi{}class Vo extends Lz{}class Vl extends Vo{}class Vu extends Lz{}class Vc extends Vu{}class Vh extends Vu{}class Vd extends Lz{}class Vp extends Vd{}class Vf extends Lz{}class Vg extends Vf{}class Vm extends Vf{async _call(e){return new Gy(await super._call(e))}}class Vy extends Lz{}class Vb extends Vy{}class Vv extends Vy{async _call(e){return new Gy(await super._call(e))}}class Vw extends Lz{}class V_ extends Vw{}class Vx extends Vw{async _call(e){return new Gy(await super._call(e))}}class VT extends Lz{}class VI extends VT{}class Vk extends VT{async _call(e){return new VS(await super._call(e))}}class VS extends LB{constructor({logits:e,pred_boxes:t}){super(),this.logits=e,this.pred_boxes=t}}class VE extends Lz{}class VC extends VE{constructor(e,t,n){super(e,t),this.prompt_encoder_mask_decoder=n}async get_image_embeddings({pixel_values:e}){return await LD(this,{pixel_values:e})}async forward(e){if(e.image_embeddings&&e.image_positional_embeddings||(e={...e,...await this.get_image_embeddings(e)}),!e.input_labels){let t=e.input_points.dims.slice(0,-1),n=t.reduce((e,t)=>e*t,1);e.input_labels=new Ft("int64",new BigInt64Array(n).fill(1n),t)}return await LI(this.prompt_encoder_mask_decoder,{input_points:e.input_points,input_labels:e.input_labels,image_embeddings:e.image_embeddings,image_positional_embeddings:e.image_positional_embeddings})}async _call(e){return new VA(await super._call(e))}}class VA extends LB{constructor({iou_scores:e,pred_masks:t}){super(),this.iou_scores=e,this.pred_masks=t}}class VN extends Lz{}class VO extends VN{}class V$ extends VN{constructor(e,t,n,r){super(e,t),this.decoder_merged_session=n,this.generation_config=r,this.num_decoder_layers=this.config.decoder_layers,this.num_decoder_heads=this.config.decoder_attention_heads,this.decoder_dim_kv=this.config.d_model/this.num_decoder_heads,this.num_encoder_layers=this.config.encoder_layers,this.num_encoder_heads=this.config.encoder_attention_heads,this.encoder_dim_kv=this.config.d_model/this.num_encoder_heads}}class VR extends Lz{}class VD extends VR{}class VF extends VR{constructor(e,t,n,r){super(e,t),this.decoder_merged_session=n,this.generation_config=r,this.num_decoder_layers=this.config.decoder_layers,this.num_decoder_heads=this.config.decoder_attention_heads,this.decoder_dim_kv=this.config.d_model/this.num_decoder_heads,this.num_encoder_layers=this.config.encoder_layers,this.num_encoder_heads=this.config.encoder_attention_heads,this.encoder_dim_kv=this.config.d_model/this.num_encoder_heads}}class VP extends Lz{}class VM extends VP{}class VL extends VP{async _call(e){return new Gx(await super._call(e))}}class Vz extends VP{async _call(e){return new Gy(await super._call(e))}}class VB extends VP{async _call(e){return new Gv(await super._call(e))}}class VU extends Lz{}class VV extends VU{}class Vj extends VU{async _call(e){return new Gx(await super._call(e))}}class VG extends VU{async _call(e){return new Gy(await super._call(e))}}class VW extends Lz{}class Vq extends VW{}class VH extends VW{async _call(e){return new Gx(await super._call(e))}}class VK extends VW{async _call(e){return new Gy(await super._call(e))}}class VX extends VW{async _call(e){return new Gv(await super._call(e))}}class VY extends Lz{}class VQ extends VY{}class VJ extends VY{async _call(e){return new Gx(await super._call(e))}}class VZ extends VY{async _call(e){return new Gy(await super._call(e))}}class V0 extends VP{}class V1 extends VP{async _call(e){return new Gx(await super._call(e))}}class V2 extends VP{async _call(e){return new Gy(await super._call(e))}}class V3 extends Lz{}class V4 extends V3{}class V6 extends V3{async _call(e){return new Gx(await super._call(e))}}class V5 extends V3{async _call(e){return new Gy(await super._call(e))}}class V8 extends V3{async _call(e){return new Gb(await super._call(e))}}class V7 extends V3{async _call(e){return new Gv(await super._call(e))}}class V9 extends Lz{}class je extends V9{}class jt extends V9{constructor(e,t,n,r){super(e,t),this.decoder_merged_session=n,this.generation_config=r,this.num_decoder_layers=this.config.decoder_layers,this.num_decoder_heads=this.config.decoder_attention_heads,this.decoder_dim_kv=this.config.hidden_size/this.num_decoder_heads,this.num_encoder_layers=this.config.encoder_layers,this.num_encoder_heads=this.config.encoder_attention_heads,this.encoder_dim_kv=this.config.hidden_size/this.num_encoder_heads}async generate_speech(e,t,{threshold:n=.5,minlenratio:r=0,maxlenratio:i=20,vocoder:s=null}={}){let a={input_ids:e},{encoder_outputs:o,encoder_attention_mask:l}=await LD(this,a),u=o.dims[1]/this.config.reduction_factor,c=Math.floor(u*i),h=Math.floor(u*r),d=this.config.num_mel_bins,p=[],f=null,g=null,m=0;for(;;){let e;++m;let r={use_cache_branch:LA(!!g),output_sequence:e=g?g.output_sequence_out:new Ft("float32",new Float32Array(d),[1,1,d]),encoder_attention_mask:l,speaker_embeddings:t,encoder_hidden_states:o};this.addPastKeyValues(r,f),g=await LI(this.decoder_merged_session,r),f=this.getPastKeyValues(g,f);let{prob:i,spectrum:s}=g;if(p.push(s),m>=h&&(Array.from(i.data).filter(e=>e>=n).length>0||m>=c))break}let y=Fu(p),{waveform:b}=await LI(s.session,{spectrogram:y});return{spectrogram:y,waveform:b}}}class jn extends Lz{main_input_name="spectrogram"}class jr extends Lz{constructor(e,t,n){super(e,t),this.generation_config=n,this.config.pad_token_id=this.config.eos_token_id,this.num_encoder_layers=this.num_decoder_layers=this.config.decoder_layers,this.num_encoder_heads=this.num_decoder_heads=this.config.decoder_attention_heads,this.encoder_dim_kv=this.decoder_dim_kv=this.config.d_model/this.num_decoder_heads}}class ji extends jr{}class js extends Lz{constructor(e,t,n){super(e,t),this.generation_config=n,this.config.pad_token_id=this.config.eos_token_id,this.num_heads=this.config.num_key_value_heads,this.num_layers=this.config.num_hidden_layers,this.dim_kv=this.config.hidden_size/this.config.num_attention_heads}}class ja extends js{}class jo extends js{}class jl extends Lz{constructor(e,t,n){super(e,t),this.generation_config=n,this.config.pad_token_id=this.config.eos_token_id,this.num_heads=this.config.num_key_value_heads,this.num_layers=this.config.num_hidden_layers,this.dim_kv=this.config.hidden_size/this.config.num_attention_heads}}class ju extends jl{}class jc extends jl{}class jh extends Lz{constructor(e,t,n){super(e,t),this.generation_config=n,this.config.pad_token_id=this.config.eos_token_id,this.num_heads=this.config.num_attention_heads,this.num_layers=this.config.num_hidden_layers,this.dim_kv=this.config.hidden_size/this.config.num_attention_heads}}class jd extends jh{}class jp extends jh{}class jf extends Lz{}class jg extends jf{}class jm extends jf{static async from_pretrained(e,t={}){return t.model_file_name??="text_model",super.from_pretrained(e,t)}}class jy extends jf{static async from_pretrained(e,t={}){return t.model_file_name??="audio_model",super.from_pretrained(e,t)}}class jb extends Lz{}class jv extends jb{async _call(e){return new GI(await super._call(e))}}class jw extends Lz{}class j_ extends jw{}class jx extends jw{}class jT extends Lz{constructor(e,t,n){super(e,t),this.generation_config=n,this.config.pad_token_id=this.config.eos_token_id,this.num_heads=this.config.num_attention_heads,this.num_layers=this.config.num_hidden_layers,this.dim_kv=this.config.hidden_size/this.num_heads}}class jI extends jT{}class jk extends Lz{}class jS extends jk{}class jE extends jk{async _call(e){return new Gy(await super._call(e))}}class jC{static MODEL_CLASS_MAPPINGS=null;static BASE_IF_FAIL=!1;static async from_pretrained(e,{quantized:t=!0,progress_callback:n=null,config:r=null,cache_dir:i=null,local_files_only:s=!1,revision:a="main",model_file_name:o=null}={}){let l={quantized:t,progress_callback:n,config:r,cache_dir:i,local_files_only:s,revision:a,model_file_name:o};if(r=await M8.from_pretrained(e,l),l.config||(l.config=r),!this.MODEL_CLASS_MAPPINGS)throw Error("`MODEL_CLASS_MAPPINGS` not implemented for this type of `AutoClass`: "+this.name);for(let t of this.MODEL_CLASS_MAPPINGS){let n=t.get(r.model_type);if(n)return await n[1].from_pretrained(e,l)}if(this.BASE_IF_FAIL)return console.warn(`Unknown model class "${r.model_type}", attempting to construct from base class.`),await Lz.from_pretrained(e,l);throw Error(`Unsupported model type: ${r.model_type}`)}}let jA=new Map([["bert",["BertModel",LV]],["nomic_bert",["NomicBertModel",LK]],["roformer",["RoFormerModel",LY]],["electra",["ElectraModel",L7]],["esm",["EsmModel",zC]],["convbert",["ConvBertModel",L2]],["camembert",["CamembertModel",zi]],["deberta",["DebertaModel",zc]],["deberta-v2",["DebertaV2Model",zm]],["mpnet",["MPNetModel",zL]],["albert",["AlbertModel",zX]],["distilbert",["DistilBertModel",zx]],["roberta",["RobertaModel",Bf]],["xlm",["XLMModel",Bw]],["xlm-roberta",["XLMRobertaModel",BS]],["clap",["ClapModel",jg]],["clip",["CLIPModel",Bz]],["clipseg",["CLIPSegModel",BX]],["chinese_clip",["ChineseCLIPModel",BH]],["siglip",["SiglipModel",Bj]],["mobilebert",["MobileBertModel",zR]],["squeezebert",["SqueezeBertModel",zG]],["wav2vec2",["Wav2Vec2Model",VM]],["wav2vec2-bert",["Wav2Vec2BertModel",VQ]],["unispeech",["UniSpeechModel",VV]],["unispeech-sat",["UniSpeechSatModel",Vq]],["hubert",["HubertModel",V0]],["wavlm",["WavLMModel",V4]],["audio-spectrogram-transformer",["ASTModel",B$]],["vits",["VitsModel",jv]],["detr",["DetrModel",UH]],["table-transformer",["TableTransformerModel",UZ]],["vit",["ViTModel",UI]],["fastvit",["FastViTModel",UE]],["mobilevit",["MobileViTModel",U$]],["mobilevitv2",["MobileViTV2Model",UF]],["owlvit",["OwlViTModel",UL]],["owlv2",["Owlv2Model",UU]],["beit",["BeitModel",UG]],["deit",["DeiTModel",U3]],["convnext",["ConvNextModel",Vg]],["convnextv2",["ConvNextV2Model",Vb]],["dinov2",["Dinov2Model",V_]],["resnet",["ResNetModel",U5]],["swin",["SwinModel",U9]],["swin2sr",["Swin2SRModel",Vn]],["donut-swin",["DonutSwinModel",Vp]],["yolos",["YolosModel",VI]],["dpt",["DPTModel",Vs]],["glpn",["GLPNModel",Vc]],["hifigan",["SpeechT5HifiGan",jn]],["efficientnet",["EfficientNetModel",jS]]]),jN=new Map([["t5",["T5Model",z0]],["longt5",["LongT5Model",z3]],["mt5",["MT5Model",z5]],["bart",["BartModel",z9]],["mbart",["MBartModel",Br]],["marian",["MarianModel",VO]],["whisper",["WhisperModel",BF]],["m2m_100",["M2M100Model",VD]],["blenderbot",["BlenderbotModel",Bl]],["blenderbot-small",["BlenderbotSmallModel",Bh]]]),jO=new Map([["bloom",["BloomModel",Ug]],["gpt2",["GPT2Model",BJ]],["gptj",["GPTJModel",B8]],["gpt_bigcode",["GPTBigCodeModel",Ue]],["gpt_neo",["GPTNeoModel",B1]],["gpt_neox",["GPTNeoXModel",B4]],["codegen",["CodeGenModel",Ur]],["llama",["LlamaModel",Ua]],["qwen2",["Qwen2Model",Uu]],["phi",["PhiModel",Ud]],["mpt",["MptModel",Ub]],["opt",["OPTModel",U_]],["mistral",["MistralModel",ja]],["starcoder2",["Starcoder2Model",ju]],["falcon",["FalconModel",jd]]]),j$=new Map([["speecht5",["SpeechT5ForSpeechToText",je]],["whisper",["WhisperForConditionalGeneration",BP]]]),jR=new Map([["speecht5",["SpeechT5ForTextToSpeech",jt]]]),jD=new Map([["vits",["VitsModel",jv]]]),jF=new Map([["bert",["BertForSequenceClassification",LG]],["roformer",["RoFormerForSequenceClassification",LJ]],["electra",["ElectraForSequenceClassification",ze]],["esm",["EsmForSequenceClassification",zN]],["convbert",["ConvBertForSequenceClassification",L4]],["camembert",["CamembertForSequenceClassification",za]],["deberta",["DebertaForSequenceClassification",zd]],["deberta-v2",["DebertaV2ForSequenceClassification",zb]],["mpnet",["MPNetForSequenceClassification",zB]],["albert",["AlbertForSequenceClassification",zY]],["distilbert",["DistilBertForSequenceClassification",zT]],["roberta",["RobertaForSequenceClassification",Bm]],["xlm",["XLMForSequenceClassification",Bx]],["xlm-roberta",["XLMRobertaForSequenceClassification",BC]],["bart",["BartForSequenceClassification",Bt]],["mbart",["MBartForSequenceClassification",Bs]],["mobilebert",["MobileBertForSequenceClassification",zF]],["squeezebert",["SqueezeBertForSequenceClassification",zq]]]),jP=new Map([["bert",["BertForTokenClassification",LW]],["roformer",["RoFormerForTokenClassification",LZ]],["electra",["ElectraForTokenClassification",zt]],["esm",["EsmForTokenClassification",zO]],["convbert",["ConvBertForTokenClassification",L6]],["camembert",["CamembertForTokenClassification",zo]],["deberta",["DebertaForTokenClassification",zp]],["deberta-v2",["DebertaV2ForTokenClassification",zv]],["mpnet",["MPNetForTokenClassification",zU]],["distilbert",["DistilBertForTokenClassification",zI]],["roberta",["RobertaForTokenClassification",By]],["xlm",["XLMForTokenClassification",BT]],["xlm-roberta",["XLMRobertaForTokenClassification",BA]]]),jM=new Map([["t5",["T5ForConditionalGeneration",z1]],["longt5",["LongT5ForConditionalGeneration",z4]],["mt5",["MT5ForConditionalGeneration",z8]],["bart",["BartForConditionalGeneration",Be]],["mbart",["MBartForConditionalGeneration",Bi]],["marian",["MarianMTModel",V$]],["m2m_100",["M2M100ForConditionalGeneration",VF]],["blenderbot",["BlenderbotForConditionalGeneration",Bu]],["blenderbot-small",["BlenderbotSmallForConditionalGeneration",Bd]]]),jL=new Map([["bloom",["BloomForCausalLM",Um]],["gpt2",["GPT2LMHeadModel",BZ]],["gptj",["GPTJForCausalLM",B7]],["gpt_bigcode",["GPTBigCodeForCausalLM",Ut]],["gpt_neo",["GPTNeoForCausalLM",B2]],["gpt_neox",["GPTNeoXForCausalLM",B6]],["codegen",["CodeGenForCausalLM",Ui]],["llama",["LlamaForCausalLM",Uo]],["qwen2",["Qwen2ForCausalLM",Uc]],["phi",["PhiForCausalLM",Up]],["mpt",["MptForCausalLM",Uv]],["opt",["OPTForCausalLM",Ux]],["mbart",["MBartForCausalLM",Ba]],["mistral",["MistralForCausalLM",jo]],["starcoder2",["Starcoder2ForCausalLM",jc]],["falcon",["FalconForCausalLM",jp]],["trocr",["TrOCRForCausalLM",ji]],["stablelm",["StableLmForCausalLM",jI]]]),jz=new Map([["bert",["BertForMaskedLM",Lj]],["roformer",["RoFormerForMaskedLM",LQ]],["electra",["ElectraForMaskedLM",L9]],["esm",["EsmForMaskedLM",zA]],["convbert",["ConvBertForMaskedLM",L3]],["camembert",["CamembertForMaskedLM",zs]],["deberta",["DebertaForMaskedLM",zh]],["deberta-v2",["DebertaV2ForMaskedLM",zy]],["mpnet",["MPNetForMaskedLM",zz]],["albert",["AlbertForMaskedLM",zJ]],["distilbert",["DistilBertForMaskedLM",zS]],["roberta",["RobertaForMaskedLM",Bg]],["xlm",["XLMWithLMHeadModel",B_]],["xlm-roberta",["XLMRobertaForMaskedLM",BE]],["mobilebert",["MobileBertForMaskedLM",zD]],["squeezebert",["SqueezeBertForMaskedLM",zW]]]),jB=new Map([["bert",["BertForQuestionAnswering",Lq]],["roformer",["RoFormerForQuestionAnswering",L0]],["electra",["ElectraForQuestionAnswering",zn]],["convbert",["ConvBertForQuestionAnswering",L5]],["camembert",["CamembertForQuestionAnswering",zl]],["deberta",["DebertaForQuestionAnswering",zf]],["deberta-v2",["DebertaV2ForQuestionAnswering",zw]],["mpnet",["MPNetForQuestionAnswering",zV]],["albert",["AlbertForQuestionAnswering",zQ]],["distilbert",["DistilBertForQuestionAnswering",zk]],["roberta",["RobertaForQuestionAnswering",Bb]],["xlm",["XLMForQuestionAnswering",BI]],["xlm-roberta",["XLMRobertaForQuestionAnswering",BN]],["mobilebert",["MobileBertForQuestionAnswering",zP]],["squeezebert",["SqueezeBertForQuestionAnswering",zH]]]),jU=new Map([["vision-encoder-decoder",["VisionEncoderDecoderModel",BM]]]),jV=new Map([["vision-encoder-decoder",["VisionEncoderDecoderModel",BM]]]),jj=new Map([["vit",["ViTForImageClassification",Uk]],["fastvit",["FastViTForImageClassification",UC]],["mobilevit",["MobileViTForImageClassification",UR]],["mobilevitv2",["MobileViTV2ForImageClassification",UP]],["beit",["BeitForImageClassification",UW]],["deit",["DeiTForImageClassification",U4]],["convnext",["ConvNextForImageClassification",Vm]],["convnextv2",["ConvNextV2ForImageClassification",Vv]],["dinov2",["Dinov2ForImageClassification",Vx]],["resnet",["ResNetForImageClassification",U8]],["swin",["SwinForImageClassification",Ve]],["segformer",["SegformerForImageClassification",j_]],["efficientnet",["EfficientNetForImageClassification",jE]]]),jG=new Map([["detr",["DetrForObjectDetection",UK]],["table-transformer",["TableTransformerForObjectDetection",U0]],["yolos",["YolosForObjectDetection",Vk]]]),jW=new Map([["owlvit",["OwlViTForObjectDetection",Uz]],["owlv2",["Owlv2ForObjectDetection",UV]]]),jq=new Map([["detr",["DetrForSegmentation",UX]],["clipseg",["CLIPSegForImageSegmentation",BY]]]),jH=new Map([["segformer",["SegformerForSemanticSegmentation",jx]]]),jK=new Map([["sam",["SamModel",VC]]]),jX=new Map([["wav2vec2",["Wav2Vec2ForCTC",VL]],["wav2vec2-bert",["Wav2Vec2BertForCTC",VJ]],["unispeech",["UniSpeechForCTC",Vj]],["unispeech-sat",["UniSpeechSatForCTC",VH]],["wavlm",["WavLMForCTC",V6]],["hubert",["HubertForCTC",V1]]]),jY=new Map([["wav2vec2",["Wav2Vec2ForSequenceClassification",Vz]],["wav2vec2-bert",["Wav2Vec2BertForSequenceClassification",VZ]],["unispeech",["UniSpeechForSequenceClassification",VG]],["unispeech-sat",["UniSpeechSatForSequenceClassification",VK]],["wavlm",["WavLMForSequenceClassification",V5]],["hubert",["HubertForSequenceClassification",V2]],["audio-spectrogram-transformer",["ASTForAudioClassification",BR]]]),jQ=new Map([["wavlm",["WavLMForXVector",V8]]]),jJ=new Map([["unispeech-sat",["UniSpeechSatForAudioFrameClassification",VX]],["wavlm",["WavLMForAudioFrameClassification",V7]],["wav2vec2",["Wav2Vec2ForAudioFrameClassification",VB]]]),jZ=new Map([["vitmatte",["VitMatteForImageMatting",UN]]]),j0=new Map([["swin2sr",["Swin2SRForImageSuperResolution",Vr]]]),j1=new Map([["dpt",["DPTForDepthEstimation",Va]],["depth_anything",["DepthAnythingForDepthEstimation",Vl]],["glpn",["GLPNForDepthEstimation",Vh]]]),j2=new Map([["clip",["CLIPVisionModelWithProjection",BU]],["siglip",["SiglipVisionModel",BW]]]),j3=[[jA,Lb.EncoderOnly],[jN,Lb.EncoderDecoder],[jO,Lb.DecoderOnly],[jF,Lb.EncoderOnly],[jP,Lb.EncoderOnly],[jM,Lb.Seq2Seq],[j$,Lb.Seq2Seq],[jL,Lb.DecoderOnly],[jz,Lb.EncoderOnly],[jB,Lb.EncoderOnly],[jU,Lb.Vision2Seq],[jj,Lb.EncoderOnly],[jq,Lb.EncoderOnly],[jH,Lb.EncoderOnly],[jZ,Lb.EncoderOnly],[j0,Lb.EncoderOnly],[j1,Lb.EncoderOnly],[jG,Lb.EncoderOnly],[jW,Lb.EncoderOnly],[jK,Lb.MaskGeneration],[jX,Lb.EncoderOnly],[jY,Lb.EncoderOnly],[jR,Lb.Seq2Seq],[jD,Lb.EncoderOnly],[jQ,Lb.EncoderOnly],[jJ,Lb.EncoderOnly],[j2,Lb.EncoderOnly]];for(let[e,t]of j3)for(let[n,r]of e.values())Lv.set(n,t),L_.set(r,n),Lw.set(n,r);for(let[e,t,n]of[["CLIPTextModelWithProjection",BB,Lb.EncoderOnly],["SiglipTextModel",BG,Lb.EncoderOnly],["ClapTextModelWithProjection",jm,Lb.EncoderOnly],["ClapAudioModelWithProjection",jy,Lb.EncoderOnly]])Lv.set(e,n),L_.set(t,e),Lw.set(e,t);class j4 extends jC{static MODEL_CLASS_MAPPINGS=j3.map(e=>e[0]);static BASE_IF_FAIL=!0}class j6 extends jC{static MODEL_CLASS_MAPPINGS=[jF]}class j5 extends jC{static MODEL_CLASS_MAPPINGS=[jP]}class j8 extends jC{static MODEL_CLASS_MAPPINGS=[jM]}class j7 extends jC{static MODEL_CLASS_MAPPINGS=[j$]}class j9 extends jC{static MODEL_CLASS_MAPPINGS=[jR]}class Ge extends jC{static MODEL_CLASS_MAPPINGS=[jD]}class Gt extends jC{static MODEL_CLASS_MAPPINGS=[jL]}class Gn extends jC{static MODEL_CLASS_MAPPINGS=[jz]}class Gr extends jC{static MODEL_CLASS_MAPPINGS=[jB]}class Gi extends jC{static MODEL_CLASS_MAPPINGS=[jU]}class Gs extends jC{static MODEL_CLASS_MAPPINGS=[jj]}class Ga extends jC{static MODEL_CLASS_MAPPINGS=[jq]}class Go extends jC{static MODEL_CLASS_MAPPINGS=[jH]}class Gl extends jC{static MODEL_CLASS_MAPPINGS=[jG]}class Gu extends jC{static MODEL_CLASS_MAPPINGS=[jW]}class Gc extends jC{static MODEL_CLASS_MAPPINGS=[jX]}class Gh extends jC{static MODEL_CLASS_MAPPINGS=[jY]}class Gd extends jC{static MODEL_CLASS_MAPPINGS=[jV]}class Gp extends jC{static MODEL_CLASS_MAPPINGS=[j0]}class Gf extends jC{static MODEL_CLASS_MAPPINGS=[j1]}class Gg extends jC{static MODEL_CLASS_MAPPINGS=[j2]}class Gm extends LB{constructor({logits:e,past_key_values:t,encoder_outputs:n,decoder_attentions:r=null,cross_attentions:i=null}){super(),this.logits=e,this.past_key_values=t,this.encoder_outputs=n,this.decoder_attentions=r,this.cross_attentions=i}}class Gy extends LB{constructor({logits:e}){super(),this.logits=e}}class Gb extends LB{constructor({logits:e,embeddings:t}){super(),this.logits=e,this.embeddings=t}}class Gv extends LB{constructor({logits:e}){super(),this.logits=e}}class Gw extends LB{constructor({logits:e}){super(),this.logits=e}}class G_ extends LB{constructor({start_logits:e,end_logits:t}){super(),this.start_logits=e,this.end_logits=t}}class Gx extends LB{constructor({logits:e}){super(),this.logits=e}}class GT extends LB{constructor({alphas:e}){super(),this.alphas=e}}class GI extends LB{constructor({waveform:e,spectrogram:t}){super(),this.waveform=e,this.spectrogram=t}}var Gk=n(7806);let GS="undefined"!=typeof self,GE=GS&&"DedicatedWorkerGlobalScope"===self.constructor.name;if(GS)h=(e,t)=>{if(!self.OffscreenCanvas)throw Error("OffscreenCanvas not supported by this browser.");return new self.OffscreenCanvas(e,t)},p=self.createImageBitmap,d=self.ImageData;else if(Gk)p=async e=>{let t=(await e.metadata()).channels,{data:n,info:r}=await e.rotate().raw().toBuffer({resolveWithObject:!0}),i=new GN(new Uint8ClampedArray(n),r.width,r.height,r.channels);return void 0!==t&&t!==r.channels&&i.convert(t),i};else throw Error("Unable to load image processing library.");let GC={0:"nearest",1:"lanczos",2:"bilinear",3:"bicubic",4:"box",5:"hamming"},GA=new Map([["png","image/png"],["jpg","image/jpeg"],["jpeg","image/jpeg"],["gif","image/gif"]]);class GN{constructor(e,t,n,r){this.data=e,this.width=t,this.height=n,this.channels=r}get size(){return[this.width,this.height]}static async read(e){if(e instanceof GN)return e;if("string"==typeof e||e instanceof URL)return await this.fromURL(e);throw Error(`Unsupported input type: ${typeof e}`)}static async fromURL(e){let t=await DB(e);if(200!==t.status)throw Error(`Unable to read image from "${e}" (${t.status} ${t.statusText})`);let n=await t.blob();return this.fromBlob(n)}static async fromBlob(e){if(GS){let t=await p(e),n=h(t.width,t.height).getContext("2d");return n.drawImage(t,0,0),new this(n.getImageData(0,0,t.width,t.height).data,t.width,t.height,4)}{let t=Gk(await e.arrayBuffer());return await p(t)}}static fromTensor(e,t="CHW"){if(3!==e.dims.length)throw Error(`Tensor should have 3 dimensions, but has ${e.dims.length} dimensions.`);if("CHW"===t)e=e.transpose(1,2,0);else if("HWC"===t);else throw Error(`Unsupported channel format: ${t}`);if(!(e.data instanceof Uint8ClampedArray||e.data instanceof Uint8Array))throw Error(`Unsupported tensor type: ${e.type}`);switch(e.dims[2]){case 1:case 2:case 3:case 4:return new GN(e.data,e.dims[1],e.dims[0],e.dims[2]);default:throw Error(`Unsupported number of channels: ${e.dims[2]}`)}}grayscale(){if(1===this.channels)return this;let e=new Uint8ClampedArray(this.width*this.height*1);switch(this.channels){case 3:case 4:for(let t=0,n=0;t<this.data.length;t+=this.channels){let r=this.data[t],i=this.data[t+1],s=this.data[t+2];e[n++]=Math.round(.2989*r+.587*i+.114*s)}break;default:throw Error(`Conversion failed due to unsupported number of channels: ${this.channels}`)}return this._update(e,this.width,this.height,1)}rgb(){if(3===this.channels)return this;let e=new Uint8ClampedArray(this.width*this.height*3);switch(this.channels){case 1:for(let t=0,n=0;t<this.data.length;++t)e[n++]=this.data[t],e[n++]=this.data[t],e[n++]=this.data[t];break;case 4:for(let t=0,n=0;t<this.data.length;t+=4)e[n++]=this.data[t],e[n++]=this.data[t+1],e[n++]=this.data[t+2];break;default:throw Error(`Conversion failed due to unsupported number of channels: ${this.channels}`)}return this._update(e,this.width,this.height,3)}rgba(){if(4===this.channels)return this;let e=new Uint8ClampedArray(this.width*this.height*4);switch(this.channels){case 1:for(let t=0,n=0;t<this.data.length;++t)e[n++]=this.data[t],e[n++]=this.data[t],e[n++]=this.data[t],e[n++]=255;break;case 3:for(let t=0,n=0;t<this.data.length;t+=3)e[n++]=this.data[t],e[n++]=this.data[t+1],e[n++]=this.data[t+2],e[n++]=255;break;default:throw Error(`Conversion failed due to unsupported number of channels: ${this.channels}`)}return this._update(e,this.width,this.height,4)}async resize(e,t,{resample:n=2}={}){let r=GC[n]??n;if(GS){let n=this.channels,r=this.toCanvas(),i=h(e,t).getContext("2d");return i.drawImage(r,0,0,e,t),new GN(i.getImageData(0,0,e,t).data,e,t,4).convert(n)}{let n=this.toSharp();switch(r){case"box":case"hamming":("box"===r||"hamming"===r)&&(console.warn(`Resampling method ${r} is not yet supported. Using bilinear instead.`),r="bilinear");case"nearest":case"bilinear":case"bicubic":n=n.affine([e/this.width,0,0,t/this.height],{interpolator:r});break;case"lanczos":n=n.resize({width:e,height:t,fit:"fill",kernel:"lanczos3"});break;default:throw Error(`Resampling method ${r} is not supported.`)}return await p(n)}}async pad([e,t,n,r]){if(e=Math.max(e,0),t=Math.max(t,0),n=Math.max(n,0),r=Math.max(r,0),0===e&&0===t&&0===n&&0===r)return this;if(GS){let i=this.channels,s=this.toCanvas(),a=this.width+e+t,o=this.height+n+r,l=h(a,o).getContext("2d");return l.drawImage(s,0,0,this.width,this.height,e,n,a,o),new GN(l.getImageData(0,0,a,o).data,a,o,4).convert(i)}{let i=this.toSharp().extend({left:e,right:t,top:n,bottom:r});return await p(i)}}async crop([e,t,n,r]){if(e=Math.max(e,0),t=Math.max(t,0),n=Math.min(n,this.width-1),r=Math.min(r,this.height-1),0===e&&0===t&&n===this.width-1&&r===this.height-1)return this;let i=n-e+1,s=r-t+1;if(GS){let n=this.channels,r=this.toCanvas(),a=h(i,s).getContext("2d");return a.drawImage(r,e,t,i,s,0,0,i,s),new GN(a.getImageData(0,0,i,s).data,i,s,4).convert(n)}{let n=this.toSharp().extract({left:e,top:t,width:i,height:s});return await p(n)}}async center_crop(e,t){if(this.width===e&&this.height===t)return this;let n=(this.width-e)/2,r=(this.height-t)/2;if(GS){let i=this.channels,s=this.toCanvas(),a=h(e,t).getContext("2d"),o=0,l=0,u=0,c=0;return n>=0?o=n:u=-n,r>=0?l=r:c=-r,a.drawImage(s,o,l,e,t,u,c,e,t),new GN(a.getImageData(0,0,e,t).data,e,t,4).convert(i)}{let i=this.toSharp();if(n>=0&&r>=0)i=i.extract({left:Math.floor(n),top:Math.floor(r),width:e,height:t});else if(n<=0&&r<=0){let s=Math.floor(-r),a=Math.floor(-n);i=i.extend({top:s,left:a,right:e-this.width-a,bottom:t-this.height-s})}else{let s=[0,0],a=0;r<0?(s[0]=Math.floor(-r),s[1]=t-this.height-s[0]):a=Math.floor(r);let o=[0,0],l=0;n<0?(o[0]=Math.floor(-n),o[1]=e-this.width-o[0]):l=Math.floor(n),i=i.extend({top:s[0],bottom:s[1],left:o[0],right:o[1]}).extract({left:l,top:a,width:e,height:t})}return await p(i)}}async toBlob(e="image/png",t=1){if(!GS)throw Error("toBlob() is only supported in browser environments.");let n=this.toCanvas();return await n.convertToBlob({type:e,quality:t})}toTensor(e="CHW"){let t=new Ft("uint8",new Uint8Array(this.data),[this.height,this.width,this.channels]);if("HWC"===e);else if("CHW"===e)t=t.permute(2,0,1);else throw Error(`Unsupported channel format: ${e}`);return t}toCanvas(){if(!GS)throw Error("toCanvas() is only supported in browser environments.");let e=this.clone().rgba(),t=h(e.width,e.height),n=new d(e.data,e.width,e.height);return t.getContext("2d").putImageData(n,0,0),t}_update(e,t,n,r=null){return this.data=e,this.width=t,this.height=n,null!==r&&(this.channels=r),this}clone(){return new GN(this.data.slice(),this.width,this.height,this.channels)}convert(e){if(this.channels===e)return this;switch(e){case 1:this.grayscale();break;case 3:this.rgb();break;case 4:this.rgba();break;default:throw Error(`Conversion failed due to unsupported number of channels: ${this.channels}`)}return this}async save(e){if(GS){if(GE)throw Error("Unable to save an image from a Web Worker.");let t=e.split(".").pop().toLowerCase(),n=GA.get(t)??"image/png",r=await this.toBlob(n),i=URL.createObjectURL(r),s=document.createElement("a");s.href=i,s.download=e,s.click(),s.remove()}else if(DD.useFS){let t=this.toSharp();return await t.toFile(e)}else throw Error("Unable to save the image because filesystem is disabled in this environment.")}toSharp(){if(GS)throw Error("toSharp() is only supported in server-side environments.");return Gk(this.data,{raw:{width:this.width,height:this.height,channels:this.channels}})}}async function GO(e,t){let n;if("undefined"==typeof AudioContext)throw Error("Unable to load audio from path/URL since `AudioContext` is not available in your environment. Instead, audio data should be passed directly to the pipeline/processor. For more information and some example code, see https://huggingface.co/docs/transformers.js/guides/node-audio-processing.");let r=await (await DB(e)).arrayBuffer(),i=new AudioContext({sampleRate:t});void 0===t&&console.warn(`No sampling rate provided, using default of ${i.sampleRate}Hz.`);let s=await i.decodeAudioData(r);if(2===s.numberOfChannels){let e=Math.sqrt(2),t=s.getChannelData(0),r=s.getChannelData(1);n=new Float32Array(t.length);for(let i=0;i<s.length;++i)n[i]=e*(t[i]+r[i])/2}else n=s.getChannelData(0);return n}function G$(e){if(e<1)return new Float64Array;if(1===e)return new Float64Array([1]);let t=e-1,n=Math.PI/t,r=new Float64Array(e);for(let i=0;i<e;++i){let e=2*i-t;r[i]=.5+.5*Math.cos(n*e)}return r}let GR={htk:e=>2595*Math.log10(1+e/700),kaldi:e=>1127*Math.log(1+e/700),slaney:(e,t=1e3,n=15,r=27/Math.log(6.4))=>e>=t?n+Math.log(e/t)*r:3*e/200};function GD(e,t="htk"){let n=GR[t];if(!n)throw Error('mel_scale should be one of "htk", "slaney" or "kaldi".');return"number"==typeof e?n(e):e.map(e=>n(e))}let GF={htk:e=>700*(10**(e/2595)-1),kaldi:e=>700*(Math.exp(e/1127)-1),slaney:(e,t=1e3,n=15,r=Math.log(6.4)/27)=>e>=n?t*Math.exp(r*(e-n)):200*e/3};function GP(e,t="htk"){let n=GF[t];if(!n)throw Error('mel_scale should be one of "htk", "slaney" or "kaldi".');return"number"==typeof e?n(e):e.map(e=>n(e))}function GM(e,t){let n=Float64Array.from({length:t.length-1},(e,n)=>t[n+1]-t[n]),r=Array.from({length:e.length},()=>Array(t.length));for(let n=0;n<e.length;++n){let i=r[n];for(let r=0;r<t.length;++r)i[r]=t[r]-e[n]}let i=t.length-2,s=Array.from({length:i},()=>Array(e.length));for(let t=0;t<e.length;++t){let e=r[t];for(let r=0;r<i;++r){let i=-e[r]/n[r],a=e[r+2]/n[r+1];s[r][t]=Math.max(0,Math.min(i,a))}}return s}function GL(e,t,n){let r=(t-e)/(n-1);return Float64Array.from({length:n},(t,n)=>e+r*n)}function Gz(e,t,n,r,i,s=null,a="htk",o=!1){let l;if(null!==s&&"slaney"!==s)throw Error('norm must be one of null or "slaney"');let u=GL(GD(n,a),GD(r,a),t+2),c=GP(u,a);if(o){let t=i/(2*e);l=GD(Float64Array.from({length:e},(e,n)=>n*t),a),c=u}else l=GL(0,Math.floor(i/2),e);let h=GM(l,c);if(null!==s&&"slaney"===s)for(let n=0;n<t;++n){let t=h[n],r=2/(c[n+2]-c[n]);for(let n=0;n<e;++n)t[n]*=r}return h}function GB(e,t,n){let r=new e.constructor(e.length+t+n),i=e.length-1;for(let n=0;n<e.length;++n)r[t+n]=e[n];for(let n=1;n<=t;++n)r[t-n]=e[Dd(n,i)];for(let s=1;s<=n;++s)r[i+t+s]=e[Dd(i-s,i)];return r}function GU(e,t,n,r,i){if(n<=0)throw Error("reference must be greater than zero");if(r<=0)throw Error("min_value must be greater than zero");let s=Math.log10(n=Math.max(r,n));for(let n=0;n<e.length;++n)e[n]=t*Math.log10(Math.max(r,e[n])-s);if(null!==i){if(i<=0)throw Error("db_range must be greater than zero");let t=D1(e)[0]-i;for(let n=0;n<e.length;++n)e[n]=Math.max(e[n],t)}return e}function GV(e,t=1,n=1e-5,r=null){return GU(e,20,t,n,r)}function Gj(e,t=1,n=1e-10,r=null){return GU(e,10,t,n,r)}function GG(e,t,n,r,{fft_length:i=null,power:s=1,center:a=!0,pad_mode:o="reflect",onesided:l=!0,preemphasis:u=null,mel_filters:c=null,mel_floor:h=1e-10,log_mel:d=null,reference:p=1,min_value:f=1e-10,db_range:g=null,remove_dc_offset:m=null,max_num_frames:y=null,do_pad:b=!0,transpose:v=!1}={}){let w=t.length;if(null===i&&(i=n),n>i)throw Error(`frame_length (${n}) may not be larger than fft_length (${i})`);if(w!==n)throw Error(`Length of the window (${w}) must equal frame_length (${n})`);if(r<=0)throw Error("hop_length must be greater than zero");if(null===s&&null!==c)throw Error("You have provided `mel_filters` but `power` is `None`. Mel spectrogram computation is not yet supported for complex-valued spectrogram. Specify `power` to fix this issue.");if(a){if("reflect"!==o)throw Error(`pad_mode="${o}" not implemented yet.`);let t=Math.floor((i-1)/2)+1;e=GB(e,t,t)}let _=Math.floor(1+Math.floor((e.length-n)/r)),x=l?Math.floor(i/2)+1:i,T=_,I=_;null!==y&&(y>_?b&&(I=y):I=T=y);let k=new D6(i),S=new Float64Array(i),E=new Float64Array(k.outputBufferSize),C=Array(T);for(let i=0;i<T;++i){let s=i*r;for(let t=0;t<n;++t)S[t]=e[s+t];if(m){let e=0;for(let t=0;t<n;++t)e+=S[t];let t=e/n;for(let e=0;e<n;++e)S[e]-=t}if(null!==u){for(let e=n-1;e>=1;--e)S[e]-=u*S[e-1];S[0]*=1-u}for(let e=0;e<t.length;++e)S[e]*=t[e];k.realTransform(E,S);let a=Array(x);for(let e=0;e<a.length;++e){let t=e<<1;a[e]=E[t]**2+E[t+1]**2}C[i]=a}if(null!==s&&2!==s){let e=2/s;for(let t=0;t<C.length;++t){let n=C[t];for(let t=0;t<n.length;++t)n[t]**=e}}let A=c.length,N=new Float32Array(A*I),O=v?[I,A]:[A,I];for(let e=0;e<A;++e){let t=c[e];for(let n=0;n<T;++n){let r=C[n],i=0;for(let e=0;e<x;++e)i+=t[e]*r[e];N[v?n*A+e:e*T+n]=Math.max(h,i)}}if(null!==s&&null!==d){let e=Math.min(N.length,T*A);switch(d){case"log":for(let t=0;t<e;++t)N[t]=Math.log(N[t]);break;case"log10":for(let t=0;t<e;++t)N[t]=Math.log10(N[t]);break;case"dB":if(1===s)GV(N,p,f,g);else if(2===s)Gj(N,p,f,g);else throw Error(`Cannot use log_mel option '${d}' with power ${s}`);break;default:throw Error(`log_mel must be one of null, 'log', 'log10' or 'dB'. Got '${d}'`)}}return{data:N,dims:O}}function GW(e,t,{periodic:n=!0,frame_length:r=null,center:i=!0}={}){let s;let a=n?e+1:e;switch(t){case"boxcar":s=new Float64Array(a).fill(1);break;case"hann":case"hann_window":s=G$(a);break;case"povey":s=G$(a).map(e=>Math.pow(e,.85));break;default:throw Error(`Unknown window type ${t}.`)}if(n&&(s=s.subarray(0,e)),null===r)return s;if(e>r)throw Error(`Length of the window (${e}) may not be larger than frame_length (${r})`);return s}function Gq([e,t,n,r]){return[e-n/2,t-r/2,e+n/2,t+r/2]}function GH(e,t=.5,n=null,r=!1){let i=e.logits,s=e.pred_boxes,[a,o,l]=i.dims;if(null!==n&&n.length!==a)throw Error("Make sure that you pass in as many target sizes as the batch dimension of the logits");let u=[];for(let e=0;e<a;++e){let a=null!==n?n[e]:null,c={boxes:[],classes:[],scores:[]},h=i[e],d=s[e];for(let e=0;e<o;++e){let n,i=h[e],s=[];if(r){n=i.sigmoid().data;for(let e=0;e<n.length;++e)n[e]>t&&s.push(e)}else{let e=D1(i.data)[1];if(e===l-1)continue;s.push(e),n=DQ(i.data)}for(let t of s){let r=d[e].data;r=Gq(r),null!==a&&(r=r.map((e,t)=>e*a[(t+1)%2])),c.boxes.push(r),c.classes.push(t),c.scores.push(n[t])}}u.push(c)}return u}function GK(e,t){if(!(e instanceof Float32Array||e instanceof Float64Array))throw Error(`${t} expects input to be a Float32Array or a Float64Array, but got ${e?.constructor?.name??typeof e} instead. If using the feature extractor directly, remember to use \`read_audio(url, sampling_rate)\` to obtain the raw audio data of the file/url.`)}function GX(e,t,n=0,r=null){let i=e/t,s=D7(i)*t;return null!==r&&s>r&&(s=Math.floor(i)*t),s<n&&(s=Math.ceil(i)*t),s}function GY([e,t],n){return[Math.max(Math.floor(e/n),1)*n,Math.max(Math.floor(t/n),1)*n]}class GQ extends Di{constructor(e){super(),this.config=e}}class GJ extends GQ{constructor(e){super(e),this.image_mean=this.config.image_mean??this.config.mean,this.image_std=this.config.image_std??this.config.std,this.resample=this.config.resample??2,this.do_rescale=this.config.do_rescale??!0,this.rescale_factor=this.config.rescale_factor??1/255,this.do_normalize=this.config.do_normalize,this.do_resize=this.config.do_resize,this.do_thumbnail=this.config.do_thumbnail,this.size=this.config.size,this.size_divisibility=this.config.size_divisibility??this.config.size_divisor,this.do_center_crop=this.config.do_center_crop,this.crop_size=this.config.crop_size,this.do_convert_rgb=this.config.do_convert_rgb??!0,this.do_crop_margin=this.config.do_crop_margin,this.pad_size=this.config.pad_size,this.do_pad=this.config.do_pad,this.do_pad&&!this.pad_size&&this.size&&void 0!==this.size.width&&void 0!==this.size.height&&(this.pad_size=this.size),this.do_flip_channel_order=this.config.do_flip_channel_order??!1}async thumbnail(e,t,n=2){let r=e.height,i=e.width,s=t.height,a=t.width,o=Math.min(r,s),l=Math.min(i,a);return o===r&&l===i?e:(r>i?l=Math.floor(i*o/r):i>r&&(o=Math.floor(r*l/i)),await e.resize(l,o,{resample:n}))}async crop_margin(e,t=200){let n=e.clone().grayscale(),r=D0(n.data)[0],i=D1(n.data)[0]-r;if(0===i)return e;let s=t/255,a=n.width,o=n.height,l=0,u=0;for(let e=0;e<n.height;++e){let t=e*n.width;for(let c=0;c<n.width;++c)(n.data[t+c]-r)/i<s&&(a=Math.min(a,c),o=Math.min(o,e),l=Math.max(l,c),u=Math.max(u,e))}return e=await e.crop([a,o,l,u])}pad_image(e,t,n,{mode:r="constant",center:i=!1,constant_values:s=0}={}){let a,o;let[l,u,c]=t;if("number"==typeof n?(a=n,o=n):(a=n.width,o=n.height),a!==u||o!==l){let n=new Float32Array(a*o*c);if(Array.isArray(s))for(let e=0;e<n.length;++e)n[e]=s[e%c];else 0!==s&&n.fill(s);let[h,d]=i?[Math.floor((a-u)/2),Math.floor((o-l)/2)]:[0,0];for(let t=0;t<l;++t){let r=(t+d)*a,i=t*u;for(let t=0;t<u;++t){let s=(r+t+h)*c,a=(i+t)*c;for(let t=0;t<c;++t)n[s+t]=e[a+t]}}if("symmetric"===r){if(i)throw Error("`center` padding is not supported when `mode` is set to `symmetric`.");let t=l-1,r=u-1;for(let i=0;i<o;++i){let s=i*a,o=Dd(i,t)*u;for(let t=0;t<a;++t){if(i<l&&t<u)continue;let a=(s+t)*c,h=(o+Dd(t,r))*c;for(let t=0;t<c;++t)n[a+t]=e[h+t]}}}e=n,t=[o,a,c]}return[e,t]}rescale(e){for(let t=0;t<e.length;++t)e[t]=this.rescale_factor*e[t]}get_resize_output_image_size(e,t){let n,r;let[i,s]=e.size;if(this.do_thumbnail){let{height:e,width:r}=t;n=Math.min(e,r)}else Number.isInteger(t)?(n=t,r=this.config.max_size??n):void 0!==t&&(n=t.shortest_edge,r=t.longest_edge);if(void 0!==n||void 0!==r){let e=void 0===n?1:Math.max(n/i,n/s),t=i*e,a=s*e,o=void 0===r?1:Math.min(r/t,r/a),l=Math.floor(Number((t*o).toFixed(2))),u=Math.floor(Number((a*o).toFixed(2)));return void 0!==this.size_divisibility&&([l,u]=GY([l,u],this.size_divisibility)),[l,u]}if(void 0!==t&&void 0!==t.width&&void 0!==t.height){let e=t.width,n=t.height;if(this.config.keep_aspect_ratio&&this.config.ensure_multiple_of){let t=n/s,r=e/i;Math.abs(1-r)<Math.abs(1-t)?t=r:r=t,n=GX(t*s,this.config.ensure_multiple_of),e=GX(r*i,this.config.ensure_multiple_of)}return[e,n]}if(void 0!==this.size_divisibility)return GY([i,s],this.size_divisibility);throw Error(`Could not resize image due to unsupported \`this.size\` option in config: ${JSON.stringify(t)}`)}async resize(e){let[t,n]=this.get_resize_output_image_size(e,this.size);return await e.resize(t,n,{resample:this.resample})}async preprocess(e,{do_normalize:t=null,do_pad:n=null,do_convert_rgb:r=null,do_convert_grayscale:i=null,do_flip_channel_order:s=null}={}){this.do_crop_margin&&(e=await this.crop_margin(e));let[a,o]=e.size;if(r??this.do_convert_rgb?e=e.rgb():i&&(e=e.grayscale()),this.do_resize&&(e=await this.resize(e)),this.do_thumbnail&&(e=await this.thumbnail(e,this.size,this.resample)),this.do_center_crop){let t,n;Number.isInteger(this.crop_size)?(t=this.crop_size,n=this.crop_size):(t=this.crop_size.width,n=this.crop_size.height),e=await e.center_crop(t,n)}let l=[e.height,e.width],u=Float32Array.from(e.data),c=[e.height,e.width,e.channels];if(this.do_rescale&&this.rescale(u),t??this.do_normalize){let t=this.image_mean;Array.isArray(this.image_mean)||(t=Array(e.channels).fill(t));let n=this.image_std;if(Array.isArray(this.image_std)||(n=Array(e.channels).fill(t)),t.length!==e.channels||n.length!==e.channels)throw Error(`When set to arrays, the length of \`image_mean\` (${t.length}) and \`image_std\` (${n.length}) must match the number of channels in the image (${e.channels}).`);for(let r=0;r<u.length;r+=e.channels)for(let i=0;i<e.channels;++i)u[r+i]=(u[r+i]-t[i])/n[i]}if(n??this.do_pad){if(this.pad_size){let t=this.pad_image(u,[e.height,e.width,e.channels],this.pad_size);[u,c]=t}else if(this.size_divisibility){let[e,t]=GY([c[1],c[0]],this.size_divisibility);[u,c]=this.pad_image(u,c,{width:e,height:t})}}if(s??this.do_flip_channel_order){if(3!==c[2])throw Error("Flipping channel order is only supported for RGB images.");for(let e=0;e<u.length;e+=3){let t=u[e];u[e]=u[e+2],u[e+2]=t}}return{original_size:[o,a],reshaped_input_size:l,pixel_values:new Ft("float32",u,c).permute(2,0,1)}}async _call(e,...t){Array.isArray(e)||(e=[e]);let n=await Promise.all(e.map(e=>this.preprocess(e)));return{pixel_values:Fc(n.map(e=>e.pixel_values),0),original_sizes:n.map(e=>e.original_size),reshaped_input_sizes:n.map(e=>e.reshaped_input_size)}}}class GZ extends GJ{post_process_semantic_segmentation(e,t=null){let n=e.logits,r=n.dims[0];if(null!==t&&t.length!==r)throw Error("Make sure that you pass in as many target sizes as the batch dimension of the logits");let i=[];for(let e=0;e<r;++e){let r=null!==t?t[e]:null,s=n[e];null!==r&&(s=Fi(s,r,"bilinear",!1));let[a,o]=r??s.dims.slice(-2),l=new Ft("int32",new Int32Array(a*o),[a,o]),u=s[0].data;for(let e=1;e<s.dims[0];++e){let t=s[e].data;for(let n=0;n<t.length;++n)t[n]>u[n]&&(u[n]=t[n],l.data[n]=e)}let c=Array(s.dims[0]),h=l.data;for(let e=0;e<h.length;++e){let t=h[e];c[t]=t}let d=c.filter(e=>void 0!==e);i.push({segmentation:l,labels:d})}return i}}class G0 extends GJ{}class G1 extends G0{}class G2 extends GJ{}class G3 extends GJ{}class G4 extends GJ{}class G6 extends GJ{}class G5 extends GJ{}class G8 extends GJ{constructor(e){super(e),this.crop_pct=this.config.crop_pct??.875}async resize(e){let t=this.size?.shortest_edge;if(void 0===t)throw Error("Size dictionary must contain 'shortest_edge' key.");if(t<384){let n=Math.floor(t/this.crop_pct),[r,i]=this.get_resize_output_image_size(e,{shortest_edge:n});e=await e.resize(r,i,{resample:this.resample}),e=await e.center_crop(t,t)}else e=await e.resize(t,t,{resample:this.resample});return e}}class G7 extends G8{}class G9 extends GJ{}class We extends GJ{}class Wt extends GJ{constructor(e){super(e),this.include_top=this.config.include_top??!0,this.include_top&&(this.image_std=this.image_std.map(e=>e*e))}}class Wn extends GJ{}class Wr extends Wn{}class Wi extends GJ{post_process_object_detection(...e){return GH(...e)}}class Ws extends Wi{}class Wa extends GJ{}class Wo extends GJ{}class Wl extends GJ{pad_image(e,t,n,r={}){let[i,s,a]=t,o=this.image_mean;Array.isArray(this.image_mean)||(o=Array(a).fill(o));let l=this.image_std;Array.isArray(l)||(l=Array(a).fill(o));let u=o.map((e,t)=>-e/l[t]);return super.pad_image(e,t,n,{center:!0,constant_values:u,...r})}}class Wu extends Wl{}class Wc extends GJ{async _call(e){let t=await super._call(e),n=[t.pixel_values.dims[0],64,64],r=new Ft("int64",new BigInt64Array(n.reduce((e,t)=>e*t)).fill(1n),n);return{...t,pixel_mask:r}}post_process_object_detection(...e){return GH(...e)}remove_low_and_no_objects(e,t,n,r){let i=[],s=[],a=[];for(let o=0;o<e.dims[0];++o){let l=e[o],u=t[o],c=D1(l.data)[1];if(c===r)continue;let h=DQ(l.data)[c];h>n&&(i.push(u),s.push(h),a.push(c))}return[i,s,a]}check_segment_validity(e,t,n,r=.5,i=.8){let s=[],a=0,o=0;for(let i=0;i<e.length;++i)e[i]===n&&(s.push(i),++a),t[n].data[i]>=r&&++o;let l=a>0&&o>0;return l&&(l=a/o>i),[l,s]}compute_segments(e,t,n,r,i,s=null,a=null){let[o,l]=a??e[0].dims,u=new Ft("int32",new Int32Array(o*l),[o,l]),c=[];if(null!==a)for(let t=0;t<e.length;++t)e[t]=Fi(e[t],a,"bilinear",!1);let h=new Int32Array(e[0].data.length),d=new Float32Array(e[0].data.length);for(let n=0;n<e.length;++n){let r=t[n];for(let t=0;t<e[n].data.length;++t)e[n].data[t]*=r,e[n].data[t]>d[t]&&(h[t]=n,d[t]=e[n].data[t])}let p=0;for(let s=0;s<n.length;++s){let a=n[s],[o,l]=this.check_segment_validity(h,e,s,r,i);if(o){for(let e of(++p,l))u.data[e]=p;c.push({id:p,label_id:a,score:t[s]})}}return[u,c]}post_process_panoptic_segmentation(e,t=.5,n=.5,r=.8,i=null,s=null){null===i&&(console.warn("`label_ids_to_fuse` unset. No instance will be fused."),i=new Set);let a=e.logits,o=e.pred_masks.sigmoid(),[l,u,c]=a.dims;if(c-=1,null!==s&&s.length!==l)throw Error("Make sure that you pass in as many target sizes as the batch dimension of the logits");let h=[];for(let e=0;e<l;++e){let l=null!==s?s[e]:null,u=a[e],d=o[e],[p,f,g]=this.remove_low_and_no_objects(u,d,t,c);if(0===g.length){let[e,t]=l??d.dims.slice(-2),n=new Ft("int32",new Int32Array(e*t).fill(-1),[e,t]);h.push({segmentation:n,segments_info:[]});continue}let[m,y]=this.compute_segments(p,f,g,n,r,i,l);h.push({segmentation:m,segments_info:y})}return h}post_process_instance_segmentation(){throw Error("Not implemented yet")}}class Wh extends GJ{post_process_object_detection(...e){return GH(...e)}}class Wd extends GJ{reshape_input_points(e,t,n){let r=Dl(e=structuredClone(e));if(3===r.length)r=[1,...r],e=[e];else if(4!==r.length)throw Error("The input_points must be a 4D tensor of shape `batch_size`, `point_batch_size`, `nb_points_per_image`, `2`.");for(let r=0;r<e.length;++r){let i=t[r],s=n[r],a=[s[0]/i[0],s[1]/i[1]];for(let t=0;t<e[r].length;++t)for(let n=0;n<e[r][t].length;++n)for(let i=0;i<e[r][t][n].length;++i)e[r][t][n][i]*=a[i]}return new Ft("float32",Float32Array.from(e.flat(1/0)),r)}add_input_labels(e,t){let n=Dl(e);if(2===n.length)n=[1,...n],e=[e];else if(3!==n.length)throw Error("The input_points must be a 4D tensor of shape `batch_size`, `point_batch_size`, `nb_points_per_image`, `2`.");if(n.some((e,n)=>e!==t.dims[n]))throw Error(`The first ${n.length} dimensions of 'input_points' and 'input_labels' must be the same.`);return new Ft("int64",e.flat(1/0).map(BigInt),n)}async _call(e,t=null,n=null){let r=await super._call(e);if(t&&(r.input_points=this.reshape_input_points(t,r.original_sizes,r.reshaped_input_sizes)),n){if(!r.input_points)throw Error("`input_points` must be provided if `input_labels` are provided.");r.input_labels=this.add_input_labels(n,r.input_points)}return r}post_process_masks(e,t,n,{mask_threshold:r=0,binarize:i=!0,pad_size:s=null}={}){let a=[],o=[(s=s??this.pad_size).height,s.width];for(let s=0;s<t.length;++s){let l=t[s],u=n[s],c=e[s],h=[];for(let e=0;e<c.dims[0];++e){let t=Fi(c[e],o,"bilinear",!1);if(t=Fi(t=t.slice(null,[0,u[0]],[0,u[1]]),l,"bilinear",!1),i){let e=new Uint8Array(t.data.length);for(let n=0;n<t.data.length;++n)t.data[n]>r&&(e[n]=1);t=new Ft("bool",e,t.dims)}h.push(t)}a.push(Fc(h))}return a}}class Wp extends GJ{pad_image(e,t,n,r={}){let[i,s,a]=t;return super.pad_image(e,t,{width:s+(n-s%n)%n,height:i+(n-i%n)%n},{mode:"symmetric",center:!1,constant_values:-1,...r})}}class Wf extends GJ{async _call(e,t){Array.isArray(e)||(e=[e]),Array.isArray(t)||(t=[t]);let n=await Promise.all(e.map(e=>this.preprocess(e))),r=await Promise.all(t.map(e=>this.preprocess(e,{do_normalize:!1,do_convert_rgb:!1,do_convert_grayscale:!0})));return{pixel_values:Fc(n.map((e,t)=>Fu([e.pixel_values,r[t].pixel_values],0)),0),original_sizes:n.map(e=>e.original_size),reshaped_input_sizes:n.map(e=>e.reshaped_input_size)}}}class Wg extends GQ{constructor(e){super(e),this.config.mel_filters??=Gz(Math.floor(1+this.config.n_fft/2),this.config.feature_size,0,8e3,this.config.sampling_rate,"slaney","slaney"),this.window=GW(this.config.n_fft,"hann")}_extract_fbank_features(e){let{data:t,dims:n}=GG(e,this.window,this.config.n_fft,this.config.hop_length,{power:2,mel_filters:this.config.mel_filters,log_mel:"log10",max_num_frames:this.config.nb_max_frames}),r=D1(t)[0];for(let e=0;e<t.length;++e)t[e]=(Math.max(t[e],r-8)+4)/4;return{data:t,dims:n}}async _call(e){let t;GK(e,"WhisperFeatureExtractor"),e.length>this.config.n_samples?(console.warn("Attempting to extract features for audio longer than 30 seconds. If using a pipeline to extract transcript from a long audio clip, remember to specify `chunk_length_s` and/or `stride_length_s`."),t=e.slice(0,this.config.n_samples)):(t=new Float32Array(this.config.n_samples)).set(e);let{data:n,dims:r}=this._extract_fbank_features(t);return{input_features:new Ft("float32",n,[1,...r])}}}class Wm extends GQ{_zero_mean_unit_var_norm(e){let t=e.reduce((e,t)=>e+t,0)/e.length,n=e.reduce((e,n)=>e+(n-t)**2,0)/e.length;return e.map(e=>(e-t)/Math.sqrt(n+1e-7))}async _call(e){GK(e,"Wav2Vec2FeatureExtractor"),e instanceof Float64Array&&(e=new Float32Array(e));let t=e;this.config.do_normalize&&(t=this._zero_mean_unit_var_norm(t));let n=[1,t.length];return{input_values:new Ft("float32",t,n),attention_mask:new Ft("int64",new BigInt64Array(t.length).fill(1n),n)}}}class Wy extends GQ{constructor(e){super(e);let t=this.config.sampling_rate,n=Gz(256,this.config.num_mel_bins,20,Math.floor(t/2),t,null,"kaldi",!0);for(let e=0;e<n.length;++e)n[e].push(0);this.mel_filters=n,this.window=GW(400,"povey",{periodic:!1})}_extract_fbank_features(e,t){return GG(e=e.map(e=>32768*e),this.window,400,160,{fft_length:512,power:2,center:!1,preemphasis:.97,mel_filters:this.mel_filters,log_mel:"log",mel_floor:1192092955078125e-22,remove_dc_offset:!0,max_num_frames:t,transpose:!0})}async _call(e,{padding:t=!0,pad_to_multiple_of:n=2,do_normalize_per_mel_bins:r=!0,return_attention_mask:i=!0}={}){let s;GK(e,"SeamlessM4TFeatureExtractor");let a=this._extract_fbank_features(e,this.config.max_length);if(r){let[e,t]=a.dims;for(let n=0;n<t;++n){let r=0;for(let i=0;i<e;++i)r+=a.data[i*t+n];let i=r/e,s=0;for(let r=0;r<e;++r)s+=(a.data[r*t+n]-i)**2;let o=Math.sqrt((s/=e-1)+1e-7);for(let r=0;r<e;++r){let e=r*t+n;a.data[e]=(a.data[e]-i)/o}}}if(t){let[e,t]=a.dims,r=e%n;if(r>0){let n=new Float32Array(t*(e+r));n.set(a.data),n.fill(this.config.padding_value,a.data.length);let o=e+r;a={data:n,dims:[o,t]},i&&(s=new Ft("int64",new BigInt64Array(o),[1,o])).data.fill(1n,0,e)}}let[o,l]=a.dims,u=this.config.stride;if(0!=o%u)throw Error(`The number of frames (${o}) must be a multiple of the stride (${u}).`);let c=new Ft("float32",a.data,a.dims).view(1,Math.floor(o/u),l*u),h={input_features:c};if(i){let e=c.dims[1],t=new Ft("int64",new BigInt64Array(e),[1,e]);if(s)for(let e=1,n=0;e<o;e+=u,++n)t.data[n]=s.data[e];else t.data.fill(1n);h.attention_mask=t}return h}}class Wb extends GQ{constructor(e){super(e);let t=this.config.sampling_rate,n=Gz(256,this.config.num_mel_bins,20,Math.floor(t/2),t,null,"kaldi",!0);for(let e=0;e<n.length;++e)n[e].push(0);this.mel_filters=n,this.window=GW(400,"hann",{periodic:!1}),this.mean=this.config.mean,this.std=this.config.std}_extract_fbank_features(e,t){return GG(e,this.window,400,160,{fft_length:512,power:2,center:!1,preemphasis:.97,mel_filters:this.mel_filters,log_mel:"log",mel_floor:1192092955078125e-22,remove_dc_offset:!0,max_num_frames:t,transpose:!0})}async _call(e){GK(e,"ASTFeatureExtractor");let t=this._extract_fbank_features(e,this.config.max_length);if(this.config.do_normalize){let e=2*this.std;for(let n=0;n<t.data.length;++n)t.data[n]=(t.data[n]-this.mean)/e}return{input_values:new Ft("float32",t.data,[1,...t.dims])}}}class Wv extends GQ{constructor(e){super(e),this.mel_filters=Gz(this.config.nb_frequency_bins,this.config.feature_size,this.config.frequency_min,this.config.frequency_max,this.config.sampling_rate,null,"htk"),this.mel_filters_slaney=Gz(this.config.nb_frequency_bins,this.config.feature_size,this.config.frequency_min,this.config.frequency_max,this.config.sampling_rate,"slaney","slaney"),this.window=GW(this.config.fft_window_size,"hann")}_get_input_mel(e,t,n,r){let i;let s=!1,a=e.length-t;if(a>0){if("rand_trunc"===n){s=!0;let n=Math.floor(Math.random()*(a+1));e=e.subarray(n,n+t),(i=this._extract_fbank_features(e,this.mel_filters_slaney,this.config.nb_max_samples)).dims=[1,...i.dims]}else throw Error(`Truncation strategy "${n}" not implemented`)}else{if(a<0){let n=new Float64Array(t);if(n.set(e),"repeat"===r)for(let r=e.length;r<t;r+=e.length)n.set(e.subarray(0,Math.min(e.length,t-r)),r);else if("repeatpad"===r)for(let t=e.length;t<-a;t+=e.length)n.set(e,t);e=n}if("fusion"===n)throw Error(`Truncation strategy "${n}" not implemented`);(i=this._extract_fbank_features(e,this.mel_filters_slaney,this.config.nb_max_samples)).dims=[1,...i.dims]}return{...i,longer:s}}_extract_fbank_features(e,t,n=null){return GG(e,this.window,this.config.fft_window_size,this.config.hop_length,{power:2,mel_filters:t,log_mel:"dB",max_num_frames:n,do_pad:!1,transpose:!0})}async _call(e,{max_length:t=null}={}){GK(e,"ClapFeatureExtractor");let n=this._get_input_mel(e,t??this.config.nb_max_samples,this.config.truncation,this.config.padding);return{input_features:new Ft("float32",n.data,[1,...n.dims])}}}class Ww extends GQ{}class W_ extends Di{constructor(e){super(),this.feature_extractor=e}async _call(e,...t){return await this.feature_extractor(e,...t)}}class Wx extends W_{async _call(...e){return await this.feature_extractor(...e)}post_process_masks(...e){return this.feature_extractor.post_process_masks(...e)}reshape_input_points(...e){return this.feature_extractor.reshape_input_points(...e)}}class WT extends W_{async _call(e){return await this.feature_extractor(e)}}class WI extends W_{async _call(e){return await this.feature_extractor(e)}}class Wk extends W_{async _call(e){return await this.feature_extractor(e)}}class WS extends W_{}class WE{static FEATURE_EXTRACTOR_CLASS_MAPPING={ImageFeatureExtractor:GJ,WhisperFeatureExtractor:Wg,ViTFeatureExtractor:G9,MobileViTFeatureExtractor:Wn,MobileViTImageProcessor:Wr,OwlViTFeatureExtractor:Wi,Owlv2ImageProcessor:Ws,CLIPFeatureExtractor:G4,ChineseCLIPFeatureExtractor:G6,SiglipImageProcessor:G5,ConvNextFeatureExtractor:G8,ConvNextImageProcessor:G7,SegformerFeatureExtractor:GZ,BitImageProcessor:G2,DPTImageProcessor:G1,DPTFeatureExtractor:G0,GLPNFeatureExtractor:G3,BeitFeatureExtractor:Wo,DeiTFeatureExtractor:Wa,DetrFeatureExtractor:Wc,YolosFeatureExtractor:Wh,DonutFeatureExtractor:Wl,NougatImageProcessor:Wu,EfficientNetImageProcessor:Wt,ViTImageProcessor:We,VitMatteImageProcessor:Wf,SamImageProcessor:Wd,Swin2SRImageProcessor:Wp,Wav2Vec2FeatureExtractor:Wm,SeamlessM4TFeatureExtractor:Wy,SpeechT5FeatureExtractor:Ww,ASTFeatureExtractor:Wb,ClapFeatureExtractor:Wv};static PROCESSOR_CLASS_MAPPING={WhisperProcessor:WT,Wav2Vec2ProcessorWithLM:WI,SamProcessor:Wx,SpeechT5Processor:Wk,OwlViTProcessor:WS};static async from_pretrained(e,{progress_callback:t=null,config:n=null,cache_dir:r=null,local_files_only:i=!1,revision:s="main"}={}){let a=n??await Dq(e,"preprocessor_config.json",!0,{progress_callback:t,config:n,cache_dir:r,local_files_only:i,revision:s}),o=a.feature_extractor_type??a.image_processor_type,l=this.FEATURE_EXTRACTOR_CLASS_MAPPING[o];if(!l){if(void 0!==a.size)console.warn(`Feature extractor type "${o}" not found, assuming ImageFeatureExtractor due to size parameter in config.`),l=GJ;else throw Error(`Unknown Feature Extractor type: ${o}`)}return new(this.PROCESSOR_CLASS_MAPPING[a.processor_class]??W_)(new l(a))}}async function WC(e){return Array.isArray(e)||(e=[e]),await Promise.all(e.map(e=>GN.read(e)))}async function WA(e,t){return Array.isArray(e)||(e=[e]),await Promise.all(e.map(e=>"string"==typeof e||e instanceof URL?GO(e,t):e instanceof Float64Array?new Float32Array(e):e))}function WN(e,t){t&&(e=e.map(e=>0|e));let[n,r,i,s]=e;return{xmin:n,ymin:r,xmax:i,ymax:s}}class WO extends Di{constructor({task:e,model:t,tokenizer:n=null,processor:r=null}){super(),this.task=e,this.model=t,this.tokenizer=n,this.processor=r}async dispose(){await this.model.dispose()}}class W$ extends WO{constructor(e){super(e)}async _call(e,{topk:t=1}={}){let n=this.tokenizer(e,{padding:!0,truncation:!0}),r=await this.model(n),i="multi_label_classification"===this.model.config.problem_type?e=>e.sigmoid().data:e=>DQ(e.data),s=this.model.config.id2label,a=[];for(let e of r.logits){let n=DZ(i(e),t).map(e=>({label:s[e[0]],score:e[1]}));1===t?a.push(...n):a.push(n)}return Array.isArray(e)||1===t?a:a[0]}}class WR extends WO{constructor(e){super(e)}async _call(e,{ignore_labels:t=["O"]}={}){let n=Array.isArray(e),r=this.tokenizer(n?e:[e],{padding:!0,truncation:!0}),i=(await this.model(r)).logits,s=this.model.config.id2label,a=[];for(let e=0;e<i.dims[0];++e){let n=r.input_ids[e],o=i[e],l=[];for(let e=0;e<o.dims[0];++e){let r=o[e],i=D1(r.data)[1],a=s?s[i]:`LABEL_${i}`;if(t.includes(a))continue;let u=this.tokenizer.decode([n[e].item()],{skip_special_tokens:!0});if(""===u)continue;let c=DQ(r.data);l.push({entity:a,score:c[i],index:e,word:u,start:null,end:null})}a.push(l)}return n?a:a[0]}}class WD extends WO{constructor(e){super(e)}async _call(e,t,{topk:n=1}={}){let r=this.tokenizer(e,{text_pair:t,padding:!0,truncation:!0}),i=await this.model(r),s=[];for(let e=0;e<i.start_logits.dims[0];++e){let t=r.input_ids[e],a=t.indexOf(this.tokenizer.sep_token_id),o=Dh(Array.from(DQ(i.start_logits[e].data)).map((e,t)=>[e,t]).filter(e=>e[1]>a),Array.from(DQ(i.end_logits[e].data)).map((e,t)=>[e,t]).filter(e=>e[1]>a)).filter(e=>e[0][1]<=e[1][1]).map(e=>[e[0][1],e[1][1],e[0][0]*e[1][0]]).sort((e,t)=>t[2]-e[2]);for(let e=0;e<Math.min(o.length,n);++e){let[n,r,i]=o[e],a=[...t].slice(n,r+1),l=this.tokenizer.decode(a,{skip_special_tokens:!0});s.push({answer:l,score:i})}}return 1===n?s[0]:s}}class WF extends WO{constructor(e){super(e)}async _call(e,{topk:t=5}={}){let n=this.tokenizer(e,{padding:!0,truncation:!0}),r=await this.model(n),i=[];for(let e=0;e<n.input_ids.dims[0];++e){let s=n.input_ids[e],a=s.indexOf(this.tokenizer.mask_token_id);if(-1===a)throw Error(`Mask token (${this.tokenizer.mask_token}) not found in text.`);let o=DZ(DQ(r.logits[e][a].data),t);i.push(o.map(e=>{let t=[...s];return t[a]=e[0],{score:e[1],token:e[0],token_str:this.tokenizer.model.vocab[e[0]],sequence:this.tokenizer.decode(t,{skip_special_tokens:!0})}}))}return Array.isArray(e)?i:i[0]}}class WP extends WO{_key="generated_text";constructor(e){super(e)}async _call(e,t={}){let n;Array.isArray(e)||(e=[e]),this.model.config.prefix&&(e=e.map(e=>this.model.config.prefix+e));let r=this.model.config.task_specific_params;r&&r[this.task]&&r[this.task].prefix&&(e=e.map(e=>r[this.task].prefix+e));let i=this.tokenizer,s={padding:!0,truncation:!0};n=this instanceof WL&&"_build_translation_inputs"in i?i._build_translation_inputs(e,s,t).input_ids:i(e,s).input_ids;let a=await this.model.generate(n,t);return i.batch_decode(a,{skip_special_tokens:!0}).map(e=>({[this._key]:e}))}}class WM extends WP{_key="summary_text";constructor(e){super(e)}}class WL extends WP{_key="translation_text";constructor(e){super(e)}}function Wz(e){return Array.isArray(e)&&e.every(e=>"role"in e&&"content"in e)}class WB extends WO{constructor(e){super(e)}async _call(e,t={}){let n,r,i=!1,s=!1;if("string"==typeof e)n=e=[e];else if(Array.isArray(e)&&e.every(e=>"string"==typeof e))i=!0,n=e;else{if(Wz(e))e=[e];else if(Array.isArray(e)&&e.every(Wz))i=!0;else throw Error("Input must be a string, an array of strings, a Chat, or an array of Chats");s=!0,n=e.map(e=>this.tokenizer.apply_chat_template(e,{tokenize:!1,add_generation_prompt:!0}))}let a=t.add_special_tokens??!1,o=!s&&(t.return_full_text??!0);this.tokenizer.padding_side="left";let{input_ids:l,attention_mask:u}=this.tokenizer(n,{add_special_tokens:a,padding:!0,truncation:!0}),c=await this.model.generate(l,t,null,{inputs_attention_mask:u}),h=this.tokenizer.batch_decode(c,{skip_special_tokens:!0});!o&&l.dims.at(-1)>0&&(r=this.tokenizer.batch_decode(l,{skip_special_tokens:!0}).map(e=>e.length));let d=Array.from({length:e.length},e=>[]);for(let t=0;t<h.length;++t){let n=Math.floor(t/c.length*e.length);r&&(h[t]=h[t].slice(r[n])),d[n].push({generated_text:s?[...e[n],{role:"assistant",content:h[t]}]:h[t]})}return i||1!==d.length?d:d[0]}}class WU extends WO{constructor(e){super(e),this.label2id=Object.fromEntries(Object.entries(this.model.config.label2id).map(([e,t])=>[e.toLowerCase(),t])),this.entailment_id=this.label2id.entailment,void 0===this.entailment_id&&(console.warn("Could not find 'entailment' in label2id mapping. Using 2 as entailment_id."),this.entailment_id=2),this.contradiction_id=this.label2id.contradiction??this.label2id.not_entailment,void 0===this.contradiction_id&&(console.warn("Could not find 'contradiction' in label2id mapping. Using 0 as contradiction_id."),this.contradiction_id=0)}async _call(e,t,{hypothesis_template:n="This example is {}.",multi_label:r=!1}={}){let i=Array.isArray(e);i||(e=[e]),Array.isArray(t)||(t=[t]);let s=t.map(e=>n.replace("{}",e)),a=r||1===t.length,o=[];for(let n of e){let e=[];for(let t of s){let r=this.tokenizer(n,{text_pair:t,padding:!0,truncation:!0}),i=await this.model(r);a?e.push([i.logits.data[this.contradiction_id],i.logits.data[this.entailment_id]]):e.push(i.logits.data[this.entailment_id])}let r=(a?e.map(e=>DQ(e)[1]):DQ(e)).map((e,t)=>[e,t]).sort((e,t)=>t[0]-e[0]);o.push({sequence:n,labels:r.map(e=>t[e[1]]),scores:r.map(e=>e[0])})}return i?o:o[0]}}class WV extends WO{constructor(e){super(e)}async _call(e,{pooling:t="none",normalize:n=!1,quantize:r=!1,precision:i="binary"}={}){let s=this.tokenizer(e,{padding:!0,truncation:!0}),a=await this.model(s),o=a.last_hidden_state??a.logits??a.token_embeddings;if("none"===t);else if("mean"===t)o=Fs(o,s.attention_mask);else if("cls"===t)o=o.slice(null,0);else throw Error(`Pooling method '${t}' not supported.`);return n&&(o=o.normalize(2,-1)),r&&(o=Fy(o,i)),o}}class Wj extends WO{constructor(e){super(e)}async _call(e,{pool:t=null}={}){let n;let r=await WC(e),{pixel_values:i}=await this.processor(r),s=await this.model({pixel_values:i});if(t){if(!("pooler_output"in s))throw Error("No pooled output was returned. Make sure the model has a 'pooler' layer when using the 'pool' option.");n=s.pooler_output}else n=s.last_hidden_state??s.logits??s.image_embeds;return n}}class WG extends WO{constructor(e){super(e)}async _call(e,{topk:t=null}={}){let n=!Array.isArray(e),r=this.processor.feature_extractor.config.sampling_rate,i=await WA(e,r),s=this.model.config.id2label,a=[];for(let e of i){let n=await this.processor(e),r=DZ(DQ((await this.model(n)).logits[0].data),t).map(e=>({label:s[e[0]],score:e[1]}));1===t?a.push(...r):a.push(r)}return n&&1!==t?a[0]:a}}class WW extends WO{constructor(e){super(e)}async _call(e,t,{hypothesis_template:n="This is a sound of {}."}={}){let r=!Array.isArray(e);r&&(e=[e]);let i=t.map(e=>n.replace("{}",e)),s=this.tokenizer(i,{padding:!0,truncation:!0}),a=this.processor.feature_extractor.config.sampling_rate,o=await WA(e,a),l=[];for(let e of o){let n=await this.processor(e),r=DQ((await this.model({...s,...n})).logits_per_audio.data);l.push([...r].map((e,n)=>({score:e,label:t[n]})))}return r?l[0]:l}}class Wq extends WO{constructor(e){super(e)}async _call(e,t={}){switch(this.model.config.model_type){case"whisper":return this._call_whisper(e,t);case"wav2vec2":case"wav2vec2-bert":case"unispeech":case"unispeech-sat":case"hubert":return this._call_wav2vec2(e,t);default:throw Error(`AutomaticSpeechRecognitionPipeline does not support model type '${this.model.config.model_type}'.`)}}async _call_wav2vec2(e,t={}){t.language&&console.warn('`language` parameter is not yet supported for `wav2vec2` models, defaulting to "English".'),t.task&&console.warn('`task` parameter is not yet supported for `wav2vec2` models, defaulting to "transcribe".');let n=!Array.isArray(e);n&&(e=[e]);let r=this.processor.feature_extractor.config.sampling_rate,i=await WA(e,r),s=[];for(let e of i){let t=await this.processor(e),n=(await this.model(t)).logits[0],r=[];for(let e of n)r.push(D1(e.data)[1]);let i=this.tokenizer.decode(r);s.push({text:i})}return n?s[0]:s}async _call_whisper(e,t={}){let n=t.return_timestamps??!1,r=t.chunk_length_s??0,i=t.chunk_callback??null,s=t.force_full_sequences??!1,a=t.stride_length_s??null;"word"===n&&(t.return_token_timestamps=!0);let o=Du(t,"language",null),l=Du(t,"task",null);if(o||l||n){if(t.forced_decoder_ids)throw Error("Cannot specify `language`/`task`/`return_timestamps` and `forced_decoder_ids` at the same time.");let e=this.tokenizer.get_decoder_prompt_ids({language:o,task:l,no_timestamps:!n});e.length>0&&(t.forced_decoder_ids=e)}let u=!Array.isArray(e);u&&(e=[e]);let c=this.processor.feature_extractor.config.chunk_length/this.model.config.max_source_positions,h=this.processor.feature_extractor.config.hop_length,d=this.processor.feature_extractor.config.sampling_rate,p=await WA(e,d),f=[];for(let e of p){let o=[];if(r>0){if(null===a)a=r/6;else if(r<=a)throw Error("`chunk_length_s` must be larger than `stride_length_s`.");let t=d*r,n=d*a,i=t-2*n,s=0;for(;s<e.length;){let r=e.subarray(s,s+t),a=await this.processor(r),l=0===s,u=s+i>=e.length;o.push({stride:[r.length,l?0:n,u?0:n],input_features:a.input_features,is_last:u}),s+=i}}else o=[{stride:[e.length,0,0],input_features:(await this.processor(e)).input_features,is_last:!0}];for(let e of o){t.num_frames=Math.floor(e.stride[0]/h);let r=await this.model.generate(e.input_features,t);"word"===n?(e.tokens=r.sequences[0],e.token_timestamps=r.token_timestamps.tolist()[0].map(e=>D8(e,2))):e.tokens=r[0],e.stride=e.stride.map(e=>e/d),null!==i&&i(e)}let[l,u]=this.tokenizer._decode_asr(o,{time_precision:c,return_timestamps:n,force_full_sequences:s});f.push({text:l,...u})}return u?f[0]:f}}class WH extends WO{constructor(e){super(e)}async _call(e,t={}){let n=Array.isArray(e),r=await WC(e),{pixel_values:i}=await this.processor(r),s=[];for(let e of i){e.dims=[1,...e.dims];let n=await this.model.generate(e,t),r=this.tokenizer.batch_decode(n,{skip_special_tokens:!0}).map(e=>({generated_text:e.trim()}));s.push(r)}return n?s:s[0]}}class WK extends WO{constructor(e){super(e)}async _call(e,{topk:t=1}={}){let n=Array.isArray(e),r=await WC(e),{pixel_values:i}=await this.processor(r),s=await this.model({pixel_values:i}),a=this.model.config.id2label,o=[];for(let e of s.logits){let n=DZ(DQ(e.data),t).map(e=>({label:a[e[0]],score:e[1]}));1===t?o.push(...n):o.push(n)}return n||1===t?o:o[0]}}class WX extends WO{constructor(e){super(e),this.subtasks_mapping={panoptic:"post_process_panoptic_segmentation",instance:"post_process_instance_segmentation",semantic:"post_process_semantic_segmentation"}}async _call(e,{threshold:t=.5,mask_threshold:n=.5,overlap_mask_area_threshold:r=.8,label_ids_to_fuse:i=null,target_sizes:s=null,subtask:a=null}={}){if(Array.isArray(e)&&1!==e.length)throw Error("Image segmentation pipeline currently only supports a batch size of 1.");let o=await WC(e),l=o.map(e=>[e.height,e.width]),{pixel_values:u,pixel_mask:c}=await this.processor(o),h=await this.model({pixel_values:u,pixel_mask:c}),d=null;if(null!==a)d=this.subtasks_mapping[a];else for(let[e,t]of Object.entries(this.subtasks_mapping))if(t in this.processor.feature_extractor){d=this.processor.feature_extractor[t].bind(this.processor.feature_extractor),a=e;break}let p=this.model.config.id2label,f=[];if("panoptic"===a||"instance"===a){let e=d(h,t,n,r,i,s??l)[0],a=e.segmentation;for(let t of e.segments_info){let e=new Uint8ClampedArray(a.data.length);for(let n=0;n<a.data.length;++n)a.data[n]===t.id&&(e[n]=255);let n=new GN(e,a.dims[1],a.dims[0],1);f.push({score:t.score,label:p[t.label_id],mask:n})}}else if("semantic"===a){let{segmentation:e,labels:t}=d(h,s??l)[0];for(let n of t){let t=new Uint8ClampedArray(e.data.length);for(let r=0;r<e.data.length;++r)e.data[r]===n&&(t[r]=255);let r=new GN(t,e.dims[1],e.dims[0],1);f.push({score:null,label:p[n],mask:r})}}else throw Error(`Subtask ${a} not supported.`);return f}}class WY extends WO{constructor(e){super(e)}async _call(e,t,{hypothesis_template:n="This is a photo of {}"}={}){let r=Array.isArray(e),i=await WC(e),s=t.map(e=>n.replace("{}",e)),a=this.tokenizer(s,{padding:"siglip"!==this.model.config.model_type||"max_length",truncation:!0}),{pixel_values:o}=await this.processor(i),l=await this.model({...a,pixel_values:o}),u="siglip"===this.model.config.model_type?e=>e.sigmoid().data:e=>DQ(e.data),c=[];for(let e of l.logits_per_image){let n=[...u(e)].map((e,n)=>({score:e,label:t[n]}));n.sort((e,t)=>t.score-e.score),c.push(n)}return r?c:c[0]}}class WQ extends WO{constructor(e){super(e)}async _call(e,{threshold:t=.9,percentage:n=!1}={}){let r=Array.isArray(e);if(r&&1!==e.length)throw Error("Object detection pipeline currently only supports a batch size of 1.");let i=await WC(e),s=n?null:i.map(e=>[e.height,e.width]),{pixel_values:a,pixel_mask:o}=await this.processor(i),l=await this.model({pixel_values:a,pixel_mask:o}),u=this.processor.feature_extractor.post_process_object_detection(l,t,s),c=this.model.config.id2label,h=u.map(e=>e.boxes.map((t,r)=>({score:e.scores[r],label:c[e.classes[r]],box:WN(t,!n)})));return r?h:h[0]}}class WJ extends WO{constructor(e){super(e)}async _call(e,t,{threshold:n=.1,topk:r=null,percentage:i=!1}={}){let s=Array.isArray(e),a=await WC(e),o=this.tokenizer(t,{padding:!0,truncation:!0}),l=await this.processor(a),u=[];for(let e=0;e<a.length;++e){let s=a[e],c=i?null:[[s.height,s.width]],h=l.pixel_values[e].unsqueeze_(0),d=await this.model({...o,pixel_values:h}),p=this.processor.feature_extractor.post_process_object_detection(d,n,c,!0)[0],f=p.boxes.map((e,n)=>({score:p.scores[n],label:t[p.classes[n]],box:WN(e,!i)})).sort((e,t)=>t.score-e.score);null!==r&&(f=f.slice(0,r)),u.push(f)}return s?u:u[0]}}class WZ extends WO{constructor(e){super(e)}async _call(e,t,n={}){let r=(await WC(e))[0],{pixel_values:i}=await this.processor(r),s=`<s_docvqa><s_question>${t}</s_question><s_answer>`,a=this.tokenizer(s,{add_special_tokens:!1,padding:!0,truncation:!0}).input_ids,o=await this.model.generate(i,{...n,decoder_input_ids:a,max_length:this.model.config.decoder.max_position_embeddings}),l=this.tokenizer.batch_decode(o)[0].match(/<s_answer>(.*?)<\/s_answer>/),u=null;return l&&l.length>=2&&(u=l[1].trim()),[{answer:u}]}}class W0 extends WO{DEFAULT_VOCODER_ID="Xenova/speecht5_hifigan";constructor(e){super(e),this.vocoder=e.vocoder??null}async _call(e,{speaker_embeddings:t=null}={}){return this.processor?this._call_text_to_spectrogram(e,{speaker_embeddings:t}):this._call_text_to_waveform(e)}async _call_text_to_waveform(e){let t=this.tokenizer(e,{padding:!0,truncation:!0}),{waveform:n}=await this.model(t),r=this.model.config.sampling_rate;return{audio:n.data,sampling_rate:r}}async _call_text_to_spectrogram(e,{speaker_embeddings:t}){if(this.vocoder||(console.log("No vocoder specified, using default HifiGan vocoder."),this.vocoder=await j4.from_pretrained(this.DEFAULT_VOCODER_ID,{quantized:!1})),("string"==typeof t||t instanceof URL)&&(t=new Float32Array(await (await fetch(t)).arrayBuffer())),t instanceof Float32Array)t=new Ft("float32",t,[1,t.length]);else if(!(t instanceof Ft))throw Error("Speaker embeddings must be a `Tensor`, `Float32Array`, `string`, or `URL`.");let{input_ids:n}=this.tokenizer(e,{padding:!0,truncation:!0}),{waveform:r}=await this.model.generate_speech(n,t,{vocoder:this.vocoder}),i=this.processor.feature_extractor.config.sampling_rate;return{audio:r.data,sampling_rate:i}}}class W1 extends WO{constructor(e){super(e)}async _call(e){let t=await WC(e),n=await this.processor(t),r=await this.model(n),i=[];for(let e of r.reconstruction){let t=e.squeeze().clamp_(0,1).mul_(255).round_().to("uint8");i.push(GN.fromTensor(t))}return i.length>1?i:i[0]}}class W2 extends WO{constructor(e){super(e)}async _call(e){let t=await WC(e),n=await this.processor(t),{predicted_depth:r}=await this.model(n),i=[];for(let e=0;e<t.length;++e){let n=Fi(r[e],t[e].size.reverse(),"bilinear",!1),s=n.mul_(255/D1(n.data)[0]).to("uint8");i.push({predicted_depth:r[e],depth:GN.fromTensor(s)})}return i.length>1?i:i[0]}}let W3=Object.freeze({"text-classification":{tokenizer:M4,pipeline:W$,model:j6,default:{model:"Xenova/distilbert-base-uncased-finetuned-sst-2-english"},type:"text"},"token-classification":{tokenizer:M4,pipeline:WR,model:j5,default:{model:"Xenova/bert-base-multilingual-cased-ner-hrl"},type:"text"},"question-answering":{tokenizer:M4,pipeline:WD,model:Gr,default:{model:"Xenova/distilbert-base-cased-distilled-squad"},type:"text"},"fill-mask":{tokenizer:M4,pipeline:WF,model:Gn,default:{model:"Xenova/bert-base-uncased"},type:"text"},summarization:{tokenizer:M4,pipeline:WM,model:j8,default:{model:"Xenova/distilbart-cnn-6-6"},type:"text"},translation:{tokenizer:M4,pipeline:WL,model:j8,default:{model:"Xenova/t5-small"},type:"text"},"text2text-generation":{tokenizer:M4,pipeline:WP,model:j8,default:{model:"Xenova/flan-t5-small"},type:"text"},"text-generation":{tokenizer:M4,pipeline:WB,model:Gt,default:{model:"Xenova/gpt2"},type:"text"},"zero-shot-classification":{tokenizer:M4,pipeline:WU,model:j6,default:{model:"Xenova/distilbert-base-uncased-mnli"},type:"text"},"audio-classification":{pipeline:WG,model:Gh,processor:WE,default:{model:"Xenova/wav2vec2-base-superb-ks"},type:"audio"},"zero-shot-audio-classification":{tokenizer:M4,pipeline:WW,model:j4,processor:WE,default:{model:"Xenova/clap-htsat-unfused"},type:"multimodal"},"automatic-speech-recognition":{tokenizer:M4,pipeline:Wq,model:[j7,Gc],processor:WE,default:{model:"Xenova/whisper-tiny.en"},type:"multimodal"},"text-to-audio":{tokenizer:M4,pipeline:W0,model:[Ge,j9],processor:[WE,null],default:{model:"Xenova/speecht5_tts"},type:"text"},"image-to-text":{tokenizer:M4,pipeline:WH,model:Gi,processor:WE,default:{model:"Xenova/vit-gpt2-image-captioning"},type:"multimodal"},"image-classification":{pipeline:WK,model:Gs,processor:WE,default:{model:"Xenova/vit-base-patch16-224"},type:"multimodal"},"image-segmentation":{pipeline:WX,model:[Ga,Go],processor:WE,default:{model:"Xenova/detr-resnet-50-panoptic"},type:"multimodal"},"zero-shot-image-classification":{tokenizer:M4,pipeline:WY,model:j4,processor:WE,default:{model:"Xenova/clip-vit-base-patch32"},type:"multimodal"},"object-detection":{pipeline:WQ,model:Gl,processor:WE,default:{model:"Xenova/detr-resnet-50"},type:"multimodal"},"zero-shot-object-detection":{tokenizer:M4,pipeline:WJ,model:Gu,processor:WE,default:{model:"Xenova/owlvit-base-patch32"},type:"multimodal"},"document-question-answering":{tokenizer:M4,pipeline:WZ,model:Gd,processor:WE,default:{model:"Xenova/donut-base-finetuned-docvqa"},type:"multimodal"},"image-to-image":{pipeline:W1,model:Gp,processor:WE,default:{model:"Xenova/swin2SR-classical-sr-x2-64"},type:"image"},"depth-estimation":{pipeline:W2,model:Gf,processor:WE,default:{model:"Xenova/dpt-large"},type:"image"},"feature-extraction":{tokenizer:M4,pipeline:WV,model:j4,default:{model:"Xenova/all-MiniLM-L6-v2"},type:"text"},"image-feature-extraction":{processor:WE,pipeline:Wj,model:[Gg,j4],default:{model:"Xenova/vit-base-patch16-224-in21k"},type:"image"}}),W4=Object.freeze({"sentiment-analysis":"text-classification",ner:"token-classification",asr:"automatic-speech-recognition","text-to-speech":"text-to-audio",embeddings:"feature-extraction"});async function W6(e,t=null,{quantized:n=!0,progress_callback:r=null,config:i=null,cache_dir:s=null,local_files_only:a=!1,revision:o="main",model_file_name:l=null}={}){let u=W3[(e=W4[e]??e).split("_",1)[0]];if(!u)throw Error(`Unsupported pipeline: ${e}. Must be one of [${Object.keys(W3)}]`);t||(t=u.default.model,console.log(`No model specified. Using default model: "${t}".`));let c={quantized:n,progress_callback:r,config:i,cache_dir:s,local_files_only:a,revision:o,model_file_name:l},h=new Map([["tokenizer",u.tokenizer],["model",u.model],["processor",u.processor]]),d=await W5(h,t,c);return d.task=e,Dt(r,{status:"ready",task:e,model:t}),new u.pipeline(d)}async function W5(e,t,n){let r=Object.create(null),i=[];for(let[s,a]of e.entries()){let e;a&&(e=Array.isArray(a)?new Promise(async(e,r)=>{let i;for(let r of a){if(null===r){e(null);return}try{e(await r.from_pretrained(t,n));return}catch(e){i=e}}r(i)}):a.from_pretrained(t,n),r[s]=e,i.push(e))}for(let[e,t]of(await Promise.all(i),Object.entries(r)))r[e]=await t;return r}let W8=new(n(362)),W7=null,W9=null,qe=!1;async function qt(){if(!W7&&!W9&&!qe){qe=!0;try{await i5(),"cpu"!==i8()&&await i6("cpu"),W7=await W6("text-classification","Xenova/distilbert-base-uncased-finetuned-sst-2-english"),W9=await W6("sentiment-analysis","Xenova/distilbert-base-uncased-finetuned-sst-2-english"),console.log("NLP models initialized successfully")}catch(e){console.error("Error initializing NLP models:",e),W7=null,W9=null}finally{qe=!1}}}async function qn(e){if(!(null==e?void 0:e.trim()))return{score:0,magnitude:0,topWords:[],confidence:0,sentimentLabel:"neutral"};try{W7&&W9||await qt();let t=W8.analyze(e),n=t.score/Math.max(t.tokens.length,1),r=t.words.slice(0,5);0===r.length&&(r=e.split(" ").slice(0,3));let i=0,s=0,a="neutral";if(W9)try{let t=await W9(e,{truncation:!0});i="POSITIVE"===t[0].label?t[0].score:-t[0].score,s=t[0].score,a=t[0].label.toLowerCase()}catch(e){console.warn("Transformer sentiment analysis failed:",e)}let o=.3*n+.7*i,l=Math.max(Math.min(o,1),-1);return .1>Math.abs(l)&&(a="neutral"),{score:l,magnitude:Math.abs(l),topWords:r,confidence:Math.max(s,.1),sentimentLabel:a}}catch(e){return console.error("Sentiment analysis failed:",e),{score:{},magnitude:{},topWords:[],confidence:{},sentimentLabel:"neutral"}}}async function qr(e){let t={"far-left":{keywords:["revolution","socialism","communist","abolish","collective","undocumented immigrant","immigration","MAGA","nazi"],weight:1},left:{keywords:["progressive","welfare","regulation","equality","reform","undocumented immigrant","immigration"],weight:.6},"center-left":{keywords:["liberal","public","social","healthcare","education","undocumented immigrant","immigration"],weight:.3},center:{keywords:["moderate","compromise","balance","bipartisan","pragmatic"],weight:0},"center-right":{keywords:["conservative","tradition","market","fiscal","values","illegal alien","invasion","border war"],weight:-.3},right:{keywords:["freedom","liberty","deregulation","privatize","tax cuts","illegal alien","invasion","border war"],weight:-.6},"far-right":{keywords:["nationalist","sovereignty","patriot","traditional","strong","illegal alien","invasion","border war","the Libs","Dems","MAGA","fascist"],weight:-1}},n=e.toLowerCase();if(W7)try{let t=await W7(e,{topk:1,truncation:!0}),n=t[0].label,r=t[0].score;return{spectrum:"POSITIVE"===n?"center-right":"center-left",confidence:r}}catch(e){console.warn("Transformer classification failed:",e)}let r=Object.entries(t).map(e=>{let[t,r]=e;return{category:t,score:r.keywords.reduce((e,t)=>e+(n.split(t.toLowerCase()).length-1)*r.weight,0)}});r.sort((e,t)=>t.score-e.score);let i=r[0],s=Math.min(Math.max(.5*Math.abs(i.score),.1),1);return{spectrum:0!==i.score?i.category:"center",confidence:s}}(async()=>{await qt()})()},1468:(e,t,n)=>{"use strict";n.d(t,{Kq:()=>G,d4:()=>g,wA:()=>H});var r=n(6540),i=n(8418),s=r,a=Symbol.for("react-redux-context"),o="undefined"!=typeof globalThis?globalThis:{},l=function(){if(!s.createContext)return{};let e=o[a]??(o[a]=new Map),t=e.get(s.createContext);return t||(t=s.createContext(null),e.set(s.createContext,t)),t}(),u=()=>{throw Error("uSES not initialized!")};function c(e=l){return function(){return s.useContext(e)}}var h=c(),d=u,p=e=>{d=e},f=(e,t)=>e===t,g=function(e=l){let t=e===l?h:c(e),n=(e,n={})=>{let{equalityFn:r=f,devModeChecks:i={}}="function"==typeof n?{equalityFn:n}:n,{store:a,subscription:o,getServerState:l,stabilityCheck:u,identityFunctionCheck:c}=t();s.useRef(!0);let h=s.useCallback({[e.name]:t=>e(t)}[e.name],[e,u,i.stabilityCheck]),p=d(o.addNestedSub,a.getState,l||a.getState,h,r);return s.useDebugValue(p),p};return Object.assign(n,{withTypes:()=>n}),n}(),m=Symbol.for("react.element"),y=Symbol.for("react.portal"),b=Symbol.for("react.fragment"),v=Symbol.for("react.strict_mode"),w=Symbol.for("react.profiler"),_=Symbol.for("react.provider"),x=Symbol.for("react.context"),T=Symbol.for("react.server_context"),I=Symbol.for("react.forward_ref"),k=Symbol.for("react.suspense"),S=Symbol.for("react.suspense_list"),E=Symbol.for("react.memo"),C=Symbol.for("react.lazy"),A=(Symbol.for("react.offscreen"),Symbol.for("react.client.reference"),I),N=E;function O(e){if("object"==typeof e&&null!==e){let t=e.$$typeof;switch(t){case m:{let n=e.type;switch(n){case b:case w:case v:case k:case S:return n;default:{let e=n&&n.$$typeof;switch(e){case T:case x:case I:case C:case E:case _:return e;default:return t}}}}case y:return t}}}function $(e){return O(e)===E}function R(e){return e.dependsOnOwnProps?!!e.dependsOnOwnProps:1!==e.length}function D(e){e()}function F(){let e=null,t=null;return{clear(){e=null,t=null},notify(){D(()=>{let t=e;for(;t;)t.callback(),t=t.next})},get(){let t=[],n=e;for(;n;)t.push(n),n=n.next;return t},subscribe(n){let r=!0,i=t={callback:n,next:null,prev:t};return i.prev?i.prev.next=i:e=i,function(){r&&null!==e&&(r=!1,i.next?i.next.prev=i.prev:t=i.prev,i.prev?i.prev.next=i.next:e=i.next)}}}}var P={notify(){},get:()=>[]};function M(e,t){let n;let r=P,i=0,s=!1;function a(){u.onStateChange&&u.onStateChange()}function o(){i++,n||(n=t?t.addNestedSub(a):e.subscribe(a),r=F())}function l(){i--,n&&0===i&&(n(),n=void 0,r.clear(),r=P)}let u={addNestedSub:function(e){o();let t=r.subscribe(e),n=!1;return()=>{n||(n=!0,t(),l())}},notifyNestedSubs:function(){r.notify()},handleChangeWrapper:a,isSubscribed:function(){return s},trySubscribe:function(){s||(s=!0,o())},tryUnsubscribe:function(){s&&(s=!1,l())},getListeners:()=>r};return u}var L="undefined"!=typeof window&&void 0!==window.document&&void 0!==window.document.createElement?s.useLayoutEffect:s.useEffect,z={childContextTypes:!0,contextType:!0,contextTypes:!0,defaultProps:!0,displayName:!0,getDefaultProps:!0,getDerivedStateFromError:!0,getDerivedStateFromProps:!0,mixins:!0,propTypes:!0,type:!0},B={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},U={[A]:{$$typeof:!0,render:!0,defaultProps:!0,displayName:!0,propTypes:!0},[N]:B};Object.getOwnPropertyNames,Object.getOwnPropertySymbols,Object.getOwnPropertyDescriptor,Object.getPrototypeOf,Object.prototype;var V=null,j=e=>{V=e},G=function({store:e,context:t,children:n,serverState:r,stabilityCheck:i="once",identityFunctionCheck:a="once"}){let o=s.useMemo(()=>{let t=M(e);return{store:e,subscription:t,getServerState:r?()=>r:void 0,stabilityCheck:i,identityFunctionCheck:a}},[e,r,i,a]),u=s.useMemo(()=>e.getState(),[e]);L(()=>{let{subscription:t}=o;return t.onStateChange=t.notifyNestedSubs,t.trySubscribe(),u!==e.getState()&&t.notifyNestedSubs(),()=>{t.tryUnsubscribe(),t.onStateChange=void 0}},[o,u]);let c=t||l;return s.createElement(c.Provider,{value:o},n)};function W(e=l){let t=e===l?h:c(e),n=()=>{let{store:e}=t();return e};return Object.assign(n,{withTypes:()=>n}),n}var q=W(),H=function(e=l){let t=e===l?q:W(e),n=()=>t().dispatch;return Object.assign(n,{withTypes:()=>n}),n}();p(i.useSyncExternalStoreWithSelector),j(r.useSyncExternalStore)},3093:(e,t,n)=>{"use strict";n.d(t,{N9:()=>et,oR:()=>U});var r=n(6540);function i(e){var t,n,r="";if("string"==typeof e||"number"==typeof e)r+=e;else if("object"==typeof e){if(Array.isArray(e)){var s=e.length;for(t=0;t<s;t++)e[t]&&(n=i(e[t]))&&(r&&(r+=" "),r+=n)}else for(n in e)e[n]&&(r&&(r+=" "),r+=n)}return r}let s=function(){for(var e,t,n=0,r="",s=arguments.length;n<s;n++)(e=arguments[n])&&(t=i(e))&&(r&&(r+=" "),r+=t);return r};!function(e){if(!e||"undefined"==typeof document)return;let t=document.head||document.getElementsByTagName("head")[0],n=document.createElement("style");n.type="text/css",t.firstChild?t.insertBefore(n,t.firstChild):t.appendChild(n),n.styleSheet?n.styleSheet.cssText=e:n.appendChild(document.createTextNode(e))}(`:root{--toastify-color-light: #fff;--toastify-color-dark: #121212;--toastify-color-info: #3498db;--toastify-color-success: #07bc0c;--toastify-color-warning: #f1c40f;--toastify-color-error: hsl(6, 78%, 57%);--toastify-color-transparent: rgba(255, 255, 255, .7);--toastify-icon-color-info: var(--toastify-color-info);--toastify-icon-color-success: var(--toastify-color-success);--toastify-icon-color-warning: var(--toastify-color-warning);--toastify-icon-color-error: var(--toastify-color-error);--toastify-container-width: fit-content;--toastify-toast-width: 320px;--toastify-toast-offset: 16px;--toastify-toast-top: max(var(--toastify-toast-offset), env(safe-area-inset-top));--toastify-toast-right: max(var(--toastify-toast-offset), env(safe-area-inset-right));--toastify-toast-left: max(var(--toastify-toast-offset), env(safe-area-inset-left));--toastify-toast-bottom: max(var(--toastify-toast-offset), env(safe-area-inset-bottom));--toastify-toast-background: #fff;--toastify-toast-padding: 14px;--toastify-toast-min-height: 64px;--toastify-toast-max-height: 800px;--toastify-toast-bd-radius: 6px;--toastify-toast-shadow: 0px 4px 12px rgba(0, 0, 0, .1);--toastify-font-family: sans-serif;--toastify-z-index: 9999;--toastify-text-color-light: #757575;--toastify-text-color-dark: #fff;--toastify-text-color-info: #fff;--toastify-text-color-success: #fff;--toastify-text-color-warning: #fff;--toastify-text-color-error: #fff;--toastify-spinner-color: #616161;--toastify-spinner-color-empty-area: #e0e0e0;--toastify-color-progress-light: linear-gradient(to right, #4cd964, #5ac8fa, #007aff, #34aadc, #5856d6, #ff2d55);--toastify-color-progress-dark: #bb86fc;--toastify-color-progress-info: var(--toastify-color-info);--toastify-color-progress-success: var(--toastify-color-success);--toastify-color-progress-warning: var(--toastify-color-warning);--toastify-color-progress-error: var(--toastify-color-error);--toastify-color-progress-bgo: .2}.Toastify__toast-container{z-index:var(--toastify-z-index);-webkit-transform:translate3d(0,0,var(--toastify-z-index));position:fixed;width:var(--toastify-container-width);box-sizing:border-box;color:#fff;display:flex;flex-direction:column}.Toastify__toast-container--top-left{top:var(--toastify-toast-top);left:var(--toastify-toast-left)}.Toastify__toast-container--top-center{top:var(--toastify-toast-top);left:50%;transform:translate(-50%);align-items:center}.Toastify__toast-container--top-right{top:var(--toastify-toast-top);right:var(--toastify-toast-right);align-items:end}.Toastify__toast-container--bottom-left{bottom:var(--toastify-toast-bottom);left:var(--toastify-toast-left)}.Toastify__toast-container--bottom-center{bottom:var(--toastify-toast-bottom);left:50%;transform:translate(-50%);align-items:center}.Toastify__toast-container--bottom-right{bottom:var(--toastify-toast-bottom);right:var(--toastify-toast-right);align-items:end}.Toastify__toast{--y: 0;position:relative;touch-action:none;width:var(--toastify-toast-width);min-height:var(--toastify-toast-min-height);box-sizing:border-box;margin-bottom:1rem;padding:var(--toastify-toast-padding);border-radius:var(--toastify-toast-bd-radius);box-shadow:var(--toastify-toast-shadow);max-height:var(--toastify-toast-max-height);font-family:var(--toastify-font-family);z-index:0;display:flex;flex:1 auto;align-items:center;word-break:break-word}@media only screen and (max-width: 480px){.Toastify__toast-container{width:100vw;left:env(safe-area-inset-left);margin:0}.Toastify__toast-container--top-left,.Toastify__toast-container--top-center,.Toastify__toast-container--top-right{top:env(safe-area-inset-top);transform:translate(0)}.Toastify__toast-container--bottom-left,.Toastify__toast-container--bottom-center,.Toastify__toast-container--bottom-right{bottom:env(safe-area-inset-bottom);transform:translate(0)}.Toastify__toast-container--rtl{right:env(safe-area-inset-right);left:initial}.Toastify__toast{--toastify-toast-width: 100%;margin-bottom:0;border-radius:0}}.Toastify__toast-container[data-stacked=true]{width:var(--toastify-toast-width)}.Toastify__toast--stacked{position:absolute;width:100%;transform:translate3d(0,var(--y),0) scale(var(--s));transition:transform .3s}.Toastify__toast--stacked[data-collapsed] .Toastify__toast-body,.Toastify__toast--stacked[data-collapsed] .Toastify__close-button{transition:opacity .1s}.Toastify__toast--stacked[data-collapsed=false]{overflow:visible}.Toastify__toast--stacked[data-collapsed=true]:not(:last-child)>*{opacity:0}.Toastify__toast--stacked:after{content:"";position:absolute;left:0;right:0;height:calc(var(--g) * 1px);bottom:100%}.Toastify__toast--stacked[data-pos=top]{top:0}.Toastify__toast--stacked[data-pos=bot]{bottom:0}.Toastify__toast--stacked[data-pos=bot].Toastify__toast--stacked:before{transform-origin:top}.Toastify__toast--stacked[data-pos=top].Toastify__toast--stacked:before{transform-origin:bottom}.Toastify__toast--stacked:before{content:"";position:absolute;left:0;right:0;bottom:0;height:100%;transform:scaleY(3);z-index:-1}.Toastify__toast--rtl{direction:rtl}.Toastify__toast--close-on-click{cursor:pointer}.Toastify__toast-icon{margin-inline-end:10px;width:22px;flex-shrink:0;display:flex}.Toastify--animate{animation-fill-mode:both;animation-duration:.5s}.Toastify--animate-icon{animation-fill-mode:both;animation-duration:.3s}.Toastify__toast-theme--dark{background:var(--toastify-color-dark);color:var(--toastify-text-color-dark)}.Toastify__toast-theme--light,.Toastify__toast-theme--colored.Toastify__toast--default{background:var(--toastify-color-light);color:var(--toastify-text-color-light)}.Toastify__toast-theme--colored.Toastify__toast--info{color:var(--toastify-text-color-info);background:var(--toastify-color-info)}.Toastify__toast-theme--colored.Toastify__toast--success{color:var(--toastify-text-color-success);background:var(--toastify-color-success)}.Toastify__toast-theme--colored.Toastify__toast--warning{color:var(--toastify-text-color-warning);background:var(--toastify-color-warning)}.Toastify__toast-theme--colored.Toastify__toast--error{color:var(--toastify-text-color-error);background:var(--toastify-color-error)}.Toastify__progress-bar-theme--light{background:var(--toastify-color-progress-light)}.Toastify__progress-bar-theme--dark{background:var(--toastify-color-progress-dark)}.Toastify__progress-bar--info{background:var(--toastify-color-progress-info)}.Toastify__progress-bar--success{background:var(--toastify-color-progress-success)}.Toastify__progress-bar--warning{background:var(--toastify-color-progress-warning)}.Toastify__progress-bar--error{background:var(--toastify-color-progress-error)}.Toastify__progress-bar-theme--colored.Toastify__progress-bar--info,.Toastify__progress-bar-theme--colored.Toastify__progress-bar--success,.Toastify__progress-bar-theme--colored.Toastify__progress-bar--warning,.Toastify__progress-bar-theme--colored.Toastify__progress-bar--error{background:var(--toastify-color-transparent)}.Toastify__close-button{color:#fff;position:absolute;top:6px;right:6px;background:transparent;outline:none;border:none;padding:0;cursor:pointer;opacity:.7;transition:.3s ease;z-index:1}.Toastify__toast--rtl .Toastify__close-button{left:6px;right:unset}.Toastify__close-button--light{color:#000;opacity:.3}.Toastify__close-button>svg{fill:currentColor;height:16px;width:14px}.Toastify__close-button:hover,.Toastify__close-button:focus{opacity:1}@keyframes Toastify__trackProgress{0%{transform:scaleX(1)}to{transform:scaleX(0)}}.Toastify__progress-bar{position:absolute;bottom:0;left:0;width:100%;height:100%;z-index:1;opacity:.7;transform-origin:left}.Toastify__progress-bar--animated{animation:Toastify__trackProgress linear 1 forwards}.Toastify__progress-bar--controlled{transition:transform .2s}.Toastify__progress-bar--rtl{right:0;left:initial;transform-origin:right;border-bottom-left-radius:initial}.Toastify__progress-bar--wrp{position:absolute;overflow:hidden;bottom:0;left:0;width:100%;height:5px;border-bottom-left-radius:var(--toastify-toast-bd-radius);border-bottom-right-radius:var(--toastify-toast-bd-radius)}.Toastify__progress-bar--wrp[data-hidden=true]{opacity:0}.Toastify__progress-bar--bg{opacity:var(--toastify-color-progress-bgo);width:100%;height:100%}.Toastify__spinner{width:20px;height:20px;box-sizing:border-box;border:2px solid;border-radius:100%;border-color:var(--toastify-spinner-color-empty-area);border-right-color:var(--toastify-spinner-color);animation:Toastify__spin .65s linear infinite}@keyframes Toastify__bounceInRight{0%,60%,75%,90%,to{animation-timing-function:cubic-bezier(.215,.61,.355,1)}0%{opacity:0;transform:translate3d(3000px,0,0)}60%{opacity:1;transform:translate3d(-25px,0,0)}75%{transform:translate3d(10px,0,0)}90%{transform:translate3d(-5px,0,0)}to{transform:none}}@keyframes Toastify__bounceOutRight{20%{opacity:1;transform:translate3d(-20px,var(--y),0)}to{opacity:0;transform:translate3d(2000px,var(--y),0)}}@keyframes Toastify__bounceInLeft{0%,60%,75%,90%,to{animation-timing-function:cubic-bezier(.215,.61,.355,1)}0%{opacity:0;transform:translate3d(-3000px,0,0)}60%{opacity:1;transform:translate3d(25px,0,0)}75%{transform:translate3d(-10px,0,0)}90%{transform:translate3d(5px,0,0)}to{transform:none}}@keyframes Toastify__bounceOutLeft{20%{opacity:1;transform:translate3d(20px,var(--y),0)}to{opacity:0;transform:translate3d(-2000px,var(--y),0)}}@keyframes Toastify__bounceInUp{0%,60%,75%,90%,to{animation-timing-function:cubic-bezier(.215,.61,.355,1)}0%{opacity:0;transform:translate3d(0,3000px,0)}60%{opacity:1;transform:translate3d(0,-20px,0)}75%{transform:translate3d(0,10px,0)}90%{transform:translate3d(0,-5px,0)}to{transform:translateZ(0)}}@keyframes Toastify__bounceOutUp{20%{transform:translate3d(0,calc(var(--y) - 10px),0)}40%,45%{opacity:1;transform:translate3d(0,calc(var(--y) + 20px),0)}to{opacity:0;transform:translate3d(0,-2000px,0)}}@keyframes Toastify__bounceInDown{0%,60%,75%,90%,to{animation-timing-function:cubic-bezier(.215,.61,.355,1)}0%{opacity:0;transform:translate3d(0,-3000px,0)}60%{opacity:1;transform:translate3d(0,25px,0)}75%{transform:translate3d(0,-10px,0)}90%{transform:translate3d(0,5px,0)}to{transform:none}}@keyframes Toastify__bounceOutDown{20%{transform:translate3d(0,calc(var(--y) - 10px),0)}40%,45%{opacity:1;transform:translate3d(0,calc(var(--y) + 20px),0)}to{opacity:0;transform:translate3d(0,2000px,0)}}.Toastify__bounce-enter--top-left,.Toastify__bounce-enter--bottom-left{animation-name:Toastify__bounceInLeft}.Toastify__bounce-enter--top-right,.Toastify__bounce-enter--bottom-right{animation-name:Toastify__bounceInRight}.Toastify__bounce-enter--top-center{animation-name:Toastify__bounceInDown}.Toastify__bounce-enter--bottom-center{animation-name:Toastify__bounceInUp}.Toastify__bounce-exit--top-left,.Toastify__bounce-exit--bottom-left{animation-name:Toastify__bounceOutLeft}.Toastify__bounce-exit--top-right,.Toastify__bounce-exit--bottom-right{animation-name:Toastify__bounceOutRight}.Toastify__bounce-exit--top-center{animation-name:Toastify__bounceOutUp}.Toastify__bounce-exit--bottom-center{animation-name:Toastify__bounceOutDown}@keyframes Toastify__zoomIn{0%{opacity:0;transform:scale3d(.3,.3,.3)}50%{opacity:1}}@keyframes Toastify__zoomOut{0%{opacity:1}50%{opacity:0;transform:translate3d(0,var(--y),0) scale3d(.3,.3,.3)}to{opacity:0}}.Toastify__zoom-enter{animation-name:Toastify__zoomIn}.Toastify__zoom-exit{animation-name:Toastify__zoomOut}@keyframes Toastify__flipIn{0%{transform:perspective(400px) rotateX(90deg);animation-timing-function:ease-in;opacity:0}40%{transform:perspective(400px) rotateX(-20deg);animation-timing-function:ease-in}60%{transform:perspective(400px) rotateX(10deg);opacity:1}80%{transform:perspective(400px) rotateX(-5deg)}to{transform:perspective(400px)}}@keyframes Toastify__flipOut{0%{transform:translate3d(0,var(--y),0) perspective(400px)}30%{transform:translate3d(0,var(--y),0) perspective(400px) rotateX(-20deg);opacity:1}to{transform:translate3d(0,var(--y),0) perspective(400px) rotateX(90deg);opacity:0}}.Toastify__flip-enter{animation-name:Toastify__flipIn}.Toastify__flip-exit{animation-name:Toastify__flipOut}@keyframes Toastify__slideInRight{0%{transform:translate3d(110%,0,0);visibility:visible}to{transform:translate3d(0,var(--y),0)}}@keyframes Toastify__slideInLeft{0%{transform:translate3d(-110%,0,0);visibility:visible}to{transform:translate3d(0,var(--y),0)}}@keyframes Toastify__slideInUp{0%{transform:translate3d(0,110%,0);visibility:visible}to{transform:translate3d(0,var(--y),0)}}@keyframes Toastify__slideInDown{0%{transform:translate3d(0,-110%,0);visibility:visible}to{transform:translate3d(0,var(--y),0)}}@keyframes Toastify__slideOutRight{0%{transform:translate3d(0,var(--y),0)}to{visibility:hidden;transform:translate3d(110%,var(--y),0)}}@keyframes Toastify__slideOutLeft{0%{transform:translate3d(0,var(--y),0)}to{visibility:hidden;transform:translate3d(-110%,var(--y),0)}}@keyframes Toastify__slideOutDown{0%{transform:translate3d(0,var(--y),0)}to{visibility:hidden;transform:translate3d(0,500px,0)}}@keyframes Toastify__slideOutUp{0%{transform:translate3d(0,var(--y),0)}to{visibility:hidden;transform:translate3d(0,-500px,0)}}.Toastify__slide-enter--top-left,.Toastify__slide-enter--bottom-left{animation-name:Toastify__slideInLeft}.Toastify__slide-enter--top-right,.Toastify__slide-enter--bottom-right{animation-name:Toastify__slideInRight}.Toastify__slide-enter--top-center{animation-name:Toastify__slideInDown}.Toastify__slide-enter--bottom-center{animation-name:Toastify__slideInUp}.Toastify__slide-exit--top-left,.Toastify__slide-exit--bottom-left{animation-name:Toastify__slideOutLeft;animation-timing-function:ease-in;animation-duration:.3s}.Toastify__slide-exit--top-right,.Toastify__slide-exit--bottom-right{animation-name:Toastify__slideOutRight;animation-timing-function:ease-in;animation-duration:.3s}.Toastify__slide-exit--top-center{animation-name:Toastify__slideOutUp;animation-timing-function:ease-in;animation-duration:.3s}.Toastify__slide-exit--bottom-center{animation-name:Toastify__slideOutDown;animation-timing-function:ease-in;animation-duration:.3s}@keyframes Toastify__spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}
`);var a=e=>"number"==typeof e&&!isNaN(e),o=e=>"string"==typeof e,l=e=>"function"==typeof e,u=e=>o(e)||a(e),c=e=>o(e)||l(e)?e:null,h=(e,t)=>!1===e||a(e)&&e>0?e:t,d=e=>(0,r.isValidElement)(e)||o(e)||l(e)||a(e);function p(e,t,n=300){let{scrollHeight:r,style:i}=e;requestAnimationFrame(()=>{i.minHeight="initial",i.height=r+"px",i.transition=`all ${n}ms`,requestAnimationFrame(()=>{i.height="0",i.padding="0",i.margin="0",setTimeout(t,n)})})}function f({enter:e,exit:t,appendPosition:n=!1,collapse:i=!0,collapseDuration:s=300}){return function({children:a,position:o,preventExitTransition:l,done:u,nodeRef:c,isIn:h,playToast:d}){let f=n?`${e}--${o}`:e,g=n?`${t}--${o}`:t,m=(0,r.useRef)(0);return(0,r.useLayoutEffect)(()=>{let e=c.current,t=f.split(" "),n=r=>{r.target===c.current&&(d(),e.removeEventListener("animationend",n),e.removeEventListener("animationcancel",n),0===m.current&&"animationcancel"!==r.type&&e.classList.remove(...t))};(()=>{e.classList.add(...t),e.addEventListener("animationend",n),e.addEventListener("animationcancel",n)})()},[]),(0,r.useEffect)(()=>{let e=c.current,t=()=>{e.removeEventListener("animationend",t),i?p(e,u,s):u()};h||(l?t():(()=>{m.current=1,e.className+=` ${g}`,e.addEventListener("animationend",t)})())},[h]),r.createElement(r.Fragment,null,a)}}function g(e,t){return{content:m(e.content,e.props),containerId:e.props.containerId,id:e.props.toastId,theme:e.props.theme,type:e.props.type,data:e.props.data||{},isLoading:e.props.isLoading,icon:e.props.icon,reason:e.removalReason,status:t}}function m(e,t,n=!1){return(0,r.isValidElement)(e)&&!o(e.type)?(0,r.cloneElement)(e,{closeToast:t.closeToast,toastProps:t,data:t.data,isPaused:n}):l(e)?e({closeToast:t.closeToast,toastProps:t,data:t.data,isPaused:n}):e}function y({closeToast:e,theme:t,ariaLabel:n="close"}){return r.createElement("button",{className:`Toastify__close-button Toastify__close-button--${t}`,type:"button",onClick:t=>{t.stopPropagation(),e(!0)},"aria-label":n},r.createElement("svg",{"aria-hidden":"true",viewBox:"0 0 14 16"},r.createElement("path",{fillRule:"evenodd",d:"M7.71 8.23l3.75 3.75-1.48 1.48-3.75-3.75-3.75 3.75L1 11.98l3.75-3.75L1 4.48 2.48 3l3.75 3.75L9.98 3l1.48 1.48-3.75 3.75z"})))}function b({delay:e,isRunning:t,closeToast:n,type:i="default",hide:a,className:o,controlledProgress:u,progress:c,rtl:h,isIn:d,theme:p}){let f=a||u&&0===c,g={animationDuration:`${e}ms`,animationPlayState:t?"running":"paused"};u&&(g.transform=`scaleX(${c})`);let m=s("Toastify__progress-bar",u?"Toastify__progress-bar--controlled":"Toastify__progress-bar--animated",`Toastify__progress-bar-theme--${p}`,`Toastify__progress-bar--${i}`,{"Toastify__progress-bar--rtl":h}),y=l(o)?o({rtl:h,type:i,defaultClassName:m}):s(m,o),b={[u&&c>=1?"onTransitionEnd":"onAnimationEnd"]:u&&c<1?null:()=>{d&&n()}};return r.createElement("div",{className:"Toastify__progress-bar--wrp","data-hidden":f},r.createElement("div",{className:`Toastify__progress-bar--bg Toastify__progress-bar-theme--${p} Toastify__progress-bar--${i}`}),r.createElement("div",{role:"progressbar","aria-hidden":f?"true":"false","aria-label":"notification timer",className:y,style:g,...b}))}var v=1,w=()=>`${v++}`;function _(e,t,n){let r=1,i=0,s=[],o=[],l=t,u=new Map,p=new Set,f=()=>{o=Array.from(u.values()),p.forEach(e=>e())},m=({containerId:t,toastId:n,updateId:r})=>{let i=t?t!==e:1!==e,s=u.has(n)&&null==r;return i||s},y=e=>{var t,n;null==(n=null==(t=e.props)?void 0:t.onClose)||n.call(t,e.removalReason),e.isActive=!1},b=e=>{if(null==e)u.forEach(y);else{let t=u.get(e);t&&y(t)}f()},v=e=>{var t,r;let{toastId:i,updateId:s}=e.props,a=null==s;e.staleId&&u.delete(e.staleId),e.isActive=!0,u.set(i,e),f(),n(g(e,a?"added":"updated")),a&&(null==(r=(t=e.props).onOpen)||r.call(t))};return{id:e,props:l,observe:e=>(p.add(e),()=>p.delete(e)),toggle:(e,t)=>{u.forEach(n=>{var r;(null==t||t===n.props.toastId)&&(null==(r=n.toggle)||r.call(n,e))})},removeToast:b,toasts:u,clearQueue:()=>{i-=s.length,s=[]},buildToast:(e,t)=>{if(m(t))return;let{toastId:o,updateId:p,data:y,staleId:w,delay:_}=t,x=null==p;x&&i++;let T={...l,style:l.toastStyle,key:r++,...Object.fromEntries(Object.entries(t).filter(([e,t])=>null!=t)),toastId:o,updateId:p,data:y,isIn:!1,className:c(t.className||l.toastClassName),progressClassName:c(t.progressClassName||l.progressClassName),autoClose:!t.isLoading&&h(t.autoClose,l.autoClose),closeToast(e){u.get(o).removalReason=e,b(o)},deleteToast(){let e=u.get(o);if(null!=e){if(n(g(e,"removed")),u.delete(o),--i<0&&(i=0),s.length>0){v(s.shift());return}f()}}};T.closeButton=l.closeButton,!1===t.closeButton||d(t.closeButton)?T.closeButton=t.closeButton:!0===t.closeButton&&(T.closeButton=!d(l.closeButton)||l.closeButton);let I={content:e,props:T,staleId:w};l.limit&&l.limit>0&&i>l.limit&&x?s.push(I):a(_)?setTimeout(()=>{v(I)},_):v(I)},setProps(e){l=e},setToggle:(e,t)=>{let n=u.get(e);n&&(n.toggle=t)},isToastActive:e=>{var t;return null==(t=u.get(e))?void 0:t.isActive},getSnapshot:()=>o}}var x=new Map,T=[],I=new Set,k=e=>I.forEach(t=>t(e)),S=()=>x.size>0;function E(){T.forEach(e=>$(e.content,e.options)),T=[]}var C=(e,{containerId:t})=>{var n;return null==(n=x.get(t||1))?void 0:n.toasts.get(e)};function A(e,t){var n;if(t)return!!(null!=(n=x.get(t))&&n.isToastActive(e));let r=!1;return x.forEach(t=>{t.isToastActive(e)&&(r=!0)}),r}function N(e){if(!S()){T=T.filter(t=>null!=e&&t.options.toastId!==e);return}if(null==e||u(e))x.forEach(t=>{t.removeToast(e)});else if(e&&("containerId"in e||"id"in e)){let t=x.get(e.containerId);t?t.removeToast(e.id):x.forEach(t=>{t.removeToast(e.id)})}}var O=(e={})=>{x.forEach(t=>{t.props.limit&&(!e.containerId||t.id===e.containerId)&&t.clearQueue()})};function $(e,t){d(e)&&(S()||T.push({content:e,options:t}),x.forEach(n=>{n.buildToast(e,t)}))}function R(e){var t;null==(t=x.get(e.containerId||1))||t.setToggle(e.id,e.fn)}function D(e,t){x.forEach(n=>{null!=t&&null!=t&&t.containerId&&(null==t?void 0:t.containerId)!==n.id||n.toggle(e,null==t?void 0:t.id)})}function F(e){let t=e.containerId||1;return{subscribe(n){let r=_(t,e,k);x.set(t,r);let i=r.observe(n);return E(),()=>{i(),x.delete(t)}},setProps(e){var n;null==(n=x.get(t))||n.setProps(e)},getSnapshot(){var e;return null==(e=x.get(t))?void 0:e.getSnapshot()}}}function P(e){return I.add(e),()=>{I.delete(e)}}function M(e){return e&&(o(e.toastId)||a(e.toastId))?e.toastId:w()}function L(e,t){return $(e,t),t.toastId}function z(e,t){return{...t,type:t&&t.type||e,toastId:M(t)}}function B(e){return(t,n)=>L(t,z(e,n))}function U(e,t){return L(e,z("default",t))}function V(e,{pending:t,error:n,success:r},i){let s;t&&(s=o(t)?U.loading(t,i):U.loading(t.render,{...i,...t}));let a={isLoading:null,autoClose:null,closeOnClick:null,closeButton:null,draggable:null},u=(e,t,n)=>{if(null==t){U.dismiss(s);return}let r={type:e,...a,...i,data:n},l=o(t)?{render:t}:t;return s?U.update(s,{...r,...l}):U(l.render,{...r,...l}),n},c=l(e)?e():e;return c.then(e=>u("success",r,e)).catch(e=>u("error",n,e)),c}function j(e){N(e)}function G(e){var t;let{subscribe:n,getSnapshot:i,setProps:s}=(0,r.useRef)(F(e)).current;s(e);let a=null==(t=(0,r.useSyncExternalStore)(n,i,i))?void 0:t.slice();return{getToastToRender:function(t){if(!a)return[];let n=new Map;return e.newestOnTop&&a.reverse(),a.forEach(e=>{let{position:t}=e.props;n.has(t)||n.set(t,[]),n.get(t).push(e)}),Array.from(n,e=>t(e[0],e[1]))},isToastActive:A,count:null==a?void 0:a.length}}function W(e){let[t,n]=(0,r.useState)(!1),[i,s]=(0,r.useState)(!1),a=(0,r.useRef)(null),o=(0,r.useRef)({start:0,delta:0,removalDistance:0,canCloseOnClick:!0,canDrag:!1,didMove:!1}).current,{autoClose:l,pauseOnHover:u,closeToast:c,onClick:h,closeOnClick:d}=e;function p(){document.hasFocus()||m(),window.addEventListener("focus",g),window.addEventListener("blur",m)}function f(){window.removeEventListener("focus",g),window.removeEventListener("blur",m)}function g(){n(!0)}function m(){n(!1)}function y(){o.didMove=!1,document.addEventListener("pointermove",v),document.addEventListener("pointerup",w)}function b(){document.removeEventListener("pointermove",v),document.removeEventListener("pointerup",w)}function v(n){let r=a.current;if(o.canDrag&&r){o.didMove=!0,t&&m(),"x"===e.draggableDirection?o.delta=n.clientX-o.start:o.delta=n.clientY-o.start,o.start!==n.clientX&&(o.canCloseOnClick=!1);let i="x"===e.draggableDirection?`${o.delta}px, var(--y)`:`0, calc(${o.delta}px + var(--y))`;r.style.transform=`translate3d(${i},0)`,r.style.opacity=`${1-Math.abs(o.delta/o.removalDistance)}`}}function w(){b();let t=a.current;if(o.canDrag&&o.didMove&&t){if(o.canDrag=!1,Math.abs(o.delta)>o.removalDistance){s(!0),e.closeToast(!0),e.collapseAll();return}t.style.transition="transform 0.2s, opacity 0.2s",t.style.removeProperty("transform"),t.style.removeProperty("opacity")}}R({id:e.toastId,containerId:e.containerId,fn:n}),(0,r.useEffect)(()=>{if(e.pauseOnFocusLoss)return p(),()=>{f()}},[e.pauseOnFocusLoss]);let _={onPointerDown:function(t){if(!0===e.draggable||e.draggable===t.pointerType){y();let n=a.current;o.canCloseOnClick=!0,o.canDrag=!0,n.style.transition="none","x"===e.draggableDirection?(o.start=t.clientX,o.removalDistance=n.offsetWidth*(e.draggablePercent/100)):(o.start=t.clientY,o.removalDistance=n.offsetHeight*(80===e.draggablePercent?1.5*e.draggablePercent:e.draggablePercent)/100)}},onPointerUp:function(t){let{top:n,bottom:r,left:i,right:s}=a.current.getBoundingClientRect();"touchend"!==t.nativeEvent.type&&e.pauseOnHover&&t.clientX>=i&&t.clientX<=s&&t.clientY>=n&&t.clientY<=r?m():g()}};return l&&u&&(_.onMouseEnter=m,e.stacked||(_.onMouseLeave=g)),d&&(_.onClick=e=>{h&&h(e),o.canCloseOnClick&&c(!0)}),{playToast:g,pauseToast:m,isRunning:t,preventExitTransition:i,toastRef:a,eventHandlers:_}}U.loading=(e,t)=>L(e,z("default",{isLoading:!0,autoClose:!1,closeOnClick:!1,closeButton:!1,draggable:!1,...t})),U.promise=V,U.success=B("success"),U.info=B("info"),U.error=B("error"),U.warning=B("warning"),U.warn=U.warning,U.dark=(e,t)=>L(e,z("default",{theme:"dark",...t})),U.dismiss=j,U.clearWaitingQueue=O,U.isActive=A,U.update=(e,t={})=>{let n=C(e,t);if(n){let{props:r,content:i}=n,s={delay:100,...r,...t,toastId:t.toastId||e,updateId:w()};s.toastId!==e&&(s.staleId=e);let a=s.render||i;delete s.render,L(a,s)}},U.done=e=>{U.update(e,{progress:1})},U.onChange=P,U.play=e=>D(!0,e),U.pause=e=>D(!1,e);var q="undefined"!=typeof window?r.useLayoutEffect:r.useEffect,H=({theme:e,type:t,isLoading:n,...i})=>r.createElement("svg",{viewBox:"0 0 24 24",width:"100%",height:"100%",fill:"colored"===e?"currentColor":`var(--toastify-icon-color-${t})`,...i}),K={info:function(e){return r.createElement(H,{...e},r.createElement("path",{d:"M12 0a12 12 0 1012 12A12.013 12.013 0 0012 0zm.25 5a1.5 1.5 0 11-1.5 1.5 1.5 1.5 0 011.5-1.5zm2.25 13.5h-4a1 1 0 010-2h.75a.25.25 0 00.25-.25v-4.5a.25.25 0 00-.25-.25h-.75a1 1 0 010-2h1a2 2 0 012 2v4.75a.25.25 0 00.25.25h.75a1 1 0 110 2z"}))},warning:function(e){return r.createElement(H,{...e},r.createElement("path",{d:"M23.32 17.191L15.438 2.184C14.728.833 13.416 0 11.996 0c-1.42 0-2.733.833-3.443 2.184L.533 17.448a4.744 4.744 0 000 4.368C1.243 23.167 2.555 24 3.975 24h16.05C22.22 24 24 22.044 24 19.632c0-.904-.251-1.746-.68-2.44zm-9.622 1.46c0 1.033-.724 1.823-1.698 1.823s-1.698-.79-1.698-1.822v-.043c0-1.028.724-1.822 1.698-1.822s1.698.79 1.698 1.822v.043zm.039-12.285l-.84 8.06c-.057.581-.408.943-.897.943-.49 0-.84-.367-.896-.942l-.84-8.065c-.057-.624.25-1.095.779-1.095h1.91c.528.005.84.476.784 1.1z"}))},success:function(e){return r.createElement(H,{...e},r.createElement("path",{d:"M12 0a12 12 0 1012 12A12.014 12.014 0 0012 0zm6.927 8.2l-6.845 9.289a1.011 1.011 0 01-1.43.188l-4.888-3.908a1 1 0 111.25-1.562l4.076 3.261 6.227-8.451a1 1 0 111.61 1.183z"}))},error:function(e){return r.createElement(H,{...e},r.createElement("path",{d:"M11.983 0a12.206 12.206 0 00-8.51 3.653A11.8 11.8 0 000 12.207 11.779 11.779 0 0011.8 24h.214A12.111 12.111 0 0024 11.791 11.766 11.766 0 0011.983 0zM10.5 16.542a1.476 1.476 0 011.449-1.53h.027a1.527 1.527 0 011.523 1.47 1.475 1.475 0 01-1.449 1.53h-.027a1.529 1.529 0 01-1.523-1.47zM11 12.5v-6a1 1 0 012 0v6a1 1 0 11-2 0z"}))},spinner:function(){return r.createElement("div",{className:"Toastify__spinner"})}},X=e=>e in K;function Y({theme:e,type:t,isLoading:n,icon:i}){let s=null,a={theme:e,type:t};return!1===i||(l(i)?s=i({...a,isLoading:n}):(0,r.isValidElement)(i)?s=(0,r.cloneElement)(i,a):n?s=K.spinner():X(t)&&(s=K[t](a))),s}var Q=e=>{let{isRunning:t,preventExitTransition:n,toastRef:i,eventHandlers:a,playToast:o}=W(e),{closeButton:u,children:c,autoClose:h,onClick:d,type:p,hideProgressBar:f,closeToast:g,transition:v,position:w,className:_,style:x,progressClassName:T,updateId:I,role:k,progress:S,rtl:E,toastId:C,deleteToast:A,isIn:N,isLoading:O,closeOnClick:$,theme:R,ariaLabel:D}=e,F=s("Toastify__toast",`Toastify__toast-theme--${R}`,`Toastify__toast--${p}`,{"Toastify__toast--rtl":E},{"Toastify__toast--close-on-click":$}),P=l(_)?_({rtl:E,position:w,type:p,defaultClassName:F}):s(F,_),M=Y(e),L=!!S||!h,z={closeToast:g,type:p,theme:R},B=null;return!1===u||(B=l(u)?u(z):(0,r.isValidElement)(u)?(0,r.cloneElement)(u,z):y(z)),r.createElement(v,{isIn:N,done:A,position:w,preventExitTransition:n,nodeRef:i,playToast:o},r.createElement("div",{id:C,tabIndex:0,onClick:d,"data-in":N,className:P,...a,style:x,ref:i,...N&&{role:k,"aria-label":D}},null!=M&&r.createElement("div",{className:s("Toastify__toast-icon",{"Toastify--animate-icon Toastify__zoom-enter":!O})},M),m(c,e,!t),B,!e.customProgressBar&&r.createElement(b,{...I&&!L?{key:`p-${I}`}:{},rtl:E,theme:R,delay:h,isRunning:t,isIn:N,closeToast:g,hide:f,type:p,className:T,controlledProgress:L,progress:S||0})))},J=(e,t=!1)=>({enter:`Toastify--animate Toastify__${e}-enter`,exit:`Toastify--animate Toastify__${e}-exit`,appendPosition:t}),Z=f(J("bounce",!0));f(J("slide",!0)),f(J("zoom")),f(J("flip"));var ee={position:"top-right",transition:Z,autoClose:5e3,closeButton:!0,pauseOnHover:!0,pauseOnFocusLoss:!0,draggable:"touch",draggablePercent:80,draggableDirection:"x",role:"alert",theme:"light","aria-label":"Notifications Alt+T",hotKeys:e=>e.altKey&&"KeyT"===e.code};function et(e){let t={...ee,...e},n=e.stacked,[i,a]=(0,r.useState)(!0),o=(0,r.useRef)(null),{getToastToRender:u,isToastActive:h,count:d}=G(t),{className:p,style:f,rtl:g,containerId:m,hotKeys:y}=t;function b(e){let t=s("Toastify__toast-container",`Toastify__toast-container--${e}`,{"Toastify__toast-container--rtl":g});return l(p)?p({position:e,rtl:g,defaultClassName:t}):s(t,c(p))}function v(){n&&(a(!0),U.play())}return q(()=>{var e;if(n){let n=o.current.querySelectorAll('[data-in="true"]'),r=12,s=null==(e=t.position)?void 0:e.includes("top"),a=0,l=0;Array.from(n).reverse().forEach((e,t)=>{let n=e;n.classList.add("Toastify__toast--stacked"),t>0&&(n.dataset.collapsed=`${i}`),n.dataset.pos||(n.dataset.pos=s?"top":"bot");let o=a*(i?.2:1)+(i?0:r*t);n.style.setProperty("--y",`${s?o:-1*o}px`),n.style.setProperty("--g",`${r}`),n.style.setProperty("--s",`${1-(i?l:0)}`),a+=n.offsetHeight,l+=.025})}},[i,d,n]),(0,r.useEffect)(()=>{function e(e){var t;let n=o.current;y(e)&&(null==(t=n.querySelector('[tabIndex="0"]'))||t.focus(),a(!1),U.pause()),"Escape"===e.key&&(document.activeElement===n||null!=n&&n.contains(document.activeElement))&&(a(!0),U.play())}return document.addEventListener("keydown",e),()=>{document.removeEventListener("keydown",e)}},[y]),r.createElement("section",{ref:o,className:"Toastify",id:m,onMouseEnter:()=>{n&&(a(!1),U.pause())},onMouseLeave:v,"aria-live":"polite","aria-atomic":"false","aria-relevant":"additions text","aria-label":t["aria-label"]},u((e,t)=>{let i=t.length?{...f}:{...f,pointerEvents:"none"};return r.createElement("div",{tabIndex:-1,className:b(e),"data-stacked":n,style:i,key:`c-${e}`},t.map(({content:e,props:t})=>r.createElement(Q,{...t,stacked:n,collapseAll:v,isIn:h(t.toastId,t.containerId),key:`t-${t.key}`},e)))}))}},8864:e=>{"use strict";e.exports=JSON.parse('{"\uD83D\uDE02":1,"":3,"":3,"\uD83D\uDE0D":3,"\uD83D\uDE2D":-1,"\uD83D\uDE18":3,"\uD83D\uDE0A":3,"\uD83D\uDC4C":2,"\uD83D\uDC95":3,"\uD83D\uDC4F":2,"\uD83D\uDE01":2,"":3,"":3,"\uD83D\uDC4D":2,"\uD83D\uDE29":-2,"\uD83D\uDE4F":2,"":2,"\uD83D\uDE0F":1,"\uD83D\uDE09":2,"\uD83D\uDE4C":2,"\uD83D\uDE48":2,"\uD83D\uDCAA":2,"\uD83D\uDE04":2,"\uD83D\uDE12":-2,"\uD83D\uDC83":3,"\uD83D\uDC96":3,"\uD83D\uDE03":2,"\uD83D\uDE14":-1,"\uD83C\uDF89":3,"\uD83D\uDE1C":2,"\uD83C\uDF38":3,"\uD83D\uDC9C":3,"\uD83D\uDC99":3,"":1,"\uD83D\uDC97":3,"":1,"":-1,"":2,"\uD83D\uDE21":-1,"\uD83D\uDE0E":2,"\uD83D\uDC8B":3,"\uD83D\uDE0B":3,"\uD83D\uDE4A":2,"\uD83D\uDE34":-1,"\uD83C\uDFB6":2,"\uD83D\uDC9E":3,"\uD83D\uDE0C":2,"\uD83D\uDD2B":-1,"\uD83D\uDC9B":3,"\uD83D\uDC81":1,"\uD83D\uDC9A":3,"":1,"\uD83D\uDE1E":-1,"\uD83D\uDE06":2,"\uD83D\uDE1D":2,"\uD83D\uDE2A":-1,"\uD83D\uDE2B":-1,"\uD83D\uDC4A":1,"\uD83D\uDC80":-2,"\uD83D\uDE00":2,"\uD83D\uDE1A":3,"\uD83D\uDE3B":3,"\uD83D\uDC98":3,"":1,"\uD83D\uDC4B":2,"\uD83C\uDF8A":3,"\uD83C\uDF55":2,"":2,"\uD83D\uDE15":-2,"\uD83D\uDC94":-1,"\uD83D\uDE24":-2,"\uD83D\uDE08":1,"":2,"\uD83D\uDD1D":2,"\uD83D\uDE30":-1,"":3,"\uD83D\uDE11":-2,"\uD83D\uDC51":3,"\uD83D\uDC49":1,"\uD83C\uDF43":1,"\uD83C\uDF81":3,"\uD83D\uDE20":-2,"\uD83D\uDC27":2,"":2,"\uD83C\uDF40":1,"\uD83C\uDF88":3,"\uD83C\uDF85":1,"\uD83D\uDE13":-1,"\uD83D\uDE23":-2,"\uD83D\uDE10":-2,"":2,"\uD83D\uDE28":-1,"\uD83D\uDE16":-1,"\uD83D\uDCA4":1,"\uD83D\uDC93":3,"\uD83D\uDC4E":-1,"\uD83D\uDCA6":2,"":1,"\uD83D\uDE37":-1,"\uD83D\uDE4B":2,"\uD83C\uDF84":2,"\uD83D\uDCA9":-1,"\uD83C\uDFB5":2,"\uD83D\uDE1B":3,"\uD83D\uDC6F":2,"\uD83D\uDC8E":2,"\uD83C\uDF3F":1,"\uD83C\uDF82":3,"\uD83C\uDF1F":1,"\uD83D\uDD2E":1,"\uD83D\uDC6B":1,"\uD83C\uDFC6":3,"":1,"":1,"\uD83D\uDE19":3,"":2,"\uD83D\uDC45":2,"":2,"\uD83C\uDF42":2,"\uD83D\uDC8F":1,"\uD83C\uDF34":2,"\uD83D\uDC48":2,"\uD83C\uDF39":3,"\uD83D\uDE46":2,"\uD83D\uDC7B":1,"\uD83D\uDCB0":1,"\uD83C\uDF7B":2,"\uD83D\uDE45":-2,"\uD83C\uDF1E":2,"\uD83C\uDF41":2,"":2,"":1,"\uD83C\uDF80":3,"\uD83D\uDC37":1,"\uD83D\uDE49":1,"\uD83C\uDF3A":2,"\uD83D\uDC85":1,"\uD83D\uDC36":2,"\uD83C\uDF1A":2,"\uD83D\uDC7D":1,"\uD83C\uDFA4":2,"\uD83D\uDC6D":2,"\uD83C\uDFA7":2,"\uD83D\uDC46":1,"\uD83C\uDF78":2,"\uD83C\uDF77":2,"\xae":1,"\uD83C\uDF49":3,"\uD83D\uDE07":3,"\uD83C\uDFC3":2,"\uD83D\uDE3F":-2,"":1,"\uD83C\uDF7A":2,"":1,"\uD83D\uDE32":-1,"\uD83C\uDFB8":2,"\uD83C\uDF79":3,"\uD83D\uDCAB":2,"\uD83D\uDCDA":1,"\uD83D\uDE36":-1,"\uD83C\uDF37":2,"\uD83D\uDC9D":3,"\uD83D\uDCA8":1,"\uD83C\uDFC8":2,"\uD83D\uDC8D":2,"":1,"\uD83D\uDC78":3,"\uD83C\uDDEA":3,"":-1,"\uD83C\uDF69":1,"\uD83D\uDC7E":1,"":1,"\uD83C\uDF3B":2,"":3,"\uD83D\uDC2F":2,"\uD83D\uDC7C":1,"\uD83C\uDF54":1,"\uD83D\uDE38":2,"\uD83D\uDC76":2,"":3,"\uD83D\uDC90":3,"\uD83C\uDF0A":2,"\uD83C\uDF66":2,"\uD83C\uDF53":3,"\uD83D\uDC47":1,"\uD83D\uDC86":1,"\uD83C\uDF74":2,"\uD83D\uDE27":-1,"\uD83C\uDDF8":2,"\uD83D\uDE2E":1,"\uD83D\uDEAB":-3,"\uD83D\uDE3D":2,"\uD83C\uDF08":2,"\uD83D\uDE40":1,"":-1,"\uD83C\uDFAE":2,"":-1,"\uD83C\uDF46":2,"\uD83C\uDF70":2,"":1,"\uD83D\uDC50":-1,"\uD83C\uDF5F":1,"\uD83C\uDF4C":2,"\uD83D\uDC91":3,"\uD83D\uDC6C":-1,"\uD83D\uDC23":2,"\uD83C\uDF83":3,"":2,"":-3,"\uD83D\uDC3E":3,"\uD83C\uDF93":2,"\uD83C\uDFCA":2,"\uD83D\uDCF7":2,"\uD83D\uDC44":2,"\uD83C\uDF3C":4,"\uD83D\uDEB6":-1,"\uD83D\uDC31":2,"\uD83D\uDC38":-1,"\uD83C\uDDFA":2,"\uD83D\uDC7F":-3,"\uD83D\uDEAC":2,"":1,"\uD83D\uDC12":2,"\uD83C\uDF0D":3,"":5,"\uD83D\uDC25":3,"\uD83D\uDC3C":1,"\uD83C\uDFA5":1,"\uD83D\uDC84":2,"":2,"\uD83C\uDFC0":1,"\uD83D\uDC89":1,"\uD83D\uDC9F":3,"\uD83D\uDE97":1,"\uD83D\uDCDD":1,"":2,"\uD83D\uDCAD":1,"\uD83C\uDF19":3,"\uD83D\uDC1F":3,"\uD83D\uDC63":1,"":-3,"\uD83D\uDDFF":2,"\uD83D\uDC6A":-1,"\uD83C\uDF6D":1,"\uD83C\uDF03":2,"":1,"\uD83D\uDC30":3,"\uD83D\uDC8A":2,"\uD83D\uDEA8":3,"\uD83D\uDE26":-2,"\uD83C\uDF6A":1,"\uD83C\uDF63":-2,"":1,"\uD83C\uDF86":3,"\uD83C\uDF8E":4,"\uD83C\uDDE9":3,"":2,"\uD83D\uDCF1":1,"\uD83D\uDE4D":-2,"\uD83C\uDF51":1,"\uD83C\uDFBC":1,"\uD83D\uDD0A":2,"\uD83C\uDF0C":2,"\uD83C\uDF4E":1,"\uD83D\uDC3B":2,"":-1,"\uD83D\uDC87":1,"":1,"\uD83D\uDD34":2,"\uD83C\uDF71":-2,"\uD83C\uDF4A":2,"\uD83C\uDF52":1,"\uD83D\uDC2D":3,"\uD83D\uDC5F":2,"\uD83C\uDF0E":1,"\uD83C\uDF4D":2,"\uD83D\uDC2E":3,"\uD83D\uDCF2":1,"":1,"\uD83C\uDF05":1,"\uD83C\uDDF7":3,"\uD83D\uDC60":1,"\uD83C\uDF3D":2,"\uD83D\uDCA7":-1,"\uD83C\uDF6C":1,"\uD83D\uDE3A":2,"\uD83D\uDE80":2,"\xa6":3,"\uD83D\uDCA2":1,"\uD83C\uDFAC":1,"\uD83C\uDF67":1,"\uD83C\uDF5C":2,"\uD83D\uDC0F":3,"\uD83C\uDFC4":2,"":1,"":1,"\uD83C\uDF4B":1,"\uD83C\uDD97":2,"":2,"\uD83D\uDCFA":2,"\uD83C\uDF45":1,"":2,"\uD83D\uDC22":1,"\uD83D\uDC59":2,"\uD83C\uDFE1":2,"\uD83C\uDF3E":2,"":1,"":1,"\uD83D\uDC2C":2,"\uD83C\uDDF9":3,"":1,"\uD83D\uDC1D":1,"\uD83C\uDF1D":1,"\uD83C\uDDEE":3,"\uD83D\uDD0B":-3,"\uD83D\uDC0D":1,"":2,"\uD83D\uDD35":1,"\uD83D\uDE3E":-2,"\uD83C\uDF15":3,"\uD83D\uDC28":2,"\uD83D\uDD10":1,"\uD83D\uDCBF":3,"\uD83C\uDF33":2,"\uD83D\uDC70":2,"":2,"":3,"\uD83D\uDEB4":3,"":-1,"\uD83D\uDC57":1,"":2,"\uD83D\uDCAC":2,"":-1,"\uD83D\uDD1C":1,"\uD83C\uDF68":1,"\uD83D\uDCB2":1,"\uD83C\uDF59":1,"\uD83C\uDF65":-4,"":1,"":1,"\uD83D\uDE3C":1,"\uD83D\uDC19":2,"\uD83D\uDC68":2,"\uD83C\uDF5A":2,"":4,"\uD83C\uDFB9":1,"":2,"":5,"\uD83C\uDDEC":1,"\uD83C\uDDE7":1,"":-1,"\uD83D\uDC20":2,"\uD83D\uDEB9":3,"\uD83D\uDCB5":2,"":4,"":1,"\uD83D\uDC5B":2,"\uD83C\uDF31":3,"\uD83D\uDCBB":1,"\uD83C\uDF0F":1,"":-1,"\uD83D\uDC53":1,"":1,"":-1,"\uD83C\uDF32":2,"\uD83D\uDC74":1,"\uD83C\uDFE0":2,"\uD83C\uDF47":1,"\uD83C\uDF58":2,"\uD83D\uDC07":1,"\uD83D\uDD1E":-1,"\uD83D\uDC75":2,"":1,"\uD83D\uDD19":1,"\uD83C\uDF35":1,"\uD83C\uDF6E":-1,"\uD83C\uDF87":3,"\uD83D\uDC0E":2,"":-1,"\uD83D\uDC24":2,"":1,"\uD83C\uDF11":2,"\uD83D\uDEB2":2,"\uD83D\uDC11":-1,"\uD83C\uDFC1":2,"\uD83C\uDFBE":3,"":1,"\uD83C\uDE39":1,"\uD83D\uDC6E":-2,"":-3,"\uD83D\uDC35":2,"":1,"":2,"\uD83D\uDDFC":3,"":-1,"":1,"":-2,"\uD83D\uDC7A":-2,"\uD83D\uDC1A":1,"\uD83D\uDC42":-1,"\uD83D\uDDFD":1,"\uD83C\uDF75":2,"\uD83C\uDD92":2,"\uD83D\uDC3A":1,"":2,"\uD83C\uDF13":3,"\uD83D\uDD12":1,"":-1,"\uD83D\uDC73":3,"\uD83C\uDF02":1,"\uD83D\uDE8C":1,"":3,"\uD83C\uDF61":-1,"":1,"\uD83C\uDFA1":1,"\uD83D\uDC8C":2,"\uD83D\uDC29":2,"\uD83C\uDF1C":2,"":1,"\uD83D\uDEBF":3,"\uD83D\uDD06":3,"\uD83C\uDF1B":3,"\uD83D\uDC82":-1,"\uD83D\uDC14":1,"\uD83D\uDE4E":-1,"\uD83C\uDFE9":2,"\uD83C\uDDEB":2,"\uD83D\uDD28":-1,"\uD83D\uDCE2":2,"\uD83D\uDC26":2,"\uD83D\uDC32":-1,"":2,"\uD83C\uDF18":3,"\uD83C\uDF14":3,"\uD83D\uDC56":2,"\uD83D\uDE17":3,"\uD83D\uDC04":1,"":-1,"\uD83C\uDF62":-1,"\uD83C\uDFA8":1,"":2,"\uD83D\uDEBC":3,"\uD83C\uDDF4":2,"\uD83C\uDF17":3,"\uD83C\uDF16":3,"\uD83D\uDD05":5,"\uD83D\uDC5C":1,"\uD83D\uDC0C":3,"\uD83D\uDCBC":3,"\uD83D\uDC39":1,"\uD83C\uDF20":3,"\uD83D\uDC08":1,"\uD83C\uDF01":1,"":1,"":2,"\uD83C\uDFF0":1,"\uD83D\uDEB5":2,"\uD83C\uDFA2":2,"\uD83C\uDFB7":3,"\uD83C\uDF90":1,"":-4,"":2,"\uD83C\uDF07":3,"":2,"\uD83D\uDE82":1,"":2,"\uD83C\uDFBF":2,"\uD83C\uDD94":4,"\uD83C\uDF12":3,"\uD83D\uDC2A":3,"":1,"":2,"\uD83D\uDC54":2,"\uD83C\uDD93":1,"\uD83D\uDC0B":1,"":2,"\uD83D\uDC1B":1,"\uD83D\uDC55":2,"\uD83D\uDCB3":2,"\uD83C\uDFE7":5,"\uD83D\uDCA1":3,"":2,"\uD83D\uDC2B":2,"\uD83C\uDDF1":2,"\uD83D\uDCF9":2,"\uD83D\uDC5E":2,"\uD83D\uDC5A":3,"":-2,"\uD83D\uDEA3":3,"\uD83C\uDFC9":3,"\uD83D\uDDFB":3,"":2,"":3,"\uD83D\uDC15":1,"\uD83C\uDFC2":2,"\uD83D\uDC61":2,"\uD83D\uDCFB":2,"":1,"\uD83C\uDF30":3,"\uD83C\uDFE2":1,"\uD83C\uDF92":3,"":3,"\uD83C\uDFEB":-2,"\uD83D\uDCF4":4,"\uD83D\uDEA2":1,"\uD83D\uDE9A":-1,"\uD83D\uDC09":1,"":1,"\uD83D\uDD14":5,"":4,"\uD83C\uDFE5":1,"\uD83D\uDE96":-1,"":-2,"":2,"\uD83D\uDC92":3,"\uD83D\uDEA4":2,"\uD83D\uDC10":2,"":-2,"\uD83D\uDD1A":2,"\uD83C\uDFBB":2,"\uD83D\uDD37":1,"\uD83C\uDFBD":2,"\uD83D\uDCC5":1,"\uD83C\uDFBA":3,"\uD83C\uDF48":-3,"":1,"":5,"":3,"\uD83C\uDF7C":3,"\uD83D\uDE9B":-2,"\uD83D\uDCD3":1,"":1,"\uD83D\uDCB4":-2,"":-1,"\uD83D\uDD0C":-1,"\uD83D\uDCD5":1,"\uD83D\uDCE3":2,"\uD83D\uDE93":1,"\uD83D\uDC17":3,"":4,"":-3,"":3,"":2,"\uD83D\uDCBA":1,"\uD83C\uDFC7":-1,"":1,"\uD83D\uDCDE":2,"":-1,"\uD83C\uDF09":3,"\uD83D\uDEA9":-2,"":3,"\uD83D\uDCC3":2,"\uD83C\uDFE8":1,"\uD83D\uDCCC":-3,"":-1,"\uD83D\uDCB7":2,"\uD83D\uDE84":3,"":3,"":3,"\uD83D\uDD38":1,"\uD83D\uDE9C":5,"\uD83D\uDC06":2,"\uD83D\uDC52":1,"":1,"\uD83D\uDD1B":2,"":2,"\uD83C\uDDF2":2,"":4,"\uD83D\uDC5D":2,"":2,"":1,"\uD83C\uDF8B":3,"\uD83D\uDC65":1,"\uD83D\uDC21":1,"":4,"\uD83D\uDD2D":2,"\uD83C\uDFAA":1,"\uD83D\uDC1C":3,"":4,"":-5,"\uD83D\uDC77":1,"\uD83D\uDD08":1,"\uD83D\uDCC4":5,"\uD83D\uDE90":4,"\uD83C\uDF0B":3,"\uD83D\uDCE1":1,"\uD83D\uDEB3":5,"":4,"\uD83C\uDD70":1,"\uD83C\uDDFC":2,"":3,"":3,"":2,"":2,"\uD83D\uDC64":4,"\uD83D\uDE81":1,"\uD83C\uDFA0":3,"\uD83D\uDC01":-2,"\uD83D\uDCD7":1,"":-1,"":1,"\uD83D\uDCEF":-1,"\uD83D\uDD29":1,"\uD83D\uDC62":4,"":2,"\uD83D\uDCF0":1,"\uD83D\uDCF6":2,"\uD83C\uDF04":1,"\uD83D\uDDFE":2,"\uD83D\uDD36":2,"\uD83C\uDFE4":2,"\uD83C\uDFA9":2,"":1,"\uD83D\uDD27":-4,"\uD83D\uDC05":1,"":1,"\uD83C\uDD7E":-1,"\uD83D\uDCE6":1,"\uD83D\uDE8A":1,"\uD83D\uDD32":3,"":1,"\uD83D\uDCC6":5,"":2,"\uD83D\uDCC9":2,"":2,"\uD83D\uDD0E":3,"":1,"\uD83C\uDDEF":2,"\uD83C\uDDF5":2,"\uD83D\uDCD8":1,"":3,"\uD83D\uDD11":1,"":2,"\uD83D\uDD18":1,"\uD83D\uDEAD":5,"\uD83D\uDE89":3,"\uD83D\uDEAA":3,"":2,"\uD83D\uDE83":3,"":-3,"\uD83C\uDD99":2,"\uD83C\uDD96":1,"":5,"":2,"":3,"":3,"":5,"\uD83D\uDD15":-2,"":-2,"\uD83D\uDE9E":3,"\uD83C\uDF76":3,"\uD83C\uDF10":3,"":1,"\uD83D\uDE85":3,"\uD83D\uDE92":-2,"":1,"":3,"\uD83D\uDD5D":-2,"":5,"\uD83D\uDCD9":1,"":1,"\uD83D\uDCCB":3,"\uD83C\uDFB1":1,"\uD83D\uDC1E":1,"\uD83D\uDD3A":1,"":5,"":3,"\uD83C\uDFAF":3,"\uD83D\uDD09":3,"":5,"\uD83D\uDEBE":1,"\uD83C\uDFA3":-4,"\uD83D\uDD23":1,"":-5,"":1,"\uD83C\uDF8C":5,"":1,"":5,"":1,"":5,"\uD83D\uDD33":2,"\uD83C\uDFED":2,"\uD83C\uDFB3":-3,"":5,"":2,"":2,"":-5,"":2,"":2,"":-3,"\uD83D\uDCD1":5,"":5,"\uD83D\uDD1F":5,"":5,"":2,"":5,"\uD83D\uDE86":2,"":-5,"":2,"\uD83D\uDEBD":5,"":5,"":5,"\uD83D\uDC72":2,"\uD83D\uDEA1":-3,"\uD83D\uDD2C":5,"":-3,"\uD83D\uDCC8":2,"":2,"":5,"":-5,"\uD83D\uDCCE":5,"":5,"":5,"":2,"":5,"":5,"":-5,"\uD83D\uDC58":5,"":5,"":2,"":2,"":2,"\uD83D\uDD51":2,"\uD83D\uDD5B":5,"":-5,"":5,"":5,"\uD83C\uDFE6":5,"\uD83D\uDD3B":5,"":5,"":5,"":5,"":5,"":5,"":5,"":5,"":5,"":5,"\uD83D\uDD07":5,"":-5,"\uD83D\uDD16":5,"\uD83D\uDCDC":5,"\uD83D\uDE9D":5,"":-5,"":-5,"":-5,"\uD83D\uDCEE":-5,"\uD83D\uDD55":-5,"\uD83D\uDD2F":5,"":5,"":5,"\uD83D\uDD65":-5,"":5,"\uD83D\uDCFC":5,"\uD83D\uDD50":-5,"\uD83C\uDC04":5,"":5,"":5,"\uD83D\uDD54":-5,"":5,"\uD83D\uDCEB":5,"\uD83C\uDE50":5,"\uD83C\uDE02":-5,"\uD83C\uDFB0":-5,"":-5,"":-5,"\uD83D\uDCD4":5}')},7674:e=>{"use strict";e.exports=JSON.parse('{"abandon":-2,"abandoned":-2,"abandons":-2,"abducted":-2,"abduction":-2,"abductions":-2,"abhor":-3,"abhorred":-3,"abhorrent":-3,"abhors":-3,"abilities":2,"ability":2,"aboard":1,"aborted":-1,"aborts":-1,"absentee":-1,"absentees":-1,"absolve":2,"absolved":2,"absolves":2,"absolving":2,"absorbed":1,"abuse":-3,"abused":-3,"abuses":-3,"abusing":-3,"abusive":-3,"accept":1,"acceptable":1,"acceptance":1,"accepted":1,"accepting":1,"accepts":1,"accessible":1,"accident":-2,"accidental":-2,"accidentally":-2,"accidents":-2,"acclaim":2,"acclaimed":2,"accolade":2,"accomplish":2,"accomplished":2,"accomplishes":2,"accomplishment":2,"accomplishments":2,"accusation":-2,"accusations":-2,"accuse":-2,"accused":-2,"accuses":-2,"accusing":-2,"ache":-2,"achievable":1,"aching":-2,"acquit":2,"acquits":2,"acquitted":2,"acquitting":2,"acrimonious":-3,"active":1,"adequate":1,"admire":3,"admired":3,"admires":3,"admiring":3,"admit":-1,"admits":-1,"admitted":-1,"admonish":-2,"admonished":-2,"adopt":1,"adopts":1,"adorable":3,"adoration":3,"adore":3,"adored":3,"adores":3,"adoring":3,"adoringly":3,"advanced":1,"advantage":2,"advantageous":2,"advantageously":2,"advantages":2,"adventure":2,"adventures":2,"adventurous":2,"adversary":-1,"advisable":1,"affected":-1,"affection":3,"affectionate":3,"affectionateness":3,"afflicted":-1,"affordable":2,"affronted":-1,"aficionados":2,"afraid":-2,"aggravate":-2,"aggravated":-2,"aggravates":-2,"aggravating":-2,"aggression":-2,"aggressions":-2,"aggressive":-2,"aggressiveness":-2,"aghast":-2,"agog":2,"agonise":-3,"agonised":-3,"agonises":-3,"agonising":-3,"agonize":-3,"agonized":-3,"agonizes":-3,"agonizing":-3,"agree":1,"agreeable":2,"agreed":1,"agreement":1,"agrees":1,"alarm":-2,"alarmed":-2,"alarmist":-2,"alarmists":-2,"alas":-1,"alert":-1,"alienation":-2,"alive":1,"allegation":-2,"allegations":-2,"allergic":-2,"allow":1,"ally":2,"alone":-2,"altruistic":2,"amaze":2,"amazed":2,"amazes":2,"amazing":4,"ambitious":2,"ambivalent":-1,"amicable":2,"amuse":3,"amused":3,"amusement":3,"amusements":3,"anger":-3,"angered":-3,"angers":-3,"angry":-3,"anguish":-3,"anguished":-3,"animosity":-2,"annoy":-2,"annoyance":-2,"annoyed":-2,"annoying":-2,"annoys":-2,"antagonistic":-2,"anti":-1,"anticipation":1,"anxiety":-2,"anxious":-2,"apathetic":-3,"apathy":-3,"apeshit":-3,"apocalyptic":-2,"apologise":-1,"apologised":-1,"apologises":-1,"apologising":-1,"apologize":-1,"apologized":-1,"apologizes":-1,"apologizing":-1,"apology":-1,"appalled":-2,"appalling":-2,"appealing":2,"appease":2,"appeased":2,"appeases":2,"appeasing":2,"applaud":2,"applauded":2,"applauding":2,"applauds":2,"applause":2,"appreciate":2,"appreciated":2,"appreciates":2,"appreciating":2,"appreciation":2,"apprehensive":-2,"appropriate":2,"appropriately":2,"approval":2,"approved":2,"approves":2,"ardent":1,"arrest":-2,"arrested":-3,"arrests":-2,"arrogant":-2,"arsehole":-4,"ashame":-2,"ashamed":-2,"ass":-4,"assassination":-3,"assassinations":-3,"assault":-2,"assaults":-2,"asset":2,"assets":2,"assfucking":-4,"asshole":-4,"astonished":2,"astound":3,"astounded":3,"astounding":3,"astoundingly":3,"astounds":3,"atrocious":-3,"atrocity":-3,"attack":-1,"attacked":-1,"attacking":-1,"attacks":-1,"attract":1,"attracted":1,"attracting":2,"attraction":2,"attractions":2,"attractive":2,"attractively":2,"attractiveness":2,"attracts":1,"audacious":3,"aura":1,"authority":1,"avenge":-2,"avenged":-2,"avenger":-2,"avengers":-2,"avenges":-2,"avenging":-2,"avert":-1,"averted":-1,"averts":-1,"avid":2,"avoid":-1,"avoided":-1,"avoids":-1,"await":-1,"awaited":-1,"awaits":-1,"award":3,"awarded":3,"awards":3,"awesome":4,"awful":-3,"awkward":-2,"axe":-1,"axed":-1,"backed":1,"backing":2,"backs":1,"bad":-3,"bad luck":-2,"badass":-3,"badly":-3,"badness":-3,"bailout":-2,"balanced":1,"bamboozle":-2,"bamboozled":-2,"bamboozles":-2,"ban":-2,"banish":-1,"bankrupt":-3,"bankruptcy":-3,"bankster":-3,"banned":-2,"barbarian":-2,"barbaric":-2,"barbarous":-2,"bargain":2,"barrier":-2,"bastard":-5,"bastards":-5,"battle":-1,"battled":-1,"battles":-1,"battling":-2,"beaten":-2,"beatific":3,"beating":-1,"beauties":3,"beautiful":3,"beautifully":3,"beautify":3,"beauty":3,"befit":2,"befitting":2,"belittle":-2,"belittled":-2,"beloved":3,"benefactor":2,"benefactors":2,"benefit":2,"benefits":2,"benefitted":2,"benefitting":2,"benevolent":3,"bereave":-2,"bereaved":-2,"bereaves":-2,"bereaving":-2,"best":3,"best damn":4,"betray":-3,"betrayal":-3,"betrayed":-3,"betraying":-3,"betrays":-3,"better":2,"bias":-1,"biased":-2,"big":1,"bitch":-5,"bitches":-5,"bitter":-2,"bitterest":-2,"bitterly":-2,"bizarre":-2,"blackmail":-3,"blackmailed":-3,"blackmailing":-3,"blackmails":-3,"blah":-2,"blame":-2,"blamed":-2,"blames":-2,"blaming":-2,"bless":2,"blesses":2,"blessing":3,"blessings":3,"blind":-1,"bliss":3,"blissful":3,"blithe":2,"bloated":-1,"block":-1,"blockade":-2,"blockbuster":3,"blocked":-1,"blocking":-1,"blocks":-1,"bloody":-3,"blurry":-2,"boastful":-2,"bold":2,"boldly":2,"bomb":-1,"boost":1,"boosted":1,"boosting":1,"boosts":1,"bore":-2,"bored":-2,"boring":-3,"bother":-2,"bothered":-2,"bothers":-2,"bothersome":-2,"boycott":-2,"boycotted":-2,"boycotting":-2,"boycotts":-2,"brainwashing":-3,"brave":2,"braveness":2,"bravery":2,"bravura":3,"breach":-2,"breached":-2,"breaches":-2,"breaching":-2,"breakthrough":3,"breathtaking":5,"bribe":-3,"bribed":-3,"bribes":-3,"bribing":-3,"bright":1,"brightest":2,"brightness":1,"brilliant":4,"brilliance":3,"brilliances":3,"brisk":2,"broke":-1,"broken":-1,"brooding":-2,"brutal":-3,"brutally":-3,"bullied":-2,"bullshit":-4,"bully":-2,"bullying":-2,"bummer":-2,"buoyant":2,"burden":-2,"burdened":-2,"burdening":-2,"burdens":-2,"burglar":-2,"burglary":-2,"calm":2,"calmed":2,"calming":2,"calms":2,"can\'t stand":-3,"cancel":-1,"cancelled":-1,"cancelling":-1,"cancels":-1,"cancer":-1,"capabilities":1,"capability":1,"capable":1,"captivated":3,"care":2,"carefree":1,"careful":2,"carefully":2,"carefulness":2,"careless":-2,"cares":2,"caring":2,"cashing in":-2,"casualty":-2,"catastrophe":-3,"catastrophic":-4,"cautious":-1,"celebrate":3,"celebrated":3,"celebrates":3,"celebrating":3,"celebration":3,"celebrations":3,"censor":-2,"censored":-2,"censors":-2,"certain":1,"chagrin":-2,"chagrined":-2,"challenge":-1,"champion":2,"championed":2,"champions":2,"chance":2,"chances":2,"chaos":-2,"chaotic":-2,"charged":-3,"charges":-2,"charisma":2,"charitable":2,"charm":3,"charming":3,"charmingly":3,"charmless":-3,"chastise":-3,"chastised":-3,"chastises":-3,"chastising":-3,"cheat":-3,"cheated":-3,"cheater":-3,"cheaters":-3,"cheating":-3,"cheats":-3,"cheer":2,"cheered":2,"cheerful":2,"cheerfully":2,"cheering":2,"cheerless":-2,"cheers":2,"cheery":3,"cherish":2,"cherished":2,"cherishes":2,"cherishing":2,"chic":2,"chide":-3,"chided":-3,"chides":-3,"chiding":-3,"childish":-2,"chilling":-1,"choke":-2,"choked":-2,"chokes":-2,"choking":-2,"clarifies":2,"clarity":2,"clash":-2,"classy":3,"clean":2,"cleaner":2,"clear":1,"cleared":1,"clearly":1,"clears":1,"clever":2,"clouded":-1,"clueless":-2,"cock":-5,"cocksucker":-5,"cocksuckers":-5,"cocky":-2,"coerced":-2,"coercion":-2,"collapse":-2,"collapsed":-2,"collapses":-2,"collapsing":-2,"collide":-1,"collides":-1,"colliding":-1,"collision":-2,"collisions":-2,"colluding":-3,"combat":-1,"combats":-1,"comedy":1,"comfort":2,"comfortable":2,"comfortably":2,"comforting":2,"comforts":2,"comic":1,"commend":2,"commended":2,"commit":1,"commitment":2,"commits":1,"committed":1,"committing":1,"compassion":2,"compassionate":2,"compelled":1,"competencies":1,"competent":2,"competitive":2,"complacent":-2,"complain":-2,"complained":-2,"complaining":-2,"complains":-2,"complaint":-2,"complaints":-2,"complicating":-2,"compliment":2,"complimented":2,"compliments":2,"comprehensive":2,"concerned":-2,"conciliate":2,"conciliated":2,"conciliates":2,"conciliating":2,"condemn":-2,"condemnation":-2,"condemned":-2,"condemns":-2,"confidence":2,"confident":2,"confidently":2,"conflict":-2,"conflicting":-2,"conflictive":-2,"conflicts":-2,"confuse":-2,"confused":-2,"confusing":-2,"congrats":2,"congratulate":2,"congratulation":2,"congratulations":2,"consent":2,"consents":2,"consolable":2,"conspiracy":-3,"constipation":-2,"constrained":-2,"contagion":-2,"contagions":-2,"contagious":-1,"contaminant":-2,"contaminants":-2,"contaminate":-2,"contaminated":-2,"contaminates":-2,"contaminating":-2,"contamination":-2,"contaminations":-2,"contempt":-2,"contemptible":-2,"contemptuous":-2,"contemptuously":-2,"contend":-1,"contender":-1,"contending":-1,"contentious":-2,"contestable":-2,"controversial":-2,"controversially":-2,"controversies":-2,"controversy":-2,"convicted":-2,"convince":1,"convinced":1,"convinces":1,"convivial":2,"cool":1,"cool stuff":3,"cornered":-2,"corpse":-1,"corrupt":-3,"corrupted":-3,"corrupting":-3,"corruption":-3,"corrupts":-3,"costly":-2,"courage":2,"courageous":2,"courageously":2,"courageousness":2,"courteous":2,"courtesy":2,"cover-up":-3,"coward":-2,"cowardly":-2,"coziness":2,"cramp":-1,"crap":-3,"crappy":-3,"crash":-2,"crazier":-2,"craziest":-2,"crazy":-2,"creative":2,"crestfallen":-2,"cried":-2,"cries":-2,"crime":-3,"crimes":-3,"criminal":-3,"criminals":-3,"criminate":-3,"criminated":-3,"criminates":-3,"crisis":-3,"critic":-2,"criticise":-2,"criticised":-2,"criticises":-2,"criticising":-2,"criticism":-2,"criticize":-2,"criticized":-2,"criticizes":-2,"criticizing":-2,"critics":-2,"critique":-2,"crowding":-1,"crude":-1,"cruel":-3,"cruelty":-3,"crush":-1,"crushed":-2,"crushes":-1,"crushing":-1,"cry":-1,"crying":-2,"cunning":2,"cunt":-5,"curious":1,"curse":-1,"cut":-1,"cutback":-2,"cutbacks":-2,"cute":2,"cuts":-1,"cutting":-1,"cynic":-2,"cynical":-2,"cynicism":-2,"damage":-3,"damaged":-3,"damages":-3,"damaging":-3,"damn":-2,"damn cute":3,"damn good":4,"damned":-4,"damnit":-4,"danger":-2,"dangerous":-2,"dangerously":-2,"daredevil":2,"daring":2,"darkest":-2,"darkness":-1,"dauntless":2,"dazzling":3,"dead":-3,"deadening":-2,"deadlock":-2,"deadly":-3,"deafening":-1,"dear":2,"dearly":3,"death":-2,"deaths":-2,"debonair":2,"debt":-2,"deceit":-3,"deceitful":-3,"deceive":-3,"deceived":-3,"deceives":-3,"deceiving":-3,"deception":-3,"deceptive":-3,"decisive":1,"dedicated":2,"dedication":2,"defeat":-2,"defeated":-2,"defect":-3,"defective":-3,"defects":-3,"defender":2,"defenders":2,"defenseless":-2,"defer":-1,"deferring":-1,"defiant":-1,"deficient":-2,"deficiency":-2,"deficiencies":-2,"deficit":-2,"deformed":-2,"deformities":-2,"deformity":-2,"defraud":-3,"defrauds":-3,"deft":2,"defunct":-2,"degrade":-2,"degraded":-2,"degrades":-2,"dehumanize":-2,"dehumanized":-2,"dehumanizes":-2,"dehumanizing":-2,"deject":-2,"dejected":-2,"dejecting":-2,"dejects":-2,"delay":-1,"delayed":-1,"delectable":3,"delicious":3,"delight":3,"delighted":3,"delightful":3,"delightfully":3,"delighting":3,"delights":3,"demand":-1,"demanded":-1,"demanding":-1,"demands":-1,"demonstration":-1,"demoralize":-2,"demoralized":-2,"demoralizes":-2,"demoralizing":-2,"denial":-2,"denials":-2,"denied":-2,"denier":-2,"deniers":-2,"denies":-2,"denounce":-2,"denounces":-2,"dent":-2,"deny":-2,"denying":-2,"deplore":-3,"deplored":-3,"deplores":-3,"deploring":-3,"deport":-2,"deported":-2,"deporting":-2,"deports":-2,"deportation":-2,"deportations":-2,"depressed":-2,"depressing":-2,"deprivation":-3,"derail":-2,"derailed":-2,"derails":-2,"derelict":-2,"deride":-2,"derided":-2,"derides":-2,"deriding":-2,"derision":-2,"desirable":2,"desire":1,"desired":2,"desirous":2,"despair":-3,"despairing":-3,"despairs":-3,"desperate":-3,"desperately":-3,"despondent":-3,"destroy":-3,"destroyed":-3,"destroying":-3,"destroys":-3,"destruction":-3,"destructive":-3,"detached":-1,"detain":-2,"detained":-2,"detention":-2,"deteriorate":-2,"deteriorated":-2,"deteriorates":-2,"deteriorating":-2,"determined":2,"deterrent":-2,"detract":-1,"detracted":-1,"detracts":-1,"devastate":-2,"devastated":-2,"devastating":-2,"devastation":-2,"devastations":-2,"devoted":3,"devotion":2,"devotional":2,"diamond":1,"dick":-4,"dickhead":-4,"die":-3,"died":-3,"difficult":-1,"diffident":-2,"dignity":2,"dilemma":-1,"dilligence":2,"dipshit":-3,"dire":-3,"direful":-3,"dirt":-2,"dirtier":-2,"dirtiest":-2,"dirty":-2,"disabilities":-2,"disability":-2,"disabling":-1,"disadvantage":-2,"disadvantaged":-2,"disagree":-2,"disagreeable":-2,"disagreement":-2,"disappear":-1,"disappeared":-1,"disappears":-1,"disappoint":-2,"disappointed":-2,"disappointing":-2,"disappointment":-2,"disappointments":-2,"disappoints":-2,"disapproval":-2,"disapprovals":-2,"disapprove":-2,"disapproved":-2,"disapproves":-2,"disapproving":-2,"disaster":-2,"disasters":-2,"disastrous":-3,"disbelieve":-2,"discard":-1,"discarded":-1,"discarding":-1,"discards":-1,"discernment":2,"discomfort":-2,"disconsolate":-2,"disconsolation":-2,"discontented":-2,"discord":-2,"discounted":-1,"discouraged":-2,"discredited":-2,"discriminate":-2,"discriminated":-2,"discriminates":-2,"discriminating":-2,"discriminatory":-2,"disdain":-2,"disease":-1,"diseases":-1,"disgrace":-2,"disgraced":-2,"disguise":-1,"disguised":-1,"disguises":-1,"disguising":-1,"disgust":-3,"disgusted":-3,"disgustful":-3,"disgusting":-3,"disheartened":-2,"dishonest":-2,"disillusioned":-2,"disinclined":-2,"disjointed":-2,"dislike":-2,"disliked":-2,"dislikes":-2,"dismal":-2,"dismayed":-2,"dismissed":-2,"disorder":-2,"disorders":-2,"disorganized":-2,"disoriented":-2,"disparage":-2,"disparaged":-2,"disparages":-2,"disparaging":-2,"displeased":-2,"displeasure":-2,"disproportionate":-2,"dispute":-2,"disputed":-2,"disputes":-2,"disputing":-2,"disqualified":-2,"disquiet":-2,"disregard":-2,"disregarded":-2,"disregarding":-2,"disregards":-2,"disrespect":-2,"disrespected":-2,"disrupt":-2,"disrupted":-2,"disrupting":-2,"disruption":-2,"disruptions":-2,"disruptive":-2,"disrupts":-2,"dissatisfied":-2,"distasteful":-2,"distinguished":2,"distort":-2,"distorted":-2,"distorting":-2,"distorts":-2,"distract":-2,"distracted":-2,"distraction":-2,"distracts":-2,"distress":-2,"distressed":-2,"distresses":-2,"distressing":-2,"distrust":-3,"distrustful":-3,"disturb":-2,"disturbed":-2,"disturbing":-2,"disturbs":-2,"dithering":-2,"diverting":-1,"dizzy":-1,"dodging":-2,"dodgy":-2,"does not work":-3,"dolorous":-2,"donate":2,"donated":2,"donates":2,"donating":2,"donation":2,"dont like":-2,"doom":-2,"doomed":-2,"doubt":-1,"doubted":-1,"doubtful":-1,"doubting":-1,"doubts":-1,"douche":-3,"douchebag":-3,"dour":-2,"downcast":-2,"downer":-2,"downhearted":-2,"downside":-2,"drag":-1,"dragged":-1,"drags":-1,"drained":-2,"dread":-2,"dreaded":-2,"dreadful":-3,"dreading":-2,"dream":1,"dreams":1,"dreary":-2,"droopy":-2,"drop":-1,"dropped":-1,"drown":-2,"drowned":-2,"drowns":-2,"drudgery":-2,"drunk":-2,"dubious":-2,"dud":-2,"dull":-2,"dumb":-3,"dumbass":-3,"dump":-1,"dumped":-2,"dumps":-1,"dupe":-2,"duped":-2,"dupery":-2,"durable":2,"dying":-3,"dysfunction":-2,"eager":2,"earnest":2,"ease":2,"easy":1,"ecstatic":4,"eerie":-2,"eery":-2,"effective":2,"effectively":2,"effectiveness":2,"effortlessly":2,"elated":3,"elation":3,"elegant":2,"elegantly":2,"embarrass":-2,"embarrassed":-2,"embarrasses":-2,"embarrassing":-2,"embarrassment":-2,"embezzlement":-3,"embittered":-2,"embrace":1,"emergency":-2,"empathetic":2,"empower":2,"empowerment":2,"emptiness":-1,"empty":-1,"enchanted":2,"encourage":2,"encouraged":2,"encouragement":2,"encourages":2,"encouraging":2,"endorse":2,"endorsed":2,"endorsement":2,"endorses":2,"enemies":-2,"enemy":-2,"energetic":2,"engage":1,"engages":1,"engrossed":1,"engrossing":3,"enjoy":2,"enjoyable":2,"enjoyed":2,"enjoying":2,"enjoys":2,"enlighten":2,"enlightened":2,"enlightening":2,"enlightens":2,"ennui":-2,"enrage":-2,"enraged":-2,"enrages":-2,"enraging":-2,"enrapture":3,"enslave":-2,"enslaved":-2,"enslaves":-2,"ensure":1,"ensuring":1,"enterprising":1,"entertaining":2,"enthral":3,"enthusiastic":3,"entitled":1,"entrusted":2,"envies":-1,"envious":-2,"environment-friendly":2,"envy":-1,"envying":-1,"erroneous":-2,"error":-2,"errors":-2,"escape":-1,"escapes":-1,"escaping":-1,"esteem":2,"esteemed":2,"ethical":2,"euphoria":3,"euphoric":4,"evacuate":-1,"evacuated":-1,"evacuates":-1,"evacuating":-1,"evacuation":-1,"evergreen":2,"evergreens":2,"evergreening":-3,"eviction":-1,"evil":-3,"exacerbate":-2,"exacerbated":-2,"exacerbates":-2,"exacerbating":-2,"exaggerate":-2,"exaggerated":-2,"exaggerates":-2,"exaggerating":-2,"exasparate":-2,"exasperated":-2,"exasperates":-2,"exasperating":-2,"excellence":3,"excellent":3,"excite":3,"excited":3,"excitement":3,"exciting":3,"exclude":-1,"excluded":-2,"exclusion":-1,"exclusive":2,"excruciatingly":-1,"excuse":-1,"exempt":-1,"exhausted":-2,"exhilarated":3,"exhilarates":3,"exhilarating":3,"exonerate":2,"exonerated":2,"exonerates":2,"exonerating":2,"expand":1,"expands":1,"expel":-2,"expelled":-2,"expelling":-2,"expels":-2,"expertly":2,"exploit":-2,"exploited":-2,"exploiting":-2,"exploits":-2,"exploration":1,"explorations":1,"expose":-1,"exposed":-1,"exposes":-1,"exposing":-1,"exquisite":3,"extend":1,"extends":1,"extremist":-2,"extremists":-2,"exuberant":4,"exultant":3,"exultantly":3,"fabulous":4,"fabulously":4,"fad":-2,"fag":-3,"faggot":-3,"faggots":-3,"fail":-2,"failed":-2,"failing":-2,"fails":-2,"failure":-2,"failures":-2,"fainthearted":-2,"fair":2,"fairness":2,"faith":1,"faithful":3,"fake":-3,"faker":-3,"fakes":-3,"faking":-3,"fallen":-2,"falling":-1,"false":-1,"falsely":-2,"falsified":-3,"falsify":-3,"fame":1,"famine":-2,"famous":2,"fan":3,"fantastic":4,"farce":-1,"fascinate":3,"fascinated":3,"fascinates":3,"fascinating":3,"fascination":3,"fascist":-2,"fascists":-2,"fatal":-3,"fatalities":-3,"fatality":-3,"fatigue":-2,"fatigued":-2,"fatigues":-2,"fatiguing":-2,"favor":2,"favorable":2,"favorably":2,"favored":2,"favorite":2,"favorited":2,"favorites":2,"favors":2,"favour":2,"favourable":2,"favourably":2,"favoured":2,"favourite":2,"favourited":2,"favourites":2,"favours":2,"fear":-2,"fearful":-2,"fearfully":-2,"fearing":-2,"fearless":2,"fearlessness":2,"fearsome":-2,"fed up":-3,"feeble":-2,"feeling":1,"felonies":-3,"felony":-3,"fertile":2,"fervent":2,"fervid":2,"festive":2,"fever":-2,"fiasco":-3,"fidgety":-2,"fight":-1,"fighting":-2,"fine":2,"fines":-2,"finest":3,"fire":-2,"fired":-2,"firing":-2,"fit":1,"fitness":1,"filth":-2,"filthy":-2,"flagship":2,"flaw":-2,"flawed":-3,"flawless":2,"flawlessly":2,"flaws":-2,"flees":-1,"flop":-2,"flops":-2,"flu":-2,"flustered":-2,"focused":2,"fond":2,"fondness":2,"fool":-2,"foolish":-2,"fools":-2,"forbid":-1,"forbidden":-2,"forbidding":-2,"forced":-1,"foreclosure":-2,"foreclosures":-2,"forefront":1,"forget":-1,"forgetful":-2,"forgettable":-1,"forgive":1,"forgiving":1,"forgot":-1,"forgotten":-1,"fortune":2,"fortunate":2,"fortunately":2,"foul":-3,"frantic":-1,"fraud":-4,"frauds":-4,"fraudster":-4,"fraudsters":-4,"fraudulence":-4,"fraudulent":-4,"freak":-2,"free":1,"freedom":2,"freedoms":2,"frenzy":-3,"fresh":1,"friend":1,"friendliness":2,"friendly":2,"friendship":2,"fright":-2,"frightened":-2,"frightening":-3,"frikin":-2,"frisky":2,"frowning":-1,"fruitless":-2,"frustrate":-2,"frustrated":-2,"frustrates":-2,"frustrating":-2,"frustration":-2,"ftw":3,"fuck":-4,"fucked":-4,"fucker":-4,"fuckers":-4,"fuckface":-4,"fuckhead":-4,"fuckin":-4,"fucking":-4,"fucking amazing":4,"fucking beautiful":4,"fucking cute":4,"fucking fantastic":4,"fucking good":4,"fucking great":4,"fucking hot":2,"fucking love":4,"fucking loves":4,"fucking perfect":4,"fucktard":-4,"fud":-3,"fuked":-4,"fuking":-4,"fulfill":2,"fulfilled":2,"fulfillment":2,"fulfills":2,"fuming":-2,"fun":4,"funeral":-1,"funerals":-1,"funky":2,"funnier":4,"funny":4,"furious":-3,"futile":-2,"gag":-2,"gagged":-2,"gain":2,"gained":2,"gaining":2,"gains":2,"gallant":3,"gallantly":3,"gallantry":3,"game-changing":3,"garbage":-1,"gem":3,"generous":2,"generously":2,"genial":3,"ghastly":-2,"ghost":-1,"giddy":-2,"gift":2,"glad":3,"glamorous":3,"glamourous":3,"glee":3,"gleeful":3,"gloom":-1,"gloomy":-2,"glorious":2,"glory":2,"glum":-2,"god":1,"goddamn":-3,"godsend":4,"gold":2,"good":3,"goodlooking":3,"goodmorning":1,"goodness":3,"goodwill":3,"goofiness":-2,"goofy":-2,"grace":1,"graceful":2,"gracious":3,"grand":3,"grant":1,"granted":1,"granting":1,"grants":1,"grateful":3,"gratification":2,"grave":-2,"gray":-1,"grisly":-2,"gr8":3,"great":3,"greater":3,"greatest":3,"greed":-3,"greedy":-2,"green wash":-3,"green washing":-3,"greenwash":-3,"greenwasher":-3,"greenwashers":-3,"greenwashing":-3,"greet":1,"greeted":1,"greeting":1,"greetings":2,"greets":1,"grey":-1,"grief":-2,"grieved":-2,"grim":-2,"gripping":2,"groan":-2,"groaned":-2,"groaning":-2,"groans":-2,"gross":-2,"growing":1,"growth":2,"growths":2,"gruesome":-3,"guarantee":1,"guilt":-3,"guilty":-3,"gullibility":-2,"gullible":-2,"gun":-1,"ha":2,"hacked":-1,"haha":3,"hahaha":3,"hahahah":3,"hail":2,"hailed":2,"hallelujah":3,"handpicked":1,"handsome":3,"hapless":-2,"haplessness":-2,"happiest":3,"happiness":3,"happy":3,"harass":-3,"harassed":-3,"harasses":-3,"harassing":-3,"harassment":-3,"hard":-1,"hardier":2,"hardship":-2,"hardy":2,"harm":-2,"harmed":-2,"harmful":-2,"harming":-2,"harmony":2,"harmonious":2,"harmoniously":2,"harms":-2,"harried":-2,"harsh":-2,"harsher":-2,"harshest":-2,"harshly":-2,"hate":-3,"hated":-3,"hater":-3,"haters":-3,"hates":-3,"hating":-3,"hatred":-3,"haunt":-1,"haunted":-2,"haunting":1,"haunts":-1,"havoc":-2,"hazardous":-3,"headache":-2,"healthy":2,"heartbreaking":-3,"heartbroken":-3,"heartfelt":3,"heartless":-2,"heartwarming":3,"heaven":2,"heavenly":4,"heavyhearted":-2,"hehe":2,"hell":-4,"hellish":-2,"help":2,"helpful":2,"helping":2,"helpless":-2,"helps":2,"hero":2,"heroes":2,"heroic":3,"hesitant":-2,"hesitate":-2,"hid":-1,"hide":-1,"hideous":-3,"hides":-1,"hiding":-1,"highlight":2,"hilarious":2,"hinder":-2,"hindrance":-2,"hoax":-2,"hollow":-1,"homeless":-2,"homesick":-2,"homicide":-2,"homicides":-2,"honest":2,"honor":2,"honored":2,"honoring":2,"honour":2,"honoured":2,"honouring":2,"hooligan":-2,"hooliganism":-2,"hooligans":-2,"hope":2,"hopeful":2,"hopefully":2,"hopeless":-2,"hopelessness":-2,"hopes":2,"hoping":2,"horrendous":-3,"horrid":-3,"horrible":-3,"horrific":-3,"horrified":-3,"hospitalized":-2,"hostile":-2,"huckster":-2,"hug":2,"huge":1,"hugs":2,"humane":2,"humble":1,"humbug":-2,"humerous":3,"humiliated":-3,"humiliation":-3,"humor":2,"humorous":2,"humour":2,"humourous":2,"hunger":-2,"hurrah":5,"hurt":-2,"hurting":-2,"hurts":-2,"hypocritical":-2,"hysteria":-3,"hysterical":-3,"hysterics":-3,"icky":-3,"idiocy":-3,"idiot":-3,"idiotic":-3,"ignorance":-2,"ignorant":-2,"ignore":-1,"ignored":-2,"ignores":-1,"ill":-2,"ill-fated":-2,"illegal":-3,"illegally":-3,"illegitimate":-3,"illiteracy":-2,"illness":-2,"illnesses":-2,"illogical":-2,"imaginative":2,"imbecile":-3,"immobilized":-1,"immortal":2,"immune":1,"impair":-2,"impaired":-2,"impairing":-2,"impairment":-2,"impairs":-2,"impatient":-2,"impeachment":-3,"impeachments":-3,"impede":-2,"impeded":-2,"impedes":-2,"impeding":-2,"impedingly":-2,"imperfect":-2,"importance":2,"important":2,"impose":-1,"imposed":-1,"imposes":-1,"imposing":-1,"imposter":-2,"impotent":-2,"impress":3,"impressed":3,"impresses":3,"impressive":3,"imprisoned":-2,"imprisonment":-2,"improper":-2,"improperly":-2,"improve":2,"improved":2,"improvement":2,"improves":2,"improving":2,"inability":-2,"inaction":-2,"inadequate":-2,"inadvertently":-2,"inappropriate":-2,"incapable":-2,"incapacitated":-2,"incapacitates":-2,"incapacitating":-2,"incense":-2,"incensed":-2,"incenses":-2,"incensing":-2,"incoherent":-2,"incompetence":-2,"incompetent":-2,"incomplete":-1,"incomprehensible":-2,"inconsiderate":-2,"inconvenience":-2,"inconvenient":-2,"increase":1,"increased":1,"indecisive":-2,"indestructible":2,"indicted":-2,"indifference":-2,"indifferent":-2,"indignant":-2,"indignation":-2,"indoctrinate":-2,"indoctrinated":-2,"indoctrinates":-2,"indoctrinating":-2,"inediable":-2,"inexorable":-3,"inexcusable":-3,"ineffective":-2,"ineffectively":-2,"ineffectual":-2,"inefficiency":-2,"inefficient":-2,"inefficiently":-2,"inept":-2,"ineptitude":-2,"infantile":-2,"infantilized":-2,"infatuated":2,"infatuation":2,"infect":-2,"infected":-2,"infecting":-2,"infection":-2,"infections":-2,"infectious":-2,"infects":-2,"inferior":-2,"infest":-2,"infested":-2,"infesting":-2,"infests":-2,"inflamed":-2,"inflict":-2,"inflicted":-2,"inflicting":-2,"inflicts":-2,"influential":2,"infract":-2,"infracted":-2,"infracting":-2,"infracts":-2,"infringement":-2,"infuriate":-2,"infuriated":-2,"infuriates":-2,"infuriating":-2,"inhibit":-1,"inhuman":-2,"injured":-2,"injuries":-2,"injury":-2,"injustice":-2,"innovate":1,"innovates":1,"innovation":1,"innovative":2,"inoperative":-2,"inquisition":-2,"inquisitive":2,"insane":-2,"insanity":-2,"insecure":-2,"insensitive":-2,"insensitivity":-2,"insignificant":-2,"insipid":-2,"insolvent":-2,"insomnia":-2,"inspiration":2,"inspirational":2,"inspire":2,"inspired":2,"inspires":2,"inspiring":3,"insufficiency":-2,"insufficient":-2,"insufficiently":-2,"insult":-2,"insulted":-2,"insulting":-2,"insults":-2,"intact":2,"integrity":2,"intelligent":2,"intense":1,"interest":1,"interested":2,"interesting":2,"interests":1,"interrogated":-2,"interrupt":-2,"interrupted":-2,"interrupting":-2,"interruption":-2,"interrupts":-2,"intimacy":2,"intimidate":-2,"intimidated":-2,"intimidates":-2,"intimidating":-2,"intimidation":-2,"intransigence":-2,"intransigency":-2,"intricate":2,"intrigues":1,"invasion":-1,"invincible":2,"invite":1,"inviting":1,"invulnerable":2,"irate":-3,"ironic":-1,"irony":-1,"irrational":-1,"irreparable":-2,"irreproducible":-2,"irresistible":2,"irresistibly":2,"irresolute":-2,"irresponsible":-2,"irresponsibly":-2,"irreversible":-1,"irreversibly":-1,"irritate":-3,"irritated":-3,"irritates":-3,"irritating":-3,"isolated":-1,"itchy":-2,"jackass":-4,"jackasses":-4,"jailed":-2,"jaunty":2,"jealous":-2,"jealousy":-2,"jeopardy":-2,"jerk":-3,"jesus":1,"jewel":1,"jewels":1,"jocular":2,"join":1,"joke":2,"jokes":2,"jolly":2,"jovial":2,"joy":3,"joyful":3,"joyfully":3,"joyless":-2,"joyous":3,"jubilant":3,"jumpy":-1,"justice":2,"justifiably":2,"justified":2,"keen":1,"kickback":-3,"kickbacks":-3,"kidnap":-2,"kidnapped":-2,"kidnapping":-2,"kidnappings":-2,"kidnaps":-2,"kill":-3,"killed":-3,"killing":-3,"kills":-3,"kind":2,"kind of":0,"kinder":2,"kindness":2,"kiss":2,"kudos":3,"lack":-2,"lackadaisical":-2,"lag":-1,"lagged":-2,"lagging":-2,"lags":-2,"lame":-2,"landmark":2,"lapse":-1,"lapsed":-1,"laugh":1,"laughed":1,"laughing":1,"laughs":1,"laughting":1,"launched":1,"lawl":3,"lawsuit":-2,"lawsuits":-2,"lazy":-1,"leadership":1,"leading":2,"leak":-1,"leaked":-1,"leave":-1,"legal":1,"legally":1,"lenient":1,"lethal":-2,"lethality":-2,"lethargic":-2,"lethargy":-2,"liar":-3,"liars":-3,"libelous":-2,"lied":-2,"lifeless":-1,"lifesaver":4,"lighthearted":1,"likable":2,"like":2,"likeable":2,"liked":2,"likers":2,"likes":2,"liking":2,"limitation":-1,"limited":-1,"limits":-1,"litigation":-1,"litigious":-2,"lively":2,"livid":-2,"lmao":4,"lmfao":4,"loathe":-3,"loathed":-3,"loathes":-3,"loathing":-3,"loathsome":-3,"lobbied":-2,"lobby":-2,"lobbying":-2,"lobbyist":-2,"lobbyists":-2,"lol":3,"lolol":4,"lololol":4,"lolololol":4,"lonely":-2,"lonesome":-2,"longing":-1,"lool":3,"loom":-1,"loomed":-1,"looming":-1,"looms":-1,"loool":3,"looool":3,"loose":-3,"looses":-3,"loser":-3,"losing":-3,"loss":-3,"losses":-3,"lost":-3,"lousy":-2,"lovable":3,"love":3,"loved":3,"lovelies":3,"lovely":3,"loves":3,"loving":2,"loving-kindness":3,"lowest":-1,"loyal":3,"loyalty":3,"luck":3,"luckily":3,"lucky":3,"lucrative":3,"ludicrous":-3,"lugubrious":-2,"lunatic":-3,"lunatics":-3,"lurk":-1,"lurking":-1,"lurks":-1,"luxury":2,"macabre":-2,"mad":-3,"maddening":-3,"made-up":-1,"madly":-3,"madness":-3,"magnificent":3,"maladaption":-2,"maldevelopment":-2,"maltreatment":-2,"mandatory":-1,"manipulated":-1,"manipulating":-1,"manipulation":-1,"manslaughter":-3,"marvel":3,"marvelous":3,"marvels":3,"masterpiece":4,"masterpieces":4,"matter":1,"matters":1,"mature":2,"meaningful":2,"meaningless":-2,"medal":3,"mediocrity":-3,"meditative":1,"melancholy":-2,"memorable":1,"memoriam":-2,"menace":-2,"menaced":-2,"menaces":-2,"mercy":2,"merry":3,"mesmerizing":3,"mess":-2,"messed":-2,"messing up":-2,"methodical":2,"methodically":2,"mindless":-2,"miracle":4,"mirth":3,"mirthful":3,"mirthfully":3,"misbehave":-2,"misbehaved":-2,"misbehaves":-2,"misbehaving":-2,"misbranding":-3,"miscast":-2,"mischief":-1,"mischiefs":-1,"misclassified":-2,"misclassifies":-2,"misclassify":-2,"misconduct":-2,"misconducted":-2,"misconducting":-2,"misconducts":-2,"miserable":-3,"miserably":-3,"misery":-2,"misfire":-2,"misfortune":-2,"misgiving":-2,"misinformation":-2,"misinformed":-2,"misinterpreted":-2,"mislead":-3,"misleaded":-3,"misleading":-3,"misleads":-3,"misplace":-2,"misplaced":-2,"misplaces":-2,"misplacing":-2,"mispricing":-3,"misread":-1,"misreport":-2,"misreported":-2,"misreporting":-2,"misreports":-2,"misrepresent":-2,"misrepresentation":-2,"misrepresentations":-2,"misrepresented":-2,"misrepresenting":-2,"misrepresents":-2,"miss":-2,"missed":-2,"missing":-2,"mistake":-2,"mistaken":-2,"mistakes":-2,"mistaking":-2,"misunderstand":-2,"misunderstanding":-2,"misunderstands":-2,"misunderstood":-2,"misuse":-2,"misused":-2,"misuses":-2,"misusing":-2,"moan":-2,"moaned":-2,"moaning":-2,"moans":-2,"mock":-2,"mocked":-2,"mocking":-2,"mocks":-2,"modernize":2,"modernized":2,"modernizes":2,"modernizing":2,"mongering":-2,"monopolize":-2,"monopolized":-2,"monopolizes":-2,"monopolizing":-2,"monotone":-1,"moody":-1,"mope":-1,"moping":-1,"moron":-3,"motherfucker":-5,"motherfucking":-5,"motivate":1,"motivated":2,"motivating":2,"motivation":1,"mourn":-2,"mourned":-2,"mournful":-2,"mourning":-2,"mourns":-2,"muddy":-2,"mumpish":-2,"murder":-2,"murderer":-2,"murdering":-3,"murderous":-3,"murders":-2,"murky":-2,"myth":-1,"n00b":-2,"naive":-2,"narcissism":-2,"nasty":-3,"natural":1,"na\xefve":-2,"needy":-2,"negative":-2,"negativity":-2,"neglect":-2,"neglected":-2,"neglecting":-2,"neglects":-2,"nerves":-1,"nervous":-2,"nervously":-2,"nice":3,"nifty":2,"niggas":-5,"nigger":-5,"no":-1,"no fun":-3,"noble":2,"noblest":2,"noisy":-1,"non-approved":-2,"nonsense":-2,"noob":-2,"nosey":-2,"not good":-2,"not working":-3,"notable":2,"noticeable":2,"notorious":-2,"novel":2,"numb":-1,"nurturing":2,"nuts":-3,"obliterate":-2,"obliterated":-2,"obnoxious":-3,"obscene":-2,"obscenity":-2,"obsessed":2,"obsolete":-2,"obstacle":-2,"obstacles":-2,"obstinate":-2,"obstruct":-2,"obstructed":-2,"obstructing":-2,"obstruction":-2,"obstructs":-2,"odd":-2,"offence":-2,"offences":-2,"offend":-2,"offended":-2,"offender":-2,"offending":-2,"offends":-2,"offense":-2,"offenses":-2,"offensive":-2,"offensively":-2,"offline":-1,"oks":2,"ominous":3,"once-in-a-lifetime":3,"oops":-2,"opportunities":2,"opportunity":2,"oppressed":-2,"oppression":-2,"oppressions":-2,"oppressive":-2,"optimism":2,"optimistic":2,"optionless":-2,"ostracize":-2,"ostracized":-2,"ostracizes":-2,"ouch":-2,"outage":-2,"outages":-2,"outbreak":-2,"outbreaks":-2,"outcry":-2,"outmaneuvered":-2,"outnumbered":-2,"outrage":-3,"outraged":-3,"outrageous":-3,"outreach":2,"outstanding":5,"overjoyed":4,"overload":-1,"overlooked":-1,"overprotective":-2,"overran":-2,"overreact":-2,"overreacted":-2,"overreacting":-2,"overreaction":-2,"overreacts":-2,"oversell":-2,"overselling":-2,"oversells":-2,"oversight":-1,"oversimplification":-2,"oversimplified":-2,"oversimplifies":-2,"oversimplify":-2,"oversold":-2,"overstatement":-2,"overstatements":-2,"overweight":-1,"overwrought":-3,"oxymoron":-1,"pain":-2,"pained":-2,"painful":-2,"panic":-3,"panicked":-3,"panics":-3,"paradise":3,"paradox":-1,"pardon":2,"pardoned":2,"pardoning":2,"pardons":2,"parley":-1,"passion":1,"passionate":2,"passive":-1,"passively":-1,"pathetic":-2,"pay":-1,"peace":2,"peaceful":2,"peacefully":2,"penalize":-2,"penalized":-2,"penalizes":-2,"penalizing":-2,"penalty":-2,"pensive":-1,"perfect":3,"perfected":2,"perfection":3,"perfectly":3,"perfects":2,"peril":-2,"perjury":-3,"perpetrated":-2,"perpetrator":-2,"perpetrators":-2,"perplexed":-2,"persecute":-2,"persecuted":-2,"persecutes":-2,"persecuting":-2,"perturbed":-2,"pervert":-3,"pesky":-2,"pessimism":-2,"pessimistic":-2,"petrified":-2,"philanthropy":2,"phobic":-2,"picturesque":2,"pileup":-1,"pillage":-2,"pique":-2,"piqued":-2,"piss":-4,"pissed":-4,"pissing":-3,"piteous":-2,"pitied":-1,"pity":-2,"plague":-3,"plagued":-3,"plagues":-3,"plaguing":-3,"playful":2,"pleasant":3,"please":1,"pleased":3,"pleasurable":3,"pleasure":3,"plodding":-2,"poignant":2,"pointless":-2,"poised":-2,"poison":-2,"poisoned":-2,"poisons":-2,"polished":2,"polite":2,"politeness":2,"pollutant":-2,"pollute":-2,"polluted":-2,"polluter":-2,"polluters":-2,"pollutes":-2,"pollution":-2,"poor":-2,"poorer":-2,"poorest":-2,"poorly":-2,"popular":3,"popularity":3,"positive":2,"positively":2,"possessive":-2,"post-traumatic":-2,"postpone":-1,"postponed":-1,"postpones":-1,"postponing":-1,"poverty":-1,"powerful":2,"powerless":-2,"praise":3,"praised":3,"praises":3,"praising":3,"pray":1,"praying":1,"prays":1,"prblm":-2,"prblms":-2,"predatory":-2,"prepared":1,"pressure":-1,"pressured":-2,"pretend":-1,"pretending":-1,"pretends":-1,"pretty":1,"prevent":-1,"prevented":-1,"preventing":-1,"prevents":-1,"prick":-5,"prison":-2,"prisoner":-2,"prisoners":-2,"privileged":2,"proactive":2,"problem":-2,"problems":-2,"profit":2,"profitable":2,"profiteer":-2,"profits":2,"progress":2,"prohibit":-1,"prohibits":-1,"prominent":2,"promise":1,"promised":1,"promises":1,"promote":1,"promoted":1,"promotes":1,"promoting":1,"promptly":1,"propaganda":-2,"prosecute":-1,"prosecuted":-2,"prosecutes":-1,"prosecution":-1,"prospect":1,"prospects":1,"prosperity":3,"prosperous":3,"protect":1,"protected":1,"protects":1,"protest":-2,"protesters":-2,"protesting":-2,"protests":-2,"proud":2,"proudly":2,"provoke":-1,"provoked":-1,"provokes":-1,"provoking":-1,"prudence":2,"pseudoscience":-3,"psychopathic":-2,"punish":-2,"punished":-2,"punishes":-2,"punishing":-2,"punitive":-2,"pure":1,"purest":1,"purposeful":2,"pushy":-1,"puzzled":-2,"quaking":-2,"qualities":2,"quality":2,"questionable":-2,"questioned":-1,"questioning":-1,"racism":-3,"racist":-3,"racists":-3,"rage":-2,"rageful":-2,"rainy":-1,"rant":-3,"ranter":-3,"ranters":-3,"rants":-3,"rape":-4,"raped":-4,"rapist":-4,"rapture":2,"raptured":2,"raptures":2,"rapturous":4,"rash":-2,"ratified":2,"reach":1,"reached":1,"reaches":1,"reaching":1,"reassure":1,"reassured":1,"reassures":1,"reassuring":2,"rebel":-2,"rebellion":-2,"rebels":-2,"recession":-2,"reckless":-2,"recognition":2,"recommend":2,"recommended":2,"recommends":2,"redeemed":2,"refine":1,"refined":1,"refines":1,"refreshingly":2,"refuse":-2,"refused":-2,"refuses":-2,"refusing":-2,"regret":-2,"regretful":-2,"regrets":-2,"regretted":-2,"regretting":-2,"reigning":1,"reject":-1,"rejected":-1,"rejecting":-1,"rejection":-2,"rejects":-1,"rejoice":4,"rejoiced":4,"rejoices":4,"rejoicing":4,"relaxed":2,"relentless":-1,"reliability":2,"reliable":2,"reliably":2,"reliant":2,"relieve":1,"relieved":2,"relieves":1,"relieving":2,"relishing":2,"remarkable":2,"remorse":-2,"repellent":-2,"repercussion":-2,"repercussions":-2,"reprimand":-2,"reprimanded":-2,"reprimanding":-2,"reprimands":-2,"repulse":-1,"repulsed":-2,"repulsive":-2,"rescue":2,"rescued":2,"rescues":2,"resentful":-2,"resign":-1,"resigned":-1,"resigning":-1,"resigns":-1,"resolute":2,"resolution":2,"resolve":2,"resolved":2,"resolves":2,"resolving":2,"respect":2,"respected":2,"respects":2,"responsibility":1,"responsible":2,"responsive":2,"restful":2,"restless":-2,"restore":1,"restored":1,"restores":1,"restoring":1,"restrict":-2,"restricted":-2,"restricting":-2,"restriction":-2,"restrictive":-1,"restricts":-2,"retained":-1,"retard":-2,"retarded":-2,"retreat":-1,"revenge":-2,"revengeful":-2,"revered":2,"revive":2,"revives":2,"revolting":-2,"reward":2,"rewarded":2,"rewarding":2,"rewards":2,"rich":2,"richly":2,"ridiculous":-3,"rig":-1,"rigged":-1,"right direction":3,"righteousness":2,"rightful":2,"rightfully":2,"rigorous":3,"rigorously":3,"riot":-2,"riots":-2,"rise":1,"rises":1,"risk":-2,"risks":-2,"risky":-2,"riveting":3,"rob":-2,"robber":-2,"robed":-2,"robing":-2,"robs":-2,"robust":2,"rofl":4,"roflcopter":4,"roflmao":4,"romance":2,"romantical":2,"romantically":2,"rose":1,"rotfl":4,"rotflmfao":4,"rotflol":4,"rotten":-3,"rude":-2,"ruin":-2,"ruined":-2,"ruining":-2,"ruins":-2,"sabotage":-2,"sad":-2,"sadden":-2,"saddened":-2,"sadly":-2,"safe":1,"safely":1,"safer":2,"safety":1,"salient":1,"salute":2,"saluted":2,"salutes":2,"saluting":2,"salvation":2,"sappy":-1,"sarcastic":-2,"satisfied":2,"savange":-2,"savanges":-2,"save":2,"saved":2,"savings":1,"scam":-2,"scams":-2,"scandal":-3,"scandalous":-3,"scandals":-3,"scapegoat":-2,"scapegoats":-2,"scare":-2,"scared":-2,"scar":-2,"scars":-2,"scary":-2,"sceptical":-2,"scold":-2,"scoop":3,"scorn":-2,"scornful":-2,"scream":-2,"screamed":-2,"screaming":-2,"screams":-2,"screwed":-2,"screwed up":-3,"scum":-3,"scumbag":-4,"seamless":2,"seamlessly":2,"secure":2,"secured":2,"secures":2,"sedition":-2,"seditious":-2,"seduced":-1,"self-abuse":-2,"self-confident":2,"self-contradictory":-2,"self-deluded":-2,"selfish":-3,"selfishness":-3,"sentence":-2,"sentenced":-2,"sentences":-2,"sentencing":-2,"serene":2,"settlement":1,"settlements":1,"severe":-2,"severely":-2,"sexist":-2,"sexistic":-2,"sexy":3,"shaky":-2,"shame":-2,"shamed":-2,"shameful":-2,"share":1,"shared":1,"shares":1,"shattered":-2,"shit":-4,"shithead":-4,"shitty":-3,"shock":-2,"shocked":-2,"shocking":-2,"shocks":-2,"shoody":-2,"shoot":-1,"short-sighted":-2,"short-sightedness":-2,"shortage":-2,"shortages":-2,"shrew":-4,"shy":-1,"sick":-2,"sickness":-2,"side-effect":-2,"side-effects":-2,"sigh":-2,"significance":1,"significant":1,"silencing":-1,"silly":-1,"simplicity":1,"sin":-2,"sincere":2,"sincerely":2,"sincerest":2,"sincerity":2,"sinful":-3,"singleminded":-2,"sinister":-2,"sins":-2,"skeptic":-2,"skeptical":-2,"skepticism":-2,"skeptics":-2,"slam":-2,"slash":-2,"slashed":-2,"slashes":-2,"slashing":-2,"slave":-3,"slavery":-3,"slaves":-3,"sleeplessness":-2,"slick":2,"slicker":2,"slickest":2,"slip":-1,"sloppy":-2,"sluggish":-2,"slumping":-1,"slut":-5,"smart":1,"smarter":2,"smartest":2,"smear":-2,"smile":2,"smiled":2,"smiles":2,"smiling":2,"smog":-2,"smuggle":-2,"smuggled":-2,"smuggling":-2,"smuggles":-2,"sneaky":-1,"sneeze":-2,"sneezed":-2,"sneezes":-2,"sneezing":-2,"snub":-2,"snubbed":-2,"snubbing":-2,"snubs":-2,"sobering":1,"solemn":-1,"solid":2,"solidarity":2,"solidified":2,"solidifies":2,"solidify":2,"solidifying":2,"solution":1,"solutions":1,"solve":1,"solved":1,"solves":1,"solving":1,"somber":-2,"some kind":0,"son-of-a-bitch":-5,"soothe":3,"soothed":3,"soothing":3,"sophisticated":2,"sore":-1,"sorrow":-2,"sorrowful":-2,"sorry":-1,"spacious":1,"spam":-2,"spammer":-3,"spammers":-3,"spamming":-2,"spark":1,"sparkle":3,"sparkles":3,"sparkling":3,"spearhead":2,"speculative":-2,"spirit":1,"spirited":2,"spiritless":-2,"spiteful":-2,"splendid":3,"spoiled":-2,"spoilt":-2,"spotless":2,"sprightly":2,"squander":-2,"squandered":-2,"squandering":-2,"squanders":-2,"squelched":-1,"stab":-2,"stabbed":-2,"stable":2,"stabs":-2,"stall":-2,"stalled":-2,"stalling":-2,"stamina":2,"stampede":-2,"stank":-2,"startled":-2,"startling":3,"starve":-2,"starved":-2,"starves":-2,"starving":-2,"steadfast":2,"steal":-2,"stealing":-2,"steals":-2,"stereotype":-2,"stereotyped":-2,"stifled":-1,"stimulate":1,"stimulated":1,"stimulates":1,"stimulating":2,"stingy":-2,"stink":-2,"stinked":-2,"stinker":-2,"stinking":-2,"stinks":-2,"stinky":-2,"stole":-2,"stolen":-2,"stop":-1,"stopped":-1,"stopping":-1,"stops":-1,"stout":2,"straight":1,"strange":-1,"strangely":-1,"strangled":-2,"strength":2,"strengthen":2,"strengthened":2,"strengthening":2,"strengthens":2,"strengths":2,"stress":-1,"stressed":-2,"stressor":-2,"stressors":-2,"stricken":-2,"strike":-1,"strikers":-2,"strikes":-1,"strong":2,"stronger":2,"strongest":2,"struck":-1,"struggle":-2,"struggled":-2,"struggles":-2,"struggling":-2,"stubborn":-2,"stuck":-2,"stunned":-2,"stunning":4,"stupid":-2,"stupidity":-3,"stupidly":-2,"suave":2,"subpoena":-2,"substantial":1,"substantially":1,"subversive":-2,"succeed":3,"succeeded":3,"succeeding":3,"succeeds":3,"success":2,"successful":3,"successfully":3,"suck":-3,"sucks":-3,"sue":-2,"sued":-2,"sueing":-2,"sues":-2,"suffer":-2,"suffered":-2,"sufferer":-2,"sufferers":-2,"suffering":-2,"suffers":-2,"suicidal":-2,"suicide":-2,"suicides":-2,"suing":-2,"suitable":2,"suited":2,"sulking":-2,"sulky":-2,"sullen":-2,"sunshine":2,"super":3,"superb":5,"superior":2,"support":2,"supported":2,"supporter":1,"supporters":1,"supporting":1,"supportive":2,"supports":2,"supreme":4,"survived":2,"surviving":2,"survivor":2,"suspect":-1,"suspected":-1,"suspecting":-1,"suspects":-1,"suspend":-1,"suspended":-1,"suspicious":-2,"sustainability":1,"sustainable":2,"sustainably":2,"swear":-2,"swearing":-2,"swears":-2,"sweet":2,"sweeter":3,"sweetest":3,"swift":2,"swiftly":2,"swindle":-3,"swindles":-3,"swindling":-3,"sympathetic":2,"sympathy":2,"taint":-2,"tainted":-2,"talent":2,"tard":-2,"tarnish":-2,"tarnished":-2,"tarnishes":-2,"tears":-2,"tender":2,"tenderness":2,"tense":-2,"tension":-1,"terrible":-3,"terribly":-3,"terrific":4,"terrifically":4,"terrified":-3,"terror":-3,"terrorist":-2,"terrorists":-2,"terrorize":-3,"terrorized":-3,"terrorizes":-3,"thank":2,"thankful":2,"thanks":2,"thorny":-2,"thoughtful":2,"thoughtless":-2,"threat":-2,"threaten":-2,"threatened":-2,"threatening":-2,"threatens":-2,"threats":-2,"thrilled":5,"thwart":-2,"thwarted":-2,"thwarting":-2,"thwarts":-2,"timid":-2,"timorous":-2,"tired":-2,"tits":-2,"tolerance":2,"tolerant":2,"toothless":-2,"top":2,"tops":2,"torn":-2,"torture":-4,"tortured":-4,"tortures":-4,"torturing":-4,"totalitarian":-2,"totalitarianism":-2,"tout":-2,"touted":-2,"touting":-2,"touts":-2,"toxic":-3,"tragedies":-2,"tragedy":-2,"tragic":-2,"tranquil":2,"transgress":-2,"transgressed":-2,"transgresses":-2,"transgressing":-2,"trap":-1,"trapped":-2,"traps":-1,"trauma":-3,"traumatic":-3,"travesty":-2,"treason":-3,"treasonous":-3,"treasure":2,"treasures":2,"trembling":-2,"tremor":-2,"tremors":-2,"tremulous":-2,"tribulation":-2,"tribute":2,"tricked":-2,"trickery":-2,"triumph":4,"triumphant":4,"troll":-2,"trouble":-2,"troubled":-2,"troubles":-2,"troubling":-2,"true":2,"trust":1,"trusted":2,"trusts":1,"tumor":-2,"twat":-5,"tyran":-3,"tyrannic":-3,"tyrannical":-3,"tyrannically":-3,"tyrans":-3,"ubiquitous":2,"ugh":-2,"ugliness":-3,"ugly":-3,"unable":-2,"unacceptable":-2,"unappeasable":-2,"unappreciated":-2,"unapproved":-2,"unattractive":-2,"unavailable":-1,"unavailing":-2,"unaware":-2,"unbearable":-2,"unbelievable":-1,"unbelieving":-1,"unbiased":2,"uncertain":-1,"unclear":-1,"uncomfortable":-2,"unconcerned":-2,"unconfirmed":-1,"unconvinced":-1,"uncredited":-1,"undecided":-1,"undercooked":-2,"underestimate":-1,"underestimated":-1,"underestimates":-1,"underestimating":-1,"undermine":-2,"undermined":-2,"undermines":-2,"undermining":-2,"underperform":-2,"underperformed":-2,"underperforming":-2,"underperforms":-2,"undeserving":-2,"undesirable":-2,"uneasy":-2,"unemployed":-1,"unemployment":-2,"unequal":-1,"unequaled":2,"unethical":-2,"uneventful":-2,"unfair":-2,"unfavorable":-2,"unfit":-2,"unfitted":-2,"unfocused":-2,"unforgivable":-3,"unforgiving":-2,"unfulfilled":-2,"unfunny":-2,"ungenerous":-2,"ungrateful":-3,"unhappy":-2,"unhappiness":-2,"unhealthy":-2,"unhygienic":-2,"unified":1,"unimaginative":-2,"unimpressed":-2,"uninspired":-2,"unintelligent":-2,"unintentional":-2,"uninvolving":-2,"united":1,"unjust":-2,"unlikely":-1,"unlovable":-2,"unloved":-2,"unmatched":1,"unmotivated":-2,"unoriginal":-2,"unparliamentary":-2,"unpleasant":-2,"unpleasantness":-2,"unprofessional":-2,"unravel":1,"unreleting":-2,"unresearched":-2,"unsafe":-2,"unsatisfied":-2,"unscientific":-2,"unsecured":-2,"unselfish":2,"unsettled":-1,"unsold":-1,"unsophisticated":-2,"unsound":-2,"unstable":-2,"unstoppable":2,"unsuccessful":-2,"unsuccessfully":-2,"unsupported":-2,"unsure":-1,"untarnished":2,"untrue":-2,"unwanted":-2,"unworthy":-2,"uplifting":2,"uproar":-3,"upset":-2,"upsets":-2,"upsetting":-2,"uptight":-2,"urgent":-1,"useful":2,"usefulness":2,"useless":-2,"uselessness":-2,"vague":-2,"validate":1,"validated":1,"validates":1,"validating":1,"vapid":-2,"verdict":-1,"verdicts":-1,"vested":1,"vexation":-2,"vexing":-2,"vibrant":3,"vicious":-2,"victim":-3,"victimization":-3,"victimize":-3,"victimized":-3,"victimizes":-3,"victimizing":-3,"victims":-3,"victor":3,"victors":3,"victory":3,"victories":3,"vigilant":3,"vigor":3,"vile":-3,"vindicate":2,"vindicated":2,"vindicates":2,"vindicating":2,"violate":-2,"violated":-2,"violates":-2,"violating":-2,"violation":-2,"violations":-2,"violence":-3,"violence-related":-3,"violent":-3,"violently":-3,"virtuous":2,"virulent":-2,"vision":1,"visionary":3,"visioning":1,"visions":1,"vitality":3,"vitamin":1,"vitriolic":-3,"vivacious":3,"vividly":2,"vociferous":-1,"vomit":-3,"vomited":-3,"vomiting":-3,"vomits":-3,"vulnerability":-2,"vulnerable":-2,"walkout":-2,"walkouts":-2,"wanker":-3,"want":1,"war":-2,"warfare":-2,"warm":1,"warmhearted":2,"warmness":2,"warmth":2,"warn":-2,"warned":-2,"warning":-3,"warnings":-3,"warns":-2,"waste":-1,"wasted":-2,"wasting":-2,"wavering":-1,"weak":-2,"weakened":-2,"weakness":-2,"weaknesses":-2,"wealth":3,"wealthier":2,"wealthy":2,"weary":-2,"weep":-2,"weeping":-2,"weird":-2,"welcome":2,"welcomed":2,"welcomes":2,"well-being":2,"well-championed":3,"well-developed":2,"well-established":2,"well-focused":2,"well-groomed":2,"well-proportioned":2,"whimsical":1,"whitewash":-3,"whore":-4,"wicked":-2,"widowed":-1,"willingness":2,"win":4,"winner":4,"winning":4,"wins":4,"winwin":3,"wisdom":1,"wish":1,"wishes":1,"wishing":1,"withdrawal":-3,"wits":2,"woebegone":-2,"woeful":-3,"won":3,"wonderful":4,"wonderfully":4,"woo":3,"woohoo":3,"wooo":4,"woow":4,"worn":-1,"worried":-3,"worries":-3,"worry":-3,"worrying":-3,"worse":-3,"worsen":-3,"worsened":-3,"worsening":-3,"worsens":-3,"worshiped":3,"worst":-3,"worth":2,"worthless":-2,"worthy":2,"wow":4,"wowow":4,"wowww":4,"wrathful":-3,"wreck":-2,"wrenching":-2,"wrong":-2,"wrongdoing":-2,"wrongdoings":-2,"wronged":-2,"wrongful":-2,"wrongfully":-2,"wrongly":-2,"wtf":-4,"wtff":-4,"wtfff":-4,"xo":3,"xoxo":3,"xoxoxo":4,"xoxoxoxo":4,"yeah":1,"yearning":1,"yeees":2,"yes":1,"youthful":2,"yucky":-2,"yummy":3,"zealot":-2,"zealots":-2,"zealous":2}')},3502:e=>{"use strict";e.exports=JSON.parse('{"cant":1,"can\'t":1,"dont":1,"don\'t":1,"doesnt":1,"doesn\'t":1,"not":1,"non":1,"wont":1,"won\'t":1,"isnt":1,"isn\'t":1}')}},e=>{var t=t=>e(e.s=t);e.O(0,[593,792],()=>(t(4562),t(8440))),_N_E=e.O()}]);